<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /blogs/inc/_core/model/_pagecache.class.php source</title>
    <link rel="stylesheet" href="../../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Jul  5 12:18:44 2014 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../../';
subdir='blogs/inc/_core/model';
filename='_pagecache.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/blogs/inc/_core/model/</a> -> <a href="_pagecache.class.php.html">_pagecache.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="_pagecache.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="_pagecache.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This file implements the PageCache class, which caches HTML pages genereated by the app.</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * This file is part of the evoCore framework - {@link http://evocore.net/}</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * See also {@link http://sourceforge.net/projects/evocms/}.</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> *</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * @copyright (c)2003-2014 by Francois Planque - {@link http://fplanque.com/}</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * Parts of this file are copyright (c)2004-2006 by Daniel HAHLER - {@link http://thequod.de/contact}.</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> *</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * {@internal License choice</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> * - If you have received this file as part of a package, please find the license.txt file in</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> *   the same folder or the closest folder above for complete license terms.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> * - If you have received this file individually (e-g: from http://evocms.cvs.sourceforge.net/)</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> *   then you must choose one of the following licenses before using the file:</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment"> *   - GNU General Public License 2 (GPL) - http://www.opensource.org/licenses/gpl-license.php</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> *   - Mozilla Public License 1.1 (MPL) - http://www.opensource.org/licenses/mozilla1.1.php</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * }}</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * {@internal Open Source relicensing agreement:</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * }}</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> *</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * @package evocore</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> *</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * @version $Id: _pagecache.class.php 6135 2014-03-08 07:54:05Z manuel $ }}}</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> *</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> */</span>
<a name="l28"><span class="linenum">  28</span></a>  if( !<a class="phpfunction" onClick="logFunction('defined')" href="../../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('EVO_MAIN_INIT')" href="../../../../_constants/EVO_MAIN_INIT.html" onMouseOver="constPopup(event,'EVO_MAIN_INIT')">EVO_MAIN_INIT</a>') ) die( 'Please, do not access this page directly.' );
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment">/**</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> * Page Cache.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> * @package evocore</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> */</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('PageCache')" href="../../../../_classes/pagecache.html" onMouseOver="classPopup(event,'pagecache')">PageCache</a>
<a name="l37"><span class="linenum">  37</span></a>  {
<a name="l38"><span class="linenum">  38</span></a>    <span class="comment">/**</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment">     * How old can a cached object get before we consider it outdated</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">     */</span>
<a name="l41"><span class="linenum">  41</span></a>      var <a class="var it7302" onMouseOver="hilite(7302)" onMouseOut="lolite()" onClick="logVariable('max_age_seconds')" href="../../../../_variables/max_age_seconds.html">$max_age_seconds</a> = 900;  <span class="comment">// 15 minutes for now</span>
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>    <span class="comment">/**</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">     * After how many bytes should we output sth live while collecting cache content:</span>
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">     */</span>
<a name="l46"><span class="linenum">  46</span></a>      var <a class="var it7303" onMouseOver="hilite(7303)" onMouseOut="lolite()" onClick="logVariable('output_chunk_size')" href="../../../../_variables/output_chunk_size.html">$output_chunk_size</a> = 2000;
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>      <span class="comment">/**</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">     * By default we consider caching not to be enabled</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">     */</span>
<a name="l51"><span class="linenum">  51</span></a>      var <a class="var it7304" onMouseOver="hilite(7304)" onMouseOut="lolite()" onClick="logVariable('is_enabled')" href="../../../../_variables/is_enabled.html">$is_enabled</a> = false;
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>      <span class="comment">/**</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     *</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     */</span>
<a name="l56"><span class="linenum">  56</span></a>      var <a class="var it7305" onMouseOver="hilite(7305)" onMouseOut="lolite()" onClick="logVariable('ads_collcache_path')" href="../../../../_variables/ads_collcache_path.html">$ads_collcache_path</a>;
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>      <span class="comment">/**</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">     * Filename of cache for current page</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">     */</span>
<a name="l61"><span class="linenum">  61</span></a>      var <a class="var it7306" onMouseOver="hilite(7306)" onMouseOut="lolite()" onClick="logVariable('cache_filepath')" href="../../../../_variables/cache_filepath.html">$cache_filepath</a>;
<a name="l62"><span class="linenum">  62</span></a>      <span class="comment">/**</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     * Progressively caching the content of the current page:</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">     */</span>
<a name="l65"><span class="linenum">  65</span></a>      var <a class="var it7307" onMouseOver="hilite(7307)" onMouseOut="lolite()" onClick="logVariable('cached_page_content')" href="../../../../_variables/cached_page_content.html">$cached_page_content</a> = '';
<a name="l66"><span class="linenum">  66</span></a>      <span class="comment">/**</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">     * Are we currently recording cache contents</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">     */</span>
<a name="l69"><span class="linenum">  69</span></a>      var <a class="var it633" onMouseOver="hilite(633)" onMouseOut="lolite()" onClick="logVariable('is_collecting')" href="../../../../_variables/is_collecting.html">$is_collecting</a> = false;
<a name="l70"><span class="linenum">  70</span></a>  
<a name="l71"><span class="linenum">  71</span></a>      <span class="comment">/**</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment">     * Cache Blog. It should be NULL if this is not a blog PageCache.</span>
<a name="l73"><span class="linenum">  73</span></a>  <span class="comment">     */</span>
<a name="l74"><span class="linenum">  74</span></a>      var <a class="var it7308" onMouseOver="hilite(7308)" onMouseOut="lolite()" onClick="logVariable('cache_Blog')" href="../../../../_variables/cache_Blog.html">$cache_Blog</a> = NULL;
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>      <span class="comment">/**</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">     * Constructor</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     *</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     * @param Blog to use, can be NULL</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">     */</span>
<a name="l81"><span class="linenum">  81</span></a>  	function <a class="function" onClick="logFunction('PageCache')" href="../../../../_functions/pagecache.html" onMouseOver="funcPopup(event,'pagecache')">PageCache</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../../_variables/Blog.html">$Blog</a> = NULL )
<a name="l82"><span class="linenum">  82</span></a>      {
<a name="l83"><span class="linenum">  83</span></a>          global <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l84"><span class="linenum">  84</span></a>          global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../../_variables/Settings.html">$Settings</a>;
<a name="l85"><span class="linenum">  85</span></a>          global <a class="var it5059" onMouseOver="hilite(5059)" onMouseOut="lolite()" onClick="logVariable('cache_path')" href="../../../../_variables/cache_path.html">$cache_path</a>, <a class="var it7309" onMouseOver="hilite(7309)" onMouseOut="lolite()" onClick="logVariable('pagecache_max_age')" href="../../../../_variables/pagecache_max_age.html">$pagecache_max_age</a>;
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>          if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../../_variables/Blog.html">$Blog</a>) )
<a name="l88"><span class="linenum">  88</span></a>          {    // Cache for &quot;other&quot; &quot;genereic&quot; &quot;special&quot; pages:
<a name="l89"><span class="linenum">  89</span></a>              <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ads_collcache_path')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/ads_collcache_path.html">ads_collcache_path</a> = <a class="var it5059" onMouseOver="hilite(5059)" onMouseOut="lolite()" onClick="logVariable('cache_path')" href="../../../../_variables/cache_path.html">$cache_path</a>.'general/';
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>              if( ( ! empty( <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../../_variables/Settings.html">$Settings</a> ) ) &amp;&amp; ( ! <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('general_cache_enabled') ) )
<a name="l92"><span class="linenum">  92</span></a>              {    // We do NOT want caching for this collection
<a name="l93"><span class="linenum">  93</span></a>                  <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'General cache not enabled.', 'pagecache' );
<a name="l94"><span class="linenum">  94</span></a>              }
<a name="l95"><span class="linenum">  95</span></a>              else
<a name="l96"><span class="linenum">  96</span></a>              {
<a name="l97"><span class="linenum">  97</span></a>                  <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_enabled')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/is_enabled.html">is_enabled</a> = true;
<a name="l98"><span class="linenum">  98</span></a>              }
<a name="l99"><span class="linenum">  99</span></a>          }
<a name="l100"><span class="linenum"> 100</span></a>          else
<a name="l101"><span class="linenum"> 101</span></a>          {    // Cache for a specific Blog/Collection:
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">            // We need to set this even if cache is not enabled (yet) bc it's used for creating:</span>
<a name="l103"><span class="linenum"> 103</span></a>              <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ads_collcache_path')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/ads_collcache_path.html">ads_collcache_path</a> = <a class="var it5059" onMouseOver="hilite(5059)" onMouseOut="lolite()" onClick="logVariable('cache_path')" href="../../../../_variables/cache_path.html">$cache_path</a>.'c'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../../_variables/Blog.html">$Blog</a>-&gt;<a onClick="logVariable('ID')" class="var it8952" onMouseOver="hilite(8952)" onMouseOut="lolite()" href="../../../../_variables/ID.html">ID</a>.'/';
<a name="l104"><span class="linenum"> 104</span></a>              <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_Blog')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_Blog.html">cache_Blog</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../../_variables/Blog.html">$Blog</a>;
<a name="l105"><span class="linenum"> 105</span></a>  
<a name="l106"><span class="linenum"> 106</span></a>              if( ! <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get_setting')" href="../../../../_functions/get_setting.html" onMouseOver="funcPopup(event,'get_setting')">get_setting</a>('cache_enabled') )
<a name="l107"><span class="linenum"> 107</span></a>              {    // We do NOT want caching for this collection
<a name="l108"><span class="linenum"> 108</span></a>                  <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cache not enabled for this blog.', 'pagecache' );
<a name="l109"><span class="linenum"> 109</span></a>              }
<a name="l110"><span class="linenum"> 110</span></a>              else
<a name="l111"><span class="linenum"> 111</span></a>              {
<a name="l112"><span class="linenum"> 112</span></a>                  <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_enabled')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/is_enabled.html">is_enabled</a> = true;
<a name="l113"><span class="linenum"> 113</span></a>              }
<a name="l114"><span class="linenum"> 114</span></a>          }
<a name="l115"><span class="linenum"> 115</span></a>  
<a name="l116"><span class="linenum"> 116</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('max_age_seconds')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/max_age_seconds.html">max_age_seconds</a> = <a class="var it7309" onMouseOver="hilite(7309)" onMouseOut="lolite()" onClick="logVariable('pagecache_max_age')" href="../../../../_variables/pagecache_max_age.html">$pagecache_max_age</a>;
<a name="l117"><span class="linenum"> 117</span></a>      }
<a name="l118"><span class="linenum"> 118</span></a>  
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>      <span class="comment">/**</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">     * Get path to file for current URL</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment">     *</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment">     * @todo fp&gt; We may need to add some keys like the locale or the charset, I'm not sure.</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">     */</span>
<a name="l125"><span class="linenum"> 125</span></a>  	function <a class="function" onClick="logFunction('get_af_filecache_path')" href="../../../../_functions/get_af_filecache_path.html" onMouseOver="funcPopup(event,'get_af_filecache_path')">get_af_filecache_path</a>()
<a name="l126"><span class="linenum"> 126</span></a>      {
<a name="l127"><span class="linenum"> 127</span></a>          global <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l128"><span class="linenum"> 128</span></a>          global <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('ReqURL')" href="../../../../_variables/ReqURL.html">$ReqURL</a>;
<a name="l129"><span class="linenum"> 129</span></a>  
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">        // We want the cache for the current URL</span>
<a name="l131"><span class="linenum"> 131</span></a>          if( empty( <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_filepath')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_filepath.html">cache_filepath</a> ) )
<a name="l132"><span class="linenum"> 132</span></a>          {
<a name="l133"><span class="linenum"> 133</span></a>               <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'URL being cached: '.<a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('ReqURL')" href="../../../../_variables/ReqURL.html">$ReqURL</a>, 'pagecache' );
<a name="l134"><span class="linenum"> 134</span></a>  
<a name="l135"><span class="linenum"> 135</span></a>               <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_filepath')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_filepath.html">cache_filepath</a> = <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('gen_filecache_path')" href="../../../../_functions/gen_filecache_path.html" onMouseOver="funcPopup(event,'gen_filecache_path')">gen_filecache_path</a>( <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('ReqURL')" href="../../../../_variables/ReqURL.html">$ReqURL</a> );
<a name="l136"><span class="linenum"> 136</span></a>  
<a name="l137"><span class="linenum"> 137</span></a>               <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cache file: '.<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_filepath')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_filepath.html">cache_filepath</a>, 'pagecache' );
<a name="l138"><span class="linenum"> 138</span></a>          }
<a name="l139"><span class="linenum"> 139</span></a>  
<a name="l140"><span class="linenum"> 140</span></a>           return <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_filepath')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_filepath.html">cache_filepath</a>;
<a name="l141"><span class="linenum"> 141</span></a>      }
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>      <span class="comment">/**</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     * Generate path for caching $url.</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">     * @param string URL</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">     * @return string</span>
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">     */</span>
<a name="l149"><span class="linenum"> 149</span></a>  	function <a class="function" onClick="logFunction('gen_filecache_path')" href="../../../../_functions/gen_filecache_path.html" onMouseOver="funcPopup(event,'gen_filecache_path')">gen_filecache_path</a>( <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../../_variables/url.html">$url</a> )
<a name="l150"><span class="linenum"> 150</span></a>      {
<a name="l151"><span class="linenum"> 151</span></a>          global <a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('skin')" href="../../../../_variables/skin.html">$skin</a>;
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>          if( !empty( <a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('skin')" href="../../../../_variables/skin.html">$skin</a> ) )
<a name="l154"><span class="linenum"> 154</span></a>          { // add skin folder into the end of the url before creating the hash to have different cache files for different skins
<a name="l155"><span class="linenum"> 155</span></a>              <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../../_variables/url.html">$url</a> .= <a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('skin')" href="../../../../_variables/skin.html">$skin</a>;
<a name="l156"><span class="linenum"> 156</span></a>          }
<a name="l157"><span class="linenum"> 157</span></a>          <a class="var it7310" onMouseOver="hilite(7310)" onMouseOut="lolite()" onClick="logVariable('url_hash')" href="../../../../_variables/url_hash.html">$url_hash</a> = md5(<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../../_variables/url.html">$url</a>);    <span class="comment">// fp&gt; is this teh fastest way to hash this into something not too obvious to guess?</span>
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">        // echo $url_hash;</span>
<a name="l159"><span class="linenum"> 159</span></a>  
<a name="l160"><span class="linenum"> 160</span></a>          return <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ads_collcache_path')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/ads_collcache_path.html">ads_collcache_path</a>.<a class="var it7310" onMouseOver="hilite(7310)" onMouseOut="lolite()" onClick="logVariable('url_hash')" href="../../../../_variables/url_hash.html">$url_hash</a>.'.page';
<a name="l161"><span class="linenum"> 161</span></a>      }
<a name="l162"><span class="linenum"> 162</span></a>  
<a name="l163"><span class="linenum"> 163</span></a>  
<a name="l164"><span class="linenum"> 164</span></a>      <span class="comment">/**</span>
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">     * Invalidate a particular page from the cache</span>
<a name="l166"><span class="linenum"> 166</span></a>  <span class="comment">     *</span>
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment">     * @param URL of the page to be invalidated</span>
<a name="l168"><span class="linenum"> 168</span></a>  <span class="comment">     */</span>
<a name="l169"><span class="linenum"> 169</span></a>  	function <a class="function" onClick="logFunction('invalidate')" href="../../../../_functions/invalidate.html" onMouseOver="funcPopup(event,'invalidate')">invalidate</a>( <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../../_variables/url.html">$url</a> )
<a name="l170"><span class="linenum"> 170</span></a>      {
<a name="l171"><span class="linenum"> 171</span></a>          global <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment">        // echo 'Invalidating:'.$url;</span>
<a name="l174"><span class="linenum"> 174</span></a>          <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Invalidating:'.<a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../../_variables/url.html">$url</a>, 'pagecache' );
<a name="l175"><span class="linenum"> 175</span></a>  
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">        // What would be the cache file for the current URL?</span>
<a name="l177"><span class="linenum"> 177</span></a>          <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a> = <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('gen_filecache_path')" href="../../../../_functions/gen_filecache_path.html" onMouseOver="funcPopup(event,'gen_filecache_path')">gen_filecache_path</a>( <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../../_variables/url.html">$url</a> );
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>          @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>( <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a> );
<a name="l180"><span class="linenum"> 180</span></a>      }
<a name="l181"><span class="linenum"> 181</span></a>  
<a name="l182"><span class="linenum"> 182</span></a>  
<a name="l183"><span class="linenum"> 183</span></a>      <span class="comment">/**</span>
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">     * @return boolean true if cache has been successfully created</span>
<a name="l185"><span class="linenum"> 185</span></a>  <span class="comment">     */</span>
<a name="l186"><span class="linenum"> 186</span></a>  	function <a class="function" onClick="logFunction('cache_create')" href="../../../../_functions/cache_create.html" onMouseOver="funcPopup(event,'cache_create')">cache_create</a>( <a class="var it3898" onMouseOver="hilite(3898)" onMouseOut="lolite()" onClick="logVariable('clear')" href="../../../../_variables/clear.html">$clear</a> = true )
<a name="l187"><span class="linenum"> 187</span></a>      {
<a name="l188"><span class="linenum"> 188</span></a>          global <a class="var it5059" onMouseOver="hilite(5059)" onMouseOut="lolite()" onClick="logVariable('cache_path')" href="../../../../_variables/cache_path.html">$cache_path</a>;
<a name="l189"><span class="linenum"> 189</span></a>  
<a name="l190"><span class="linenum"> 190</span></a>  <span class="comment">        // Create by using the filemanager's default chmod. TODO&gt; we may not want to make these publicly readable</span>
<a name="l191"><span class="linenum"> 191</span></a>          if( ! <a class="function" onClick="logFunction('mkdir_r')" href="../../../../_functions/mkdir_r.html" onMouseOver="funcPopup(event,'mkdir_r')">mkdir_r</a>( <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ads_collcache_path')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/ads_collcache_path.html">ads_collcache_path</a>, NULL ) )
<a name="l192"><span class="linenum"> 192</span></a>          {
<a name="l193"><span class="linenum"> 193</span></a>              return false;
<a name="l194"><span class="linenum"> 194</span></a>          }
<a name="l195"><span class="linenum"> 195</span></a>  
<a name="l196"><span class="linenum"> 196</span></a>          if( <a class="var it3898" onMouseOver="hilite(3898)" onMouseOut="lolite()" onClick="logVariable('clear')" href="../../../../_variables/clear.html">$clear</a> )
<a name="l197"><span class="linenum"> 197</span></a>          { // Clear contents of folder, if any:
<a name="l198"><span class="linenum"> 198</span></a>              <a class="function" onClick="logFunction('cleardir_r')" href="../../../../_functions/cleardir_r.html" onMouseOver="funcPopup(event,'cleardir_r')">cleardir_r</a>( <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ads_collcache_path')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/ads_collcache_path.html">ads_collcache_path</a> );
<a name="l199"><span class="linenum"> 199</span></a>          }
<a name="l200"><span class="linenum"> 200</span></a>  
<a name="l201"><span class="linenum"> 201</span></a>  <span class="comment">        // Create htaccess file with deny rules</span>
<a name="l202"><span class="linenum"> 202</span></a>          if( ! <a class="function" onClick="logFunction('create_htaccess_deny')" href="../../../../_functions/create_htaccess_deny.html" onMouseOver="funcPopup(event,'create_htaccess_deny')">create_htaccess_deny</a>( <a class="var it5059" onMouseOver="hilite(5059)" onMouseOut="lolite()" onClick="logVariable('cache_path')" href="../../../../_variables/cache_path.html">$cache_path</a> ) )
<a name="l203"><span class="linenum"> 203</span></a>          {
<a name="l204"><span class="linenum"> 204</span></a>              return false;
<a name="l205"><span class="linenum"> 205</span></a>          }
<a name="l206"><span class="linenum"> 206</span></a>  
<a name="l207"><span class="linenum"> 207</span></a>          return true;
<a name="l208"><span class="linenum"> 208</span></a>      }
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>  
<a name="l211"><span class="linenum"> 211</span></a>      <span class="comment">/**</span>
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment">     * Delete all cache files</span>
<a name="l213"><span class="linenum"> 213</span></a>  <span class="comment">     */</span>
<a name="l214"><span class="linenum"> 214</span></a>  	function <a class="function" onClick="logFunction('cache_delete')" href="../../../../_functions/cache_delete.html" onMouseOver="funcPopup(event,'cache_delete')">cache_delete</a>()
<a name="l215"><span class="linenum"> 215</span></a>      {
<a name="l216"><span class="linenum"> 216</span></a>          <a class="function" onClick="logFunction('rmdir_r')" href="../../../../_functions/rmdir_r.html" onMouseOver="funcPopup(event,'rmdir_r')">rmdir_r</a>( <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ads_collcache_path')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/ads_collcache_path.html">ads_collcache_path</a> );
<a name="l217"><span class="linenum"> 217</span></a>      }
<a name="l218"><span class="linenum"> 218</span></a>  
<a name="l219"><span class="linenum"> 219</span></a>  
<a name="l220"><span class="linenum"> 220</span></a>      <span class="comment">/**</span>
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment">     * Check if cache contents are available, otherwise start collecting output to be cached</span>
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">     *</span>
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment">     * @return true if we found and have echoed content from the cache</span>
<a name="l224"><span class="linenum"> 224</span></a>  <span class="comment">     */</span>
<a name="l225"><span class="linenum"> 225</span></a>  	function <a class="function" onClick="logFunction('check')" href="../../../../_functions/check.html" onMouseOver="funcPopup(event,'check')">check</a>()
<a name="l226"><span class="linenum"> 226</span></a>      {
<a name="l227"><span class="linenum"> 227</span></a>          global <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l228"><span class="linenum"> 228</span></a>          global <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../../_variables/disp.html">$disp</a>;
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>          global <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../../_variables/Messages.html">$Messages</a>;
<a name="l231"><span class="linenum"> 231</span></a>  
<a name="l232"><span class="linenum"> 232</span></a>          if( ! <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_enabled')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/is_enabled.html">is_enabled</a> )
<a name="l233"><span class="linenum"> 233</span></a>          {    // We do NOT want caching for this page
<a name="l234"><span class="linenum"> 234</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cache not enabled. No lookup nor caching performed.', 'pagecache' );
<a name="l235"><span class="linenum"> 235</span></a>              return false;
<a name="l236"><span class="linenum"> 236</span></a>          }
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>          if( <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../../_variables/disp.html">$disp</a> == '404' )
<a name="l239"><span class="linenum"> 239</span></a>          {    // We do NOT want caching for 404 pages (illimited possibilities!)
<a name="l240"><span class="linenum"> 240</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Never cache 404s!', 'pagecache' );
<a name="l241"><span class="linenum"> 241</span></a>              return false;
<a name="l242"><span class="linenum"> 242</span></a>          }
<a name="l243"><span class="linenum"> 243</span></a>  
<a name="l244"><span class="linenum"> 244</span></a>          if( <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../../_variables/disp.html">$disp</a> == 'login' || <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../../_variables/disp.html">$disp</a> == 'register' || <a class="var it140" onMouseOver="hilite(140)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../../_variables/disp.html">$disp</a> == 'lostpassword' )
<a name="l245"><span class="linenum"> 245</span></a>          {    // We do NOT want caching for in-skin login, register and lostpassord pages
<a name="l246"><span class="linenum"> 246</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Never cache the in-skin login and register pages!', 'pagecache' );
<a name="l247"><span class="linenum"> 247</span></a>              return false;
<a name="l248"><span class="linenum"> 248</span></a>          }
<a name="l249"><span class="linenum"> 249</span></a>  
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">        // In the following cases, the page may sometimes be cached, sometimes be not...</span>
<a name="l251"><span class="linenum"> 251</span></a>  <span class="comment">        // We may need an etag to later determine if the client cache is the same as the server cache:</span>
<a name="l252"><span class="linenum"> 252</span></a>  
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">        // Send etag:</span>
<a name="l254"><span class="linenum"> 254</span></a>          <a class="function" onClick="logFunction('header_etag')" href="../../../../_functions/header_etag.html" onMouseOver="funcPopup(event,'header_etag')">header_etag</a>( <a class="function" onClick="logFunction('gen_current_page_etag')" href="../../../../_functions/gen_current_page_etag.html" onMouseOver="funcPopup(event,'gen_current_page_etag')">gen_current_page_etag</a>() );
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>          if( <a class="function" onClick="logFunction('is_logged_in')" href="../../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l257"><span class="linenum"> 257</span></a>          {    // We do NOT want caching when a user is logged in (private data)
<a name="l258"><span class="linenum"> 258</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Never cache pages for/from logged in members!', 'pagecache' );
<a name="l259"><span class="linenum"> 259</span></a>              return false;
<a name="l260"><span class="linenum"> 260</span></a>          }
<a name="l261"><span class="linenum"> 261</span></a>  
<a name="l262"><span class="linenum"> 262</span></a>          if( <a class="var it14" onMouseOver="hilite(14)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../../_variables/Messages.html">$Messages</a>-&gt;<a class="phpfunction" onClick="logFunction('count')" href="../../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>() )
<a name="l263"><span class="linenum"> 263</span></a>          {    // There are some messages do be displayed. That means the user has done some action.
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">            // We do want to display those messages.</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment">            // There may also be more... like a &quot;comment pending review&quot; etc...</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">            // DO NOT CACHE and do not present a cached page.</span>
<a name="l267"><span class="linenum"> 267</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Not caching because we have messages!', 'pagecache' );
<a name="l268"><span class="linenum"> 268</span></a>              return false;
<a name="l269"><span class="linenum"> 269</span></a>          }
<a name="l270"><span class="linenum"> 270</span></a>  
<a name="l271"><span class="linenum"> 271</span></a>  
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment">        // TODO: fp&gt; If the user has submitted a comment, we might actually want to invalidate the cache...</span>
<a name="l273"><span class="linenum"> 273</span></a>  
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>          if( <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('retrieve')" href="../../../../_functions/retrieve.html" onMouseOver="funcPopup(event,'retrieve')">retrieve</a>() )
<a name="l276"><span class="linenum"> 276</span></a>          { // We could retrieve:
<a name="l277"><span class="linenum"> 277</span></a>              return true;
<a name="l278"><span class="linenum"> 278</span></a>          }
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>  
<a name="l281"><span class="linenum"> 281</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_collecting')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/is_collecting.html">is_collecting</a> = true;
<a name="l282"><span class="linenum"> 282</span></a>  
<a name="l283"><span class="linenum"> 283</span></a>          <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Collecting started', 'pagecache' );
<a name="l284"><span class="linenum"> 284</span></a>  
<a name="l285"><span class="linenum"> 285</span></a>          <a class="phpfunction" onClick="logFunction('ob_start')" href="../../../../_functions/ob_start.html" onMouseOver="phpfuncPopup(event,'ob_start')">ob_start</a>( array( &amp; <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>, 'output_handler'), <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('output_chunk_size')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/output_chunk_size.html">output_chunk_size</a> );
<a name="l286"><span class="linenum"> 286</span></a>  
<a name="l287"><span class="linenum"> 287</span></a>          return false;
<a name="l288"><span class="linenum"> 288</span></a>      }
<a name="l289"><span class="linenum"> 289</span></a>  
<a name="l290"><span class="linenum"> 290</span></a>  
<a name="l291"><span class="linenum"> 291</span></a>      <span class="comment">/**</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment">     * Retrieve and output cache for current URL.</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment">     *</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment">     * @return boolean true if we could retrieve</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment">     */</span>
<a name="l296"><span class="linenum"> 296</span></a>  	function <a class="function" onClick="logFunction('retrieve')" href="../../../../_functions/retrieve.html" onMouseOver="funcPopup(event,'retrieve')">retrieve</a>()
<a name="l297"><span class="linenum"> 297</span></a>      {
<a name="l298"><span class="linenum"> 298</span></a>          global <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l299"><span class="linenum"> 299</span></a>          global <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('ReqURL')" href="../../../../_variables/ReqURL.html">$ReqURL</a>;
<a name="l300"><span class="linenum"> 300</span></a>          global <a class="var it1826" onMouseOver="hilite(1826)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l301"><span class="linenum"> 301</span></a>          global <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('Timer')" href="../../../../_variables/Timer.html">$Timer</a>;
<a name="l302"><span class="linenum"> 302</span></a>          global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../../_variables/Settings.html">$Settings</a>;
<a name="l303"><span class="linenum"> 303</span></a>  
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">        // What would be the cache file for the current URL?</span>
<a name="l305"><span class="linenum"> 305</span></a>          <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a> = <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_af_filecache_path')" href="../../../../_functions/get_af_filecache_path.html" onMouseOver="funcPopup(event,'get_af_filecache_path')">get_af_filecache_path</a>();
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  
<a name="l308"><span class="linenum"> 308</span></a>          <span class="comment">/*</span>
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment">        // fstat() is interesting because it gives the last access time... use that for purging...</span>
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment">        * Tblue&gt; Note: Many server admins mount partitions with the &quot;noatime&quot;</span>
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment">        *              option, which disables atime updates and thus speeds</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment">        *              up disk access - that means the atime is not reliable,</span>
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment">        *              better use the mtime (modification time).</span>
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">        if( $fh = @fopen( $af_cache_file, 'r', false ) )</span>
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment">        {</span>
<a name="l316"><span class="linenum"> 316</span></a>  <span class="comment">            $fstat = fstat( $fh );</span>
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">            pre_dump( $fstat );</span>
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment">            fclose( $fh );</span>
<a name="l319"><span class="linenum"> 319</span></a>  <span class="comment">        }</span>
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment">        */</span>
<a name="l321"><span class="linenum"> 321</span></a>  
<a name="l322"><span class="linenum"> 322</span></a>          <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('Timer')" href="../../../../_variables/Timer.html">$Timer</a>-&gt;<a class="function" onClick="logFunction('resume')" href="../../../../_functions/resume.html" onMouseOver="funcPopup(event,'resume')">resume</a>( 'Read cache file' );
<a name="l323"><span class="linenum"> 323</span></a>          <a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a> = @<a class="phpfunction" onClick="logFunction('file')" href="../../../../_functions/file.html" onMouseOver="phpfuncPopup(event,'file')">file</a>( <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a>, false );
<a name="l324"><span class="linenum"> 324</span></a>          <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('Timer')" href="../../../../_variables/Timer.html">$Timer</a>-&gt;<a class="function" onClick="logFunction('pause')" href="../../../../_functions/pause.html" onMouseOver="funcPopup(event,'pause')">pause</a>( 'Read cache file' );
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>          if( <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_Blog')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_Blog.html">cache_Blog</a> != NULL )
<a name="l327"><span class="linenum"> 327</span></a>          {
<a name="l328"><span class="linenum"> 328</span></a>              <a class="var it7312" onMouseOver="hilite(7312)" onMouseOut="lolite()" onClick="logVariable('last_invalidation_timestamp')" href="../../../../_variables/last_invalidation_timestamp.html">$last_invalidation_timestamp</a> = <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_Blog')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_Blog.html">cache_Blog</a>-&gt;<a class="function" onClick="logFunction('get_setting')" href="../../../../_functions/get_setting.html" onMouseOver="funcPopup(event,'get_setting')">get_setting</a>( 'last_invalidation_timestamp' );
<a name="l329"><span class="linenum"> 329</span></a>              if( <a class="var it7312" onMouseOver="hilite(7312)" onMouseOut="lolite()" onClick="logVariable('last_invalidation_timestamp')" href="../../../../_variables/last_invalidation_timestamp.html">$last_invalidation_timestamp</a> == 0 )
<a name="l330"><span class="linenum"> 330</span></a>              {
<a name="l331"><span class="linenum"> 331</span></a>                  <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_Blog')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_Blog.html">cache_Blog</a>-&gt;<a class="function" onClick="logFunction('set_setting')" href="../../../../_functions/set_setting.html" onMouseOver="funcPopup(event,'set_setting')">set_setting</a>( 'last_invalidation_timestamp', <a class="var it1826" onMouseOver="hilite(1826)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../../_variables/servertimenow.html">$servertimenow</a> );
<a name="l332"><span class="linenum"> 332</span></a>                  <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_Blog')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cache_Blog.html">cache_Blog</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l333"><span class="linenum"> 333</span></a>              }
<a name="l334"><span class="linenum"> 334</span></a>          }
<a name="l335"><span class="linenum"> 335</span></a>          else
<a name="l336"><span class="linenum"> 336</span></a>          {
<a name="l337"><span class="linenum"> 337</span></a>              <a class="var it7312" onMouseOver="hilite(7312)" onMouseOut="lolite()" onClick="logVariable('last_invalidation_timestamp')" href="../../../../_variables/last_invalidation_timestamp.html">$last_invalidation_timestamp</a> = <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'last_invalidation_timestamp' );
<a name="l338"><span class="linenum"> 338</span></a>              if( <a class="var it7312" onMouseOver="hilite(7312)" onMouseOut="lolite()" onClick="logVariable('last_invalidation_timestamp')" href="../../../../_variables/last_invalidation_timestamp.html">$last_invalidation_timestamp</a> == 0 )
<a name="l339"><span class="linenum"> 339</span></a>              {
<a name="l340"><span class="linenum"> 340</span></a>                  <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'last_invalidation_timestamp', <a class="var it1826" onMouseOver="hilite(1826)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../../_variables/servertimenow.html">$servertimenow</a> );
<a name="l341"><span class="linenum"> 341</span></a>                  <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l342"><span class="linenum"> 342</span></a>              }
<a name="l343"><span class="linenum"> 343</span></a>          }
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment">        // fp&gt; note we are using empty() so that we detect both the case where there is no file and the case where the file</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment">        // might have ended up empty because PHP crashed while writing to it or sth like that...</span>
<a name="l347"><span class="linenum"> 347</span></a>          if( ! empty(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>) )
<a name="l348"><span class="linenum"> 348</span></a>          {    // We have data in the cache!
<a name="l349"><span class="linenum"> 349</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Retrieving from cache!', 'pagecache' );
<a name="l350"><span class="linenum"> 350</span></a>  
<a name="l351"><span class="linenum"> 351</span></a>              <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('Timer')" href="../../../../_variables/Timer.html">$Timer</a>-&gt;<a class="function" onClick="logFunction('resume')" href="../../../../_functions/resume.html" onMouseOver="funcPopup(event,'resume')">resume</a>( 'Cache file processing' );
<a name="l352"><span class="linenum"> 352</span></a>  
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">            // Retrieved cached URL:</span>
<a name="l354"><span class="linenum"> 354</span></a>              <a class="var it7313" onMouseOver="hilite(7313)" onMouseOut="lolite()" onClick="logVariable('retrieved_url')" href="../../../../_variables/retrieved_url.html">$retrieved_url</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[0]);
<a name="l355"><span class="linenum"> 355</span></a>              unset(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[0]);
<a name="l356"><span class="linenum"> 356</span></a>              if( <a class="var it7313" onMouseOver="hilite(7313)" onMouseOut="lolite()" onClick="logVariable('retrieved_url')" href="../../../../_variables/retrieved_url.html">$retrieved_url</a> != <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('ReqURL')" href="../../../../_variables/ReqURL.html">$ReqURL</a> )
<a name="l357"><span class="linenum"> 357</span></a>              {
<a name="l358"><span class="linenum"> 358</span></a>                  <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cached file URL ['.<a class="var it7313" onMouseOver="hilite(7313)" onMouseOut="lolite()" onClick="logVariable('retrieved_url')" href="../../../../_variables/retrieved_url.html">$retrieved_url</a>.'] does not match current URL, aborting retrieve.', 'pagecache' );
<a name="l359"><span class="linenum"> 359</span></a>                  return false;
<a name="l360"><span class="linenum"> 360</span></a>              }
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>  <span class="comment">            // timestamp of cache generation:</span>
<a name="l363"><span class="linenum"> 363</span></a>              <a class="var it7314" onMouseOver="hilite(7314)" onMouseOut="lolite()" onClick="logVariable('retrieved_ts')" href="../../../../_variables/retrieved_ts.html">$retrieved_ts</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[1]);
<a name="l364"><span class="linenum"> 364</span></a>              unset(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[1]);
<a name="l365"><span class="linenum"> 365</span></a>              <a class="var it7315" onMouseOver="hilite(7315)" onMouseOut="lolite()" onClick="logVariable('cache_age')" href="../../../../_variables/cache_age.html">$cache_age</a> = <a class="var it1826" onMouseOver="hilite(1826)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../../_variables/servertimenow.html">$servertimenow</a>-<a class="var it7314" onMouseOver="hilite(7314)" onMouseOut="lolite()" onClick="logVariable('retrieved_ts')" href="../../../../_variables/retrieved_ts.html">$retrieved_ts</a>;
<a name="l366"><span class="linenum"> 366</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cache age: '.<a class="phpfunction" onClick="logFunction('floor')" href="../../../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>(<a class="var it7315" onMouseOver="hilite(7315)" onMouseOut="lolite()" onClick="logVariable('cache_age')" href="../../../../_variables/cache_age.html">$cache_age</a>/60).' min '.(<a class="var it7315" onMouseOver="hilite(7315)" onMouseOut="lolite()" onClick="logVariable('cache_age')" href="../../../../_variables/cache_age.html">$cache_age</a> % 60).' sec', 'pagecache' );
<a name="l367"><span class="linenum"> 367</span></a>              if( ( <a class="var it7315" onMouseOver="hilite(7315)" onMouseOut="lolite()" onClick="logVariable('cache_age')" href="../../../../_variables/cache_age.html">$cache_age</a> &gt; <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('max_age_seconds')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/max_age_seconds.html">max_age_seconds</a> ) || ( <a class="var it7312" onMouseOver="hilite(7312)" onMouseOut="lolite()" onClick="logVariable('last_invalidation_timestamp')" href="../../../../_variables/last_invalidation_timestamp.html">$last_invalidation_timestamp</a> &gt; <a class="var it7314" onMouseOver="hilite(7314)" onMouseOut="lolite()" onClick="logVariable('retrieved_ts')" href="../../../../_variables/retrieved_ts.html">$retrieved_ts</a> ) )
<a name="l368"><span class="linenum"> 368</span></a>              {    // Cache has expired
<a name="l369"><span class="linenum"> 369</span></a>                  return false;
<a name="l370"><span class="linenum"> 370</span></a>              }
<a name="l371"><span class="linenum"> 371</span></a>  
<a name="l372"><span class="linenum"> 372</span></a>              <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../_variables/i.html">$i</a> = 1;
<a name="l373"><span class="linenum"> 373</span></a>              <a class="var it7316" onMouseOver="hilite(7316)" onMouseOut="lolite()" onClick="logVariable('optional_headers')" href="../../../../_variables/optional_headers.html">$optional_headers</a> = array();
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">            // Go through optional header lines</span>
<a name="l375"><span class="linenum"> 375</span></a>  <span class="comment">            // Optional headers are separated from the file header with an empty line.</span>
<a name="l376"><span class="linenum"> 376</span></a>              while( <a class="var it7317" onMouseOver="hilite(7317)" onMouseOut="lolite()" onClick="logVariable('optional_header_line')" href="../../../../_variables/optional_header_line.html">$optional_header_line</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[++<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../_variables/i.html">$i</a>]) )
<a name="l377"><span class="linenum"> 377</span></a>              {
<a name="l378"><span class="linenum"> 378</span></a>  <span class="comment">                // All optional header name value must be separated with ':'</span>
<a name="l379"><span class="linenum"> 379</span></a>                  if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it7317" onMouseOver="hilite(7317)" onMouseOut="lolite()" onClick="logVariable('optional_header_line')" href="../../../../_variables/optional_header_line.html">$optional_header_line</a>, ':' ) === false )
<a name="l380"><span class="linenum"> 380</span></a>                  {
<a name="l381"><span class="linenum"> 381</span></a>                      <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cached file format not recognized, aborting retrieve.', 'pagecache' );
<a name="l382"><span class="linenum"> 382</span></a>                      return false;
<a name="l383"><span class="linenum"> 383</span></a>                  }
<a name="l384"><span class="linenum"> 384</span></a>                  <a class="function" onClick="logFunction('list')" href="../../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it2436" onMouseOver="hilite(2436)" onMouseOut="lolite()" onClick="logVariable('header_name')" href="../../../../_variables/header_name.html">$header_name</a>, <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('header_value')" href="../../../../_variables/header_value.html">$header_value</a> ) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( &quot;:&quot;, <a class="var it7317" onMouseOver="hilite(7317)" onMouseOut="lolite()" onClick="logVariable('optional_header_line')" href="../../../../_variables/optional_header_line.html">$optional_header_line</a> );
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">                // Optional header name and value must not be empty</span>
<a name="l386"><span class="linenum"> 386</span></a>                  <a class="var it2436" onMouseOver="hilite(2436)" onMouseOut="lolite()" onClick="logVariable('header_name')" href="../../../../_variables/header_name.html">$header_name</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it2436" onMouseOver="hilite(2436)" onMouseOut="lolite()" onClick="logVariable('header_name')" href="../../../../_variables/header_name.html">$header_name</a> );
<a name="l387"><span class="linenum"> 387</span></a>                  <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('header_value')" href="../../../../_variables/header_value.html">$header_value</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('header_value')" href="../../../../_variables/header_value.html">$header_value</a> );
<a name="l388"><span class="linenum"> 388</span></a>                  if( empty( <a class="var it2436" onMouseOver="hilite(2436)" onMouseOut="lolite()" onClick="logVariable('header_name')" href="../../../../_variables/header_name.html">$header_name</a> ) || empty( <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('header_value')" href="../../../../_variables/header_value.html">$header_value</a> ) )
<a name="l389"><span class="linenum"> 389</span></a>                  {
<a name="l390"><span class="linenum"> 390</span></a>                      <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cached file format not recognized, aborting retrieve.', 'pagecache' );
<a name="l391"><span class="linenum"> 391</span></a>                      return false;
<a name="l392"><span class="linenum"> 392</span></a>                  }
<a name="l393"><span class="linenum"> 393</span></a>                  <a class="var it7316" onMouseOver="hilite(7316)" onMouseOut="lolite()" onClick="logVariable('optional_headers')" href="../../../../_variables/optional_headers.html">$optional_headers</a>[<a class="var it2436" onMouseOver="hilite(2436)" onMouseOut="lolite()" onClick="logVariable('header_name')" href="../../../../_variables/header_name.html">$header_name</a>] = <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('header_value')" href="../../../../_variables/header_value.html">$header_value</a>;
<a name="l394"><span class="linenum"> 394</span></a>                  unset(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../_variables/i.html">$i</a>]);
<a name="l395"><span class="linenum"> 395</span></a>              }
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment">            // unset the empty line</span>
<a name="l397"><span class="linenum"> 397</span></a>              unset(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../_variables/i.html">$i</a>]);
<a name="l398"><span class="linenum"> 398</span></a>  
<a name="l399"><span class="linenum"> 399</span></a>  <span class="comment">            // Check if the request has an If-Modified-Since date</span>
<a name="l400"><span class="linenum"> 400</span></a>              if( <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( 'HTTP_IF_MODIFIED_SINCE', <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../../../_variables/_SERVER.html">$_SERVER</a>) )
<a name="l401"><span class="linenum"> 401</span></a>              {
<a name="l402"><span class="linenum"> 402</span></a>                  <a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('if_modified_since')" href="../../../../_variables/if_modified_since.html">$if_modified_since</a> = <a class="phpfunction" onClick="logFunction('strtotime')" href="../../../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/;.*$/','',<a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../../../_variables/_SERVER.html">$_SERVER</a>['HTTP_IF_MODIFIED_SINCE']) );
<a name="l403"><span class="linenum"> 403</span></a>                  if( <a class="var it7314" onMouseOver="hilite(7314)" onMouseOut="lolite()" onClick="logVariable('retrieved_ts')" href="../../../../_variables/retrieved_ts.html">$retrieved_ts</a> &lt;= <a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('if_modified_since')" href="../../../../_variables/if_modified_since.html">$if_modified_since</a> )
<a name="l404"><span class="linenum"> 404</span></a>                  {    // Cached version is equal to (or older than) <a class="var it7318" onMouseOver="hilite(7318)" onMouseOut="lolite()" onClick="logVariable('if_modified')" href="../../../../_variables/if_modified.html">$if_modified</a> since; contents probably not modified...
<a name="l405"><span class="linenum"> 405</span></a>  
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">                    // It is still possible that in between we have sent logged-in versions (including evobar) of the page</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment">                    // and that the browser has an evobar version of the page in cache. Let's verify this before sending a 304...</span>
<a name="l408"><span class="linenum"> 408</span></a>  
<a name="l409"><span class="linenum"> 409</span></a>  <span class="comment">                    // We do this with an ETag header (another solution may be the Vary header)</span>
<a name="l410"><span class="linenum"> 410</span></a>                      if( <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( 'HTTP_IF_NONE_MATCH', <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../../../_variables/_SERVER.html">$_SERVER</a>) )
<a name="l411"><span class="linenum"> 411</span></a>                      {
<a name="l412"><span class="linenum"> 412</span></a>                          <a class="var it7319" onMouseOver="hilite(7319)" onMouseOut="lolite()" onClick="logVariable('if_none_match')" href="../../../../_variables/if_none_match.html">$if_none_match</a> = <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../../../_variables/_SERVER.html">$_SERVER</a>['HTTP_IF_NONE_MATCH'];
<a name="l413"><span class="linenum"> 413</span></a>  <span class="comment">                        // pre_dump($if_none_match, gen_current_page_etag() );</span>
<a name="l414"><span class="linenum"> 414</span></a>                          if( <a class="var it7319" onMouseOver="hilite(7319)" onMouseOut="lolite()" onClick="logVariable('if_none_match')" href="../../../../_variables/if_none_match.html">$if_none_match</a> == <a class="function" onClick="logFunction('gen_current_page_etag')" href="../../../../_functions/gen_current_page_etag.html" onMouseOver="funcPopup(event,'gen_current_page_etag')">gen_current_page_etag</a>() )
<a name="l415"><span class="linenum"> 415</span></a>                          {    // Ok, this seems to be really the same:
<a name="l416"><span class="linenum"> 416</span></a>                              <a class="function" onClick="logFunction('header_http_response')" href="../../../../_functions/header_http_response.html" onMouseOver="funcPopup(event,'header_http_response')">header_http_response</a>( '304 Not Modified' );
<a name="l417"><span class="linenum"> 417</span></a>                              exit(0);
<a name="l418"><span class="linenum"> 418</span></a>                          }
<a name="l419"><span class="linenum"> 419</span></a>                      }
<a name="l420"><span class="linenum"> 420</span></a>                  }
<a name="l421"><span class="linenum"> 421</span></a>              }
<a name="l422"><span class="linenum"> 422</span></a>  
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">            // ============== Ready to send cached version of the page =================</span>
<a name="l424"><span class="linenum"> 424</span></a>  
<a name="l425"><span class="linenum"> 425</span></a>  <span class="comment">            // Send no cache header including last modified date:</span>
<a name="l426"><span class="linenum"> 426</span></a>              <a class="function" onClick="logFunction('header_nocache')" href="../../../../_functions/header_nocache.html" onMouseOver="funcPopup(event,'header_nocache')">header_nocache</a>( <a class="var it7314" onMouseOver="hilite(7314)" onMouseOut="lolite()" onClick="logVariable('retrieved_ts')" href="../../../../_variables/retrieved_ts.html">$retrieved_ts</a> );
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>  <span class="comment">            // Go through headers that were saved in the cache:</span>
<a name="l429"><span class="linenum"> 429</span></a>  <span class="comment">            // $i was already set</span>
<a name="l430"><span class="linenum"> 430</span></a>              while( <a class="var it7320" onMouseOver="hilite(7320)" onMouseOut="lolite()" onClick="logVariable('headerline')" href="../../../../_variables/headerline.html">$headerline</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[++<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../_variables/i.html">$i</a>]) )
<a name="l431"><span class="linenum"> 431</span></a>              {
<a name="l432"><span class="linenum"> 432</span></a>                  <a class="phpfunction" onClick="logFunction('header')" href="../../../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>( <a class="var it7320" onMouseOver="hilite(7320)" onMouseOut="lolite()" onClick="logVariable('headerline')" href="../../../../_variables/headerline.html">$headerline</a> );
<a name="l433"><span class="linenum"> 433</span></a>                  unset(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../_variables/i.html">$i</a>]);
<a name="l434"><span class="linenum"> 434</span></a>              }
<a name="l435"><span class="linenum"> 435</span></a>              unset(<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>[<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../../../_variables/i.html">$i</a>]);
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>  <span class="comment">            // SEND CONTENT!</span>
<a name="l438"><span class="linenum"> 438</span></a>              <a class="var it1053" onMouseOver="hilite(1053)" onMouseOut="lolite()" onClick="logVariable('body')" href="../../../../_variables/body.html">$body</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('',<a class="var it1032" onMouseOver="hilite(1032)" onMouseOut="lolite()" onClick="logVariable('lines')" href="../../../../_variables/lines.html">$lines</a>);
<a name="l439"><span class="linenum"> 439</span></a>  
<a name="l440"><span class="linenum"> 440</span></a>              <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('Timer')" href="../../../../_variables/Timer.html">$Timer</a>-&gt;<a class="function" onClick="logFunction('pause')" href="../../../../_functions/pause.html" onMouseOver="funcPopup(event,'pause')">pause</a>( 'Cache file processing' );
<a name="l441"><span class="linenum"> 441</span></a>  
<a name="l442"><span class="linenum"> 442</span></a>              <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('Timer')" href="../../../../_variables/Timer.html">$Timer</a>-&gt;<a class="function" onClick="logFunction('resume')" href="../../../../_functions/resume.html" onMouseOver="funcPopup(event,'resume')">resume</a>( 'Sending cached content' );
<a name="l443"><span class="linenum"> 443</span></a>  
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment">            // Echo a first chunk (see explanation below)</span>
<a name="l445"><span class="linenum"> 445</span></a>              <a class="var it7321" onMouseOver="hilite(7321)" onMouseOut="lolite()" onClick="logVariable('buffer_size')" href="../../../../_variables/buffer_size.html">$buffer_size</a> = 12000;  <span class="comment">// Empiric value, you can make it smaller if you show me screenshots of better timings with a smaller value</span>
<a name="l446"><span class="linenum"> 446</span></a>              echo <a class="phpfunction" onClick="logFunction('substr')" href="../../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1053" onMouseOver="hilite(1053)" onMouseOut="lolite()" onClick="logVariable('body')" href="../../../../_variables/body.html">$body</a>, 0, <a class="var it7321" onMouseOver="hilite(7321)" onMouseOut="lolite()" onClick="logVariable('buffer_size')" href="../../../../_variables/buffer_size.html">$buffer_size</a> );
<a name="l447"><span class="linenum"> 447</span></a>  
<a name="l448"><span class="linenum"> 448</span></a>              <a class="phpfunction" onClick="logFunction('ob_start')" href="../../../../_functions/ob_start.html" onMouseOver="phpfuncPopup(event,'ob_start')">ob_start</a>();
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment">            // fp&gt; So why do we want an ob_start here?</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">            // fp&gt; Because otherwise echo will &quot;hang&quot; until all the data gets passed through apache (on default Apache install with default SendBufferSize)</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">            // fp&gt; With ob_start() the script will terminate much faster and the total exec time of the script will look much smaller.</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">            // fp&gt; This doesn't actually improve the speed of the transmission, it just lets the PHP script exit earlier</span>
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">            // fp&gt; DRAWBACK: shutdown will be executed *before* the &quot;ob&quot; data is actually sent :'(</span>
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">            // fp&gt; This is why we send a first chunk of data before ob_start(). shutdown can occur while that data is sent. then the remainder is sent.</span>
<a name="l455"><span class="linenum"> 455</span></a>  <span class="comment">            // Inspiration: http://wonko.com/post/seeing_poor_performance_using_phps_echo_statement_heres_why</span>
<a name="l456"><span class="linenum"> 456</span></a>  <span class="comment">            //              http://fplanque.com/dev/linux/how-to-log-request-processing-times-in-apache</span>
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">            //              http://fplanque.com/dev/linux/why-echo-is-slow-in-php-how-to-make-it-really-fast</span>
<a name="l458"><span class="linenum"> 458</span></a>  <span class="comment">            // fp&gt; TODO: do something similar during page cache collection.</span>
<a name="l459"><span class="linenum"> 459</span></a>  
<a name="l460"><span class="linenum"> 460</span></a>              echo <a class="phpfunction" onClick="logFunction('substr')" href="../../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1053" onMouseOver="hilite(1053)" onMouseOut="lolite()" onClick="logVariable('body')" href="../../../../_variables/body.html">$body</a>, <a class="var it7321" onMouseOver="hilite(7321)" onMouseOut="lolite()" onClick="logVariable('buffer_size')" href="../../../../_variables/buffer_size.html">$buffer_size</a> );
<a name="l461"><span class="linenum"> 461</span></a>  <span class="comment">            // ob_end_flush(); // fp&gt; WARNING: Putting an end flush here would just kill the benefit of the ob_start() above.</span>
<a name="l462"><span class="linenum"> 462</span></a>  
<a name="l463"><span class="linenum"> 463</span></a>              <a class="var it146" onMouseOver="hilite(146)" onMouseOut="lolite()" onClick="logVariable('Timer')" href="../../../../_variables/Timer.html">$Timer</a>-&gt;<a class="function" onClick="logFunction('pause')" href="../../../../_functions/pause.html" onMouseOver="funcPopup(event,'pause')">pause</a>( 'Sending cached content' );
<a name="l464"><span class="linenum"> 464</span></a>  
<a name="l465"><span class="linenum"> 465</span></a>              return true;
<a name="l466"><span class="linenum"> 466</span></a>          }
<a name="l467"><span class="linenum"> 467</span></a>  
<a name="l468"><span class="linenum"> 468</span></a>          return false;
<a name="l469"><span class="linenum"> 469</span></a>      }
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>  
<a name="l472"><span class="linenum"> 472</span></a>    <span class="comment">/**</span>
<a name="l473"><span class="linenum"> 473</span></a>  <span class="comment">     * This is called every x bytes to provide real time output</span>
<a name="l474"><span class="linenum"> 474</span></a>  <span class="comment">     */</span>
<a name="l475"><span class="linenum"> 475</span></a>  	function <a class="function" onClick="logFunction('output_handler')" href="../../../../_functions/output_handler.html" onMouseOver="funcPopup(event,'output_handler')">output_handler</a>( <a class="var it1016" onMouseOver="hilite(1016)" onMouseOut="lolite()" onClick="logVariable('buffer')" href="../../../../_variables/buffer.html">$buffer</a> )
<a name="l476"><span class="linenum"> 476</span></a>      {
<a name="l477"><span class="linenum"> 477</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cached_page_content')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cached_page_content.html">cached_page_content</a> .= <a class="var it1016" onMouseOver="hilite(1016)" onMouseOut="lolite()" onClick="logVariable('buffer')" href="../../../../_variables/buffer.html">$buffer</a>;
<a name="l478"><span class="linenum"> 478</span></a>          return <a class="var it1016" onMouseOver="hilite(1016)" onMouseOut="lolite()" onClick="logVariable('buffer')" href="../../../../_variables/buffer.html">$buffer</a>;
<a name="l479"><span class="linenum"> 479</span></a>      }
<a name="l480"><span class="linenum"> 480</span></a>  
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>      <span class="comment">/**</span>
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment">     * We are going to output personal data and we want to abort collecting the data for the cache.</span>
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">     *</span>
<a name="l485"><span class="linenum"> 485</span></a>  <span class="comment">     * @param boolean flush already collected data</span>
<a name="l486"><span class="linenum"> 486</span></a>  <span class="comment">     */</span>
<a name="l487"><span class="linenum"> 487</span></a>  	function <a class="function" onClick="logFunction('abort_collect')" href="../../../../_functions/abort_collect.html" onMouseOver="funcPopup(event,'abort_collect')">abort_collect</a>( <a class="var it7322" onMouseOver="hilite(7322)" onMouseOut="lolite()" onClick="logVariable('flush')" href="../../../../_variables/flush.html">$flush</a> = true )
<a name="l488"><span class="linenum"> 488</span></a>      {
<a name="l489"><span class="linenum"> 489</span></a>          global <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l490"><span class="linenum"> 490</span></a>  
<a name="l491"><span class="linenum"> 491</span></a>          if( ! <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_collecting')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/is_collecting.html">is_collecting</a> )
<a name="l492"><span class="linenum"> 492</span></a>          {    // We are not collecting anyway
<a name="l493"><span class="linenum"> 493</span></a>              return;
<a name="l494"><span class="linenum"> 494</span></a>          }
<a name="l495"><span class="linenum"> 495</span></a>  
<a name="l496"><span class="linenum"> 496</span></a>           <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Aborting cache data collection...', 'pagecache' );
<a name="l497"><span class="linenum"> 497</span></a>  
<a name="l498"><span class="linenum"> 498</span></a>           if( <a class="var it7322" onMouseOver="hilite(7322)" onMouseOut="lolite()" onClick="logVariable('flush')" href="../../../../_variables/flush.html">$flush</a> )
<a name="l499"><span class="linenum"> 499</span></a>           { // Flush the output buffer and turn off buffering
<a name="l500"><span class="linenum"> 500</span></a>              <a class="phpfunction" onClick="logFunction('ob_end_flush')" href="../../../../_functions/ob_end_flush.html" onMouseOver="phpfuncPopup(event,'ob_end_flush')">ob_end_flush</a>();
<a name="l501"><span class="linenum"> 501</span></a>           }
<a name="l502"><span class="linenum"> 502</span></a>           else
<a name="l503"><span class="linenum"> 503</span></a>           { // Erase the output buffer and turn off buffering
<a name="l504"><span class="linenum"> 504</span></a>              <a class="phpfunction" onClick="logFunction('ob_end_clean')" href="../../../../_functions/ob_end_clean.html" onMouseOver="phpfuncPopup(event,'ob_end_clean')">ob_end_clean</a>();
<a name="l505"><span class="linenum"> 505</span></a>           }
<a name="l506"><span class="linenum"> 506</span></a>  
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">        // We are no longer collecting...</span>
<a name="l508"><span class="linenum"> 508</span></a>          <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_collecting')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/is_collecting.html">is_collecting</a> = false;
<a name="l509"><span class="linenum"> 509</span></a>      }
<a name="l510"><span class="linenum"> 510</span></a>  
<a name="l511"><span class="linenum"> 511</span></a>  
<a name="l512"><span class="linenum"> 512</span></a>      <span class="comment">/**</span>
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment">     * End collecting output to be cached</span>
<a name="l514"><span class="linenum"> 514</span></a>  <span class="comment">     */</span>
<a name="l515"><span class="linenum"> 515</span></a>  	function <a class="function" onClick="logFunction('end_collect')" href="../../../../_functions/end_collect.html" onMouseOver="funcPopup(event,'end_collect')">end_collect</a>()
<a name="l516"><span class="linenum"> 516</span></a>      {
<a name="l517"><span class="linenum"> 517</span></a>          global <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l518"><span class="linenum"> 518</span></a>  
<a name="l519"><span class="linenum"> 519</span></a>          if( ! <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_collecting')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/is_collecting.html">is_collecting</a> )
<a name="l520"><span class="linenum"> 520</span></a>          {    // We are not collecting
<a name="l521"><span class="linenum"> 521</span></a>              return;
<a name="l522"><span class="linenum"> 522</span></a>          }
<a name="l523"><span class="linenum"> 523</span></a>  
<a name="l524"><span class="linenum"> 524</span></a>          <a class="phpfunction" onClick="logFunction('ob_end_flush')" href="../../../../_functions/ob_end_flush.html" onMouseOver="phpfuncPopup(event,'ob_end_flush')">ob_end_flush</a>();
<a name="l525"><span class="linenum"> 525</span></a>  
<a name="l526"><span class="linenum"> 526</span></a>  <span class="comment">        // echo ' *** cache end *** ';</span>
<a name="l527"><span class="linenum"> 527</span></a>  <span class="comment">        // echo $this-&gt;cached_page_content;</span>
<a name="l528"><span class="linenum"> 528</span></a>  
<a name="l529"><span class="linenum"> 529</span></a>  <span class="comment">        // What would be the cache file for the current URL?</span>
<a name="l530"><span class="linenum"> 530</span></a>          <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a> = <a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_af_filecache_path')" href="../../../../_functions/get_af_filecache_path.html" onMouseOver="funcPopup(event,'get_af_filecache_path')">get_af_filecache_path</a>();
<a name="l531"><span class="linenum"> 531</span></a>  
<a name="l532"><span class="linenum"> 532</span></a>  <span class="comment">        // fp&gt; 'x' mode should either give an exclusive write lock or fail</span>
<a name="l533"><span class="linenum"> 533</span></a>  <span class="comment">        // fp&gt; TODO: this here should be ok, but it would be even better with locking the file when we start collecting cache</span>
<a name="l534"><span class="linenum"> 534</span></a>          if( ! <a class="var it2033" onMouseOver="hilite(2033)" onMouseOut="lolite()" onClick="logVariable('fh')" href="../../../../_variables/fh.html">$fh</a> = @fopen( <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a>.'.tmp', 'x', false ) )
<a name="l535"><span class="linenum"> 535</span></a>          {
<a name="l536"><span class="linenum"> 536</span></a>              <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Could not open cache file!', 'pagecache' );
<a name="l537"><span class="linenum"> 537</span></a>          }
<a name="l538"><span class="linenum"> 538</span></a>          else
<a name="l539"><span class="linenum"> 539</span></a>          {
<a name="l540"><span class="linenum"> 540</span></a>  <span class="comment">            // Put the URL of the page we are caching into the cache. You can never be too paranoid!</span>
<a name="l541"><span class="linenum"> 541</span></a>  <span class="comment">            // People can change their domain names, folder structures, etc... AND you cannot trust the hash to give a</span>
<a name="l542"><span class="linenum"> 542</span></a>  <span class="comment">            // different file name in 100.00% of the cases! Serving a page for a different URL would be REEEEEALLLY BAAAAAAD!</span>
<a name="l543"><span class="linenum"> 543</span></a>              global <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('ReqURL')" href="../../../../_variables/ReqURL.html">$ReqURL</a>;
<a name="l544"><span class="linenum"> 544</span></a>              <a class="var it7323" onMouseOver="hilite(7323)" onMouseOut="lolite()" onClick="logVariable('file_head')" href="../../../../_variables/file_head.html">$file_head</a> = <a class="var it547" onMouseOver="hilite(547)" onMouseOut="lolite()" onClick="logVariable('ReqURL')" href="../../../../_variables/ReqURL.html">$ReqURL</a>.&quot;\n&quot;;
<a name="l545"><span class="linenum"> 545</span></a>  
<a name="l546"><span class="linenum"> 546</span></a>  <span class="comment">            // Put the time of the page generation into the file (btw this is the time of when we started this script)</span>
<a name="l547"><span class="linenum"> 547</span></a>              global <a class="var it1826" onMouseOver="hilite(1826)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l548"><span class="linenum"> 548</span></a>              <a class="var it7323" onMouseOver="hilite(7323)" onMouseOut="lolite()" onClick="logVariable('file_head')" href="../../../../_variables/file_head.html">$file_head</a> .= <a class="var it1826" onMouseOver="hilite(1826)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../../_variables/servertimenow.html">$servertimenow</a>.&quot;\n&quot;;
<a name="l549"><span class="linenum"> 549</span></a>  
<a name="l550"><span class="linenum"> 550</span></a>              global <a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('skin')" href="../../../../_variables/skin.html">$skin</a>;
<a name="l551"><span class="linenum"> 551</span></a>              if( !empty( <a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('skin')" href="../../../../_variables/skin.html">$skin</a> ) )
<a name="l552"><span class="linenum"> 552</span></a>              { // add current skin folder into the cache file header
<a name="l553"><span class="linenum"> 553</span></a>                  <a class="var it7323" onMouseOver="hilite(7323)" onMouseOut="lolite()" onClick="logVariable('file_head')" href="../../../../_variables/file_head.html">$file_head</a> .= 'skin:'.<a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('skin')" href="../../../../_variables/skin.html">$skin</a>.&quot;\n&quot;;
<a name="l554"><span class="linenum"> 554</span></a>              }
<a name="l555"><span class="linenum"> 555</span></a>  
<a name="l556"><span class="linenum"> 556</span></a>               <a class="var it7323" onMouseOver="hilite(7323)" onMouseOut="lolite()" onClick="logVariable('file_head')" href="../../../../_variables/file_head.html">$file_head</a> .= &quot;\n&quot;;
<a name="l557"><span class="linenum"> 557</span></a>  
<a name="l558"><span class="linenum"> 558</span></a>  <span class="comment">            // We need to write the content type!</span>
<a name="l559"><span class="linenum"> 559</span></a>              global <a class="var it3257" onMouseOver="hilite(3257)" onMouseOut="lolite()" onClick="logVariable('content_type_header')" href="../../../../_variables/content_type_header.html">$content_type_header</a>;
<a name="l560"><span class="linenum"> 560</span></a>              if( !empty(<a class="var it3257" onMouseOver="hilite(3257)" onMouseOut="lolite()" onClick="logVariable('content_type_header')" href="../../../../_variables/content_type_header.html">$content_type_header</a>) )
<a name="l561"><span class="linenum"> 561</span></a>              {
<a name="l562"><span class="linenum"> 562</span></a>                  <a class="var it7323" onMouseOver="hilite(7323)" onMouseOut="lolite()" onClick="logVariable('file_head')" href="../../../../_variables/file_head.html">$file_head</a> .= <a class="var it3257" onMouseOver="hilite(3257)" onMouseOut="lolite()" onClick="logVariable('content_type_header')" href="../../../../_variables/content_type_header.html">$content_type_header</a>.&quot;\n&quot;;
<a name="l563"><span class="linenum"> 563</span></a>              }
<a name="l564"><span class="linenum"> 564</span></a>  
<a name="l565"><span class="linenum"> 565</span></a>              <a class="var it7323" onMouseOver="hilite(7323)" onMouseOut="lolite()" onClick="logVariable('file_head')" href="../../../../_variables/file_head.html">$file_head</a> .= &quot;\n&quot;;
<a name="l566"><span class="linenum"> 566</span></a>  
<a name="l567"><span class="linenum"> 567</span></a>              <a class="phpfunction" onClick="logFunction('fwrite')" href="../../../../_functions/fwrite.html" onMouseOver="phpfuncPopup(event,'fwrite')">fwrite</a>( <a class="var it2033" onMouseOver="hilite(2033)" onMouseOut="lolite()" onClick="logVariable('fh')" href="../../../../_variables/fh.html">$fh</a>, <a class="var it7323" onMouseOver="hilite(7323)" onMouseOut="lolite()" onClick="logVariable('file_head')" href="../../../../_variables/file_head.html">$file_head</a>.<a class="var it17" onMouseOver="hilite(17)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cached_page_content')" class="var it8951" onMouseOver="hilite(8951)" onMouseOut="lolite()" href="../../../../_variables/cached_page_content.html">cached_page_content</a> );
<a name="l568"><span class="linenum"> 568</span></a>              <a class="phpfunction" onClick="logFunction('fclose')" href="../../../../_functions/fclose.html" onMouseOver="phpfuncPopup(event,'fclose')">fclose</a>( <a class="var it2033" onMouseOver="hilite(2033)" onMouseOut="lolite()" onClick="logVariable('fh')" href="../../../../_variables/fh.html">$fh</a> );
<a name="l569"><span class="linenum"> 569</span></a>  
<a name="l570"><span class="linenum"> 570</span></a>  <span class="comment">            // Now atomically replace old cache with new cache (at least on Linux)</span>
<a name="l571"><span class="linenum"> 571</span></a>              if( ! @<a class="phpfunction" onClick="logFunction('rename')" href="../../../../_functions/rename.html" onMouseOver="phpfuncPopup(event,'rename')">rename</a>( <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a>.'.tmp', <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a> ) )
<a name="l572"><span class="linenum"> 572</span></a>              {    // Rename failed, we are probably on windows PHP &lt;= 5.2.5... http://bugs.php.net/bug.php?id=44805
<a name="l573"><span class="linenum"> 573</span></a>  <span class="comment">                // we have to split this:</span>
<a name="l574"><span class="linenum"> 574</span></a>                  <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Renaming of cache file failed. (Windows?)', 'pagecache' );
<a name="l575"><span class="linenum"> 575</span></a>  <span class="comment">                // Kill cache:</span>
<a name="l576"><span class="linenum"> 576</span></a>                  <a class="phpfunction" onClick="logFunction('unlink')" href="../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>( <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a> );
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">                // Now, some other process might start to try caching (and will likely give up since the .tmp file already exists)</span>
<a name="l578"><span class="linenum"> 578</span></a>                  if( ! @<a class="phpfunction" onClick="logFunction('rename')" href="../../../../_functions/rename.html" onMouseOver="phpfuncPopup(event,'rename')">rename</a>( <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a>.'.tmp', <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a> ) )
<a name="l579"><span class="linenum"> 579</span></a>                  { // Hide errors bc another PHP process could have beaten us to writing a <span class="keyword">new </span><a class="class" onClick="logClass('file')" href="../../../../_classes/file.html" onMouseOver="classPopup(event,'file')">file</a> there
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment">                    // Anyways, we still could not rename, let's drop the .tmp file:</span>
<a name="l581"><span class="linenum"> 581</span></a>                      <a class="phpfunction" onClick="logFunction('unlink')" href="../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>( <a class="var it7311" onMouseOver="hilite(7311)" onMouseOut="lolite()" onClick="logVariable('af_cache_file')" href="../../../../_variables/af_cache_file.html">$af_cache_file</a>.'.tmp' );
<a name="l582"><span class="linenum"> 582</span></a>                  }
<a name="l583"><span class="linenum"> 583</span></a>                  else
<a name="l584"><span class="linenum"> 584</span></a>                  {
<a name="l585"><span class="linenum"> 585</span></a>                      <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cache updated... after unlink+rename!', 'pagecache' );
<a name="l586"><span class="linenum"> 586</span></a>                  }
<a name="l587"><span class="linenum"> 587</span></a>              }
<a name="l588"><span class="linenum"> 588</span></a>              else
<a name="l589"><span class="linenum"> 589</span></a>              {
<a name="l590"><span class="linenum"> 590</span></a>                  <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Cache updated!', 'pagecache' );
<a name="l591"><span class="linenum"> 591</span></a>              }
<a name="l592"><span class="linenum"> 592</span></a>          }
<a name="l593"><span class="linenum"> 593</span></a>      }
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>  
<a name="l596"><span class="linenum"> 596</span></a>      <span class="comment">/**</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">     * Check if the file with the given file path should be removed during prune page cache</span>
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment">     *</span>
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">     * @static</span>
<a name="l600"><span class="linenum"> 600</span></a>  <span class="comment">     *</span>
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">     * @param $file_path</span>
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">     * @return boolean true if the file should be removed, false otherwise</span>
<a name="l603"><span class="linenum"> 603</span></a>  <span class="comment">     */</span>
<a name="l604"><span class="linenum"> 604</span></a>  	function <a class="function" onClick="logFunction('checkDelete')" href="../../../../_functions/checkdelete.html" onMouseOver="funcPopup(event,'checkdelete')">checkDelete</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a> )
<a name="l605"><span class="linenum"> 605</span></a>      {
<a name="l606"><span class="linenum"> 606</span></a>          if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a>, 'CVS' ) !== false )
<a name="l607"><span class="linenum"> 607</span></a>          { // skip CVS folders - This could be more specific
<a name="l608"><span class="linenum"> 608</span></a>              return false;
<a name="l609"><span class="linenum"> 609</span></a>          }
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">        // get file name from path</span>
<a name="l611"><span class="linenum"> 611</span></a>          <a class="var it1441" onMouseOver="hilite(1441)" onMouseOut="lolite()" onClick="logVariable('file_name')" href="../../../../_variables/file_name.html">$file_name</a> = <a class="phpfunction" onClick="logFunction('basename')" href="../../../../_functions/basename.html" onMouseOver="phpfuncPopup(event,'basename')">basename</a>(<a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a>);
<a name="l612"><span class="linenum"> 612</span></a>  
<a name="l613"><span class="linenum"> 613</span></a>  <span class="comment">        // Note: index.html pages are in the cache to hide the contents from browsers in case the webserver whould should a listing</span>
<a name="l614"><span class="linenum"> 614</span></a>          if( ( <a class="var it1441" onMouseOver="hilite(1441)" onMouseOut="lolite()" onClick="logVariable('file_name')" href="../../../../_variables/file_name.html">$file_name</a> == '<a class="filename" href="../../../../index.html.html">index.html</a>' ) || ( <a class="phpfunction" onClick="logFunction('substr')" href="../../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1441" onMouseOver="hilite(1441)" onMouseOut="lolite()" onClick="logVariable('file_name')" href="../../../../_variables/file_name.html">$file_name</a>, 0, 1 ) == '.' ) || ( <a class="var it1441" onMouseOver="hilite(1441)" onMouseOut="lolite()" onClick="logVariable('file_name')" href="../../../../_variables/file_name.html">$file_name</a> == 'sample.htaccess' ) )
<a name="l615"><span class="linenum"> 615</span></a>          { // this file is index.html or sample.htaccess or it is hidden, should not delete it.
<a name="l616"><span class="linenum"> 616</span></a>              return false;
<a name="l617"><span class="linenum"> 617</span></a>          }
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>          global <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l620"><span class="linenum"> 620</span></a>          <a class="var it7324" onMouseOver="hilite(7324)" onMouseOut="lolite()" onClick="logVariable('datediff')" href="../../../../_variables/datediff.html">$datediff</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../../_variables/localtimenow.html">$localtimenow</a> - <a class="phpfunction" onClick="logFunction('filemtime')" href="../../../../_functions/filemtime.html" onMouseOver="phpfuncPopup(event,'filemtime')">filemtime</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a> );
<a name="l621"><span class="linenum"> 621</span></a>          if( <a class="var it7324" onMouseOver="hilite(7324)" onMouseOut="lolite()" onClick="logVariable('datediff')" href="../../../../_variables/datediff.html">$datediff</a> &lt; 86400 <span class="comment">/* 60*60*24 = 24 hour*/</span>)
<a name="l622"><span class="linenum"> 622</span></a>          { // the file is not older then 24 hour, should not delete it.
<a name="l623"><span class="linenum"> 623</span></a>              return false;
<a name="l624"><span class="linenum"> 624</span></a>          }
<a name="l625"><span class="linenum"> 625</span></a>  
<a name="l626"><span class="linenum"> 626</span></a>  <span class="comment">        // the file can be deleted</span>
<a name="l627"><span class="linenum"> 627</span></a>          return true;
<a name="l628"><span class="linenum"> 628</span></a>      }
<a name="l629"><span class="linenum"> 629</span></a>  
<a name="l630"><span class="linenum"> 630</span></a>  
<a name="l631"><span class="linenum"> 631</span></a>      <span class="comment">/**</span>
<a name="l632"><span class="linenum"> 632</span></a>  <span class="comment">     * Delete those files from the given directory, which results true value on checkDelete function</span>
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">     *</span>
<a name="l634"><span class="linenum"> 634</span></a>  <span class="comment">     * @static</span>
<a name="l635"><span class="linenum"> 635</span></a>  <span class="comment">     *</span>
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">     * @param string directory path</span>
<a name="l637"><span class="linenum"> 637</span></a>  <span class="comment">     * @param string the first error occured deleting the directory content</span>
<a name="l638"><span class="linenum"> 638</span></a>  <span class="comment">     */</span>
<a name="l639"><span class="linenum"> 639</span></a>  	function <a class="function" onClick="logFunction('deleteDirContent')" href="../../../../_functions/deletedircontent.html" onMouseOver="funcPopup(event,'deletedircontent')">deleteDirContent</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a>, &amp; <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> )
<a name="l640"><span class="linenum"> 640</span></a>      {
<a name="l641"><span class="linenum"> 641</span></a>          <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a> = <a class="function" onClick="logFunction('trailing_slash')" href="../../../../_functions/trailing_slash.html" onMouseOver="funcPopup(event,'trailing_slash')">trailing_slash</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a> );
<a name="l642"><span class="linenum"> 642</span></a>  
<a name="l643"><span class="linenum"> 643</span></a>          if( <a class="var it1314" onMouseOver="hilite(1314)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../../_variables/dir.html">$dir</a> = @<a class="phpfunction" onClick="logFunction('opendir')" href="../../../../_functions/opendir.html" onMouseOver="phpfuncPopup(event,'opendir')">opendir</a>(<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a>) )
<a name="l644"><span class="linenum"> 644</span></a>          {
<a name="l645"><span class="linenum"> 645</span></a>              while( ( <a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../_variables/file.html">$file</a> = readdir(<a class="var it1314" onMouseOver="hilite(1314)" onMouseOut="lolite()" onClick="logVariable('dir')" href="../../../../_variables/dir.html">$dir</a>) ) !== false )
<a name="l646"><span class="linenum"> 646</span></a>              {
<a name="l647"><span class="linenum"> 647</span></a>                  if( <a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../_variables/file.html">$file</a> == '.' || <a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../_variables/file.html">$file</a> == '..' )
<a name="l648"><span class="linenum"> 648</span></a>                  {
<a name="l649"><span class="linenum"> 649</span></a>                      continue;
<a name="l650"><span class="linenum"> 650</span></a>                  }
<a name="l651"><span class="linenum"> 651</span></a>                  <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a> = <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a>.<a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../_variables/file.html">$file</a>;
<a name="l652"><span class="linenum"> 652</span></a>                  if( <a class="phpfunction" onClick="logFunction('is_dir')" href="../../../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>(<a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a>) )
<a name="l653"><span class="linenum"> 653</span></a>                  {
<a name="l654"><span class="linenum"> 654</span></a>                      <a class="class" onClick="logClass('PageCache')" href="../../../../_classes/pagecache.html" onMouseOver="classPopup(event,'pagecache')">PageCache</a>::<a class="function" onClick="logFunction('deleteDirContent')" href="../../../../_functions/deletedircontent.html" onMouseOver="funcPopup(event,'deletedircontent')">deleteDirContent</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a>, <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> );
<a name="l655"><span class="linenum"> 655</span></a>                  }
<a name="l656"><span class="linenum"> 656</span></a>                  else
<a name="l657"><span class="linenum"> 657</span></a>                  {
<a name="l658"><span class="linenum"> 658</span></a>                      if( <a class="class" onClick="logClass('PageCache')" href="../../../../_classes/pagecache.html" onMouseOver="classPopup(event,'pagecache')">PageCache</a>::<a class="function" onClick="logFunction('checkDelete')" href="../../../../_functions/checkdelete.html" onMouseOver="funcPopup(event,'checkdelete')">checkDelete</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a> ) )
<a name="l659"><span class="linenum"> 659</span></a>                      {
<a name="l660"><span class="linenum"> 660</span></a>                          if( ( ! @<a class="phpfunction" onClick="logFunction('unlink')" href="../../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../../../_variables/file_path.html">$file_path</a> ) ) &amp;&amp; (<a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> == '') )
<a name="l661"><span class="linenum"> 661</span></a>                          { // deleting the file failed: return error
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">                            //$error = error_get_last(); // XXX: requires PHP 5.2</span>
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment">                            //$error['message'];</span>
<a name="l664"><span class="linenum"> 664</span></a>                              <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Some files could not be deleted (including: %s).'), <a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('file')" href="../../../../_variables/file.html">$file</a>);
<a name="l665"><span class="linenum"> 665</span></a>                          }
<a name="l666"><span class="linenum"> 666</span></a>                      }
<a name="l667"><span class="linenum"> 667</span></a>                  }
<a name="l668"><span class="linenum"> 668</span></a>              }
<a name="l669"><span class="linenum"> 669</span></a>          }
<a name="l670"><span class="linenum"> 670</span></a>          else
<a name="l671"><span class="linenum"> 671</span></a>          {
<a name="l672"><span class="linenum"> 672</span></a>              if( <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> == '' )
<a name="l673"><span class="linenum"> 673</span></a>              {
<a name="l674"><span class="linenum"> 674</span></a>                  <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Can not access directory: %s.'), <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a> );;
<a name="l675"><span class="linenum"> 675</span></a>              }
<a name="l676"><span class="linenum"> 676</span></a>          }
<a name="l677"><span class="linenum"> 677</span></a>      }
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>  
<a name="l680"><span class="linenum"> 680</span></a>      <span class="comment">/**</span>
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">     * Delete any file that is older than 24 hours from the whole /cache folder (recursively)</span>
<a name="l682"><span class="linenum"> 682</span></a>  <span class="comment">     * except index.html files and hiddenfiles (starting with .)</span>
<a name="l683"><span class="linenum"> 683</span></a>  <span class="comment">     *</span>
<a name="l684"><span class="linenum"> 684</span></a>  <span class="comment">     * @static</span>
<a name="l685"><span class="linenum"> 685</span></a>  <span class="comment">     *</span>
<a name="l686"><span class="linenum"> 686</span></a>  <span class="comment">     * @return string empty string on success, error message otherwise.</span>
<a name="l687"><span class="linenum"> 687</span></a>  <span class="comment">     */</span>
<a name="l688"><span class="linenum"> 688</span></a>  	function <a class="function" onClick="logFunction('prune_page_cache')" href="../../../../_functions/prune_page_cache.html" onMouseOver="funcPopup(event,'prune_page_cache')">prune_page_cache</a>()
<a name="l689"><span class="linenum"> 689</span></a>      {
<a name="l690"><span class="linenum"> 690</span></a>          global <a class="var it5059" onMouseOver="hilite(5059)" onMouseOut="lolite()" onClick="logVariable('cache_path')" href="../../../../_variables/cache_path.html">$cache_path</a>;
<a name="l691"><span class="linenum"> 691</span></a>  
<a name="l692"><span class="linenum"> 692</span></a>          <a class="function" onClick="logFunction('load_funcs')" href="../../../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( 'tools/model/_system.funcs.php' );
<a name="l693"><span class="linenum"> 693</span></a>  <span class="comment">        // check and try to repair cache folders</span>
<a name="l694"><span class="linenum"> 694</span></a>          <a class="function" onClick="logFunction('system_check_caches')" href="../../../../_functions/system_check_caches.html" onMouseOver="funcPopup(event,'system_check_caches')">system_check_caches</a>();
<a name="l695"><span class="linenum"> 695</span></a>  
<a name="l696"><span class="linenum"> 696</span></a>          <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a> = <a class="function" onClick="logFunction('trailing_slash')" href="../../../../_functions/trailing_slash.html" onMouseOver="funcPopup(event,'trailing_slash')">trailing_slash</a>( <a class="var it5059" onMouseOver="hilite(5059)" onMouseOut="lolite()" onClick="logVariable('cache_path')" href="../../../../_variables/cache_path.html">$cache_path</a> );
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>          <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> = '';
<a name="l699"><span class="linenum"> 699</span></a>          <a class="class" onClick="logClass('PageCache')" href="../../../../_classes/pagecache.html" onMouseOver="classPopup(event,'pagecache')">PageCache</a>::<a class="function" onClick="logFunction('deleteDirContent')" href="../../../../_functions/deletedircontent.html" onMouseOver="funcPopup(event,'deletedircontent')">deleteDirContent</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../../../_variables/path.html">$path</a>, <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a> );
<a name="l700"><span class="linenum"> 700</span></a>  
<a name="l701"><span class="linenum"> 701</span></a>          return <a class="var it7325" onMouseOver="hilite(7325)" onMouseOut="lolite()" onClick="logVariable('first_error')" href="../../../../_variables/first_error.html">$first_error</a>;
<a name="l702"><span class="linenum"> 702</span></a>      }
<a name="l703"><span class="linenum"> 703</span></a>  }
<a name="l704"><span class="linenum"> 704</span></a>  
<a name="l705"><span class="linenum"> 705</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'set': ['set', 'Set param value ', [['blogs/inc/users/model','_userfield.class.php',243],['blogs/inc/generic/model','_genericordered.class.php',75],['blogs/inc/users/model','_group.class.php',204],['blogs/inc/items/model','_itemlight.class.php',1258],['blogs/inc/plugins/model','_pluginsettings.class.php',70],['blogs/inc/widgets/model','_widget.class.php',321],['blogs/inc/regional/model','_region.class.php',102],['blogs/inc/regional/model','_city.class.php',110],['blogs/inc/collections/model','_blog.class.php',1102],['blogs/inc/settings/model','_abstractsettings.class.php',446],['blogs/inc/plugins/model','_pluginusersettings.class.php',82],['blogs/inc/users/model','_user.class.php',1861],['blogs/inc/generic/model','_genericcategory.class.php',100],['blogs/inc/tools/model','_emailaddress.class.php',85],['blogs/inc/users/model','_usersettings.class.php',187],['blogs/inc/regional/model','_country.class.php',106],['blogs/inc/comments/model','_comment.class.php',315],['blogs/inc/users/model','_groupsettings.class.php',140],['blogs/inc/cron/model','_cronjob.class.php',79],['blogs/inc/items/model','_item.class.php',4497],['blogs/inc/files/model','_filetype.class.php',149],['blogs/inc/users/model','_userfieldgroup.class.php',92],['blogs/inc/sessions/model','_session.class.php',420],['blogs/plugins','_calendar.plugin.php',530],['blogs/inc/slugs/model','_slug.class.php',80],['blogs/inc/regional/model','_currency.class.php',96],['blogs/inc/messaging/model','_thread.class.php',185],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',614],['blogs/inc/regional/model','_subregion.class.php',119],['blogs/inc/antispam/model','_iprange.class.php',81],['blogs/inc/sessions/model','_goal.class.php',199]], 1121],
'trailing_slash': ['trailing_slash', 'Add a trailing slash, if none present ', [['blogs/inc/_core','_misc.funcs.php',5867]], 22],
'output_handler': ['output_handler', 'This is called every x bytes to provide real time output ', [['blogs/inc/_core/model','_pagecache.class.php',472],['blogs/inc/_core/model','_blockcache.class.php',199]], 0],
'header_nocache': ['header_nocache', 'Sends HTTP headers to avoid caching of the page at the browser level (at least without revalidating with the server to make sure whether the content has changed or not). ', [['blogs/inc/_core','_template.funcs.php',270]], 9],
'cleardir_r': ['cleardir_r', 'Clear contents of a directory, but do not delete the directory itself ', [['blogs/inc/files/model','_file.funcs.php',277]], 4],
'is_logged_in': ['is_logged_in', 'is_logged_in(-) ', [['blogs/inc/users/model','_user.funcs.php',60]], 190],
'pagecache': ['pagecache', 'Constructor ', [['blogs/inc/_core/model','_pagecache.class.php',76]], 11],
'checkdelete': ['checkdelete', 'Check if the file with the given file path should be removed during prune page cache ', [['blogs/inc/_core/model','_pagecache.class.php',596]], 1],
'header_etag': ['header_etag', 'This adds teh etag header ', [['blogs/inc/_core','_template.funcs.php',339]], 1],
'invalidate': ['invalidate', 'Invalidate a particular page from the cache ', [['blogs/inc/_core/model','_pagecache.class.php',164]], 1],
'pause': ['pause', 'Pauses a timer category. It may me resumed later on, see {@link resume()}. ', [['blogs/inc/_core/model','_timer.class.php',114]], 71],
'load_funcs': ['load_funcs', '', [['blogs/inc/_core','_misc.funcs.php',115]], 214],
'get': ['get', '', [['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',941],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',15011],['blogs/plugins/tinymce_plugin/tiny_mce/plugins/media/js','media.js',7],['blogs/inc/links/model','_linkowner.class.php',221],['blogs/inc/_core/model/db','_sql.class.php',64],['blogs/inc/plugins/model','_pluginsettings.class.php',58],['blogs/inc/collections/model','_blog.class.php',1822],['blogs/inc/settings/model','_generalsettings.class.php',383],['blogs/inc/settings/model','_abstractsettings.class.php',271],['blogs/inc/plugins/model','_pluginusersettings.class.php',58],['blogs/inc/users/model','_user.class.php',1126],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_gzip.js',38],['blogs/inc/users/model','_usersettings.class.php',151],['blogs/inc/comments/model','_comment.class.php',301],['blogs/inc/users/model','_groupsettings.class.php',124],['blogs/inc/cron/model','_cronjob.class.php',104],['blogs/inc/items/model','_item.class.php',5742],['blogs/inc/sessions/model','_session.class.php',397],['blogs/inc/links/model','_linkuser.class.php',141],['blogs/inc/links/model','_linkitem.class.php',155],['blogs/inc/slugs/model','_slug.class.php',68],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',574],['blogs/plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['blogs/inc/antispam/model','_iprange.class.php',69],['blogs/inc/links/model','_linkcomment.class.php',132],['blogs/inc/files/model','_file.class.php',532]], 2417],
'create_htaccess_deny': ['create_htaccess_deny', 'Create .htaccess and sample.htaccess files with deny rules in the folder ', [['blogs/inc/files/model','_file.funcs.php',2064]], 3],
'check': ['check', 'Toggles all checkboxes of the current form ', [['blogs/rsc/js','form_extensions.js',33],['blogs/inc/email_campaigns/model','_emailcampaign.class.php',220],['blogs/inc/xhtml_validator','_xhtml_validator.class.php',174],['blogs/inc/_core/model','_pagecache.class.php',220],['blogs/inc/_core/model','_blockcache.class.php',103]], 12],
'gen_filecache_path': ['gen_filecache_path', 'Generate path for caching $url. ', [['blogs/inc/_core/model','_pagecache.class.php',144]], 2],
'header_http_response': ['header_http_response', 'Update global $http_response_code and call function header() ', [['blogs/inc/_core','_misc.funcs.php',5835]], 16],
'dbupdate': ['dbupdate', 'Update the DB based on previously recorded changes ', [['blogs/inc/chapters/model','_chapter.class.php',317],['blogs/inc/collections/model','_collsettings.class.php',260],['blogs/inc/users/model','_group.class.php',470],['blogs/inc/widgets/model','_widget.class.php',757],['blogs/inc/collections/model','_blog.class.php',2327],['blogs/inc/settings/model','_abstractsettings.class.php',593],['blogs/inc/users/model','_user.class.php',2934],['blogs/inc/skins/model','_skin.class.php',348],['blogs/inc/comments/model','_comment.class.php',3470],['blogs/inc/users/model','_groupsettings.class.php',159],['blogs/inc/cron/model','_cronjob.class.php',207],['blogs/inc/items/model','_item.class.php',4867],['blogs/inc/slugs/model','_slug.class.php',265],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',129],['blogs/inc/files/model','_file.class.php',1739]], 266],
'set_setting': ['set_setting', 'Set a setting. ', [['blogs/inc/collections/model','_blog.class.php',2117],['blogs/inc/skins/model','_skin.class.php',624],['blogs/inc/items/model','_item.class.php',6249]], 202],
'system_check_caches': ['system_check_caches', '', [['blogs/inc/tools/model','_system.funcs.php',258]], 4],
'deletedircontent': ['deletedircontent', 'Delete those files from the given directory, which results true value on checkDelete function ', [['blogs/inc/_core/model','_pagecache.class.php',631]], 2],
'mkdir_r': ['mkdir_r', 'Create a directory recursively. ', [['blogs/inc/files/model','_file.funcs.php',926]], 15],
'resume': ['resume', 'Resumes the timer on a category. ', [['blogs/inc/_core/model','_timer.class.php',144]], 43],
'prune_page_cache': ['prune_page_cache', 'Delete any file that is older than 24 hours from the whole /cache folder (recursively) except index.html files and hiddenfiles (starting with .) ', [['blogs/inc/_core/model','_pagecache.class.php',680]], 1],
'end_collect': ['end_collect', 'End collecting output to be cached ', [['blogs/inc/_core/model','_pagecache.class.php',512],['blogs/inc/_core/model','_blockcache.class.php',246]], 3],
'cache_create': ['cache_create', '', [['blogs/inc/_core/model','_pagecache.class.php',186]], 2],
'add': ['add', 'Add object to cache, handling our own indices. ', [['blogs/inc/collections/model','_blogcache.class.php',69],['blogs/inc/users/model','_usercache.class.php',231],['blogs/inc/files/model','_filelist.class.php',392],['blogs/inc/_core/model','_log.class.php',124],['blogs/inc/_core/model','_log.class.php',593],['blogs/inc/files/model','_filetypecache.class.php',57],['blogs/inc/_ext/pclzip','pclzip.lib.php',455],['blogs/inc/_core/model/dataobjects','_dataobjectcache.class.php',356],['blogs/inc/users/model','_groupsettings.class.php',103],['blogs/inc/links/model','_linkcache.class.php',101],['blogs/inc/skins/model','_skincache.class.php',62],['blogs/inc/generic/model','_genericcategorycache.class.php',113],['blogs/inc/_core/model','_messages.class.php',121]], 2022],
'list': ['list', '', [['blogs/rsc/js/bootstrap','typeahead.bundle.js',156]], 95],
'get_setting': ['get_setting', 'Get a setting. ', [['blogs/inc/collections/model','_blog.class.php',2021],['blogs/inc/skins/model','_skin.class.php',553],['blogs/inc/items/model','_item.class.php',6236]], 640],
'retrieve': ['retrieve', 'Retrieve and output cache for current URL. ', [['blogs/inc/_core/model','_pagecache.class.php',291],['blogs/inc/_core/model','_blockcache.class.php',149]], 2],
'gen_current_page_etag': ['gen_current_page_etag', 'Generate an etag to identify the version of the current page. We use this primarily to make a difference between the same page that has been generated for anonymous users and a version that has been generated for a specific user. ', [['blogs/inc/_core','_template.funcs.php',305]], 2],
't_': ['t_', 'TRANSLATE! ', [['blogs/inc/locales','_locale.funcs.php',48],['blogs/inc/locales','_locale.funcs.php',240],['blogs/inc/skins/model','_skin.class.php',672],['blogs/inc/_core/model','_module.class.php',79],['blogs/rsc/js','blog_widgets.js',422],['blogs/inc/plugins','_plugin.class.php',2617]], 10201],
'get_af_filecache_path': ['get_af_filecache_path', 'Get path to file for current URL ', [['blogs/inc/_core/model','_pagecache.class.php',120]], 2],
'cache_delete': ['cache_delete', 'Delete all cache files ', [['blogs/inc/_core/model','_pagecache.class.php',211]], 5],
'abort_collect': ['abort_collect', 'We are going to output personal data and we want to abort collecting the data for the cache. ', [['blogs/inc/_core/model','_pagecache.class.php',482],['blogs/inc/_core/model','_blockcache.class.php',225]], 11],
'rmdir_r': ['rmdir_r', 'Deletes a dir recursively, wiping out all subdirectories!! ', [['blogs/inc/files/model','_file.funcs.php',251]], 34],
'opendir': ['opendir', '', [], 13],
'is_null': ['is_null', '', [], 251],
'floor': ['floor', '', [], 79],
'trim': ['trim', '', [], 351],
'explode': ['explode', '', [], 249],
'substr': ['substr', '', [], 657],
'strtotime': ['strtotime', '', [], 31],
'array_key_exists': ['array_key_exists', '', [], 36],
'file': ['file', '', [], 70],
'is_dir': ['is_dir', '', [], 85],
'unlink': ['unlink', '', [], 59],
'fclose': ['fclose', '', [], 96],
'header': ['header', '', [], 85],
'filemtime': ['filemtime', '', [], 10],
'strpos': ['strpos', '', [], 280],
'preg_replace': ['preg_replace', '', [], 281],
'count': ['count', '', [], 754],
'defined': ['defined', '', [], 874],
'fwrite': ['fwrite', '', [], 67],
'implode': ['implode', '', [], 456],
'ob_end_flush': ['ob_end_flush', '', [], 10],
'ob_end_clean': ['ob_end_clean', '', [], 12],
'basename': ['basename', '', [], 22],
'rename': ['rename', '', [], 25],
'ob_start': ['ob_start', '', [], 28]};
CLASS_DATA={
'pagecache': ['pagecache', 'Page Cache. ', [['blogs/inc/_core/model','_pagecache.class.php',31]], 15],
'file': ['file', 'Represents a file or folder on disk. Optionnaly stores meta data from DB. ', [['blogs/inc/files/model','_file.class.php',44]], 78]};
CONST_DATA={
'EVO_MAIN_INIT': ['EVO_MAIN_INIT', '', [['blogs/inc','_main.inc.php',55],['blogs/install','index.php',25],['blogs/install','debug.php',22]], 827]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Jul  5 12:18:44 2014</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
