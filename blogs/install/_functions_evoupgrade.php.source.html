<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /blogs/install/_functions_evoupgrade.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Jul  5 12:18:44 2014 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='blogs/install';
filename='_functions_evoupgrade.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/blogs/install/</a> -> <a href="_functions_evoupgrade.php.html">_functions_evoupgrade.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="_functions_evoupgrade.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="_functions_evoupgrade.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This file implements upgrading of DB tables</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * b2evolution - {@link http://b2evolution.net/}</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * Released under GNU GPL License - {@link http://b2evolution.net/about/license.html}</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * @copyright (c)2003-2014 by Francois Planque - {@link http://fplanque.com/}</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> *</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * {@internal Open Source relicensing agreement:</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> * Daniel HAHLER grants Francois PLANQUE the right to license</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * Daniel HAHLER's contributions to this file and the b2evolution project</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> * under any OSI approved OSS license (http://www.opensource.org/licenses/).</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * }}</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> *</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> * @package install</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment"> *</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> * @version $Id: _functions_evoupgrade.php 6712 2014-05-19 04:48:44Z yura $</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> */</span>
<a name="l19"><span class="linenum">  19</span></a>  if( !<a class="phpfunction" onClick="logFunction('defined')" href="../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('EVO_MAIN_INIT')" href="../../_constants/EVO_MAIN_INIT.html" onMouseOver="constPopup(event,'EVO_MAIN_INIT')">EVO_MAIN_INIT</a>') ) die( 'Please, do not access this page directly.' );
<a name="l20"><span class="linenum">  20</span></a>  
<a name="l21"><span class="linenum">  21</span></a>  <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('_core/_param.funcs.php');
<a name="l22"><span class="linenum">  22</span></a>  
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment">/**</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * Create a DB version checkpoint</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> *</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * This is useful when the next operation might timeout or fail!</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * The checkpoint will allow to restart the script and continue where it stopped</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> *</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @param string version of DB at checkpoint</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> */</span>
<a name="l32"><span class="linenum">  32</span></a>  function <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a> )
<a name="l33"><span class="linenum">  33</span></a>  {
<a name="l34"><span class="linenum">  34</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it3765" onMouseOver="hilite(3765)" onMouseOut="lolite()" onClick="logVariable('script_start_time')" href="../../_variables/script_start_time.html">$script_start_time</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('locale')" href="../../_variables/locale.html">$locale</a>, <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>;
<a name="l35"><span class="linenum">  35</span></a>  
<a name="l36"><span class="linenum">  36</span></a>      global <a class="var it5979" onMouseOver="hilite(5979)" onMouseOut="lolite()" onClick="logVariable('recreate_autogenerated_excerpts')" href="../../_variables/recreate_autogenerated_excerpts.html">$recreate_autogenerated_excerpts</a>;
<a name="l37"><span class="linenum">  37</span></a>  
<a name="l38"><span class="linenum">  38</span></a>      echo &quot;Creating DB schema version checkpoint at <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a>... &quot;;
<a name="l39"><span class="linenum">  39</span></a>  
<a name="l40"><span class="linenum">  40</span></a>      if( <a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a> &lt; 8060 )
<a name="l41"><span class="linenum">  41</span></a>      {
<a name="l42"><span class="linenum">  42</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = 'UPDATE T_settings SET db_version = '.<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a>;
<a name="l43"><span class="linenum">  43</span></a>      }
<a name="l44"><span class="linenum">  44</span></a>      else
<a name="l45"><span class="linenum">  45</span></a>      {
<a name="l46"><span class="linenum">  46</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE T_settings
<a name="l47"><span class="linenum">  47</span></a>                                  SET set_value = '<a class="var it249" onMouseOver="hilite(249)" onMouseOut="lolite()" onClick="logVariable('version')" href="../../_variables/version.html">$version</a>'
<a name="l48"><span class="linenum">  48</span></a>                                  WHERE set_name = 'db_version'&quot;;
<a name="l49"><span class="linenum">  49</span></a>      }
<a name="l50"><span class="linenum">  50</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l51"><span class="linenum">  51</span></a>  
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>      <a class="var it5980" onMouseOver="hilite(5980)" onMouseOut="lolite()" onClick="logVariable('elapsed_time')" href="../../_variables/elapsed_time.html">$elapsed_time</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it3765" onMouseOver="hilite(3765)" onMouseOut="lolite()" onClick="logVariable('script_start_time')" href="../../_variables/script_start_time.html">$script_start_time</a>;
<a name="l54"><span class="linenum">  54</span></a>  
<a name="l55"><span class="linenum">  55</span></a>      echo &quot;OK. (Elapsed upgrade time: <a class="var it5980" onMouseOver="hilite(5980)" onMouseOut="lolite()" onClick="logVariable('elapsed_time')" href="../../_variables/elapsed_time.html">$elapsed_time</a> seconds)&lt;br /&gt;\n&quot;;
<a name="l56"><span class="linenum">  56</span></a>      <a class="function" onClick="logFunction('evo_flush')" href="../../_functions/evo_flush.html" onMouseOver="funcPopup(event,'evo_flush')">evo_flush</a>();
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>      <a class="var it5981" onMouseOver="hilite(5981)" onMouseOut="lolite()" onClick="logVariable('max_exe_time')" href="../../_variables/max_exe_time.html">$max_exe_time</a> = <a class="phpfunction" onClick="logFunction('ini_get')" href="../../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>( 'max_execution_time' );
<a name="l59"><span class="linenum">  59</span></a>      if( <a class="var it5981" onMouseOver="hilite(5981)" onMouseOut="lolite()" onClick="logVariable('max_exe_time')" href="../../_variables/max_exe_time.html">$max_exe_time</a> &amp;&amp; ( <a class="var it5980" onMouseOver="hilite(5980)" onMouseOut="lolite()" onClick="logVariable('elapsed_time')" href="../../_variables/elapsed_time.html">$elapsed_time</a> &gt; ( <a class="var it5981" onMouseOver="hilite(5981)" onMouseOut="lolite()" onClick="logVariable('max_exe_time')" href="../../_variables/max_exe_time.html">$max_exe_time</a> - 20 ) ) )
<a name="l60"><span class="linenum">  60</span></a>      { // Max exe time not disabled and we're recahing the end
<a name="l61"><span class="linenum">  61</span></a>          <a class="var it5982" onMouseOver="hilite(5982)" onMouseOut="lolite()" onClick="logVariable('upgrade_action')" href="../../_variables/upgrade_action.html">$upgrade_action</a> = ( ( <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> == 'svn_upgrade' ) || ( <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> == 'auto_upgrade' ) ) ? <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> : 'evoupgrade';
<a name="l62"><span class="linenum">  62</span></a>          <a class="var it5983" onMouseOver="hilite(5983)" onMouseOut="lolite()" onClick="logVariable('recreate_excerpts')" href="../../_variables/recreate_excerpts.html">$recreate_excerpts</a> = <a class="var it5979" onMouseOver="hilite(5979)" onMouseOut="lolite()" onClick="logVariable('recreate_autogenerated_excerpts')" href="../../_variables/recreate_autogenerated_excerpts.html">$recreate_autogenerated_excerpts</a> ? '&amp;amp;recreate_excerpts=1' : '';
<a name="l63"><span class="linenum">  63</span></a>          echo 'We are reaching the time limit for this script. Please click &lt;a href=&quot;index.php?locale='.<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('locale')" href="../../_variables/locale.html">$locale</a>.'&amp;amp;action='.<a class="var it5982" onMouseOver="hilite(5982)" onMouseOut="lolite()" onClick="logVariable('upgrade_action')" href="../../_variables/upgrade_action.html">$upgrade_action</a>.<a class="var it5983" onMouseOver="hilite(5983)" onMouseOut="lolite()" onClick="logVariable('recreate_excerpts')" href="../../_variables/recreate_excerpts.html">$recreate_excerpts</a>.'&quot;&gt;continue&lt;/a&gt;...';
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">        // Dirty temporary solution:</span>
<a name="l65"><span class="linenum">  65</span></a>          exit(0);
<a name="l66"><span class="linenum">  66</span></a>      }
<a name="l67"><span class="linenum">  67</span></a>  }
<a name="l68"><span class="linenum">  68</span></a>  
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">/**</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment"> * @return boolean Does a given index key name exist in DB?</span>
<a name="l72"><span class="linenum">  72</span></a>  <span class="comment"> */</span>
<a name="l73"><span class="linenum">  73</span></a>  function <a class="function" onClick="logFunction('db_index_exists')" href="../../_functions/db_index_exists.html" onMouseOver="funcPopup(event,'db_index_exists')">db_index_exists</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it4948" onMouseOver="hilite(4948)" onMouseOut="lolite()" onClick="logVariable('index_name')" href="../../_variables/index_name.html">$index_name</a> )
<a name="l74"><span class="linenum">  74</span></a>  {
<a name="l75"><span class="linenum">  75</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l76"><span class="linenum">  76</span></a>  
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it4948" onMouseOver="hilite(4948)" onMouseOut="lolite()" onClick="logVariable('index_name')" href="../../_variables/index_name.html">$index_name</a> = <a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it4948" onMouseOver="hilite(4948)" onMouseOut="lolite()" onClick="logVariable('index_name')" href="../../_variables/index_name.html">$index_name</a>);
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>('SHOW INDEX FROM '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>);
<a name="l80"><span class="linenum">  80</span></a>      while( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>() )
<a name="l81"><span class="linenum">  81</span></a>      {
<a name="l82"><span class="linenum">  82</span></a>          if( <a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('Key_name')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/Key_name.html">Key_name</a>) == <a class="var it4948" onMouseOver="hilite(4948)" onMouseOut="lolite()" onClick="logVariable('index_name')" href="../../_variables/index_name.html">$index_name</a> )
<a name="l83"><span class="linenum">  83</span></a>          {
<a name="l84"><span class="linenum">  84</span></a>              return true;
<a name="l85"><span class="linenum">  85</span></a>          }
<a name="l86"><span class="linenum">  86</span></a>      }
<a name="l87"><span class="linenum">  87</span></a>  
<a name="l88"><span class="linenum">  88</span></a>      return false;
<a name="l89"><span class="linenum">  89</span></a>  }
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">/**</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment"> * @param string Table name</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment"> * @param array Column names</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment"> * @return boolean Does a list of given column names exist in DB?</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment"> */</span>
<a name="l97"><span class="linenum">  97</span></a>  function <a class="function" onClick="logFunction('db_cols_exist')" href="../../_functions/db_cols_exist.html" onMouseOver="funcPopup(event,'db_cols_exist')">db_cols_exist</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it5984" onMouseOver="hilite(5984)" onMouseOut="lolite()" onClick="logVariable('col_names')" href="../../_variables/col_names.html">$col_names</a> )
<a name="l98"><span class="linenum">  98</span></a>  {
<a name="l99"><span class="linenum">  99</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>      foreach( <a class="var it5984" onMouseOver="hilite(5984)" onMouseOut="lolite()" onClick="logVariable('col_names')" href="../../_variables/col_names.html">$col_names</a> as <a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('k')" href="../../_variables/k.html">$k</a> =&gt; <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a> )
<a name="l102"><span class="linenum"> 102</span></a>          <a class="var it5984" onMouseOver="hilite(5984)" onMouseOut="lolite()" onClick="logVariable('col_names')" href="../../_variables/col_names.html">$col_names</a>[<a class="var it395" onMouseOver="hilite(395)" onMouseOut="lolite()" onClick="logVariable('k')" href="../../_variables/k.html">$k</a>] = <a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>);
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>      foreach( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>('SHOW COLUMNS FROM '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>) as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l105"><span class="linenum"> 105</span></a>          if( (<a class="var it963" onMouseOver="hilite(963)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a> = <a class="phpfunction" onClick="logFunction('array_search')" href="../../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>(<a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('Field')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/Field.html">Field</a>), <a class="var it5984" onMouseOver="hilite(5984)" onMouseOut="lolite()" onClick="logVariable('col_names')" href="../../_variables/col_names.html">$col_names</a>)) !== false )
<a name="l106"><span class="linenum"> 106</span></a>              unset( <a class="var it5984" onMouseOver="hilite(5984)" onMouseOut="lolite()" onClick="logVariable('col_names')" href="../../_variables/col_names.html">$col_names</a>[<a class="var it963" onMouseOver="hilite(963)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../_variables/key.html">$key</a>] );
<a name="l107"><span class="linenum"> 107</span></a>  
<a name="l108"><span class="linenum"> 108</span></a>      return <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it5984" onMouseOver="hilite(5984)" onMouseOut="lolite()" onClick="logVariable('col_names')" href="../../_variables/col_names.html">$col_names</a>) == 0;
<a name="l109"><span class="linenum"> 109</span></a>  }
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>  <span class="comment">/**</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment"> * Drops a column, if it exists.</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment"> */</span>
<a name="l114"><span class="linenum"> 114</span></a>  function <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it5985" onMouseOver="hilite(5985)" onMouseOut="lolite()" onClick="logVariable('col_name')" href="../../_variables/col_name.html">$col_name</a> )
<a name="l115"><span class="linenum"> 115</span></a>  {
<a name="l116"><span class="linenum"> 116</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l117"><span class="linenum"> 117</span></a>  
<a name="l118"><span class="linenum"> 118</span></a>      if( ! <a class="function" onClick="logFunction('db_col_exists')" href="../../_functions/db_col_exists.html" onMouseOver="funcPopup(event,'db_col_exists')">db_col_exists</a>(<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it5985" onMouseOver="hilite(5985)" onMouseOut="lolite()" onClick="logVariable('col_name')" href="../../_variables/col_name.html">$col_name</a>) )
<a name="l119"><span class="linenum"> 119</span></a>          return false;
<a name="l120"><span class="linenum"> 120</span></a>  
<a name="l121"><span class="linenum"> 121</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>.' DROP COLUMN '.<a class="var it5985" onMouseOver="hilite(5985)" onMouseOut="lolite()" onClick="logVariable('col_name')" href="../../_variables/col_name.html">$col_name</a> );
<a name="l122"><span class="linenum"> 122</span></a>  }
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment">/**</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment"> * Add a column, if it does not already exist.</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment"> * If it exists already, a &quot;ALTER TABLE&quot; statement will get executed instead.</span>
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment"> *</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment"> * @return boolean True if the column has been added, False if not.</span>
<a name="l129"><span class="linenum"> 129</span></a>  <span class="comment"> */</span>
<a name="l130"><span class="linenum"> 130</span></a>  function <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it5985" onMouseOver="hilite(5985)" onMouseOut="lolite()" onClick="logVariable('col_name')" href="../../_variables/col_name.html">$col_name</a>, <a class="var it5986" onMouseOver="hilite(5986)" onMouseOut="lolite()" onClick="logVariable('col_desc')" href="../../_variables/col_desc.html">$col_desc</a> )
<a name="l131"><span class="linenum"> 131</span></a>  {
<a name="l132"><span class="linenum"> 132</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l133"><span class="linenum"> 133</span></a>  
<a name="l134"><span class="linenum"> 134</span></a>      if( <a class="function" onClick="logFunction('db_col_exists')" href="../../_functions/db_col_exists.html" onMouseOver="funcPopup(event,'db_col_exists')">db_col_exists</a>(<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it5985" onMouseOver="hilite(5985)" onMouseOut="lolite()" onClick="logVariable('col_name')" href="../../_variables/col_name.html">$col_name</a>) )
<a name="l135"><span class="linenum"> 135</span></a>      { // Column exists already, make sure it's the same.
<a name="l136"><span class="linenum"> 136</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>.' MODIFY COLUMN '.<a class="var it5985" onMouseOver="hilite(5985)" onMouseOut="lolite()" onClick="logVariable('col_name')" href="../../_variables/col_name.html">$col_name</a>.' '.<a class="var it5986" onMouseOver="hilite(5986)" onMouseOut="lolite()" onClick="logVariable('col_desc')" href="../../_variables/col_desc.html">$col_desc</a> );
<a name="l137"><span class="linenum"> 137</span></a>          return false;
<a name="l138"><span class="linenum"> 138</span></a>      }
<a name="l139"><span class="linenum"> 139</span></a>  
<a name="l140"><span class="linenum"> 140</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>.' ADD COLUMN '.<a class="var it5985" onMouseOver="hilite(5985)" onMouseOut="lolite()" onClick="logVariable('col_name')" href="../../_variables/col_name.html">$col_name</a>.' '.<a class="var it5986" onMouseOver="hilite(5986)" onMouseOut="lolite()" onClick="logVariable('col_desc')" href="../../_variables/col_desc.html">$col_desc</a> );
<a name="l141"><span class="linenum"> 141</span></a>  }
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">/**</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment"> * Add an INDEX. If another index with the same name already exists, it will</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment"> * get dropped before.</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment"> */</span>
<a name="l148"><span class="linenum"> 148</span></a>  function <a class="function" onClick="logFunction('db_add_index')" href="../../_functions/db_add_index.html" onMouseOver="funcPopup(event,'db_add_index')">db_add_index</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it134" onMouseOver="hilite(134)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>, <a class="var it4160" onMouseOver="hilite(4160)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../_variables/def.html">$def</a>, <a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a> = 'INDEX' )
<a name="l149"><span class="linenum"> 149</span></a>  {
<a name="l150"><span class="linenum"> 150</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l151"><span class="linenum"> 151</span></a>      if( <a class="function" onClick="logFunction('db_index_exists')" href="../../_functions/db_index_exists.html" onMouseOver="funcPopup(event,'db_index_exists')">db_index_exists</a>(<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it134" onMouseOver="hilite(134)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>) )
<a name="l152"><span class="linenum"> 152</span></a>      {
<a name="l153"><span class="linenum"> 153</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>.' DROP INDEX '.<a class="var it134" onMouseOver="hilite(134)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a> );
<a name="l154"><span class="linenum"> 154</span></a>      }
<a name="l155"><span class="linenum"> 155</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>.' ADD '.<a class="var it49" onMouseOver="hilite(49)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../_variables/type.html">$type</a>.' '.<a class="var it134" onMouseOver="hilite(134)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../_variables/name.html">$name</a>.' ('.<a class="var it4160" onMouseOver="hilite(4160)" onMouseOut="lolite()" onClick="logVariable('def')" href="../../_variables/def.html">$def</a>.')' );
<a name="l156"><span class="linenum"> 156</span></a>  }
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>  
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">/**</span>
<a name="l160"><span class="linenum"> 160</span></a>  <span class="comment"> * Check if a key item value already exists on database</span>
<a name="l161"><span class="linenum"> 161</span></a>  <span class="comment"> */</span>
<a name="l162"><span class="linenum"> 162</span></a>  function <a class="function" onClick="logFunction('db_key_exists')" href="../../_functions/db_key_exists.html" onMouseOver="funcPopup(event,'db_key_exists')">db_key_exists</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>, <a class="var it1278" onMouseOver="hilite(1278)" onMouseOut="lolite()" onClick="logVariable('field_value')" href="../../_variables/field_value.html">$field_value</a> )
<a name="l163"><span class="linenum"> 163</span></a>  {
<a name="l164"><span class="linenum"> 164</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l165"><span class="linenum"> 165</span></a>      return <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( '
<a name="l166"><span class="linenum"> 166</span></a>          SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>('.<a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>.')
<a name="l167"><span class="linenum"> 167</span></a>          FROM '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>.'
<a name="l168"><span class="linenum"> 168</span></a>          WHERE '.<a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>.' = '.<a class="var it1278" onMouseOver="hilite(1278)" onMouseOut="lolite()" onClick="logVariable('field_value')" href="../../_variables/field_value.html">$field_value</a> );
<a name="l169"><span class="linenum"> 169</span></a>  }
<a name="l170"><span class="linenum"> 170</span></a>  
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">/**</span>
<a name="l172"><span class="linenum"> 172</span></a>  <span class="comment"> * Add a Foreign Key constraint.</span>
<a name="l173"><span class="linenum"> 173</span></a>  <span class="comment"> * If another foreign key exists between these two fields then the old FK will be deleted and a new will be created.</span>
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment"> * If the table engine is not InnoDB, then it will be changed automatically.</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment"> * If the FK table contains data which would prevent foreign key creation then these records will be deleted.</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment"> *</span>
<a name="l177"><span class="linenum"> 177</span></a>  <span class="comment"> * @param string foreign key table</span>
<a name="l178"><span class="linenum"> 178</span></a>  <span class="comment"> * @param string foreing key column name</span>
<a name="l179"><span class="linenum"> 179</span></a>  <span class="comment"> * @param string foreign key refrence table name</span>
<a name="l180"><span class="linenum"> 180</span></a>  <span class="comment"> * @param string reference column name in the reference table</span>
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment"> * @param string foreign key definition ( e.g. &quot;ON DELETE CASCADE&quot; or &quot;ON UPDATE RESTRICT&quot; )</span>
<a name="l182"><span class="linenum"> 182</span></a>  <span class="comment"> */</span>
<a name="l183"><span class="linenum"> 183</span></a>  function <a class="function" onClick="logFunction('db_add_foreign_key')" href="../../_functions/db_add_foreign_key.html" onMouseOver="funcPopup(event,'db_add_foreign_key')">db_add_foreign_key</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>, <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a>, <a class="var it5988" onMouseOver="hilite(5988)" onMouseOut="lolite()" onClick="logVariable('reference_field_name')" href="../../_variables/reference_field_name.html">$reference_field_name</a>, <a class="var it3868" onMouseOver="hilite(3868)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a> )
<a name="l184"><span class="linenum"> 184</span></a>  {
<a name="l185"><span class="linenum"> 185</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l186"><span class="linenum"> 186</span></a>      <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbaliases')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbaliases.html">dbaliases</a>, <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbreplaces')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbreplaces.html">dbreplaces</a>, <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> );
<a name="l187"><span class="linenum"> 187</span></a>      <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbaliases')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbaliases.html">dbaliases</a>, <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbreplaces')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbreplaces.html">dbreplaces</a>, <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a> );
<a name="l188"><span class="linenum"> 188</span></a>      <a class="var it4924" onMouseOver="hilite(4924)" onMouseOut="lolite()" onClick="logVariable('foreign_key_fields')" href="../../_variables/foreign_key_fields.html">$foreign_key_fields</a> = array( array(
<a name="l189"><span class="linenum"> 189</span></a>              'fk_fields' =&gt; <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>,
<a name="l190"><span class="linenum"> 190</span></a>              'reference_table' =&gt; <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a>,
<a name="l191"><span class="linenum"> 191</span></a>              'reference_columns' =&gt; <a class="var it5988" onMouseOver="hilite(5988)" onMouseOut="lolite()" onClick="logVariable('reference_field_name')" href="../../_variables/reference_field_name.html">$reference_field_name</a>,
<a name="l192"><span class="linenum"> 192</span></a>              'fk_definition' =&gt; <a class="var it3868" onMouseOver="hilite(3868)" onMouseOut="lolite()" onClick="logVariable('definition')" href="../../_variables/definition.html">$definition</a>,
<a name="l193"><span class="linenum"> 193</span></a>              'create' =&gt; true, // This FK should be created if not exists
<a name="l194"><span class="linenum"> 194</span></a>          ) );
<a name="l195"><span class="linenum"> 195</span></a>      <a class="function" onClick="logFunction('db_delta_foreign_keys')" href="../../_functions/db_delta_foreign_keys.html" onMouseOver="funcPopup(event,'db_delta_foreign_keys')">db_delta_foreign_keys</a>( <a class="var it4924" onMouseOver="hilite(4924)" onMouseOut="lolite()" onClick="logVariable('foreign_key_fields')" href="../../_variables/foreign_key_fields.html">$foreign_key_fields</a>, <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, true, 'add' );
<a name="l196"><span class="linenum"> 196</span></a>  }
<a name="l197"><span class="linenum"> 197</span></a>  
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment">/**</span>
<a name="l199"><span class="linenum"> 199</span></a>  <span class="comment"> * Drop a Foreign Key constraint.</span>
<a name="l200"><span class="linenum"> 200</span></a>  <span class="comment"> * If this foreign key not exists the function won't give error.</span>
<a name="l201"><span class="linenum"> 201</span></a>  <span class="comment"> *</span>
<a name="l202"><span class="linenum"> 202</span></a>  <span class="comment"> * @param string foreign key table</span>
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment"> * @param string foreing key column name</span>
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment"> * @param string foreign key refrence table name</span>
<a name="l205"><span class="linenum"> 205</span></a>  <span class="comment"> * @param string reference column name in the reference table</span>
<a name="l206"><span class="linenum"> 206</span></a>  <span class="comment"> */</span>
<a name="l207"><span class="linenum"> 207</span></a>  function <a class="function" onClick="logFunction('db_drop_foreign_key')" href="../../_functions/db_drop_foreign_key.html" onMouseOver="funcPopup(event,'db_drop_foreign_key')">db_drop_foreign_key</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>, <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a>, <a class="var it5988" onMouseOver="hilite(5988)" onMouseOut="lolite()" onClick="logVariable('reference_field_name')" href="../../_variables/reference_field_name.html">$reference_field_name</a> )
<a name="l208"><span class="linenum"> 208</span></a>  {
<a name="l209"><span class="linenum"> 209</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l210"><span class="linenum"> 210</span></a>      <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbaliases')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbaliases.html">dbaliases</a>, <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbreplaces')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbreplaces.html">dbreplaces</a>, <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> );
<a name="l211"><span class="linenum"> 211</span></a>      <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbaliases')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbaliases.html">dbaliases</a>, <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('dbreplaces')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/dbreplaces.html">dbreplaces</a>, <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a> );
<a name="l212"><span class="linenum"> 212</span></a>      <a class="var it4924" onMouseOver="hilite(4924)" onMouseOut="lolite()" onClick="logVariable('foreign_key_fields')" href="../../_variables/foreign_key_fields.html">$foreign_key_fields</a> = array( array(
<a name="l213"><span class="linenum"> 213</span></a>              'fk_fields' =&gt; <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>,
<a name="l214"><span class="linenum"> 214</span></a>              'reference_table' =&gt; <a class="var it5987" onMouseOver="hilite(5987)" onMouseOut="lolite()" onClick="logVariable('reference_table')" href="../../_variables/reference_table.html">$reference_table</a>,
<a name="l215"><span class="linenum"> 215</span></a>              'reference_columns' =&gt; <a class="var it5988" onMouseOver="hilite(5988)" onMouseOut="lolite()" onClick="logVariable('reference_field_name')" href="../../_variables/reference_field_name.html">$reference_field_name</a>,
<a name="l216"><span class="linenum"> 216</span></a>              'fk_definition' =&gt; '',
<a name="l217"><span class="linenum"> 217</span></a>              'create' =&gt; false, // This FK shouldn't be created if not exists
<a name="l218"><span class="linenum"> 218</span></a>          ) );
<a name="l219"><span class="linenum"> 219</span></a>      <a class="function" onClick="logFunction('db_delta_foreign_keys')" href="../../_functions/db_delta_foreign_keys.html" onMouseOver="funcPopup(event,'db_delta_foreign_keys')">db_delta_foreign_keys</a>( <a class="var it4924" onMouseOver="hilite(4924)" onMouseOut="lolite()" onClick="logVariable('foreign_key_fields')" href="../../_variables/foreign_key_fields.html">$foreign_key_fields</a>, <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, true, 'drop' );
<a name="l220"><span class="linenum"> 220</span></a>  }
<a name="l221"><span class="linenum"> 221</span></a>  
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">/**</span>
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment"> * Converts languages in a given table into according locales</span>
<a name="l224"><span class="linenum"> 224</span></a>  <span class="comment"> *</span>
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment"> * @param string name of the table</span>
<a name="l226"><span class="linenum"> 226</span></a>  <span class="comment"> * @param string name of the column where lang is stored</span>
<a name="l227"><span class="linenum"> 227</span></a>  <span class="comment"> * @param string name of the table's ID column</span>
<a name="l228"><span class="linenum"> 228</span></a>  <span class="comment"> */</span>
<a name="l229"><span class="linenum"> 229</span></a>  function <a class="function" onClick="logFunction('convert_lang_to_locale')" href="../../_functions/convert_lang_to_locale.html" onMouseOver="funcPopup(event,'convert_lang_to_locale')">convert_lang_to_locale</a>( <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>, <a class="var it5989" onMouseOver="hilite(5989)" onMouseOut="lolite()" onClick="logVariable('columnlang')" href="../../_variables/columnlang.html">$columnlang</a>, <a class="var it5990" onMouseOver="hilite(5990)" onMouseOut="lolite()" onClick="logVariable('columnID')" href="../../_variables/columnID.html">$columnID</a> )
<a name="l230"><span class="linenum"> 230</span></a>  {
<a name="l231"><span class="linenum"> 231</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>, <a class="var it1619" onMouseOver="hilite(1619)" onMouseOut="lolite()" onClick="logVariable('locales')" href="../../_variables/locales.html">$locales</a>, <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>;
<a name="l232"><span class="linenum"> 232</span></a>  
<a name="l233"><span class="linenum"> 233</span></a>      if( !<a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/[a-z]{2}-[A-Z]{2}(-.{1,14})?/', <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>) )
<a name="l234"><span class="linenum"> 234</span></a>      { // we want a valid locale
<a name="l235"><span class="linenum"> 235</span></a>          <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a> = 'en-EU';
<a name="l236"><span class="linenum"> 236</span></a>      }
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>      echo 'Converting langs to locales for '. <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>. '...&lt;br /&gt;';
<a name="l239"><span class="linenum"> 239</span></a>  
<a name="l240"><span class="linenum"> 240</span></a>  <span class="comment">    // query given languages in $table</span>
<a name="l241"><span class="linenum"> 241</span></a>      <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;SELECT <a class="var it5990" onMouseOver="hilite(5990)" onMouseOut="lolite()" onClick="logVariable('columnID')" href="../../_variables/columnID.html">$columnID</a>, <a class="var it5989" onMouseOver="hilite(5989)" onMouseOut="lolite()" onClick="logVariable('columnlang')" href="../../_variables/columnlang.html">$columnlang</a> FROM <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>&quot;;
<a name="l242"><span class="linenum"> 242</span></a>      <a class="var it5991" onMouseOver="hilite(5991)" onMouseOut="lolite()" onClick="logVariable('languagestoconvert')" href="../../_variables/languagestoconvert.html">$languagestoconvert</a> = array();
<a name="l243"><span class="linenum"> 243</span></a>      foreach( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="constant" onClick="logConstant('ARRAY_A')" href="../../_constants/ARRAY_A.html" onMouseOver="constPopup(event,'ARRAY_A')">ARRAY_A</a> ) as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l244"><span class="linenum"> 244</span></a>      {
<a name="l245"><span class="linenum"> 245</span></a>  <span class="comment">        // remember the ID for that locale</span>
<a name="l246"><span class="linenum"> 246</span></a>          <a class="var it5991" onMouseOver="hilite(5991)" onMouseOut="lolite()" onClick="logVariable('languagestoconvert')" href="../../_variables/languagestoconvert.html">$languagestoconvert</a>[ <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>[ <a class="var it5989" onMouseOver="hilite(5989)" onMouseOut="lolite()" onClick="logVariable('columnlang')" href="../../_variables/columnlang.html">$columnlang</a> ] ][] = <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>[ <a class="var it5990" onMouseOver="hilite(5990)" onMouseOut="lolite()" onClick="logVariable('columnID')" href="../../_variables/columnID.html">$columnID</a> ];
<a name="l247"><span class="linenum"> 247</span></a>      }
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>      foreach( <a class="var it5991" onMouseOver="hilite(5991)" onMouseOut="lolite()" onClick="logVariable('languagestoconvert')" href="../../_variables/languagestoconvert.html">$languagestoconvert</a> as <a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a> =&gt; <a class="var it5992" onMouseOver="hilite(5992)" onMouseOut="lolite()" onClick="logVariable('lIDs')" href="../../_variables/lIDs.html">$lIDs</a>)
<a name="l250"><span class="linenum"> 250</span></a>      { // converting the languages we've found
<a name="l251"><span class="linenum"> 251</span></a>          <a class="var it5993" onMouseOver="hilite(5993)" onMouseOut="lolite()" onClick="logVariable('converted')" href="../../_variables/converted.html">$converted</a> = false;
<a name="l252"><span class="linenum"> 252</span></a>          echo '&amp;nbsp; Converting lang \''. <a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a>. '\' '; <span class="comment">// (with IDs: '. implode( ', ', $lIDs ). ').. ';</span>
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>          if( <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('/[a-z]{2}-[A-Z]{2}(-.{1,14})?/', <a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a>) )
<a name="l255"><span class="linenum"> 255</span></a>          { // Already valid
<a name="l256"><span class="linenum"> 256</span></a>              echo 'nothing to update, already valid!&lt;br /&gt;';
<a name="l257"><span class="linenum"> 257</span></a>              continue;
<a name="l258"><span class="linenum"> 258</span></a>          }
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>          if( (strlen(<a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a>) == 2) &amp;&amp; ( <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>, 0, 2 ) != <a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a> ) )
<a name="l261"><span class="linenum"> 261</span></a>          { // we have an old two letter lang code to convert
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">            // and it doesn't match the default locale</span>
<a name="l263"><span class="linenum"> 263</span></a>              foreach( <a class="var it1619" onMouseOver="hilite(1619)" onMouseOut="lolite()" onClick="logVariable('locales')" href="../../_variables/locales.html">$locales</a> as <a class="var it5994" onMouseOver="hilite(5994)" onMouseOut="lolite()" onClick="logVariable('newlkey')" href="../../_variables/newlkey.html">$newlkey</a> =&gt; <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a> )
<a name="l264"><span class="linenum"> 264</span></a>              {  // loop given locales
<a name="l265"><span class="linenum"> 265</span></a>                  if( <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>(<a class="var it5994" onMouseOver="hilite(5994)" onMouseOut="lolite()" onClick="logVariable('newlkey')" href="../../_variables/newlkey.html">$newlkey</a>, 0, 2) == <a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a>) ) # TODO: check if valid/suitable
<a name="l266"><span class="linenum"> 266</span></a>                  {  // if language matches, update
<a name="l267"><span class="linenum"> 267</span></a>                      <a class="var it5993" onMouseOver="hilite(5993)" onMouseOut="lolite()" onClick="logVariable('converted')" href="../../_variables/converted.html">$converted</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l268"><span class="linenum"> 268</span></a>                          UPDATE <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>
<a name="l269"><span class="linenum"> 269</span></a>                             SET <a class="var it5989" onMouseOver="hilite(5989)" onMouseOut="lolite()" onClick="logVariable('columnlang')" href="../../_variables/columnlang.html">$columnlang</a> = '<a class="var it5994" onMouseOver="hilite(5994)" onMouseOut="lolite()" onClick="logVariable('newlkey')" href="../../_variables/newlkey.html">$newlkey</a>'
<a name="l270"><span class="linenum"> 270</span></a>                           WHERE <a class="var it5989" onMouseOver="hilite(5989)" onMouseOut="lolite()" onClick="logVariable('columnlang')" href="../../_variables/columnlang.html">$columnlang</a> = '<a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a>'&quot; );
<a name="l271"><span class="linenum"> 271</span></a>                      echo 'to locale \''. <a class="var it5994" onMouseOver="hilite(5994)" onMouseOut="lolite()" onClick="logVariable('newlkey')" href="../../_variables/newlkey.html">$newlkey</a>. '\'&lt;br /&gt;';
<a name="l272"><span class="linenum"> 272</span></a>                      break;
<a name="l273"><span class="linenum"> 273</span></a>                  }
<a name="l274"><span class="linenum"> 274</span></a>              }
<a name="l275"><span class="linenum"> 275</span></a>          }
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>          if( !<a class="var it5993" onMouseOver="hilite(5993)" onMouseOut="lolite()" onClick="logVariable('converted')" href="../../_variables/converted.html">$converted</a> )
<a name="l278"><span class="linenum"> 278</span></a>          { // we have nothing converted yet, setting default:
<a name="l279"><span class="linenum"> 279</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>
<a name="l280"><span class="linenum"> 280</span></a>                                              SET <a class="var it5989" onMouseOver="hilite(5989)" onMouseOut="lolite()" onClick="logVariable('columnlang')" href="../../_variables/columnlang.html">$columnlang</a> = '<a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>'
<a name="l281"><span class="linenum"> 281</span></a>                                          WHERE <a class="var it5989" onMouseOver="hilite(5989)" onMouseOut="lolite()" onClick="logVariable('columnlang')" href="../../_variables/columnlang.html">$columnlang</a> = '<a class="var it2800" onMouseOver="hilite(2800)" onMouseOut="lolite()" onClick="logVariable('lkey')" href="../../_variables/lkey.html">$lkey</a>'&quot; );
<a name="l282"><span class="linenum"> 282</span></a>              echo 'forced to default locale \''. <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>. '\'&lt;br /&gt;';
<a name="l283"><span class="linenum"> 283</span></a>          }
<a name="l284"><span class="linenum"> 284</span></a>      }
<a name="l285"><span class="linenum"> 285</span></a>      echo &quot;\n&quot;;
<a name="l286"><span class="linenum"> 286</span></a>  }  <span class="comment">// convert_lang_to_locale(-)</span>
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>  
<a name="l289"><span class="linenum"> 289</span></a>  <span class="comment">/**</span>
<a name="l290"><span class="linenum"> 290</span></a>  <span class="comment"> * upgrade_b2evo_tables(-)</span>
<a name="l291"><span class="linenum"> 291</span></a>  <span class="comment"> *</span>
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment"> * @param string the action param value corresponding the current upgrade process ( evoupgrade, svn_upgrade, auto_upgrade )</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment"> */</span>
<a name="l294"><span class="linenum"> 294</span></a>  function <a class="function" onClick="logFunction('upgrade_b2evo_tables')" href="../../_functions/upgrade_b2evo_tables.html" onMouseOver="funcPopup(event,'upgrade_b2evo_tables')">upgrade_b2evo_tables</a>( <a class="var it5982" onMouseOver="hilite(5982)" onMouseOut="lolite()" onClick="logVariable('upgrade_action')" href="../../_variables/upgrade_action.html">$upgrade_action</a> = 'evoupgrade' )
<a name="l295"><span class="linenum"> 295</span></a>  {
<a name="l296"><span class="linenum"> 296</span></a>      global <a class="var it1750" onMouseOver="hilite(1750)" onMouseOut="lolite()" onClick="logVariable('db_config')" href="../../_variables/db_config.html">$db_config</a>, <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>;
<a name="l297"><span class="linenum"> 297</span></a>      global <a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../_variables/baseurl.html">$baseurl</a>, <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a>, <a class="var it4135" onMouseOver="hilite(4135)" onMouseOut="lolite()" onClick="logVariable('new_db_version')" href="../../_variables/new_db_version.html">$new_db_version</a>;
<a name="l298"><span class="linenum"> 298</span></a>      global <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>, <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>, <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>, <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>;
<a name="l299"><span class="linenum"> 299</span></a>      global <a class="var it1619" onMouseOver="hilite(1619)" onMouseOut="lolite()" onClick="logVariable('locales')" href="../../_variables/locales.html">$locales</a>, <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('locale')" href="../../_variables/locale.html">$locale</a>;
<a name="l300"><span class="linenum"> 300</span></a>      global <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>;
<a name="l301"><span class="linenum"> 301</span></a>      global <a class="var it346" onMouseOver="hilite(346)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../_variables/admin_url.html">$admin_url</a>;
<a name="l302"><span class="linenum"> 302</span></a>      global <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../_variables/Settings.html">$Settings</a>, <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../_variables/Plugins.html">$Plugins</a>;
<a name="l303"><span class="linenum"> 303</span></a>  
<a name="l304"><span class="linenum"> 304</span></a>  <span class="comment">    // used for defaults, when upgrading to 1.6</span>
<a name="l305"><span class="linenum"> 305</span></a>      global <a class="var it5995" onMouseOver="hilite(5995)" onMouseOut="lolite()" onClick="logVariable('use_fileupload')" href="../../_variables/use_fileupload.html">$use_fileupload</a>, <a class="var it5996" onMouseOver="hilite(5996)" onMouseOut="lolite()" onClick="logVariable('fileupload_allowedtypes')" href="../../_variables/fileupload_allowedtypes.html">$fileupload_allowedtypes</a>, <a class="var it5997" onMouseOver="hilite(5997)" onMouseOut="lolite()" onClick="logVariable('fileupload_maxk')" href="../../_variables/fileupload_maxk.html">$fileupload_maxk</a>, <a class="var it5998" onMouseOver="hilite(5998)" onMouseOut="lolite()" onClick="logVariable('doubleCheckReferers')" href="../../_variables/doubleCheckReferers.html">$doubleCheckReferers</a>;
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  <span class="comment">    // new DB-delta functionality</span>
<a name="l308"><span class="linenum"> 308</span></a>      global <a class="var it4003" onMouseOver="hilite(4003)" onMouseOut="lolite()" onClick="logVariable('schema_queries')" href="../../_variables/schema_queries.html">$schema_queries</a>, <a class="var it246" onMouseOver="hilite(246)" onMouseOut="lolite()" onClick="logVariable('inc_path')" href="../../_variables/inc_path.html">$inc_path</a>;
<a name="l309"><span class="linenum"> 309</span></a>  
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment">    // used to check script time before starting to create db delta</span>
<a name="l311"><span class="linenum"> 311</span></a>      global <a class="var it3765" onMouseOver="hilite(3765)" onMouseOut="lolite()" onClick="logVariable('script_start_time')" href="../../_variables/script_start_time.html">$script_start_time</a>;
<a name="l312"><span class="linenum"> 312</span></a>  
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment">    // Create an option which can be turned on if we need to regenerate the autogenerated excerpts in the end of the upgrade script</span>
<a name="l314"><span class="linenum"> 314</span></a>      global <a class="var it5979" onMouseOver="hilite(5979)" onMouseOut="lolite()" onClick="logVariable('recreate_autogenerated_excerpts')" href="../../_variables/recreate_autogenerated_excerpts.html">$recreate_autogenerated_excerpts</a>;
<a name="l315"><span class="linenum"> 315</span></a>      <a class="var it5979" onMouseOver="hilite(5979)" onMouseOut="lolite()" onClick="logVariable('recreate_autogenerated_excerpts')" href="../../_variables/recreate_autogenerated_excerpts.html">$recreate_autogenerated_excerpts</a> = <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'recreate_excerpts', 'boolean', 0 );
<a name="l316"><span class="linenum"> 316</span></a>  
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">    // Load DB schema from modules</span>
<a name="l318"><span class="linenum"> 318</span></a>      <a class="function" onClick="logFunction('load_db_schema')" href="../../_functions/load_db_schema.html" onMouseOver="funcPopup(event,'load_db_schema')">load_db_schema</a>();
<a name="l319"><span class="linenum"> 319</span></a>  
<a name="l320"><span class="linenum"> 320</span></a>      <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('_core/model/db/_upgrade.funcs.php');
<a name="l321"><span class="linenum"> 321</span></a>  
<a name="l322"><span class="linenum"> 322</span></a>  
<a name="l323"><span class="linenum"> 323</span></a>      echo '&lt;p&gt;'.<a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Checking DB schema version...').' ';
<a name="l324"><span class="linenum"> 324</span></a>      <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> = <a class="function" onClick="logFunction('get_db_version')" href="../../_functions/get_db_version.html" onMouseOver="funcPopup(event,'get_db_version')">get_db_version</a>();
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>      if( empty(<a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a>) )
<a name="l327"><span class="linenum"> 327</span></a>      {
<a name="l328"><span class="linenum"> 328</span></a>          echo '&lt;p&gt;&lt;strong&gt;OOPS! b2evolution doesn\'t seem to be installed yet.&lt;/strong&gt;&lt;/p&gt;';
<a name="l329"><span class="linenum"> 329</span></a>          return;
<a name="l330"><span class="linenum"> 330</span></a>      }
<a name="l331"><span class="linenum"> 331</span></a>  
<a name="l332"><span class="linenum"> 332</span></a>      echo <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a>, ' : ';
<a name="l333"><span class="linenum"> 333</span></a>  
<a name="l334"><span class="linenum"> 334</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8000 ) <a class="function" onClick="logFunction('debug_die')" href="../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( <a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('This version is too old!') );
<a name="l335"><span class="linenum"> 335</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &gt; <a class="var it4135" onMouseOver="hilite(4135)" onMouseOut="lolite()" onClick="logVariable('new_db_version')" href="../../_variables/new_db_version.html">$new_db_version</a> ) <a class="function" onClick="logFunction('debug_die')" href="../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( <a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('This version is too recent! We cannot downgrade to the version you are trying to install...') );
<a name="l336"><span class="linenum"> 336</span></a>      echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l337"><span class="linenum"> 337</span></a>  
<a name="l338"><span class="linenum"> 338</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8010 )
<a name="l339"><span class="linenum"> 339</span></a>      {
<a name="l340"><span class="linenum"> 340</span></a>          echo 'Upgrading users table... ';
<a name="l341"><span class="linenum"> 341</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_users
<a name="l342"><span class="linenum"> 342</span></a>                              MODIFY COLUMN user_pass CHAR(32) NOT NULL&quot;;
<a name="l343"><span class="linenum"> 343</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l344"><span class="linenum"> 344</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l345"><span class="linenum"> 345</span></a>  
<a name="l346"><span class="linenum"> 346</span></a>          echo 'Upgrading blogs table... ';
<a name="l347"><span class="linenum"> 347</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_blogs
<a name="l348"><span class="linenum"> 348</span></a>                              MODIFY COLUMN blog_lang VARCHAR(20) NOT NULL DEFAULT 'en_US',
<a name="l349"><span class="linenum"> 349</span></a>                              MODIFY COLUMN blog_longdesc TEXT NULL DEFAULT NULL&quot;;
<a name="l350"><span class="linenum"> 350</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l351"><span class="linenum"> 351</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l352"><span class="linenum"> 352</span></a>  
<a name="l353"><span class="linenum"> 353</span></a>          echo 'Upgrading categories table... ';
<a name="l354"><span class="linenum"> 354</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_categories
<a name="l355"><span class="linenum"> 355</span></a>                              ADD COLUMN cat_description VARCHAR(250) NULL DEFAULT NULL,
<a name="l356"><span class="linenum"> 356</span></a>                              ADD COLUMN cat_longdesc TEXT NULL DEFAULT NULL,
<a name="l357"><span class="linenum"> 357</span></a>                              ADD COLUMN cat_icon VARCHAR(30) NULL DEFAULT NULL&quot;;
<a name="l358"><span class="linenum"> 358</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l359"><span class="linenum"> 359</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>          echo 'Upgrading posts table... ';
<a name="l362"><span class="linenum"> 362</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l363"><span class="linenum"> 363</span></a>                              MODIFY COLUMN post_lang VARCHAR(20) NOT NULL DEFAULT 'en_US',
<a name="l364"><span class="linenum"> 364</span></a>                              ADD COLUMN post_urltitle VARCHAR(50) NULL DEFAULT NULL AFTER post_title,
<a name="l365"><span class="linenum"> 365</span></a>                              ADD COLUMN post_url VARCHAR(250) NULL DEFAULT NULL AFTER post_urltitle,
<a name="l366"><span class="linenum"> 366</span></a>                              ADD COLUMN post_comments ENUM('disabled', 'open', 'closed') NOT NULL DEFAULT 'open' AFTER post_wordcount&quot;;
<a name="l367"><span class="linenum"> 367</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l368"><span class="linenum"> 368</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l369"><span class="linenum"> 369</span></a>  
<a name="l370"><span class="linenum"> 370</span></a>          echo 'Generating wordcounts... ';
<a name="l371"><span class="linenum"> 371</span></a>          <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('items/model/_item.funcs.php');
<a name="l372"><span class="linenum"> 372</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;SELECT ID, post_content FROM {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts WHERE post_wordcount IS NULL&quot;;
<a name="l373"><span class="linenum"> 373</span></a>          <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l374"><span class="linenum"> 374</span></a>          foreach( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="constant" onClick="logConstant('ARRAY_A')" href="../../_constants/ARRAY_A.html" onMouseOver="constPopup(event,'ARRAY_A')">ARRAY_A</a> ) as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l375"><span class="linenum"> 375</span></a>          {
<a name="l376"><span class="linenum"> 376</span></a>              <a class="var it5999" onMouseOver="hilite(5999)" onMouseOut="lolite()" onClick="logVariable('query_update_wordcount')" href="../../_variables/query_update_wordcount.html">$query_update_wordcount</a> = &quot;UPDATE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l377"><span class="linenum"> 377</span></a>                                                                  SET post_wordcount = &quot; . <a class="function" onClick="logFunction('bpost_count_words')" href="../../_functions/bpost_count_words.html" onMouseOver="funcPopup(event,'bpost_count_words')">bpost_count_words</a>(<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>['post_content']) . &quot;
<a name="l378"><span class="linenum"> 378</span></a>                                                                  WHERE ID = &quot; . <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>['ID'];
<a name="l379"><span class="linenum"> 379</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>(<a class="var it5999" onMouseOver="hilite(5999)" onMouseOut="lolite()" onClick="logVariable('query_update_wordcount')" href="../../_variables/query_update_wordcount.html">$query_update_wordcount</a>);
<a name="l380"><span class="linenum"> 380</span></a>              <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++;
<a name="l381"><span class="linenum"> 381</span></a>          }
<a name="l382"><span class="linenum"> 382</span></a>          echo &quot;OK. (<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> rows updated)&lt;br /&gt;\n&quot;;
<a name="l383"><span class="linenum"> 383</span></a>  
<a name="l384"><span class="linenum"> 384</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8010' );
<a name="l385"><span class="linenum"> 385</span></a>      }
<a name="l386"><span class="linenum"> 386</span></a>  
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8020 )
<a name="l389"><span class="linenum"> 389</span></a>      {
<a name="l390"><span class="linenum"> 390</span></a>          echo 'Encoding passwords... ';
<a name="l391"><span class="linenum"> 391</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE T_users
<a name="l392"><span class="linenum"> 392</span></a>                              SET user_pass = MD5(user_pass)&quot;;
<a name="l393"><span class="linenum"> 393</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l394"><span class="linenum"> 394</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l395"><span class="linenum"> 395</span></a>  
<a name="l396"><span class="linenum"> 396</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8020' );
<a name="l397"><span class="linenum"> 397</span></a>      }
<a name="l398"><span class="linenum"> 398</span></a>  
<a name="l399"><span class="linenum"> 399</span></a>  
<a name="l400"><span class="linenum"> 400</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8030 )
<a name="l401"><span class="linenum"> 401</span></a>      {
<a name="l402"><span class="linenum"> 402</span></a>          echo 'Deleting unecessary logs... ';
<a name="l403"><span class="linenum"> 403</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;DELETE FROM T_hitlog
<a name="l404"><span class="linenum"> 404</span></a>                              WHERE hit_ignore = 'badchar'&quot;;
<a name="l405"><span class="linenum"> 405</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l406"><span class="linenum"> 406</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l407"><span class="linenum"> 407</span></a>  
<a name="l408"><span class="linenum"> 408</span></a>          echo 'Updating blog urls... ';
<a name="l409"><span class="linenum"> 409</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;SELECT blog_ID, blog_siteurl FROM T_blogs&quot;;
<a name="l410"><span class="linenum"> 410</span></a>          <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 0;
<a name="l411"><span class="linenum"> 411</span></a>          foreach( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="constant" onClick="logConstant('ARRAY_A')" href="../../_constants/ARRAY_A.html" onMouseOver="constPopup(event,'ARRAY_A')">ARRAY_A</a> ) as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l412"><span class="linenum"> 412</span></a>          {
<a name="l413"><span class="linenum"> 413</span></a>              <a class="var it326" onMouseOver="hilite(326)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../_variables/blog_ID.html">$blog_ID</a> = <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>['blog_ID'];
<a name="l414"><span class="linenum"> 414</span></a>              <a class="var it4043" onMouseOver="hilite(4043)" onMouseOut="lolite()" onClick="logVariable('blog_siteurl')" href="../../_variables/blog_siteurl.html">$blog_siteurl</a> = <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>['blog_siteurl'];
<a name="l415"><span class="linenum"> 415</span></a>  <span class="comment">            // echo $blog_ID.':'.$blog_siteurl;</span>
<a name="l416"><span class="linenum"> 416</span></a>              if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it4043" onMouseOver="hilite(4043)" onMouseOut="lolite()" onClick="logVariable('blog_siteurl')" href="../../_variables/blog_siteurl.html">$blog_siteurl</a>.'/', <a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../_variables/baseurl.html">$baseurl</a> ) !== 0 )
<a name="l417"><span class="linenum"> 417</span></a>              { // If not found at position 0
<a name="l418"><span class="linenum"> 418</span></a>                  echo ' &lt;strong&gt;WARNING: please check blog #', <a class="var it326" onMouseOver="hilite(326)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../_variables/blog_ID.html">$blog_ID</a>, ' manually.&lt;/strong&gt;&lt;br /&gt; ';
<a name="l419"><span class="linenum"> 419</span></a>                  continue;
<a name="l420"><span class="linenum"> 420</span></a>              }
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment">            // crop off the baseurl:</span>
<a name="l422"><span class="linenum"> 422</span></a>              <a class="var it4043" onMouseOver="hilite(4043)" onMouseOut="lolite()" onClick="logVariable('blog_siteurl')" href="../../_variables/blog_siteurl.html">$blog_siteurl</a> = <a class="function" onClick="logFunction('evo_substr')" href="../../_functions/evo_substr.html" onMouseOver="funcPopup(event,'evo_substr')">evo_substr</a>( <a class="var it4043" onMouseOver="hilite(4043)" onMouseOut="lolite()" onClick="logVariable('blog_siteurl')" href="../../_variables/blog_siteurl.html">$blog_siteurl</a>.'/', <a class="function" onClick="logFunction('evo_strlen')" href="../../_functions/evo_strlen.html" onMouseOver="funcPopup(event,'evo_strlen')">evo_strlen</a>(<a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../_variables/baseurl.html">$baseurl</a>) );
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">            // echo ' -&gt; ', $blog_siteurl,'&lt;br /&gt;';</span>
<a name="l424"><span class="linenum"> 424</span></a>  
<a name="l425"><span class="linenum"> 425</span></a>              <a class="var it6000" onMouseOver="hilite(6000)" onMouseOut="lolite()" onClick="logVariable('query_update_blog')" href="../../_variables/query_update_blog.html">$query_update_blog</a> = &quot;UPDATE T_blogs SET blog_siteurl = '<a class="var it4043" onMouseOver="hilite(4043)" onMouseOut="lolite()" onClick="logVariable('blog_siteurl')" href="../../_variables/blog_siteurl.html">$blog_siteurl</a>' WHERE blog_ID = <a class="var it326" onMouseOver="hilite(326)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../_variables/blog_ID.html">$blog_ID</a>&quot;;
<a name="l426"><span class="linenum"> 426</span></a>  <span class="comment">            // echo $query_update_blog, '&lt;br /&gt;';</span>
<a name="l427"><span class="linenum"> 427</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it6000" onMouseOver="hilite(6000)" onMouseOut="lolite()" onClick="logVariable('query_update_blog')" href="../../_variables/query_update_blog.html">$query_update_blog</a> );
<a name="l428"><span class="linenum"> 428</span></a>              <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++;
<a name="l429"><span class="linenum"> 429</span></a>          }
<a name="l430"><span class="linenum"> 430</span></a>          echo &quot;OK. (<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> rows updated)&lt;br /&gt;\n&quot;;
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8030' );
<a name="l433"><span class="linenum"> 433</span></a>      }
<a name="l434"><span class="linenum"> 434</span></a>  
<a name="l435"><span class="linenum"> 435</span></a>  
<a name="l436"><span class="linenum"> 436</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8040 )
<a name="l437"><span class="linenum"> 437</span></a>      { // upgrade to 0.8.7
<a name="l438"><span class="linenum"> 438</span></a>          echo 'Creating table for Antispam Blackist... ';
<a name="l439"><span class="linenum"> 439</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}antispam (
<a name="l440"><span class="linenum"> 440</span></a>              aspm_ID bigint(11) NOT NULL auto_increment,
<a name="l441"><span class="linenum"> 441</span></a>              aspm_string varchar(80) NOT NULL,
<a name="l442"><span class="linenum"> 442</span></a>              aspm_source enum( 'local','reported','central' ) NOT NULL default 'reported',
<a name="l443"><span class="linenum"> 443</span></a>              PRIMARY KEY aspm_ID (aspm_ID),
<a name="l444"><span class="linenum"> 444</span></a>              UNIQUE aspm_string (aspm_string)
<a name="l445"><span class="linenum"> 445</span></a>          )&quot;;
<a name="l446"><span class="linenum"> 446</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l447"><span class="linenum"> 447</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l448"><span class="linenum"> 448</span></a>  
<a name="l449"><span class="linenum"> 449</span></a>          echo 'Creating default blacklist entries... ';
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">        // This string contains antispam information that is obfuscated because some hosting</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">        // companies prevent uploading PHP files containing &quot;spam&quot; strings.</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">        // pre_dump(get_antispam_query());</span>
<a name="l453"><span class="linenum"> 453</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = <a class="function" onClick="logFunction('get_antispam_query')" href="../../_functions/get_antispam_query.html" onMouseOver="funcPopup(event,'get_antispam_query')">get_antispam_query</a>();
<a name="l454"><span class="linenum"> 454</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l455"><span class="linenum"> 455</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l456"><span class="linenum"> 456</span></a>  
<a name="l457"><span class="linenum"> 457</span></a>          echo 'Upgrading Settings table... ';
<a name="l458"><span class="linenum"> 458</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_settings
<a name="l459"><span class="linenum"> 459</span></a>                              ADD COLUMN last_antispam_update datetime NOT NULL default '2000-01-01 00:00:00'&quot;;
<a name="l460"><span class="linenum"> 460</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l461"><span class="linenum"> 461</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l462"><span class="linenum"> 462</span></a>  
<a name="l463"><span class="linenum"> 463</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8040' );
<a name="l464"><span class="linenum"> 464</span></a>      }
<a name="l465"><span class="linenum"> 465</span></a>  
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8050 )
<a name="l468"><span class="linenum"> 468</span></a>      { // upgrade to 0.8.9
<a name="l469"><span class="linenum"> 469</span></a>          echo 'Upgrading blogs table... ';
<a name="l470"><span class="linenum"> 470</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_blogs
<a name="l471"><span class="linenum"> 471</span></a>                              ADD COLUMN blog_allowtrackbacks tinyint(1) NOT NULL default 1,
<a name="l472"><span class="linenum"> 472</span></a>                              ADD COLUMN blog_allowpingbacks tinyint(1) NOT NULL default 0,
<a name="l473"><span class="linenum"> 473</span></a>                              ADD COLUMN blog_pingb2evonet tinyint(1) NOT NULL default 0,
<a name="l474"><span class="linenum"> 474</span></a>                              ADD COLUMN blog_pingtechnorati tinyint(1) NOT NULL default 0,
<a name="l475"><span class="linenum"> 475</span></a>                              ADD COLUMN blog_pingweblogs tinyint(1) NOT NULL default 0,
<a name="l476"><span class="linenum"> 476</span></a>                              ADD COLUMN blog_pingblodotgs tinyint(1) NOT NULL default 0,
<a name="l477"><span class="linenum"> 477</span></a>                              ADD COLUMN blog_disp_bloglist tinyint NOT NULL DEFAULT 1&quot;;
<a name="l478"><span class="linenum"> 478</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l479"><span class="linenum"> 479</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l480"><span class="linenum"> 480</span></a>  
<a name="l481"><span class="linenum"> 481</span></a>  <span class="comment">        // Create User Groups</span>
<a name="l482"><span class="linenum"> 482</span></a>          global <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>, <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>, <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>, <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>;
<a name="l483"><span class="linenum"> 483</span></a>          echo 'Creating table for Groups... ';
<a name="l484"><span class="linenum"> 484</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;CREATE TABLE T_groups (
<a name="l485"><span class="linenum"> 485</span></a>              grp_ID int(11) NOT NULL auto_increment,
<a name="l486"><span class="linenum"> 486</span></a>              grp_name varchar(50) NOT NULL default '',
<a name="l487"><span class="linenum"> 487</span></a>              grp_perm_admin enum('none','hidden','visible') NOT NULL default 'visible',
<a name="l488"><span class="linenum"> 488</span></a>              grp_perm_blogs enum('user','viewall','editall') NOT NULL default 'user',
<a name="l489"><span class="linenum"> 489</span></a>              grp_perm_stats enum('none','view','edit') NOT NULL default 'none',
<a name="l490"><span class="linenum"> 490</span></a>              grp_perm_spamblacklist enum('none','view','edit') NOT NULL default 'none',
<a name="l491"><span class="linenum"> 491</span></a>              grp_perm_options enum('none','view','edit') NOT NULL default 'none',
<a name="l492"><span class="linenum"> 492</span></a>              grp_perm_users enum('none','view','edit') NOT NULL default 'none',
<a name="l493"><span class="linenum"> 493</span></a>              grp_perm_templates TINYINT NOT NULL DEFAULT 0,
<a name="l494"><span class="linenum"> 494</span></a>              grp_perm_files enum('none','view','add','edit','all') NOT NULL default 'none',
<a name="l495"><span class="linenum"> 495</span></a>              PRIMARY KEY grp_ID (grp_ID)
<a name="l496"><span class="linenum"> 496</span></a>          )&quot;;
<a name="l497"><span class="linenum"> 497</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l498"><span class="linenum"> 498</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l499"><span class="linenum"> 499</span></a>  
<a name="l500"><span class="linenum"> 500</span></a>  <span class="comment">        // This table needs to be created here for proper group insertion</span>
<a name="l501"><span class="linenum"> 501</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for Group Settings... ' );
<a name="l502"><span class="linenum"> 502</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_groups__groupsettings (
<a name="l503"><span class="linenum"> 503</span></a>              gset_grp_ID INT(11) UNSIGNED NOT NULL,
<a name="l504"><span class="linenum"> 504</span></a>              gset_name VARCHAR(30) NOT NULL,
<a name="l505"><span class="linenum"> 505</span></a>              gset_value VARCHAR(255) NULL,
<a name="l506"><span class="linenum"> 506</span></a>              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (gset_grp_ID, gset_name)
<a name="l507"><span class="linenum"> 507</span></a>          ) ENGINE = innodb&quot; );
<a name="l508"><span class="linenum"> 508</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l509"><span class="linenum"> 509</span></a>  
<a name="l510"><span class="linenum"> 510</span></a>          echo 'Creating default groups... ';
<a name="l511"><span class="linenum"> 511</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Group')" href="../../_classes/group.html" onMouseOver="classPopup(event,'group')">Group</a>(); <span class="comment">// COPY !</span>
<a name="l512"><span class="linenum"> 512</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'name', 'Administrators' );
<a name="l513"><span class="linenum"> 513</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_admin', 'visible' );
<a name="l514"><span class="linenum"> 514</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_blogs', 'editall' );
<a name="l515"><span class="linenum"> 515</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_stats', 'edit' );
<a name="l516"><span class="linenum"> 516</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_spamblacklist', 'edit' );
<a name="l517"><span class="linenum"> 517</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_files', 'all' );
<a name="l518"><span class="linenum"> 518</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_options', 'edit' );
<a name="l519"><span class="linenum"> 519</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_templates', 1 );
<a name="l520"><span class="linenum"> 520</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_users', 'edit' );
<a name="l521"><span class="linenum"> 521</span></a>          <a class="var it4802" onMouseOver="hilite(4802)" onMouseOut="lolite()" onClick="logVariable('Group_Admins')" href="../../_variables/Group_Admins.html">$Group_Admins</a>-&gt;<a class="function" onClick="logFunction('dbinsert')" href="../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>();
<a name="l522"><span class="linenum"> 522</span></a>  
<a name="l523"><span class="linenum"> 523</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Group')" href="../../_classes/group.html" onMouseOver="classPopup(event,'group')">Group</a>(); <span class="comment">// COPY !</span>
<a name="l524"><span class="linenum"> 524</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'name', 'Privileged Bloggers' );
<a name="l525"><span class="linenum"> 525</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_admin', 'visible' );
<a name="l526"><span class="linenum"> 526</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_blogs', 'viewall' );
<a name="l527"><span class="linenum"> 527</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_stats', 'view' );
<a name="l528"><span class="linenum"> 528</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_spamblacklist', 'edit' );
<a name="l529"><span class="linenum"> 529</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_files', 'add' );
<a name="l530"><span class="linenum"> 530</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_options', 'view' );
<a name="l531"><span class="linenum"> 531</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_templates', 0 );
<a name="l532"><span class="linenum"> 532</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_users', 'view' );
<a name="l533"><span class="linenum"> 533</span></a>          <a class="var it4803" onMouseOver="hilite(4803)" onMouseOut="lolite()" onClick="logVariable('Group_Privileged')" href="../../_variables/Group_Privileged.html">$Group_Privileged</a>-&gt;<a class="function" onClick="logFunction('dbinsert')" href="../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>();
<a name="l534"><span class="linenum"> 534</span></a>  
<a name="l535"><span class="linenum"> 535</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Group')" href="../../_classes/group.html" onMouseOver="classPopup(event,'group')">Group</a>(); <span class="comment">// COPY !</span>
<a name="l536"><span class="linenum"> 536</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'name', 'Bloggers' );
<a name="l537"><span class="linenum"> 537</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_admin', 'visible' );
<a name="l538"><span class="linenum"> 538</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_blogs', 'user' );
<a name="l539"><span class="linenum"> 539</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_stats', 'none' );
<a name="l540"><span class="linenum"> 540</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_spamblacklist', 'view' );
<a name="l541"><span class="linenum"> 541</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_files', 'view' );
<a name="l542"><span class="linenum"> 542</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_options', 'none' );
<a name="l543"><span class="linenum"> 543</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_templates', 0 );
<a name="l544"><span class="linenum"> 544</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_users', 'none' );
<a name="l545"><span class="linenum"> 545</span></a>          <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;<a class="function" onClick="logFunction('dbinsert')" href="../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>();
<a name="l546"><span class="linenum"> 546</span></a>  
<a name="l547"><span class="linenum"> 547</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Group')" href="../../_classes/group.html" onMouseOver="classPopup(event,'group')">Group</a>(); <span class="comment">// COPY !</span>
<a name="l548"><span class="linenum"> 548</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'name', 'Basic Users' );
<a name="l549"><span class="linenum"> 549</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_admin', 'none' );
<a name="l550"><span class="linenum"> 550</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_blogs', 'user' );
<a name="l551"><span class="linenum"> 551</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_stats', 'none' );
<a name="l552"><span class="linenum"> 552</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_spamblacklist', 'none' );
<a name="l553"><span class="linenum"> 553</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_files', 'none' );
<a name="l554"><span class="linenum"> 554</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_options', 'none' );
<a name="l555"><span class="linenum"> 555</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_templates', 0 );
<a name="l556"><span class="linenum"> 556</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'perm_users', 'none' );
<a name="l557"><span class="linenum"> 557</span></a>          <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a class="function" onClick="logFunction('dbinsert')" href="../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>();
<a name="l558"><span class="linenum"> 558</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l559"><span class="linenum"> 559</span></a>  
<a name="l560"><span class="linenum"> 560</span></a>  
<a name="l561"><span class="linenum"> 561</span></a>          echo 'Creating table for Blog-User permissions... ';
<a name="l562"><span class="linenum"> 562</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;CREATE TABLE T_coll_user_perms (
<a name="l563"><span class="linenum"> 563</span></a>              bloguser_blog_ID int(11) unsigned NOT NULL default 0,
<a name="l564"><span class="linenum"> 564</span></a>              bloguser_user_ID int(11) unsigned NOT NULL default 0,
<a name="l565"><span class="linenum"> 565</span></a>              bloguser_ismember tinyint NOT NULL default 0,
<a name="l566"><span class="linenum"> 566</span></a>              bloguser_perm_poststatuses <a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('published','deprecated','protected','private','draft') NOT NULL default '',
<a name="l567"><span class="linenum"> 567</span></a>              bloguser_perm_delpost tinyint NOT NULL default 0,
<a name="l568"><span class="linenum"> 568</span></a>              bloguser_perm_comments tinyint NOT NULL default 0,
<a name="l569"><span class="linenum"> 569</span></a>              bloguser_perm_cats tinyint NOT NULL default 0,
<a name="l570"><span class="linenum"> 570</span></a>              bloguser_perm_properties tinyint NOT NULL default 0,
<a name="l571"><span class="linenum"> 571</span></a>              bloguser_perm_media_upload tinyint NOT NULL default 0,
<a name="l572"><span class="linenum"> 572</span></a>              bloguser_perm_media_browse tinyint NOT NULL default 0,
<a name="l573"><span class="linenum"> 573</span></a>              bloguser_perm_media_change tinyint NOT NULL default 0,
<a name="l574"><span class="linenum"> 574</span></a>              PRIMARY KEY bloguser_pk (bloguser_blog_ID,bloguser_user_ID)
<a name="l575"><span class="linenum"> 575</span></a>          )&quot;;
<a name="l576"><span class="linenum"> 576</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l577"><span class="linenum"> 577</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l578"><span class="linenum"> 578</span></a>          <a class="var it6001" onMouseOver="hilite(6001)" onMouseOut="lolite()" onClick="logVariable('tablegroups_isuptodate')" href="../../_variables/tablegroups_isuptodate.html">$tablegroups_isuptodate</a> = true;
<a name="l579"><span class="linenum"> 579</span></a>          <a class="var it6002" onMouseOver="hilite(6002)" onMouseOut="lolite()" onClick="logVariable('tableblogusers_isuptodate')" href="../../_variables/tableblogusers_isuptodate.html">$tableblogusers_isuptodate</a> = true;
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>          echo 'Creating user blog permissions... ';
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">        // Admin: full rights for all blogs (look 'ma, doing a natural join! :&gt;)</span>
<a name="l583"><span class="linenum"> 583</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;INSERT INTO T_coll_user_perms( bloguser_blog_ID, bloguser_user_ID, bloguser_ismember,
<a name="l584"><span class="linenum"> 584</span></a>                                  bloguser_perm_poststatuses, bloguser_perm_delpost, bloguser_perm_comments,
<a name="l585"><span class="linenum"> 585</span></a>                                  bloguser_perm_cats, bloguser_perm_properties)
<a name="l586"><span class="linenum"> 586</span></a>                              SELECT blog_ID, ID, 1, 'published,deprecated,protected,private,draft', 1, 1, 1, 1
<a name="l587"><span class="linenum"> 587</span></a>                              FROM T_users, T_blogs
<a name="l588"><span class="linenum"> 588</span></a>                              WHERE user_level = 10&quot;;
<a name="l589"><span class="linenum"> 589</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l590"><span class="linenum"> 590</span></a>  
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">        // Normal users: basic rights for all blogs (can't stop doing joins :P)</span>
<a name="l592"><span class="linenum"> 592</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;INSERT INTO T_coll_user_perms( bloguser_blog_ID, bloguser_user_ID, bloguser_ismember,
<a name="l593"><span class="linenum"> 593</span></a>                                  bloguser_perm_poststatuses, bloguser_perm_delpost, bloguser_perm_comments,
<a name="l594"><span class="linenum"> 594</span></a>                                  bloguser_perm_cats, bloguser_perm_properties)
<a name="l595"><span class="linenum"> 595</span></a>                              SELECT blog_ID, ID, 1, 'published,protected,private,draft', 0, 1, 0, 0
<a name="l596"><span class="linenum"> 596</span></a>                              FROM T_users, T_blogs
<a name="l597"><span class="linenum"> 597</span></a>                              WHERE user_level &gt; 0 AND user_level &lt; 10&quot;;
<a name="l598"><span class="linenum"> 598</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l599"><span class="linenum"> 599</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>          echo 'Upgrading users table... ';
<a name="l602"><span class="linenum"> 602</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users
<a name="l603"><span class="linenum"> 603</span></a>                                        SET dateYMDhour = \'2000-01-01 00:00:00\'
<a name="l604"><span class="linenum"> 604</span></a>                                      <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> ( dateYMDhour = \'0000-00-00 00:00:00\' OR dateYMDhour = \'2000-00-00 00:00:01\' )' );
<a name="l605"><span class="linenum"> 605</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users
<a name="l606"><span class="linenum"> 606</span></a>                              MODIFY COLUMN dateYMDhour DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\'' );
<a name="l607"><span class="linenum"> 607</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_users
<a name="l608"><span class="linenum"> 608</span></a>                              ADD COLUMN user_notify tinyint(1) NOT NULL default 1,
<a name="l609"><span class="linenum"> 609</span></a>                              ADD COLUMN user_grp_ID int(4) NOT NULL default 1,
<a name="l610"><span class="linenum"> 610</span></a>                              MODIFY COLUMN user_idmode varchar(20) NOT NULL DEFAULT 'login',
<a name="l611"><span class="linenum"> 611</span></a>                              ADD KEY user_grp_ID (user_grp_ID)&quot;;
<a name="l612"><span class="linenum"> 612</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l613"><span class="linenum"> 613</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l614"><span class="linenum"> 614</span></a>  
<a name="l615"><span class="linenum"> 615</span></a>          echo 'Assigning user groups... ';
<a name="l616"><span class="linenum"> 616</span></a>  
<a name="l617"><span class="linenum"> 617</span></a>  <span class="comment">        // Default is 1, so admins are already set.</span>
<a name="l618"><span class="linenum"> 618</span></a>  
<a name="l619"><span class="linenum"> 619</span></a>  <span class="comment">        // Basic Users:</span>
<a name="l620"><span class="linenum"> 620</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE T_users
<a name="l621"><span class="linenum"> 621</span></a>                              SET user_grp_ID = <a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;ID
<a name="l622"><span class="linenum"> 622</span></a>                              WHERE user_level = 0&quot;;
<a name="l623"><span class="linenum"> 623</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l624"><span class="linenum"> 624</span></a>  
<a name="l625"><span class="linenum"> 625</span></a>  <span class="comment">        // Bloggers:</span>
<a name="l626"><span class="linenum"> 626</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE T_users
<a name="l627"><span class="linenum"> 627</span></a>                              SET user_grp_ID = <a class="var it4804" onMouseOver="hilite(4804)" onMouseOut="lolite()" onClick="logVariable('Group_Bloggers')" href="../../_variables/Group_Bloggers.html">$Group_Bloggers</a>-&gt;ID
<a name="l628"><span class="linenum"> 628</span></a>                              WHERE user_level &gt; 0 AND user_level &lt; 10&quot;;
<a name="l629"><span class="linenum"> 629</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l630"><span class="linenum"> 630</span></a>  
<a name="l631"><span class="linenum"> 631</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l632"><span class="linenum"> 632</span></a>  
<a name="l633"><span class="linenum"> 633</span></a>          echo 'Upgrading settings table... ';
<a name="l634"><span class="linenum"> 634</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_settings
<a name="l635"><span class="linenum"> 635</span></a>                              DROP COLUMN time_format,
<a name="l636"><span class="linenum"> 636</span></a>                              DROP COLUMN date_format,
<a name="l637"><span class="linenum"> 637</span></a>                              ADD COLUMN pref_newusers_grp_ID int unsigned DEFAULT 4 NOT NULL,
<a name="l638"><span class="linenum"> 638</span></a>                              ADD COLUMN pref_newusers_level tinyint unsigned DEFAULT 1 NOT NULL,
<a name="l639"><span class="linenum"> 639</span></a>                              ADD COLUMN pref_newusers_canregister tinyint unsigned DEFAULT 0 NOT NULL&quot;;
<a name="l640"><span class="linenum"> 640</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l641"><span class="linenum"> 641</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l642"><span class="linenum"> 642</span></a>  
<a name="l643"><span class="linenum"> 643</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8050' );
<a name="l644"><span class="linenum"> 644</span></a>      }
<a name="l645"><span class="linenum"> 645</span></a>  
<a name="l646"><span class="linenum"> 646</span></a>  
<a name="l647"><span class="linenum"> 647</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8060 )
<a name="l648"><span class="linenum"> 648</span></a>      { // upgrade to 0.9
<a name="l649"><span class="linenum"> 649</span></a>  <span class="comment">        // Important check:</span>
<a name="l650"><span class="linenum"> 650</span></a>          <a class="var it6003" onMouseOver="hilite(6003)" onMouseOut="lolite()" onClick="logVariable('stub_list')" href="../../_variables/stub_list.html">$stub_list</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( &quot;
<a name="l651"><span class="linenum"> 651</span></a>              SELECT blog_stub
<a name="l652"><span class="linenum"> 652</span></a>                FROM T_blogs
<a name="l653"><span class="linenum"> 653</span></a>               GROUP BY blog_stub
<a name="l654"><span class="linenum"> 654</span></a>              HAVING <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) &gt; 1&quot; );
<a name="l655"><span class="linenum"> 655</span></a>          if( !empty(<a class="var it6003" onMouseOver="hilite(6003)" onMouseOut="lolite()" onClick="logVariable('stub_list')" href="../../_variables/stub_list.html">$stub_list</a>) )
<a name="l656"><span class="linenum"> 656</span></a>          {
<a name="l657"><span class="linenum"> 657</span></a>              echo '&lt;div class=&quot;error&quot;&gt;&lt;p class=&quot;error&quot;&gt;';
<a name="l658"><span class="linenum"> 658</span></a>              printf( <a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>(&quot;It appears that the following blog stub names are used more than once: ['%s']&quot; ), <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( &quot;','&quot;, <a class="var it6003" onMouseOver="hilite(6003)" onMouseOut="lolite()" onClick="logVariable('stub_list')" href="../../_variables/stub_list.html">$stub_list</a> ) );
<a name="l659"><span class="linenum"> 659</span></a>              echo '&lt;/p&gt;&lt;p&gt;';
<a name="l660"><span class="linenum"> 660</span></a>              printf( <a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>(&quot;I can't upgrade until you make them unique. DB field: [%s]&quot; ), <a class="var it1750" onMouseOver="hilite(1750)" onMouseOut="lolite()" onClick="logVariable('db_config')" href="../../_variables/db_config.html">$db_config</a>['aliases']['T_blogs'].'.blog_stub' );
<a name="l661"><span class="linenum"> 661</span></a>              echo '&lt;/p&gt;&lt;/div&gt;';
<a name="l662"><span class="linenum"> 662</span></a>              return false;
<a name="l663"><span class="linenum"> 663</span></a>          }
<a name="l664"><span class="linenum"> 664</span></a>  
<a name="l665"><span class="linenum"> 665</span></a>  <span class="comment">        // Create locales</span>
<a name="l666"><span class="linenum"> 666</span></a>          echo 'Creating table for Locales... ';
<a name="l667"><span class="linenum"> 667</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;CREATE TABLE T_locales (
<a name="l668"><span class="linenum"> 668</span></a>                  loc_locale varchar(20) NOT NULL default '',
<a name="l669"><span class="linenum"> 669</span></a>                  loc_charset varchar(15) NOT NULL default 'iso-8859-1',
<a name="l670"><span class="linenum"> 670</span></a>                  loc_datefmt varchar(10) NOT NULL default 'y-m-d',
<a name="l671"><span class="linenum"> 671</span></a>                  loc_timefmt varchar(10) NOT NULL default 'H:i:s',
<a name="l672"><span class="linenum"> 672</span></a>                  loc_name varchar(40) NOT NULL default '',
<a name="l673"><span class="linenum"> 673</span></a>                  loc_messages varchar(20) NOT NULL default '',
<a name="l674"><span class="linenum"> 674</span></a>                  loc_priority tinyint(4) UNSIGNED NOT NULL default '0',
<a name="l675"><span class="linenum"> 675</span></a>                  loc_enabled tinyint(4) NOT NULL default '1',
<a name="l676"><span class="linenum"> 676</span></a>                  PRIMARY KEY loc_locale( loc_locale )
<a name="l677"><span class="linenum"> 677</span></a>              ) COMMENT='saves available locales'&quot;;
<a name="l678"><span class="linenum"> 678</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l679"><span class="linenum"> 679</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l680"><span class="linenum"> 680</span></a>  
<a name="l681"><span class="linenum"> 681</span></a>          echo 'Upgrading posts table... ';
<a name="l682"><span class="linenum"> 682</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l683"><span class="linenum"> 683</span></a>                              SET post_urltitle = NULL&quot;;
<a name="l684"><span class="linenum"> 684</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l685"><span class="linenum"> 685</span></a>  
<a name="l686"><span class="linenum"> 686</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l687"><span class="linenum"> 687</span></a>                              CHANGE COLUMN post_date post_issue_date datetime NOT NULL default '1000-01-01 00:00:00',
<a name="l688"><span class="linenum"> 688</span></a>                              ADD COLUMN post_mod_date datetime NOT NULL default '1000-01-01 00:00:00'
<a name="l689"><span class="linenum"> 689</span></a>                                          AFTER post_issue_date,
<a name="l690"><span class="linenum"> 690</span></a>                              CHANGE COLUMN post_lang post_locale varchar(20) NOT NULL default 'en-EU',
<a name="l691"><span class="linenum"> 691</span></a>                              DROP COLUMN post_url,
<a name="l692"><span class="linenum"> 692</span></a>                              CHANGE COLUMN post_trackbacks post_url varchar(250) NULL default NULL,
<a name="l693"><span class="linenum"> 693</span></a>                              ADD COLUMN post_renderers VARCHAR(179) NOT NULL default 'default',
<a name="l694"><span class="linenum"> 694</span></a>                              DROP INDEX post_date,
<a name="l695"><span class="linenum"> 695</span></a>                              ADD INDEX post_issue_date( post_issue_date ),
<a name="l696"><span class="linenum"> 696</span></a>                              ADD UNIQUE post_urltitle( post_urltitle )&quot;;
<a name="l697"><span class="linenum"> 697</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l698"><span class="linenum"> 698</span></a>  
<a name="l699"><span class="linenum"> 699</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l700"><span class="linenum"> 700</span></a>                              SET post_mod_date = post_issue_date&quot;;
<a name="l701"><span class="linenum"> 701</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l702"><span class="linenum"> 702</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l703"><span class="linenum"> 703</span></a>  
<a name="l704"><span class="linenum"> 704</span></a>  <span class="comment">        // convert given languages to locales</span>
<a name="l705"><span class="linenum"> 705</span></a>          <a class="function" onClick="logFunction('convert_lang_to_locale')" href="../../_functions/convert_lang_to_locale.html" onMouseOver="funcPopup(event,'convert_lang_to_locale')">convert_lang_to_locale</a>( &quot;{<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts&quot;, 'post_locale', 'ID' );
<a name="l706"><span class="linenum"> 706</span></a>  
<a name="l707"><span class="linenum"> 707</span></a>          echo 'Upgrading blogs table... ';
<a name="l708"><span class="linenum"> 708</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_blogs
<a name="l709"><span class="linenum"> 709</span></a>                              CHANGE blog_lang blog_locale varchar(20) NOT NULL default 'en-EU',
<a name="l710"><span class="linenum"> 710</span></a>                              CHANGE blog_roll blog_notes TEXT NULL,
<a name="l711"><span class="linenum"> 711</span></a>                              MODIFY COLUMN blog_default_skin VARCHAR(30) NOT NULL DEFAULT 'custom',
<a name="l712"><span class="linenum"> 712</span></a>                              DROP COLUMN blog_filename,
<a name="l713"><span class="linenum"> 713</span></a>                              ADD COLUMN blog_access_type VARCHAR(10) NOT NULL DEFAULT 'index.php' AFTER blog_locale,
<a name="l714"><span class="linenum"> 714</span></a>                              ADD COLUMN blog_force_skin tinyint(1) NOT NULL default 0 AFTER blog_default_skin,
<a name="l715"><span class="linenum"> 715</span></a>                              ADD COLUMN blog_in_bloglist tinyint(1) NOT NULL DEFAULT 1 AFTER blog_disp_bloglist,
<a name="l716"><span class="linenum"> 716</span></a>                              ADD COLUMN blog_links_blog_ID INT(4) NOT NULL DEFAULT 0,
<a name="l717"><span class="linenum"> 717</span></a>                              ADD UNIQUE KEY blog_stub (blog_stub)&quot;;
<a name="l718"><span class="linenum"> 718</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l719"><span class="linenum"> 719</span></a>  
<a name="l720"><span class="linenum"> 720</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE T_blogs
<a name="l721"><span class="linenum"> 721</span></a>                              SET blog_access_type = 'stub',
<a name="l722"><span class="linenum"> 722</span></a>                                      blog_default_skin = 'custom'&quot;;
<a name="l723"><span class="linenum"> 723</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l724"><span class="linenum"> 724</span></a>  
<a name="l725"><span class="linenum"> 725</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l726"><span class="linenum"> 726</span></a>  
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">        // convert given languages to locales</span>
<a name="l728"><span class="linenum"> 728</span></a>          <a class="function" onClick="logFunction('convert_lang_to_locale')" href="../../_functions/convert_lang_to_locale.html" onMouseOver="funcPopup(event,'convert_lang_to_locale')">convert_lang_to_locale</a>( 'T_blogs', 'blog_locale', 'blog_ID' );
<a name="l729"><span class="linenum"> 729</span></a>  
<a name="l730"><span class="linenum"> 730</span></a>  
<a name="l731"><span class="linenum"> 731</span></a>          echo 'Converting settings table... ';
<a name="l732"><span class="linenum"> 732</span></a>  
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment">        // get old settings</span>
<a name="l734"><span class="linenum"> 734</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = 'SELECT * FROM T_settings';
<a name="l735"><span class="linenum"> 735</span></a>          <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="constant" onClick="logConstant('ARRAY_A')" href="../../_constants/ARRAY_A.html" onMouseOver="constPopup(event,'ARRAY_A')">ARRAY_A</a> );
<a name="l736"><span class="linenum"> 736</span></a>  
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment">        #echo 'oldrow:&lt;br /&gt;'; pre_dump($row);</span>
<a name="l738"><span class="linenum"> 738</span></a>          <a class="var it6004" onMouseOver="hilite(6004)" onMouseOut="lolite()" onClick="logVariable('transform')" href="../../_variables/transform.html">$transform</a> = array(
<a name="l739"><span class="linenum"> 739</span></a>              'posts_per_page' =&gt; array(5),      // note: moved to blogsettings in 2.0
<a name="l740"><span class="linenum"> 740</span></a>              'what_to_show' =&gt; array('posts'),  // note: moved to blogsettings in 2.0
<a name="l741"><span class="linenum"> 741</span></a>              'archive_mode' =&gt; array('monthly'),// note: moved to blogsettings in 2.0
<a name="l742"><span class="linenum"> 742</span></a>              'time_difference' =&gt; array(0),
<a name="l743"><span class="linenum"> 743</span></a>              'AutoBR' =&gt; array(0),
<a name="l744"><span class="linenum"> 744</span></a>              'last_antispam_update' =&gt; array('2000-01-01 00:00:00', 'antispam_last_update'),
<a name="l745"><span class="linenum"> 745</span></a>              'pref_newusers_grp_ID' =&gt; array(<a class="var it4805" onMouseOver="hilite(4805)" onMouseOut="lolite()" onClick="logVariable('Group_Users')" href="../../_variables/Group_Users.html">$Group_Users</a>-&gt;<a onClick="logVariable('ID')" class="var it9077" onMouseOver="hilite(9077)" onMouseOut="lolite()" href="../../_variables/ID.html">ID</a>, 'newusers_grp_ID'),
<a name="l746"><span class="linenum"> 746</span></a>              'pref_newusers_level'  =&gt; array(1, 'newusers_level'),
<a name="l747"><span class="linenum"> 747</span></a>              'pref_newusers_canregister' =&gt; array(0, 'newusers_canregister'),
<a name="l748"><span class="linenum"> 748</span></a>          );
<a name="l749"><span class="linenum"> 749</span></a>  
<a name="l750"><span class="linenum"> 750</span></a>          <a class="var it2380" onMouseOver="hilite(2380)" onMouseOut="lolite()" onClick="logVariable('_trans')" href="../../_variables/_trans.html">$_trans</a> = array();
<a name="l751"><span class="linenum"> 751</span></a>          foreach( <a class="var it6004" onMouseOver="hilite(6004)" onMouseOut="lolite()" onClick="logVariable('transform')" href="../../_variables/transform.html">$transform</a> as <a class="var it6005" onMouseOver="hilite(6005)" onMouseOut="lolite()" onClick="logVariable('oldkey')" href="../../_variables/oldkey.html">$oldkey</a> =&gt; <a class="var it6006" onMouseOver="hilite(6006)" onMouseOut="lolite()" onClick="logVariable('newarr')" href="../../_variables/newarr.html">$newarr</a> )
<a name="l752"><span class="linenum"> 752</span></a>          {
<a name="l753"><span class="linenum"> 753</span></a>              <a class="var it6007" onMouseOver="hilite(6007)" onMouseOut="lolite()" onClick="logVariable('newname')" href="../../_variables/newname.html">$newname</a> = ( isset(<a class="var it6006" onMouseOver="hilite(6006)" onMouseOut="lolite()" onClick="logVariable('newarr')" href="../../_variables/newarr.html">$newarr</a>[1]) ? <a class="var it6006" onMouseOver="hilite(6006)" onMouseOut="lolite()" onClick="logVariable('newarr')" href="../../_variables/newarr.html">$newarr</a>[1] : <a class="var it6005" onMouseOver="hilite(6005)" onMouseOut="lolite()" onClick="logVariable('oldkey')" href="../../_variables/oldkey.html">$oldkey</a> );
<a name="l754"><span class="linenum"> 754</span></a>              if( !isset( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>[<a class="var it6005" onMouseOver="hilite(6005)" onMouseOut="lolite()" onClick="logVariable('oldkey')" href="../../_variables/oldkey.html">$oldkey</a>] ) )
<a name="l755"><span class="linenum"> 755</span></a>              {
<a name="l756"><span class="linenum"> 756</span></a>                  echo '&amp;nbsp;&amp;middot;Setting '.<a class="var it6005" onMouseOver="hilite(6005)" onMouseOut="lolite()" onClick="logVariable('oldkey')" href="../../_variables/oldkey.html">$oldkey</a>.' not found, using defaults.&lt;br /&gt;';
<a name="l757"><span class="linenum"> 757</span></a>                  <a class="var it2380" onMouseOver="hilite(2380)" onMouseOut="lolite()" onClick="logVariable('_trans')" href="../../_variables/_trans.html">$_trans</a>[ <a class="var it6007" onMouseOver="hilite(6007)" onMouseOut="lolite()" onClick="logVariable('newname')" href="../../_variables/newname.html">$newname</a> ] = <a class="var it6006" onMouseOver="hilite(6006)" onMouseOut="lolite()" onClick="logVariable('newarr')" href="../../_variables/newarr.html">$newarr</a>[0];
<a name="l758"><span class="linenum"> 758</span></a>              }
<a name="l759"><span class="linenum"> 759</span></a>              else
<a name="l760"><span class="linenum"> 760</span></a>              {
<a name="l761"><span class="linenum"> 761</span></a>                  <a class="var it2380" onMouseOver="hilite(2380)" onMouseOut="lolite()" onClick="logVariable('_trans')" href="../../_variables/_trans.html">$_trans</a>[ <a class="var it6007" onMouseOver="hilite(6007)" onMouseOut="lolite()" onClick="logVariable('newname')" href="../../_variables/newname.html">$newname</a> ] = <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>[<a class="var it6005" onMouseOver="hilite(6005)" onMouseOut="lolite()" onClick="logVariable('oldkey')" href="../../_variables/oldkey.html">$oldkey</a>];
<a name="l762"><span class="linenum"> 762</span></a>              }
<a name="l763"><span class="linenum"> 763</span></a>          }
<a name="l764"><span class="linenum"> 764</span></a>  
<a name="l765"><span class="linenum"> 765</span></a>  <span class="comment">        // drop old table</span>
<a name="l766"><span class="linenum"> 766</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DROP TABLE IF EXISTS T_settings' );
<a name="l767"><span class="linenum"> 767</span></a>  
<a name="l768"><span class="linenum"> 768</span></a>  <span class="comment">        // create new table</span>
<a name="l769"><span class="linenum"> 769</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>(
<a name="l770"><span class="linenum"> 770</span></a>              'CREATE TABLE T_settings (
<a name="l771"><span class="linenum"> 771</span></a>                  set_name VARCHAR( 30 ) NOT NULL ,
<a name="l772"><span class="linenum"> 772</span></a>                  set_value VARCHAR( 255 ) NULL ,
<a name="l773"><span class="linenum"> 773</span></a>                  PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( set_name )
<a name="l774"><span class="linenum"> 774</span></a>              )');
<a name="l775"><span class="linenum"> 775</span></a>  
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment">        // insert defaults and use transformed settings</span>
<a name="l777"><span class="linenum"> 777</span></a>          <a class="function" onClick="logFunction('create_default_settings')" href="../../_functions/create_default_settings.html" onMouseOver="funcPopup(event,'create_default_settings')">create_default_settings</a>( <a class="var it2380" onMouseOver="hilite(2380)" onMouseOut="lolite()" onClick="logVariable('_trans')" href="../../_variables/_trans.html">$_trans</a> );
<a name="l778"><span class="linenum"> 778</span></a>  
<a name="l779"><span class="linenum"> 779</span></a>          if( !isset( <a class="var it6002" onMouseOver="hilite(6002)" onMouseOut="lolite()" onClick="logVariable('tableblogusers_isuptodate')" href="../../_variables/tableblogusers_isuptodate.html">$tableblogusers_isuptodate</a> ) )
<a name="l780"><span class="linenum"> 780</span></a>          {
<a name="l781"><span class="linenum"> 781</span></a>              echo 'Upgrading Blog-User permissions table... ';
<a name="l782"><span class="linenum"> 782</span></a>              <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_coll_user_perms
<a name="l783"><span class="linenum"> 783</span></a>                                  ADD COLUMN bloguser_ismember tinyint NOT NULL default 0 AFTER bloguser_user_ID&quot;;
<a name="l784"><span class="linenum"> 784</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l785"><span class="linenum"> 785</span></a>  
<a name="l786"><span class="linenum"> 786</span></a>  <span class="comment">            // Any row that is created holds at least one permission,</span>
<a name="l787"><span class="linenum"> 787</span></a>  <span class="comment">            // minimum permsission is to be a member, so we add that one too, to all existing rows.</span>
<a name="l788"><span class="linenum"> 788</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_coll_user_perms
<a name="l789"><span class="linenum"> 789</span></a>                                              SET bloguser_ismember = 1&quot; );
<a name="l790"><span class="linenum"> 790</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l791"><span class="linenum"> 791</span></a>          }
<a name="l792"><span class="linenum"> 792</span></a>  
<a name="l793"><span class="linenum"> 793</span></a>          echo 'Upgrading Comments table... ';
<a name="l794"><span class="linenum"> 794</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments
<a name="l795"><span class="linenum"> 795</span></a>                                        SET comment_date = \'2000-01-01 00:00:00\'
<a name="l796"><span class="linenum"> 796</span></a>                                      WHERE comment_date = \'0000-00-00 00:00:00\'' );
<a name="l797"><span class="linenum"> 797</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l798"><span class="linenum"> 798</span></a>                              MODIFY COLUMN comment_date DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\'' );
<a name="l799"><span class="linenum"> 799</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_comments
<a name="l800"><span class="linenum"> 800</span></a>                              ADD COLUMN comment_author_ID int unsigned NULL default NULL AFTER comment_status,
<a name="l801"><span class="linenum"> 801</span></a>                              MODIFY COLUMN comment_author varchar(100) NULL,
<a name="l802"><span class="linenum"> 802</span></a>                              MODIFY COLUMN comment_author_email varchar(100) NULL,
<a name="l803"><span class="linenum"> 803</span></a>                              MODIFY COLUMN comment_author_url varchar(100) NULL,
<a name="l804"><span class="linenum"> 804</span></a>                              MODIFY COLUMN comment_author_IP varchar(23) NOT NULL default ''&quot;;
<a name="l805"><span class="linenum"> 805</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l806"><span class="linenum"> 806</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l807"><span class="linenum"> 807</span></a>  
<a name="l808"><span class="linenum"> 808</span></a>          echo 'Upgrading Users table... ';
<a name="l809"><span class="linenum"> 809</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_users ADD user_locale VARCHAR( 20 ) DEFAULT 'en-EU' NOT NULL AFTER user_yim&quot;;
<a name="l810"><span class="linenum"> 810</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l811"><span class="linenum"> 811</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l812"><span class="linenum"> 812</span></a>  
<a name="l813"><span class="linenum"> 813</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8060' );
<a name="l814"><span class="linenum"> 814</span></a>      }
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>  
<a name="l817"><span class="linenum"> 817</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8062 )
<a name="l818"><span class="linenum"> 818</span></a>      { // upgrade to 0.9.0.4
<a name="l819"><span class="linenum"> 819</span></a>          echo &quot;Checking for extra quote escaping in posts... &quot;;
<a name="l820"><span class="linenum"> 820</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;SELECT ID, post_title, post_content
<a name="l821"><span class="linenum"> 821</span></a>                                  FROM {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l822"><span class="linenum"> 822</span></a>                               WHERE post_title LIKE '%\\\\\\\\\'%'
<a name="l823"><span class="linenum"> 823</span></a>                                      OR post_title LIKE '%\\\\\\\\\&quot;%'
<a name="l824"><span class="linenum"> 824</span></a>                                      OR post_content LIKE '%\\\\\\\\\'%'
<a name="l825"><span class="linenum"> 825</span></a>                                      OR post_content LIKE '%\\\\\\\\\&quot;%' &quot;;
<a name="l826"><span class="linenum"> 826</span></a>          <span class="comment">/* FP: the above looks overkill, but MySQL is really full of surprises...</span>
<a name="l827"><span class="linenum"> 827</span></a>  <span class="comment">                        tested on 4.0.14-nt */</span>
<a name="l828"><span class="linenum"> 828</span></a>  <span class="comment">        // echo $query;</span>
<a name="l829"><span class="linenum"> 829</span></a>          <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>, <a class="constant" onClick="logConstant('ARRAY_A')" href="../../_constants/ARRAY_A.html" onMouseOver="constPopup(event,'ARRAY_A')">ARRAY_A</a> );
<a name="l830"><span class="linenum"> 830</span></a>          if( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('num_rows')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/num_rows.html">num_rows</a> )
<a name="l831"><span class="linenum"> 831</span></a>          {
<a name="l832"><span class="linenum"> 832</span></a>              echo 'Updating '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('num_rows')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/num_rows.html">num_rows</a>.' posts... ';
<a name="l833"><span class="linenum"> 833</span></a>              foreach( <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l834"><span class="linenum"> 834</span></a>              {
<a name="l835"><span class="linenum"> 835</span></a>  <span class="comment">                // echo '&lt;br /&gt;'.$row['post_title'];</span>
<a name="l836"><span class="linenum"> 836</span></a>                  <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l837"><span class="linenum"> 837</span></a>                                      SET post_title = &quot;.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="phpfunction" onClick="logFunction('stripslashes')" href="../../_functions/stripslashes.html" onMouseOver="phpfuncPopup(event,'stripslashes')">stripslashes</a>( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>['post_title'] ) ).&quot;,
<a name="l838"><span class="linenum"> 838</span></a>                                              post_content = &quot;.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="phpfunction" onClick="logFunction('stripslashes')" href="../../_functions/stripslashes.html" onMouseOver="phpfuncPopup(event,'stripslashes')">stripslashes</a>( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>['post_content'] ) ).&quot;
<a name="l839"><span class="linenum"> 839</span></a>                                      WHERE ID = &quot;.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>['ID'];
<a name="l840"><span class="linenum"> 840</span></a>  <span class="comment">                // echo '&lt;br /&gt;'.$query;</span>
<a name="l841"><span class="linenum"> 841</span></a>                  <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l842"><span class="linenum"> 842</span></a>              }
<a name="l843"><span class="linenum"> 843</span></a>          }
<a name="l844"><span class="linenum"> 844</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l845"><span class="linenum"> 845</span></a>  
<a name="l846"><span class="linenum"> 846</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8062' );
<a name="l847"><span class="linenum"> 847</span></a>      }
<a name="l848"><span class="linenum"> 848</span></a>  
<a name="l849"><span class="linenum"> 849</span></a>  
<a name="l850"><span class="linenum"> 850</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8064 )
<a name="l851"><span class="linenum"> 851</span></a>      { // upgrade to 0.9.0.6
<a name="l852"><span class="linenum"> 852</span></a>          <a class="function" onClick="logFunction('cleanup_comment_quotes')" href="../../_functions/cleanup_comment_quotes.html" onMouseOver="funcPopup(event,'cleanup_comment_quotes')">cleanup_comment_quotes</a>();
<a name="l853"><span class="linenum"> 853</span></a>  
<a name="l854"><span class="linenum"> 854</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8064' );
<a name="l855"><span class="linenum"> 855</span></a>      }
<a name="l856"><span class="linenum"> 856</span></a>  
<a name="l857"><span class="linenum"> 857</span></a>  
<a name="l858"><span class="linenum"> 858</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8066 )
<a name="l859"><span class="linenum"> 859</span></a>      {    // upgrade to 0.9.1
<a name="l860"><span class="linenum"> 860</span></a>          echo 'Adding catpost index... ';
<a name="l861"><span class="linenum"> 861</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_postcats ADD UNIQUE catpost ( postcat_cat_ID, postcat_post_ID )' );
<a name="l862"><span class="linenum"> 862</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l863"><span class="linenum"> 863</span></a>  
<a name="l864"><span class="linenum"> 864</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8066' );
<a name="l865"><span class="linenum"> 865</span></a>      }
<a name="l866"><span class="linenum"> 866</span></a>  
<a name="l867"><span class="linenum"> 867</span></a>  
<a name="l868"><span class="linenum"> 868</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8800 )
<a name="l869"><span class="linenum"> 869</span></a>      { // ---------------------------------- upgrade to 1.6 &quot;phoenix ALPHA&quot;
<a name="l870"><span class="linenum"> 870</span></a>  
<a name="l871"><span class="linenum"> 871</span></a>          echo 'Dropping old Hitlog table... ';
<a name="l872"><span class="linenum"> 872</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DROP TABLE IF EXISTS T_hitlog' );
<a name="l873"><span class="linenum"> 873</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l874"><span class="linenum"> 874</span></a>  
<a name="l875"><span class="linenum"> 875</span></a>  <span class="comment">        // New tables:</span>
<a name="l876"><span class="linenum"> 876</span></a>              echo 'Creating table for active sessions... ';
<a name="l877"><span class="linenum"> 877</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_sessions (
<a name="l878"><span class="linenum"> 878</span></a>                                              sess_ID        INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
<a name="l879"><span class="linenum"> 879</span></a>                                              sess_key       CHAR(32) NULL,
<a name="l880"><span class="linenum"> 880</span></a>                                              sess_lastseen  DATETIME NOT NULL,
<a name="l881"><span class="linenum"> 881</span></a>                                              sess_ipaddress VARCHAR(15) NOT NULL DEFAULT '',
<a name="l882"><span class="linenum"> 882</span></a>                                              sess_user_ID   INT(10) DEFAULT NULL,
<a name="l883"><span class="linenum"> 883</span></a>                                              sess_agnt_ID   INT UNSIGNED NULL,
<a name="l884"><span class="linenum"> 884</span></a>                                              sess_data      TEXT DEFAULT NULL,
<a name="l885"><span class="linenum"> 885</span></a>                                              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a>( sess_ID )
<a name="l886"><span class="linenum"> 886</span></a>                                          )&quot; );
<a name="l887"><span class="linenum"> 887</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l888"><span class="linenum"> 888</span></a>  
<a name="l889"><span class="linenum"> 889</span></a>  
<a name="l890"><span class="linenum"> 890</span></a>              echo 'Creating user settings table... ';
<a name="l891"><span class="linenum"> 891</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}<a class="function" onClick="logFunction('usersettings')" href="../../_functions/usersettings.html" onMouseOver="funcPopup(event,'usersettings')">usersettings</a> (
<a name="l892"><span class="linenum"> 892</span></a>                                              uset_user_ID INT(11) UNSIGNED NOT NULL,
<a name="l893"><span class="linenum"> 893</span></a>                                              uset_name    VARCHAR( 30 ) NOT NULL,
<a name="l894"><span class="linenum"> 894</span></a>                                              uset_value   VARCHAR( 255 ) NULL,
<a name="l895"><span class="linenum"> 895</span></a>                                              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( uset_user_ID, uset_name )
<a name="l896"><span class="linenum"> 896</span></a>                                          )&quot;);
<a name="l897"><span class="linenum"> 897</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l898"><span class="linenum"> 898</span></a>  
<a name="l899"><span class="linenum"> 899</span></a>  
<a name="l900"><span class="linenum"> 900</span></a>              echo 'Creating plugins table... ';
<a name="l901"><span class="linenum"> 901</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_plugins (
<a name="l902"><span class="linenum"> 902</span></a>                                              plug_ID        INT(11) UNSIGNED NOT NULL auto_increment,
<a name="l903"><span class="linenum"> 903</span></a>                                              plug_priority  INT(11) NOT NULL default 50,
<a name="l904"><span class="linenum"> 904</span></a>                                              plug_classname VARCHAR(40) NOT NULL default '',
<a name="l905"><span class="linenum"> 905</span></a>                                              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( plug_ID )
<a name="l906"><span class="linenum"> 906</span></a>                                          )&quot;);
<a name="l907"><span class="linenum"> 907</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l908"><span class="linenum"> 908</span></a>  
<a name="l909"><span class="linenum"> 909</span></a>  
<a name="l910"><span class="linenum"> 910</span></a>              echo 'Creating table for Post Statuses... ';
<a name="l911"><span class="linenum"> 911</span></a>              <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>=&quot;CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}poststatuses (
<a name="l912"><span class="linenum"> 912</span></a>                                              pst_ID   int(11) unsigned not null AUTO_INCREMENT,
<a name="l913"><span class="linenum"> 913</span></a>                                              pst_name varchar(30)      not null,
<a name="l914"><span class="linenum"> 914</span></a>                                              primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> ( pst_ID )
<a name="l915"><span class="linenum"> 915</span></a>                                          )&quot;;
<a name="l916"><span class="linenum"> 916</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l917"><span class="linenum"> 917</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l918"><span class="linenum"> 918</span></a>  
<a name="l919"><span class="linenum"> 919</span></a>  
<a name="l920"><span class="linenum"> 920</span></a>              echo 'Creating table for Post Types... ';
<a name="l921"><span class="linenum"> 921</span></a>              <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>=&quot;CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posttypes (
<a name="l922"><span class="linenum"> 922</span></a>                                              ptyp_ID   int(11) unsigned not null AUTO_INCREMENT,
<a name="l923"><span class="linenum"> 923</span></a>                                              ptyp_name varchar(30)      not null,
<a name="l924"><span class="linenum"> 924</span></a>                                              primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (ptyp_ID)
<a name="l925"><span class="linenum"> 925</span></a>                                          )&quot;;
<a name="l926"><span class="linenum"> 926</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l927"><span class="linenum"> 927</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l928"><span class="linenum"> 928</span></a>  
<a name="l929"><span class="linenum"> 929</span></a>  
<a name="l930"><span class="linenum"> 930</span></a>              echo 'Creating table for File Meta Data... ';
<a name="l931"><span class="linenum"> 931</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_files (
<a name="l932"><span class="linenum"> 932</span></a>                                           file_ID        int(11) unsigned  not null AUTO_INCREMENT,
<a name="l933"><span class="linenum"> 933</span></a>                                           file_root_type enum('absolute','user','group','collection') not null default 'absolute',
<a name="l934"><span class="linenum"> 934</span></a>                                           file_root_ID   int(11) unsigned  not null default 0,
<a name="l935"><span class="linenum"> 935</span></a>                                           file_path      varchar(255)      not null default '',
<a name="l936"><span class="linenum"> 936</span></a>                                           file_title     varchar(255),
<a name="l937"><span class="linenum"> 937</span></a>                                           file_alt       varchar(255),
<a name="l938"><span class="linenum"> 938</span></a>                                           file_desc      text,
<a name="l939"><span class="linenum"> 939</span></a>                                           primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (file_ID),
<a name="l940"><span class="linenum"> 940</span></a>                                           unique <a class="phpfunction" onClick="logFunction('file')" href="../../_functions/file.html" onMouseOver="phpfuncPopup(event,'file')">file</a> (file_root_type, file_root_ID, file_path)
<a name="l941"><span class="linenum"> 941</span></a>                                      )&quot; );
<a name="l942"><span class="linenum"> 942</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l943"><span class="linenum"> 943</span></a>  
<a name="l944"><span class="linenum"> 944</span></a>  
<a name="l945"><span class="linenum"> 945</span></a>              echo 'Creating table for base domains... ';
<a name="l946"><span class="linenum"> 946</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_basedomains (
<a name="l947"><span class="linenum"> 947</span></a>                                          dom_ID     INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
<a name="l948"><span class="linenum"> 948</span></a>                                          dom_name   VARCHAR(250) NOT NULL DEFAULT '',
<a name="l949"><span class="linenum"> 949</span></a>                                          dom_status ENUM('unknown','whitelist','blacklist') NOT NULL DEFAULT 'unknown',
<a name="l950"><span class="linenum"> 950</span></a>                                          dom_type   ENUM('unknown','normal','searcheng','aggregator') NOT NULL DEFAULT 'unknown',
<a name="l951"><span class="linenum"> 951</span></a>                                          PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (dom_ID),
<a name="l952"><span class="linenum"> 952</span></a>                                          UNIQUE dom_name (dom_name)
<a name="l953"><span class="linenum"> 953</span></a>                                      )&quot; );    <span class="comment">// fp&gt; the unique key was only named in version 1.9. Crap. Put the name back here to save as many souls as possible. bulk has not upgraded from 0.9 yet :/</span>
<a name="l954"><span class="linenum"> 954</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l955"><span class="linenum"> 955</span></a>  
<a name="l956"><span class="linenum"> 956</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8820' );
<a name="l957"><span class="linenum"> 957</span></a>      }
<a name="l958"><span class="linenum"> 958</span></a>  
<a name="l959"><span class="linenum"> 959</span></a>  
<a name="l960"><span class="linenum"> 960</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8840 )
<a name="l961"><span class="linenum"> 961</span></a>      {
<a name="l962"><span class="linenum"> 962</span></a>  
<a name="l963"><span class="linenum"> 963</span></a>              echo 'Creating table for user agents... ';
<a name="l964"><span class="linenum"> 964</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}useragents (
<a name="l965"><span class="linenum"> 965</span></a>                                          agnt_ID        INT UNSIGNED NOT NULL AUTO_INCREMENT,
<a name="l966"><span class="linenum"> 966</span></a>                                          agnt_signature VARCHAR(250) NOT NULL,
<a name="l967"><span class="linenum"> 967</span></a>                                          agnt_type      ENUM('rss','robot','browser','unknown') DEFAULT 'unknown' NOT NULL,
<a name="l968"><span class="linenum"> 968</span></a>                                          PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (agnt_ID) )&quot; );
<a name="l969"><span class="linenum"> 969</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l970"><span class="linenum"> 970</span></a>  
<a name="l971"><span class="linenum"> 971</span></a>  
<a name="l972"><span class="linenum"> 972</span></a>              echo 'Creating table for Hit-Logs... ';
<a name="l973"><span class="linenum"> 973</span></a>              <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;CREATE TABLE T_hitlog (
<a name="l974"><span class="linenum"> 974</span></a>                                      hit_ID             INT(11) NOT NULL AUTO_INCREMENT,
<a name="l975"><span class="linenum"> 975</span></a>                                      hit_sess_ID        INT UNSIGNED,
<a name="l976"><span class="linenum"> 976</span></a>                                      hit_datetime       DATETIME NOT NULL,
<a name="l977"><span class="linenum"> 977</span></a>                                      hit_uri            VARCHAR(250) DEFAULT NULL,
<a name="l978"><span class="linenum"> 978</span></a>                                      hit_referer_type   ENUM('search','blacklist','referer','direct','spam') NOT NULL,
<a name="l979"><span class="linenum"> 979</span></a>                                      hit_referer        VARCHAR(250) DEFAULT NULL,
<a name="l980"><span class="linenum"> 980</span></a>                                      hit_referer_dom_ID INT UNSIGNED DEFAULT NULL,
<a name="l981"><span class="linenum"> 981</span></a>                                      hit_blog_ID        int(11) UNSIGNED NULL DEFAULT NULL,
<a name="l982"><span class="linenum"> 982</span></a>                                      hit_remote_addr    VARCHAR(40) DEFAULT NULL,
<a name="l983"><span class="linenum"> 983</span></a>                                      PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (hit_ID),
<a name="l984"><span class="linenum"> 984</span></a>                                      INDEX hit_datetime ( hit_datetime ),
<a name="l985"><span class="linenum"> 985</span></a>                                      INDEX hit_blog_ID (hit_blog_ID)
<a name="l986"><span class="linenum"> 986</span></a>                                  )&quot;;
<a name="l987"><span class="linenum"> 987</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l988"><span class="linenum"> 988</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l989"><span class="linenum"> 989</span></a>  
<a name="l990"><span class="linenum"> 990</span></a>  
<a name="l991"><span class="linenum"> 991</span></a>              echo 'Creating table for subscriptions... ';
<a name="l992"><span class="linenum"> 992</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_subscriptions (
<a name="l993"><span class="linenum"> 993</span></a>                                           sub_coll_ID     int(11) unsigned    not null,
<a name="l994"><span class="linenum"> 994</span></a>                                           sub_user_ID     int(11) unsigned    not null,
<a name="l995"><span class="linenum"> 995</span></a>                                           sub_items       tinyint(1)          not null,
<a name="l996"><span class="linenum"> 996</span></a>                                           sub_comments    tinyint(1)          not null,
<a name="l997"><span class="linenum"> 997</span></a>                                           primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (sub_coll_ID, sub_user_ID)
<a name="l998"><span class="linenum"> 998</span></a>                                          )&quot; );
<a name="l999"><span class="linenum"> 999</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1000"><span class="linenum">1000</span></a>  
<a name="l1001"><span class="linenum">1001</span></a>  
<a name="l1002"><span class="linenum">1002</span></a>              echo 'Creating table for blog-group permissions... ';
<a name="l1003"><span class="linenum">1003</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_coll_group_perms (
<a name="l1004"><span class="linenum">1004</span></a>                                              bloggroup_blog_ID int(11) unsigned NOT NULL default 0,
<a name="l1005"><span class="linenum">1005</span></a>                                              bloggroup_group_ID int(11) unsigned NOT NULL default 0,
<a name="l1006"><span class="linenum">1006</span></a>                                              bloggroup_ismember tinyint NOT NULL default 0,
<a name="l1007"><span class="linenum">1007</span></a>                                              bloggroup_perm_poststatuses <a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('published','deprecated','protected','private','draft') NOT NULL default '',
<a name="l1008"><span class="linenum">1008</span></a>                                              bloggroup_perm_delpost tinyint NOT NULL default 0,
<a name="l1009"><span class="linenum">1009</span></a>                                              bloggroup_perm_comments tinyint NOT NULL default 0,
<a name="l1010"><span class="linenum">1010</span></a>                                              bloggroup_perm_cats tinyint NOT NULL default 0,
<a name="l1011"><span class="linenum">1011</span></a>                                              bloggroup_perm_properties tinyint NOT NULL default 0,
<a name="l1012"><span class="linenum">1012</span></a>                                              bloggroup_perm_media_upload tinyint NOT NULL default 0,
<a name="l1013"><span class="linenum">1013</span></a>                                              bloggroup_perm_media_browse tinyint NOT NULL default 0,
<a name="l1014"><span class="linenum">1014</span></a>                                              bloggroup_perm_media_change tinyint NOT NULL default 0,
<a name="l1015"><span class="linenum">1015</span></a>                                              PRIMARY KEY bloggroup_pk (bloggroup_blog_ID,bloggroup_group_ID) )&quot; );
<a name="l1016"><span class="linenum">1016</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1017"><span class="linenum">1017</span></a>  
<a name="l1018"><span class="linenum">1018</span></a>  
<a name="l1019"><span class="linenum">1019</span></a>          echo 'Upgrading blogs table... ';
<a name="l1020"><span class="linenum">1020</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_blogs
<a name="l1021"><span class="linenum">1021</span></a>                              MODIFY COLUMN blog_ID int(11) unsigned NOT NULL auto_increment,
<a name="l1022"><span class="linenum">1022</span></a>                              MODIFY COLUMN blog_links_blog_ID INT(11) NULL DEFAULT NULL,
<a name="l1023"><span class="linenum">1023</span></a>                              CHANGE COLUMN blog_stub blog_urlname VARCHAR(255) NOT NULL DEFAULT 'urlname',
<a name="l1024"><span class="linenum">1024</span></a>                              ADD COLUMN blog_allowcomments VARCHAR(20) NOT NULL default 'post_by_post' AFTER blog_keywords,
<a name="l1025"><span class="linenum">1025</span></a>                              ADD COLUMN blog_allowblogcss TINYINT(1) NOT NULL default 1 AFTER blog_allowpingbacks,
<a name="l1026"><span class="linenum">1026</span></a>                              ADD COLUMN blog_allowusercss TINYINT(1) NOT NULL default 1 AFTER blog_allowblogcss,
<a name="l1027"><span class="linenum">1027</span></a>                              ADD COLUMN blog_stub VARCHAR(255) NOT NULL DEFAULT 'stub' AFTER blog_staticfilename,
<a name="l1028"><span class="linenum">1028</span></a>                              ADD COLUMN blog_commentsexpire INT(4) NOT NULL DEFAULT 0 AFTER blog_links_blog_ID,
<a name="l1029"><span class="linenum">1029</span></a>                              ADD COLUMN blog_media_location ENUM( 'default', 'subdir', 'custom', 'none' ) DEFAULT 'default' NOT NULL AFTER blog_commentsexpire,
<a name="l1030"><span class="linenum">1030</span></a>                              ADD COLUMN blog_media_subdir VARCHAR( 255 ) NOT NULL AFTER blog_media_location,
<a name="l1031"><span class="linenum">1031</span></a>                              ADD COLUMN blog_media_fullpath VARCHAR( 255 ) NOT NULL AFTER blog_media_subdir,
<a name="l1032"><span class="linenum">1032</span></a>                              ADD COLUMN blog_media_url VARCHAR(255) NOT NULL AFTER blog_media_fullpath,
<a name="l1033"><span class="linenum">1033</span></a>                              DROP INDEX blog_stub,
<a name="l1034"><span class="linenum">1034</span></a>                              ADD UNIQUE blog_urlname ( blog_urlname )&quot;;
<a name="l1035"><span class="linenum">1035</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1036"><span class="linenum">1036</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1037"><span class="linenum">1037</span></a>  
<a name="l1038"><span class="linenum">1038</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8840' );
<a name="l1039"><span class="linenum">1039</span></a>      }
<a name="l1040"><span class="linenum">1040</span></a>  
<a name="l1041"><span class="linenum">1041</span></a>  
<a name="l1042"><span class="linenum">1042</span></a>  <span class="comment">    // sam2kb&gt;fp: We need to make sure there are no values like &quot;blog_a.php&quot; in blog_urlname,</span>
<a name="l1043"><span class="linenum">1043</span></a>  <span class="comment">    //            after this upgrade blog URLs look like $baseurl.'blog_a.php' which might be OK in 0.x version,</span>
<a name="l1044"><span class="linenum">1044</span></a>  <span class="comment">    //            but this config will not work in b2evo 4. Blog URLs will be broken!</span>
<a name="l1045"><span class="linenum">1045</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8850 )
<a name="l1046"><span class="linenum">1046</span></a>      {
<a name="l1047"><span class="linenum">1047</span></a>          echo 'Updating relative URLs... ';
<a name="l1048"><span class="linenum">1048</span></a>  <span class="comment">        // We need to move the slashes to the end:</span>
<a name="l1049"><span class="linenum">1049</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE T_blogs
<a name="l1050"><span class="linenum">1050</span></a>                                   SET blog_siteurl = CONCAT( SUBSTRING(blog_siteurl,2) , '/' )
<a name="l1051"><span class="linenum">1051</span></a>                               WHERE blog_siteurl LIKE '/%'&quot;;
<a name="l1052"><span class="linenum">1052</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1053"><span class="linenum">1053</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1054"><span class="linenum">1054</span></a>  
<a name="l1055"><span class="linenum">1055</span></a>          echo 'Copying urlnames to stub names... ';
<a name="l1056"><span class="linenum">1056</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = 'UPDATE T_blogs
<a name="l1057"><span class="linenum">1057</span></a>                              SET blog_stub = blog_urlname';
<a name="l1058"><span class="linenum">1058</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1059"><span class="linenum">1059</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1060"><span class="linenum">1060</span></a>  
<a name="l1061"><span class="linenum">1061</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8850' );
<a name="l1062"><span class="linenum">1062</span></a>      }
<a name="l1063"><span class="linenum">1063</span></a>  
<a name="l1064"><span class="linenum">1064</span></a>  
<a name="l1065"><span class="linenum">1065</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8855 )
<a name="l1066"><span class="linenum">1066</span></a>      {
<a name="l1067"><span class="linenum">1067</span></a>          echo 'Upgrading posts table... ';
<a name="l1068"><span class="linenum">1068</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l1069"><span class="linenum">1069</span></a>                              DROP COLUMN post_karma,
<a name="l1070"><span class="linenum">1070</span></a>                              DROP COLUMN post_autobr,
<a name="l1071"><span class="linenum">1071</span></a>                              DROP INDEX post_author,
<a name="l1072"><span class="linenum">1072</span></a>                              DROP INDEX post_issue_date,
<a name="l1073"><span class="linenum">1073</span></a>                              DROP INDEX post_category,
<a name="l1074"><span class="linenum">1074</span></a>                              CHANGE COLUMN ID post_ID int(11) unsigned NOT NULL auto_increment,
<a name="l1075"><span class="linenum">1075</span></a>                              CHANGE COLUMN post_author    post_creator_user_ID int(11) unsigned NOT NULL,
<a name="l1076"><span class="linenum">1076</span></a>                              CHANGE COLUMN post_issue_date    post_datestart datetime NOT NULL,
<a name="l1077"><span class="linenum">1077</span></a>                              CHANGE COLUMN post_mod_date    post_datemodified datetime NOT NULL,
<a name="l1078"><span class="linenum">1078</span></a>                              CHANGE COLUMN post_category post_main_cat_ID int(11) unsigned NOT NULL,
<a name="l1079"><span class="linenum">1079</span></a>                              ADD post_parent_ID                int(11) unsigned NULL AFTER post_ID,
<a name="l1080"><span class="linenum">1080</span></a>                              ADD post_lastedit_user_ID    int(11) unsigned NULL AFTER post_creator_user_ID,
<a name="l1081"><span class="linenum">1081</span></a>                              ADD post_assigned_user_ID    int(11) unsigned NULL AFTER post_lastedit_user_ID,
<a name="l1082"><span class="linenum">1082</span></a>                              ADD post_datedeadline         datetime NULL AFTER post_datestart,
<a name="l1083"><span class="linenum">1083</span></a>                              ADD post_datecreated            datetime NULL AFTER post_datedeadline,
<a name="l1084"><span class="linenum">1084</span></a>                              ADD post_pst_ID                        int(11) unsigned NULL AFTER post_status,
<a name="l1085"><span class="linenum">1085</span></a>                              ADD post_ptyp_ID                    int(11) unsigned NULL AFTER post_pst_ID,
<a name="l1086"><span class="linenum">1086</span></a>                              ADD post_views                        int(11) unsigned NOT NULL DEFAULT 0 AFTER post_flags,
<a name="l1087"><span class="linenum">1087</span></a>                              ADD post_commentsexpire        datetime DEFAULT NULL AFTER post_comments,
<a name="l1088"><span class="linenum">1088</span></a>                              ADD post_priority                    int(11) unsigned null,
<a name="l1089"><span class="linenum">1089</span></a>                              ADD INDEX post_creator_user_ID( post_creator_user_ID ),
<a name="l1090"><span class="linenum">1090</span></a>                              ADD INDEX post_parent_ID( post_parent_ID ),
<a name="l1091"><span class="linenum">1091</span></a>                              ADD INDEX post_assigned_user_ID( post_assigned_user_ID ),
<a name="l1092"><span class="linenum">1092</span></a>                              ADD INDEX post_datestart( post_datestart ),
<a name="l1093"><span class="linenum">1093</span></a>                              ADD INDEX post_main_cat_ID( post_main_cat_ID ),
<a name="l1094"><span class="linenum">1094</span></a>                              ADD INDEX post_ptyp_ID( post_ptyp_ID ),
<a name="l1095"><span class="linenum">1095</span></a>                              ADD INDEX post_pst_ID( post_pst_ID ) &quot;;
<a name="l1096"><span class="linenum">1096</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1097"><span class="linenum">1097</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1098"><span class="linenum">1098</span></a>  
<a name="l1099"><span class="linenum">1099</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8855' );
<a name="l1100"><span class="linenum">1100</span></a>      }
<a name="l1101"><span class="linenum">1101</span></a>  
<a name="l1102"><span class="linenum">1102</span></a>  
<a name="l1103"><span class="linenum">1103</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8860 )
<a name="l1104"><span class="linenum">1104</span></a>      {
<a name="l1105"><span class="linenum">1105</span></a>          echo 'Updating post data... ';
<a name="l1106"><span class="linenum">1106</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;UPDATE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l1107"><span class="linenum">1107</span></a>                              SET post_lastedit_user_ID = post_creator_user_ID,
<a name="l1108"><span class="linenum">1108</span></a>                                      post_datecreated = post_datestart&quot;;
<a name="l1109"><span class="linenum">1109</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1110"><span class="linenum">1110</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1111"><span class="linenum">1111</span></a>  
<a name="l1112"><span class="linenum">1112</span></a>  
<a name="l1113"><span class="linenum">1113</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table... ' );
<a name="l1114"><span class="linenum">1114</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users
<a name="l1115"><span class="linenum">1115</span></a>                                        SET dateYMDhour = \'2000-01-01 00:00:00\'
<a name="l1116"><span class="linenum">1116</span></a>                                      WHERE dateYMDhour = \'0000-00-00 00:00:00\'' );
<a name="l1117"><span class="linenum">1117</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users
<a name="l1118"><span class="linenum">1118</span></a>                              MODIFY COLUMN dateYMDhour DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\',
<a name="l1119"><span class="linenum">1119</span></a>                              CHANGE COLUMN ID user_ID int(11) unsigned NOT NULL auto_increment,
<a name="l1120"><span class="linenum">1120</span></a>                              MODIFY COLUMN user_icq int(11) unsigned DEFAULT 0 NOT NULL,
<a name="l1121"><span class="linenum">1121</span></a>                              ADD COLUMN user_showonline tinyint(1) NOT NULL default 1 AFTER user_notify' );
<a name="l1122"><span class="linenum">1122</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1123"><span class="linenum">1123</span></a>  
<a name="l1124"><span class="linenum">1124</span></a>  
<a name="l1125"><span class="linenum">1125</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8860' );
<a name="l1126"><span class="linenum">1126</span></a>      }
<a name="l1127"><span class="linenum">1127</span></a>  
<a name="l1128"><span class="linenum">1128</span></a>  
<a name="l1129"><span class="linenum">1129</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 8900 )
<a name="l1130"><span class="linenum">1130</span></a>      {
<a name="l1131"><span class="linenum">1131</span></a>  
<a name="l1132"><span class="linenum">1132</span></a>          echo 'Setting new defaults... ';
<a name="l1133"><span class="linenum">1133</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = 'INSERT INTO T_settings (set_name, set_value)
<a name="l1134"><span class="linenum">1134</span></a>                              VALUES
<a name="l1135"><span class="linenum">1135</span></a>                                  ( &quot;reloadpage_timeout&quot;, &quot;300&quot; ),
<a name="l1136"><span class="linenum">1136</span></a>                                  ( &quot;upload_enabled&quot;, &quot;'.(isset(<a class="var it5995" onMouseOver="hilite(5995)" onMouseOut="lolite()" onClick="logVariable('use_fileupload')" href="../../_variables/use_fileupload.html">$use_fileupload</a>) ? (int)<a class="var it5995" onMouseOver="hilite(5995)" onMouseOut="lolite()" onClick="logVariable('use_fileupload')" href="../../_variables/use_fileupload.html">$use_fileupload</a> : '1').'&quot; ),
<a name="l1137"><span class="linenum">1137</span></a>                                  ( &quot;upload_allowedext&quot;, &quot;'.(isset(<a class="var it5996" onMouseOver="hilite(5996)" onMouseOut="lolite()" onClick="logVariable('fileupload_allowedtypes')" href="../../_variables/fileupload_allowedtypes.html">$fileupload_allowedtypes</a>) ? <a class="var it5996" onMouseOver="hilite(5996)" onMouseOut="lolite()" onClick="logVariable('fileupload_allowedtypes')" href="../../_variables/fileupload_allowedtypes.html">$fileupload_allowedtypes</a> : 'jpg gif png').'&quot; ),
<a name="l1138"><span class="linenum">1138</span></a>                                  ( &quot;upload_maxkb&quot;, &quot;'.(isset(<a class="var it5997" onMouseOver="hilite(5997)" onMouseOut="lolite()" onClick="logVariable('fileupload_maxk')" href="../../_variables/fileupload_maxk.html">$fileupload_maxk</a>) ? (int)<a class="var it5997" onMouseOver="hilite(5997)" onMouseOut="lolite()" onClick="logVariable('fileupload_maxk')" href="../../_variables/fileupload_maxk.html">$fileupload_maxk</a> : '96').'&quot; )
<a name="l1139"><span class="linenum">1139</span></a>                              ';
<a name="l1140"><span class="linenum">1140</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1141"><span class="linenum">1141</span></a>  <span class="comment">        // Replace &quot;paged&quot; mode with &quot;posts&quot; // note: moved to blogsettings in 2.0</span>
<a name="l1142"><span class="linenum">1142</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_settings
<a name="l1143"><span class="linenum">1143</span></a>                                          SET set_value = &quot;posts&quot;
<a name="l1144"><span class="linenum">1144</span></a>                                      WHERE set_name = &quot;what_to_show&quot;
<a name="l1145"><span class="linenum">1145</span></a>                                        AND set_value = &quot;paged&quot;' );
<a name="l1146"><span class="linenum">1146</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1147"><span class="linenum">1147</span></a>  
<a name="l1148"><span class="linenum">1148</span></a>  
<a name="l1149"><span class="linenum">1149</span></a>          if( !isset( <a class="var it6002" onMouseOver="hilite(6002)" onMouseOut="lolite()" onClick="logVariable('tableblogusers_isuptodate')" href="../../_variables/tableblogusers_isuptodate.html">$tableblogusers_isuptodate</a> ) )
<a name="l1150"><span class="linenum">1150</span></a>          {    // We have created the blogusers table before and it's already clean!
<a name="l1151"><span class="linenum">1151</span></a>              echo 'Altering table for Blog-User permissions... ';
<a name="l1152"><span class="linenum">1152</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_coll_user_perms
<a name="l1153"><span class="linenum">1153</span></a>                                          MODIFY COLUMN bloguser_blog_ID int(11) unsigned NOT NULL default 0,
<a name="l1154"><span class="linenum">1154</span></a>                                          MODIFY COLUMN bloguser_user_ID int(11) unsigned NOT NULL default 0,
<a name="l1155"><span class="linenum">1155</span></a>                                          ADD COLUMN bloguser_perm_media_upload tinyint NOT NULL default 0,
<a name="l1156"><span class="linenum">1156</span></a>                                          ADD COLUMN bloguser_perm_media_browse tinyint NOT NULL default 0,
<a name="l1157"><span class="linenum">1157</span></a>                                          ADD COLUMN bloguser_perm_media_change tinyint NOT NULL default 0' );
<a name="l1158"><span class="linenum">1158</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1159"><span class="linenum">1159</span></a>          }
<a name="l1160"><span class="linenum">1160</span></a>  
<a name="l1161"><span class="linenum">1161</span></a>  
<a name="l1162"><span class="linenum">1162</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Altering comments table...' );
<a name="l1163"><span class="linenum">1163</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments
<a name="l1164"><span class="linenum">1164</span></a>                                        SET comment_date = \'2000-01-01 00:00:00\'
<a name="l1165"><span class="linenum">1165</span></a>                                      WHERE comment_date = \'0000-00-00 00:00:00\'' );
<a name="l1166"><span class="linenum">1166</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l1167"><span class="linenum">1167</span></a>                                      MODIFY COLUMN comment_date DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\',
<a name="l1168"><span class="linenum">1168</span></a>                                      MODIFY COLUMN comment_post_ID        int(11) unsigned NOT NULL default 0' );
<a name="l1169"><span class="linenum">1169</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1170"><span class="linenum">1170</span></a>  
<a name="l1171"><span class="linenum">1171</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '8900' );
<a name="l1172"><span class="linenum">1172</span></a>      }
<a name="l1173"><span class="linenum">1173</span></a>  
<a name="l1174"><span class="linenum">1174</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9000 )
<a name="l1175"><span class="linenum">1175</span></a>      {
<a name="l1176"><span class="linenum">1176</span></a>          echo 'Altering Posts to Categories table... ';
<a name="l1177"><span class="linenum">1177</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_postcats
<a name="l1178"><span class="linenum">1178</span></a>                                      MODIFY COLUMN postcat_post_ID int(11) unsigned NOT NULL,
<a name="l1179"><span class="linenum">1179</span></a>                                      MODIFY COLUMN postcat_cat_ID int(11) unsigned NOT NULL&quot; );
<a name="l1180"><span class="linenum">1180</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1181"><span class="linenum">1181</span></a>  
<a name="l1182"><span class="linenum">1182</span></a>  
<a name="l1183"><span class="linenum">1183</span></a>          echo 'Altering Categories table... ';
<a name="l1184"><span class="linenum">1184</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_categories
<a name="l1185"><span class="linenum">1185</span></a>                                      MODIFY COLUMN cat_ID int(11) unsigned NOT NULL auto_increment,
<a name="l1186"><span class="linenum">1186</span></a>                                      MODIFY COLUMN cat_parent_ID int(11) unsigned NULL,
<a name="l1187"><span class="linenum">1187</span></a>                                      MODIFY COLUMN cat_blog_ID int(11) unsigned NOT NULL default 2&quot; );
<a name="l1188"><span class="linenum">1188</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1189"><span class="linenum">1189</span></a>  
<a name="l1190"><span class="linenum">1190</span></a>  
<a name="l1191"><span class="linenum">1191</span></a>          echo 'Altering Locales table... ';
<a name="l1192"><span class="linenum">1192</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_locales
<a name="l1193"><span class="linenum">1193</span></a>                                      ADD loc_startofweek TINYINT UNSIGNED NOT NULL DEFAULT 1 AFTER loc_timefmt' );
<a name="l1194"><span class="linenum">1194</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1195"><span class="linenum">1195</span></a>  
<a name="l1196"><span class="linenum">1196</span></a>  
<a name="l1197"><span class="linenum">1197</span></a>          if( !isset( <a class="var it6001" onMouseOver="hilite(6001)" onMouseOut="lolite()" onClick="logVariable('tablegroups_isuptodate')" href="../../_variables/tablegroups_isuptodate.html">$tablegroups_isuptodate</a> ) )
<a name="l1198"><span class="linenum">1198</span></a>          {    // We have created the groups table before and it's already clean!
<a name="l1199"><span class="linenum">1199</span></a>              echo 'Altering Groups table... ';
<a name="l1200"><span class="linenum">1200</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_groups
<a name="l1201"><span class="linenum">1201</span></a>                                          ADD COLUMN grp_perm_admin enum('none','hidden','visible') NOT NULL default 'visible' AFTER grp_name,
<a name="l1202"><span class="linenum">1202</span></a>                                          ADD COLUMN grp_perm_files enum('none','view','add','edit') NOT NULL default 'none'&quot; );
<a name="l1203"><span class="linenum">1203</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1204"><span class="linenum">1204</span></a>          }
<a name="l1205"><span class="linenum">1205</span></a>  
<a name="l1206"><span class="linenum">1206</span></a>  
<a name="l1207"><span class="linenum">1207</span></a>          echo 'Creating table for Post Links... ';
<a name="l1208"><span class="linenum">1208</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_links (
<a name="l1209"><span class="linenum">1209</span></a>                                      link_ID               int(11) unsigned  not null AUTO_INCREMENT,
<a name="l1210"><span class="linenum">1210</span></a>                                      link_datecreated      datetime          not null,
<a name="l1211"><span class="linenum">1211</span></a>                                      link_datemodified     datetime          not null,
<a name="l1212"><span class="linenum">1212</span></a>                                      link_creator_user_ID  int(11) unsigned  not null,
<a name="l1213"><span class="linenum">1213</span></a>                                      link_lastedit_user_ID int(11) unsigned  not null,
<a name="l1214"><span class="linenum">1214</span></a>                                      link_item_ID          int(11) unsigned  NOT NULL,
<a name="l1215"><span class="linenum">1215</span></a>                                      link_dest_item_ID     int(11) unsigned  NULL,
<a name="l1216"><span class="linenum">1216</span></a>                                      link_file_ID          int(11) unsigned  NULL,
<a name="l1217"><span class="linenum">1217</span></a>                                      link_ltype_ID         int(11) unsigned  NOT NULL default 1,
<a name="l1218"><span class="linenum">1218</span></a>                                      link_external_url     VARCHAR(255)      NULL,
<a name="l1219"><span class="linenum">1219</span></a>                                      link_title            TEXT              NULL,
<a name="l1220"><span class="linenum">1220</span></a>                                      PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (link_ID),
<a name="l1221"><span class="linenum">1221</span></a>                                      INDEX link_item_ID( link_item_ID ),
<a name="l1222"><span class="linenum">1222</span></a>                                      INDEX link_dest_item_ID (link_dest_item_ID),
<a name="l1223"><span class="linenum">1223</span></a>                                      INDEX link_file_ID (link_file_ID)
<a name="l1224"><span class="linenum">1224</span></a>                                  )&quot; );
<a name="l1225"><span class="linenum">1225</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1226"><span class="linenum">1226</span></a>  
<a name="l1227"><span class="linenum">1227</span></a>  
<a name="l1228"><span class="linenum">1228</span></a>          echo 'Creating default Post Types... ';
<a name="l1229"><span class="linenum">1229</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l1230"><span class="linenum">1230</span></a>              INSERT INTO {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posttypes ( ptyp_ID, ptyp_name )
<a name="l1231"><span class="linenum">1231</span></a>              VALUES ( 1, 'Post' ),
<a name="l1232"><span class="linenum">1232</span></a>                     ( 2, 'Link' )&quot; );
<a name="l1233"><span class="linenum">1233</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1234"><span class="linenum">1234</span></a>  
<a name="l1235"><span class="linenum">1235</span></a>  
<a name="l1236"><span class="linenum">1236</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9000' );
<a name="l1237"><span class="linenum">1237</span></a>      }
<a name="l1238"><span class="linenum">1238</span></a>  
<a name="l1239"><span class="linenum">1239</span></a>  
<a name="l1240"><span class="linenum">1240</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9100 )
<a name="l1241"><span class="linenum">1241</span></a>      {    // 1.8 ALPHA
<a name="l1242"><span class="linenum">1242</span></a>  
<a name="l1243"><span class="linenum">1243</span></a>          echo 'Creating table for plugin events... ';
<a name="l1244"><span class="linenum">1244</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1245"><span class="linenum">1245</span></a>              CREATE TABLE T_pluginevents(
<a name="l1246"><span class="linenum">1246</span></a>                      pevt_plug_ID INT(11) UNSIGNED NOT NULL,
<a name="l1247"><span class="linenum">1247</span></a>                      pevt_event VARCHAR(40) NOT NULL,
<a name="l1248"><span class="linenum">1248</span></a>                      pevt_enabled TINYINT NOT NULL DEFAULT 1,
<a name="l1249"><span class="linenum">1249</span></a>                      PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a>( pevt_plug_ID, pevt_event )
<a name="l1250"><span class="linenum">1250</span></a>                  )' );
<a name="l1251"><span class="linenum">1251</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1252"><span class="linenum">1252</span></a>  
<a name="l1253"><span class="linenum">1253</span></a>  
<a name="l1254"><span class="linenum">1254</span></a>          echo 'Altering Links table... ';
<a name="l1255"><span class="linenum">1255</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_links
<a name="l1256"><span class="linenum">1256</span></a>                       CHANGE link_item_ID link_itm_ID INT( 11 ) UNSIGNED NOT NULL,
<a name="l1257"><span class="linenum">1257</span></a>                       CHANGE link_dest_item_ID link_dest_itm_ID INT( 11 ) UNSIGNED NULL' );
<a name="l1258"><span class="linenum">1258</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1259"><span class="linenum">1259</span></a>  
<a name="l1260"><span class="linenum">1260</span></a>  
<a name="l1261"><span class="linenum">1261</span></a>          if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &gt;= 9000 )
<a name="l1262"><span class="linenum">1262</span></a>          { // sess_agnt_ID used in Phoenix-Alpha
<a name="l1263"><span class="linenum">1263</span></a>              echo 'Altering sessions table... ';
<a name="l1264"><span class="linenum">1264</span></a>              <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;
<a name="l1265"><span class="linenum">1265</span></a>                      ALTER TABLE T_sessions
<a name="l1266"><span class="linenum">1266</span></a>                       DROP COLUMN sess_agnt_ID&quot;;
<a name="l1267"><span class="linenum">1267</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1268"><span class="linenum">1268</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1269"><span class="linenum">1269</span></a>          }
<a name="l1270"><span class="linenum">1270</span></a>  
<a name="l1271"><span class="linenum">1271</span></a>          echo 'Creating table for file types... ';
<a name="l1272"><span class="linenum">1272</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1273"><span class="linenum">1273</span></a>                  CREATE TABLE T_filetypes (
<a name="l1274"><span class="linenum">1274</span></a>                      ftyp_ID int(11) unsigned NOT NULL auto_increment,
<a name="l1275"><span class="linenum">1275</span></a>                      ftyp_extensions varchar(30) NOT NULL,
<a name="l1276"><span class="linenum">1276</span></a>                      ftyp_name varchar(30) NOT NULL,
<a name="l1277"><span class="linenum">1277</span></a>                      ftyp_mimetype varchar(50) NOT NULL,
<a name="l1278"><span class="linenum">1278</span></a>                      ftyp_icon varchar(20) default NULL,
<a name="l1279"><span class="linenum">1279</span></a>                      ftyp_viewtype varchar(10) NOT NULL,
<a name="l1280"><span class="linenum">1280</span></a>                      ftyp_allowed tinyint(1) NOT NULL default 0,
<a name="l1281"><span class="linenum">1281</span></a>                      PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (ftyp_ID)
<a name="l1282"><span class="linenum">1282</span></a>                  )' );
<a name="l1283"><span class="linenum">1283</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1284"><span class="linenum">1284</span></a>  
<a name="l1285"><span class="linenum">1285</span></a>          echo 'Creating default file types... ';
<a name="l1286"><span class="linenum">1286</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;INSERT INTO T_filetypes
<a name="l1287"><span class="linenum">1287</span></a>                  (ftyp_ID, ftyp_extensions, ftyp_name, ftyp_mimetype, ftyp_icon, ftyp_viewtype, ftyp_allowed)
<a name="l1288"><span class="linenum">1288</span></a>              VALUES
<a name="l1289"><span class="linenum">1289</span></a>                  (1, 'gif', 'GIF image', 'image/gif', 'image2.png', 'image', 1),
<a name="l1290"><span class="linenum">1290</span></a>                  (2, 'png', 'PNG image', 'image/png', 'image2.png', 'image', 1),
<a name="l1291"><span class="linenum">1291</span></a>                  (3, 'jpg jpeg', 'JPEG image', 'image/jpeg', 'image2.png', 'image', 1),
<a name="l1292"><span class="linenum">1292</span></a>                  (4, 'txt', 'Text file', 'text/plain', 'document.png', 'text', 1),
<a name="l1293"><span class="linenum">1293</span></a>                  (5, 'htm html', 'HTML file', 'text/html', 'html.png', 'browser', 0),
<a name="l1294"><span class="linenum">1294</span></a>                  (6, 'pdf', 'PDF file', 'application/pdf', 'pdf.png', 'browser', 1),
<a name="l1295"><span class="linenum">1295</span></a>                  (7, 'doc', 'Microsoft Word file', 'application/msword', 'doc.gif', 'external', 1),
<a name="l1296"><span class="linenum">1296</span></a>                  (8, 'xls', 'Microsoft Excel file', 'application/vnd.ms-excel', 'xls.gif', 'external', 1),
<a name="l1297"><span class="linenum">1297</span></a>                  (9, 'ppt', 'Powerpoint', 'application/vnd.ms-powerpoint', 'ppt.gif', 'external', 1),
<a name="l1298"><span class="linenum">1298</span></a>                  (10, 'pps', 'Slideshow', 'pps', 'pps.gif', 'external', 1),
<a name="l1299"><span class="linenum">1299</span></a>                  (11, 'zip', 'ZIP archive', 'application/zip', 'zip.gif', 'external', 1),
<a name="l1300"><span class="linenum">1300</span></a>                  (12, 'php php3 php4 php5 php6', 'PHP script', 'application/x-httpd-php', 'php.gif', 'text', 0),
<a name="l1301"><span class="linenum">1301</span></a>                  (13, 'css', 'Style sheet', 'text/css', '', 'text', 1)
<a name="l1302"><span class="linenum">1302</span></a>              &quot; );
<a name="l1303"><span class="linenum">1303</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1304"><span class="linenum">1304</span></a>  
<a name="l1305"><span class="linenum">1305</span></a>          echo 'Giving Administrator Group edit perms on files... ';
<a name="l1306"><span class="linenum">1306</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_groups
<a name="l1307"><span class="linenum">1307</span></a>                       SET grp_perm_files = &quot;edit&quot;
<a name="l1308"><span class="linenum">1308</span></a>                       WHERE grp_ID = 1' );
<a name="l1309"><span class="linenum">1309</span></a>  <span class="comment">         // Later versions give 'all' on install, but we won't upgrade to that for security.</span>
<a name="l1310"><span class="linenum">1310</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1311"><span class="linenum">1311</span></a>  
<a name="l1312"><span class="linenum">1312</span></a>          echo 'Giving Administrator Group full perms on media for all blogs... ';
<a name="l1313"><span class="linenum">1313</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l1314"><span class="linenum">1314</span></a>                       SET bloggroup_perm_media_upload = 1,
<a name="l1315"><span class="linenum">1315</span></a>                           bloggroup_perm_media_browse = 1,
<a name="l1316"><span class="linenum">1316</span></a>                           bloggroup_perm_media_change = 1
<a name="l1317"><span class="linenum">1317</span></a>                       WHERE bloggroup_group_ID = 1' );
<a name="l1318"><span class="linenum">1318</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1319"><span class="linenum">1319</span></a>  
<a name="l1320"><span class="linenum">1320</span></a>  
<a name="l1321"><span class="linenum">1321</span></a>          if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &gt;= 9000 )
<a name="l1322"><span class="linenum">1322</span></a>          { // Uninstall all ALPHA (potentially incompatible) plugins
<a name="l1323"><span class="linenum">1323</span></a>              echo 'Uninstalling all existing plugins... ';
<a name="l1324"><span class="linenum">1324</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_plugins WHERE 1=1' );
<a name="l1325"><span class="linenum">1325</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1326"><span class="linenum">1326</span></a>          }
<a name="l1327"><span class="linenum">1327</span></a>  
<a name="l1328"><span class="linenum">1328</span></a>  <span class="comment">        // NOTE: basic plugins get installed separatly for upgrade and install..</span>
<a name="l1329"><span class="linenum">1329</span></a>  
<a name="l1330"><span class="linenum">1330</span></a>  
<a name="l1331"><span class="linenum">1331</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9100' );
<a name="l1332"><span class="linenum">1332</span></a>      }
<a name="l1333"><span class="linenum">1333</span></a>  
<a name="l1334"><span class="linenum">1334</span></a>  
<a name="l1335"><span class="linenum">1335</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9190 ) // Note: changed from 9200, to include the block below, if DB is not yet on 1.8
<a name="l1336"><span class="linenum">1336</span></a>      {    // 1.8 ALPHA (block #2)
<a name="l1337"><span class="linenum">1337</span></a>          echo 'Altering Posts table... ';
<a name="l1338"><span class="linenum">1338</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l1339"><span class="linenum">1339</span></a>                       CHANGE post_comments post_comment_status ENUM('disabled', 'open', 'closed') NOT NULL DEFAULT 'open'&quot; );
<a name="l1340"><span class="linenum">1340</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1341"><span class="linenum">1341</span></a>  
<a name="l1342"><span class="linenum">1342</span></a>  
<a name="l1343"><span class="linenum">1343</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9190' );
<a name="l1344"><span class="linenum">1344</span></a>      }
<a name="l1345"><span class="linenum">1345</span></a>  
<a name="l1346"><span class="linenum">1346</span></a>  
<a name="l1347"><span class="linenum">1347</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9192 )
<a name="l1348"><span class="linenum">1348</span></a>      { // 1.8 ALPHA (block #3) - The payload that <a class="function" onClick="logFunction('db_delta')" href="../../_functions/db_delta.html" onMouseOver="funcPopup(event,'db_delta')">db_delta</a>() handled before
<a name="l1349"><span class="linenum">1349</span></a>  
<a name="l1350"><span class="linenum">1350</span></a>  <span class="comment">        // This is a fix, which broke upgrade to 1.8 (from 1.6) in MySQL strict mode (inserted after 1.8 got released!):</span>
<a name="l1351"><span class="linenum">1351</span></a>          if( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( 'SHOW COLUMNS FROM T_hitlog LIKE &quot;hit_referer_type&quot;' ) )
<a name="l1352"><span class="linenum">1352</span></a>          { // a niiiiiiiice extra check :p
<a name="l1353"><span class="linenum">1353</span></a>              <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Deleting all &quot;spam&quot; hitlog entries... ' );
<a name="l1354"><span class="linenum">1354</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1355"><span class="linenum">1355</span></a>                      DELETE FROM T_hitlog
<a name="l1356"><span class="linenum">1356</span></a>                       WHERE hit_referer_type = &quot;spam&quot;' );
<a name="l1357"><span class="linenum">1357</span></a>              <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1358"><span class="linenum">1358</span></a>          }
<a name="l1359"><span class="linenum">1359</span></a>  
<a name="l1360"><span class="linenum">1360</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table... ' );
<a name="l1361"><span class="linenum">1361</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users
<a name="l1362"><span class="linenum">1362</span></a>                                          CHANGE COLUMN user_firstname user_firstname varchar(50) NULL,
<a name="l1363"><span class="linenum">1363</span></a>                                          CHANGE COLUMN user_lastname user_lastname varchar(50) NULL,
<a name="l1364"><span class="linenum">1364</span></a>                                          CHANGE COLUMN user_nickname user_nickname varchar(50) NULL,
<a name="l1365"><span class="linenum">1365</span></a>                                          CHANGE COLUMN user_icq user_icq int(11) unsigned NULL,
<a name="l1366"><span class="linenum">1366</span></a>                                          CHANGE COLUMN user_email user_email varchar(255) NOT NULL,
<a name="l1367"><span class="linenum">1367</span></a>                                          CHANGE COLUMN user_url user_url varchar(255) NULL,
<a name="l1368"><span class="linenum">1368</span></a>                                          CHANGE COLUMN user_ip user_ip varchar(15) NULL,
<a name="l1369"><span class="linenum">1369</span></a>                                          CHANGE COLUMN user_domain user_domain varchar(200) NULL,
<a name="l1370"><span class="linenum">1370</span></a>                                          CHANGE COLUMN user_browser user_browser varchar(200) NULL,
<a name="l1371"><span class="linenum">1371</span></a>                                          CHANGE COLUMN user_aim user_aim varchar(50) NULL,
<a name="l1372"><span class="linenum">1372</span></a>                                          CHANGE COLUMN user_msn user_msn varchar(100) NULL,
<a name="l1373"><span class="linenum">1373</span></a>                                          CHANGE COLUMN user_yim user_yim varchar(50) NULL,
<a name="l1374"><span class="linenum">1374</span></a>                                          ADD COLUMN user_allow_msgform TINYINT NOT NULL DEFAULT \'1\' AFTER user_idmode,
<a name="l1375"><span class="linenum">1375</span></a>                                          ADD COLUMN user_validated TINYINT(1) NOT NULL DEFAULT 0 AFTER user_grp_ID' );
<a name="l1376"><span class="linenum">1376</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1377"><span class="linenum">1377</span></a>  
<a name="l1378"><span class="linenum">1378</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating blog settings...' );
<a name="l1379"><span class="linenum">1379</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_coll_settings (
<a name="l1380"><span class="linenum">1380</span></a>                                                              cset_coll_ID INT(11) UNSIGNED NOT NULL,
<a name="l1381"><span class="linenum">1381</span></a>                                                              cset_name    VARCHAR( 30 ) NOT NULL,
<a name="l1382"><span class="linenum">1382</span></a>                                                              cset_value   VARCHAR( 255 ) NULL,
<a name="l1383"><span class="linenum">1383</span></a>                                                              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( cset_coll_ID, cset_name )
<a name="l1384"><span class="linenum">1384</span></a>                                              )' );
<a name="l1385"><span class="linenum">1385</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1386"><span class="linenum">1386</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9192' );
<a name="l1387"><span class="linenum">1387</span></a>      }
<a name="l1388"><span class="linenum">1388</span></a>  
<a name="l1389"><span class="linenum">1389</span></a>  
<a name="l1390"><span class="linenum">1390</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9195 )
<a name="l1391"><span class="linenum">1391</span></a>      {
<a name="l1392"><span class="linenum">1392</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading posts table... ' );
<a name="l1393"><span class="linenum">1393</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'posts
<a name="l1394"><span class="linenum">1394</span></a>                                          CHANGE COLUMN post_content post_content         text NULL,
<a name="l1395"><span class="linenum">1395</span></a>                                          CHANGE COLUMN post_url post_url                      VARCHAR(255) NULL DEFAULT NULL,
<a name="l1396"><span class="linenum">1396</span></a>                                          CHANGE COLUMN post_renderers post_renderers     TEXT NOT NULL' );
<a name="l1397"><span class="linenum">1397</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1398"><span class="linenum">1398</span></a>  
<a name="l1399"><span class="linenum">1399</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading comments table... ' );
<a name="l1400"><span class="linenum">1400</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l1401"><span class="linenum">1401</span></a>                                          CHANGE COLUMN comment_author_email comment_author_email varchar(255) NULL,
<a name="l1402"><span class="linenum">1402</span></a>                                          CHANGE COLUMN comment_author_url comment_author_url varchar(255) NULL,
<a name="l1403"><span class="linenum">1403</span></a>                                          ADD COLUMN comment_spam_karma TINYINT NULL AFTER comment_karma,
<a name="l1404"><span class="linenum">1404</span></a>                                          ADD COLUMN comment_allow_msgform TINYINT NOT NULL DEFAULT 0 AFTER comment_spam_karma' );
<a name="l1405"><span class="linenum">1405</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1406"><span class="linenum">1406</span></a>  
<a name="l1407"><span class="linenum">1407</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9195' );
<a name="l1408"><span class="linenum">1408</span></a>      }
<a name="l1409"><span class="linenum">1409</span></a>  
<a name="l1410"><span class="linenum">1410</span></a>  
<a name="l1411"><span class="linenum">1411</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9200 )
<a name="l1412"><span class="linenum">1412</span></a>      {
<a name="l1413"><span class="linenum">1413</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading hitlog table... ' );
<a name="l1414"><span class="linenum">1414</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_hitlog
<a name="l1415"><span class="linenum">1415</span></a>                                          CHANGE COLUMN hit_referer_type hit_referer_type   ENUM(\'search\',\'blacklist\',\'referer\',\'direct\') NOT NULL,
<a name="l1416"><span class="linenum">1416</span></a>                                          ADD COLUMN hit_agnt_ID        INT UNSIGNED NULL AFTER hit_remote_addr' );
<a name="l1417"><span class="linenum">1417</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1418"><span class="linenum">1418</span></a>  
<a name="l1419"><span class="linenum">1419</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading post links table... ' );
<a name="l1420"><span class="linenum">1420</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_links
<a name="l1421"><span class="linenum">1421</span></a>                                          ADD INDEX link_itm_ID( link_itm_ID ),
<a name="l1422"><span class="linenum">1422</span></a>                                          ADD INDEX link_dest_itm_ID (link_dest_itm_ID)' );
<a name="l1423"><span class="linenum">1423</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1424"><span class="linenum">1424</span></a>  
<a name="l1425"><span class="linenum">1425</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading plugins table... ' );
<a name="l1426"><span class="linenum">1426</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_plugins
<a name="l1427"><span class="linenum">1427</span></a>                                          CHANGE COLUMN plug_priority plug_priority        TINYINT NOT NULL default 50,
<a name="l1428"><span class="linenum">1428</span></a>                                          ADD COLUMN plug_code            VARCHAR(32) NULL AFTER plug_classname,
<a name="l1429"><span class="linenum">1429</span></a>                                          ADD COLUMN plug_apply_rendering ENUM( \'stealth\', \'always\', \'opt-out\', \'opt-in\', \'lazy\', \'never\' ) NOT NULL DEFAULT \'never\' AFTER plug_code,
<a name="l1430"><span class="linenum">1430</span></a>                                          ADD COLUMN plug_version         VARCHAR(42) NOT NULL default \'0\' AFTER plug_apply_rendering,
<a name="l1431"><span class="linenum">1431</span></a>                                          ADD COLUMN plug_status          ENUM( \'enabled\', \'disabled\', \'needs_config\', \'broken\' ) NOT NULL AFTER plug_version,
<a name="l1432"><span class="linenum">1432</span></a>                                          ADD COLUMN plug_spam_weight     TINYINT UNSIGNED NOT NULL DEFAULT 1 AFTER plug_status,
<a name="l1433"><span class="linenum">1433</span></a>                                          ADD UNIQUE plug_code( plug_code ),
<a name="l1434"><span class="linenum">1434</span></a>                                          ADD INDEX plug_status( plug_status )' );
<a name="l1435"><span class="linenum">1435</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1436"><span class="linenum">1436</span></a>  
<a name="l1437"><span class="linenum">1437</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating plugin settings table... ' );
<a name="l1438"><span class="linenum">1438</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_pluginsettings (
<a name="l1439"><span class="linenum">1439</span></a>                                                              pset_plug_ID INT(11) UNSIGNED NOT NULL,
<a name="l1440"><span class="linenum">1440</span></a>                                                              pset_name VARCHAR( 30 ) NOT NULL,
<a name="l1441"><span class="linenum">1441</span></a>                                                              pset_value TEXT NULL,
<a name="l1442"><span class="linenum">1442</span></a>                                                              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( pset_plug_ID, pset_name )
<a name="l1443"><span class="linenum">1443</span></a>                                              )' );
<a name="l1444"><span class="linenum">1444</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1445"><span class="linenum">1445</span></a>  
<a name="l1446"><span class="linenum">1446</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating plugin user settings table... ' );
<a name="l1447"><span class="linenum">1447</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_pluginusersettings (
<a name="l1448"><span class="linenum">1448</span></a>                                                              puset_plug_ID INT(11) UNSIGNED NOT NULL,
<a name="l1449"><span class="linenum">1449</span></a>                                                              puset_user_ID INT(11) UNSIGNED NOT NULL,
<a name="l1450"><span class="linenum">1450</span></a>                                                              puset_name VARCHAR( 30 ) NOT NULL,
<a name="l1451"><span class="linenum">1451</span></a>                                                              puset_value TEXT NULL,
<a name="l1452"><span class="linenum">1452</span></a>                                                              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( puset_plug_ID, puset_user_ID, puset_name )
<a name="l1453"><span class="linenum">1453</span></a>                                              )' );
<a name="l1454"><span class="linenum">1454</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1455"><span class="linenum">1455</span></a>  
<a name="l1456"><span class="linenum">1456</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating scheduled tasks table... ' );
<a name="l1457"><span class="linenum">1457</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_cron__task(
<a name="l1458"><span class="linenum">1458</span></a>                                                   ctsk_ID              int(10) unsigned      not null AUTO_INCREMENT,
<a name="l1459"><span class="linenum">1459</span></a>                                                   ctsk_start_datetime  datetime              not null,
<a name="l1460"><span class="linenum">1460</span></a>                                                   ctsk_repeat_after    int(10) unsigned,
<a name="l1461"><span class="linenum">1461</span></a>                                                   ctsk_name            varchar(50)           not null,
<a name="l1462"><span class="linenum">1462</span></a>                                                   ctsk_controller      varchar(50)           not null,
<a name="l1463"><span class="linenum">1463</span></a>                                                   ctsk_params          text,
<a name="l1464"><span class="linenum">1464</span></a>                                                   primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (ctsk_ID)
<a name="l1465"><span class="linenum">1465</span></a>                                              )' );
<a name="l1466"><span class="linenum">1466</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1467"><span class="linenum">1467</span></a>  
<a name="l1468"><span class="linenum">1468</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating cron log table... ' );
<a name="l1469"><span class="linenum">1469</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_cron__log(
<a name="l1470"><span class="linenum">1470</span></a>                                                               clog_ctsk_ID              int(10) unsigned   not null,
<a name="l1471"><span class="linenum">1471</span></a>                                                               clog_realstart_datetime   datetime           not null,
<a name="l1472"><span class="linenum">1472</span></a>                                                               clog_realstop_datetime    datetime,
<a name="l1473"><span class="linenum">1473</span></a>                                                               clog_status               enum(\'started\',\'finished\',\'error\',\'timeout\') not null default \'started\',
<a name="l1474"><span class="linenum">1474</span></a>                                                               clog_messages             text,
<a name="l1475"><span class="linenum">1475</span></a>                                                               primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (clog_ctsk_ID)
<a name="l1476"><span class="linenum">1476</span></a>                                              )' );
<a name="l1477"><span class="linenum">1477</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1478"><span class="linenum">1478</span></a>  
<a name="l1479"><span class="linenum">1479</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blogs table... ' );
<a name="l1480"><span class="linenum">1480</span></a>  <span class="comment">        // blog_allowpingbacks is &quot;DEFAULT 1&quot; in the 0.9.0.11 dump.. - changed in 0.9.2?!</span>
<a name="l1481"><span class="linenum">1481</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_blogs
<a name="l1482"><span class="linenum">1482</span></a>                                          ALTER COLUMN blog_allowpingbacks SET DEFAULT 0,
<a name="l1483"><span class="linenum">1483</span></a>                                      CHANGE COLUMN blog_media_subdir blog_media_subdir VARCHAR( 255 ) NULL,
<a name="l1484"><span class="linenum">1484</span></a>                                          CHANGE COLUMN blog_media_fullpath blog_media_fullpath VARCHAR( 255 ) NULL,
<a name="l1485"><span class="linenum">1485</span></a>                                          CHANGE COLUMN blog_media_url blog_media_url VARCHAR( 255 ) NULL' );
<a name="l1486"><span class="linenum">1486</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l1487"><span class="linenum">1487</span></a>  
<a name="l1488"><span class="linenum">1488</span></a>  
<a name="l1489"><span class="linenum">1489</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9200' ); <span class="comment">// at 1.8 &quot;Summer Beta&quot; release</span>
<a name="l1490"><span class="linenum">1490</span></a>      }
<a name="l1491"><span class="linenum">1491</span></a>  
<a name="l1492"><span class="linenum">1492</span></a>  
<a name="l1493"><span class="linenum">1493</span></a>  <span class="comment">    // ____________________________ 1.9: ____________________________</span>
<a name="l1494"><span class="linenum">1494</span></a>  
<a name="l1495"><span class="linenum">1495</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9290 )
<a name="l1496"><span class="linenum">1496</span></a>      {
<a name="l1497"><span class="linenum">1497</span></a>          echo 'Post-fix hit_referer_type == NULL... ';
<a name="l1498"><span class="linenum">1498</span></a>  <span class="comment">        // If you've upgraded from 1.6 to 1.8 and it did not break because of strict mode, there are now NULL values for what &quot;spam&quot; was:</span>
<a name="l1499"><span class="linenum">1499</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1500"><span class="linenum">1500</span></a>                      DELETE FROM T_hitlog
<a name="l1501"><span class="linenum">1501</span></a>                       WHERE hit_referer_type IS NULL' );
<a name="l1502"><span class="linenum">1502</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1503"><span class="linenum">1503</span></a>  
<a name="l1504"><span class="linenum">1504</span></a>          echo 'Marking administrator accounts as validated... ';
<a name="l1505"><span class="linenum">1505</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1506"><span class="linenum">1506</span></a>                  UPDATE T_users
<a name="l1507"><span class="linenum">1507</span></a>                     SET user_validated = 1
<a name="l1508"><span class="linenum">1508</span></a>                   WHERE user_grp_ID = 1' );
<a name="l1509"><span class="linenum">1509</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1510"><span class="linenum">1510</span></a>  
<a name="l1511"><span class="linenum">1511</span></a>          echo 'Converting auto_prune_stats setting... ';
<a name="l1512"><span class="linenum">1512</span></a>          <a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('old_auto_prune_stats')" href="../../_variables/old_auto_prune_stats.html">$old_auto_prune_stats</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( '
<a name="l1513"><span class="linenum">1513</span></a>                  SELECT set_value
<a name="l1514"><span class="linenum">1514</span></a>                    FROM T_settings
<a name="l1515"><span class="linenum">1515</span></a>                   WHERE set_name = &quot;auto_prune_stats&quot;' );
<a name="l1516"><span class="linenum">1516</span></a>          if( ! <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('old_auto_prune_stats')" href="../../_variables/old_auto_prune_stats.html">$old_auto_prune_stats</a>) &amp;&amp; <a class="var it6008" onMouseOver="hilite(6008)" onMouseOut="lolite()" onClick="logVariable('old_auto_prune_stats')" href="../../_variables/old_auto_prune_stats.html">$old_auto_prune_stats</a> &lt; 1 )
<a name="l1517"><span class="linenum">1517</span></a>          { // This means it has been disabled before, so set auto_prune_stats_mode to &quot;off&quot;!
<a name="l1518"><span class="linenum">1518</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1519"><span class="linenum">1519</span></a>                      REPLACE INTO T_settings ( set_name, set_value )
<a name="l1520"><span class="linenum">1520</span></a>                       VALUES ( &quot;auto_prune_stats_mode&quot;, &quot;off&quot; )' );
<a name="l1521"><span class="linenum">1521</span></a>          }
<a name="l1522"><span class="linenum">1522</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1523"><span class="linenum">1523</span></a>  
<a name="l1524"><span class="linenum">1524</span></a>          echo 'Converting time_difference from hours to seconds... ';
<a name="l1525"><span class="linenum">1525</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_settings SET set_value = set_value*3600 WHERE set_name = &quot;time_difference&quot;' );
<a name="l1526"><span class="linenum">1526</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1527"><span class="linenum">1527</span></a>  
<a name="l1528"><span class="linenum">1528</span></a>  
<a name="l1529"><span class="linenum">1529</span></a>          echo 'Updating hitlog capabilities... ';
<a name="l1530"><span class="linenum">1530</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1531"><span class="linenum">1531</span></a>                  ALTER TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'useragents ADD INDEX agnt_type ( agnt_type )' );
<a name="l1532"><span class="linenum">1532</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1533"><span class="linenum">1533</span></a>                  ALTER TABLE T_hitlog
<a name="l1534"><span class="linenum">1534</span></a>                    CHANGE COLUMN hit_referer_type hit_referer_type ENUM(\'search\',\'blacklist\',\'referer\',\'direct\',\'self\',\'admin\') NOT NULL' );
<a name="l1535"><span class="linenum">1535</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1536"><span class="linenum">1536</span></a>  
<a name="l1537"><span class="linenum">1537</span></a>          echo 'Updating plugin capabilities... ';
<a name="l1538"><span class="linenum">1538</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1539"><span class="linenum">1539</span></a>                  ALTER TABLE T_plugins
<a name="l1540"><span class="linenum">1540</span></a>                      MODIFY COLUMN plug_status ENUM( \'enabled\', \'disabled\', \'needs_config\', \'broken\' ) NOT NULL' );
<a name="l1541"><span class="linenum">1541</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1542"><span class="linenum">1542</span></a>  
<a name="l1543"><span class="linenum">1543</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9290' );
<a name="l1544"><span class="linenum">1544</span></a>      }
<a name="l1545"><span class="linenum">1545</span></a>  
<a name="l1546"><span class="linenum">1546</span></a>  
<a name="l1547"><span class="linenum">1547</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9300 )
<a name="l1548"><span class="linenum">1548</span></a>      {
<a name="l1549"><span class="linenum">1549</span></a>  <span class="comment">        // This can be so long, it needs its own checkpoint protected block in case of failure</span>
<a name="l1550"><span class="linenum">1550</span></a>          echo 'Updating hitlog indexes... ';
<a name="l1551"><span class="linenum">1551</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1552"><span class="linenum">1552</span></a>                  ALTER TABLE T_hitlog
<a name="l1553"><span class="linenum">1553</span></a>                    ADD INDEX hit_agnt_ID        ( hit_agnt_ID ),
<a name="l1554"><span class="linenum">1554</span></a>                    ADD INDEX hit_uri            ( hit_uri ),
<a name="l1555"><span class="linenum">1555</span></a>                    ADD INDEX hit_referer_dom_ID ( hit_referer_dom_ID )
<a name="l1556"><span class="linenum">1556</span></a>                  ' );
<a name="l1557"><span class="linenum">1557</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1558"><span class="linenum">1558</span></a>  
<a name="l1559"><span class="linenum">1559</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9300' );
<a name="l1560"><span class="linenum">1560</span></a>      }
<a name="l1561"><span class="linenum">1561</span></a>  
<a name="l1562"><span class="linenum">1562</span></a>  
<a name="l1563"><span class="linenum">1563</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9310 )
<a name="l1564"><span class="linenum">1564</span></a>      {
<a name="l1565"><span class="linenum">1565</span></a>          echo 'Updating basedomains... ';
<a name="l1566"><span class="linenum">1566</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1567"><span class="linenum">1567</span></a>                  UPDATE T_basedomains
<a name="l1568"><span class="linenum">1568</span></a>                     SET dom_status = &quot;unknown&quot;' );        <span class="comment">// someone has filled this up with junk blacklists before</span>
<a name="l1569"><span class="linenum">1569</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1570"><span class="linenum">1570</span></a>                  ALTER TABLE T_basedomains  ADD INDEX dom_type (dom_type)' );
<a name="l1571"><span class="linenum">1571</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1572"><span class="linenum">1572</span></a>  
<a name="l1573"><span class="linenum">1573</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9310' );
<a name="l1574"><span class="linenum">1574</span></a>      }
<a name="l1575"><span class="linenum">1575</span></a>  
<a name="l1576"><span class="linenum">1576</span></a>  
<a name="l1577"><span class="linenum">1577</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9315 )
<a name="l1578"><span class="linenum">1578</span></a>      {
<a name="l1579"><span class="linenum">1579</span></a>          echo 'Altering locales table... ';
<a name="l1580"><span class="linenum">1580</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_locales CHANGE COLUMN loc_datefmt loc_datefmt varchar(20) NOT NULL default 'y-m-d'&quot; );
<a name="l1581"><span class="linenum">1581</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_locales CHANGE COLUMN loc_timefmt loc_timefmt varchar(20) NOT NULL default 'H:i:s'&quot; );
<a name="l1582"><span class="linenum">1582</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1583"><span class="linenum">1583</span></a>  
<a name="l1584"><span class="linenum">1584</span></a>          echo 'Creating item prerendering cache table... ';
<a name="l1585"><span class="linenum">1585</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l1586"><span class="linenum">1586</span></a>                  CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}item__prerendering(
<a name="l1587"><span class="linenum">1587</span></a>                      itpr_itm_ID                   INT(11) UNSIGNED NOT NULL,
<a name="l1588"><span class="linenum">1588</span></a>                      itpr_format                   ENUM('htmlbody', 'entityencoded', 'xml', 'text') NOT NULL,
<a name="l1589"><span class="linenum">1589</span></a>                      itpr_renderers                TEXT NOT NULL,
<a name="l1590"><span class="linenum">1590</span></a>                      itpr_content_prerendered      TEXT NULL,
<a name="l1591"><span class="linenum">1591</span></a>                      itpr_datemodified             TIMESTAMP NOT NULL,
<a name="l1592"><span class="linenum">1592</span></a>                      PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (itpr_itm_ID, itpr_format)
<a name="l1593"><span class="linenum">1593</span></a>                  )&quot; );
<a name="l1594"><span class="linenum">1594</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1595"><span class="linenum">1595</span></a>  
<a name="l1596"><span class="linenum">1596</span></a>          echo 'Altering plugins table... ';
<a name="l1597"><span class="linenum">1597</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_plugins ADD COLUMN plug_name            VARCHAR(255) NULL default NULL AFTER plug_version&quot; );
<a name="l1598"><span class="linenum">1598</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_plugins ADD COLUMN plug_shortdesc       VARCHAR(255) NULL default NULL AFTER plug_name&quot; );
<a name="l1599"><span class="linenum">1599</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1600"><span class="linenum">1600</span></a>  
<a name="l1601"><span class="linenum">1601</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9315' );
<a name="l1602"><span class="linenum">1602</span></a>      }
<a name="l1603"><span class="linenum">1603</span></a>  
<a name="l1604"><span class="linenum">1604</span></a>  
<a name="l1605"><span class="linenum">1605</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9320 )
<a name="l1606"><span class="linenum">1606</span></a>      { // Dropping hit_datetime because it's very slow on <a class="function" onClick="logFunction('INSERT')" href="../../_functions/insert.html" onMouseOver="funcPopup(event,'insert')">INSERT</a> (dh)
<a name="l1607"><span class="linenum">1607</span></a>  <span class="comment">        // This can be so long, it needs its own checkpoint protected block in case of failure</span>
<a name="l1608"><span class="linenum">1608</span></a>          if( <a class="function" onClick="logFunction('db_index_exists')" href="../../_functions/db_index_exists.html" onMouseOver="funcPopup(event,'db_index_exists')">db_index_exists</a>( 'T_hitlog', 'hit_datetime' ) )
<a name="l1609"><span class="linenum">1609</span></a>          { // only drop, if it still <a class="function" onClick="logFunction('exists')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">exists</a> (may have been removed manually)
<a name="l1610"><span class="linenum">1610</span></a>              echo 'Updating hitlog indexes... ';
<a name="l1611"><span class="linenum">1611</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1612"><span class="linenum">1612</span></a>                      ALTER TABLE T_hitlog
<a name="l1613"><span class="linenum">1613</span></a>                          DROP INDEX hit_datetime
<a name="l1614"><span class="linenum">1614</span></a>                      ' );
<a name="l1615"><span class="linenum">1615</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1616"><span class="linenum">1616</span></a>          }
<a name="l1617"><span class="linenum">1617</span></a>  
<a name="l1618"><span class="linenum">1618</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9320' );
<a name="l1619"><span class="linenum">1619</span></a>      }
<a name="l1620"><span class="linenum">1620</span></a>  
<a name="l1621"><span class="linenum">1621</span></a>  
<a name="l1622"><span class="linenum">1622</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9326 )
<a name="l1623"><span class="linenum">1623</span></a>      {
<a name="l1624"><span class="linenum">1624</span></a>          echo 'Removing obsolete settings... ';
<a name="l1625"><span class="linenum">1625</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_settings WHERE set_name = &quot;upload_allowedext&quot;' );
<a name="l1626"><span class="linenum">1626</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1627"><span class="linenum">1627</span></a>  
<a name="l1628"><span class="linenum">1628</span></a>          echo 'Updating blogs... ';
<a name="l1629"><span class="linenum">1629</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_blogs', 'blog_allowpingbacks' );
<a name="l1630"><span class="linenum">1630</span></a>  
<a name="l1631"><span class="linenum">1631</span></a>  <span class="comment">        // Remove and transform obsolete fields blog_pingb2evonet, blog_pingtechnorati, blog_pingweblogs, blog_pingblodotgs</span>
<a name="l1632"><span class="linenum">1632</span></a>          if( <a class="function" onClick="logFunction('db_cols_exist')" href="../../_functions/db_cols_exist.html" onMouseOver="funcPopup(event,'db_cols_exist')">db_cols_exist</a>( 'T_blogs', array('blog_pingb2evonet', 'blog_pingtechnorati', 'blog_pingweblogs', 'blog_pingblodotgs') ) )
<a name="l1633"><span class="linenum">1633</span></a>          {
<a name="l1634"><span class="linenum">1634</span></a>              foreach( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( '
<a name="l1635"><span class="linenum">1635</span></a>                      SELECT blog_ID, blog_pingb2evonet, blog_pingtechnorati, blog_pingweblogs, blog_pingblodotgs
<a name="l1636"><span class="linenum">1636</span></a>                          FROM T_blogs' ) as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l1637"><span class="linenum">1637</span></a>              {
<a name="l1638"><span class="linenum">1638</span></a>                  <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT cset_value FROM T_coll_settings WHERE cset_coll_ID = '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('blog_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/blog_ID.html">blog_ID</a>.' AND cset_name = &quot;ping_plugins&quot;' );
<a name="l1639"><span class="linenum">1639</span></a>                  <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>(',', <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a>);
<a name="l1640"><span class="linenum">1640</span></a>                  if( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('blog_pingb2evonet')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/blog_pingb2evonet.html">blog_pingb2evonet</a> )
<a name="l1641"><span class="linenum">1641</span></a>                  {
<a name="l1642"><span class="linenum">1642</span></a>                      <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a>[] = 'ping_b2evonet';
<a name="l1643"><span class="linenum">1643</span></a>                  }
<a name="l1644"><span class="linenum">1644</span></a>                  if( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('blog_pingtechnorati')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/blog_pingtechnorati.html">blog_pingtechnorati</a> || <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('blog_pingweblogs')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/blog_pingweblogs.html">blog_pingweblogs</a> || <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('blog_pingblodotgs')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/blog_pingblodotgs.html">blog_pingblodotgs</a> )
<a name="l1645"><span class="linenum">1645</span></a>                  { // if either one of the previous pingers was enabled, add ping-o-matic:
<a name="l1646"><span class="linenum">1646</span></a>                      <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a>[] = 'ping_pingomatic';
<a name="l1647"><span class="linenum">1647</span></a>                  }
<a name="l1648"><span class="linenum">1648</span></a>  
<a name="l1649"><span class="linenum">1649</span></a>  <span class="comment">                // Insert transformed/generated ping plugins collection setting:</span>
<a name="l1650"><span class="linenum">1650</span></a>                  <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>(<a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a>);
<a name="l1651"><span class="linenum">1651</span></a>                  <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_coll_settings
<a name="l1652"><span class="linenum">1652</span></a>                          ( cset_coll_ID, cset_name, cset_value )
<a name="l1653"><span class="linenum">1653</span></a>                          VALUES ( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('blog_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/blog_ID.html">blog_ID</a>.', &quot;ping_plugins&quot;, &quot;'.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it3033" onMouseOver="hilite(3033)" onMouseOut="lolite()" onClick="logVariable('ping_plugins')" href="../../_variables/ping_plugins.html">$ping_plugins</a> ).'&quot; )' );
<a name="l1654"><span class="linenum">1654</span></a>              }
<a name="l1655"><span class="linenum">1655</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_blogs
<a name="l1656"><span class="linenum">1656</span></a>                      DROP COLUMN blog_pingb2evonet,
<a name="l1657"><span class="linenum">1657</span></a>                      DROP COLUMN blog_pingtechnorati,
<a name="l1658"><span class="linenum">1658</span></a>                      DROP COLUMN blog_pingweblogs,
<a name="l1659"><span class="linenum">1659</span></a>                      DROP COLUMN blog_pingblodotgs' );
<a name="l1660"><span class="linenum">1660</span></a>          }
<a name="l1661"><span class="linenum">1661</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1662"><span class="linenum">1662</span></a>  
<a name="l1663"><span class="linenum">1663</span></a>  
<a name="l1664"><span class="linenum">1664</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9326' );
<a name="l1665"><span class="linenum">1665</span></a>      }
<a name="l1666"><span class="linenum">1666</span></a>  
<a name="l1667"><span class="linenum">1667</span></a>  
<a name="l1668"><span class="linenum">1668</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9328 )
<a name="l1669"><span class="linenum">1669</span></a>      {
<a name="l1670"><span class="linenum">1670</span></a>          echo 'Updating posts... ';
<a name="l1671"><span class="linenum">1671</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( &quot;{<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts&quot;, 'post_notifications_status',  'ENUM(&quot;noreq&quot;,&quot;todo&quot;,&quot;started&quot;,&quot;finished&quot;) NOT NULL DEFAULT &quot;noreq&quot; AFTER post_flags' );
<a name="l1672"><span class="linenum">1672</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( &quot;{<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts&quot;, 'post_notifications_ctsk_ID', 'INT(10) unsigned NULL DEFAULT NULL AFTER post_notifications_status' );
<a name="l1673"><span class="linenum">1673</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1674"><span class="linenum">1674</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9328' );
<a name="l1675"><span class="linenum">1675</span></a>      }
<a name="l1676"><span class="linenum">1676</span></a>  
<a name="l1677"><span class="linenum">1677</span></a>  
<a name="l1678"><span class="linenum">1678</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9330 )
<a name="l1679"><span class="linenum">1679</span></a>      {
<a name="l1680"><span class="linenum">1680</span></a>          if( <a class="function" onClick="logFunction('db_col_exists')" href="../../_functions/db_col_exists.html" onMouseOver="funcPopup(event,'db_col_exists')">db_col_exists</a>( &quot;{<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts&quot;, 'post_flags') )
<a name="l1681"><span class="linenum">1681</span></a>          {
<a name="l1682"><span class="linenum">1682</span></a>              echo 'Updating post notifications... ';
<a name="l1683"><span class="linenum">1683</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l1684"><span class="linenum">1684</span></a>                  UPDATE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts
<a name="l1685"><span class="linenum">1685</span></a>                       SET post_notifications_status = 'finished'
<a name="l1686"><span class="linenum">1686</span></a>                   WHERE post_flags LIKE '%pingsdone%'&quot; );
<a name="l1687"><span class="linenum">1687</span></a>              <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( &quot;{<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts&quot;, 'post_flags' );
<a name="l1688"><span class="linenum">1688</span></a>              echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1689"><span class="linenum">1689</span></a>          }
<a name="l1690"><span class="linenum">1690</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9330' );
<a name="l1691"><span class="linenum">1691</span></a>      }
<a name="l1692"><span class="linenum">1692</span></a>  
<a name="l1693"><span class="linenum">1693</span></a>  
<a name="l1694"><span class="linenum">1694</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9340 )
<a name="l1695"><span class="linenum">1695</span></a>      {
<a name="l1696"><span class="linenum">1696</span></a>          echo 'Removing duplicate post link indexes... ';
<a name="l1697"><span class="linenum">1697</span></a>          if( <a class="function" onClick="logFunction('db_index_exists')" href="../../_functions/db_index_exists.html" onMouseOver="funcPopup(event,'db_index_exists')">db_index_exists</a>( 'T_links', 'link_item_ID' ) )
<a name="l1698"><span class="linenum">1698</span></a>          { // only drop, if it still <a class="function" onClick="logFunction('exists')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">exists</a> (may have been removed manually)
<a name="l1699"><span class="linenum">1699</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1700"><span class="linenum">1700</span></a>                      ALTER TABLE T_links
<a name="l1701"><span class="linenum">1701</span></a>                          DROP INDEX link_item_ID
<a name="l1702"><span class="linenum">1702</span></a>                      ' );
<a name="l1703"><span class="linenum">1703</span></a>          }
<a name="l1704"><span class="linenum">1704</span></a>          if( <a class="function" onClick="logFunction('db_index_exists')" href="../../_functions/db_index_exists.html" onMouseOver="funcPopup(event,'db_index_exists')">db_index_exists</a>( 'T_links', 'link_dest_item_ID' ) )
<a name="l1705"><span class="linenum">1705</span></a>          { // only drop, if it still <a class="function" onClick="logFunction('exists')" href="../../_functions/exists.html" onMouseOver="funcPopup(event,'exists')">exists</a> (may have been removed manually)
<a name="l1706"><span class="linenum">1706</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1707"><span class="linenum">1707</span></a>                      ALTER TABLE T_links
<a name="l1708"><span class="linenum">1708</span></a>                          DROP INDEX link_dest_item_ID
<a name="l1709"><span class="linenum">1709</span></a>                      ' );
<a name="l1710"><span class="linenum">1710</span></a>          }
<a name="l1711"><span class="linenum">1711</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1712"><span class="linenum">1712</span></a>  
<a name="l1713"><span class="linenum">1713</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9340' );
<a name="l1714"><span class="linenum">1714</span></a>      }
<a name="l1715"><span class="linenum">1715</span></a>  
<a name="l1716"><span class="linenum">1716</span></a>  <span class="comment">    // ____________________________ 1.10: ____________________________</span>
<a name="l1717"><span class="linenum">1717</span></a>  
<a name="l1718"><span class="linenum">1718</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9345 )
<a name="l1719"><span class="linenum">1719</span></a>      {
<a name="l1720"><span class="linenum">1720</span></a>          echo 'Updating post table... ';
<a name="l1721"><span class="linenum">1721</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts CHANGE COLUMN post_content post_content MEDIUMTEXT NULL&quot; );
<a name="l1722"><span class="linenum">1722</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1723"><span class="linenum">1723</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9345' );
<a name="l1724"><span class="linenum">1724</span></a>      }
<a name="l1725"><span class="linenum">1725</span></a>  
<a name="l1726"><span class="linenum">1726</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9346 )
<a name="l1727"><span class="linenum">1727</span></a>      {
<a name="l1728"><span class="linenum">1728</span></a>          echo 'Updating prerendering table... ';
<a name="l1729"><span class="linenum">1729</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}item__prerendering CHANGE COLUMN itpr_content_prerendered itpr_content_prerendered MEDIUMTEXT NULL&quot; );
<a name="l1730"><span class="linenum">1730</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1731"><span class="linenum">1731</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9346' );
<a name="l1732"><span class="linenum">1732</span></a>      }
<a name="l1733"><span class="linenum">1733</span></a>  
<a name="l1734"><span class="linenum">1734</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9348 )
<a name="l1735"><span class="linenum">1735</span></a>      {
<a name="l1736"><span class="linenum">1736</span></a>          echo 'Updating sessions table... ';
<a name="l1737"><span class="linenum">1737</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_sessions CHANGE COLUMN sess_data sess_data MEDIUMBLOB DEFAULT NULL' );
<a name="l1738"><span class="linenum">1738</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1739"><span class="linenum">1739</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9348' );
<a name="l1740"><span class="linenum">1740</span></a>      }
<a name="l1741"><span class="linenum">1741</span></a>  
<a name="l1742"><span class="linenum">1742</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9350 )
<a name="l1743"><span class="linenum">1743</span></a>      {
<a name="l1744"><span class="linenum">1744</span></a>          echo 'Updating hitlog table... ';
<a name="l1745"><span class="linenum">1745</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_hitlog CHANGE COLUMN hit_referer_type hit_referer_type   ENUM(\'search\',\'blacklist\',\'spam\',\'referer\',\'direct\',\'self\',\'admin\') NOT NULL' );
<a name="l1746"><span class="linenum">1746</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1747"><span class="linenum">1747</span></a>  
<a name="l1748"><span class="linenum">1748</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9350' );
<a name="l1749"><span class="linenum">1749</span></a>      }
<a name="l1750"><span class="linenum">1750</span></a>  
<a name="l1751"><span class="linenum">1751</span></a>  
<a name="l1752"><span class="linenum">1752</span></a>  <span class="comment">    // TODO: &quot;If a user has permission to edit a blog, he should be able to put files in the media folder for that blog.&quot; - see http://forums.b2evolution.net/viewtopic.php?p=36417#36417</span>
<a name="l1753"><span class="linenum">1753</span></a>      <span class="comment">/*</span>
<a name="l1754"><span class="linenum">1754</span></a>  <span class="comment">    // blueyed&gt;&gt; I've came up with the following, but it's too generic IMHO</span>
<a name="l1755"><span class="linenum">1755</span></a>  <span class="comment">    if( $old_db_version &lt; 9300 )</span>
<a name="l1756"><span class="linenum">1756</span></a>  <span class="comment">    {</span>
<a name="l1757"><span class="linenum">1757</span></a>  <span class="comment">        echo 'Setting automatic media perms on blogs (members can upload)... ';</span>
<a name="l1758"><span class="linenum">1758</span></a>  <span class="comment">        $users = $DB-&gt;query( '</span>
<a name="l1759"><span class="linenum">1759</span></a>  <span class="comment">                UPDATE T_users</span>
<a name="l1760"><span class="linenum">1760</span></a>  <span class="comment">                   SET bloguser_perm_media_upload = 1</span>
<a name="l1761"><span class="linenum">1761</span></a>  <span class="comment">                 WHERE bloguser_ismember = 1' );</span>
<a name="l1762"><span class="linenum">1762</span></a>  <span class="comment">        echo &quot;OK.&lt;br /&gt;\n&quot;;</span>
<a name="l1763"><span class="linenum">1763</span></a>  <span class="comment">    }</span>
<a name="l1764"><span class="linenum">1764</span></a>  <span class="comment">    */</span>
<a name="l1765"><span class="linenum">1765</span></a>  
<a name="l1766"><span class="linenum">1766</span></a>  
<a name="l1767"><span class="linenum">1767</span></a>  <span class="comment">    // ____________________________ 2.0: ____________________________</span>
<a name="l1768"><span class="linenum">1768</span></a>  
<a name="l1769"><span class="linenum">1769</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9406 )
<a name="l1770"><span class="linenum">1770</span></a>      {
<a name="l1771"><span class="linenum">1771</span></a>          echo 'Updating chapter url names... ';
<a name="l1772"><span class="linenum">1772</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1773"><span class="linenum">1773</span></a>              ALTER TABLE T_categories
<a name="l1774"><span class="linenum">1774</span></a>                  ADD COLUMN cat_urlname VARCHAR(255) NOT NULL' );
<a name="l1775"><span class="linenum">1775</span></a>  
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment">        // Create cat_urlname from cat_name:</span>
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment">        // TODO: Also use it for cafelog upgrade.</span>
<a name="l1778"><span class="linenum">1778</span></a>          <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('locales/_charset.funcs.php');
<a name="l1779"><span class="linenum">1779</span></a>          foreach( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>('SELECT cat_ID, cat_name FROM T_categories') as <a class="var it482" onMouseOver="hilite(482)" onMouseOut="lolite()" onClick="logVariable('cat')" href="../../_variables/cat.html">$cat</a> )
<a name="l1780"><span class="linenum">1780</span></a>          {
<a name="l1781"><span class="linenum">1781</span></a>              <a class="var it858" onMouseOver="hilite(858)" onMouseOut="lolite()" onClick="logVariable('cat_name')" href="../../_variables/cat_name.html">$cat_name</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it482" onMouseOver="hilite(482)" onMouseOut="lolite()" onClick="logVariable('cat')" href="../../_variables/cat.html">$cat</a>-&gt;<a onClick="logVariable('cat_name')" class="var it9079" onMouseOver="hilite(9079)" onMouseOut="lolite()" href="../../_variables/cat_name.html">cat_name</a>);
<a name="l1782"><span class="linenum">1782</span></a>              if( strlen(<a class="var it858" onMouseOver="hilite(858)" onMouseOut="lolite()" onClick="logVariable('cat_name')" href="../../_variables/cat_name.html">$cat_name</a>) )
<a name="l1783"><span class="linenum">1783</span></a>              {
<a name="l1784"><span class="linenum">1784</span></a>  <span class="comment">                // TODO: dh&gt; pass locale (useful for transliteration). From main blog?</span>
<a name="l1785"><span class="linenum">1785</span></a>                  <a class="var it1360" onMouseOver="hilite(1360)" onMouseOut="lolite()" onClick="logVariable('cat_urlname')" href="../../_variables/cat_urlname.html">$cat_urlname</a> = <a class="function" onClick="logFunction('urltitle_validate')" href="../../_functions/urltitle_validate.html" onMouseOver="funcPopup(event,'urltitle_validate')">urltitle_validate</a>('', <a class="var it858" onMouseOver="hilite(858)" onMouseOut="lolite()" onClick="logVariable('cat_name')" href="../../_variables/cat_name.html">$cat_name</a>, <a class="var it482" onMouseOver="hilite(482)" onMouseOut="lolite()" onClick="logVariable('cat')" href="../../_variables/cat.html">$cat</a>-&gt;<a onClick="logVariable('cat_ID')" class="var it9079" onMouseOver="hilite(9079)" onMouseOut="lolite()" href="../../_variables/cat_ID.html">cat_ID</a>, false, 'cat_urlname', 'cat_ID', 'T_categories');
<a name="l1786"><span class="linenum">1786</span></a>              }
<a name="l1787"><span class="linenum">1787</span></a>              else
<a name="l1788"><span class="linenum">1788</span></a>              {
<a name="l1789"><span class="linenum">1789</span></a>                  <a class="var it1360" onMouseOver="hilite(1360)" onMouseOut="lolite()" onClick="logVariable('cat_urlname')" href="../../_variables/cat_urlname.html">$cat_urlname</a> = 'c'.<a class="var it482" onMouseOver="hilite(482)" onMouseOut="lolite()" onClick="logVariable('cat')" href="../../_variables/cat.html">$cat</a>-&gt;<a onClick="logVariable('cat_ID')" class="var it9079" onMouseOver="hilite(9079)" onMouseOut="lolite()" href="../../_variables/cat_ID.html">cat_ID</a>;
<a name="l1790"><span class="linenum">1790</span></a>              }
<a name="l1791"><span class="linenum">1791</span></a>  
<a name="l1792"><span class="linenum">1792</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1793"><span class="linenum">1793</span></a>                  UPDATE T_categories
<a name="l1794"><span class="linenum">1794</span></a>                       SET cat_urlname = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it1360" onMouseOver="hilite(1360)" onMouseOut="lolite()" onClick="logVariable('cat_urlname')" href="../../_variables/cat_urlname.html">$cat_urlname</a>).'
<a name="l1795"><span class="linenum">1795</span></a>                   WHERE cat_ID = '.<a class="var it482" onMouseOver="hilite(482)" onMouseOut="lolite()" onClick="logVariable('cat')" href="../../_variables/cat.html">$cat</a>-&gt;<a onClick="logVariable('cat_ID')" class="var it9079" onMouseOver="hilite(9079)" onMouseOut="lolite()" href="../../_variables/cat_ID.html">cat_ID</a> );
<a name="l1796"><span class="linenum">1796</span></a>          }
<a name="l1797"><span class="linenum">1797</span></a>  
<a name="l1798"><span class="linenum">1798</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1799"><span class="linenum">1799</span></a>              ALTER TABLE T_categories
<a name="l1800"><span class="linenum">1800</span></a>                  ADD UNIQUE cat_urlname ( cat_urlname )' );
<a name="l1801"><span class="linenum">1801</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1802"><span class="linenum">1802</span></a>  
<a name="l1803"><span class="linenum">1803</span></a>          echo 'Updating Settings... ';
<a name="l1804"><span class="linenum">1804</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1805"><span class="linenum">1805</span></a>        UPDATE T_settings
<a name="l1806"><span class="linenum">1806</span></a>           SET set_value = &quot;disabled&quot;
<a name="l1807"><span class="linenum">1807</span></a>         WHERE set_name = &quot;links_extrapath&quot;
<a name="l1808"><span class="linenum">1808</span></a>           AND set_value = 0' );
<a name="l1809"><span class="linenum">1809</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l1810"><span class="linenum">1810</span></a>        UPDATE T_settings
<a name="l1811"><span class="linenum">1811</span></a>           SET set_value = &quot;ymd&quot;
<a name="l1812"><span class="linenum">1812</span></a>         WHERE set_name = &quot;links_extrapath&quot;
<a name="l1813"><span class="linenum">1813</span></a>           AND set_value &lt;&gt; 0' );
<a name="l1814"><span class="linenum">1814</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1815"><span class="linenum">1815</span></a>  
<a name="l1816"><span class="linenum">1816</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9406' );
<a name="l1817"><span class="linenum">1817</span></a>      }
<a name="l1818"><span class="linenum">1818</span></a>  
<a name="l1819"><span class="linenum">1819</span></a>  
<a name="l1820"><span class="linenum">1820</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9407 )
<a name="l1821"><span class="linenum">1821</span></a>      {
<a name="l1822"><span class="linenum">1822</span></a>          echo 'Moving general settings to blog settings... ';
<a name="l1823"><span class="linenum">1823</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l1824"><span class="linenum">1824</span></a>                       SELECT blog_ID, set_name, set_value
<a name="l1825"><span class="linenum">1825</span></a>                                       FROM T_blogs, T_settings
<a name="l1826"><span class="linenum">1826</span></a>                                      WHERE set_name = &quot;posts_per_page&quot;
<a name="l1827"><span class="linenum">1827</span></a>                                         OR set_name = &quot;what_to_show&quot;
<a name="l1828"><span class="linenum">1828</span></a>                                         OR set_name = &quot;archive_mode&quot;' );
<a name="l1829"><span class="linenum">1829</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_settings
<a name="l1830"><span class="linenum">1830</span></a>                                      WHERE set_name = &quot;posts_per_page&quot;
<a name="l1831"><span class="linenum">1831</span></a>                                         OR set_name = &quot;what_to_show&quot;
<a name="l1832"><span class="linenum">1832</span></a>                                         OR set_name = &quot;archive_mode&quot;' );
<a name="l1833"><span class="linenum">1833</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1834"><span class="linenum">1834</span></a>  
<a name="l1835"><span class="linenum">1835</span></a>          echo 'Upgrading blogs table... ';
<a name="l1836"><span class="linenum">1836</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_blogs
<a name="l1837"><span class="linenum">1837</span></a>                              DROP COLUMN blog_force_skin&quot;;
<a name="l1838"><span class="linenum">1838</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1839"><span class="linenum">1839</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1840"><span class="linenum">1840</span></a>  
<a name="l1841"><span class="linenum">1841</span></a>          echo 'Upgrading groups table... ';
<a name="l1842"><span class="linenum">1842</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_groups
<a name="l1843"><span class="linenum">1843</span></a>                              CHANGE COLUMN grp_perm_files grp_perm_files enum('none','view','add','edit','all') NOT NULL default 'none'&quot;;
<a name="l1844"><span class="linenum">1844</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1845"><span class="linenum">1845</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1846"><span class="linenum">1846</span></a>  
<a name="l1847"><span class="linenum">1847</span></a>          echo 'Upgrading files table... ';
<a name="l1848"><span class="linenum">1848</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_files
<a name="l1849"><span class="linenum">1849</span></a>                              CHANGE COLUMN file_root_type file_root_type enum('absolute','user','group','collection','skins') not null default 'absolute'&quot;;
<a name="l1850"><span class="linenum">1850</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l1851"><span class="linenum">1851</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1852"><span class="linenum">1852</span></a>  
<a name="l1853"><span class="linenum">1853</span></a>          echo 'Updating file types... ';
<a name="l1854"><span class="linenum">1854</span></a>  <span class="comment">        // Only change this if it's close enough to a default install (non customized)</span>
<a name="l1855"><span class="linenum">1855</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_filetypes
<a name="l1856"><span class="linenum">1856</span></a>                                          SET ftyp_viewtype = 'text'
<a name="l1857"><span class="linenum">1857</span></a>                                      WHERE ftyp_ID = 12
<a name="l1858"><span class="linenum">1858</span></a>                                          AND ftyp_extensions = 'php php3 php4 php5 php6'
<a name="l1859"><span class="linenum">1859</span></a>                                          AND ftyp_mimetype ='application/x-httpd-php'
<a name="l1860"><span class="linenum">1860</span></a>                                          AND ftyp_icon = 'php.gif'&quot; );
<a name="l1861"><span class="linenum">1861</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1862"><span class="linenum">1862</span></a>  
<a name="l1863"><span class="linenum">1863</span></a>          echo 'Remove obsolete user settings... ';
<a name="l1864"><span class="linenum">1864</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'usersettings
<a name="l1865"><span class="linenum">1865</span></a>                                      WHERE uset_name = &quot;plugins_disp_avail&quot;' );
<a name="l1866"><span class="linenum">1866</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1867"><span class="linenum">1867</span></a>  
<a name="l1868"><span class="linenum">1868</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9407' );
<a name="l1869"><span class="linenum">1869</span></a>      }
<a name="l1870"><span class="linenum">1870</span></a>  
<a name="l1871"><span class="linenum">1871</span></a>  
<a name="l1872"><span class="linenum">1872</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9408 )
<a name="l1873"><span class="linenum">1873</span></a>      {
<a name="l1874"><span class="linenum">1874</span></a>          echo 'Creating skins table... ';
<a name="l1875"><span class="linenum">1875</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_skins__skin (
<a name="l1876"><span class="linenum">1876</span></a>                skin_ID      int(10) unsigned      NOT NULL auto_increment,
<a name="l1877"><span class="linenum">1877</span></a>                skin_name    varchar(32)           NOT NULL,
<a name="l1878"><span class="linenum">1878</span></a>                skin_type    enum(\'normal\',\'feed\') NOT NULL default \'normal\',
<a name="l1879"><span class="linenum">1879</span></a>                skin_folder  varchar(32)           NOT NULL,
<a name="l1880"><span class="linenum">1880</span></a>                PRIMARY KEY skin_ID (skin_ID),
<a name="l1881"><span class="linenum">1881</span></a>                UNIQUE skin_folder( skin_folder ),
<a name="l1882"><span class="linenum">1882</span></a>                KEY skin_name( skin_name )
<a name="l1883"><span class="linenum">1883</span></a>              )' );
<a name="l1884"><span class="linenum">1884</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1885"><span class="linenum">1885</span></a>  
<a name="l1886"><span class="linenum">1886</span></a>          echo 'Creating skin containers table... ';
<a name="l1887"><span class="linenum">1887</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_skins__container (
<a name="l1888"><span class="linenum">1888</span></a>                sco_skin_ID   int(10) unsigned      NOT NULL,
<a name="l1889"><span class="linenum">1889</span></a>                sco_name      varchar(40)           NOT NULL,
<a name="l1890"><span class="linenum">1890</span></a>                PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (sco_skin_ID, sco_name)
<a name="l1891"><span class="linenum">1891</span></a>              )' );
<a name="l1892"><span class="linenum">1892</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1893"><span class="linenum">1893</span></a>  
<a name="l1894"><span class="linenum">1894</span></a>          echo 'Creating widgets table... ';
<a name="l1895"><span class="linenum">1895</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_widget (
<a name="l1896"><span class="linenum">1896</span></a>                           wi_ID                    INT(10) UNSIGNED auto_increment,
<a name="l1897"><span class="linenum">1897</span></a>                          wi_coll_ID    INT(11) UNSIGNED NOT NULL,
<a name="l1898"><span class="linenum">1898</span></a>                          wi_sco_name   VARCHAR( 40 ) NOT NULL,
<a name="l1899"><span class="linenum">1899</span></a>                          wi_order            INT(10) UNSIGNED NOT NULL,
<a name="l1900"><span class="linenum">1900</span></a>                          wi_type       ENUM( \'core\', \'plugin\' ) NOT NULL DEFAULT \'core\',
<a name="l1901"><span class="linenum">1901</span></a>                          wi_code       VARCHAR(32) NOT NULL,
<a name="l1902"><span class="linenum">1902</span></a>                          wi_params     TEXT NULL,
<a name="l1903"><span class="linenum">1903</span></a>                          PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( wi_ID ),
<a name="l1904"><span class="linenum">1904</span></a>                          UNIQUE wi_order( wi_coll_ID, wi_sco_name, wi_order )
<a name="l1905"><span class="linenum">1905</span></a>            )' );
<a name="l1906"><span class="linenum">1906</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1907"><span class="linenum">1907</span></a>  
<a name="l1908"><span class="linenum">1908</span></a>          <a class="function" onClick="logFunction('install_basic_skins')" href="../../_functions/install_basic_skins.html" onMouseOver="funcPopup(event,'install_basic_skins')">install_basic_skins</a>( false );
<a name="l1909"><span class="linenum">1909</span></a>  
<a name="l1910"><span class="linenum">1910</span></a>          echo 'Updating blogs table... ';
<a name="l1911"><span class="linenum">1911</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_blogs
<a name="l1912"><span class="linenum">1912</span></a>                                   ALTER COLUMN blog_allowtrackbacks SET DEFAULT 0,
<a name="l1913"><span class="linenum">1913</span></a>                                      DROP COLUMN blog_default_skin,
<a name="l1914"><span class="linenum">1914</span></a>                                       ADD COLUMN blog_owner_user_ID   int(11) unsigned NOT NULL default 1 AFTER blog_name,
<a name="l1915"><span class="linenum">1915</span></a>                                       ADD COLUMN blog_skin_ID INT(10) UNSIGNED NOT NULL DEFAULT 1 AFTER blog_allowusercss' );
<a name="l1916"><span class="linenum">1916</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1917"><span class="linenum">1917</span></a>  
<a name="l1918"><span class="linenum">1918</span></a>  
<a name="l1919"><span class="linenum">1919</span></a>          <a class="function" onClick="logFunction('install_basic_widgets')" href="../../_functions/install_basic_widgets.html" onMouseOver="funcPopup(event,'install_basic_widgets')">install_basic_widgets</a>( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> );
<a name="l1920"><span class="linenum">1920</span></a>  
<a name="l1921"><span class="linenum">1921</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9408' );
<a name="l1922"><span class="linenum">1922</span></a>      }
<a name="l1923"><span class="linenum">1923</span></a>  
<a name="l1924"><span class="linenum">1924</span></a>  
<a name="l1925"><span class="linenum">1925</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9409 )
<a name="l1926"><span class="linenum">1926</span></a>      {
<a name="l1927"><span class="linenum">1927</span></a>  <span class="comment">        // Upgrade the blog access types:</span>
<a name="l1928"><span class="linenum">1928</span></a>          echo 'Updating blogs access types... ';
<a name="l1929"><span class="linenum">1929</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_blogs
<a name="l1930"><span class="linenum">1930</span></a>                                          SET blog_access_type = &quot;absolute&quot;
<a name="l1931"><span class="linenum">1931</span></a>                                      WHERE blog_siteurl LIKE &quot;http://%&quot;
<a name="l1932"><span class="linenum">1932</span></a>                                         OR blog_siteurl LIKE &quot;https://%&quot;' );
<a name="l1933"><span class="linenum">1933</span></a>  
<a name="l1934"><span class="linenum">1934</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_blogs
<a name="l1935"><span class="linenum">1935</span></a>                                          SET blog_access_type = &quot;relative&quot;,
<a name="l1936"><span class="linenum">1936</span></a>                                                  blog_siteurl = CONCAT( blog_siteurl, blog_stub )
<a name="l1937"><span class="linenum">1937</span></a>                                      WHERE blog_access_type = &quot;stub&quot;' );
<a name="l1938"><span class="linenum">1938</span></a>  
<a name="l1939"><span class="linenum">1939</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_blogs', 'blog_stub' );
<a name="l1940"><span class="linenum">1940</span></a>  
<a name="l1941"><span class="linenum">1941</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1942"><span class="linenum">1942</span></a>  
<a name="l1943"><span class="linenum">1943</span></a>  
<a name="l1944"><span class="linenum">1944</span></a>           echo 'Updating columns... ';
<a name="l1945"><span class="linenum">1945</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_groups CHANGE COLUMN grp_perm_stats grp_perm_stats enum('none','user','view','edit') NOT NULL default 'none'&quot; );
<a name="l1946"><span class="linenum">1946</span></a>  
<a name="l1947"><span class="linenum">1947</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_user_perms CHANGE COLUMN bloguser_perm_poststatuses bloguser_perm_poststatuses <a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('published','deprecated','protected','private','draft','redirected') NOT NULL default ''&quot; );
<a name="l1948"><span class="linenum">1948</span></a>  
<a name="l1949"><span class="linenum">1949</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_group_perms CHANGE COLUMN bloggroup_perm_poststatuses bloggroup_perm_poststatuses <a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('published','deprecated','protected','private','draft','redirected') NOT NULL default ''&quot; );
<a name="l1950"><span class="linenum">1950</span></a>  
<a name="l1951"><span class="linenum">1951</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts CHANGE COLUMN post_status post_status enum('published','deprecated','protected','private','draft','redirected') NOT NULL default 'published'&quot; );
<a name="l1952"><span class="linenum">1952</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1953"><span class="linenum">1953</span></a>  
<a name="l1954"><span class="linenum">1954</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9409' );
<a name="l1955"><span class="linenum">1955</span></a>      }
<a name="l1956"><span class="linenum">1956</span></a>  
<a name="l1957"><span class="linenum">1957</span></a>  
<a name="l1958"><span class="linenum">1958</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9410 )
<a name="l1959"><span class="linenum">1959</span></a>      {
<a name="l1960"><span class="linenum">1960</span></a>           echo 'Updating columns... ';
<a name="l1961"><span class="linenum">1961</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_comments CHANGE COLUMN comment_status comment_status ENUM('published','deprecated','protected','private','draft','redirected') DEFAULT 'published' NOT NULL&quot; );
<a name="l1962"><span class="linenum">1962</span></a>  
<a name="l1963"><span class="linenum">1963</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_sessions CHANGE COLUMN sess_data sess_data MEDIUMBLOB DEFAULT NULL&quot; );
<a name="l1964"><span class="linenum">1964</span></a>  
<a name="l1965"><span class="linenum">1965</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_hitlog CHANGE COLUMN hit_referer_type hit_referer_type ENUM('search','blacklist','spam','referer','direct','self','admin') NOT NULL&quot; );
<a name="l1966"><span class="linenum">1966</span></a>  
<a name="l1967"><span class="linenum">1967</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1968"><span class="linenum">1968</span></a>  
<a name="l1969"><span class="linenum">1969</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9410' );
<a name="l1970"><span class="linenum">1970</span></a>      }
<a name="l1971"><span class="linenum">1971</span></a>  
<a name="l1972"><span class="linenum">1972</span></a>  
<a name="l1973"><span class="linenum">1973</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9411 )
<a name="l1974"><span class="linenum">1974</span></a>      {
<a name="l1975"><span class="linenum">1975</span></a>          echo 'Adding default Post Types... ';
<a name="l1976"><span class="linenum">1976</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l1977"><span class="linenum">1977</span></a>              REPLACE INTO {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posttypes ( ptyp_ID, ptyp_name )
<a name="l1978"><span class="linenum">1978</span></a>              VALUES ( 1000, 'Page' ),
<a name="l1979"><span class="linenum">1979</span></a>                           ( 2000, 'Reserved' ),
<a name="l1980"><span class="linenum">1980</span></a>                           ( 3000, 'Reserved' ),
<a name="l1981"><span class="linenum">1981</span></a>                           ( 4000, 'Reserved' ),
<a name="l1982"><span class="linenum">1982</span></a>                           ( 5000, 'Reserved' ) &quot; );
<a name="l1983"><span class="linenum">1983</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1984"><span class="linenum">1984</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9411' );
<a name="l1985"><span class="linenum">1985</span></a>      }
<a name="l1986"><span class="linenum">1986</span></a>  
<a name="l1987"><span class="linenum">1987</span></a>  
<a name="l1988"><span class="linenum">1988</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9412 )
<a name="l1989"><span class="linenum">1989</span></a>      {
<a name="l1990"><span class="linenum">1990</span></a>          echo 'Adding field for post excerpts... ';
<a name="l1991"><span class="linenum">1991</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts ADD COLUMN post_excerpt  text NULL AFTER post_content&quot; );
<a name="l1992"><span class="linenum">1992</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l1993"><span class="linenum">1993</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9412' );
<a name="l1994"><span class="linenum">1994</span></a>      }
<a name="l1995"><span class="linenum">1995</span></a>  
<a name="l1996"><span class="linenum">1996</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9414 )
<a name="l1997"><span class="linenum">1997</span></a>      {
<a name="l1998"><span class="linenum">1998</span></a>          echo &quot;Renaming tables...&quot;;
<a name="l1999"><span class="linenum">1999</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;RENAME TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}item__prerendering TO T_items__prerendering&quot; );
<a name="l2000"><span class="linenum">2000</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;RENAME TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}poststatuses TO T_items__status&quot; );
<a name="l2001"><span class="linenum">2001</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;RENAME TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posttypes TO T_items__type&quot; );
<a name="l2002"><span class="linenum">2002</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;RENAME TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}posts TO T_items__item&quot; );
<a name="l2003"><span class="linenum">2003</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2004"><span class="linenum">2004</span></a>  
<a name="l2005"><span class="linenum">2005</span></a>          echo &quot;Creating Tag tables...&quot;;
<a name="l2006"><span class="linenum">2006</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_items__tag (
<a name="l2007"><span class="linenum">2007</span></a>                tag_ID   int(11) unsigned not null AUTO_INCREMENT,
<a name="l2008"><span class="linenum">2008</span></a>                tag_name varchar(50) not null,
<a name="l2009"><span class="linenum">2009</span></a>                primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (tag_ID),
<a name="l2010"><span class="linenum">2010</span></a>                UNIQUE tag_name( tag_name )
<a name="l2011"><span class="linenum">2011</span></a>              )&quot; );
<a name="l2012"><span class="linenum">2012</span></a>  
<a name="l2013"><span class="linenum">2013</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_items__itemtag (
<a name="l2014"><span class="linenum">2014</span></a>                itag_itm_ID int(11) unsigned NOT NULL,
<a name="l2015"><span class="linenum">2015</span></a>                itag_tag_ID int(11) unsigned NOT NULL,
<a name="l2016"><span class="linenum">2016</span></a>                PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (itag_itm_ID, itag_tag_ID),
<a name="l2017"><span class="linenum">2017</span></a>                UNIQUE tagitem ( itag_tag_ID, itag_itm_ID )
<a name="l2018"><span class="linenum">2018</span></a>              )&quot; );
<a name="l2019"><span class="linenum">2019</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2020"><span class="linenum">2020</span></a>  
<a name="l2021"><span class="linenum">2021</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9414' );
<a name="l2022"><span class="linenum">2022</span></a>      }
<a name="l2023"><span class="linenum">2023</span></a>  
<a name="l2024"><span class="linenum">2024</span></a>  
<a name="l2025"><span class="linenum">2025</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9416 )
<a name="l2026"><span class="linenum">2026</span></a>      {
<a name="l2027"><span class="linenum">2027</span></a>          echo &quot;Updating blogs table...&quot;;
<a name="l2028"><span class="linenum">2028</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_blogs
<a name="l2029"><span class="linenum">2029</span></a>                                      ADD COLUMN blog_advanced_perms  TINYINT(1) NOT NULL default 0 AFTER blog_owner_user_ID,
<a name="l2030"><span class="linenum">2030</span></a>                                      DROP COLUMN blog_staticfilename&quot; );
<a name="l2031"><span class="linenum">2031</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_blogs
<a name="l2032"><span class="linenum">2032</span></a>                                        SET blog_advanced_perms = 1&quot; );
<a name="l2033"><span class="linenum">2033</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2034"><span class="linenum">2034</span></a>  
<a name="l2035"><span class="linenum">2035</span></a>          echo &quot;Additionnal blog permissions...&quot;;
<a name="l2036"><span class="linenum">2036</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_user_perms
<a name="l2037"><span class="linenum">2037</span></a>                                      ADD COLUMN bloguser_perm_admin tinyint NOT NULL default 0 AFTER bloguser_perm_properties,
<a name="l2038"><span class="linenum">2038</span></a>                                      ADD COLUMN bloguser_perm_edit  ENUM('no','own','lt','le','all','redirected') NOT NULL default 'no' AFTER bloguser_perm_poststatuses&quot; );
<a name="l2039"><span class="linenum">2039</span></a>  
<a name="l2040"><span class="linenum">2040</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_group_perms
<a name="l2041"><span class="linenum">2041</span></a>                                      ADD COLUMN bloggroup_perm_admin tinyint NOT NULL default 0 AFTER bloggroup_perm_properties,
<a name="l2042"><span class="linenum">2042</span></a>                                      ADD COLUMN bloggroup_perm_edit  ENUM('no','own','lt','le','all','redirected') NOT NULL default 'no' AFTER bloggroup_perm_poststatuses&quot; );
<a name="l2043"><span class="linenum">2043</span></a>  
<a name="l2044"><span class="linenum">2044</span></a>  <span class="comment">        // Preserve full admin perms:</span>
<a name="l2045"><span class="linenum">2045</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_coll_user_perms
<a name="l2046"><span class="linenum">2046</span></a>                                          SET bloguser_perm_admin = 1
<a name="l2047"><span class="linenum">2047</span></a>                                      WHERE bloguser_perm_properties &lt;&gt; 0&quot; );
<a name="l2048"><span class="linenum">2048</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_coll_group_perms
<a name="l2049"><span class="linenum">2049</span></a>                                          SET bloggroup_perm_admin = 1
<a name="l2050"><span class="linenum">2050</span></a>                                      WHERE bloggroup_perm_properties &lt;&gt; 0&quot; );
<a name="l2051"><span class="linenum">2051</span></a>  
<a name="l2052"><span class="linenum">2052</span></a>  <span class="comment">        // Preserve full edit perms:</span>
<a name="l2053"><span class="linenum">2053</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_coll_user_perms
<a name="l2054"><span class="linenum">2054</span></a>                                          SET bloguser_perm_edit = 'all'&quot; );
<a name="l2055"><span class="linenum">2055</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_coll_group_perms
<a name="l2056"><span class="linenum">2056</span></a>                                          SET bloggroup_perm_edit = 'all'&quot; );
<a name="l2057"><span class="linenum">2057</span></a>  
<a name="l2058"><span class="linenum">2058</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2059"><span class="linenum">2059</span></a>  
<a name="l2060"><span class="linenum">2060</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9416' );
<a name="l2061"><span class="linenum">2061</span></a>      }
<a name="l2062"><span class="linenum">2062</span></a>  
<a name="l2063"><span class="linenum">2063</span></a>  
<a name="l2064"><span class="linenum">2064</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9500 )
<a name="l2065"><span class="linenum">2065</span></a>      {
<a name="l2066"><span class="linenum">2066</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Normalizing columns...' );
<a name="l2067"><span class="linenum">2067</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_blogs
<a name="l2068"><span class="linenum">2068</span></a>                                          ALTER COLUMN blog_shortname SET DEFAULT \'\',
<a name="l2069"><span class="linenum">2069</span></a>                                          ALTER COLUMN blog_tagline SET DEFAULT \'\',
<a name="l2070"><span class="linenum">2070</span></a>                                          CHANGE COLUMN blog_description blog_description     varchar(250) NULL default \'\',
<a name="l2071"><span class="linenum">2071</span></a>                                          ALTER COLUMN blog_siteurl SET DEFAULT \'\'' );
<a name="l2072"><span class="linenum">2072</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2073"><span class="linenum">2073</span></a>  
<a name="l2074"><span class="linenum">2074</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Normalizing dates...' );
<a name="l2075"><span class="linenum">2075</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users
<a name="l2076"><span class="linenum">2076</span></a>                                          SET dateYMDhour = \'2000-01-01 00:00:00\'
<a name="l2077"><span class="linenum">2077</span></a>                                      WHERE dateYMDhour = \'0000-00-00 00:00:00\'' );
<a name="l2078"><span class="linenum">2078</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users
<a name="l2079"><span class="linenum">2079</span></a>                                      MODIFY COLUMN dateYMDhour DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\'' );
<a name="l2080"><span class="linenum">2080</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments
<a name="l2081"><span class="linenum">2081</span></a>                                          SET comment_date = \'2000-01-01 00:00:00\'
<a name="l2082"><span class="linenum">2082</span></a>                                      WHERE comment_date = \'0000-00-00 00:00:00\'' );
<a name="l2083"><span class="linenum">2083</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l2084"><span class="linenum">2084</span></a>                                      MODIFY COLUMN comment_date DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\'' );
<a name="l2085"><span class="linenum">2085</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2086"><span class="linenum">2086</span></a>  
<a name="l2087"><span class="linenum">2087</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Normalizing cron jobs...' );
<a name="l2088"><span class="linenum">2088</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_cron__task
<a name="l2089"><span class="linenum">2089</span></a>                                          SET ctsk_controller = <a class="function" onClick="logFunction('REPLACE')" href="../../_functions/replace.html" onMouseOver="funcPopup(event,'replace')">REPLACE</a>(ctsk_controller, &quot;cron/_&quot;, &quot;cron/jobs/_&quot; )
<a name="l2090"><span class="linenum">2090</span></a>                                      WHERE ctsk_controller LIKE &quot;cron/_%&quot;' );
<a name="l2091"><span class="linenum">2091</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2092"><span class="linenum">2092</span></a>  
<a name="l2093"><span class="linenum">2093</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Extending comments table...' );
<a name="l2094"><span class="linenum">2094</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l2095"><span class="linenum">2095</span></a>                                      ADD COLUMN comment_rating     TINYINT(1) NULL DEFAULT NULL AFTER comment_content,
<a name="l2096"><span class="linenum">2096</span></a>                                      ADD COLUMN comment_featured   TINYINT(1) NOT NULL DEFAULT 0 AFTER comment_rating,
<a name="l2097"><span class="linenum">2097</span></a>                                      ADD COLUMN comment_nofollow   TINYINT(1) NOT NULL DEFAULT 1 AFTER comment_featured;');
<a name="l2098"><span class="linenum">2098</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2099"><span class="linenum">2099</span></a>  
<a name="l2100"><span class="linenum">2100</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9500' );
<a name="l2101"><span class="linenum">2101</span></a>      }
<a name="l2102"><span class="linenum">2102</span></a>  
<a name="l2103"><span class="linenum">2103</span></a>  
<a name="l2104"><span class="linenum">2104</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9600 )
<a name="l2105"><span class="linenum">2105</span></a>      {    // 2.2.0
<a name="l2106"><span class="linenum">2106</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating global cache table...' );
<a name="l2107"><span class="linenum">2107</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_global__cache (
<a name="l2108"><span class="linenum">2108</span></a>                                    cach_name VARCHAR( 30 ) NOT NULL ,
<a name="l2109"><span class="linenum">2109</span></a>                                    cach_cache MEDIUMBLOB NULL ,
<a name="l2110"><span class="linenum">2110</span></a>                                    PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( cach_name )
<a name="l2111"><span class="linenum">2111</span></a>                                  )' );
<a name="l2112"><span class="linenum">2112</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2113"><span class="linenum">2113</span></a>  
<a name="l2114"><span class="linenum">2114</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Altering posts table...' );
<a name="l2115"><span class="linenum">2115</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_items__item
<a name="l2116"><span class="linenum">2116</span></a>                                          MODIFY COLUMN post_datestart DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\',
<a name="l2117"><span class="linenum">2117</span></a>                                          MODIFY COLUMN post_datemodified DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\',
<a name="l2118"><span class="linenum">2118</span></a>                                          ADD COLUMN post_order    float NULL AFTER post_priority,
<a name="l2119"><span class="linenum">2119</span></a>                                          ADD COLUMN post_featured tinyint(1) NOT NULL DEFAULT 0 AFTER post_order,
<a name="l2120"><span class="linenum">2120</span></a>                                          ADD INDEX post_order( post_order )' );
<a name="l2121"><span class="linenum">2121</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2122"><span class="linenum">2122</span></a>  
<a name="l2123"><span class="linenum">2123</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9600' );
<a name="l2124"><span class="linenum">2124</span></a>      }
<a name="l2125"><span class="linenum">2125</span></a>  
<a name="l2126"><span class="linenum">2126</span></a>  
<a name="l2127"><span class="linenum">2127</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9700 )
<a name="l2128"><span class="linenum">2128</span></a>      {    // 2.3.2
<a name="l2129"><span class="linenum">2129</span></a>        echo 'Creating PodCast Post Type... ';
<a name="l2130"><span class="linenum">2130</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l2131"><span class="linenum">2131</span></a>              REPLACE INTO T_items__type ( ptyp_ID, ptyp_name )
<a name="l2132"><span class="linenum">2132</span></a>              VALUES ( 2000, 'Podcast' )&quot; );
<a name="l2133"><span class="linenum">2133</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2134"><span class="linenum">2134</span></a>  
<a name="l2135"><span class="linenum">2135</span></a>  <span class="comment">        // 2.4.0</span>
<a name="l2136"><span class="linenum">2136</span></a>        echo 'Adding additional group permissions... ';
<a name="l2137"><span class="linenum">2137</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l2138"><span class="linenum">2138</span></a>            ALTER TABLE T_groups
<a name="l2139"><span class="linenum">2139</span></a>                      ADD COLUMN grp_perm_bypass_antispam         TINYINT(1)  NOT NULL DEFAULT 0        AFTER grp_perm_blogs,
<a name="l2140"><span class="linenum">2140</span></a>                      ADD COLUMN grp_perm_xhtmlvalidation         VARCHAR(10) NOT NULL default 'always' AFTER grp_perm_bypass_antispam,
<a name="l2141"><span class="linenum">2141</span></a>                      ADD COLUMN grp_perm_xhtmlvalidation_xmlrpc  VARCHAR(10) NOT NULL default 'always' AFTER grp_perm_xhtmlvalidation,
<a name="l2142"><span class="linenum">2142</span></a>                      ADD COLUMN grp_perm_xhtml_css_tweaks        TINYINT(1)  NOT NULL DEFAULT 0        AFTER grp_perm_xhtmlvalidation_xmlrpc,
<a name="l2143"><span class="linenum">2143</span></a>                ADD COLUMN grp_perm_xhtml_iframes           TINYINT(1)  NOT NULL DEFAULT 0        AFTER grp_perm_xhtml_css_tweaks,
<a name="l2144"><span class="linenum">2144</span></a>                ADD COLUMN grp_perm_xhtml_javascript        TINYINT(1)  NOT NULL DEFAULT 0        AFTER grp_perm_xhtml_iframes,
<a name="l2145"><span class="linenum">2145</span></a>                      ADD COLUMN grp_perm_xhtml_objects           TINYINT(1)  NOT NULL DEFAULT 0        AFTER grp_perm_xhtml_javascript &quot; );
<a name="l2146"><span class="linenum">2146</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2147"><span class="linenum">2147</span></a>  
<a name="l2148"><span class="linenum">2148</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9700' );
<a name="l2149"><span class="linenum">2149</span></a>      }
<a name="l2150"><span class="linenum">2150</span></a>  
<a name="l2151"><span class="linenum">2151</span></a>  
<a name="l2152"><span class="linenum">2152</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9800 )
<a name="l2153"><span class="linenum">2153</span></a>      {    // 2.5.0
<a name="l2154"><span class="linenum">2154</span></a>          echo 'Upgrading blogs table... ';
<a name="l2155"><span class="linenum">2155</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_blogs', 'blog_commentsexpire' );
<a name="l2156"><span class="linenum">2156</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2157"><span class="linenum">2157</span></a>  
<a name="l2158"><span class="linenum">2158</span></a>          echo 'Upgrading items table... ';
<a name="l2159"><span class="linenum">2159</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item
<a name="l2160"><span class="linenum">2160</span></a>              CHANGE COLUMN post_urltitle post_urltitle VARCHAR(210) NULL DEFAULT NULL,
<a name="l2161"><span class="linenum">2161</span></a>              CHANGE COLUMN post_order    post_order DOUBLE NULL,
<a name="l2162"><span class="linenum">2162</span></a>              ADD COLUMN post_titletag  VARCHAR(255) NULL DEFAULT NULL AFTER post_urltitle,
<a name="l2163"><span class="linenum">2163</span></a>              ADD COLUMN post_double1   DOUBLE NULL COMMENT 'Custom double value 1' AFTER post_priority,
<a name="l2164"><span class="linenum">2164</span></a>              ADD COLUMN post_double2   DOUBLE NULL COMMENT 'Custom double value 2' AFTER post_double1,
<a name="l2165"><span class="linenum">2165</span></a>              ADD COLUMN post_double3   DOUBLE NULL COMMENT 'Custom double value 3' AFTER post_double2,
<a name="l2166"><span class="linenum">2166</span></a>              ADD COLUMN post_double4   DOUBLE NULL COMMENT 'Custom double value 4' AFTER post_double3,
<a name="l2167"><span class="linenum">2167</span></a>              ADD COLUMN post_double5   DOUBLE NULL COMMENT 'Custom double value 5' AFTER post_double4,
<a name="l2168"><span class="linenum">2168</span></a>              ADD COLUMN post_varchar1  VARCHAR(255) NULL COMMENT 'Custom varchar value 1' AFTER post_double5,
<a name="l2169"><span class="linenum">2169</span></a>              ADD COLUMN post_varchar2  VARCHAR(255) NULL COMMENT 'Custom varchar value 2' AFTER post_varchar1,
<a name="l2170"><span class="linenum">2170</span></a>              ADD COLUMN post_varchar3  VARCHAR(255) NULL COMMENT 'Custom varchar value 3' AFTER post_varchar2&quot; );
<a name="l2171"><span class="linenum">2171</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2172"><span class="linenum">2172</span></a>  
<a name="l2173"><span class="linenum">2173</span></a>          echo 'Creating keyphrase table... ';
<a name="l2174"><span class="linenum">2174</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;CREATE TABLE T_track__keyphrase (
<a name="l2175"><span class="linenum">2175</span></a>              keyp_ID      INT UNSIGNED NOT NULL AUTO_INCREMENT,
<a name="l2176"><span class="linenum">2176</span></a>              keyp_phrase  VARCHAR( 255 ) NOT NULL,
<a name="l2177"><span class="linenum">2177</span></a>              PRIMARY KEY        ( keyp_ID ),
<a name="l2178"><span class="linenum">2178</span></a>              UNIQUE keyp_phrase ( keyp_phrase )
<a name="l2179"><span class="linenum">2179</span></a>            )&quot;;
<a name="l2180"><span class="linenum">2180</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l2181"><span class="linenum">2181</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2182"><span class="linenum">2182</span></a>  
<a name="l2183"><span class="linenum">2183</span></a>          echo 'Upgrading hitlog table... ';
<a name="l2184"><span class="linenum">2184</span></a>          <a class="function" onClick="logFunction('evo_flush')" href="../../_functions/evo_flush.html" onMouseOver="funcPopup(event,'evo_flush')">evo_flush</a>();
<a name="l2185"><span class="linenum">2185</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;ALTER TABLE T_hitlog
<a name="l2186"><span class="linenum">2186</span></a>               CHANGE COLUMN hit_ID hit_ID              INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
<a name="l2187"><span class="linenum">2187</span></a>               CHANGE COLUMN hit_datetime hit_datetime  DATETIME NOT NULL DEFAULT '2000-01-01 00:00:00',
<a name="l2188"><span class="linenum">2188</span></a>               ADD COLUMN hit_keyphrase_keyp_ID         INT UNSIGNED DEFAULT NULL AFTER hit_referer_dom_ID,
<a name="l2189"><span class="linenum">2189</span></a>               ADD INDEX hit_remote_addr ( hit_remote_addr ),
<a name="l2190"><span class="linenum">2190</span></a>               ADD INDEX hit_sess_ID        ( hit_sess_ID )&quot;;
<a name="l2191"><span class="linenum">2191</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l2192"><span class="linenum">2192</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2193"><span class="linenum">2193</span></a>  
<a name="l2194"><span class="linenum">2194</span></a>          echo 'Upgrading sessions table... ';
<a name="l2195"><span class="linenum">2195</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_sessions
<a name="l2196"><span class="linenum">2196</span></a>              ALTER COLUMN sess_lastseen SET DEFAULT '2000-01-01 00:00:00',
<a name="l2197"><span class="linenum">2197</span></a>              ADD COLUMN sess_hitcount  INT(10) UNSIGNED NOT NULL DEFAULT 1 AFTER sess_key,
<a name="l2198"><span class="linenum">2198</span></a>              ADD KEY sess_user_ID (sess_user_ID)&quot; );
<a name="l2199"><span class="linenum">2199</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2200"><span class="linenum">2200</span></a>  
<a name="l2201"><span class="linenum">2201</span></a>          echo 'Creating goal tracking table... ';
<a name="l2202"><span class="linenum">2202</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_track__goal(
<a name="l2203"><span class="linenum">2203</span></a>                        goal_ID int(10) unsigned NOT NULL auto_increment,
<a name="l2204"><span class="linenum">2204</span></a>                        goal_name varchar(50) default NULL,
<a name="l2205"><span class="linenum">2205</span></a>                        goal_key varchar(32) default NULL,
<a name="l2206"><span class="linenum">2206</span></a>                        goal_redir_url varchar(255) default NULL,
<a name="l2207"><span class="linenum">2207</span></a>                        goal_default_value double default NULL,
<a name="l2208"><span class="linenum">2208</span></a>                        PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (goal_ID),
<a name="l2209"><span class="linenum">2209</span></a>                        UNIQUE KEY goal_key (goal_key)
<a name="l2210"><span class="linenum">2210</span></a>            )&quot; );
<a name="l2211"><span class="linenum">2211</span></a>  
<a name="l2212"><span class="linenum">2212</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_track__goalhit (
<a name="l2213"><span class="linenum">2213</span></a>                        ghit_ID int(10) unsigned NOT NULL auto_increment,
<a name="l2214"><span class="linenum">2214</span></a>                        ghit_goal_ID    int(10) unsigned NOT NULL,
<a name="l2215"><span class="linenum">2215</span></a>                        ghit_hit_ID     int(10) unsigned NOT NULL,
<a name="l2216"><span class="linenum">2216</span></a>                        ghit_params     TEXT default NULL,
<a name="l2217"><span class="linenum">2217</span></a>                        PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a>  (ghit_ID),
<a name="l2218"><span class="linenum">2218</span></a>                        KEY ghit_goal_ID (ghit_goal_ID),
<a name="l2219"><span class="linenum">2219</span></a>                        KEY ghit_hit_ID (ghit_hit_ID)
<a name="l2220"><span class="linenum">2220</span></a>           )&quot; );
<a name="l2221"><span class="linenum">2221</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2222"><span class="linenum">2222</span></a>  
<a name="l2223"><span class="linenum">2223</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9800' );
<a name="l2224"><span class="linenum">2224</span></a>      }
<a name="l2225"><span class="linenum">2225</span></a>  
<a name="l2226"><span class="linenum">2226</span></a>  
<a name="l2227"><span class="linenum">2227</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9900 )
<a name="l2228"><span class="linenum">2228</span></a>      {    // 3.0 part 1
<a name="l2229"><span class="linenum">2229</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating keyphrases in hitlog table... ' );
<a name="l2230"><span class="linenum">2230</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'sessions/model/_hit.class.php', 'Hit' );
<a name="l2231"><span class="linenum">2231</span></a>  <span class="comment">        // New Hit object creation was added later, to fix upgrades from very old versions.</span>
<a name="l2232"><span class="linenum">2232</span></a>  <span class="comment">        // We create a new temp Hit object to be able to call the Hit::extract_params_from_referer() function which was static when this upgrade block was created.</span>
<a name="l2233"><span class="linenum">2233</span></a>          <a class="var it6013" onMouseOver="hilite(6013)" onMouseOut="lolite()" onClick="logVariable('tempHit')" href="../../_variables/tempHit.html">$tempHit</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Hit')" href="../../_classes/hit.html" onMouseOver="classPopup(event,'hit')">Hit</a>();
<a name="l2234"><span class="linenum">2234</span></a>          <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT SQL_NO_CACHE hit_ID, hit_referer
<a name="l2235"><span class="linenum">2235</span></a>                      FROM T_hitlog
<a name="l2236"><span class="linenum">2236</span></a>                      WHERE hit_referer_type = &quot;search&quot;
<a name="l2237"><span class="linenum">2237</span></a>                     AND hit_keyphrase_keyp_ID IS NULL'; <span class="comment">// this line just in case we crashed in the middle, so we restart where we stopped</span>
<a name="l2238"><span class="linenum">2238</span></a>          <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="constant" onClick="logConstant('OBJECT')" href="../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 'get all search hits' );
<a name="l2239"><span class="linenum">2239</span></a>          foreach( <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l2240"><span class="linenum">2240</span></a>          {
<a name="l2241"><span class="linenum">2241</span></a>              <a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a> = <a class="var it6013" onMouseOver="hilite(6013)" onMouseOut="lolite()" onClick="logVariable('tempHit')" href="../../_variables/tempHit.html">$tempHit</a>-&gt;<a class="function" onClick="logFunction('extract_params_from_referer')" href="../../_functions/extract_params_from_referer.html" onMouseOver="funcPopup(event,'extract_params_from_referer')">extract_params_from_referer</a>( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('hit_referer')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/hit_referer.html">hit_referer</a> );
<a name="l2242"><span class="linenum">2242</span></a>              if( empty( <a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['keyphrase'] ) )
<a name="l2243"><span class="linenum">2243</span></a>              {
<a name="l2244"><span class="linenum">2244</span></a>                  continue;
<a name="l2245"><span class="linenum">2245</span></a>              }
<a name="l2246"><span class="linenum">2246</span></a>  
<a name="l2247"><span class="linenum">2247</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l2248"><span class="linenum">2248</span></a>  
<a name="l2249"><span class="linenum">2249</span></a>              <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT keyp_ID
<a name="l2250"><span class="linenum">2250</span></a>                        FROM T_track__keyphrase
<a name="l2251"><span class="linenum">2251</span></a>                       WHERE keyp_phrase = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['keyphrase']);
<a name="l2252"><span class="linenum">2252</span></a>              <a class="var it6014" onMouseOver="hilite(6014)" onMouseOut="lolite()" onClick="logVariable('keyp_ID')" href="../../_variables/keyp_ID.html">$keyp_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, 0, 0, 'Get keyphrase ID' );
<a name="l2253"><span class="linenum">2253</span></a>  
<a name="l2254"><span class="linenum">2254</span></a>              if( empty( <a class="var it6014" onMouseOver="hilite(6014)" onMouseOut="lolite()" onClick="logVariable('keyp_ID')" href="../../_variables/keyp_ID.html">$keyp_ID</a> ) )
<a name="l2255"><span class="linenum">2255</span></a>              {
<a name="l2256"><span class="linenum">2256</span></a>                  <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'INSERT INTO T_track__keyphrase( keyp_phrase )
<a name="l2257"><span class="linenum">2257</span></a>                          VALUES ('.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it40" onMouseOver="hilite(40)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../_variables/params.html">$params</a>['keyphrase']).')';
<a name="l2258"><span class="linenum">2258</span></a>                  <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, 'Add new keyphrase' );
<a name="l2259"><span class="linenum">2259</span></a>                  <a class="var it6014" onMouseOver="hilite(6014)" onMouseOut="lolite()" onClick="logVariable('keyp_ID')" href="../../_variables/keyp_ID.html">$keyp_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('insert_id')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/insert_id.html">insert_id</a>;
<a name="l2260"><span class="linenum">2260</span></a>              }
<a name="l2261"><span class="linenum">2261</span></a>  
<a name="l2262"><span class="linenum">2262</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_hitlog
<a name="l2263"><span class="linenum">2263</span></a>                              SET hit_keyphrase_keyp_ID = '.<a class="var it6014" onMouseOver="hilite(6014)" onMouseOut="lolite()" onClick="logVariable('keyp_ID')" href="../../_variables/keyp_ID.html">$keyp_ID</a>.'
<a name="l2264"><span class="linenum">2264</span></a>                            WHERE hit_ID = '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('hit_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/hit_ID.html">hit_ID</a>, 'Update hit' );
<a name="l2265"><span class="linenum">2265</span></a>  
<a name="l2266"><span class="linenum">2266</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l2267"><span class="linenum">2267</span></a>              echo &quot;. \n&quot;;
<a name="l2268"><span class="linenum">2268</span></a>          }
<a name="l2269"><span class="linenum">2269</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2270"><span class="linenum">2270</span></a>  
<a name="l2271"><span class="linenum">2271</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading widgets table... ' );
<a name="l2272"><span class="linenum">2272</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_widget
<a name="l2273"><span class="linenum">2273</span></a>              CHANGE COLUMN wi_order wi_order INT(10) NOT NULL&quot; );
<a name="l2274"><span class="linenum">2274</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2275"><span class="linenum">2275</span></a>  
<a name="l2276"><span class="linenum">2276</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Files table... ' );
<a name="l2277"><span class="linenum">2277</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_files
<a name="l2278"><span class="linenum">2278</span></a>                                  CHANGE COLUMN file_root_type file_root_type enum('absolute','user','collection','shared','skins') not null default 'absolute'&quot; );
<a name="l2279"><span class="linenum">2279</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2280"><span class="linenum">2280</span></a>  
<a name="l2281"><span class="linenum">2281</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9900' );
<a name="l2282"><span class="linenum">2282</span></a>      }
<a name="l2283"><span class="linenum">2283</span></a>  
<a name="l2284"><span class="linenum">2284</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9910 )
<a name="l2285"><span class="linenum">2285</span></a>      {    // 3.0 part 2
<a name="l2286"><span class="linenum">2286</span></a>  
<a name="l2287"><span class="linenum">2287</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Blogs table... ' );
<a name="l2288"><span class="linenum">2288</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_blogs CHANGE COLUMN blog_name blog_name varchar(255) NOT NULL default ''&quot; );
<a name="l2289"><span class="linenum">2289</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2290"><span class="linenum">2290</span></a>  
<a name="l2291"><span class="linenum">2291</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding new Post Types...' );
<a name="l2292"><span class="linenum">2292</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l2293"><span class="linenum">2293</span></a>              REPLACE INTO T_items__type( ptyp_ID, ptyp_name )
<a name="l2294"><span class="linenum">2294</span></a>              VALUES ( 1500, 'Intro-Main' ),
<a name="l2295"><span class="linenum">2295</span></a>                           ( 1520, 'Intro-Cat' ),
<a name="l2296"><span class="linenum">2296</span></a>                           ( 1530, 'Intro-Tag' ),
<a name="l2297"><span class="linenum">2297</span></a>                           ( 1570, 'Intro-Sub' ),
<a name="l2298"><span class="linenum">2298</span></a>                           ( 1600, 'Intro-All' ) &quot; );
<a name="l2299"><span class="linenum">2299</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2300"><span class="linenum">2300</span></a>  
<a name="l2301"><span class="linenum">2301</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating User table' );
<a name="l2302"><span class="linenum">2302</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_users
<a name="l2303"><span class="linenum">2303</span></a>                                      ADD COLUMN user_avatar_file_ID int(10) unsigned default NULL AFTER user_validated&quot; );
<a name="l2304"><span class="linenum">2304</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2305"><span class="linenum">2305</span></a>  
<a name="l2306"><span class="linenum">2306</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for User field definitions' );
<a name="l2307"><span class="linenum">2307</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_users__fielddefs (
<a name="l2308"><span class="linenum">2308</span></a>                  ufdf_ID int(10) unsigned NOT NULL,
<a name="l2309"><span class="linenum">2309</span></a>                  ufdf_type char(8) NOT NULL,
<a name="l2310"><span class="linenum">2310</span></a>                  ufdf_name varchar(255) collate latin1_general_ci NOT NULL,
<a name="l2311"><span class="linenum">2311</span></a>                  PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a>  (ufdf_ID)
<a name="l2312"><span class="linenum">2312</span></a>              )&quot; );
<a name="l2313"><span class="linenum">2313</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2314"><span class="linenum">2314</span></a>  
<a name="l2315"><span class="linenum">2315</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating default field definitions...' );
<a name="l2316"><span class="linenum">2316</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l2317"><span class="linenum">2317</span></a>          INSERT INTO T_users__fielddefs (ufdf_ID, ufdf_type, ufdf_name)
<a name="l2318"><span class="linenum">2318</span></a>               VALUES ( 10000, 'email',    'MSN/Live IM'),
<a name="l2319"><span class="linenum">2319</span></a>                              ( 10100, 'word',     'Yahoo IM'),
<a name="l2320"><span class="linenum">2320</span></a>                              ( 10200, 'word',     'AOL AIM'),
<a name="l2321"><span class="linenum">2321</span></a>                              ( 10300, 'number',   'ICQ ID'),
<a name="l2322"><span class="linenum">2322</span></a>                              ( 40000, 'phone',    'Skype'),
<a name="l2323"><span class="linenum">2323</span></a>                              ( 50000, 'phone',    'Main phone'),
<a name="l2324"><span class="linenum">2324</span></a>                              ( 50100, 'phone',    'Cell phone'),
<a name="l2325"><span class="linenum">2325</span></a>                              ( 50200, 'phone',    'Office phone'),
<a name="l2326"><span class="linenum">2326</span></a>                              ( 50300, 'phone',    'Home phone'),
<a name="l2327"><span class="linenum">2327</span></a>                              ( 60000, 'phone',    'Office FAX'),
<a name="l2328"><span class="linenum">2328</span></a>                              ( 60100, 'phone',    'Home FAX'),
<a name="l2329"><span class="linenum">2329</span></a>                              (100000, 'url',      'Website'),
<a name="l2330"><span class="linenum">2330</span></a>                              (100100, 'url',      'Blog'),
<a name="l2331"><span class="linenum">2331</span></a>                              (110000, 'url',      'Linkedin'),
<a name="l2332"><span class="linenum">2332</span></a>                              (120000, 'url',      'Twitter'),
<a name="l2333"><span class="linenum">2333</span></a>                              (130100, 'url',      'Facebook'),
<a name="l2334"><span class="linenum">2334</span></a>                              (130200, 'url',      'Myspace'),
<a name="l2335"><span class="linenum">2335</span></a>                              (140000, 'url',      'Flickr'),
<a name="l2336"><span class="linenum">2336</span></a>                              (150000, 'url',      'YouTube'),
<a name="l2337"><span class="linenum">2337</span></a>                              (160000, 'url',      'Digg'),
<a name="l2338"><span class="linenum">2338</span></a>                              (160100, 'url',      'StumbleUpon'),
<a name="l2339"><span class="linenum">2339</span></a>                              (200000, 'text',     'Role'),
<a name="l2340"><span class="linenum">2340</span></a>                              (200100, 'text',     'Company/Org.'),
<a name="l2341"><span class="linenum">2341</span></a>                              (200200, 'text',     'Division'),
<a name="l2342"><span class="linenum">2342</span></a>                              (211000, 'text',     'VAT ID'),
<a name="l2343"><span class="linenum">2343</span></a>                              (300000, 'text',     'Main address'),
<a name="l2344"><span class="linenum">2344</span></a>                              (300300, 'text',     'Home address');&quot; );
<a name="l2345"><span class="linenum">2345</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2346"><span class="linenum">2346</span></a>  
<a name="l2347"><span class="linenum">2347</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for User fields...' );
<a name="l2348"><span class="linenum">2348</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}users_fields (
<a name="l2349"><span class="linenum">2349</span></a>                  uf_ID      int(10) unsigned NOT NULL auto_increment,
<a name="l2350"><span class="linenum">2350</span></a>                uf_user_ID int(10) unsigned NOT NULL,
<a name="l2351"><span class="linenum">2351</span></a>                uf_ufdf_ID int(10) unsigned NOT NULL,
<a name="l2352"><span class="linenum">2352</span></a>                uf_varchar varchar(255) NOT NULL,
<a name="l2353"><span class="linenum">2353</span></a>                PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (uf_ID)
<a name="l2354"><span class="linenum">2354</span></a>              )&quot; );
<a name="l2355"><span class="linenum">2355</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2356"><span class="linenum">2356</span></a>  
<a name="l2357"><span class="linenum">2357</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9910' );
<a name="l2358"><span class="linenum">2358</span></a>      }
<a name="l2359"><span class="linenum">2359</span></a>  
<a name="l2360"><span class="linenum">2360</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9920 )
<a name="l2361"><span class="linenum">2361</span></a>      {    // 3.1
<a name="l2362"><span class="linenum">2362</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Posts table... ' );
<a name="l2363"><span class="linenum">2363</span></a>  <span class="comment">        // This is for old posts that may have a post type of NULL which should never happen. ptyp 1 is for regular posts</span>
<a name="l2364"><span class="linenum">2364</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_items__item
<a name="l2365"><span class="linenum">2365</span></a>                                          SET post_ptyp_ID = 1
<a name="l2366"><span class="linenum">2366</span></a>                                      WHERE post_ptyp_ID IS NULL&quot; );
<a name="l2367"><span class="linenum">2367</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item
<a name="l2368"><span class="linenum">2368</span></a>                              CHANGE COLUMN post_ptyp_ID post_ptyp_ID int(10) unsigned NOT NULL DEFAULT 1&quot; );
<a name="l2369"><span class="linenum">2369</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2370"><span class="linenum">2370</span></a>  
<a name="l2371"><span class="linenum">2371</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Categories table... ' );
<a name="l2372"><span class="linenum">2372</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_categories
<a name="l2373"><span class="linenum">2373</span></a>              CHANGE COLUMN cat_name cat_name varchar(255) NOT NULL,
<a name="l2374"><span class="linenum">2374</span></a>              CHANGE COLUMN cat_description cat_description varchar(255) NULL DEFAULT NULL&quot; );
<a name="l2375"><span class="linenum">2375</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_categories', 'cat_order', 'int(11) NULL DEFAULT NULL AFTER cat_description' );
<a name="l2376"><span class="linenum">2376</span></a>          <a class="function" onClick="logFunction('db_add_index')" href="../../_functions/db_add_index.html" onMouseOver="funcPopup(event,'db_add_index')">db_add_index</a>( 'T_categories', 'cat_order', 'cat_order' );
<a name="l2377"><span class="linenum">2377</span></a>  
<a name="l2378"><span class="linenum">2378</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_categories
<a name="l2379"><span class="linenum">2379</span></a>                      SET cat_order = cat_ID&quot; );
<a name="l2380"><span class="linenum">2380</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2381"><span class="linenum">2381</span></a>  
<a name="l2382"><span class="linenum">2382</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading widgets table... ' );
<a name="l2383"><span class="linenum">2383</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_widget', 'wi_enabled', 'tinyint(1) NOT NULL DEFAULT 1 AFTER wi_order' );
<a name="l2384"><span class="linenum">2384</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2385"><span class="linenum">2385</span></a>      }
<a name="l2386"><span class="linenum">2386</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9930 )
<a name="l2387"><span class="linenum">2387</span></a>      {    // 3.1 continued
<a name="l2388"><span class="linenum">2388</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating item types...' );
<a name="l2389"><span class="linenum">2389</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l2390"><span class="linenum">2390</span></a>              REPLACE INTO T_items__type ( ptyp_ID, ptyp_name )
<a name="l2391"><span class="linenum">2391</span></a>              VALUES ( 3000, 'Sidebar link' )&quot; );
<a name="l2392"><span class="linenum">2392</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2393"><span class="linenum">2393</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2394"><span class="linenum">2394</span></a>  
<a name="l2395"><span class="linenum">2395</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating items table...' );
<a name="l2396"><span class="linenum">2396</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item ENGINE=innodb&quot; );    <span class="comment">// fp&gt; hum... this originally was a test :)</span>
<a name="l2397"><span class="linenum">2397</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2398"><span class="linenum">2398</span></a>  
<a name="l2399"><span class="linenum">2399</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating versions table...' );
<a name="l2400"><span class="linenum">2400</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_items__version (
<a name="l2401"><span class="linenum">2401</span></a>                  iver_itm_ID        INT UNSIGNED NOT NULL ,
<a name="l2402"><span class="linenum">2402</span></a>                  iver_edit_user_ID  INT UNSIGNED NOT NULL ,
<a name="l2403"><span class="linenum">2403</span></a>                  iver_edit_datetime DATETIME NOT NULL ,
<a name="l2404"><span class="linenum">2404</span></a>                  iver_status        ENUM('published','deprecated','protected','private','draft','redirected') NULL ,
<a name="l2405"><span class="linenum">2405</span></a>                  iver_title         TEXT NULL ,
<a name="l2406"><span class="linenum">2406</span></a>                  iver_content       MEDIUMTEXT NULL ,
<a name="l2407"><span class="linenum">2407</span></a>                  INDEX iver_itm_ID ( iver_itm_ID )
<a name="l2408"><span class="linenum">2408</span></a>                  ) ENGINE = innodb&quot; );
<a name="l2409"><span class="linenum">2409</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2410"><span class="linenum">2410</span></a>  
<a name="l2411"><span class="linenum">2411</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating group permissions...' );
<a name="l2412"><span class="linenum">2412</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_groups
<a name="l2413"><span class="linenum">2413</span></a>                                          SET grp_perm_xhtml_css_tweaks = 1
<a name="l2414"><span class="linenum">2414</span></a>                                      WHERE grp_ID &lt;= 3&quot; );
<a name="l2415"><span class="linenum">2415</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2416"><span class="linenum">2416</span></a>  
<a name="l2417"><span class="linenum">2417</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9930' );
<a name="l2418"><span class="linenum">2418</span></a>      }
<a name="l2419"><span class="linenum">2419</span></a>  
<a name="l2420"><span class="linenum">2420</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9940 )
<a name="l2421"><span class="linenum">2421</span></a>      {    // 3.2
<a name="l2422"><span class="linenum">2422</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating hitlog table...' );
<a name="l2423"><span class="linenum">2423</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_hitlog ADD COLUMN hit_serprank INT UNSIGNED DEFAULT NULL AFTER hit_keyphrase_keyp_ID&quot; );
<a name="l2424"><span class="linenum">2424</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2425"><span class="linenum">2425</span></a>  
<a name="l2426"><span class="linenum">2426</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating versions table...' );
<a name="l2427"><span class="linenum">2427</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__version
<a name="l2428"><span class="linenum">2428</span></a>                                  CHANGE COLUMN iver_edit_user_ID iver_edit_user_ID  INT UNSIGNED NULL&quot; );
<a name="l2429"><span class="linenum">2429</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2430"><span class="linenum">2430</span></a>      }
<a name="l2431"><span class="linenum">2431</span></a>  
<a name="l2432"><span class="linenum">2432</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9950 )
<a name="l2433"><span class="linenum">2433</span></a>      {    // 3.3
<a name="l2434"><span class="linenum">2434</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Altering Blogs table... ' );
<a name="l2435"><span class="linenum">2435</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_blogs CHANGE COLUMN blog_shortname blog_shortname varchar(255) default ''&quot; );
<a name="l2436"><span class="linenum">2436</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2437"><span class="linenum">2437</span></a>  
<a name="l2438"><span class="linenum">2438</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Altering default dates... ' );
<a name="l2439"><span class="linenum">2439</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_links
<a name="l2440"><span class="linenum">2440</span></a>        ALTER COLUMN link_datecreated SET DEFAULT '2000-01-01 00:00:00',
<a name="l2441"><span class="linenum">2441</span></a>        ALTER COLUMN link_datemodified SET DEFAULT '2000-01-01 00:00:00'&quot; );
<a name="l2442"><span class="linenum">2442</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_cron__task
<a name="l2443"><span class="linenum">2443</span></a>        ALTER COLUMN ctsk_start_datetime SET DEFAULT '2000-01-01 00:00:00'&quot; );
<a name="l2444"><span class="linenum">2444</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_cron__log
<a name="l2445"><span class="linenum">2445</span></a>        ALTER COLUMN clog_realstart_datetime SET DEFAULT '2000-01-01 00:00:00'&quot; );
<a name="l2446"><span class="linenum">2446</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2447"><span class="linenum">2447</span></a>  
<a name="l2448"><span class="linenum">2448</span></a>           <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Altering Items table... ' );
<a name="l2449"><span class="linenum">2449</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item
<a name="l2450"><span class="linenum">2450</span></a>              ADD COLUMN post_metadesc VARCHAR(255) NULL DEFAULT NULL AFTER post_titletag,
<a name="l2451"><span class="linenum">2451</span></a>              ADD COLUMN post_metakeywords VARCHAR(255) NULL DEFAULT NULL AFTER post_metadesc,
<a name="l2452"><span class="linenum">2452</span></a>              ADD COLUMN post_editor_code VARCHAR(32) NULL COMMENT 'Plugin code of the editor used to edit this post' AFTER post_varchar3&quot; );
<a name="l2453"><span class="linenum">2453</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2454"><span class="linenum">2454</span></a>  
<a name="l2455"><span class="linenum">2455</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Forcing AutoP posts to html editor...' );
<a name="l2456"><span class="linenum">2456</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item
<a name="l2457"><span class="linenum">2457</span></a>                                              SET post_editor_code = &quot;html&quot;
<a name="l2458"><span class="linenum">2458</span></a>                                          WHERE post_renderers = &quot;default&quot;
<a name="l2459"><span class="linenum">2459</span></a>                                               OR post_renderers LIKE &quot;%b2WPAutP%&quot;' );
<a name="l2460"><span class="linenum">2460</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2461"><span class="linenum">2461</span></a>  
<a name="l2462"><span class="linenum">2462</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9950' );
<a name="l2463"><span class="linenum">2463</span></a>      }
<a name="l2464"><span class="linenum">2464</span></a>  
<a name="l2465"><span class="linenum">2465</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9960 )
<a name="l2466"><span class="linenum">2466</span></a>      {    // 3.3
<a name="l2467"><span class="linenum">2467</span></a>  
<a name="l2468"><span class="linenum">2468</span></a>          echo &quot;Renaming tables...&quot;;
<a name="l2469"><span class="linenum">2469</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('save_error_state')" href="../../_functions/save_error_state.html" onMouseOver="funcPopup(event,'save_error_state')">save_error_state</a>();
<a name="l2470"><span class="linenum">2470</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('halt_on_error')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/halt_on_error.html">halt_on_error</a> = false;
<a name="l2471"><span class="linenum">2471</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('show_errors')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/show_errors.html">show_errors</a> = false;
<a name="l2472"><span class="linenum">2472</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}users_fields RENAME TO T_users__fields&quot; );
<a name="l2473"><span class="linenum">2473</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('restore_error_state')" href="../../_functions/restore_error_state.html" onMouseOver="funcPopup(event,'restore_error_state')">restore_error_state</a>();
<a name="l2474"><span class="linenum">2474</span></a>          echo &quot;OK.&lt;br /&gt;\n&quot;;
<a name="l2475"><span class="linenum">2475</span></a>  
<a name="l2476"><span class="linenum">2476</span></a>  <span class="comment">        // fp&gt; The following is more tricky to do with CHARACTER SET. During upgrade, we don't know what the admin actually wants.</span>
<a name="l2477"><span class="linenum">2477</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Making sure all tables use desired storage ENGINE as specified in the b2evo schema...' );
<a name="l2478"><span class="linenum">2478</span></a>          foreach( <a class="var it4003" onMouseOver="hilite(4003)" onMouseOut="lolite()" onClick="logVariable('schema_queries')" href="../../_variables/schema_queries.html">$schema_queries</a> as <a class="var it2234" onMouseOver="hilite(2234)" onMouseOut="lolite()" onClick="logVariable('table_name')" href="../../_variables/table_name.html">$table_name</a>=&gt;<a class="var it6015" onMouseOver="hilite(6015)" onMouseOut="lolite()" onClick="logVariable('table_def')" href="../../_variables/table_def.html">$table_def</a> )
<a name="l2479"><span class="linenum">2479</span></a>          {
<a name="l2480"><span class="linenum">2480</span></a>              if( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'SHOW TABLES LIKE \''.<a class="var it2234" onMouseOver="hilite(2234)" onMouseOut="lolite()" onClick="logVariable('table_name')" href="../../_variables/table_name.html">$table_name</a>.'\'' )
<a name="l2481"><span class="linenum">2481</span></a>                  &amp;&amp; <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '/\sENGINE\s*=\s*([a-z]+)/is', <a class="var it6015" onMouseOver="hilite(6015)" onMouseOut="lolite()" onClick="logVariable('table_def')" href="../../_variables/table_def.html">$table_def</a>[1], <a class="var it701" onMouseOver="hilite(701)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a> ) )
<a name="l2482"><span class="linenum">2482</span></a>              {    // If the table exists and has an ENGINE definition:
<a name="l2483"><span class="linenum">2483</span></a>                  echo <a class="var it2234" onMouseOver="hilite(2234)" onMouseOut="lolite()" onClick="logVariable('table_name')" href="../../_variables/table_name.html">$table_name</a>.':'.<a class="var it701" onMouseOver="hilite(701)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1].'&lt;br /&gt;';
<a name="l2484"><span class="linenum">2484</span></a>                  <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE <a class="var it2234" onMouseOver="hilite(2234)" onMouseOut="lolite()" onClick="logVariable('table_name')" href="../../_variables/table_name.html">$table_name</a> ENGINE = &quot;.<a class="var it701" onMouseOver="hilite(701)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../../_variables/matches.html">$matches</a>[1] );
<a name="l2485"><span class="linenum">2485</span></a>              }
<a name="l2486"><span class="linenum">2486</span></a>          }
<a name="l2487"><span class="linenum">2487</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2488"><span class="linenum">2488</span></a>  
<a name="l2489"><span class="linenum">2489</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9960' );
<a name="l2490"><span class="linenum">2490</span></a>      }
<a name="l2491"><span class="linenum">2491</span></a>  
<a name="l2492"><span class="linenum">2492</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9970 )
<a name="l2493"><span class="linenum">2493</span></a>      {    // 4.0 part 1
<a name="l2494"><span class="linenum">2494</span></a>  
<a name="l2495"><span class="linenum">2495</span></a>  <span class="comment">        // For create_default_currencies() and create_default_countries():</span>
<a name="l2496"><span class="linenum">2496</span></a>          require_once <a class="phpfunction" onClick="logFunction('dirname')" href="../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(__FILE__).'/_functions_create.php';
<a name="l2497"><span class="linenum">2497</span></a>  
<a name="l2498"><span class="linenum">2498</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for default currencies... ' );
<a name="l2499"><span class="linenum">2499</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'<a class="function" onClick="logFunction('currency')" href="../../_functions/currency.html" onMouseOver="funcPopup(event,'currency')">currency</a> (
<a name="l2500"><span class="linenum">2500</span></a>                  curr_ID int(10) unsigned NOT NULL auto_increment,
<a name="l2501"><span class="linenum">2501</span></a>                  curr_code char(3) NOT NULL,
<a name="l2502"><span class="linenum">2502</span></a>                  curr_shortcut varchar(30) NOT NULL,
<a name="l2503"><span class="linenum">2503</span></a>                  curr_name varchar(40) NOT NULL,
<a name="l2504"><span class="linenum">2504</span></a>                  PRIMARY KEY curr_ID (curr_ID),
<a name="l2505"><span class="linenum">2505</span></a>                  UNIQUE curr_code (curr_code)
<a name="l2506"><span class="linenum">2506</span></a>              ) ENGINE = innodb' );
<a name="l2507"><span class="linenum">2507</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2508"><span class="linenum">2508</span></a>  
<a name="l2509"><span class="linenum">2509</span></a>          <a class="function" onClick="logFunction('create_default_currencies')" href="../../_functions/create_default_currencies.html" onMouseOver="funcPopup(event,'create_default_currencies')">create_default_currencies</a>( <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'currency' );
<a name="l2510"><span class="linenum">2510</span></a>  
<a name="l2511"><span class="linenum">2511</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for default countries... ' );
<a name="l2512"><span class="linenum">2512</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'<a class="function" onClick="logFunction('country')" href="../../_functions/country.html" onMouseOver="funcPopup(event,'country')">country</a> (
<a name="l2513"><span class="linenum">2513</span></a>                  ctry_ID int(10) unsigned NOT NULL auto_increment,
<a name="l2514"><span class="linenum">2514</span></a>                  ctry_code char(2) NOT NULL,
<a name="l2515"><span class="linenum">2515</span></a>                  ctry_name varchar(40) NOT NULL,
<a name="l2516"><span class="linenum">2516</span></a>                  ctry_curr_ID int(10) unsigned,
<a name="l2517"><span class="linenum">2517</span></a>                  PRIMARY KEY ctry_ID (ctry_ID),
<a name="l2518"><span class="linenum">2518</span></a>                  UNIQUE ctry_code (ctry_code)
<a name="l2519"><span class="linenum">2519</span></a>              ) ENGINE = innodb' );
<a name="l2520"><span class="linenum">2520</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2521"><span class="linenum">2521</span></a>  
<a name="l2522"><span class="linenum">2522</span></a>          <a class="function" onClick="logFunction('create_default_countries')" href="../../_functions/create_default_countries.html" onMouseOver="funcPopup(event,'create_default_countries')">create_default_countries</a>( <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'country', false );
<a name="l2523"><span class="linenum">2523</span></a>  
<a name="l2524"><span class="linenum">2524</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading user permissions table... ' );
<a name="l2525"><span class="linenum">2525</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_user_perms
<a name="l2526"><span class="linenum">2526</span></a>              ADD COLUMN bloguser_perm_page        tinyint NOT NULL default 0 AFTER bloguser_perm_media_change,
<a name="l2527"><span class="linenum">2527</span></a>              ADD COLUMN bloguser_perm_intro        tinyint NOT NULL default 0 AFTER bloguser_perm_page,
<a name="l2528"><span class="linenum">2528</span></a>              ADD COLUMN bloguser_perm_podcast    tinyint NOT NULL default 0 AFTER bloguser_perm_intro,
<a name="l2529"><span class="linenum">2529</span></a>              ADD COLUMN bloguser_perm_sidebar    tinyint NOT NULL default 0 AFTER bloguser_perm_podcast&quot; );
<a name="l2530"><span class="linenum">2530</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2531"><span class="linenum">2531</span></a>  
<a name="l2532"><span class="linenum">2532</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading group permissions table... ' );
<a name="l2533"><span class="linenum">2533</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_group_perms
<a name="l2534"><span class="linenum">2534</span></a>              ADD COLUMN bloggroup_perm_page        tinyint NOT NULL default 0 AFTER bloggroup_perm_media_change,
<a name="l2535"><span class="linenum">2535</span></a>              ADD COLUMN bloggroup_perm_intro        tinyint NOT NULL default 0 AFTER bloggroup_perm_page,
<a name="l2536"><span class="linenum">2536</span></a>              ADD COLUMN bloggroup_perm_podcast    tinyint NOT NULL default 0 AFTER bloggroup_perm_intro,
<a name="l2537"><span class="linenum">2537</span></a>              ADD COLUMN bloggroup_perm_sidebar    tinyint NOT NULL default 0 AFTER bloggroup_perm_podcast&quot; );
<a name="l2538"><span class="linenum">2538</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2539"><span class="linenum">2539</span></a>  
<a name="l2540"><span class="linenum">2540</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table... ' );
<a name="l2541"><span class="linenum">2541</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_users
<a name="l2542"><span class="linenum">2542</span></a>              ADD COLUMN user_ctry_ID int(10) unsigned NULL AFTER user_avatar_file_ID&quot; );
<a name="l2543"><span class="linenum">2543</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2544"><span class="linenum">2544</span></a>  
<a name="l2545"><span class="linenum">2545</span></a>  <span class="comment">        // Creating tables for messaging module</span>
<a name="l2546"><span class="linenum">2546</span></a>  
<a name="l2547"><span class="linenum">2547</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for message threads... ' );
<a name="l2548"><span class="linenum">2548</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_messaging__thread (
<a name="l2549"><span class="linenum">2549</span></a>              thrd_ID int(10) unsigned NOT NULL auto_increment,
<a name="l2550"><span class="linenum">2550</span></a>              thrd_title varchar(255) NOT NULL,
<a name="l2551"><span class="linenum">2551</span></a>              thrd_datemodified datetime NOT NULL,
<a name="l2552"><span class="linenum">2552</span></a>              PRIMARY KEY thrd_ID (thrd_ID)
<a name="l2553"><span class="linenum">2553</span></a>          ) ENGINE = innodb&quot; );
<a name="l2554"><span class="linenum">2554</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2555"><span class="linenum">2555</span></a>  
<a name="l2556"><span class="linenum">2556</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for messagee... ' );
<a name="l2557"><span class="linenum">2557</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_messaging__message (
<a name="l2558"><span class="linenum">2558</span></a>              msg_ID int(10) unsigned NOT NULL auto_increment,
<a name="l2559"><span class="linenum">2559</span></a>              msg_author_user_ID int(10) unsigned NOT NULL,
<a name="l2560"><span class="linenum">2560</span></a>              msg_datetime datetime NOT NULL,
<a name="l2561"><span class="linenum">2561</span></a>              msg_thread_ID int(10) unsigned NOT NULL,
<a name="l2562"><span class="linenum">2562</span></a>              msg_text text NULL,
<a name="l2563"><span class="linenum">2563</span></a>              PRIMARY KEY msg_ID (msg_ID)
<a name="l2564"><span class="linenum">2564</span></a>          ) ENGINE = innodb&quot; );
<a name="l2565"><span class="linenum">2565</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2566"><span class="linenum">2566</span></a>  
<a name="l2567"><span class="linenum">2567</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for message thread statuses... ' );
<a name="l2568"><span class="linenum">2568</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_messaging__threadstatus (
<a name="l2569"><span class="linenum">2569</span></a>              tsta_thread_ID int(10) unsigned NOT NULL,
<a name="l2570"><span class="linenum">2570</span></a>              tsta_user_ID int(10) unsigned NOT NULL,
<a name="l2571"><span class="linenum">2571</span></a>              tsta_first_unread_msg_ID int(10) unsigned NULL,
<a name="l2572"><span class="linenum">2572</span></a>              INDEX(tsta_user_ID)
<a name="l2573"><span class="linenum">2573</span></a>          ) ENGINE = innodb&quot; );
<a name="l2574"><span class="linenum">2574</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2575"><span class="linenum">2575</span></a>  
<a name="l2576"><span class="linenum">2576</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for messaging contacts... ' );
<a name="l2577"><span class="linenum">2577</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_messaging__contact (
<a name="l2578"><span class="linenum">2578</span></a>              mct_from_user_ID int(10) unsigned NOT NULL,
<a name="l2579"><span class="linenum">2579</span></a>              mct_to_user_ID int(10) unsigned NOT NULL,
<a name="l2580"><span class="linenum">2580</span></a>              mct_blocked tinyint(1) default 0,
<a name="l2581"><span class="linenum">2581</span></a>              mct_last_contact_datetime datetime NOT NULL,
<a name="l2582"><span class="linenum">2582</span></a>              PRIMARY KEY mct_PK (mct_from_user_ID, mct_to_user_ID)
<a name="l2583"><span class="linenum">2583</span></a>          ) ENGINE = innodb&quot; );
<a name="l2584"><span class="linenum">2584</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2585"><span class="linenum">2585</span></a>  
<a name="l2586"><span class="linenum">2586</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading skins table... ' );
<a name="l2587"><span class="linenum">2587</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_skins__skin
<a name="l2588"><span class="linenum">2588</span></a>                          MODIFY skin_type enum('normal','feed','sitemap') NOT NULL default 'normal'&quot; );
<a name="l2589"><span class="linenum">2589</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2590"><span class="linenum">2590</span></a>  
<a name="l2591"><span class="linenum">2591</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Setting skin type of sitemap skin to &quot;sitemap&quot;... ' );
<a name="l2592"><span class="linenum">2592</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_skins__skin
<a name="l2593"><span class="linenum">2593</span></a>                          SET skin_type = 'sitemap'
<a name="l2594"><span class="linenum">2594</span></a>                          WHERE skin_folder = '_sitemap'&quot; );
<a name="l2595"><span class="linenum">2595</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2596"><span class="linenum">2596</span></a>  
<a name="l2597"><span class="linenum">2597</span></a>  <span class="comment">        // Creating table for pluggable permissions</span>
<a name="l2598"><span class="linenum">2598</span></a>  
<a name="l2599"><span class="linenum">2599</span></a>  <span class="comment">        // This table gets created during upgrade to v0.8.9 at checkpoint 8050</span>
<a name="l2600"><span class="linenum">2600</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for Group Settings... ' );
<a name="l2601"><span class="linenum">2601</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE IF NOT EXISTS T_groups__groupsettings (
<a name="l2602"><span class="linenum">2602</span></a>              gset_grp_ID INT(11) UNSIGNED NOT NULL,
<a name="l2603"><span class="linenum">2603</span></a>              gset_name VARCHAR(30) NOT NULL,
<a name="l2604"><span class="linenum">2604</span></a>              gset_value VARCHAR(255) NULL,
<a name="l2605"><span class="linenum">2605</span></a>              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (gset_grp_ID, gset_name)
<a name="l2606"><span class="linenum">2606</span></a>          ) ENGINE = innodb&quot; );
<a name="l2607"><span class="linenum">2607</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2608"><span class="linenum">2608</span></a>  
<a name="l2609"><span class="linenum">2609</span></a>  <span class="comment">        // Rename T_usersettings table to T_users__usersettings</span>
<a name="l2610"><span class="linenum">2610</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Rename T_usersettings table to T_users__usersettings... ' );
<a name="l2611"><span class="linenum">2611</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'usersettings RENAME TO T_users__usersettings' );
<a name="l2612"><span class="linenum">2612</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2613"><span class="linenum">2613</span></a>  
<a name="l2614"><span class="linenum">2614</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9970' );
<a name="l2615"><span class="linenum">2615</span></a>      }
<a name="l2616"><span class="linenum">2616</span></a>  
<a name="l2617"><span class="linenum">2617</span></a>  
<a name="l2618"><span class="linenum">2618</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9980 )
<a name="l2619"><span class="linenum">2619</span></a>      {    // 4.0 part 2
<a name="l2620"><span class="linenum">2620</span></a>  
<a name="l2621"><span class="linenum">2621</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading posts... ' );
<a name="l2622"><span class="linenum">2622</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l2623"><span class="linenum">2623</span></a>              UPDATE T_items__item
<a name="l2624"><span class="linenum">2624</span></a>                 SET post_datestart = FROM_UNIXTIME( <a class="phpfunction" onClick="logFunction('FLOOR')" href="../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">FLOOR</a>(UNIX_TIMESTAMP(post_datestart)/60)*60 )
<a name="l2625"><span class="linenum">2625</span></a>               WHERE post_datestart &gt; <a class="function" onClick="logFunction('NOW')" href="../../_functions/now.html" onMouseOver="funcPopup(event,'now')">NOW</a>()' );
<a name="l2626"><span class="linenum">2626</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_excerpt_autogenerated', 'TINYINT NULL DEFAULT NULL AFTER post_excerpt' );
<a name="l2627"><span class="linenum">2627</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_dateset', 'tinyint(1) NOT NULL DEFAULT 1 AFTER post_assigned_user_ID' );
<a name="l2628"><span class="linenum">2628</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2629"><span class="linenum">2629</span></a>  
<a name="l2630"><span class="linenum">2630</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading countries... ' );
<a name="l2631"><span class="linenum">2631</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'country', 'ctry_enabled', 'tinyint(1) NOT NULL DEFAULT 1 AFTER ctry_curr_ID' );
<a name="l2632"><span class="linenum">2632</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2633"><span class="linenum">2633</span></a>  
<a name="l2634"><span class="linenum">2634</span></a>  
<a name="l2635"><span class="linenum">2635</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading links... ' );
<a name="l2636"><span class="linenum">2636</span></a>  
<a name="l2637"><span class="linenum">2637</span></a>  <span class="comment">        // Add link_position. Temporary allow NULL, set compatibility default, then do not allow NULL.</span>
<a name="l2638"><span class="linenum">2638</span></a>  <span class="comment">        // TODO: dh&gt; actually, using &quot;teaser&quot; for the first link and &quot;aftermore&quot; for the rest would make more sense (and &quot;aftermore&quot; should get displayed with &quot;no-more&quot; posts anyway).</span>
<a name="l2639"><span class="linenum">2639</span></a>  <span class="comment">        //           Opinions? Could be heavy to transform this though..</span>
<a name="l2640"><span class="linenum">2640</span></a>  <span class="comment">        // fp&gt; no, don't change past posts unexpectedly.</span>
<a name="l2641"><span class="linenum">2641</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_links', 'link_position', &quot;varchar(10) NULL AFTER link_title&quot; );
<a name="l2642"><span class="linenum">2642</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_links SET link_position = 'teaser' WHERE link_position IS NULL&quot; );
<a name="l2643"><span class="linenum">2643</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_links', 'link_position', &quot;varchar(10) NOT NULL AFTER link_title&quot; ); <span class="comment">// change to NOT NULL</span>
<a name="l2644"><span class="linenum">2644</span></a>  
<a name="l2645"><span class="linenum">2645</span></a>  <span class="comment">        // Add link_order. Temporary allow NULL, use order from ID, then do not allow NULL and add UNIQUE index.</span>
<a name="l2646"><span class="linenum">2646</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_links', 'link_order', 'int(11) unsigned NULL AFTER link_position' );
<a name="l2647"><span class="linenum">2647</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_links SET link_order = link_ID WHERE link_order IS NULL&quot; );
<a name="l2648"><span class="linenum">2648</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_links', 'link_order', 'int(11) unsigned NOT NULL AFTER link_position' ); <span class="comment">// change to NOT NULL</span>
<a name="l2649"><span class="linenum">2649</span></a>          <a class="function" onClick="logFunction('db_add_index')" href="../../_functions/db_add_index.html" onMouseOver="funcPopup(event,'db_add_index')">db_add_index</a>( 'T_links', 'link_itm_ID_order', 'link_itm_ID, link_order', 'UNIQUE' );
<a name="l2650"><span class="linenum">2650</span></a>  
<a name="l2651"><span class="linenum">2651</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2652"><span class="linenum">2652</span></a>  
<a name="l2653"><span class="linenum">2653</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading sessions... ' );
<a name="l2654"><span class="linenum">2654</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_sessions CHANGE COLUMN sess_ipaddress sess_ipaddress VARCHAR(39) NOT NULL DEFAULT ''&quot; );
<a name="l2655"><span class="linenum">2655</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2656"><span class="linenum">2656</span></a>  
<a name="l2657"><span class="linenum">2657</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9980' );
<a name="l2658"><span class="linenum">2658</span></a>      }
<a name="l2659"><span class="linenum">2659</span></a>  
<a name="l2660"><span class="linenum">2660</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 9990 )
<a name="l2661"><span class="linenum">2661</span></a>      {    // 4.0 part 3
<a name="l2662"><span class="linenum">2662</span></a>  
<a name="l2663"><span class="linenum">2663</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading hitlog... ' );
<a name="l2664"><span class="linenum">2664</span></a>  
<a name="l2665"><span class="linenum">2665</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_hitlog', 'hit_agent_type', &quot;ENUM('rss','robot','browser','unknown') DEFAULT 'unknown' NOT NULL AFTER hit_remote_addr&quot; );
<a name="l2666"><span class="linenum">2666</span></a>  
<a name="l2667"><span class="linenum">2667</span></a>          if( <a class="function" onClick="logFunction('db_col_exists')" href="../../_functions/db_col_exists.html" onMouseOver="funcPopup(event,'db_col_exists')">db_col_exists</a>('T_hitlog', 'hit_agnt_ID') )
<a name="l2668"><span class="linenum">2668</span></a>          {
<a name="l2669"><span class="linenum">2669</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_hitlog, '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'useragents
<a name="l2670"><span class="linenum">2670</span></a>                              SET hit_agent_type = agnt_type
<a name="l2671"><span class="linenum">2671</span></a>                            WHERE hit_agnt_ID = agnt_ID
<a name="l2672"><span class="linenum">2672</span></a>                              AND agnt_type &lt;&gt; &quot;unknown&quot;' ); <span class="comment">// We already have the unknown as default</span>
<a name="l2673"><span class="linenum">2673</span></a>              <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_hitlog', 'hit_agnt_ID' );
<a name="l2674"><span class="linenum">2674</span></a>          }
<a name="l2675"><span class="linenum">2675</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DROP TABLE IF EXISTS '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'useragents' );
<a name="l2676"><span class="linenum">2676</span></a>  
<a name="l2677"><span class="linenum">2677</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2678"><span class="linenum">2678</span></a>  
<a name="l2679"><span class="linenum">2679</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '9990' );
<a name="l2680"><span class="linenum">2680</span></a>      }
<a name="l2681"><span class="linenum">2681</span></a>  
<a name="l2682"><span class="linenum">2682</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10000 )
<a name="l2683"><span class="linenum">2683</span></a>      {    // 4.0 part 4
<a name="l2684"><span class="linenum">2684</span></a>  <span class="comment">        // Integrate comment_secret</span>
<a name="l2685"><span class="linenum">2685</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Extending Comment table... ' );
<a name="l2686"><span class="linenum">2686</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_comments', 'comment_secret', 'varchar(32) NULL default NULL' );
<a name="l2687"><span class="linenum">2687</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2688"><span class="linenum">2688</span></a>  
<a name="l2689"><span class="linenum">2689</span></a>  <span class="comment">        // Create T_slug table and, Insert all slugs from T_items</span>
<a name="l2690"><span class="linenum">2690</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create Slugs table... ' );
<a name="l2691"><span class="linenum">2691</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE IF NOT EXISTS T_slug (
<a name="l2692"><span class="linenum">2692</span></a>                          slug_ID int(10) unsigned NOT NULL auto_increment,
<a name="l2693"><span class="linenum">2693</span></a>                          slug_title varchar(255) NOT NULL COLLATE ascii_bin,
<a name="l2694"><span class="linenum">2694</span></a>                          slug_type char(6) NOT NULL DEFAULT &quot;item&quot;,
<a name="l2695"><span class="linenum">2695</span></a>                          slug_itm_ID int(11) unsigned,
<a name="l2696"><span class="linenum">2696</span></a>                          PRIMARY KEY slug_ID (slug_ID),
<a name="l2697"><span class="linenum">2697</span></a>                          UNIQUE    slug_title (slug_title)
<a name="l2698"><span class="linenum">2698</span></a>                      ) ENGINE = innodb' );
<a name="l2699"><span class="linenum">2699</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2700"><span class="linenum">2700</span></a>  
<a name="l2701"><span class="linenum">2701</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Making sure all posts have a slug...' );
<a name="l2702"><span class="linenum">2702</span></a>  <span class="comment">        // Get posts with empty urltitle:</span>
<a name="l2703"><span class="linenum">2703</span></a>          <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT post_ID, post_title
<a name="l2704"><span class="linenum">2704</span></a>                        FROM T_items__item
<a name="l2705"><span class="linenum">2705</span></a>                       WHERE post_urltitle IS NULL OR post_urltitle = &quot;&quot;';
<a name="l2706"><span class="linenum">2706</span></a>          <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="constant" onClick="logConstant('OBJECT')" href="../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 'Get posts with empty urltitle' );
<a name="l2707"><span class="linenum">2707</span></a>  <span class="comment">        // Create URL titles when non existent:</span>
<a name="l2708"><span class="linenum">2708</span></a>          foreach( <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l2709"><span class="linenum">2709</span></a>          {
<a name="l2710"><span class="linenum">2710</span></a>  <span class="comment">            // TODO: dh&gt; pass locale (useful for transliteration).</span>
<a name="l2711"><span class="linenum">2711</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item
<a name="l2712"><span class="linenum">2712</span></a>                                SET post_urltitle = &quot;'.<a class="function" onClick="logFunction('urltitle_validate')" href="../../_functions/urltitle_validate.html" onMouseOver="funcPopup(event,'urltitle_validate')">urltitle_validate</a>( '', <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('post_title')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/post_title.html">post_title</a>, 0 ).'&quot;
<a name="l2713"><span class="linenum">2713</span></a>                          WHERE post_ID = '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('post_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/post_ID.html">post_ID</a>, 'Set posts urltitle' );
<a name="l2714"><span class="linenum">2714</span></a>          }
<a name="l2715"><span class="linenum">2715</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2716"><span class="linenum">2716</span></a>  
<a name="l2717"><span class="linenum">2717</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Populating Slugs table... ' );
<a name="l2718"><span class="linenum">2718</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_slug( slug_title, slug_type, slug_itm_ID)
<a name="l2719"><span class="linenum">2719</span></a>                        SELECT post_urltitle, &quot;item&quot;, post_ID
<a name="l2720"><span class="linenum">2720</span></a>                                    FROM T_items__item' );
<a name="l2721"><span class="linenum">2721</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2722"><span class="linenum">2722</span></a>  
<a name="l2723"><span class="linenum">2723</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Add canonical and tiny slug IDs to post table...' );
<a name="l2724"><span class="linenum">2724</span></a>  <span class="comment">        // modify post_urltitle column -&gt; Not allow NULL value</span>
<a name="l2725"><span class="linenum">2725</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_urltitle', 'VARCHAR(210) NOT NULL' );
<a name="l2726"><span class="linenum">2726</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_canonical_slug_ID', 'int(10) unsigned NULL default NULL after post_urltitle' );
<a name="l2727"><span class="linenum">2727</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_tiny_slug_ID', 'int(10) unsigned NULL default NULL after post_canonical_slug_ID' );
<a name="l2728"><span class="linenum">2728</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2729"><span class="linenum">2729</span></a>  
<a name="l2730"><span class="linenum">2730</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading posts...' );
<a name="l2731"><span class="linenum">2731</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item, T_slug
<a name="l2732"><span class="linenum">2732</span></a>                            SET post_canonical_slug_ID = slug_ID
<a name="l2733"><span class="linenum">2733</span></a>                          WHERE <a class="function" onClick="logFunction('CONVERT')" href="../../_functions/convert.html" onMouseOver="funcPopup(event,'convert')">CONVERT</a>( post_urltitle USING ASCII ) COLLATE ascii_bin = slug_title' );
<a name="l2734"><span class="linenum">2734</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2735"><span class="linenum">2735</span></a>  
<a name="l2736"><span class="linenum">2736</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding &quot;help&quot; slug...' );
<a name="l2737"><span class="linenum">2737</span></a>          if( <a class="function" onClick="logFunction('db_key_exists')" href="../../_functions/db_key_exists.html" onMouseOver="funcPopup(event,'db_key_exists')">db_key_exists</a>( 'T_slug', 'slug_title', '&quot;help&quot;' ) )
<a name="l2738"><span class="linenum">2738</span></a>          {
<a name="l2739"><span class="linenum">2739</span></a>              echo '&lt;strong&gt;Warning: &quot;help&quot; slug already exists!&lt;/strong&gt;&lt;br /&gt; ';
<a name="l2740"><span class="linenum">2740</span></a>          }
<a name="l2741"><span class="linenum">2741</span></a>          else
<a name="l2742"><span class="linenum">2742</span></a>          {
<a name="l2743"><span class="linenum">2743</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_slug( slug_title, slug_type )
<a name="l2744"><span class="linenum">2744</span></a>                           VALUES( &quot;help&quot;, &quot;help&quot; )', 'Add &quot;help&quot; slug' );
<a name="l2745"><span class="linenum">2745</span></a>              <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2746"><span class="linenum">2746</span></a>          }
<a name="l2747"><span class="linenum">2747</span></a>  
<a name="l2748"><span class="linenum">2748</span></a>  <span class="comment">        // fp&gt; Next time we should use pluggable permissions instead.</span>
<a name="l2749"><span class="linenum">2749</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updgrading groups: Giving Administrators Group edit perms on slugs...' );
<a name="l2750"><span class="linenum">2750</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_groups', 'grp_perm_slugs', &quot;enum('none','view','edit') NOT NULL default 'none'&quot; );
<a name="l2751"><span class="linenum">2751</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_groups
<a name="l2752"><span class="linenum">2752</span></a>                       SET grp_perm_slugs = &quot;edit&quot;
<a name="l2753"><span class="linenum">2753</span></a>                       WHERE grp_ID = 1' );
<a name="l2754"><span class="linenum">2754</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2755"><span class="linenum">2755</span></a>  
<a name="l2756"><span class="linenum">2756</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading settings table... ');
<a name="l2757"><span class="linenum">2757</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_settings
<a name="l2758"><span class="linenum">2758</span></a>                          SET set_value = 1
<a name="l2759"><span class="linenum">2759</span></a>                        WHERE set_name = &quot;fm_enable_roots_user&quot;
<a name="l2760"><span class="linenum">2760</span></a>                              AND set_value = 0' );
<a name="l2761"><span class="linenum">2761</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2762"><span class="linenum">2762</span></a>  
<a name="l2763"><span class="linenum">2763</span></a>  <span class="comment">        // New perms for comment moderation depending on status:</span>
<a name="l2764"><span class="linenum">2764</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Blog-User permissions...' );
<a name="l2765"><span class="linenum">2765</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_perm_draft_cmts', 'tinyint NOT NULL default 0 AFTER bloguser_perm_comments' );
<a name="l2766"><span class="linenum">2766</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_perm_publ_cmts', 'tinyint NOT NULL default 0 AFTER bloguser_perm_comments' );
<a name="l2767"><span class="linenum">2767</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_perm_depr_cmts', 'tinyint NOT NULL default 0 AFTER bloguser_perm_comments' );
<a name="l2768"><span class="linenum">2768</span></a>  
<a name="l2769"><span class="linenum">2769</span></a>          if( <a class="function" onClick="logFunction('db_col_exists')" href="../../_functions/db_col_exists.html" onMouseOver="funcPopup(event,'db_col_exists')">db_col_exists</a>( 'T_coll_user_perms', 'bloguser_perm_comments' ) )
<a name="l2770"><span class="linenum">2770</span></a>          { // if user had perm_comments he now gets all 3 new perms also:
<a name="l2771"><span class="linenum">2771</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_user_perms
<a name="l2772"><span class="linenum">2772</span></a>                          SET bloguser_perm_draft_cmts = bloguser_perm_comments,
<a name="l2773"><span class="linenum">2773</span></a>                              bloguser_perm_publ_cmts = bloguser_perm_comments,
<a name="l2774"><span class="linenum">2774</span></a>                              bloguser_perm_depr_cmts = bloguser_perm_comments');
<a name="l2775"><span class="linenum">2775</span></a>              <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_user_perms', 'bloguser_perm_comments' );
<a name="l2776"><span class="linenum">2776</span></a>          }
<a name="l2777"><span class="linenum">2777</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2778"><span class="linenum">2778</span></a>  
<a name="l2779"><span class="linenum">2779</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Blog-Group permissions...' );
<a name="l2780"><span class="linenum">2780</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_perm_draft_cmts', 'tinyint NOT NULL default 0 AFTER bloggroup_perm_comments' );
<a name="l2781"><span class="linenum">2781</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_perm_publ_cmts', 'tinyint NOT NULL default 0 AFTER bloggroup_perm_comments' );
<a name="l2782"><span class="linenum">2782</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_perm_depr_cmts', 'tinyint NOT NULL default 0 AFTER bloggroup_perm_comments' );
<a name="l2783"><span class="linenum">2783</span></a>  
<a name="l2784"><span class="linenum">2784</span></a>          if( <a class="function" onClick="logFunction('db_col_exists')" href="../../_functions/db_col_exists.html" onMouseOver="funcPopup(event,'db_col_exists')">db_col_exists</a>( 'T_coll_group_perms', 'bloggroup_perm_comments' ) )
<a name="l2785"><span class="linenum">2785</span></a>          { // if group had perm_comments he now gets all 3 new perms also:
<a name="l2786"><span class="linenum">2786</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l2787"><span class="linenum">2787</span></a>                          SET bloggroup_perm_draft_cmts = bloggroup_perm_comments,
<a name="l2788"><span class="linenum">2788</span></a>                              bloggroup_perm_publ_cmts = bloggroup_perm_comments,
<a name="l2789"><span class="linenum">2789</span></a>                              bloggroup_perm_depr_cmts = bloggroup_perm_comments');
<a name="l2790"><span class="linenum">2790</span></a>              <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_group_perms', 'bloggroup_perm_comments' );
<a name="l2791"><span class="linenum">2791</span></a>          }
<a name="l2792"><span class="linenum">2792</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2793"><span class="linenum">2793</span></a>  
<a name="l2794"><span class="linenum">2794</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading messaging permissions...' );
<a name="l2795"><span class="linenum">2795</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users ALTER COLUMN user_allow_msgform SET DEFAULT &quot;2&quot;' );
<a name="l2796"><span class="linenum">2796</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users
<a name="l2797"><span class="linenum">2797</span></a>                      SET user_allow_msgform = 3
<a name="l2798"><span class="linenum">2798</span></a>                      WHERE user_allow_msgform = 1');
<a name="l2799"><span class="linenum">2799</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2800"><span class="linenum">2800</span></a>  
<a name="l2801"><span class="linenum">2801</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading currency table...' );
<a name="l2802"><span class="linenum">2802</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'currency ADD COLUMN curr_enabled tinyint(1) NOT NULL DEFAULT 1 AFTER curr_name' );
<a name="l2803"><span class="linenum">2803</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2804"><span class="linenum">2804</span></a>  
<a name="l2805"><span class="linenum">2805</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading default blog access type for new blogs...' );
<a name="l2806"><span class="linenum">2806</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_blogs ALTER COLUMN blog_access_type SET DEFAULT &quot;extrapath&quot;' );
<a name="l2807"><span class="linenum">2807</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2808"><span class="linenum">2808</span></a>  
<a name="l2809"><span class="linenum">2809</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading tags table...' );
<a name="l2810"><span class="linenum">2810</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_items__tag CHANGE COLUMN tag_name tag_name varbinary(50) not null' );
<a name="l2811"><span class="linenum">2811</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2812"><span class="linenum">2812</span></a>  
<a name="l2813"><span class="linenum">2813</span></a>  <span class="comment">        // fp&gt; I don't understand why we need to carry this out &quot;again&quot; but I observed the installer barking on</span>
<a name="l2814"><span class="linenum">2814</span></a>  <span class="comment">        // this setting missing when upgrading from older 2.x versions. I figured it would be no big deal to do it twice...</span>
<a name="l2815"><span class="linenum">2815</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Makin sure usersettings table is InnoDB...' );
<a name="l2816"><span class="linenum">2816</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users__usersettings ENGINE=innodb' );
<a name="l2817"><span class="linenum">2817</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2818"><span class="linenum">2818</span></a>  
<a name="l2819"><span class="linenum">2819</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10000' );
<a name="l2820"><span class="linenum">2820</span></a>      }
<a name="l2821"><span class="linenum">2821</span></a>  
<a name="l2822"><span class="linenum">2822</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10100 )
<a name="l2823"><span class="linenum">2823</span></a>      {    // 4.1
<a name="l2824"><span class="linenum">2824</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Convert group permissions to pluggable permissions...' );
<a name="l2825"><span class="linenum">2825</span></a>  <span class="comment">        // asimo&gt;This delete query needs just in case if this version of b2evo was used, before upgrade process call</span>
<a name="l2826"><span class="linenum">2826</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_groups__groupsettings
<a name="l2827"><span class="linenum">2827</span></a>                          WHERE gset_name = &quot;perm_files&quot; OR gset_name = &quot;perm_options&quot; OR gset_name = &quot;perm_templates&quot;' );
<a name="l2828"><span class="linenum">2828</span></a>  <span class="comment">        // Get current permission values from groups table</span>
<a name="l2829"><span class="linenum">2829</span></a>          <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT grp_ID, grp_perm_spamblacklist, grp_perm_slugs, grp_perm_files, grp_perm_options, grp_perm_templates
<a name="l2830"><span class="linenum">2830</span></a>                        FROM T_groups';
<a name="l2831"><span class="linenum">2831</span></a>          <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="constant" onClick="logConstant('OBJECT')" href="../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 'Get groups converted permissions' );
<a name="l2832"><span class="linenum">2832</span></a>  <span class="comment">        // Insert values into groupsettings table</span>
<a name="l2833"><span class="linenum">2833</span></a>          foreach( <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l2834"><span class="linenum">2834</span></a>          {    // &quot;IGNORE&quot; is needed if we already created T_groups__groupsettings during upgrade to v0.8.9 at checkpoint 8050
<a name="l2835"><span class="linenum">2835</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT IGNORE INTO T_groups__groupsettings( gset_grp_ID, gset_name, gset_value )
<a name="l2836"><span class="linenum">2836</span></a>                              VALUES( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_ID.html">grp_ID</a>.', &quot;perm_spamblacklist&quot;, &quot;'.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_perm_spamblacklist')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_perm_spamblacklist.html">grp_perm_spamblacklist</a>.'&quot; ),
<a name="l2837"><span class="linenum">2837</span></a>                                  ( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_ID.html">grp_ID</a>.', &quot;perm_slugs&quot;, &quot;'.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_perm_slugs')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_perm_slugs.html">grp_perm_slugs</a>.'&quot; ),
<a name="l2838"><span class="linenum">2838</span></a>                                  ( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_ID.html">grp_ID</a>.', &quot;perm_files&quot;, &quot;'.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_perm_files')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_perm_files.html">grp_perm_files</a>.'&quot; ),
<a name="l2839"><span class="linenum">2839</span></a>                                  ( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_ID.html">grp_ID</a>.', &quot;perm_options&quot;, &quot;'.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_perm_options')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_perm_options.html">grp_perm_options</a>.'&quot; ),
<a name="l2840"><span class="linenum">2840</span></a>                                  ( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_ID.html">grp_ID</a>.', &quot;perm_templates&quot;, &quot;'.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_perm_templates')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_perm_templates.html">grp_perm_templates</a>.'&quot; )' );
<a name="l2841"><span class="linenum">2841</span></a>          }
<a name="l2842"><span class="linenum">2842</span></a>  
<a name="l2843"><span class="linenum">2843</span></a>  <span class="comment">        // Drop all converted permissin colums from groups table</span>
<a name="l2844"><span class="linenum">2844</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_groups', 'grp_perm_spamblacklist' );
<a name="l2845"><span class="linenum">2845</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_groups', 'grp_perm_slugs' );
<a name="l2846"><span class="linenum">2846</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_groups', 'grp_perm_files' );
<a name="l2847"><span class="linenum">2847</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_groups', 'grp_perm_options' );
<a name="l2848"><span class="linenum">2848</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_groups', 'grp_perm_templates' );
<a name="l2849"><span class="linenum">2849</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2850"><span class="linenum">2850</span></a>  
<a name="l2851"><span class="linenum">2851</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table, adding user gender...' );
<a name="l2852"><span class="linenum">2852</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_gender', 'char(1) NULL DEFAULT NULL AFTER user_showonline' );
<a name="l2853"><span class="linenum">2853</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2854"><span class="linenum">2854</span></a>  
<a name="l2855"><span class="linenum">2855</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading edit timpestamp blog-user permission...' );
<a name="l2856"><span class="linenum">2856</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_perm_edit_ts', 'tinyint NOT NULL default 0 AFTER bloguser_perm_delpost' );
<a name="l2857"><span class="linenum">2857</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_user_perms, T_users
<a name="l2858"><span class="linenum">2858</span></a>                              SET bloguser_perm_edit_ts = 1
<a name="l2859"><span class="linenum">2859</span></a>                              WHERE bloguser_user_ID = user_ID  AND user_level &gt; 4' );
<a name="l2860"><span class="linenum">2860</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2861"><span class="linenum">2861</span></a>  
<a name="l2862"><span class="linenum">2862</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading edit timpestamp blog-group permission...' );
<a name="l2863"><span class="linenum">2863</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_perm_edit_ts', 'tinyint NOT NULL default 0 AFTER bloggroup_perm_delpost' );
<a name="l2864"><span class="linenum">2864</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l2865"><span class="linenum">2865</span></a>                              SET bloggroup_perm_edit_ts = 1
<a name="l2866"><span class="linenum">2866</span></a>                              WHERE bloggroup_group_ID = 1' );
<a name="l2867"><span class="linenum">2867</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2868"><span class="linenum">2868</span></a>  
<a name="l2869"><span class="linenum">2869</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading comments table, add trash status...' );
<a name="l2870"><span class="linenum">2870</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_comments MODIFY COLUMN comment_status ENUM('published','deprecated','draft', 'trash') DEFAULT 'published' NOT NULL&quot;);
<a name="l2871"><span class="linenum">2871</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2872"><span class="linenum">2872</span></a>  
<a name="l2873"><span class="linenum">2873</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading groups admin access permission...' );
<a name="l2874"><span class="linenum">2874</span></a>          <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT grp_ID, grp_perm_admin
<a name="l2875"><span class="linenum">2875</span></a>                      FROM T_groups';
<a name="l2876"><span class="linenum">2876</span></a>          <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="constant" onClick="logConstant('OBJECT')" href="../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 'Get groups admin perms' );
<a name="l2877"><span class="linenum">2877</span></a>          foreach( <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l2878"><span class="linenum">2878</span></a>          {
<a name="l2879"><span class="linenum">2879</span></a>              switch( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_perm_admin')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_perm_admin.html">grp_perm_admin</a> )
<a name="l2880"><span class="linenum">2880</span></a>              {
<a name="l2881"><span class="linenum">2881</span></a>                  case 'visible':
<a name="l2882"><span class="linenum">2882</span></a>                      <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = 'normal';
<a name="l2883"><span class="linenum">2883</span></a>                      break;
<a name="l2884"><span class="linenum">2884</span></a>                  case 'hidden':
<a name="l2885"><span class="linenum">2885</span></a>                      <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = 'restricted';
<a name="l2886"><span class="linenum">2886</span></a>                      break;
<a name="l2887"><span class="linenum">2887</span></a>                  default:
<a name="l2888"><span class="linenum">2888</span></a>                      <a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a> = 'none';
<a name="l2889"><span class="linenum">2889</span></a>              }
<a name="l2890"><span class="linenum">2890</span></a>  <span class="comment">            // &quot;IGNORE&quot; is needed if we already created T_groups__groupsettings during upgrade to v0.8.9 at checkpoint 8050</span>
<a name="l2891"><span class="linenum">2891</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT IGNORE INTO T_groups__groupsettings( gset_grp_ID, gset_name, gset_value )
<a name="l2892"><span class="linenum">2892</span></a>                              VALUES( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/grp_ID.html">grp_ID</a>.', &quot;perm_admin&quot;, &quot;'.<a class="var it161" onMouseOver="hilite(161)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../_variables/value.html">$value</a>.'&quot; )' );
<a name="l2893"><span class="linenum">2893</span></a>          }
<a name="l2894"><span class="linenum">2894</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_groups', 'grp_perm_admin' );
<a name="l2895"><span class="linenum">2895</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2896"><span class="linenum">2896</span></a>  
<a name="l2897"><span class="linenum">2897</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table, add users source...' );
<a name="l2898"><span class="linenum">2898</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_source', 'varchar(30) NULL' );
<a name="l2899"><span class="linenum">2899</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2900"><span class="linenum">2900</span></a>  
<a name="l2901"><span class="linenum">2901</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blogs table: more granularity for comment allowing...' );
<a name="l2902"><span class="linenum">2902</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l2903"><span class="linenum">2903</span></a>                          SELECT blog_ID, &quot;allow_comments&quot;, &quot;never&quot;
<a name="l2904"><span class="linenum">2904</span></a>                              FROM T_blogs
<a name="l2905"><span class="linenum">2905</span></a>                              WHERE blog_allowcomments = &quot;never&quot;' );
<a name="l2906"><span class="linenum">2906</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_blogs', 'blog_allowcomments' );
<a name="l2907"><span class="linenum">2907</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2908"><span class="linenum">2908</span></a>  
<a name="l2909"><span class="linenum">2909</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blogs table: allow_rating fields...' );
<a name="l2910"><span class="linenum">2910</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_settings
<a name="l2911"><span class="linenum">2911</span></a>                          SET cset_value = &quot;any&quot;
<a name="l2912"><span class="linenum">2912</span></a>                          WHERE cset_value = &quot;always&quot; AND cset_name = &quot;allow_rating&quot;' );
<a name="l2913"><span class="linenum">2913</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2914"><span class="linenum">2914</span></a>  
<a name="l2915"><span class="linenum">2915</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading links table, add link_cmt_ID...' );
<a name="l2916"><span class="linenum">2916</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_links
<a name="l2917"><span class="linenum">2917</span></a>                          MODIFY COLUMN link_itm_ID int(11) unsigned NULL,
<a name="l2918"><span class="linenum">2918</span></a>                          MODIFY COLUMN link_creator_user_ID int(11) unsigned NULL,
<a name="l2919"><span class="linenum">2919</span></a>                          MODIFY COLUMN link_lastedit_user_ID int(11) unsigned NULL,
<a name="l2920"><span class="linenum">2920</span></a>                          ADD COLUMN link_cmt_ID int(11) unsigned NULL COMMENT &quot;Used for linking files to comments (comment attachments)&quot; AFTER link_itm_ID,
<a name="l2921"><span class="linenum">2921</span></a>                          ADD INDEX link_cmt_ID ( link_cmt_ID )' );
<a name="l2922"><span class="linenum">2922</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2923"><span class="linenum">2923</span></a>  
<a name="l2924"><span class="linenum">2924</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading filetypes table...' );
<a name="l2925"><span class="linenum">2925</span></a>  <span class="comment">        // get allowed filetype ids</span>
<a name="l2926"><span class="linenum">2926</span></a>          <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT ftyp_ID
<a name="l2927"><span class="linenum">2927</span></a>                      FROM T_filetypes
<a name="l2928"><span class="linenum">2928</span></a>                      WHERE ftyp_allowed != 0';
<a name="l2929"><span class="linenum">2929</span></a>          <a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('allowed_ids')" href="../../_variables/allowed_ids.html">$allowed_ids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, 0, 'Get allowed filetypes' ) );
<a name="l2930"><span class="linenum">2930</span></a>  
<a name="l2931"><span class="linenum">2931</span></a>  <span class="comment">        // update table column  -- this column is about who can edit the filetype: any user, registered users or only admins.</span>
<a name="l2932"><span class="linenum">2932</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_filetypes
<a name="l2933"><span class="linenum">2933</span></a>                          MODIFY COLUMN ftyp_allowed enum(&quot;any&quot;,&quot;registered&quot;,&quot;admin&quot;) NOT NULL default &quot;admin&quot;' );
<a name="l2934"><span class="linenum">2934</span></a>  
<a name="l2935"><span class="linenum">2935</span></a>  <span class="comment">        // update ftyp_allowed column content</span>
<a name="l2936"><span class="linenum">2936</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l2937"><span class="linenum">2937</span></a>                          SET ftyp_allowed = &quot;registered&quot;
<a name="l2938"><span class="linenum">2938</span></a>                          WHERE ftyp_ID IN ('.<a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('allowed_ids')" href="../../_variables/allowed_ids.html">$allowed_ids</a>.')' );
<a name="l2939"><span class="linenum">2939</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l2940"><span class="linenum">2940</span></a>                          SET ftyp_allowed = &quot;admin&quot;
<a name="l2941"><span class="linenum">2941</span></a>                          WHERE ftyp_ID NOT IN ('.<a class="var it6022" onMouseOver="hilite(6022)" onMouseOut="lolite()" onClick="logVariable('allowed_ids')" href="../../_variables/allowed_ids.html">$allowed_ids</a>.')' );
<a name="l2942"><span class="linenum">2942</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l2943"><span class="linenum">2943</span></a>                          SET ftyp_allowed = &quot;any&quot;
<a name="l2944"><span class="linenum">2944</span></a>                          WHERE ftyp_extensions = &quot;gif&quot; OR ftyp_extensions = &quot;png&quot; OR ftyp_extensions LIKE &quot;%jpg%&quot;' );
<a name="l2945"><span class="linenum">2945</span></a>  
<a name="l2946"><span class="linenum">2946</span></a>  <span class="comment">        // Add m4v file type if not exists</span>
<a name="l2947"><span class="linenum">2947</span></a>          if( !<a class="function" onClick="logFunction('db_key_exists')" href="../../_functions/db_key_exists.html" onMouseOver="funcPopup(event,'db_key_exists')">db_key_exists</a>( 'T_filetypes', 'ftyp_extensions', '&quot;m4v&quot;' ) )
<a name="l2948"><span class="linenum">2948</span></a>          {
<a name="l2949"><span class="linenum">2949</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_filetypes (ftyp_extensions, ftyp_name, ftyp_mimetype, ftyp_icon, ftyp_viewtype, ftyp_allowed)
<a name="l2950"><span class="linenum">2950</span></a>                               VALUES (&quot;m4v&quot;, &quot;MPEG video file&quot;, &quot;video/x-m4v&quot;, &quot;&quot;, &quot;browser&quot;, &quot;registered&quot;)', 'Add &quot;m4v&quot; file type' );
<a name="l2951"><span class="linenum">2951</span></a>          }
<a name="l2952"><span class="linenum">2952</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2953"><span class="linenum">2953</span></a>  
<a name="l2954"><span class="linenum">2954</span></a>  <span class="comment">        // The AdSense plugin needs to store quite long strings of data...</span>
<a name="l2955"><span class="linenum">2955</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading collection settings table, change cset_value type...' );
<a name="l2956"><span class="linenum">2956</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_coll_settings
<a name="l2957"><span class="linenum">2957</span></a>                                   MODIFY COLUMN cset_name VARCHAR(50) NOT NULL,
<a name="l2958"><span class="linenum">2958</span></a>                                   MODIFY COLUMN cset_value VARCHAR(10000) NULL' );
<a name="l2959"><span class="linenum">2959</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2960"><span class="linenum">2960</span></a>  
<a name="l2961"><span class="linenum">2961</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10100' );
<a name="l2962"><span class="linenum">2962</span></a>      }
<a name="l2963"><span class="linenum">2963</span></a>  
<a name="l2964"><span class="linenum">2964</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10200 )
<a name="l2965"><span class="linenum">2965</span></a>      {    // 4.1b
<a name="l2966"><span class="linenum">2966</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for a specific blog post subscriptions...' );
<a name="l2967"><span class="linenum">2967</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_items__subscriptions (
<a name="l2968"><span class="linenum">2968</span></a>                          isub_item_ID  int(11) unsigned NOT NULL,
<a name="l2969"><span class="linenum">2969</span></a>                          isub_user_ID  int(11) unsigned NOT NULL,
<a name="l2970"><span class="linenum">2970</span></a>                          isub_comments tinyint(1) NOT NULL default 0 COMMENT 'The user wants to receive notifications for new comments on this post',
<a name="l2971"><span class="linenum">2971</span></a>                          PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (isub_item_ID, isub_user_ID )
<a name="l2972"><span class="linenum">2972</span></a>                      ) ENGINE = innodb&quot; );
<a name="l2973"><span class="linenum">2973</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2974"><span class="linenum">2974</span></a>  
<a name="l2975"><span class="linenum">2975</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading comments table, add subscription fields...' );
<a name="l2976"><span class="linenum">2976</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_comments', 'comment_notif_status', 'ENUM(&quot;noreq&quot;,&quot;todo&quot;,&quot;started&quot;,&quot;finished&quot;) NOT NULL DEFAULT &quot;noreq&quot; COMMENT &quot;Have notifications been sent for this comment? How far are we in the process?&quot; AFTER comment_secret' );
<a name="l2977"><span class="linenum">2977</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_comments', 'comment_notif_ctsk_ID', 'INT(10) unsigned NULL DEFAULT NULL COMMENT &quot;When notifications for this comment are sent through a scheduled job, what is the job ID?&quot; AFTER comment_notif_status' );
<a name="l2978"><span class="linenum">2978</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2979"><span class="linenum">2979</span></a>  
<a name="l2980"><span class="linenum">2980</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table...' );
<a name="l2981"><span class="linenum">2981</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_notify_moderation', 'tinyint(1) NOT NULL default 0 COMMENT &quot;Notify me by email whenever a comment is awaiting moderation on one of my blogs&quot; AFTER user_notify' );
<a name="l2982"><span class="linenum">2982</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_unsubscribe_key', 'varchar(32) NOT NULL default &quot;&quot; COMMENT &quot;A specific key, it is used when a user wants to unsubscribe from a post comments without signing in&quot; AFTER user_notify_moderation' );
<a name="l2983"><span class="linenum">2983</span></a>  <span class="comment">        // Set unsubscribe keys for existing users with no unsubscribe key</span>
<a name="l2984"><span class="linenum">2984</span></a>          <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT user_ID
<a name="l2985"><span class="linenum">2985</span></a>                              FROM T_users
<a name="l2986"><span class="linenum">2986</span></a>                           WHERE user_unsubscribe_key = &quot;&quot;';
<a name="l2987"><span class="linenum">2987</span></a>          <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="constant" onClick="logConstant('OBJECT')" href="../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 'Get users with no unsubscribe key' );
<a name="l2988"><span class="linenum">2988</span></a>          foreach( <a class="var it48" onMouseOver="hilite(48)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../_variables/rows.html">$rows</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l2989"><span class="linenum">2989</span></a>          {
<a name="l2990"><span class="linenum">2990</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users
<a name="l2991"><span class="linenum">2991</span></a>                              SET user_unsubscribe_key = &quot;'.<a class="function" onClick="logFunction('generate_random_key')" href="../../_functions/generate_random_key.html" onMouseOver="funcPopup(event,'generate_random_key')">generate_random_key</a>().'&quot;
<a name="l2992"><span class="linenum">2992</span></a>                              WHERE user_ID = '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('user_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/user_ID.html">user_ID</a> );
<a name="l2993"><span class="linenum">2993</span></a>          }
<a name="l2994"><span class="linenum">2994</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l2995"><span class="linenum">2995</span></a>  
<a name="l2996"><span class="linenum">2996</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading settings table... ');
<a name="l2997"><span class="linenum">2997</span></a>  <span class="comment">        // This query was removed later, to avoid performance issue because of the smart view counting</span>
<a name="l2998"><span class="linenum">2998</span></a>          <span class="comment">/*$DB-&gt;query( 'INSERT INTO T_settings (set_name, set_value)</span>
<a name="l2999"><span class="linenum">2999</span></a>  <span class="comment">                        VALUES ( &quot;smart_hit_count&quot;, 1 )' );*/</span>
<a name="l3000"><span class="linenum">3000</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_coll_settings
<a name="l3001"><span class="linenum">3001</span></a>                                      CHANGE COLUMN cset_value cset_value   VARCHAR( 10000 ) NULL COMMENT &quot;The AdSense plugin wants to store very long snippets of HTML&quot;' );
<a name="l3002"><span class="linenum">3002</span></a>            <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3003"><span class="linenum">3003</span></a>  
<a name="l3004"><span class="linenum">3004</span></a>  <span class="comment">          // The following two upgrade task were created subsequently to &quot;Make sure DB schema is up to date&quot;.</span>
<a name="l3005"><span class="linenum">3005</span></a>  <span class="comment">          // Note: These queries don't modify the correct databases</span>
<a name="l3006"><span class="linenum">3006</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table, no notification by default...');
<a name="l3007"><span class="linenum">3007</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users ALTER COLUMN user_notify SET DEFAULT 0' );
<a name="l3008"><span class="linenum">3008</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3009"><span class="linenum">3009</span></a>  
<a name="l3010"><span class="linenum">3010</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading items table...');
<a name="l3011"><span class="linenum">3011</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_items__item CHANGE COLUMN post_priority post_priority int(11) unsigned null COMMENT &quot;Task priority in workflow&quot;' );
<a name="l3012"><span class="linenum">3012</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3013"><span class="linenum">3013</span></a>  
<a name="l3014"><span class="linenum">3014</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10200' );
<a name="l3015"><span class="linenum">3015</span></a>      }
<a name="l3016"><span class="linenum">3016</span></a>  
<a name="l3017"><span class="linenum">3017</span></a>  
<a name="l3018"><span class="linenum">3018</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10300 )
<a name="l3019"><span class="linenum">3019</span></a>      {    // 4.2
<a name="l3020"><span class="linenum">3020</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading user fields...' );
<a name="l3021"><span class="linenum">3021</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users__fielddefs
<a name="l3022"><span class="linenum">3022</span></a>                                      ADD COLUMN ufdf_required enum(&quot;hidden&quot;,&quot;optional&quot;,&quot;recommended&quot;,&quot;require&quot;) NOT NULL default &quot;optional&quot;');
<a name="l3023"><span class="linenum">3023</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3024"><span class="linenum">3024</span></a>                                          SET ufdf_required = &quot;recommended&quot;
<a name="l3025"><span class="linenum">3025</span></a>                                      WHERE ufdf_name in (&quot;Website&quot;, &quot;Twitter&quot;, &quot;Facebook&quot;) ' );
<a name="l3026"><span class="linenum">3026</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;REPLACE INTO T_users__fielddefs (ufdf_ID, ufdf_type, ufdf_name, ufdf_required)
<a name="l3027"><span class="linenum">3027</span></a>                                       VALUES (400000, 'text', 'About me', 'recommended');&quot; );
<a name="l3028"><span class="linenum">3028</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3029"><span class="linenum">3029</span></a>  
<a name="l3030"><span class="linenum">3030</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Moving data to user fields...' );
<a name="l3031"><span class="linenum">3031</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__fields( uf_user_ID, uf_ufdf_ID, uf_varchar )
<a name="l3032"><span class="linenum">3032</span></a>                                   SELECT user_ID, 10300, user_icq
<a name="l3033"><span class="linenum">3033</span></a>                                       FROM T_users
<a name="l3034"><span class="linenum">3034</span></a>                                    WHERE user_icq IS NOT NULL AND <a class="phpfunction" onClick="logFunction('TRIM')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">TRIM</a>(user_icq) &lt;&gt; &quot;&quot;' );
<a name="l3035"><span class="linenum">3035</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__fields( uf_user_ID, uf_ufdf_ID, uf_varchar )
<a name="l3036"><span class="linenum">3036</span></a>                                   SELECT user_ID, 10200, user_aim
<a name="l3037"><span class="linenum">3037</span></a>                                       FROM T_users
<a name="l3038"><span class="linenum">3038</span></a>                                    WHERE user_aim IS NOT NULL AND <a class="phpfunction" onClick="logFunction('TRIM')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">TRIM</a>(user_aim) &lt;&gt; &quot;&quot;' );
<a name="l3039"><span class="linenum">3039</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__fields( uf_user_ID, uf_ufdf_ID, uf_varchar )
<a name="l3040"><span class="linenum">3040</span></a>                                   SELECT user_ID, 10000, user_msn
<a name="l3041"><span class="linenum">3041</span></a>                                       FROM T_users
<a name="l3042"><span class="linenum">3042</span></a>                                    WHERE user_msn IS NOT NULL AND <a class="phpfunction" onClick="logFunction('TRIM')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">TRIM</a>(user_msn) &lt;&gt; &quot;&quot;' );
<a name="l3043"><span class="linenum">3043</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__fields( uf_user_ID, uf_ufdf_ID, uf_varchar )
<a name="l3044"><span class="linenum">3044</span></a>                                   SELECT user_ID, 10100, user_yim
<a name="l3045"><span class="linenum">3045</span></a>                                       FROM T_users
<a name="l3046"><span class="linenum">3046</span></a>                                    WHERE user_yim IS NOT NULL AND <a class="phpfunction" onClick="logFunction('TRIM')" href="../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">TRIM</a>(user_yim) &lt;&gt; &quot;&quot;' );
<a name="l3047"><span class="linenum">3047</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3048"><span class="linenum">3048</span></a>  
<a name="l3049"><span class="linenum">3049</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Dropping obsolete user columns...' );
<a name="l3050"><span class="linenum">3050</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users
<a name="l3051"><span class="linenum">3051</span></a>                                      DROP COLUMN user_icq,
<a name="l3052"><span class="linenum">3052</span></a>                                      DROP COLUMN user_aim,
<a name="l3053"><span class="linenum">3053</span></a>                                      DROP COLUMN user_msn,
<a name="l3054"><span class="linenum">3054</span></a>                                      DROP COLUMN user_yim' );
<a name="l3055"><span class="linenum">3055</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3056"><span class="linenum">3056</span></a>  
<a name="l3057"><span class="linenum">3057</span></a>  <span class="comment">        // ---</span>
<a name="l3058"><span class="linenum">3058</span></a>  
<a name="l3059"><span class="linenum">3059</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding <span class="keyword">new </span><a class="class" onClick="logClass('user')" href="../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a> columns...' );
<a name="l3060"><span class="linenum">3060</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users
<a name="l3061"><span class="linenum">3061</span></a>                                      ADD COLUMN user_postcode varchar(12) NULL AFTER user_ID,
<a name="l3062"><span class="linenum">3062</span></a>                                      ADD COLUMN user_age_min int unsigned NULL AFTER user_postcode,
<a name="l3063"><span class="linenum">3063</span></a>                                      ADD COLUMN user_age_max int unsigned NULL AFTER user_age_min' );
<a name="l3064"><span class="linenum">3064</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3065"><span class="linenum">3065</span></a>  
<a name="l3066"><span class="linenum">3066</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading item table for hide teaser...' );
<a name="l3067"><span class="linenum">3067</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_items__item
<a name="l3068"><span class="linenum">3068</span></a>                          ADD COLUMN post_hideteaser tinyint(1) NOT NULL DEFAULT 0 AFTER post_featured');
<a name="l3069"><span class="linenum">3069</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item
<a name="l3070"><span class="linenum">3070</span></a>                                          SET post_hideteaser = 1
<a name="l3071"><span class="linenum">3071</span></a>                                      WHERE post_content LIKE &quot;%&lt;!--noteaser--&gt;%&quot;' );
<a name="l3072"><span class="linenum">3072</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3073"><span class="linenum">3073</span></a>  
<a name="l3074"><span class="linenum">3074</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for a specific post settings...' );
<a name="l3075"><span class="linenum">3075</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_items__item_settings (
<a name="l3076"><span class="linenum">3076</span></a>                          iset_item_ID  int(10) unsigned NOT NULL,
<a name="l3077"><span class="linenum">3077</span></a>                          iset_name     varchar( 50 ) NOT NULL,
<a name="l3078"><span class="linenum">3078</span></a>                          iset_value    varchar( 2000 ) NULL,
<a name="l3079"><span class="linenum">3079</span></a>                          PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( iset_item_ID, iset_name )
<a name="l3080"><span class="linenum">3080</span></a>                      ) ENGINE = innodb&quot; );
<a name="l3081"><span class="linenum">3081</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3082"><span class="linenum">3082</span></a>  
<a name="l3083"><span class="linenum">3083</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding new column to comments...' );
<a name="l3084"><span class="linenum">3084</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l3085"><span class="linenum">3085</span></a>                                      ADD COLUMN comment_in_reply_to_cmt_ID INT(10) unsigned NULL AFTER comment_status' );
<a name="l3086"><span class="linenum">3086</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3087"><span class="linenum">3087</span></a>  
<a name="l3088"><span class="linenum">3088</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for internal searches...' );
<a name="l3089"><span class="linenum">3089</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_logs__internal_searches (
<a name="l3090"><span class="linenum">3090</span></a>                          isrch_ID bigint(20) NOT NULL auto_increment,
<a name="l3091"><span class="linenum">3091</span></a>                          isrch_coll_ID bigint(20) NOT NULL,
<a name="l3092"><span class="linenum">3092</span></a>                          isrch_hit_ID bigint(20) NOT NULL,
<a name="l3093"><span class="linenum">3093</span></a>                          isrch_keywords varchar(255) NOT NULL,
<a name="l3094"><span class="linenum">3094</span></a>                          PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (isrch_ID)
<a name="l3095"><span class="linenum">3095</span></a>                      ) ENGINE = MyISAM' );
<a name="l3096"><span class="linenum">3096</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3097"><span class="linenum">3097</span></a>  
<a name="l3098"><span class="linenum">3098</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for comments votes...' );
<a name="l3099"><span class="linenum">3099</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_comments__votes (
<a name="l3100"><span class="linenum">3100</span></a>                          cmvt_cmt_ID  int(10) unsigned NOT NULL,
<a name="l3101"><span class="linenum">3101</span></a>                          cmvt_user_ID int(10) unsigned NOT NULL,
<a name="l3102"><span class="linenum">3102</span></a>                          cmvt_helpful TINYINT(1) NULL DEFAULT NULL,
<a name="l3103"><span class="linenum">3103</span></a>                          cmvt_spam    TINYINT(1) NULL DEFAULT NULL,
<a name="l3104"><span class="linenum">3104</span></a>                          PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (cmvt_cmt_ID, cmvt_user_ID),
<a name="l3105"><span class="linenum">3105</span></a>                          KEY cmvt_cmt_ID (cmvt_cmt_ID),
<a name="l3106"><span class="linenum">3106</span></a>                          KEY cmvt_user_ID (cmvt_user_ID)
<a name="l3107"><span class="linenum">3107</span></a>                      ) ENGINE = innodb' );
<a name="l3108"><span class="linenum">3108</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3109"><span class="linenum">3109</span></a>  
<a name="l3110"><span class="linenum">3110</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding new comments columns...' );
<a name="l3111"><span class="linenum">3111</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l3112"><span class="linenum">3112</span></a>                                      ADD comment_helpful_addvotes INT NOT NULL DEFAULT 0 AFTER comment_nofollow ,
<a name="l3113"><span class="linenum">3113</span></a>                                      ADD comment_helpful_countvotes INT UNSIGNED NOT NULL DEFAULT 0 AFTER comment_helpful_addvotes ,
<a name="l3114"><span class="linenum">3114</span></a>                                      ADD comment_spam_addvotes INT NOT NULL DEFAULT 0 AFTER comment_helpful_countvotes ,
<a name="l3115"><span class="linenum">3115</span></a>                                      ADD comment_spam_countvotes INT UNSIGNED NOT NULL DEFAULT 0 AFTER comment_spam_addvotes ,
<a name="l3116"><span class="linenum">3116</span></a>                                      CHANGE COLUMN comment_notif_ctsk_ID comment_notif_ctsk_ID      INT(10) unsigned NULL DEFAULT NULL COMMENT &quot;When notifications for this comment are sent through a scheduled job, what is the job ID?&quot;');
<a name="l3117"><span class="linenum">3117</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3118"><span class="linenum">3118</span></a>  
<a name="l3119"><span class="linenum">3119</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding <span class="keyword">new </span><a class="class" onClick="logClass('user')" href="../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a> permission for spam voting...' );
<a name="l3120"><span class="linenum">3120</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_coll_user_perms
<a name="l3121"><span class="linenum">3121</span></a>                                      ADD bloguser_perm_vote_spam_cmts tinyint NOT NULL default 0 AFTER bloguser_perm_edit_ts' );
<a name="l3122"><span class="linenum">3122</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3123"><span class="linenum">3123</span></a>  
<a name="l3124"><span class="linenum">3124</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a> permission for spam voting...' );
<a name="l3125"><span class="linenum">3125</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_coll_group_perms
<a name="l3126"><span class="linenum">3126</span></a>                                      ADD bloggroup_perm_vote_spam_cmts tinyint NOT NULL default 0 AFTER bloggroup_perm_edit_ts' );
<a name="l3127"><span class="linenum">3127</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3128"><span class="linenum">3128</span></a>  
<a name="l3129"><span class="linenum">3129</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading countries table...' );
<a name="l3130"><span class="linenum">3130</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'country ADD COLUMN ctry_preferred tinyint(1) NOT NULL DEFAULT 0 AFTER ctry_enabled' );
<a name="l3131"><span class="linenum">3131</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3132"><span class="linenum">3132</span></a>  
<a name="l3133"><span class="linenum">3133</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_items__subscriptions CHANGE COLUMN isub_comments isub_comments   tinyint(1) NOT NULL DEFAULT 0 COMMENT &quot;The user wants to receive notifications for new comments on this post&quot;' );
<a name="l3134"><span class="linenum">3134</span></a>  
<a name="l3135"><span class="linenum">3135</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10300' );
<a name="l3136"><span class="linenum">3136</span></a>      }
<a name="l3137"><span class="linenum">3137</span></a>  
<a name="l3138"><span class="linenum">3138</span></a>  
<a name="l3139"><span class="linenum">3139</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10400 )
<a name="l3140"><span class="linenum">3140</span></a>      {    // 4.2 part 2
<a name="l3141"><span class="linenum">3141</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating &quot;Post by Email&quot; settings...' );
<a name="l3142"><span class="linenum">3142</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_settings SET set_name = &quot;eblog_autobr&quot; WHERE set_name = &quot;AutoBR&quot;' );
<a name="l3143"><span class="linenum">3143</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3144"><span class="linenum">3144</span></a>  
<a name="l3145"><span class="linenum">3145</span></a>          if( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>('SELECT set_value FROM T_settings WHERE set_name = &quot;eblog_enabled&quot;') )
<a name="l3146"><span class="linenum">3146</span></a>          {    // eblog enabled, let's create a scheduled job for it
<a name="l3147"><span class="linenum">3147</span></a>              <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating &quot;Post by Email&quot; scheduled job...' );
<a name="l3148"><span class="linenum">3148</span></a>              <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('start_date')" href="../../_variables/start_date.html">$start_date</a> = <a class="function" onClick="logFunction('form_date')" href="../../_functions/form_date.html" onMouseOver="funcPopup(event,'form_date')">form_date</a>( <a class="function" onClick="logFunction('date2mysql')" href="../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>(<a class="var it542" onMouseOver="hilite(542)" onMouseOut="lolite()" onClick="logVariable('GLOBALS')" href="../../_variables/GLOBALS.html">$GLOBALS</a>['localtimenow'] + 86400), '05:00:00' ); <span class="comment">// start tomorrow</span>
<a name="l3149"><span class="linenum">3149</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l3150"><span class="linenum">3150</span></a>                  INSERT INTO T_cron__task ( ctsk_start_datetime, ctsk_repeat_after, ctsk_name, ctsk_controller, ctsk_params )
<a name="l3151"><span class="linenum">3151</span></a>                  VALUES ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('start_date')" href="../../_variables/start_date.html">$start_date</a> ).', 86400, '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Create posts by email') ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'cron/jobs/_post_by_email.job.php' ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'N;' ).' )' );
<a name="l3152"><span class="linenum">3152</span></a>              <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3153"><span class="linenum">3153</span></a>          }
<a name="l3154"><span class="linenum">3154</span></a>  
<a name="l3155"><span class="linenum">3155</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading hitlog table...' );
<a name="l3156"><span class="linenum">3156</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_hitlog
<a name="l3157"><span class="linenum">3157</span></a>                                  ADD COLUMN hit_disp        VARCHAR(30) DEFAULT NULL AFTER hit_uri,
<a name="l3158"><span class="linenum">3158</span></a>                                  ADD COLUMN hit_ctrl        VARCHAR(30) DEFAULT NULL AFTER hit_disp,
<a name="l3159"><span class="linenum">3159</span></a>                                  ADD COLUMN hit_response_code     INT DEFAULT NULL AFTER hit_agent_type ' );
<a name="l3160"><span class="linenum">3160</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3161"><span class="linenum">3161</span></a>  
<a name="l3162"><span class="linenum">3162</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading file types...' );
<a name="l3163"><span class="linenum">3163</span></a>  <span class="comment">        // Update ftyp_icon column</span>
<a name="l3164"><span class="linenum">3164</span></a>  <span class="comment">        // Previous versions used a image file name for this field,</span>
<a name="l3165"><span class="linenum">3165</span></a>  <span class="comment">        // but from now we should use a icon name from the file /conf/_icons.php</span>
<a name="l3166"><span class="linenum">3166</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3167"><span class="linenum">3167</span></a>                          SET ftyp_icon = &quot;file_image&quot;
<a name="l3168"><span class="linenum">3168</span></a>                          WHERE ftyp_extensions IN ( &quot;gif&quot;, &quot;png&quot;, &quot;jpg jpeg&quot; )' );
<a name="l3169"><span class="linenum">3169</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3170"><span class="linenum">3170</span></a>                          SET ftyp_icon = &quot;file_document&quot;
<a name="l3171"><span class="linenum">3171</span></a>                          WHERE ftyp_extensions = &quot;txt&quot;' );
<a name="l3172"><span class="linenum">3172</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3173"><span class="linenum">3173</span></a>                          SET ftyp_icon = &quot;file_www&quot;
<a name="l3174"><span class="linenum">3174</span></a>                          WHERE ftyp_extensions = &quot;htm html&quot;' );
<a name="l3175"><span class="linenum">3175</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3176"><span class="linenum">3176</span></a>                          SET ftyp_icon = &quot;file_pdf&quot;
<a name="l3177"><span class="linenum">3177</span></a>                          WHERE ftyp_extensions = &quot;pdf&quot;' );
<a name="l3178"><span class="linenum">3178</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3179"><span class="linenum">3179</span></a>                          SET ftyp_icon = &quot;file_doc&quot;
<a name="l3180"><span class="linenum">3180</span></a>                          WHERE ftyp_extensions = &quot;doc&quot;' );
<a name="l3181"><span class="linenum">3181</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3182"><span class="linenum">3182</span></a>                          SET ftyp_icon = &quot;file_xls&quot;
<a name="l3183"><span class="linenum">3183</span></a>                          WHERE ftyp_extensions = &quot;xls&quot;' );
<a name="l3184"><span class="linenum">3184</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3185"><span class="linenum">3185</span></a>                          SET ftyp_icon = &quot;file_ppt&quot;
<a name="l3186"><span class="linenum">3186</span></a>                          WHERE ftyp_extensions = &quot;ppt&quot;' );
<a name="l3187"><span class="linenum">3187</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3188"><span class="linenum">3188</span></a>                          SET ftyp_icon = &quot;file_pps&quot;
<a name="l3189"><span class="linenum">3189</span></a>                          WHERE ftyp_extensions = &quot;pps&quot;' );
<a name="l3190"><span class="linenum">3190</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3191"><span class="linenum">3191</span></a>                          SET ftyp_icon = &quot;file_zip&quot;
<a name="l3192"><span class="linenum">3192</span></a>                          WHERE ftyp_extensions = &quot;zip&quot;' );
<a name="l3193"><span class="linenum">3193</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3194"><span class="linenum">3194</span></a>                          SET ftyp_icon = &quot;file_php&quot;
<a name="l3195"><span class="linenum">3195</span></a>                          WHERE ftyp_extensions = &quot;php php3 php4 php5 php6&quot;' );
<a name="l3196"><span class="linenum">3196</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3197"><span class="linenum">3197</span></a>                          SET ftyp_icon = &quot;&quot;
<a name="l3198"><span class="linenum">3198</span></a>                          WHERE ftyp_extensions = &quot;css&quot;' );
<a name="l3199"><span class="linenum">3199</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3200"><span class="linenum">3200</span></a>                          SET ftyp_icon = &quot;file_sound&quot;
<a name="l3201"><span class="linenum">3201</span></a>                          WHERE ftyp_extensions IN ( &quot;mp3&quot;, &quot;m4a&quot; )' );
<a name="l3202"><span class="linenum">3202</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes
<a name="l3203"><span class="linenum">3203</span></a>                          SET ftyp_icon = &quot;file_video&quot;
<a name="l3204"><span class="linenum">3204</span></a>                          WHERE ftyp_extensions IN ( &quot;mp4&quot;, &quot;mov&quot;, &quot;m4v&quot; )' );
<a name="l3205"><span class="linenum">3205</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3206"><span class="linenum">3206</span></a>  
<a name="l3207"><span class="linenum">3207</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10400' );
<a name="l3208"><span class="linenum">3208</span></a>      }
<a name="l3209"><span class="linenum">3209</span></a>  
<a name="l3210"><span class="linenum">3210</span></a>  
<a name="l3211"><span class="linenum">3211</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10500 )
<a name="l3212"><span class="linenum">3212</span></a>      {    //  part 3
<a name="l3213"><span class="linenum">3213</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading hitlog table...' );
<a name="l3214"><span class="linenum">3214</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_hitlog
<a name="l3215"><span class="linenum">3215</span></a>                                  CHANGE COLUMN hit_referer_type  hit_referer_type ENUM(  'search',  'special',  'spam',  'referer',  'direct',  'self',  'admin', 'blacklist' ) NOT NULL,
<a name="l3216"><span class="linenum">3216</span></a>                                  ADD COLUMN hit_type ENUM('standard','rss','admin','ajax', 'service') DEFAULT 'standard' NOT NULL AFTER hit_ctrl,
<a name="l3217"><span class="linenum">3217</span></a>                                  ADD COLUMN hit_action VARCHAR(30) DEFAULT NULL AFTER hit_ctrl&quot; );
<a name="l3218"><span class="linenum">3218</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_hitlog SET hit_referer_type = &quot;special&quot; WHERE hit_referer_type = &quot;blacklist&quot;' );
<a name="l3219"><span class="linenum">3219</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_hitlog SET hit_type = &quot;admin&quot;, hit_referer_type = &quot;direct&quot;  WHERE hit_referer_type = &quot;admin&quot;' );
<a name="l3220"><span class="linenum">3220</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_hitlog
<a name="l3221"><span class="linenum">3221</span></a>                                  CHANGE COLUMN hit_referer_type  hit_referer_type ENUM(  'search',  'special',  'spam',  'referer',  'direct',  'self' ) NOT NULL&quot;);
<a name="l3222"><span class="linenum">3222</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3223"><span class="linenum">3223</span></a>  
<a name="l3224"><span class="linenum">3224</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for Groups of user field definitions...' );
<a name="l3225"><span class="linenum">3225</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_users__fieldgroups (
<a name="l3226"><span class="linenum">3226</span></a>                  ufgp_ID int(10) unsigned NOT NULL auto_increment,
<a name="l3227"><span class="linenum">3227</span></a>                  ufgp_name varchar(255) NOT NULL,
<a name="l3228"><span class="linenum">3228</span></a>                  ufgp_order int(11) NOT NULL,
<a name="l3229"><span class="linenum">3229</span></a>                  PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (ufgp_ID)
<a name="l3230"><span class="linenum">3230</span></a>              ) ENGINE = innodb' );
<a name="l3231"><span class="linenum">3231</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__fieldgroups ( ufgp_name, ufgp_order )
<a name="l3232"><span class="linenum">3232</span></a>                  VALUES ( &quot;Instant Messaging&quot;, &quot;1&quot; ),
<a name="l3233"><span class="linenum">3233</span></a>                               ( &quot;Phone&quot;, &quot;2&quot; ),
<a name="l3234"><span class="linenum">3234</span></a>                               ( &quot;Web&quot;, &quot;3&quot; ),
<a name="l3235"><span class="linenum">3235</span></a>                               ( &quot;Organization&quot;, &quot;4&quot; ),
<a name="l3236"><span class="linenum">3236</span></a>                               ( &quot;Address&quot;, &quot;5&quot; ),
<a name="l3237"><span class="linenum">3237</span></a>                               ( &quot;Other&quot;, &quot;6&quot; ) ' );
<a name="l3238"><span class="linenum">3238</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3239"><span class="linenum">3239</span></a>  
<a name="l3240"><span class="linenum">3240</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading user field definitions...' );
<a name="l3241"><span class="linenum">3241</span></a>  <span class="comment">        // Add new fields:</span>
<a name="l3242"><span class="linenum">3242</span></a>  <span class="comment">        //         &quot;ufdf_options&quot; to save a values of the Option list</span>
<a name="l3243"><span class="linenum">3243</span></a>  <span class="comment">        //         &quot;ufdf_duplicated&quot; to add a several instances</span>
<a name="l3244"><span class="linenum">3244</span></a>  <span class="comment">        //         &quot;ufdf_ufgp_ID&quot; - Group ID</span>
<a name="l3245"><span class="linenum">3245</span></a>  <span class="comment">        //         &quot;ufdf_order&quot; - Order number</span>
<a name="l3246"><span class="linenum">3246</span></a>  <span class="comment">        //         &quot;ufdf_suggest&quot; - Suggest values</span>
<a name="l3247"><span class="linenum">3247</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users__fielddefs
<a name="l3248"><span class="linenum">3248</span></a>                          ADD ufdf_options    TEXT NOT NULL AFTER ufdf_name,
<a name="l3249"><span class="linenum">3249</span></a>                          ADD ufdf_duplicated enum(&quot;forbidden&quot;,&quot;allowed&quot;,&quot;list&quot;) NOT NULL default &quot;allowed&quot;,
<a name="l3250"><span class="linenum">3250</span></a>                          ADD ufdf_ufgp_ID    int(10) unsigned NOT NULL AFTER ufdf_ID,
<a name="l3251"><span class="linenum">3251</span></a>                          ADD ufdf_order      int(11) NOT NULL,
<a name="l3252"><span class="linenum">3252</span></a>                          ADD ufdf_suggest    tinyint(1) NOT NULL DEFAULT 0,
<a name="l3253"><span class="linenum">3253</span></a>                          CHANGE ufdf_ID ufdf_ID int(10) UNSIGNED NOT NULL AUTO_INCREMENT' );
<a name="l3254"><span class="linenum">3254</span></a>  <span class="comment">        // Set default values of the field &quot;ufdf_duplicated&quot;</span>
<a name="l3255"><span class="linenum">3255</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3256"><span class="linenum">3256</span></a>                          SET ufdf_duplicated = &quot;allowed&quot;
<a name="l3257"><span class="linenum">3257</span></a>                          WHERE ufdf_ID IN ( 10000, 10100, 10200, 10300, 50100, 50200, 100000, 100100 )' );
<a name="l3258"><span class="linenum">3258</span></a>  <span class="comment">        // Group fields by default</span>
<a name="l3259"><span class="linenum">3259</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3260"><span class="linenum">3260</span></a>                          SET ufdf_ufgp_ID = &quot;1&quot;
<a name="l3261"><span class="linenum">3261</span></a>                          WHERE ufdf_ID &lt;= 40000 ' );
<a name="l3262"><span class="linenum">3262</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3263"><span class="linenum">3263</span></a>                          SET ufdf_ufgp_ID = &quot;2&quot;
<a name="l3264"><span class="linenum">3264</span></a>                          WHERE ufdf_ID &gt; 40000 AND ufdf_ID &lt;= 60100' );
<a name="l3265"><span class="linenum">3265</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3266"><span class="linenum">3266</span></a>                          SET ufdf_ufgp_ID = &quot;3&quot;
<a name="l3267"><span class="linenum">3267</span></a>                          WHERE ufdf_ID &gt; 60100 AND ufdf_ID &lt;= 160100' );
<a name="l3268"><span class="linenum">3268</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3269"><span class="linenum">3269</span></a>                          SET ufdf_ufgp_ID = &quot;4&quot;
<a name="l3270"><span class="linenum">3270</span></a>                          WHERE ufdf_ID &gt; 160100 AND ufdf_ID &lt;= 211000' );
<a name="l3271"><span class="linenum">3271</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3272"><span class="linenum">3272</span></a>                          SET ufdf_ufgp_ID = &quot;5&quot;
<a name="l3273"><span class="linenum">3273</span></a>                          WHERE ufdf_ID &gt; 211000 AND ufdf_ID &lt;= 300300' );
<a name="l3274"><span class="linenum">3274</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3275"><span class="linenum">3275</span></a>                          SET ufdf_ufgp_ID = &quot;6&quot;
<a name="l3276"><span class="linenum">3276</span></a>                          WHERE ufdf_ID &gt; 300300' );
<a name="l3277"><span class="linenum">3277</span></a>  <span class="comment">        // Set order field</span>
<a name="l3278"><span class="linenum">3278</span></a>          <a class="var it2871" onMouseOver="hilite(2871)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( 'SELECT ufdf_ID, ufdf_ufgp_ID
<a name="l3279"><span class="linenum">3279</span></a>                  FROM T_users__fielddefs
<a name="l3280"><span class="linenum">3280</span></a>                  ORDER BY ufdf_ufgp_ID, ufdf_ID' );
<a name="l3281"><span class="linenum">3281</span></a>          <a class="var it6023" onMouseOver="hilite(6023)" onMouseOut="lolite()" onClick="logVariable('userfield_order')" href="../../_variables/userfield_order.html">$userfield_order</a> = 1;
<a name="l3282"><span class="linenum">3282</span></a>          foreach( <a class="var it2871" onMouseOver="hilite(2871)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a> as <a class="var it6024" onMouseOver="hilite(6024)" onMouseOut="lolite()" onClick="logVariable('uf')" href="../../_variables/uf.html">$uf</a> =&gt; <a class="var it5122" onMouseOver="hilite(5122)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../_variables/userfield.html">$userfield</a> )
<a name="l3283"><span class="linenum">3283</span></a>          {
<a name="l3284"><span class="linenum">3284</span></a>              if( <a class="var it6024" onMouseOver="hilite(6024)" onMouseOut="lolite()" onClick="logVariable('uf')" href="../../_variables/uf.html">$uf</a> &gt; 0 )
<a name="l3285"><span class="linenum">3285</span></a>              {
<a name="l3286"><span class="linenum">3286</span></a>                  if( <a class="var it2871" onMouseOver="hilite(2871)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../_variables/userfields.html">$userfields</a>[<a class="var it6024" onMouseOver="hilite(6024)" onMouseOut="lolite()" onClick="logVariable('uf')" href="../../_variables/uf.html">$uf</a>-1]-&gt;ufdf_ufgp_ID != <a class="var it5122" onMouseOver="hilite(5122)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ufgp_ID')" class="var it9080" onMouseOver="hilite(9080)" onMouseOut="lolite()" href="../../_variables/ufdf_ufgp_ID.html">ufdf_ufgp_ID</a> )
<a name="l3287"><span class="linenum">3287</span></a>                  {    // <span class="keyword">New </span><a class="class" onClick="logClass('group')" href="../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a> is starting, reset <a class="var it6023" onMouseOver="hilite(6023)" onMouseOut="lolite()" onClick="logVariable('userfield_order')" href="../../_variables/userfield_order.html">$userfield_order</a>
<a name="l3288"><span class="linenum">3288</span></a>                      <a class="var it6023" onMouseOver="hilite(6023)" onMouseOut="lolite()" onClick="logVariable('userfield_order')" href="../../_variables/userfield_order.html">$userfield_order</a> = 1;
<a name="l3289"><span class="linenum">3289</span></a>                  }
<a name="l3290"><span class="linenum">3290</span></a>              }
<a name="l3291"><span class="linenum">3291</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3292"><span class="linenum">3292</span></a>                          SET ufdf_order = &quot;'.<a class="var it6023" onMouseOver="hilite(6023)" onMouseOut="lolite()" onClick="logVariable('userfield_order')" href="../../_variables/userfield_order.html">$userfield_order</a>.'&quot;
<a name="l3293"><span class="linenum">3293</span></a>                          WHERE ufdf_ID = '.<a class="var it5122" onMouseOver="hilite(5122)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it9080" onMouseOver="hilite(9080)" onMouseOut="lolite()" href="../../_variables/ufdf_ID.html">ufdf_ID</a> );
<a name="l3294"><span class="linenum">3294</span></a>              <a class="var it6023" onMouseOver="hilite(6023)" onMouseOut="lolite()" onClick="logVariable('userfield_order')" href="../../_variables/userfield_order.html">$userfield_order</a>++;
<a name="l3295"><span class="linenum">3295</span></a>          }
<a name="l3296"><span class="linenum">3296</span></a>  <span class="comment">        // Change field type for Group 'Organization' (group_ID=4)</span>
<a name="l3297"><span class="linenum">3297</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fielddefs
<a name="l3298"><span class="linenum">3298</span></a>                      SET ufdf_type = &quot;word&quot;
<a name="l3299"><span class="linenum">3299</span></a>                      WHERE ufdf_ufgp_ID = &quot;4&quot;' );
<a name="l3300"><span class="linenum">3300</span></a>  <span class="comment">        // Create a default additional info for administrator (user_ID=1)</span>
<a name="l3301"><span class="linenum">3301</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__fields ( uf_user_ID, uf_ufdf_ID, uf_varchar )
<a name="l3302"><span class="linenum">3302</span></a>              VALUES ( 1, 200000, &quot;Site administrator&quot; ),
<a name="l3303"><span class="linenum">3303</span></a>                           ( 1, 200000, &quot;Moderator&quot; ),
<a name="l3304"><span class="linenum">3304</span></a>                           ( 1, 100000, &quot;'.<a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../_variables/baseurl.html">$baseurl</a>.'&quot; )' );
<a name="l3305"><span class="linenum">3305</span></a>  <span class="comment">        // Add Indexes</span>
<a name="l3306"><span class="linenum">3306</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users__fields
<a name="l3307"><span class="linenum">3307</span></a>                          ADD INDEX uf_ufdf_ID ( uf_ufdf_ID ),
<a name="l3308"><span class="linenum">3308</span></a>                          ADD INDEX uf_varchar ( uf_varchar ) ' );
<a name="l3309"><span class="linenum">3309</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3310"><span class="linenum">3310</span></a>  
<a name="l3311"><span class="linenum">3311</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading permissions...' );
<a name="l3312"><span class="linenum">3312</span></a>  <span class="comment">        // Group permissions</span>
<a name="l3313"><span class="linenum">3313</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_coll_group_perms
<a name="l3314"><span class="linenum">3314</span></a>                          ADD bloggroup_perm_own_cmts tinyint NOT NULL default 0 AFTER bloggroup_perm_edit_ts' );
<a name="l3315"><span class="linenum">3315</span></a>  <span class="comment">        // Set default values for Administrators &amp; Privileged Bloggers groups</span>
<a name="l3316"><span class="linenum">3316</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l3317"><span class="linenum">3317</span></a>                          SET bloggroup_perm_own_cmts = &quot;1&quot;
<a name="l3318"><span class="linenum">3318</span></a>                          WHERE bloggroup_group_ID IN ( 1, 2 )' );
<a name="l3319"><span class="linenum">3319</span></a>  <span class="comment">        // User permissions</span>
<a name="l3320"><span class="linenum">3320</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_coll_user_perms
<a name="l3321"><span class="linenum">3321</span></a>                          ADD bloguser_perm_own_cmts tinyint NOT NULL default 0 AFTER bloguser_perm_edit_ts' );
<a name="l3322"><span class="linenum">3322</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3323"><span class="linenum">3323</span></a>  
<a name="l3324"><span class="linenum">3324</span></a>  
<a name="l3325"><span class="linenum">3325</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10500' );
<a name="l3326"><span class="linenum">3326</span></a>      }
<a name="l3327"><span class="linenum">3327</span></a>  
<a name="l3328"><span class="linenum">3328</span></a>  
<a name="l3329"><span class="linenum">3329</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10600 )
<a name="l3330"><span class="linenum">3330</span></a>      {    //  part 4
<a name="l3331"><span class="linenum">3331</span></a>  
<a name="l3332"><span class="linenum">3332</span></a>  <span class="comment">        // For create_default_regions() and create_default_subregions():</span>
<a name="l3333"><span class="linenum">3333</span></a>          require_once <a class="phpfunction" onClick="logFunction('dirname')" href="../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(__FILE__).'/_functions_create.php';
<a name="l3334"><span class="linenum">3334</span></a>  
<a name="l3335"><span class="linenum">3335</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Renaming Countries table...' );
<a name="l3336"><span class="linenum">3336</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'RENAME TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'country TO T_regional__country' );
<a name="l3337"><span class="linenum">3337</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3338"><span class="linenum">3338</span></a>  
<a name="l3339"><span class="linenum">3339</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Renaming Currencies table...' );
<a name="l3340"><span class="linenum">3340</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'RENAME TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'currency TO T_regional__currency' );
<a name="l3341"><span class="linenum">3341</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3342"><span class="linenum">3342</span></a>  
<a name="l3343"><span class="linenum">3343</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating Regions table...' );
<a name="l3344"><span class="linenum">3344</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_regional__region (
<a name="l3345"><span class="linenum">3345</span></a>              rgn_ID        int(10) unsigned NOT NULL auto_increment,
<a name="l3346"><span class="linenum">3346</span></a>              rgn_ctry_ID   int(10) unsigned NOT NULL,
<a name="l3347"><span class="linenum">3347</span></a>              rgn_code      char(6) NOT NULL,
<a name="l3348"><span class="linenum">3348</span></a>              rgn_name      varchar(40) NOT NULL,
<a name="l3349"><span class="linenum">3349</span></a>              rgn_enabled   tinyint(1) NOT NULL DEFAULT 1,
<a name="l3350"><span class="linenum">3350</span></a>              rgn_preferred tinyint(1) NOT NULL DEFAULT 0,
<a name="l3351"><span class="linenum">3351</span></a>              PRIMARY KEY rgn_ID (rgn_ID),
<a name="l3352"><span class="linenum">3352</span></a>              UNIQUE rgn_ctry_ID_code (rgn_ctry_ID, rgn_code)
<a name="l3353"><span class="linenum">3353</span></a>          ) ENGINE = innodb' );
<a name="l3354"><span class="linenum">3354</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3355"><span class="linenum">3355</span></a>  
<a name="l3356"><span class="linenum">3356</span></a>          <a class="function" onClick="logFunction('create_default_regions')" href="../../_functions/create_default_regions.html" onMouseOver="funcPopup(event,'create_default_regions')">create_default_regions</a>();
<a name="l3357"><span class="linenum">3357</span></a>  
<a name="l3358"><span class="linenum">3358</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating Sub-regions table...' );
<a name="l3359"><span class="linenum">3359</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_regional__subregion (
<a name="l3360"><span class="linenum">3360</span></a>              subrg_ID        int(10) unsigned NOT NULL auto_increment,
<a name="l3361"><span class="linenum">3361</span></a>              subrg_rgn_ID    int(10) unsigned NOT NULL,
<a name="l3362"><span class="linenum">3362</span></a>              subrg_code      char(6) NOT NULL,
<a name="l3363"><span class="linenum">3363</span></a>              subrg_name      varchar(40) NOT NULL,
<a name="l3364"><span class="linenum">3364</span></a>              subrg_enabled   tinyint(1) NOT NULL DEFAULT 1,
<a name="l3365"><span class="linenum">3365</span></a>              subrg_preferred tinyint(1) NOT NULL DEFAULT 0,
<a name="l3366"><span class="linenum">3366</span></a>              PRIMARY KEY subrg_ID (subrg_ID),
<a name="l3367"><span class="linenum">3367</span></a>              UNIQUE subrg_rgn_ID_code (subrg_rgn_ID, subrg_code)
<a name="l3368"><span class="linenum">3368</span></a>          ) ENGINE = innodb' );
<a name="l3369"><span class="linenum">3369</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3370"><span class="linenum">3370</span></a>  
<a name="l3371"><span class="linenum">3371</span></a>          <a class="function" onClick="logFunction('create_default_subregions')" href="../../_functions/create_default_subregions.html" onMouseOver="funcPopup(event,'create_default_subregions')">create_default_subregions</a>();
<a name="l3372"><span class="linenum">3372</span></a>  
<a name="l3373"><span class="linenum">3373</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating Cities table...' );
<a name="l3374"><span class="linenum">3374</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_regional__city (
<a name="l3375"><span class="linenum">3375</span></a>              city_ID         int(10) unsigned NOT NULL auto_increment,
<a name="l3376"><span class="linenum">3376</span></a>              city_ctry_ID    int(10) unsigned NOT NULL,
<a name="l3377"><span class="linenum">3377</span></a>              city_rgn_ID     int(10) unsigned NULL,
<a name="l3378"><span class="linenum">3378</span></a>              city_subrg_ID   int(10) unsigned NULL,
<a name="l3379"><span class="linenum">3379</span></a>              city_postcode   char(12) NOT NULL,
<a name="l3380"><span class="linenum">3380</span></a>              city_name       varchar(40) NOT NULL,
<a name="l3381"><span class="linenum">3381</span></a>              city_enabled    tinyint(1) NOT NULL DEFAULT 1,
<a name="l3382"><span class="linenum">3382</span></a>              city_preferred  tinyint(1) NOT NULL DEFAULT 0,
<a name="l3383"><span class="linenum">3383</span></a>              PRIMARY KEY city_ID (city_ID),
<a name="l3384"><span class="linenum">3384</span></a>              INDEX city_ctry_ID_postcode ( city_ctry_ID, city_postcode ),
<a name="l3385"><span class="linenum">3385</span></a>              INDEX city_rgn_ID_postcode ( city_rgn_ID, city_postcode ),
<a name="l3386"><span class="linenum">3386</span></a>              INDEX city_subrg_ID_postcode ( city_subrg_ID, city_postcode )
<a name="l3387"><span class="linenum">3387</span></a>          ) ENGINE = innodb' );
<a name="l3388"><span class="linenum">3388</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3389"><span class="linenum">3389</span></a>  
<a name="l3390"><span class="linenum">3390</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Update Item Settings...' );
<a name="l3391"><span class="linenum">3391</span></a>  <span class="comment">        // Admin: full rights for all blogs (look 'ma, doing a natural join! :&gt;)</span>
<a name="l3392"><span class="linenum">3392</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;INSERT INTO T_items__item_settings( iset_item_ID, iset_name, iset_value )
<a name="l3393"><span class="linenum">3393</span></a>                          SELECT post_ID, 'hide_teaser', post_hideteaser
<a name="l3394"><span class="linenum">3394</span></a>                              FROM T_items__item&quot;;
<a name="l3395"><span class="linenum">3395</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l3396"><span class="linenum">3396</span></a>  
<a name="l3397"><span class="linenum">3397</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_hideteaser' );
<a name="l3398"><span class="linenum">3398</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3399"><span class="linenum">3399</span></a>  
<a name="l3400"><span class="linenum">3400</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading hitlog table...' );
<a name="l3401"><span class="linenum">3401</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_hitlog
<a name="l3402"><span class="linenum">3402</span></a>                          ADD COLUMN hit_keyphrase VARCHAR(255) DEFAULT NULL AFTER hit_keyphrase_keyp_ID&quot; );
<a name="l3403"><span class="linenum">3403</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3404"><span class="linenum">3404</span></a>  
<a name="l3405"><span class="linenum">3405</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading track__keyphrase...' );
<a name="l3406"><span class="linenum">3406</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_track__keyphrase
<a name="l3407"><span class="linenum">3407</span></a>                          ADD COLUMN keyp_count_refered_searches INT UNSIGNED DEFAULT 0 AFTER keyp_phrase,
<a name="l3408"><span class="linenum">3408</span></a>                          ADD COLUMN keyp_count_internal_searches INT UNSIGNED DEFAULT 0 AFTER keyp_count_refered_searches&quot; );
<a name="l3409"><span class="linenum">3409</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3410"><span class="linenum">3410</span></a>  
<a name="l3411"><span class="linenum">3411</span></a>  
<a name="l3412"><span class="linenum">3412</span></a>  
<a name="l3413"><span class="linenum">3413</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Droping table internal searches...' );
<a name="l3414"><span class="linenum">3414</span></a>  
<a name="l3415"><span class="linenum">3415</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;DROP TABLE T_logs__internal_searches&quot; );
<a name="l3416"><span class="linenum">3416</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3417"><span class="linenum">3417</span></a>  
<a name="l3418"><span class="linenum">3418</span></a>  
<a name="l3419"><span class="linenum">3419</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table...' );
<a name="l3420"><span class="linenum">3420</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_rgn_ID', 'int(10) unsigned NULL AFTER user_ctry_ID' );
<a name="l3421"><span class="linenum">3421</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_subrg_ID', 'int(10) unsigned NULL AFTER user_rgn_ID' );
<a name="l3422"><span class="linenum">3422</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_city_ID', 'int(10) unsigned NULL AFTER user_subrg_ID' );
<a name="l3423"><span class="linenum">3423</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3424"><span class="linenum">3424</span></a>  
<a name="l3425"><span class="linenum">3425</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading hitlog table...' );
<a name="l3426"><span class="linenum">3426</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_hitlog
<a name="l3427"><span class="linenum">3427</span></a>                          SET hit_type = &quot;rss&quot;,
<a name="l3428"><span class="linenum">3428</span></a>                              hit_agent_type = &quot;unknown&quot;
<a name="l3429"><span class="linenum">3429</span></a>                          WHERE hit_agent_type = &quot;rss&quot;' );
<a name="l3430"><span class="linenum">3430</span></a>  
<a name="l3431"><span class="linenum">3431</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_hitlog
<a name="l3432"><span class="linenum">3432</span></a>                                  CHANGE COLUMN hit_agent_type hit_agent_type ENUM('robot','browser','unknown') DEFAULT 'unknown' NOT NULL&quot; );
<a name="l3433"><span class="linenum">3433</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3434"><span class="linenum">3434</span></a>  
<a name="l3435"><span class="linenum">3435</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating mail log table...' );
<a name="l3436"><span class="linenum">3436</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'mail__log (
<a name="l3437"><span class="linenum">3437</span></a>            emlog_ID        INT(10) UNSIGNED NOT NULL auto_increment,
<a name="l3438"><span class="linenum">3438</span></a>            emlog_timestamp TIMESTAMP NOT NULL,
<a name="l3439"><span class="linenum">3439</span></a>            emlog_to        VARCHAR(255) DEFAULT NULL,
<a name="l3440"><span class="linenum">3440</span></a>            emlog_success   TINYINT(1) NOT NULL DEFAULT 0,
<a name="l3441"><span class="linenum">3441</span></a>            emlog_subject   VARCHAR(255) DEFAULT NULL,
<a name="l3442"><span class="linenum">3442</span></a>            emlog_headers   TEXT DEFAULT NULL,
<a name="l3443"><span class="linenum">3443</span></a>            emlog_message   TEXT DEFAULT NULL,
<a name="l3444"><span class="linenum">3444</span></a>            PRIMARY KEY     (emlog_ID)
<a name="l3445"><span class="linenum">3445</span></a>          ) ENGINE = myisam' );
<a name="l3446"><span class="linenum">3446</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3447"><span class="linenum">3447</span></a>  
<a name="l3448"><span class="linenum">3448</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10600' );
<a name="l3449"><span class="linenum">3449</span></a>      }
<a name="l3450"><span class="linenum">3450</span></a>  
<a name="l3451"><span class="linenum">3451</span></a>  
<a name="l3452"><span class="linenum">3452</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10700 )
<a name="l3453"><span class="linenum">3453</span></a>      {    // part 5
<a name="l3454"><span class="linenum">3454</span></a>  
<a name="l3455"><span class="linenum">3455</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading user notifications settings...' );
<a name="l3456"><span class="linenum">3456</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3457"><span class="linenum">3457</span></a>                          SELECT user_ID, &quot;notify_published_comments&quot;, user_notify
<a name="l3458"><span class="linenum">3458</span></a>                              FROM T_users', 'Move notify settings from users to users_usersettings' );
<a name="l3459"><span class="linenum">3459</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3460"><span class="linenum">3460</span></a>                          SELECT user_ID, &quot;notify_comment_moderation&quot;, user_notify_moderation
<a name="l3461"><span class="linenum">3461</span></a>                              FROM T_users', 'Move notify moderation settings from users to users_usersettings' );
<a name="l3462"><span class="linenum">3462</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3463"><span class="linenum">3463</span></a>                          SELECT user_ID, &quot;enable_PM&quot;, 1
<a name="l3464"><span class="linenum">3464</span></a>                              FROM T_users
<a name="l3465"><span class="linenum">3465</span></a>                                  WHERE user_allow_msgform = 1 OR user_allow_msgform = 3', 'Set enable PM on users_usersettings' );
<a name="l3466"><span class="linenum">3466</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3467"><span class="linenum">3467</span></a>                          SELECT user_ID, &quot;enable_PM&quot;, 0
<a name="l3468"><span class="linenum">3468</span></a>                              FROM T_users
<a name="l3469"><span class="linenum">3469</span></a>                                  WHERE user_allow_msgform = 0 OR user_allow_msgform = 2', 'Set enable PM on users_usersettings' );
<a name="l3470"><span class="linenum">3470</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3471"><span class="linenum">3471</span></a>                          SELECT user_ID, &quot;enable_email&quot;, 1
<a name="l3472"><span class="linenum">3472</span></a>                              FROM T_users
<a name="l3473"><span class="linenum">3473</span></a>                                  WHERE user_allow_msgform &gt; 1', 'Set enable email true on users_usersettings' );
<a name="l3474"><span class="linenum">3474</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3475"><span class="linenum">3475</span></a>                          SELECT user_ID, &quot;enable_email&quot;, 0
<a name="l3476"><span class="linenum">3476</span></a>                              FROM T_users
<a name="l3477"><span class="linenum">3477</span></a>                                  WHERE user_allow_msgform &lt; 2', 'Set enable email false on users_usersettings' );
<a name="l3478"><span class="linenum">3478</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_notify' );
<a name="l3479"><span class="linenum">3479</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_notify_moderation' );
<a name="l3480"><span class="linenum">3480</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_allow_msgform' );
<a name="l3481"><span class="linenum">3481</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3482"><span class="linenum">3482</span></a>  
<a name="l3483"><span class="linenum">3483</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Item table...' );
<a name="l3484"><span class="linenum">3484</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_ctry_ID', 'INT(10) UNSIGNED NULL' );
<a name="l3485"><span class="linenum">3485</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_rgn_ID', 'INT(10) UNSIGNED NULL' );
<a name="l3486"><span class="linenum">3486</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_subrg_ID', 'INT(10) UNSIGNED NULL' );
<a name="l3487"><span class="linenum">3487</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_city_ID', 'INT(10) UNSIGNED NULL' );
<a name="l3488"><span class="linenum">3488</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3489"><span class="linenum">3489</span></a>  
<a name="l3490"><span class="linenum">3490</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table...' );
<a name="l3491"><span class="linenum">3491</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_postcode' );    <span class="comment">// Previously obsoleted</span>
<a name="l3492"><span class="linenum">3492</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_idmode' );
<a name="l3493"><span class="linenum">3493</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3494"><span class="linenum">3494</span></a>  
<a name="l3495"><span class="linenum">3495</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users fields table...' );
<a name="l3496"><span class="linenum">3496</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users__fielddefs', 'ufdf_bubbletip', 'varchar(2000) NULL' );
<a name="l3497"><span class="linenum">3497</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3498"><span class="linenum">3498</span></a>  
<a name="l3499"><span class="linenum">3499</span></a>  
<a name="l3500"><span class="linenum">3500</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for groups of messaging contacts...' );
<a name="l3501"><span class="linenum">3501</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE IF NOT EXISTS T_messaging__contact_groups (
<a name="l3502"><span class="linenum">3502</span></a>              cgr_ID      int(10) unsigned NOT NULL auto_increment,
<a name="l3503"><span class="linenum">3503</span></a>              cgr_user_ID int(10) unsigned NOT NULL,
<a name="l3504"><span class="linenum">3504</span></a>              cgr_name    varchar(50) NOT NULL,
<a name="l3505"><span class="linenum">3505</span></a>              PRIMARY KEY cgr_ID (cgr_ID)
<a name="l3506"><span class="linenum">3506</span></a>          ) ENGINE = innodb&quot; );
<a name="l3507"><span class="linenum">3507</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3508"><span class="linenum">3508</span></a>  
<a name="l3509"><span class="linenum">3509</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for group users of messaging contacts...' );
<a name="l3510"><span class="linenum">3510</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_messaging__contact_groupusers (
<a name="l3511"><span class="linenum">3511</span></a>              cgu_user_ID int(10) unsigned NOT NULL,
<a name="l3512"><span class="linenum">3512</span></a>              cgu_cgr_ID  int(10) unsigned NOT NULL,
<a name="l3513"><span class="linenum">3513</span></a>              PRIMARY KEY cgu_PK (cgu_user_ID, cgu_cgr_ID)
<a name="l3514"><span class="linenum">3514</span></a>          ) ENGINE = innodb&quot; );
<a name="l3515"><span class="linenum">3515</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3516"><span class="linenum">3516</span></a>  
<a name="l3517"><span class="linenum">3517</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading mail log table...' );
<a name="l3518"><span class="linenum">3518</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( <a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'mail__log', 'emlog_user_ID', 'INT(10) UNSIGNED DEFAULT NULL AFTER emlog_timestamp' );
<a name="l3519"><span class="linenum">3519</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3520"><span class="linenum">3520</span></a>  
<a name="l3521"><span class="linenum">3521</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10700' );
<a name="l3522"><span class="linenum">3522</span></a>      }
<a name="l3523"><span class="linenum">3523</span></a>  
<a name="l3524"><span class="linenum">3524</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10800 )
<a name="l3525"><span class="linenum">3525</span></a>      {    // part 6 aka between &quot;i1-i2&quot; and &quot;i2&quot;
<a name="l3526"><span class="linenum">3526</span></a>  
<a name="l3527"><span class="linenum">3527</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table, add user status...' );
<a name="l3528"><span class="linenum">3528</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_status', 'enum( &quot;activated&quot;, &quot;autoactivated&quot;, &quot;closed&quot;, &quot;deactivated&quot;, &quot;emailchanged&quot;, &quot;new&quot; ) NOT NULL default &quot;new&quot; AFTER user_validated' );
<a name="l3529"><span class="linenum">3529</span></a>          <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('update_user_status_query')" href="../../_variables/update_user_status_query.html">$update_user_status_query</a> = 'UPDATE T_users SET user_status = ';
<a name="l3530"><span class="linenum">3530</span></a>  <span class="comment">        // check if new users must activate their account. If users are not required to activate their account, then all existing users will be considerated as activated user.</span>
<a name="l3531"><span class="linenum">3531</span></a>          <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('new_users_must_validate')" href="../../_variables/new_users_must_validate.html">$new_users_must_validate</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT set_value FROM T_settings WHERE set_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'newusers_mustvalidate' ) );
<a name="l3532"><span class="linenum">3532</span></a>          if( <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('new_users_must_validate')" href="../../_variables/new_users_must_validate.html">$new_users_must_validate</a> || ( <a class="var it6026" onMouseOver="hilite(6026)" onMouseOut="lolite()" onClick="logVariable('new_users_must_validate')" href="../../_variables/new_users_must_validate.html">$new_users_must_validate</a> == NULL ) )
<a name="l3533"><span class="linenum">3533</span></a>          { // newusers_mustvalidate setting is set to true, or it is not set at all. If it is not set, we know that the default value is true!
<a name="l3534"><span class="linenum">3534</span></a>  <span class="comment">            // set activated status only for validated users</span>
<a name="l3535"><span class="linenum">3535</span></a>              <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('update_user_status_query')" href="../../_variables/update_user_status_query.html">$update_user_status_query</a> .= <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'activated' );
<a name="l3536"><span class="linenum">3536</span></a>              <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('update_user_status_query')" href="../../_variables/update_user_status_query.html">$update_user_status_query</a> .= ' WHERE user_validated = 1';
<a name="l3537"><span class="linenum">3537</span></a>          }
<a name="l3538"><span class="linenum">3538</span></a>          else
<a name="l3539"><span class="linenum">3539</span></a>          {
<a name="l3540"><span class="linenum">3540</span></a>              <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('update_user_status_query')" href="../../_variables/update_user_status_query.html">$update_user_status_query</a> .= <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'autoactivated' );
<a name="l3541"><span class="linenum">3541</span></a>          }
<a name="l3542"><span class="linenum">3542</span></a>  <span class="comment">        // set activated status for corresponding users</span>
<a name="l3543"><span class="linenum">3543</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it6025" onMouseOver="hilite(6025)" onMouseOut="lolite()" onClick="logVariable('update_user_status_query')" href="../../_variables/update_user_status_query.html">$update_user_status_query</a> );
<a name="l3544"><span class="linenum">3544</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_validated' );
<a name="l3545"><span class="linenum">3545</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3546"><span class="linenum">3546</span></a>  
<a name="l3547"><span class="linenum">3547</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10800' );
<a name="l3548"><span class="linenum">3548</span></a>      }
<a name="l3549"><span class="linenum">3549</span></a>  
<a name="l3550"><span class="linenum">3550</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10900 )
<a name="l3551"><span class="linenum">3551</span></a>      {    // part 7 aka &quot;i3&quot;
<a name="l3552"><span class="linenum">3552</span></a>  
<a name="l3553"><span class="linenum">3553</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading user settings table...' );
<a name="l3554"><span class="linenum">3554</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3555"><span class="linenum">3555</span></a>                          SELECT user_ID, &quot;show_online&quot;, 0
<a name="l3556"><span class="linenum">3556</span></a>                              FROM T_users
<a name="l3557"><span class="linenum">3557</span></a>                                  WHERE user_showonline = 0', 'Set show online on users_usersettings' );
<a name="l3558"><span class="linenum">3558</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3559"><span class="linenum">3559</span></a>                          SELECT user_ID, &quot;user_ip&quot;, user_ip
<a name="l3560"><span class="linenum">3560</span></a>                              FROM T_users
<a name="l3561"><span class="linenum">3561</span></a>                                  WHERE user_ip IS NOT NULL', 'Set user ip on users_usersettings' );
<a name="l3562"><span class="linenum">3562</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3563"><span class="linenum">3563</span></a>                          SELECT user_ID, &quot;user_domain&quot;, user_domain
<a name="l3564"><span class="linenum">3564</span></a>                              FROM T_users
<a name="l3565"><span class="linenum">3565</span></a>                                  WHERE user_domain IS NOT NULL', 'Set user domain on users_usersettings' );
<a name="l3566"><span class="linenum">3566</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l3567"><span class="linenum">3567</span></a>                          SELECT user_ID, &quot;user_browser&quot;, user_browser
<a name="l3568"><span class="linenum">3568</span></a>                              FROM T_users
<a name="l3569"><span class="linenum">3569</span></a>                                  WHERE user_browser IS NOT NULL', 'Set user browser on users_usersettings' );
<a name="l3570"><span class="linenum">3570</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_showonline' );
<a name="l3571"><span class="linenum">3571</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_ip' );
<a name="l3572"><span class="linenum">3572</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_domain' );
<a name="l3573"><span class="linenum">3573</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_browser' );
<a name="l3574"><span class="linenum">3574</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3575"><span class="linenum">3575</span></a>  
<a name="l3576"><span class="linenum">3576</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading user activation settings...' );
<a name="l3577"><span class="linenum">3577</span></a>  <span class="comment">        // Remove all last_activation_email timestamps because we will use date instead of them</span>
<a name="l3578"><span class="linenum">3578</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_users__usersettings WHERE uset_name = &quot;last_activation_email&quot;' );
<a name="l3579"><span class="linenum">3579</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3580"><span class="linenum">3580</span></a>  
<a name="l3581"><span class="linenum">3581</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Users table...' );
<a name="l3582"><span class="linenum">3582</span></a>  <span class="comment">        // Update user_status column add 'failedactivation' status</span>
<a name="l3583"><span class="linenum">3583</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users CHANGE user_status
<a name="l3584"><span class="linenum">3584</span></a>                      user_status enum( &quot;activated&quot;, &quot;autoactivated&quot;, &quot;closed&quot;, &quot;deactivated&quot;, &quot;emailchanged&quot;, &quot;failedactivation&quot;, &quot;new&quot; ) NOT NULL default &quot;new&quot;' );
<a name="l3585"><span class="linenum">3585</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_created_fromIPv4', 'int(10) unsigned NOT NULL' );
<a name="l3586"><span class="linenum">3586</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_email_dom_ID', 'int(10) unsigned NULL' );
<a name="l3587"><span class="linenum">3587</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users CHANGE dateYMDhour user_created_datetime DATETIME NOT NULL DEFAULT \'2000-01-01 00:00:00\'' );
<a name="l3588"><span class="linenum">3588</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_reg_ctry_ID', 'int(10) unsigned NULL AFTER user_age_max' );
<a name="l3589"><span class="linenum">3589</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_profileupdate_ts', 'timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP' );
<a name="l3590"><span class="linenum">3590</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users ADD INDEX user_email ( user_email )' );
<a name="l3591"><span class="linenum">3591</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3592"><span class="linenum">3592</span></a>  
<a name="l3593"><span class="linenum">3593</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Renaming Email log table...' );
<a name="l3594"><span class="linenum">3594</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'RENAME TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'mail__log TO T_email__log' );
<a name="l3595"><span class="linenum">3595</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3596"><span class="linenum">3596</span></a>  
<a name="l3597"><span class="linenum">3597</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating email returns table...' );
<a name="l3598"><span class="linenum">3598</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_email__returns (
<a name="l3599"><span class="linenum">3599</span></a>                emret_ID        INT(10) UNSIGNED NOT NULL auto_increment,
<a name="l3600"><span class="linenum">3600</span></a>                emret_address   VARCHAR(255) DEFAULT NULL,
<a name="l3601"><span class="linenum">3601</span></a>                emret_errormsg  VARCHAR(255) DEFAULT NULL,
<a name="l3602"><span class="linenum">3602</span></a>                emret_timestamp TIMESTAMP NOT NULL,
<a name="l3603"><span class="linenum">3603</span></a>                emret_headers   TEXT DEFAULT NULL,
<a name="l3604"><span class="linenum">3604</span></a>                emret_message   TEXT DEFAULT NULL,
<a name="l3605"><span class="linenum">3605</span></a>                emret_errtype   CHAR(1) NOT NULL DEFAULT 'U',
<a name="l3606"><span class="linenum">3606</span></a>                PRIMARY KEY     (emret_ID)
<a name="l3607"><span class="linenum">3607</span></a>              ) ENGINE = myisam&quot; );
<a name="l3608"><span class="linenum">3608</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3609"><span class="linenum">3609</span></a>  
<a name="l3610"><span class="linenum">3610</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading general settings table...' );
<a name="l3611"><span class="linenum">3611</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_settings CHANGE set_value set_value VARCHAR( 5000 ) NULL' );
<a name="l3612"><span class="linenum">3612</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3613"><span class="linenum">3613</span></a>  
<a name="l3614"><span class="linenum">3614</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading sessions table...' );
<a name="l3615"><span class="linenum">3615</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_sessions', 'sess_device', 'VARCHAR(8) NOT NULL DEFAULT \'\'' );
<a name="l3616"><span class="linenum">3616</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3617"><span class="linenum">3617</span></a>  
<a name="l3618"><span class="linenum">3618</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for Antispam IP Ranges...' );
<a name="l3619"><span class="linenum">3619</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_antispam__iprange (
<a name="l3620"><span class="linenum">3620</span></a>              aipr_ID         int(10) unsigned NOT NULL auto_increment,
<a name="l3621"><span class="linenum">3621</span></a>              aipr_IPv4start  int(10) unsigned NOT NULL,
<a name="l3622"><span class="linenum">3622</span></a>              aipr_IPv4end    int(10) unsigned NOT NULL,
<a name="l3623"><span class="linenum">3623</span></a>              aipr_user_count int(10) unsigned DEFAULT 0,
<a name="l3624"><span class="linenum">3624</span></a>              PRIMARY KEY aipr_ID (aipr_ID)
<a name="l3625"><span class="linenum">3625</span></a>          ) ENGINE = innodb&quot; );
<a name="l3626"><span class="linenum">3626</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3627"><span class="linenum">3627</span></a>  
<a name="l3628"><span class="linenum">3628</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading base domains table...' );
<a name="l3629"><span class="linenum">3629</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_basedomains CHANGE dom_type dom_type ENUM( 'unknown', 'normal', 'searcheng', 'aggregator', 'email' ) CHARACTER SET latin1 COLLATE latin1_swedish_ci NOT NULL DEFAULT 'unknown'&quot; );
<a name="l3630"><span class="linenum">3630</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_basedomains DROP INDEX dom_name' );
<a name="l3631"><span class="linenum">3631</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_basedomains DROP INDEX dom_type' );
<a name="l3632"><span class="linenum">3632</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_basedomains ADD UNIQUE dom_type_name ( dom_type, dom_name )' );
<a name="l3633"><span class="linenum">3633</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3634"><span class="linenum">3634</span></a>  
<a name="l3635"><span class="linenum">3635</span></a>  <span class="comment">        /*** Update user_email_dom_ID for all already existing users ***/</span>
<a name="l3636"><span class="linenum">3636</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users email domains...' );
<a name="l3637"><span class="linenum">3637</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l3638"><span class="linenum">3638</span></a>  <span class="comment">        // Get the users</span>
<a name="l3639"><span class="linenum">3639</span></a>          <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('uemails_SQL')" href="../../_variables/uemails_SQL.html">$uemails_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l3640"><span class="linenum">3640</span></a>          <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('uemails_SQL')" href="../../_variables/uemails_SQL.html">$uemails_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'user_ID, user_email' );
<a name="l3641"><span class="linenum">3641</span></a>          <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('uemails_SQL')" href="../../_variables/uemails_SQL.html">$uemails_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users' );
<a name="l3642"><span class="linenum">3642</span></a>          <a class="var it6028" onMouseOver="hilite(6028)" onMouseOut="lolite()" onClick="logVariable('users_emails')" href="../../_variables/users_emails.html">$users_emails</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it6027" onMouseOver="hilite(6027)" onMouseOut="lolite()" onClick="logVariable('uemails_SQL')" href="../../_variables/uemails_SQL.html">$uemails_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l3643"><span class="linenum">3643</span></a>  
<a name="l3644"><span class="linenum">3644</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it6028" onMouseOver="hilite(6028)" onMouseOut="lolite()" onClick="logVariable('users_emails')" href="../../_variables/users_emails.html">$users_emails</a> ) &gt; 0 )
<a name="l3645"><span class="linenum">3645</span></a>          {
<a name="l3646"><span class="linenum">3646</span></a>  <span class="comment">            // Get all email domains</span>
<a name="l3647"><span class="linenum">3647</span></a>              <a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('edoms_SQL')" href="../../_variables/edoms_SQL.html">$edoms_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l3648"><span class="linenum">3648</span></a>              <a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('edoms_SQL')" href="../../_variables/edoms_SQL.html">$edoms_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'dom_ID, dom_name' );
<a name="l3649"><span class="linenum">3649</span></a>              <a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('edoms_SQL')" href="../../_variables/edoms_SQL.html">$edoms_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_basedomains' );
<a name="l3650"><span class="linenum">3650</span></a>              <a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('edoms_SQL')" href="../../_variables/edoms_SQL.html">$edoms_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'dom_type = \'email\'' );
<a name="l3651"><span class="linenum">3651</span></a>              <a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('email_domains')" href="../../_variables/email_domains.html">$email_domains</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it6029" onMouseOver="hilite(6029)" onMouseOut="lolite()" onClick="logVariable('edoms_SQL')" href="../../_variables/edoms_SQL.html">$edoms_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l3652"><span class="linenum">3652</span></a>  <span class="comment">            // pre_dump( $email_domains );</span>
<a name="l3653"><span class="linenum">3653</span></a>  
<a name="l3654"><span class="linenum">3654</span></a>              foreach( <a class="var it6028" onMouseOver="hilite(6028)" onMouseOut="lolite()" onClick="logVariable('users_emails')" href="../../_variables/users_emails.html">$users_emails</a> as <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../_variables/user_ID.html">$user_ID</a> =&gt; <a class="var it3335" onMouseOver="hilite(3335)" onMouseOut="lolite()" onClick="logVariable('user_email')" href="../../_variables/user_email.html">$user_email</a> )
<a name="l3655"><span class="linenum">3655</span></a>              {
<a name="l3656"><span class="linenum">3656</span></a>                  if( <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '#@(.+)#i', <a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it3335" onMouseOver="hilite(3335)" onMouseOut="lolite()" onClick="logVariable('user_email')" href="../../_variables/user_email.html">$user_email</a>), <a class="var it5178" onMouseOver="hilite(5178)" onMouseOut="lolite()" onClick="logVariable('ematch')" href="../../_variables/ematch.html">$ematch</a> ) )
<a name="l3657"><span class="linenum">3657</span></a>                  {    // Get email domain from user's email address
<a name="l3658"><span class="linenum">3658</span></a>                      <a class="var it5179" onMouseOver="hilite(5179)" onMouseOut="lolite()" onClick="logVariable('email_domain')" href="../../_variables/email_domain.html">$email_domain</a> = <a class="var it5178" onMouseOver="hilite(5178)" onMouseOut="lolite()" onClick="logVariable('ematch')" href="../../_variables/ematch.html">$ematch</a>[1];
<a name="l3659"><span class="linenum">3659</span></a>                      <a class="var it4396" onMouseOver="hilite(4396)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../_variables/dom_ID.html">$dom_ID</a> = <a class="phpfunction" onClick="logFunction('array_search')" href="../../_functions/array_search.html" onMouseOver="phpfuncPopup(event,'array_search')">array_search</a>( <a class="var it5179" onMouseOver="hilite(5179)" onMouseOut="lolite()" onClick="logVariable('email_domain')" href="../../_variables/email_domain.html">$email_domain</a>, <a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('email_domains')" href="../../_variables/email_domains.html">$email_domains</a> );
<a name="l3660"><span class="linenum">3660</span></a>  
<a name="l3661"><span class="linenum">3661</span></a>                      if( ! <a class="var it4396" onMouseOver="hilite(4396)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../_variables/dom_ID.html">$dom_ID</a> )
<a name="l3662"><span class="linenum">3662</span></a>                      {    // Insert new email domain
<a name="l3663"><span class="linenum">3663</span></a>                          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_basedomains ( dom_type, dom_name )
<a name="l3664"><span class="linenum">3664</span></a>                              VALUES ( \'email\', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it5179" onMouseOver="hilite(5179)" onMouseOut="lolite()" onClick="logVariable('email_domain')" href="../../_variables/email_domain.html">$email_domain</a> ).' )' );
<a name="l3665"><span class="linenum">3665</span></a>                          <a class="var it4396" onMouseOver="hilite(4396)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../_variables/dom_ID.html">$dom_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('insert_id')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/insert_id.html">insert_id</a>;
<a name="l3666"><span class="linenum">3666</span></a>  
<a name="l3667"><span class="linenum">3667</span></a>  <span class="comment">                        // Memorize inserted domain to prevent duplicates</span>
<a name="l3668"><span class="linenum">3668</span></a>                          <a class="var it6030" onMouseOver="hilite(6030)" onMouseOut="lolite()" onClick="logVariable('email_domains')" href="../../_variables/email_domains.html">$email_domains</a>[<a class="var it4396" onMouseOver="hilite(4396)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../_variables/dom_ID.html">$dom_ID</a>] = <a class="var it5179" onMouseOver="hilite(5179)" onMouseOut="lolite()" onClick="logVariable('email_domain')" href="../../_variables/email_domain.html">$email_domain</a>;
<a name="l3669"><span class="linenum">3669</span></a>  <span class="comment">                        // pre_dump( $dom_ID, $email_domain );</span>
<a name="l3670"><span class="linenum">3670</span></a>                      }
<a name="l3671"><span class="linenum">3671</span></a>  
<a name="l3672"><span class="linenum">3672</span></a>  <span class="comment">                    // Update user_email_dom_ID</span>
<a name="l3673"><span class="linenum">3673</span></a>                      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users
<a name="l3674"><span class="linenum">3674</span></a>                          SET user_email_dom_ID = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4396" onMouseOver="hilite(4396)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../_variables/dom_ID.html">$dom_ID</a> ).'
<a name="l3675"><span class="linenum">3675</span></a>                          WHERE user_ID = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../_variables/user_ID.html">$user_ID</a> ) );
<a name="l3676"><span class="linenum">3676</span></a>                  }
<a name="l3677"><span class="linenum">3677</span></a>              }
<a name="l3678"><span class="linenum">3678</span></a>          }
<a name="l3679"><span class="linenum">3679</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l3680"><span class="linenum">3680</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3681"><span class="linenum">3681</span></a>  
<a name="l3682"><span class="linenum">3682</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users fields table...' );
<a name="l3683"><span class="linenum">3683</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users__fields CHANGE uf_varchar uf_varchar VARCHAR( 10000 ) NOT NULL' );
<a name="l3684"><span class="linenum">3684</span></a>  <span class="comment">        // Modify Indexes</span>
<a name="l3685"><span class="linenum">3685</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_users__fields
<a name="l3686"><span class="linenum">3686</span></a>                          DROP INDEX uf_varchar,
<a name="l3687"><span class="linenum">3687</span></a>                          ADD INDEX uf_varchar ( uf_varchar(255) )' );
<a name="l3688"><span class="linenum">3688</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3689"><span class="linenum">3689</span></a>  
<a name="l3690"><span class="linenum">3690</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading cron tasks table...' );
<a name="l3691"><span class="linenum">3691</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_cron__task CHANGE ctsk_name ctsk_name VARCHAR(255) NOT NULL' );
<a name="l3692"><span class="linenum">3692</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3693"><span class="linenum">3693</span></a>  
<a name="l3694"><span class="linenum">3694</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading comments table...' );
<a name="l3695"><span class="linenum">3695</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_comments', 'comment_IP_ctry_ID', 'int(10) unsigned NULL AFTER comment_author_IP' );
<a name="l3696"><span class="linenum">3696</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3697"><span class="linenum">3697</span></a>  
<a name="l3698"><span class="linenum">3698</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for Blocked Email Addreses...' );
<a name="l3699"><span class="linenum">3699</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE {<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>}email__blocked (
<a name="l3700"><span class="linenum">3700</span></a>              emblk_ID                    INT(10) UNSIGNED NOT NULL auto_increment,
<a name="l3701"><span class="linenum">3701</span></a>              emblk_address               VARCHAR(255) DEFAULT NULL,
<a name="l3702"><span class="linenum">3702</span></a>              emblk_status                ENUM ( 'unknown', 'warning', 'suspicious1', 'suspicious2', 'suspicious3', 'prmerror', 'spammer' ) NOT NULL DEFAULT 'unknown',
<a name="l3703"><span class="linenum">3703</span></a>              emblk_sent_count            INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l3704"><span class="linenum">3704</span></a>              emblk_sent_last_returnerror INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l3705"><span class="linenum">3705</span></a>              emblk_prmerror_count        INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l3706"><span class="linenum">3706</span></a>              emblk_tmperror_count        INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l3707"><span class="linenum">3707</span></a>              emblk_spamerror_count       INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l3708"><span class="linenum">3708</span></a>              emblk_othererror_count      INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l3709"><span class="linenum">3709</span></a>              emblk_last_sent_ts          TIMESTAMP NULL,
<a name="l3710"><span class="linenum">3710</span></a>              emblk_last_error_ts         TIMESTAMP NULL,
<a name="l3711"><span class="linenum">3711</span></a>              PRIMARY KEY                 (emblk_ID),
<a name="l3712"><span class="linenum">3712</span></a>              UNIQUE                      emblk_address (emblk_address)
<a name="l3713"><span class="linenum">3713</span></a>          ) ENGINE = myisam&quot; );
<a name="l3714"><span class="linenum">3714</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3715"><span class="linenum">3715</span></a>  
<a name="l3716"><span class="linenum">3716</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading email log table...' );
<a name="l3717"><span class="linenum">3717</span></a>  <span class="comment">        // Get old values of emlog_success field</span>
<a name="l3718"><span class="linenum">3718</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l3719"><span class="linenum">3719</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'emlog_ID' );
<a name="l3720"><span class="linenum">3720</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_email__log' );
<a name="l3721"><span class="linenum">3721</span></a>          <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'emlog_success = 0' );
<a name="l3722"><span class="linenum">3722</span></a>          <a class="var it6031" onMouseOver="hilite(6031)" onMouseOut="lolite()" onClick="logVariable('email_failed_logs')" href="../../_variables/email_failed_logs.html">$email_failed_logs</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l3723"><span class="linenum">3723</span></a>  <span class="comment">        // Change a field emlog_success to new format</span>
<a name="l3724"><span class="linenum">3724</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_email__log CHANGE emlog_success emlog_result ENUM ( &quot;ok&quot;, &quot;error&quot;, &quot;blocked&quot; ) NOT NULL DEFAULT &quot;ok&quot;' );
<a name="l3725"><span class="linenum">3725</span></a>          if( !empty( <a class="var it6031" onMouseOver="hilite(6031)" onMouseOut="lolite()" onClick="logVariable('email_failed_logs')" href="../../_variables/email_failed_logs.html">$email_failed_logs</a> ) )
<a name="l3726"><span class="linenum">3726</span></a>          {    // Update only the failed email logs to new values
<a name="l3727"><span class="linenum">3727</span></a>  <span class="comment">            // Do NOT update the success email logs, because we already have a result type 'ok' as default</span>
<a name="l3728"><span class="linenum">3728</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_email__log
<a name="l3729"><span class="linenum">3729</span></a>                      SET emlog_result = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'error' ).'
<a name="l3730"><span class="linenum">3730</span></a>                  WHERE emlog_ID IN ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it6031" onMouseOver="hilite(6031)" onMouseOut="lolite()" onClick="logVariable('email_failed_logs')" href="../../_variables/email_failed_logs.html">$email_failed_logs</a> ).' )' );
<a name="l3731"><span class="linenum">3731</span></a>          }
<a name="l3732"><span class="linenum">3732</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3733"><span class="linenum">3733</span></a>  
<a name="l3734"><span class="linenum">3734</span></a>          <span class="comment">/*</span>
<a name="l3735"><span class="linenum">3735</span></a>  <span class="comment">         * ADD UPGRADES FOR i3 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l3736"><span class="linenum">3736</span></a>  <span class="comment">         *</span>
<a name="l3737"><span class="linenum">3737</span></a>  <span class="comment">         * This part will be included in trunk and i3 branches</span>
<a name="l3738"><span class="linenum">3738</span></a>  <span class="comment">         */</span>
<a name="l3739"><span class="linenum">3739</span></a>  
<a name="l3740"><span class="linenum">3740</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10900' );
<a name="l3741"><span class="linenum">3741</span></a>      }
<a name="l3742"><span class="linenum">3742</span></a>  
<a name="l3743"><span class="linenum">3743</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10970 )
<a name="l3744"><span class="linenum">3744</span></a>      {    // part 8/a trunk aka first part of &quot;i4&quot;
<a name="l3745"><span class="linenum">3745</span></a>  
<a name="l3746"><span class="linenum">3746</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Locales table...' );
<a name="l3747"><span class="linenum">3747</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_locales', 'loc_transliteration_map', 'VARCHAR(10000) NOT NULL default \'\' AFTER loc_priority' );
<a name="l3748"><span class="linenum">3748</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3749"><span class="linenum">3749</span></a>  
<a name="l3750"><span class="linenum">3750</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading general settings table...' );
<a name="l3751"><span class="linenum">3751</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_settings SET set_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'smart_view_count' ).' WHERE set_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'smart_hit_count' ) );
<a name="l3752"><span class="linenum">3752</span></a>  <span class="comment">        // This query below was added later to turn OFF smart view counting on upgrade from v4 to v5 for better performance</span>
<a name="l3753"><span class="linenum">3753</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_settings WHERE set_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'smart_view_count' ) );
<a name="l3754"><span class="linenum">3754</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3755"><span class="linenum">3755</span></a>  
<a name="l3756"><span class="linenum">3756</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading sessions table...' );
<a name="l3757"><span class="linenum">3757</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_sessions SET sess_lastseen = concat( '2000-01-01 ', <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>( sess_lastseen ) )
<a name="l3758"><span class="linenum">3758</span></a>                          WHERE <a class="phpfunction" onClick="logFunction('date')" href="../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( sess_lastseen ) = '1970-01-01'&quot; );
<a name="l3759"><span class="linenum">3759</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_sessions CHANGE COLUMN sess_lastseen sess_lastseen_ts TIMESTAMP NOT NULL DEFAULT '2000-01-01 00:00:00' COMMENT 'User last logged activation time. Value may be off by up to 60 seconds'&quot; );
<a name="l3760"><span class="linenum">3760</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_sessions', 'sess_start_ts', &quot;TIMESTAMP NOT NULL DEFAULT '2000-01-01 00:00:00' AFTER sess_hitcount&quot; );
<a name="l3761"><span class="linenum">3761</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_sessions SET sess_start_ts = TIMESTAMPADD( SECOND, -1, sess_lastseen_ts )' );
<a name="l3762"><span class="linenum">3762</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_sessions', 'sess_hitcount' );
<a name="l3763"><span class="linenum">3763</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3764"><span class="linenum">3764</span></a>  
<a name="l3765"><span class="linenum">3765</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table...' );
<a name="l3766"><span class="linenum">3766</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_users', 'user_lastseen_ts', 'TIMESTAMP NULL AFTER user_created_datetime' );
<a name="l3767"><span class="linenum">3767</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users SET user_lastseen_ts = ( SELECT <a class="phpfunction" onClick="logFunction('MAX')" href="../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>( sess_lastseen_ts ) FROM T_sessions WHERE sess_user_ID = user_ID )' );
<a name="l3768"><span class="linenum">3768</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users SET user_profileupdate_ts = user_created_datetime WHERE user_profileupdate_ts &lt; user_created_datetime' );
<a name="l3769"><span class="linenum">3769</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_users CHANGE COLUMN user_profileupdate_ts user_profileupdate_date DATE NOT NULL DEFAULT '2000-01-01' COMMENT 'Last day when the user has updated some visible field in his profile.'&quot; );
<a name="l3770"><span class="linenum">3770</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3771"><span class="linenum">3771</span></a>  
<a name="l3772"><span class="linenum">3772</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating versions table...' );
<a name="l3773"><span class="linenum">3773</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__version', 'iver_ID', 'INT UNSIGNED NOT NULL FIRST' );
<a name="l3774"><span class="linenum">3774</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_items__version DROP INDEX iver_itm_ID, ADD INDEX iver_ID_itm_ID ( iver_ID , iver_itm_ID )' );
<a name="l3775"><span class="linenum">3775</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3776"><span class="linenum">3776</span></a>  
<a name="l3777"><span class="linenum">3777</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading messaging contact group users...' );
<a name="l3778"><span class="linenum">3778</span></a>          <a class="function" onClick="logFunction('db_add_foreign_key')" href="../../_functions/db_add_foreign_key.html" onMouseOver="funcPopup(event,'db_add_foreign_key')">db_add_foreign_key</a>( 'T_messaging__contact_groupusers', 'cgu_cgr_ID', 'T_messaging__contact_groups', 'cgr_ID', 'ON DELETE CASCADE' );
<a name="l3779"><span class="linenum">3779</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3780"><span class="linenum">3780</span></a>  
<a name="l3781"><span class="linenum">3781</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for a latest version of the POT file...' );
<a name="l3782"><span class="linenum">3782</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_i18n_original_string (
<a name="l3783"><span class="linenum">3783</span></a>              iost_ID        int(10) unsigned NOT NULL auto_increment,
<a name="l3784"><span class="linenum">3784</span></a>              iost_string    varchar(10000) NOT NULL default '',
<a name="l3785"><span class="linenum">3785</span></a>              iost_inpotfile tinyint(1) NOT NULL DEFAULT 0,
<a name="l3786"><span class="linenum">3786</span></a>              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (iost_ID)
<a name="l3787"><span class="linenum">3787</span></a>          ) ENGINE = innodb&quot; );
<a name="l3788"><span class="linenum">3788</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3789"><span class="linenum">3789</span></a>  
<a name="l3790"><span class="linenum">3790</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating table for a latest versions of the PO files...' );
<a name="l3791"><span class="linenum">3791</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_i18n_translated_string (
<a name="l3792"><span class="linenum">3792</span></a>              itst_ID       int(10) unsigned NOT NULL auto_increment,
<a name="l3793"><span class="linenum">3793</span></a>              itst_iost_ID  int(10) unsigned NOT NULL,
<a name="l3794"><span class="linenum">3794</span></a>              itst_locale   varchar(20) NOT NULL default '',
<a name="l3795"><span class="linenum">3795</span></a>              itst_standard varchar(10000) NOT NULL default '',
<a name="l3796"><span class="linenum">3796</span></a>              itst_custom   varchar(10000) NULL,
<a name="l3797"><span class="linenum">3797</span></a>              itst_inpofile tinyint(1) NOT NULL DEFAULT 0,
<a name="l3798"><span class="linenum">3798</span></a>              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (itst_ID)
<a name="l3799"><span class="linenum">3799</span></a>          ) ENGINE = innodb DEFAULT CHARSET = utf8&quot; );
<a name="l3800"><span class="linenum">3800</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3801"><span class="linenum">3801</span></a>  
<a name="l3802"><span class="linenum">3802</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating Antispam IP Ranges table...' );
<a name="l3803"><span class="linenum">3803</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_antispam__iprange', 'aipr_status', 'enum( \'trusted\', \'suspect\', \'blocked\' ) NULL DEFAULT NULL' );
<a name="l3804"><span class="linenum">3804</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_antispam__iprange', 'aipr_block_count', 'int(10) unsigned DEFAULT 0' );
<a name="l3805"><span class="linenum">3805</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_antispam__iprange CHANGE COLUMN aipr_user_count aipr_user_count int(10) unsigned DEFAULT 0&quot; );
<a name="l3806"><span class="linenum">3806</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3807"><span class="linenum">3807</span></a>  
<a name="l3808"><span class="linenum">3808</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10970' );
<a name="l3809"><span class="linenum">3809</span></a>      }
<a name="l3810"><span class="linenum">3810</span></a>  
<a name="l3811"><span class="linenum">3811</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 10975 )
<a name="l3812"><span class="linenum">3812</span></a>      {    // part 8/b trunk aka first part of &quot;i4&quot;
<a name="l3813"><span class="linenum">3813</span></a>  
<a name="l3814"><span class="linenum">3814</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating default antispam IP ranges... ' );
<a name="l3815"><span class="linenum">3815</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l3816"><span class="linenum">3816</span></a>              INSERT INTO T_antispam__iprange ( aipr_IPv4start, aipr_IPv4end, aipr_status )
<a name="l3817"><span class="linenum">3817</span></a>              VALUES ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '127.0.0.0' ) ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '127.0.0.255' ) ).', &quot;trusted&quot; ),
<a name="l3818"><span class="linenum">3818</span></a>                  ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '10.0.0.0' ) ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '10.255.255.255' ) ).', &quot;trusted&quot; ),
<a name="l3819"><span class="linenum">3819</span></a>                  ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '172.16.0.0' ) ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '172.31.255.255' ) ).', &quot;trusted&quot; ),
<a name="l3820"><span class="linenum">3820</span></a>                  ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '192.168.0.0' ) ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '192.168.255.255' ) ).', &quot;trusted&quot; )
<a name="l3821"><span class="linenum">3821</span></a>              ' );
<a name="l3822"><span class="linenum">3822</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3823"><span class="linenum">3823</span></a>  
<a name="l3824"><span class="linenum">3824</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '10975' );
<a name="l3825"><span class="linenum">3825</span></a>      }
<a name="l3826"><span class="linenum">3826</span></a>  
<a name="l3827"><span class="linenum">3827</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11000 )
<a name="l3828"><span class="linenum">3828</span></a>      {    // part 8/c trunk aka first part of &quot;i4&quot;
<a name="l3829"><span class="linenum">3829</span></a>  
<a name="l3830"><span class="linenum">3830</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding new countries...' );
<a name="l3831"><span class="linenum">3831</span></a>  <span class="comment">        // IGNORE is needed for upgrades from DB version 9970 or later</span>
<a name="l3832"><span class="linenum">3832</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT IGNORE INTO T_regional__country ( ctry_code, ctry_name, ctry_curr_ID ) VALUES ( \'ct\', \'Catalonia\', \'2\' )' );
<a name="l3833"><span class="linenum">3833</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3834"><span class="linenum">3834</span></a>  
<a name="l3835"><span class="linenum">3835</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading message thread statuses table...' );
<a name="l3836"><span class="linenum">3836</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_messaging__threadstatus', 'tsta_thread_leave_msg_ID', 'int(10) unsigned NULL DEFAULT NULL' );
<a name="l3837"><span class="linenum">3837</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3838"><span class="linenum">3838</span></a>  
<a name="l3839"><span class="linenum">3839</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Item Settings...' );
<a name="l3840"><span class="linenum">3840</span></a>  <span class="comment">        // Convert item custom fields to custom item settings ( move custom fields from T_items__item table to T_items__item_settings table )</span>
<a name="l3841"><span class="linenum">3841</span></a>          <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;INSERT INTO T_items__item_settings( iset_item_ID, iset_name, iset_value ) &quot;;
<a name="l3842"><span class="linenum">3842</span></a>          for( <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 1; <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> &lt;= 8; <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++ )
<a name="l3843"><span class="linenum">3843</span></a>          { // For each custom fields:
<a name="l3844"><span class="linenum">3844</span></a>              if( <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> &gt; 1 )
<a name="l3845"><span class="linenum">3845</span></a>              {
<a name="l3846"><span class="linenum">3846</span></a>                  <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> .= ' UNION';
<a name="l3847"><span class="linenum">3847</span></a>              }
<a name="l3848"><span class="linenum">3848</span></a>              <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a> = ( <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> &gt; 5 ) ? 'varchar'.( <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> - 5 ) : 'double'.<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>;
<a name="l3849"><span class="linenum">3849</span></a>              <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> .= &quot; SELECT post_ID, 'custom_&quot;.<a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>.&quot;', post_&quot;.<a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>.&quot;
<a name="l3850"><span class="linenum">3850</span></a>                              FROM T_items__item WHERE post_&quot;.<a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>.&quot; IS NOT NULL&quot;;
<a name="l3851"><span class="linenum">3851</span></a>          }
<a name="l3852"><span class="linenum">3852</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l3853"><span class="linenum">3853</span></a>  
<a name="l3854"><span class="linenum">3854</span></a>          for( <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 1; <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> &lt;= 5; <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++ )
<a name="l3855"><span class="linenum">3855</span></a>          { // drop custom double columns from items tabe
<a name="l3856"><span class="linenum">3856</span></a>              <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_double'.<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> );
<a name="l3857"><span class="linenum">3857</span></a>          }
<a name="l3858"><span class="linenum">3858</span></a>          for( <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> = 1; <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> &lt;= 3; <a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a>++ )
<a name="l3859"><span class="linenum">3859</span></a>          { // drop custom varchar columns from items tabe
<a name="l3860"><span class="linenum">3860</span></a>              <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_varchar'.<a class="var it52" onMouseOver="hilite(52)" onMouseOut="lolite()" onClick="logVariable('i')" href="../../_variables/i.html">$i</a> );
<a name="l3861"><span class="linenum">3861</span></a>          }
<a name="l3862"><span class="linenum">3862</span></a>  
<a name="l3863"><span class="linenum">3863</span></a>  <span class="comment">        // Convert post_editor_code item field to item settings</span>
<a name="l3864"><span class="linenum">3864</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_items__item_settings ( iset_item_ID, iset_name, iset_value )
<a name="l3865"><span class="linenum">3865</span></a>                          SELECT post_ID, &quot;editor_code&quot;, post_editor_code
<a name="l3866"><span class="linenum">3866</span></a>                              FROM T_items__item
<a name="l3867"><span class="linenum">3867</span></a>                              WHERE post_editor_code IS NOT NULL' );
<a name="l3868"><span class="linenum">3868</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_editor_code' );
<a name="l3869"><span class="linenum">3869</span></a>  
<a name="l3870"><span class="linenum">3870</span></a>  <span class="comment">        // Convert post_metadesc item field to item settings</span>
<a name="l3871"><span class="linenum">3871</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_items__item_settings ( iset_item_ID, iset_name, iset_value )
<a name="l3872"><span class="linenum">3872</span></a>                          SELECT post_ID, &quot;post_metadesc&quot;, post_metadesc
<a name="l3873"><span class="linenum">3873</span></a>                              FROM T_items__item
<a name="l3874"><span class="linenum">3874</span></a>                              WHERE post_metadesc IS NOT NULL' );
<a name="l3875"><span class="linenum">3875</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_metadesc' );
<a name="l3876"><span class="linenum">3876</span></a>  
<a name="l3877"><span class="linenum">3877</span></a>  <span class="comment">        // Convert and rename post_metakeywords item field to post_custom_headers item settings</span>
<a name="l3878"><span class="linenum">3878</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_items__item_settings ( iset_item_ID, iset_name, iset_value )
<a name="l3879"><span class="linenum">3879</span></a>                          SELECT post_ID, &quot;post_custom_headers&quot;, post_metakeywords
<a name="l3880"><span class="linenum">3880</span></a>                              FROM T_items__item
<a name="l3881"><span class="linenum">3881</span></a>                              WHERE post_metakeywords IS NOT NULL' );
<a name="l3882"><span class="linenum">3882</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_metakeywords' );
<a name="l3883"><span class="linenum">3883</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3884"><span class="linenum">3884</span></a>  
<a name="l3885"><span class="linenum">3885</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading items table...' );
<a name="l3886"><span class="linenum">3886</span></a>  <span class="comment">        // Drop not used column</span>
<a name="l3887"><span class="linenum">3887</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_commentsexpire' );
<a name="l3888"><span class="linenum">3888</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3889"><span class="linenum">3889</span></a>  
<a name="l3890"><span class="linenum">3890</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Adding new video file types...' );
<a name="l3891"><span class="linenum">3891</span></a>          <a class="var it6032" onMouseOver="hilite(6032)" onMouseOut="lolite()" onClick="logVariable('ftyp')" href="../../_variables/ftyp.html">$ftyp</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>('SELECT ftyp_ID, ftyp_extensions
<a name="l3892"><span class="linenum">3892</span></a>                                      FROM T_filetypes
<a name="l3893"><span class="linenum">3893</span></a>                                      WHERE ftyp_mimetype = &quot;video/mp4&quot;
<a name="l3894"><span class="linenum">3894</span></a>                                      AND ftyp_extensions NOT LIKE &quot;%f4v%&quot;
<a name="l3895"><span class="linenum">3895</span></a>                                      LIMIT 1');
<a name="l3896"><span class="linenum">3896</span></a>  
<a name="l3897"><span class="linenum">3897</span></a>          if( <a class="var it6032" onMouseOver="hilite(6032)" onMouseOut="lolite()" onClick="logVariable('ftyp')" href="../../_variables/ftyp.html">$ftyp</a> )
<a name="l3898"><span class="linenum">3898</span></a>          {    // Add f4v extension to mp4 file type, if not exists
<a name="l3899"><span class="linenum">3899</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_filetypes SET ftyp_extensions = &quot;'.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('escape')" href="../../_functions/escape.html" onMouseOver="funcPopup(event,'escape')">escape</a>(<a class="var it6032" onMouseOver="hilite(6032)" onMouseOut="lolite()" onClick="logVariable('ftyp')" href="../../_variables/ftyp.html">$ftyp</a>-&gt;<a onClick="logVariable('ftyp_extensions')" class="var it9081" onMouseOver="hilite(9081)" onMouseOut="lolite()" href="../../_variables/ftyp_extensions.html">ftyp_extensions</a>.' f4v').'&quot;
<a name="l3900"><span class="linenum">3900</span></a>                              WHERE ftyp_ID = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it6032" onMouseOver="hilite(6032)" onMouseOut="lolite()" onClick="logVariable('ftyp')" href="../../_variables/ftyp.html">$ftyp</a>-&gt;<a onClick="logVariable('ftyp_ID')" class="var it9081" onMouseOver="hilite(9081)" onMouseOut="lolite()" href="../../_variables/ftyp_ID.html">ftyp_ID</a>) );
<a name="l3901"><span class="linenum">3901</span></a>          }
<a name="l3902"><span class="linenum">3902</span></a>  <span class="comment">        // Add flv file type if not exists</span>
<a name="l3903"><span class="linenum">3903</span></a>          if( !<a class="function" onClick="logFunction('db_key_exists')" href="../../_functions/db_key_exists.html" onMouseOver="funcPopup(event,'db_key_exists')">db_key_exists</a>( 'T_filetypes', 'ftyp_extensions', '&quot;flv&quot;' ) )
<a name="l3904"><span class="linenum">3904</span></a>          {
<a name="l3905"><span class="linenum">3905</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_filetypes (ftyp_extensions, ftyp_name, ftyp_mimetype, ftyp_icon, ftyp_viewtype, ftyp_allowed)
<a name="l3906"><span class="linenum">3906</span></a>                               VALUES (&quot;flv&quot;, &quot;Flash video file&quot;, &quot;video/x-flv&quot;, &quot;&quot;, &quot;browser&quot;, &quot;registered&quot;)', 'Add &quot;flv&quot; file type' );
<a name="l3907"><span class="linenum">3907</span></a>          }
<a name="l3908"><span class="linenum">3908</span></a>  <span class="comment">        // Add swf file type if not exists</span>
<a name="l3909"><span class="linenum">3909</span></a>          if( !<a class="function" onClick="logFunction('db_key_exists')" href="../../_functions/db_key_exists.html" onMouseOver="funcPopup(event,'db_key_exists')">db_key_exists</a>( 'T_filetypes', 'ftyp_extensions', '&quot;swf&quot;' ) )
<a name="l3910"><span class="linenum">3910</span></a>          {
<a name="l3911"><span class="linenum">3911</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_filetypes (ftyp_extensions, ftyp_name, ftyp_mimetype, ftyp_icon, ftyp_viewtype, ftyp_allowed)
<a name="l3912"><span class="linenum">3912</span></a>                               VALUES (&quot;swf&quot;, &quot;Flash video file&quot;, &quot;application/x-shockwave-flash&quot;, &quot;&quot;, &quot;browser&quot;, &quot;registered&quot;)', 'Add &quot;swf&quot; file type' );
<a name="l3913"><span class="linenum">3913</span></a>          }
<a name="l3914"><span class="linenum">3914</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l3915"><span class="linenum">3915</span></a>  
<a name="l3916"><span class="linenum">3916</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading custom item settings...' );
<a name="l3917"><span class="linenum">3917</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l3918"><span class="linenum">3918</span></a>  <span class="comment">        // Convert latitude and longitude from custom setting to normal item settings</span>
<a name="l3919"><span class="linenum">3919</span></a>  <span class="comment">        // Get those blog ids where Latitude and Longitude are both set</span>
<a name="l3920"><span class="linenum">3920</span></a>          <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( 'SELECT cs_left.cset_coll_ID
<a name="l3921"><span class="linenum">3921</span></a>                                      FROM T_coll_settings as cs_left
<a name="l3922"><span class="linenum">3922</span></a>                                      INNER JOIN T_coll_settings as cs_right ON cs_left.cset_coll_ID = cs_right.cset_coll_ID
<a name="l3923"><span class="linenum">3923</span></a>                                      WHERE cs_left.cset_name = &quot;custom_double3&quot; AND cs_left.cset_value = &quot;Latitude&quot; AND
<a name="l3924"><span class="linenum">3924</span></a>                                          cs_right.cset_name = &quot;custom_double4&quot; AND cs_right.cset_value = &quot;Longitude&quot;' );
<a name="l3925"><span class="linenum">3925</span></a>          if( <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> )
<a name="l3926"><span class="linenum">3926</span></a>          { // blogs were found where Latitude and Longitude custom fields were set for google maps plugin
<a name="l3927"><span class="linenum">3927</span></a>  <span class="comment">            // Set &quot;Show location coordinates&quot; on where Latitude and Longitude were set</span>
<a name="l3928"><span class="linenum">3928</span></a>              <a class="var it4905" onMouseOver="hilite(4905)" onMouseOut="lolite()" onClick="logVariable('query_values')" href="../../_variables/query_values.html">$query_values</a> = '( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', &quot;show_location_coordinates&quot;, 1 ), ( ', <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> ).', &quot;show_location_coordinates&quot;, 1 )';
<a name="l3929"><span class="linenum">3929</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l3930"><span class="linenum">3930</span></a>                              VALUES '.<a class="var it4905" onMouseOver="hilite(4905)" onMouseOut="lolite()" onClick="logVariable('query_values')" href="../../_variables/query_values.html">$query_values</a> );
<a name="l3931"><span class="linenum">3931</span></a>  
<a name="l3932"><span class="linenum">3932</span></a>              <a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('coll_ids')" href="../../_variables/coll_ids.html">$coll_ids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> );
<a name="l3933"><span class="linenum">3933</span></a>  <span class="comment">            // Update latitude Item settings</span>
<a name="l3934"><span class="linenum">3934</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item_settings SET iset_name = &quot;latitude&quot;
<a name="l3935"><span class="linenum">3935</span></a>                              WHERE iset_name = &quot;custom_double3&quot; AND iset_item_ID IN (
<a name="l3936"><span class="linenum">3936</span></a>                                  SELECT post_ID FROM T_items__item
<a name="l3937"><span class="linenum">3937</span></a>                                  INNER JOIN T_categories ON post_main_cat_ID = cat_ID
<a name="l3938"><span class="linenum">3938</span></a>                                  WHERE cat_blog_ID IN ( '.<a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('coll_ids')" href="../../_variables/coll_ids.html">$coll_ids</a>.' )
<a name="l3939"><span class="linenum">3939</span></a>                              )' );
<a name="l3940"><span class="linenum">3940</span></a>  <span class="comment">            // Update longitude Item settings</span>
<a name="l3941"><span class="linenum">3941</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item_settings SET iset_name = &quot;longitude&quot;
<a name="l3942"><span class="linenum">3942</span></a>                              WHERE iset_name = &quot;custom_double4&quot; AND iset_item_ID IN (
<a name="l3943"><span class="linenum">3943</span></a>                                  SELECT post_ID FROM T_items__item
<a name="l3944"><span class="linenum">3944</span></a>                                  INNER JOIN T_categories ON post_main_cat_ID = cat_ID
<a name="l3945"><span class="linenum">3945</span></a>                                  WHERE cat_blog_ID IN ( '.<a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('coll_ids')" href="../../_variables/coll_ids.html">$coll_ids</a>.' )
<a name="l3946"><span class="linenum">3946</span></a>                              )' );
<a name="l3947"><span class="linenum">3947</span></a>  <span class="comment">            // Delete proessed latitude &amp; longitude custom fields from collection settings</span>
<a name="l3948"><span class="linenum">3948</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_coll_settings
<a name="l3949"><span class="linenum">3949</span></a>                          <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> ( cset_name = &quot;custom_double3&quot; OR cset_name = &quot;custom_double4&quot; ) AND
<a name="l3950"><span class="linenum">3950</span></a>                              cset_coll_ID IN ( '.<a class="var it6035" onMouseOver="hilite(6035)" onMouseOut="lolite()" onClick="logVariable('coll_ids')" href="../../_variables/coll_ids.html">$coll_ids</a>.' )' );
<a name="l3951"><span class="linenum">3951</span></a>          }
<a name="l3952"><span class="linenum">3952</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>(); <span class="comment">// End convert latitude and longitude</span>
<a name="l3953"><span class="linenum">3953</span></a>  
<a name="l3954"><span class="linenum">3954</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>(); <span class="comment">// Convert custom fields</span>
<a name="l3955"><span class="linenum">3955</span></a>  <span class="comment">        // Delete not used custom fields</span>
<a name="l3956"><span class="linenum">3956</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_coll_settings <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> ( cset_value IS NULL OR cset_value = &quot;&quot; ) AND cset_name LIKE &quot;custom\_%&quot;' );
<a name="l3957"><span class="linenum">3957</span></a>  <span class="comment">        // Set custom double fields count</span>
<a name="l3958"><span class="linenum">3958</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l3959"><span class="linenum">3959</span></a>                          SELECT cset_coll_ID, &quot;count_custom_double&quot;, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( cset_name )
<a name="l3960"><span class="linenum">3960</span></a>                          FROM T_coll_settings
<a name="l3961"><span class="linenum">3961</span></a>                          WHERE cset_name LIKE &quot;custom\_double%&quot;
<a name="l3962"><span class="linenum">3962</span></a>                          GROUP BY cset_coll_ID' );
<a name="l3963"><span class="linenum">3963</span></a>  <span class="comment">        // Set custom varchar fields count</span>
<a name="l3964"><span class="linenum">3964</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l3965"><span class="linenum">3965</span></a>                          SELECT cset_coll_ID, &quot;count_custom_varchar&quot;, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( cset_name )
<a name="l3966"><span class="linenum">3966</span></a>                          FROM T_coll_settings
<a name="l3967"><span class="linenum">3967</span></a>                          WHERE cset_name LIKE &quot;custom\_varchar%&quot;
<a name="l3968"><span class="linenum">3968</span></a>                          GROUP BY cset_coll_ID' );
<a name="l3969"><span class="linenum">3969</span></a>  <span class="comment">        // Select all custom fields from all blog, to create converted field values</span>
<a name="l3970"><span class="linenum">3970</span></a>          <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( 'SELECT cset_coll_ID as coll_ID, cset_name as name, cset_value as value
<a name="l3971"><span class="linenum">3971</span></a>                                          FROM T_coll_settings
<a name="l3972"><span class="linenum">3972</span></a>                                          WHERE cset_name LIKE &quot;custom\_%&quot;
<a name="l3973"><span class="linenum">3973</span></a>                                          ORDER BY cset_coll_ID, cset_name' );
<a name="l3974"><span class="linenum">3974</span></a>          if( !empty( <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> ) )
<a name="l3975"><span class="linenum">3975</span></a>          { // There are custom fields in blog settings
<a name="l3976"><span class="linenum">3976</span></a>              <a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('convert_field_values')" href="../../_variables/convert_field_values.html">$convert_field_values</a> = '';
<a name="l3977"><span class="linenum">3977</span></a>              <a class="var it6037" onMouseOver="hilite(6037)" onMouseOut="lolite()" onClick="logVariable('reorder_field_values')" href="../../_variables/reorder_field_values.html">$reorder_field_values</a> = '';
<a name="l3978"><span class="linenum">3978</span></a>              <a class="var it6038" onMouseOver="hilite(6038)" onMouseOut="lolite()" onClick="logVariable('old_prefix')" href="../../_variables/old_prefix.html">$old_prefix</a> = &quot;&quot;;
<a name="l3979"><span class="linenum">3979</span></a>              <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('old_coll_ID')" href="../../_variables/old_coll_ID.html">$old_coll_ID</a> = &quot;&quot;;
<a name="l3980"><span class="linenum">3980</span></a>              foreach( <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l3981"><span class="linenum">3981</span></a>              { // process each custom field
<a name="l3982"><span class="linenum">3982</span></a>                  <a class="var it6040" onMouseOver="hilite(6040)" onMouseOut="lolite()" onClick="logVariable('custom_id')" href="../../_variables/custom_id.html">$custom_id</a> = <a class="phpfunction" onClick="logFunction('uniqid')" href="../../_functions/uniqid.html" onMouseOver="phpfuncPopup(event,'uniqid')">uniqid</a>( '' );
<a name="l3983"><span class="linenum">3983</span></a>                  <a class="var it1100" onMouseOver="hilite(1100)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a> = ( <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('name')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>, 7, 6 ) === 'double' ) ? 'custom_double' : 'custom_varchar';
<a name="l3984"><span class="linenum">3984</span></a>  <span class="comment">                // replace custom_double{N} and custom_varchar{N} values with a custom_id where N is number</span>
<a name="l3985"><span class="linenum">3985</span></a>                  <a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('convert_field_values')" href="../../_variables/convert_field_values.html">$convert_field_values</a> .= '( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('coll_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/coll_ID.html">coll_ID</a>.', &quot;'.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('name')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/name.html">name</a>.'&quot;, &quot;'.<a class="var it6040" onMouseOver="hilite(6040)" onMouseOut="lolite()" onClick="logVariable('custom_id')" href="../../_variables/custom_id.html">$custom_id</a>.'&quot; ), ';
<a name="l3986"><span class="linenum">3986</span></a>  <span class="comment">                // add new custom_double_{customid} and custom_varchar_{customid} entries with the old correspinding custom field values</span>
<a name="l3987"><span class="linenum">3987</span></a>                  <a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('convert_field_values')" href="../../_variables/convert_field_values.html">$convert_field_values</a> .= '( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('coll_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/coll_ID.html">coll_ID</a>.', &quot;'.<a class="var it1100" onMouseOver="hilite(1100)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>.'_'.<a class="var it6040" onMouseOver="hilite(6040)" onMouseOut="lolite()" onClick="logVariable('custom_id')" href="../../_variables/custom_id.html">$custom_id</a>.'&quot;, &quot;'.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('value')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/value.html">value</a>.'&quot; ), ';
<a name="l3988"><span class="linenum">3988</span></a>  
<a name="l3989"><span class="linenum">3989</span></a>  <span class="comment">                // create reorder values to replace e.g. custom_double2 to custom_double1 if custom_double1 doesn't exists yet</span>
<a name="l3990"><span class="linenum">3990</span></a>                  <a class="var it1297" onMouseOver="hilite(1297)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> = ( ( <a class="var it6038" onMouseOver="hilite(6038)" onMouseOut="lolite()" onClick="logVariable('old_prefix')" href="../../_variables/old_prefix.html">$old_prefix</a> == <a class="var it1100" onMouseOver="hilite(1100)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a> ) &amp;&amp; ( <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('old_coll_ID')" href="../../_variables/old_coll_ID.html">$old_coll_ID</a> == <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('coll_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/coll_ID.html">coll_ID</a> ) ) ? <a class="var it1297" onMouseOver="hilite(1297)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a> + 1 : 1;
<a name="l3991"><span class="linenum">3991</span></a>                  <a class="var it6037" onMouseOver="hilite(6037)" onMouseOut="lolite()" onClick="logVariable('reorder_field_values')" href="../../_variables/reorder_field_values.html">$reorder_field_values</a> .= '( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('coll_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/coll_ID.html">coll_ID</a>.', &quot;'.<a class="var it1100" onMouseOver="hilite(1100)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>.<a class="var it1297" onMouseOver="hilite(1297)" onMouseOut="lolite()" onClick="logVariable('index')" href="../../_variables/index.html">$index</a>.'&quot;, &quot;'.<a class="var it6040" onMouseOver="hilite(6040)" onMouseOut="lolite()" onClick="logVariable('custom_id')" href="../../_variables/custom_id.html">$custom_id</a>.'&quot; ), ';
<a name="l3992"><span class="linenum">3992</span></a>                  <a class="var it6038" onMouseOver="hilite(6038)" onMouseOut="lolite()" onClick="logVariable('old_prefix')" href="../../_variables/old_prefix.html">$old_prefix</a> = <a class="var it1100" onMouseOver="hilite(1100)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../_variables/prefix.html">$prefix</a>;
<a name="l3993"><span class="linenum">3993</span></a>                  <a class="var it6039" onMouseOver="hilite(6039)" onMouseOut="lolite()" onClick="logVariable('old_coll_ID')" href="../../_variables/old_coll_ID.html">$old_coll_ID</a> = <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('coll_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/coll_ID.html">coll_ID</a>;
<a name="l3994"><span class="linenum">3994</span></a>              }
<a name="l3995"><span class="linenum">3995</span></a>              <a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('convert_field_values')" href="../../_variables/convert_field_values.html">$convert_field_values</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('convert_field_values')" href="../../_variables/convert_field_values.html">$convert_field_values</a>, 0, -2 );
<a name="l3996"><span class="linenum">3996</span></a>              <a class="var it6037" onMouseOver="hilite(6037)" onMouseOut="lolite()" onClick="logVariable('reorder_field_values')" href="../../_variables/reorder_field_values.html">$reorder_field_values</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it6037" onMouseOver="hilite(6037)" onMouseOut="lolite()" onClick="logVariable('reorder_field_values')" href="../../_variables/reorder_field_values.html">$reorder_field_values</a>, 0, -2 );
<a name="l3997"><span class="linenum">3997</span></a>  <span class="comment">            // Convert custom fields in collection setting</span>
<a name="l3998"><span class="linenum">3998</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l3999"><span class="linenum">3999</span></a>                              VALUES '.<a class="var it6036" onMouseOver="hilite(6036)" onMouseOut="lolite()" onClick="logVariable('convert_field_values')" href="../../_variables/convert_field_values.html">$convert_field_values</a> );
<a name="l4000"><span class="linenum">4000</span></a>  <span class="comment">            // Update double custom field name_ids in item settings table</span>
<a name="l4001"><span class="linenum">4001</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item_settings SET iset_name = (
<a name="l4002"><span class="linenum">4002</span></a>                                  SELECT CONCAT( &quot;custom_double_&quot;, cset_value ) FROM T_coll_settings
<a name="l4003"><span class="linenum">4003</span></a>                                      INNER JOIN T_categories ON cset_coll_ID = cat_blog_ID
<a name="l4004"><span class="linenum">4004</span></a>                                      INNER JOIN T_items__item ON cat_ID = post_main_cat_ID
<a name="l4005"><span class="linenum">4005</span></a>                                      WHERE cset_name = iset_name AND post_ID  = iset_item_ID )
<a name="l4006"><span class="linenum">4006</span></a>                              WHERE iset_name LIKE &quot;custom\_double%&quot;' );
<a name="l4007"><span class="linenum">4007</span></a>  <span class="comment">            // Update varchar custom field name_ids in item settings table</span>
<a name="l4008"><span class="linenum">4008</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item_settings SET iset_name = (
<a name="l4009"><span class="linenum">4009</span></a>                                  SELECT CONCAT( &quot;custom_varchar_&quot;, cset_value ) FROM T_coll_settings
<a name="l4010"><span class="linenum">4010</span></a>                                      INNER JOIN T_categories ON cset_coll_ID = cat_blog_ID
<a name="l4011"><span class="linenum">4011</span></a>                                      INNER JOIN T_items__item ON cat_ID = post_main_cat_ID
<a name="l4012"><span class="linenum">4012</span></a>                                      WHERE cset_name = iset_name AND post_ID  = iset_item_ID )
<a name="l4013"><span class="linenum">4013</span></a>                              WHERE iset_name LIKE &quot;custom\_varchar%&quot;' );
<a name="l4014"><span class="linenum">4014</span></a>  <span class="comment">            // Reorder custom fields in collection settings</span>
<a name="l4015"><span class="linenum">4015</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l4016"><span class="linenum">4016</span></a>                              VALUES '.<a class="var it6037" onMouseOver="hilite(6037)" onMouseOut="lolite()" onClick="logVariable('reorder_field_values')" href="../../_variables/reorder_field_values.html">$reorder_field_values</a> );
<a name="l4017"><span class="linenum">4017</span></a>          }
<a name="l4018"><span class="linenum">4018</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>(); <span class="comment">// End convert custom fields</span>
<a name="l4019"><span class="linenum">4019</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4020"><span class="linenum">4020</span></a>  
<a name="l4021"><span class="linenum">4021</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Convert group users permissions to pluggable permissions...' );
<a name="l4022"><span class="linenum">4022</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_groups__groupsettings( gset_grp_ID, gset_name, gset_value )
<a name="l4023"><span class="linenum">4023</span></a>                          SELECT grp_ID, &quot;perm_users&quot;, grp_perm_users
<a name="l4024"><span class="linenum">4024</span></a>                              FROM T_groups' );
<a name="l4025"><span class="linenum">4025</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_groups', 'grp_perm_users' );
<a name="l4026"><span class="linenum">4026</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4027"><span class="linenum">4027</span></a>  
<a name="l4028"><span class="linenum">4028</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Update Post Types... ' );
<a name="l4029"><span class="linenum">4029</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;REPLACE INTO T_items__type ( ptyp_ID, ptyp_name )
<a name="l4030"><span class="linenum">4030</span></a>              VALUES ( 4000, 'Advertisement' )&quot; );
<a name="l4031"><span class="linenum">4031</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4032"><span class="linenum">4032</span></a>  
<a name="l4033"><span class="linenum">4033</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Update files table... ' );
<a name="l4034"><span class="linenum">4034</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_files', 'file_hash', 'char(32) default NULL' );
<a name="l4035"><span class="linenum">4035</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4036"><span class="linenum">4036</span></a>  
<a name="l4037"><span class="linenum">4037</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for files voting...' );
<a name="l4038"><span class="linenum">4038</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'files__vote (
<a name="l4039"><span class="linenum">4039</span></a>                  fvot_file_ID       int(11) UNSIGNED NOT NULL,
<a name="l4040"><span class="linenum">4040</span></a>                  fvot_user_ID       int(11) UNSIGNED NOT NULL,
<a name="l4041"><span class="linenum">4041</span></a>                  fvot_like          tinyint(1),
<a name="l4042"><span class="linenum">4042</span></a>                  fvot_inappropriate tinyint(1),
<a name="l4043"><span class="linenum">4043</span></a>                  fvot_spam          tinyint(1),
<a name="l4044"><span class="linenum">4044</span></a>                  primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (fvot_file_ID, fvot_user_ID)
<a name="l4045"><span class="linenum">4045</span></a>              ) ENGINE = innodb' );
<a name="l4046"><span class="linenum">4046</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4047"><span class="linenum">4047</span></a>  
<a name="l4048"><span class="linenum">4048</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for users reporting...' );
<a name="l4049"><span class="linenum">4049</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_users__reports (
<a name="l4050"><span class="linenum">4050</span></a>              urep_target_user_ID int(11) unsigned NOT NULL,
<a name="l4051"><span class="linenum">4051</span></a>              urep_reporter_ID    int(11) unsigned NOT NULL,
<a name="l4052"><span class="linenum">4052</span></a>              urep_status         enum( 'fake', 'guidelines', 'harass', 'spam', 'other' ),
<a name="l4053"><span class="linenum">4053</span></a>              urep_info           varchar(240),
<a name="l4054"><span class="linenum">4054</span></a>              urep_datetime        datetime NOT NULL,
<a name="l4055"><span class="linenum">4055</span></a>              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> ( urep_target_user_ID, urep_reporter_ID )
<a name="l4056"><span class="linenum">4056</span></a>          ) ENGINE = innodb&quot; );
<a name="l4057"><span class="linenum">4057</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4058"><span class="linenum">4058</span></a>  
<a name="l4059"><span class="linenum">4059</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading skins type...' );
<a name="l4060"><span class="linenum">4060</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_skins__skin MODIFY COLUMN skin_type enum('normal','feed','sitemap','mobile','tablet') NOT NULL default 'normal'&quot; );
<a name="l4061"><span class="linenum">4061</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4062"><span class="linenum">4062</span></a>  
<a name="l4063"><span class="linenum">4063</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blogs skins...' );
<a name="l4064"><span class="linenum">4064</span></a>  <span class="comment">        // Convert blog skin ID to blog settings</span>
<a name="l4065"><span class="linenum">4065</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l4066"><span class="linenum">4066</span></a>                          SELECT blog_ID, &quot;normal_skin_ID&quot;, blog_skin_ID
<a name="l4067"><span class="linenum">4067</span></a>                          FROM T_blogs' );
<a name="l4068"><span class="linenum">4068</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_blogs', 'blog_skin_ID' );
<a name="l4069"><span class="linenum">4069</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4070"><span class="linenum">4070</span></a>  
<a name="l4071"><span class="linenum">4071</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Update categories table... ' );
<a name="l4072"><span class="linenum">4072</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_categories', 'cat_meta', 'tinyint(1) NOT NULL DEFAULT 0' );
<a name="l4073"><span class="linenum">4073</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_categories', 'cat_lock', 'tinyint(1) NOT NULL DEFAULT 0' );
<a name="l4074"><span class="linenum">4074</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4075"><span class="linenum">4075</span></a>  
<a name="l4076"><span class="linenum">4076</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Plugin settings update...' );
<a name="l4077"><span class="linenum">4077</span></a>          <a class="var it6041" onMouseOver="hilite(6041)" onMouseOut="lolite()" onClick="logVariable('all_blog_ids')" href="../../_variables/all_blog_ids.html">$all_blog_ids</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( 'SELECT blog_ID FROM T_blogs' );
<a name="l4078"><span class="linenum">4078</span></a>          <a class="var it6042" onMouseOver="hilite(6042)" onMouseOut="lolite()" onClick="logVariable('plugin_ids')" href="../../_variables/plugin_ids.html">$plugin_ids</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( 'SELECT pset_plug_ID, pset_value FROM T_pluginsettings WHERE pset_name = &quot;render_comments&quot;' );
<a name="l4079"><span class="linenum">4079</span></a>          <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> = '';
<a name="l4080"><span class="linenum">4080</span></a>          foreach( <a class="var it6041" onMouseOver="hilite(6041)" onMouseOut="lolite()" onClick="logVariable('all_blog_ids')" href="../../_variables/all_blog_ids.html">$all_blog_ids</a> as <a class="var it326" onMouseOver="hilite(326)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../_variables/blog_ID.html">$blog_ID</a> )
<a name="l4081"><span class="linenum">4081</span></a>          {
<a name="l4082"><span class="linenum">4082</span></a>              foreach( <a class="var it6042" onMouseOver="hilite(6042)" onMouseOut="lolite()" onClick="logVariable('plugin_ids')" href="../../_variables/plugin_ids.html">$plugin_ids</a> as <a class="var it2372" onMouseOver="hilite(2372)" onMouseOut="lolite()" onClick="logVariable('plugin_ID')" href="../../_variables/plugin_ID.html">$plugin_ID</a> =&gt; <a class="var it4389" onMouseOver="hilite(4389)" onMouseOut="lolite()" onClick="logVariable('setting_value')" href="../../_variables/setting_value.html">$setting_value</a> )
<a name="l4083"><span class="linenum">4083</span></a>              {
<a name="l4084"><span class="linenum">4084</span></a>                  <a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('apply_comment_rendering')" href="../../_variables/apply_comment_rendering.html">$apply_comment_rendering</a> = <a class="var it4389" onMouseOver="hilite(4389)" onMouseOut="lolite()" onClick="logVariable('setting_value')" href="../../_variables/setting_value.html">$setting_value</a> ? 'stealth' : 'never';
<a name="l4085"><span class="linenum">4085</span></a>                  <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> .= '( '.<a class="var it326" onMouseOver="hilite(326)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../_variables/blog_ID.html">$blog_ID</a>.', &quot;plugin'.<a class="var it2372" onMouseOver="hilite(2372)" onMouseOut="lolite()" onClick="logVariable('plugin_ID')" href="../../_variables/plugin_ID.html">$plugin_ID</a>.'_coll_apply_comment_rendering&quot;, &quot;'.<a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('apply_comment_rendering')" href="../../_variables/apply_comment_rendering.html">$apply_comment_rendering</a>.'&quot; ),';
<a name="l4086"><span class="linenum">4086</span></a>              }
<a name="l4087"><span class="linenum">4087</span></a>          }
<a name="l4088"><span class="linenum">4088</span></a>          if( !empty( <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> ) )
<a name="l4089"><span class="linenum">4089</span></a>          {
<a name="l4090"><span class="linenum">4090</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l4091"><span class="linenum">4091</span></a>                          VALUES '.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a>, 0, strlen( <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> ) - 1 ) );
<a name="l4092"><span class="linenum">4092</span></a>          }
<a name="l4093"><span class="linenum">4093</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_pluginsettings WHERE pset_name = &quot;render_comments&quot;' );
<a name="l4094"><span class="linenum">4094</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4095"><span class="linenum">4095</span></a>  
<a name="l4096"><span class="linenum">4096</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating comment prerendering cache table...' );
<a name="l4097"><span class="linenum">4097</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;CREATE TABLE T_comments__prerendering (
<a name="l4098"><span class="linenum">4098</span></a>              cmpr_cmt_ID INT(11) UNSIGNED NOT NULL,
<a name="l4099"><span class="linenum">4099</span></a>              cmpr_format ENUM('htmlbody','entityencoded','xml','text') NOT NULL,
<a name="l4100"><span class="linenum">4100</span></a>              cmpr_renderers TEXT NOT NULL,
<a name="l4101"><span class="linenum">4101</span></a>              cmpr_content_prerendered MEDIUMTEXT NULL,
<a name="l4102"><span class="linenum">4102</span></a>              cmpr_datemodified TIMESTAMP NOT NULL,
<a name="l4103"><span class="linenum">4103</span></a>              PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (cmpr_cmt_ID, cmpr_format)
<a name="l4104"><span class="linenum">4104</span></a>          ) ENGINE = innodb&quot; );
<a name="l4105"><span class="linenum">4105</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_comments', 'comment_renderers', &quot;TEXT NOT NULL AFTER comment_content&quot; );
<a name="l4106"><span class="linenum">4106</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments SET comment_renderers = &quot;default&quot;' );
<a name="l4107"><span class="linenum">4107</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4108"><span class="linenum">4108</span></a>  
<a name="l4109"><span class="linenum">4109</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading plugins table...' );
<a name="l4110"><span class="linenum">4110</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_plugins', 'plug_apply_rendering' );
<a name="l4111"><span class="linenum">4111</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4112"><span class="linenum">4112</span></a>  
<a name="l4113"><span class="linenum">4113</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Auto_P plugin...' );
<a name="l4114"><span class="linenum">4114</span></a>          <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('blog_settings')" href="../../_variables/blog_settings.html">$blog_settings</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( 'SELECT cset_coll_ID, cset_value FROM T_coll_settings WHERE cset_name = &quot;comment_autobr&quot;' );
<a name="l4115"><span class="linenum">4115</span></a>          <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> = array();
<a name="l4116"><span class="linenum">4116</span></a>          <a class="var it6042" onMouseOver="hilite(6042)" onMouseOut="lolite()" onClick="logVariable('plugin_ids')" href="../../_variables/plugin_ids.html">$plugin_ids</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( 'SELECT plug_ID FROM T_plugins WHERE plug_code = &quot;b2WPAutP&quot;' );
<a name="l4117"><span class="linenum">4117</span></a>          foreach( <a class="var it6044" onMouseOver="hilite(6044)" onMouseOut="lolite()" onClick="logVariable('blog_settings')" href="../../_variables/blog_settings.html">$blog_settings</a> as <a class="var it326" onMouseOver="hilite(326)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../_variables/blog_ID.html">$blog_ID</a> =&gt; <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('blog_setting_value')" href="../../_variables/blog_setting_value.html">$blog_setting_value</a> )
<a name="l4118"><span class="linenum">4118</span></a>          {
<a name="l4119"><span class="linenum">4119</span></a>              foreach( <a class="var it6042" onMouseOver="hilite(6042)" onMouseOut="lolite()" onClick="logVariable('plugin_ids')" href="../../_variables/plugin_ids.html">$plugin_ids</a> as <a class="var it2372" onMouseOver="hilite(2372)" onMouseOut="lolite()" onClick="logVariable('plugin_ID')" href="../../_variables/plugin_ID.html">$plugin_ID</a> )
<a name="l4120"><span class="linenum">4120</span></a>              {
<a name="l4121"><span class="linenum">4121</span></a>                  switch( <a class="var it6045" onMouseOver="hilite(6045)" onMouseOut="lolite()" onClick="logVariable('blog_setting_value')" href="../../_variables/blog_setting_value.html">$blog_setting_value</a> )
<a name="l4122"><span class="linenum">4122</span></a>                  {
<a name="l4123"><span class="linenum">4123</span></a>                      case 'never':
<a name="l4124"><span class="linenum">4124</span></a>                          <a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('apply_comment_rendering')" href="../../_variables/apply_comment_rendering.html">$apply_comment_rendering</a> = 'never';
<a name="l4125"><span class="linenum">4125</span></a>                          break;
<a name="l4126"><span class="linenum">4126</span></a>                      case 'optional':
<a name="l4127"><span class="linenum">4127</span></a>                          <a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('apply_comment_rendering')" href="../../_variables/apply_comment_rendering.html">$apply_comment_rendering</a> = 'opt-out';
<a name="l4128"><span class="linenum">4128</span></a>                          break;
<a name="l4129"><span class="linenum">4129</span></a>                      case 'always':
<a name="l4130"><span class="linenum">4130</span></a>                          <a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('apply_comment_rendering')" href="../../_variables/apply_comment_rendering.html">$apply_comment_rendering</a> = 'stealth';
<a name="l4131"><span class="linenum">4131</span></a>                          break;
<a name="l4132"><span class="linenum">4132</span></a>                      default:
<a name="l4133"><span class="linenum">4133</span></a>                          break 2;
<a name="l4134"><span class="linenum">4134</span></a>                  }
<a name="l4135"><span class="linenum">4135</span></a>                  <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a>[] = '( '.<a class="var it326" onMouseOver="hilite(326)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../_variables/blog_ID.html">$blog_ID</a>.', &quot;plugin'.<a class="var it2372" onMouseOver="hilite(2372)" onMouseOut="lolite()" onClick="logVariable('plugin_ID')" href="../../_variables/plugin_ID.html">$plugin_ID</a>.'_coll_apply_comment_rendering&quot;, &quot;'.<a class="var it6043" onMouseOver="hilite(6043)" onMouseOut="lolite()" onClick="logVariable('apply_comment_rendering')" href="../../_variables/apply_comment_rendering.html">$apply_comment_rendering</a>.'&quot; )';
<a name="l4136"><span class="linenum">4136</span></a>              }
<a name="l4137"><span class="linenum">4137</span></a>          }
<a name="l4138"><span class="linenum">4138</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> ) &gt; 0 )
<a name="l4139"><span class="linenum">4139</span></a>          {
<a name="l4140"><span class="linenum">4140</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l4141"><span class="linenum">4141</span></a>                          VALUES '.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> ) );
<a name="l4142"><span class="linenum">4142</span></a>          }
<a name="l4143"><span class="linenum">4143</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_coll_settings WHERE cset_name = &quot;comment_autobr&quot;' );
<a name="l4144"><span class="linenum">4144</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments SET comment_content = <a class="function" onClick="logFunction('REPLACE')" href="../../_functions/replace.html" onMouseOver="funcPopup(event,'replace')">REPLACE</a>( <a class="function" onClick="logFunction('REPLACE')" href="../../_functions/replace.html" onMouseOver="funcPopup(event,'replace')">REPLACE</a>( comment_content, &quot;&lt;br&gt;\n&quot;, &quot;\n&quot; ), &quot;&lt;br /&gt;\n&quot;, &quot;\n&quot; )' );
<a name="l4145"><span class="linenum">4145</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4146"><span class="linenum">4146</span></a>  
<a name="l4147"><span class="linenum">4147</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11000' );
<a name="l4148"><span class="linenum">4148</span></a>      }
<a name="l4149"><span class="linenum">4149</span></a>  
<a name="l4150"><span class="linenum">4150</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11010 )
<a name="l4151"><span class="linenum">4151</span></a>      {    // part 9 trunk aka second part of &quot;i4&quot;
<a name="l4152"><span class="linenum">4152</span></a>  
<a name="l4153"><span class="linenum">4153</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading post statuses...' );
<a name="l4154"><span class="linenum">4154</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item CHANGE COLUMN post_status post_status enum('published','community','deprecated','protected','private','review','draft','redirected') NOT NULL default 'published'&quot; );
<a name="l4155"><span class="linenum">4155</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__version CHANGE COLUMN iver_status iver_status ENUM('published','community','deprecated','protected','private','review','draft','redirected') NULL&quot; );
<a name="l4156"><span class="linenum">4156</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_user_perms CHANGE COLUMN bloguser_perm_poststatuses bloguser_perm_poststatuses <a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('review','draft','private','protected','deprecated','community','published','redirected') NOT NULL default ''&quot; );
<a name="l4157"><span class="linenum">4157</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_group_perms CHANGE COLUMN bloggroup_perm_poststatuses bloggroup_perm_poststatuses <a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('review','draft','private','protected','deprecated','community','published','redirected') NOT NULL default ''&quot; );
<a name="l4158"><span class="linenum">4158</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4159"><span class="linenum">4159</span></a>  
<a name="l4160"><span class="linenum">4160</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading groups table...' );
<a name="l4161"><span class="linenum">4161</span></a>          <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('pbloggers_renamed_to_moderators')" href="../../_variables/pbloggers_renamed_to_moderators.html">$pbloggers_renamed_to_moderators</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_groups SET grp_name = &quot;Moderators&quot; WHERE grp_ID = 2 AND grp_name = &quot;Privileged Bloggers&quot;' );
<a name="l4162"><span class="linenum">4162</span></a>  <span class="comment">        // Update administrators and moderators users coll setting permissions with new permissions</span>
<a name="l4163"><span class="linenum">4163</span></a>  <span class="comment">        // Note we can change moderators permission if the group name and ID was not changed after the original install</span>
<a name="l4164"><span class="linenum">4164</span></a>          <a class="var it6047" onMouseOver="hilite(6047)" onMouseOut="lolite()" onClick="logVariable('moderators_condition')" href="../../_variables/moderators_condition.html">$moderators_condition</a> = <a class="var it6046" onMouseOver="hilite(6046)" onMouseOut="lolite()" onClick="logVariable('pbloggers_renamed_to_moderators')" href="../../_variables/pbloggers_renamed_to_moderators.html">$pbloggers_renamed_to_moderators</a> ? ' OR bloggroup_group_ID = 2' : '';
<a name="l4165"><span class="linenum">4165</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_coll_group_perms SET bloggroup_perm_poststatuses = 'published,community,deprecated,protected,private,review,draft' WHERE bloggroup_group_ID = 1&quot;.<a class="var it6047" onMouseOver="hilite(6047)" onMouseOut="lolite()" onClick="logVariable('moderators_condition')" href="../../_variables/moderators_condition.html">$moderators_condition</a> );
<a name="l4166"><span class="linenum">4166</span></a>  <span class="comment">        // Change groups name</span>
<a name="l4167"><span class="linenum">4167</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_groups SET grp_name = &quot;Trusted Users&quot; WHERE grp_ID = 3 AND grp_name = &quot;Bloggers&quot;' );
<a name="l4168"><span class="linenum">4168</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_groups SET grp_name = &quot;Normal Users&quot; WHERE grp_ID = 4 AND grp_name = &quot;Basic Users&quot;' );
<a name="l4169"><span class="linenum">4169</span></a>  
<a name="l4170"><span class="linenum">4170</span></a>  <span class="comment">        // Get &quot;Misbehaving/Suspect Users&quot; group ID</span>
<a name="l4171"><span class="linenum">4171</span></a>          <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('suspect_query')" href="../../_variables/suspect_query.html">$suspect_query</a> = 'SELECT grp_ID
<a name="l4172"><span class="linenum">4172</span></a>                          FROM T_groups
<a name="l4173"><span class="linenum">4173</span></a>                          WHERE grp_name = &quot;Misbehaving/Suspect Users&quot;
<a name="l4174"><span class="linenum">4174</span></a>                          ORDER BY grp_ID DESC
<a name="l4175"><span class="linenum">4175</span></a>                          LIMIT 1';
<a name="l4176"><span class="linenum">4176</span></a>          <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('suspect_query')" href="../../_variables/suspect_query.html">$suspect_query</a> );
<a name="l4177"><span class="linenum">4177</span></a>          if( empty( <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a> ) )
<a name="l4178"><span class="linenum">4178</span></a>          { // suspect group doesn't exists, check spammers because probably it does not exists either
<a name="l4179"><span class="linenum">4179</span></a>              <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> = '( &quot;Misbehaving/Suspect Users&quot; )';
<a name="l4180"><span class="linenum">4180</span></a>  <span class="comment">            // Get &quot;Spammers/Restricted Users&quot; group ID</span>
<a name="l4181"><span class="linenum">4181</span></a>              <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = 'SELECT grp_ID
<a name="l4182"><span class="linenum">4182</span></a>                      FROM T_groups
<a name="l4183"><span class="linenum">4183</span></a>                      WHERE grp_name = &quot;Spammers/Restricted Users&quot;
<a name="l4184"><span class="linenum">4184</span></a>                      ORDER BY grp_ID DESC
<a name="l4185"><span class="linenum">4185</span></a>                      LIMIT 1';
<a name="l4186"><span class="linenum">4186</span></a>              <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('spammers_group_ID')" href="../../_variables/spammers_group_ID.html">$spammers_group_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l4187"><span class="linenum">4187</span></a>              if( empty( <a class="var it6050" onMouseOver="hilite(6050)" onMouseOut="lolite()" onClick="logVariable('spammers_group_ID')" href="../../_variables/spammers_group_ID.html">$spammers_group_ID</a> ) )
<a name="l4188"><span class="linenum">4188</span></a>              {
<a name="l4189"><span class="linenum">4189</span></a>                  <a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> .= ', ( &quot;Spammers/Restricted Users&quot; )';
<a name="l4190"><span class="linenum">4190</span></a>              }
<a name="l4191"><span class="linenum">4191</span></a>  <span class="comment">            // Insert two new group</span>
<a name="l4192"><span class="linenum">4192</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_groups ( grp_name )
<a name="l4193"><span class="linenum">4193</span></a>                          VALUES '.<a class="var it1453" onMouseOver="hilite(1453)" onMouseOut="lolite()" onClick="logVariable('insert_values')" href="../../_variables/insert_values.html">$insert_values</a> );
<a name="l4194"><span class="linenum">4194</span></a>  
<a name="l4195"><span class="linenum">4195</span></a>              <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it6048" onMouseOver="hilite(6048)" onMouseOut="lolite()" onClick="logVariable('suspect_query')" href="../../_variables/suspect_query.html">$suspect_query</a> );
<a name="l4196"><span class="linenum">4196</span></a>              if( <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a> )
<a name="l4197"><span class="linenum">4197</span></a>              { // Set coll setting permissions for Misbehaving/Suspect Users in Forums
<a name="l4198"><span class="linenum">4198</span></a>                  <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> = &quot;
<a name="l4199"><span class="linenum">4199</span></a>                      INSERT INTO T_coll_group_perms( bloggroup_blog_ID, bloggroup_group_ID, bloggroup_ismember,
<a name="l4200"><span class="linenum">4200</span></a>                          bloggroup_perm_poststatuses, bloggroup_perm_delpost, bloggroup_perm_edit_ts,
<a name="l4201"><span class="linenum">4201</span></a>                          bloggroup_perm_own_cmts, bloggroup_perm_vote_spam_cmts, bloggroup_perm_draft_cmts, bloggroup_perm_publ_cmts, bloggroup_perm_depr_cmts,
<a name="l4202"><span class="linenum">4202</span></a>                          bloggroup_perm_cats, bloggroup_perm_properties,
<a name="l4203"><span class="linenum">4203</span></a>                          bloggroup_perm_media_upload, bloggroup_perm_media_browse, bloggroup_perm_media_change )
<a name="l4204"><span class="linenum">4204</span></a>                      SELECT blog_ID, &quot;.<a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a>.&quot;, 1, 'review,draft', 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
<a name="l4205"><span class="linenum">4205</span></a>                          FROM T_blogs WHERE blog_ID = 5 AND blog_shortname = 'Forums'&quot;;
<a name="l4206"><span class="linenum">4206</span></a>                  <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> );
<a name="l4207"><span class="linenum">4207</span></a>              }
<a name="l4208"><span class="linenum">4208</span></a>          }
<a name="l4209"><span class="linenum">4209</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4210"><span class="linenum">4210</span></a>  
<a name="l4211"><span class="linenum">4211</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blogs table...' );
<a name="l4212"><span class="linenum">4212</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_blogs', 'blog_type', 'ENUM( &quot;std&quot;, &quot;photo&quot;, &quot;group&quot;, &quot;forum&quot;, &quot;manual&quot; ) DEFAULT &quot;std&quot; NOT NULL' );
<a name="l4213"><span class="linenum">4213</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4214"><span class="linenum">4214</span></a>  
<a name="l4215"><span class="linenum">4215</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading comment statuses...' );
<a name="l4216"><span class="linenum">4216</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_comments CHANGE COLUMN comment_status comment_status ENUM('published','community','deprecated','protected','private','review','draft','trash') DEFAULT 'published' NOT NULL&quot; );
<a name="l4217"><span class="linenum">4217</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4218"><span class="linenum">4218</span></a>  
<a name="l4219"><span class="linenum">4219</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating collection user/group permissions...' );
<a name="l4220"><span class="linenum">4220</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_perm_cmtstatuses', &quot;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('review','draft','private','protected','deprecated','community','published') NOT NULL default '' AFTER bloguser_perm_vote_spam_cmts&quot; );
<a name="l4221"><span class="linenum">4221</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_perm_edit_cmt', &quot;ENUM('no','own','anon','lt','le','all') NOT NULL default 'no' AFTER bloguser_perm_cmtstatuses&quot; );
<a name="l4222"><span class="linenum">4222</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_perm_cmtstatuses', &quot;<a class="function" onClick="logFunction('set')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>('review','draft','private','protected','deprecated','community','published') NOT NULL default '' AFTER bloggroup_perm_vote_spam_cmts&quot; );
<a name="l4223"><span class="linenum">4223</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_perm_edit_cmt', &quot;ENUM('no','own','anon','lt','le','all') NOT NULL default 'no' AFTER bloggroup_perm_cmtstatuses&quot; );
<a name="l4224"><span class="linenum">4224</span></a>  
<a name="l4225"><span class="linenum">4225</span></a>  <span class="comment">        // Add access to those comment statuses for what user had before</span>
<a name="l4226"><span class="linenum">4226</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_user_perms
<a name="l4227"><span class="linenum">4227</span></a>                      SET bloguser_perm_cmtstatuses = ( bloguser_perm_publ_cmts * 1 ) | ( bloguser_perm_depr_cmts * 4 ) | ( bloguser_perm_draft_cmts * 64 )' );
<a name="l4228"><span class="linenum">4228</span></a>  <span class="comment">        // Add access to all cmt statuses for those users which had edit permission on all comment statuses</span>
<a name="l4229"><span class="linenum">4229</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_user_perms
<a name="l4230"><span class="linenum">4230</span></a>                      SET bloguser_perm_cmtstatuses = &quot;published,community,deprecated,protected,private,review,draft&quot;, bloguser_perm_edit_cmt = &quot;all&quot;
<a name="l4231"><span class="linenum">4231</span></a>                      WHERE bloguser_perm_publ_cmts &lt;&gt; 0 AND bloguser_perm_depr_cmts &lt;&gt; 0 AND bloguser_perm_draft_cmts &lt;&gt; 0' );
<a name="l4232"><span class="linenum">4232</span></a>  <span class="comment">        // Add &quot;lower then&quot; edit permission to those users who had permission to edit published or draft comments</span>
<a name="l4233"><span class="linenum">4233</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_user_perms
<a name="l4234"><span class="linenum">4234</span></a>                      SET bloguser_perm_edit_cmt = &quot;lt&quot;
<a name="l4235"><span class="linenum">4235</span></a>                      <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> ( bloguser_perm_cmtstatuses &amp; 65 ) != 0 AND bloguser_perm_edit_cmt = &quot;no&quot;' );
<a name="l4236"><span class="linenum">4236</span></a>  
<a name="l4237"><span class="linenum">4237</span></a>  <span class="comment">        // Add access to those comment statuses for what group had before</span>
<a name="l4238"><span class="linenum">4238</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l4239"><span class="linenum">4239</span></a>                      SET bloggroup_perm_cmtstatuses = ( bloggroup_perm_publ_cmts * 1 ) | ( bloggroup_perm_depr_cmts * 4 ) | ( bloggroup_perm_draft_cmts * 64 )' );
<a name="l4240"><span class="linenum">4240</span></a>  <span class="comment">        // Add access to all cmt statuses for those groups which had edit permission on all comment statuses</span>
<a name="l4241"><span class="linenum">4241</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l4242"><span class="linenum">4242</span></a>                      SET bloggroup_perm_cmtstatuses = &quot;published,community,deprecated,protected,private,review,draft&quot;, bloggroup_perm_edit_cmt = &quot;all&quot;
<a name="l4243"><span class="linenum">4243</span></a>                      WHERE bloggroup_perm_publ_cmts &lt;&gt; 0 AND bloggroup_perm_depr_cmts &lt;&gt; 0 AND bloggroup_perm_draft_cmts &lt;&gt; 0' );
<a name="l4244"><span class="linenum">4244</span></a>  <span class="comment">        // Add &quot;lower then&quot; edit permission to those groups who had permission to edit published or draft comments</span>
<a name="l4245"><span class="linenum">4245</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l4246"><span class="linenum">4246</span></a>                      SET bloggroup_perm_edit_cmt = &quot;lt&quot;
<a name="l4247"><span class="linenum">4247</span></a>                      <a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a> ( bloggroup_perm_cmtstatuses &amp; 65 ) != 0 AND bloggroup_perm_edit_cmt = &quot;no&quot;' );
<a name="l4248"><span class="linenum">4248</span></a>  
<a name="l4249"><span class="linenum">4249</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_user_perms', 'bloguser_perm_draft_cmts' );
<a name="l4250"><span class="linenum">4250</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_user_perms', 'bloguser_perm_publ_cmts' );
<a name="l4251"><span class="linenum">4251</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_user_perms', 'bloguser_perm_depr_cmts' );
<a name="l4252"><span class="linenum">4252</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_group_perms', 'bloggroup_perm_draft_cmts' );
<a name="l4253"><span class="linenum">4253</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_group_perms', 'bloggroup_perm_publ_cmts' );
<a name="l4254"><span class="linenum">4254</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_coll_group_perms', 'bloggroup_perm_depr_cmts' );
<a name="l4255"><span class="linenum">4255</span></a>  
<a name="l4256"><span class="linenum">4256</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_perm_delcmts', 'tinyint NOT NULL default 0 AFTER bloguser_perm_edit_ts' );
<a name="l4257"><span class="linenum">4257</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_perm_delcmts', 'tinyint NOT NULL default 0 AFTER bloggroup_perm_edit_ts' );
<a name="l4258"><span class="linenum">4258</span></a>  <span class="comment">        // GRANT delete comment perms for moderators</span>
<a name="l4259"><span class="linenum">4259</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l4260"><span class="linenum">4260</span></a>                      SET bloggroup_perm_delcmts = 1
<a name="l4261"><span class="linenum">4261</span></a>                      WHERE bloggroup_perm_edit_cmt = &quot;le&quot; OR bloggroup_perm_edit_cmt = &quot;all&quot;' );
<a name="l4262"><span class="linenum">4262</span></a>  
<a name="l4263"><span class="linenum">4263</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_user_perms CHANGE COLUMN bloguser_perm_own_cmts bloguser_perm_recycle_owncmts tinyint NOT NULL default 0&quot; );
<a name="l4264"><span class="linenum">4264</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_group_perms CHANGE COLUMN bloggroup_perm_own_cmts bloggroup_perm_recycle_owncmts tinyint NOT NULL default 0&quot; );
<a name="l4265"><span class="linenum">4265</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4266"><span class="linenum">4266</span></a>  
<a name="l4267"><span class="linenum">4267</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating blogs settings...' );
<a name="l4268"><span class="linenum">4268</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_settings SET cset_value = &quot;blog&quot; WHERE cset_name = &quot;enable_goto_blog&quot; AND cset_value = &quot;1&quot;' );
<a name="l4269"><span class="linenum">4269</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_settings SET cset_value = &quot;no&quot; WHERE cset_name = &quot;enable_goto_blog&quot; AND cset_value = &quot;0&quot;' );
<a name="l4270"><span class="linenum">4270</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4271"><span class="linenum">4271</span></a>  
<a name="l4272"><span class="linenum">4272</span></a>          <span class="comment">/*</span>
<a name="l4273"><span class="linenum">4273</span></a>  <span class="comment">         * ADD UPGRADES FOR i4 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l4274"><span class="linenum">4274</span></a>  <span class="comment">         *</span>
<a name="l4275"><span class="linenum">4275</span></a>  <span class="comment">         * This part will be included in trunk and i4 branches</span>
<a name="l4276"><span class="linenum">4276</span></a>  <span class="comment">         */</span>
<a name="l4277"><span class="linenum">4277</span></a>  
<a name="l4278"><span class="linenum">4278</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11010' );
<a name="l4279"><span class="linenum">4279</span></a>      }
<a name="l4280"><span class="linenum">4280</span></a>  
<a name="l4281"><span class="linenum">4281</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11020 )
<a name="l4282"><span class="linenum">4282</span></a>      {    // part 10 trunk aka third part of &quot;i4&quot;
<a name="l4283"><span class="linenum">4283</span></a>  
<a name="l4284"><span class="linenum">4284</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading users table...' );
<a name="l4285"><span class="linenum">4285</span></a>  <span class="comment">        // Get all users with defined IPs</span>
<a name="l4286"><span class="linenum">4286</span></a>          <a class="var it5944" onMouseOver="hilite(5944)" onMouseOut="lolite()" onClick="logVariable('users_SQL')" href="../../_variables/users_SQL.html">$users_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l4287"><span class="linenum">4287</span></a>          <a class="var it5944" onMouseOver="hilite(5944)" onMouseOut="lolite()" onClick="logVariable('users_SQL')" href="../../_variables/users_SQL.html">$users_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'user_ID, user_created_fromIPv4' );
<a name="l4288"><span class="linenum">4288</span></a>          <a class="var it5944" onMouseOver="hilite(5944)" onMouseOut="lolite()" onClick="logVariable('users_SQL')" href="../../_variables/users_SQL.html">$users_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users' );
<a name="l4289"><span class="linenum">4289</span></a>          <a class="var it5944" onMouseOver="hilite(5944)" onMouseOut="lolite()" onClick="logVariable('users_SQL')" href="../../_variables/users_SQL.html">$users_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'user_created_fromIPv4 IS NOT NULL' );
<a name="l4290"><span class="linenum">4290</span></a>          <a class="var it5944" onMouseOver="hilite(5944)" onMouseOut="lolite()" onClick="logVariable('users_SQL')" href="../../_variables/users_SQL.html">$users_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'user_created_fromIPv4 != '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '0.0.0.0' ) ) );
<a name="l4291"><span class="linenum">4291</span></a>          <a class="var it5944" onMouseOver="hilite(5944)" onMouseOut="lolite()" onClick="logVariable('users_SQL')" href="../../_variables/users_SQL.html">$users_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'user_created_fromIPv4 != '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( '127.0.0.1' ) ) );
<a name="l4292"><span class="linenum">4292</span></a>          <a class="var it2076" onMouseOver="hilite(2076)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it5944" onMouseOver="hilite(5944)" onMouseOut="lolite()" onClick="logVariable('users_SQL')" href="../../_variables/users_SQL.html">$users_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l4293"><span class="linenum">4293</span></a>  <span class="comment">        // Get user's IPs from settings table</span>
<a name="l4294"><span class="linenum">4294</span></a>          <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('settings_SQL')" href="../../_variables/settings_SQL.html">$settings_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l4295"><span class="linenum">4295</span></a>          <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('settings_SQL')" href="../../_variables/settings_SQL.html">$settings_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'uset_user_ID, uset_value' );
<a name="l4296"><span class="linenum">4296</span></a>          <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('settings_SQL')" href="../../_variables/settings_SQL.html">$settings_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users__usersettings' );
<a name="l4297"><span class="linenum">4297</span></a>          <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('settings_SQL')" href="../../_variables/settings_SQL.html">$settings_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'uset_name = &quot;user_ip&quot;' );
<a name="l4298"><span class="linenum">4298</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it2076" onMouseOver="hilite(2076)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> ) &gt; 0 )
<a name="l4299"><span class="linenum">4299</span></a>          {    // Get IPs only for users which have not IP in T_users table
<a name="l4300"><span class="linenum">4300</span></a>              <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('settings_SQL')" href="../../_variables/settings_SQL.html">$settings_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'uset_user_ID NOT IN ('.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="phpfunction" onClick="logFunction('array_keys')" href="../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it2076" onMouseOver="hilite(2076)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> ) ).')' );
<a name="l4301"><span class="linenum">4301</span></a>          }
<a name="l4302"><span class="linenum">4302</span></a>          <a class="var it5294" onMouseOver="hilite(5294)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it6051" onMouseOver="hilite(6051)" onMouseOut="lolite()" onClick="logVariable('settings_SQL')" href="../../_variables/settings_SQL.html">$settings_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l4303"><span class="linenum">4303</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it2076" onMouseOver="hilite(2076)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> ) &gt; 0 || <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5294" onMouseOver="hilite(5294)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a> ) &gt; 0 )
<a name="l4304"><span class="linenum">4304</span></a>          {
<a name="l4305"><span class="linenum">4305</span></a>              <a class="var it6052" onMouseOver="hilite(6052)" onMouseOut="lolite()" onClick="logVariable('users_settings_insert_sql')" href="../../_variables/users_settings_insert_sql.html">$users_settings_insert_sql</a> = array();
<a name="l4306"><span class="linenum">4306</span></a>              foreach( <a class="var it2076" onMouseOver="hilite(2076)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../_variables/users.html">$users</a> as <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../_variables/user_ID.html">$user_ID</a> =&gt; <a class="var it6053" onMouseOver="hilite(6053)" onMouseOut="lolite()" onClick="logVariable('user_IP')" href="../../_variables/user_IP.html">$user_IP</a> )
<a name="l4307"><span class="linenum">4307</span></a>              {
<a name="l4308"><span class="linenum">4308</span></a>                  <a class="var it6052" onMouseOver="hilite(6052)" onMouseOut="lolite()" onClick="logVariable('users_settings_insert_sql')" href="../../_variables/users_settings_insert_sql.html">$users_settings_insert_sql</a>[] = '( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../_variables/user_ID.html">$user_ID</a> ).', &quot;created_fromIPv4&quot;, '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it6053" onMouseOver="hilite(6053)" onMouseOut="lolite()" onClick="logVariable('user_IP')" href="../../_variables/user_IP.html">$user_IP</a> ).' )';
<a name="l4309"><span class="linenum">4309</span></a>              }
<a name="l4310"><span class="linenum">4310</span></a>              foreach( <a class="var it5294" onMouseOver="hilite(5294)" onMouseOut="lolite()" onClick="logVariable('settings')" href="../../_variables/settings.html">$settings</a> as <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../_variables/user_ID.html">$user_ID</a> =&gt; <a class="var it6053" onMouseOver="hilite(6053)" onMouseOut="lolite()" onClick="logVariable('user_IP')" href="../../_variables/user_IP.html">$user_IP</a> )
<a name="l4311"><span class="linenum">4311</span></a>              {
<a name="l4312"><span class="linenum">4312</span></a>                  <a class="var it6052" onMouseOver="hilite(6052)" onMouseOut="lolite()" onClick="logVariable('users_settings_insert_sql')" href="../../_variables/users_settings_insert_sql.html">$users_settings_insert_sql</a>[] = '( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it195" onMouseOver="hilite(195)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../_variables/user_ID.html">$user_ID</a> ).', &quot;created_fromIPv4&quot;, '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('ip2int')" href="../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( <a class="var it6053" onMouseOver="hilite(6053)" onMouseOut="lolite()" onClick="logVariable('user_IP')" href="../../_variables/user_IP.html">$user_IP</a> ) ).' )';
<a name="l4313"><span class="linenum">4313</span></a>              }
<a name="l4314"><span class="linenum">4314</span></a>  <span class="comment">            // Insert IPs values into settings table</span>
<a name="l4315"><span class="linenum">4315</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_users__usersettings ( uset_user_ID, uset_name, uset_value )
<a name="l4316"><span class="linenum">4316</span></a>                  VALUES '.<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it6052" onMouseOver="hilite(6052)" onMouseOut="lolite()" onClick="logVariable('users_settings_insert_sql')" href="../../_variables/users_settings_insert_sql.html">$users_settings_insert_sql</a> ) );
<a name="l4317"><span class="linenum">4317</span></a>          }
<a name="l4318"><span class="linenum">4318</span></a>  <span class="comment">        // Remove old IPs from settings table</span>
<a name="l4319"><span class="linenum">4319</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_users__usersettings
<a name="l4320"><span class="linenum">4320</span></a>              WHERE uset_name = &quot;user_ip&quot;' );
<a name="l4321"><span class="linenum">4321</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_users', 'user_created_fromIPv4' );
<a name="l4322"><span class="linenum">4322</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4323"><span class="linenum">4323</span></a>  
<a name="l4324"><span class="linenum">4324</span></a>          <span class="comment">/*</span>
<a name="l4325"><span class="linenum">4325</span></a>  <span class="comment">         * ADD UPGRADES FOR i4 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l4326"><span class="linenum">4326</span></a>  <span class="comment">         *</span>
<a name="l4327"><span class="linenum">4327</span></a>  <span class="comment">         * This part will be included in trunk and i4 branches</span>
<a name="l4328"><span class="linenum">4328</span></a>  <span class="comment">         */</span>
<a name="l4329"><span class="linenum">4329</span></a>  
<a name="l4330"><span class="linenum">4330</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11020' );
<a name="l4331"><span class="linenum">4331</span></a>      }
<a name="l4332"><span class="linenum">4332</span></a>  
<a name="l4333"><span class="linenum">4333</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11025 )
<a name="l4334"><span class="linenum">4334</span></a>      {    // part 11 trunk aka fourth part of &quot;i4&quot;
<a name="l4335"><span class="linenum">4335</span></a>  
<a name="l4336"><span class="linenum">4336</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading items table...' );
<a name="l4337"><span class="linenum">4337</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_items__item SET post_datecreated = concat( '2000-01-01 ', <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>( post_datecreated ) )
<a name="l4338"><span class="linenum">4338</span></a>                          WHERE <a class="phpfunction" onClick="logFunction('date')" href="../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( post_datecreated ) = '1970-01-01'&quot; );
<a name="l4339"><span class="linenum">4339</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_items__item SET post_datemodified = concat( '2000-01-01 ', <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>( post_datemodified ) )
<a name="l4340"><span class="linenum">4340</span></a>                          WHERE <a class="phpfunction" onClick="logFunction('date')" href="../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( post_datemodified ) = '1970-01-01'&quot; );
<a name="l4341"><span class="linenum">4341</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item CHANGE COLUMN post_datecreated post_datecreated TIMESTAMP NOT NULL DEFAULT '2000-01-01 00:00:00'&quot; );
<a name="l4342"><span class="linenum">4342</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item CHANGE COLUMN post_datemodified post_datemodified TIMESTAMP NOT NULL DEFAULT '2000-01-01 00:00:00'&quot; );
<a name="l4343"><span class="linenum">4343</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_items__item', 'post_last_touched_ts', &quot;TIMESTAMP NOT NULL DEFAULT '2000-01-01 00:00:00' AFTER post_datemodified&quot; );
<a name="l4344"><span class="linenum">4344</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item SET post_last_touched_ts = post_datemodified' );
<a name="l4345"><span class="linenum">4345</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4346"><span class="linenum">4346</span></a>  
<a name="l4347"><span class="linenum">4347</span></a>          <span class="comment">/*</span>
<a name="l4348"><span class="linenum">4348</span></a>  <span class="comment">         * ADD UPGRADES FOR i4 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l4349"><span class="linenum">4349</span></a>  <span class="comment">         *</span>
<a name="l4350"><span class="linenum">4350</span></a>  <span class="comment">         * This part will be included in trunk and i4 branches</span>
<a name="l4351"><span class="linenum">4351</span></a>  <span class="comment">         */</span>
<a name="l4352"><span class="linenum">4352</span></a>  
<a name="l4353"><span class="linenum">4353</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11025' );
<a name="l4354"><span class="linenum">4354</span></a>      }
<a name="l4355"><span class="linenum">4355</span></a>  
<a name="l4356"><span class="linenum">4356</span></a>  <span class="comment">    // In some upgrade versions ( currently only in &quot;i5&quot; ) we would like to create profile pictures links from the user's files in the profile pictures folder</span>
<a name="l4357"><span class="linenum">4357</span></a>  <span class="comment">    // To be able to do that we need an up to date database version, so we will create profile pictures after the ugrade script run successfully.</span>
<a name="l4358"><span class="linenum">4358</span></a>  <span class="comment">    // Set this $create_profile_picture_links to true only in those upgrade block where it's required.</span>
<a name="l4359"><span class="linenum">4359</span></a>      <a class="var it6054" onMouseOver="hilite(6054)" onMouseOut="lolite()" onClick="logVariable('create_profile_picture_links')" href="../../_variables/create_profile_picture_links.html">$create_profile_picture_links</a> = false;
<a name="l4360"><span class="linenum">4360</span></a>  
<a name="l4361"><span class="linenum">4361</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11100 )
<a name="l4362"><span class="linenum">4362</span></a>      {    // part 12 trunk aka &quot;i5&quot;
<a name="l4363"><span class="linenum">4363</span></a>  
<a name="l4364"><span class="linenum">4364</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Update links table...' );
<a name="l4365"><span class="linenum">4365</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_links', 'link_usr_ID', 'int(11) unsigned  NULL COMMENT &quot;Used for linking files to users (user profile picture)&quot; AFTER link_cmt_ID' );
<a name="l4366"><span class="linenum">4366</span></a>          <a class="function" onClick="logFunction('db_add_index')" href="../../_functions/db_add_index.html" onMouseOver="funcPopup(event,'db_add_index')">db_add_index</a>( 'T_links', 'link_usr_ID', 'link_usr_ID' );
<a name="l4367"><span class="linenum">4367</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4368"><span class="linenum">4368</span></a>  
<a name="l4369"><span class="linenum">4369</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating links for users profile pictures...' );
<a name="l4370"><span class="linenum">4370</span></a>  <span class="comment">        // Create links for main profile pictures</span>
<a name="l4371"><span class="linenum">4371</span></a>          <a class="var it6055" onMouseOver="hilite(6055)" onMouseOut="lolite()" onClick="logVariable('link_create_date')" href="../../_variables/link_create_date.html">$link_create_date</a> = <a class="function" onClick="logFunction('date2mysql')" href="../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>( <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() );
<a name="l4372"><span class="linenum">4372</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_links( link_datecreated, link_datemodified, link_usr_ID, link_file_ID, link_position, link_order )
<a name="l4373"><span class="linenum">4373</span></a>                          SELECT '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it6055" onMouseOver="hilite(6055)" onMouseOut="lolite()" onClick="logVariable('link_create_date')" href="../../_variables/link_create_date.html">$link_create_date</a> ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it6055" onMouseOver="hilite(6055)" onMouseOut="lolite()" onClick="logVariable('link_create_date')" href="../../_variables/link_create_date.html">$link_create_date</a> ).', user_ID, user_avatar_file_ID, &quot;&quot;, 1
<a name="l4374"><span class="linenum">4374</span></a>                          FROM T_users
<a name="l4375"><span class="linenum">4375</span></a>                          WHERE user_avatar_file_ID IS NOT NULL' );
<a name="l4376"><span class="linenum">4376</span></a>  <span class="comment">        // Set $create_profile_picture_links to true to create links for all files from the users profile_pictures folder</span>
<a name="l4377"><span class="linenum">4377</span></a>          <a class="var it6054" onMouseOver="hilite(6054)" onMouseOut="lolite()" onClick="logVariable('create_profile_picture_links')" href="../../_variables/create_profile_picture_links.html">$create_profile_picture_links</a> = true;
<a name="l4378"><span class="linenum">4378</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4379"><span class="linenum">4379</span></a>  
<a name="l4380"><span class="linenum">4380</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading categories table...' );
<a name="l4381"><span class="linenum">4381</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_categories CHANGE COLUMN cat_urlname cat_urlname varchar(255) NOT NULL COLLATE ascii_bin&quot; );
<a name="l4382"><span class="linenum">4382</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4383"><span class="linenum">4383</span></a>  
<a name="l4384"><span class="linenum">4384</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading items table...' );
<a name="l4385"><span class="linenum">4385</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item CHANGE COLUMN post_urltitle post_urltitle VARCHAR(210) NOT NULL COLLATE ascii_bin&quot; );
<a name="l4386"><span class="linenum">4386</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4387"><span class="linenum">4387</span></a>  
<a name="l4388"><span class="linenum">4388</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading custom item settings...' );
<a name="l4389"><span class="linenum">4389</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>(); <span class="comment">// Add names for custom fields</span>
<a name="l4390"><span class="linenum">4390</span></a>  <span class="comment">        // Select all custom fields from all blogs, to create field names</span>
<a name="l4391"><span class="linenum">4391</span></a>          <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( 'SELECT cset_coll_ID as coll_ID, cset_name as name, cset_value as value
<a name="l4392"><span class="linenum">4392</span></a>                                          FROM T_coll_settings
<a name="l4393"><span class="linenum">4393</span></a>                                          WHERE cset_name LIKE &quot;custom\_double\_%&quot;
<a name="l4394"><span class="linenum">4394</span></a>                                             OR cset_name LIKE &quot;custom\_varchar\_%&quot;
<a name="l4395"><span class="linenum">4395</span></a>                                          ORDER BY cset_coll_ID, cset_name' );
<a name="l4396"><span class="linenum">4396</span></a>          if( !empty( <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> ) )
<a name="l4397"><span class="linenum">4397</span></a>          { // There are custom fields in blog settings
<a name="l4398"><span class="linenum">4398</span></a>              <a class="var it6056" onMouseOver="hilite(6056)" onMouseOut="lolite()" onClick="logVariable('insert_field_names')" href="../../_variables/insert_field_names.html">$insert_field_names</a> = '';
<a name="l4399"><span class="linenum">4399</span></a>              foreach( <a class="var it156" onMouseOver="hilite(156)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../_variables/result.html">$result</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a> )
<a name="l4400"><span class="linenum">4400</span></a>              { // process each custom field
<a name="l4401"><span class="linenum">4401</span></a>                  <a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('field_guid')" href="../../_variables/field_guid.html">$field_guid</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( '/^custom_(double|varchar)_([a-f0-9\-]+)$/', '<a class="var it341" onMouseOver="hilite(341)" onMouseOut="lolite()" onClick="logVariable('2')" href="../../_variables/2.html">$2</a>', <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('name')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/name.html">name</a> );
<a name="l4402"><span class="linenum">4402</span></a>  <span class="comment">                // Replace special chars/umlauts, if we can convert charsets:</span>
<a name="l4403"><span class="linenum">4403</span></a>                  <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('locales/_charset.funcs.php');
<a name="l4404"><span class="linenum">4404</span></a>                  <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a> = <a class="phpfunction" onClick="logFunction('strtolower')" href="../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>( <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( '/[^a-z0-9\-_]+/i', '_', <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('value')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/value.html">value</a> ) );
<a name="l4405"><span class="linenum">4405</span></a>                  <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a> = <a class="function" onClick="logFunction('replace_special_chars')" href="../../_functions/replace_special_chars.html" onMouseOver="funcPopup(event,'replace_special_chars')">replace_special_chars</a>( <a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a> );
<a name="l4406"><span class="linenum">4406</span></a>  
<a name="l4407"><span class="linenum">4407</span></a>                  <a class="var it6056" onMouseOver="hilite(6056)" onMouseOut="lolite()" onClick="logVariable('insert_field_names')" href="../../_variables/insert_field_names.html">$insert_field_names</a> .= '( '.<a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('coll_ID')" class="var it8964" onMouseOver="hilite(8964)" onMouseOut="lolite()" href="../../_variables/coll_ID.html">coll_ID</a>.', &quot;custom_fname_'.<a class="var it53" onMouseOver="hilite(53)" onMouseOut="lolite()" onClick="logVariable('field_guid')" href="../../_variables/field_guid.html">$field_guid</a>.'&quot;, &quot;'.<a class="var it218" onMouseOver="hilite(218)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../_variables/field_name.html">$field_name</a>.'&quot; ), ';
<a name="l4408"><span class="linenum">4408</span></a>              }
<a name="l4409"><span class="linenum">4409</span></a>  <span class="comment">            // Insert names for custom fields in collection settings</span>
<a name="l4410"><span class="linenum">4410</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_coll_settings( cset_coll_ID, cset_name, cset_value )
<a name="l4411"><span class="linenum">4411</span></a>                              VALUES '.<a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it6056" onMouseOver="hilite(6056)" onMouseOut="lolite()" onClick="logVariable('insert_field_names')" href="../../_variables/insert_field_names.html">$insert_field_names</a>, 0, -2 ) );
<a name="l4412"><span class="linenum">4412</span></a>          }
<a name="l4413"><span class="linenum">4413</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>(); <span class="comment">// End adding of names for custom fields</span>
<a name="l4414"><span class="linenum">4414</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4415"><span class="linenum">4415</span></a>  
<a name="l4416"><span class="linenum">4416</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading comments table...' );
<a name="l4417"><span class="linenum">4417</span></a>          <a class="function" onClick="logFunction('db_add_index')" href="../../_functions/db_add_index.html" onMouseOver="funcPopup(event,'db_add_index')">db_add_index</a>( 'T_comments', 'comment_status', 'comment_status' );
<a name="l4418"><span class="linenum">4418</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4419"><span class="linenum">4419</span></a>  
<a name="l4420"><span class="linenum">4420</span></a>          <span class="comment">/*</span>
<a name="l4421"><span class="linenum">4421</span></a>  <span class="comment">         * ADD UPGRADES FOR i5 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l4422"><span class="linenum">4422</span></a>  <span class="comment">         *</span>
<a name="l4423"><span class="linenum">4423</span></a>  <span class="comment">         * This part will be included in trunk and i5 branches</span>
<a name="l4424"><span class="linenum">4424</span></a>  <span class="comment">         */</span>
<a name="l4425"><span class="linenum">4425</span></a>  
<a name="l4426"><span class="linenum">4426</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11100' );
<a name="l4427"><span class="linenum">4427</span></a>      }
<a name="l4428"><span class="linenum">4428</span></a>  
<a name="l4429"><span class="linenum">4429</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11110 )
<a name="l4430"><span class="linenum">4430</span></a>      { // part 13 trunk aka second part of &quot;i5&quot;
<a name="l4431"><span class="linenum">4431</span></a>  
<a name="l4432"><span class="linenum">4432</span></a>  <span class="comment">        // Add new settings for antispam groups</span>
<a name="l4433"><span class="linenum">4433</span></a>          <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('antispam_group_settings')" href="../../_variables/antispam_group_settings.html">$antispam_group_settings</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( 'SELECT set_name, set_value
<a name="l4434"><span class="linenum">4434</span></a>               FROM T_settings
<a name="l4435"><span class="linenum">4435</span></a>              WHERE set_name IN ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( array( 'antispam_suspicious_group', 'antispam_trust_groups' ) ).')' );
<a name="l4436"><span class="linenum">4436</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('antispam_group_settings')" href="../../_variables/antispam_group_settings.html">$antispam_group_settings</a> ) &lt; 2 )
<a name="l4437"><span class="linenum">4437</span></a>          { // Insert new settings only if don't exist in DB
<a name="l4438"><span class="linenum">4438</span></a>              <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating general settings...' );
<a name="l4439"><span class="linenum">4439</span></a>  <span class="comment">            // Set antispam suspicious group</span>
<a name="l4440"><span class="linenum">4440</span></a>              if( !isset( <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('antispam_group_settings')" href="../../_variables/antispam_group_settings.html">$antispam_group_settings</a>['antispam_suspicious_group'] ) )
<a name="l4441"><span class="linenum">4441</span></a>              { // Insert new value, Don't rewrite value if it already defined before
<a name="l4442"><span class="linenum">4442</span></a>                  <a class="var it6058" onMouseOver="hilite(6058)" onMouseOut="lolite()" onClick="logVariable('suspect_group_SQL')" href="../../_variables/suspect_group_SQL.html">$suspect_group_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l4443"><span class="linenum">4443</span></a>                  <a class="var it6058" onMouseOver="hilite(6058)" onMouseOut="lolite()" onClick="logVariable('suspect_group_SQL')" href="../../_variables/suspect_group_SQL.html">$suspect_group_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'grp_ID' );
<a name="l4444"><span class="linenum">4444</span></a>                  <a class="var it6058" onMouseOver="hilite(6058)" onMouseOut="lolite()" onClick="logVariable('suspect_group_SQL')" href="../../_variables/suspect_group_SQL.html">$suspect_group_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_groups' );
<a name="l4445"><span class="linenum">4445</span></a>                  <a class="var it6058" onMouseOver="hilite(6058)" onMouseOut="lolite()" onClick="logVariable('suspect_group_SQL')" href="../../_variables/suspect_group_SQL.html">$suspect_group_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'grp_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'Misbehaving/Suspect Users' ) );
<a name="l4446"><span class="linenum">4446</span></a>                  <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it6058" onMouseOver="hilite(6058)" onMouseOut="lolite()" onClick="logVariable('suspect_group_SQL')" href="../../_variables/suspect_group_SQL.html">$suspect_group_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l4447"><span class="linenum">4447</span></a>                  if( !empty( <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a> ) )
<a name="l4448"><span class="linenum">4448</span></a>                  { // Save setting value
<a name="l4449"><span class="linenum">4449</span></a>                      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_settings ( set_name, set_value ) VALUES
<a name="l4450"><span class="linenum">4450</span></a>                              ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'antispam_suspicious_group' ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it6049" onMouseOver="hilite(6049)" onMouseOut="lolite()" onClick="logVariable('suspect_group_ID')" href="../../_variables/suspect_group_ID.html">$suspect_group_ID</a> ).' )' );
<a name="l4451"><span class="linenum">4451</span></a>                  }
<a name="l4452"><span class="linenum">4452</span></a>              }
<a name="l4453"><span class="linenum">4453</span></a>  <span class="comment">            // Set antispam trust groups</span>
<a name="l4454"><span class="linenum">4454</span></a>              if( !isset( <a class="var it6057" onMouseOver="hilite(6057)" onMouseOut="lolite()" onClick="logVariable('antispam_group_settings')" href="../../_variables/antispam_group_settings.html">$antispam_group_settings</a>['antispam_trust_groups'] ) )
<a name="l4455"><span class="linenum">4455</span></a>              { // Insert new value, Don't rewrite value if it already defined before
<a name="l4456"><span class="linenum">4456</span></a>                  <a class="var it6059" onMouseOver="hilite(6059)" onMouseOut="lolite()" onClick="logVariable('trust_groups')" href="../../_variables/trust_groups.html">$trust_groups</a> = array( 'Administrators', 'Moderators', 'Trusted Users', 'Spammers/Restricted Users' );
<a name="l4457"><span class="linenum">4457</span></a>                  <a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('trust_groups_SQL')" href="../../_variables/trust_groups_SQL.html">$trust_groups_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l4458"><span class="linenum">4458</span></a>                  <a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('trust_groups_SQL')" href="../../_variables/trust_groups_SQL.html">$trust_groups_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'grp_ID' );
<a name="l4459"><span class="linenum">4459</span></a>                  <a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('trust_groups_SQL')" href="../../_variables/trust_groups_SQL.html">$trust_groups_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_groups' );
<a name="l4460"><span class="linenum">4460</span></a>                  <a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('trust_groups_SQL')" href="../../_variables/trust_groups_SQL.html">$trust_groups_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'grp_name IN ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it6059" onMouseOver="hilite(6059)" onMouseOut="lolite()" onClick="logVariable('trust_groups')" href="../../_variables/trust_groups.html">$trust_groups</a> ).')' );
<a name="l4461"><span class="linenum">4461</span></a>                  <a class="var it6061" onMouseOver="hilite(6061)" onMouseOut="lolite()" onClick="logVariable('trust_groups_IDs')" href="../../_variables/trust_groups_IDs.html">$trust_groups_IDs</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it6060" onMouseOver="hilite(6060)" onMouseOut="lolite()" onClick="logVariable('trust_groups_SQL')" href="../../_variables/trust_groups_SQL.html">$trust_groups_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l4462"><span class="linenum">4462</span></a>                  if( !empty( <a class="var it6061" onMouseOver="hilite(6061)" onMouseOut="lolite()" onClick="logVariable('trust_groups_IDs')" href="../../_variables/trust_groups_IDs.html">$trust_groups_IDs</a> ) )
<a name="l4463"><span class="linenum">4463</span></a>                  { // Save setting value
<a name="l4464"><span class="linenum">4464</span></a>                      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_settings ( set_name, set_value ) VALUES
<a name="l4465"><span class="linenum">4465</span></a>                              ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'antispam_trust_groups' ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it6061" onMouseOver="hilite(6061)" onMouseOut="lolite()" onClick="logVariable('trust_groups_IDs')" href="../../_variables/trust_groups_IDs.html">$trust_groups_IDs</a> ) ).' )' );
<a name="l4466"><span class="linenum">4466</span></a>                  }
<a name="l4467"><span class="linenum">4467</span></a>              }
<a name="l4468"><span class="linenum">4468</span></a>              <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4469"><span class="linenum">4469</span></a>          }
<a name="l4470"><span class="linenum">4470</span></a>  
<a name="l4471"><span class="linenum">4471</span></a>          <span class="comment">/*</span>
<a name="l4472"><span class="linenum">4472</span></a>  <span class="comment">         * ADD UPGRADES FOR i5 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l4473"><span class="linenum">4473</span></a>  <span class="comment">         *</span>
<a name="l4474"><span class="linenum">4474</span></a>  <span class="comment">         * This part will be included in trunk and i5 branches</span>
<a name="l4475"><span class="linenum">4475</span></a>  <span class="comment">         */</span>
<a name="l4476"><span class="linenum">4476</span></a>  
<a name="l4477"><span class="linenum">4477</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11110' );
<a name="l4478"><span class="linenum">4478</span></a>      }
<a name="l4479"><span class="linenum">4479</span></a>  
<a name="l4480"><span class="linenum">4480</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11200 )
<a name="l4481"><span class="linenum">4481</span></a>      { // part 14 trunk aka &quot;i6&quot;
<a name="l4482"><span class="linenum">4482</span></a>  
<a name="l4483"><span class="linenum">4483</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading comments table...' );
<a name="l4484"><span class="linenum">4484</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_comments', 'comment_last_touched_ts', &quot;TIMESTAMP NOT NULL DEFAULT '2000-01-01 00:00:00' AFTER comment_date&quot; );
<a name="l4485"><span class="linenum">4485</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments
<a name="l4486"><span class="linenum">4486</span></a>                          SET comment_last_touched_ts = comment_date' );
<a name="l4487"><span class="linenum">4487</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4488"><span class="linenum">4488</span></a>  
<a name="l4489"><span class="linenum">4489</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Convert email addresses to lowercase... ' );
<a name="l4490"><span class="linenum">4490</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users SET user_email = LOWER( user_email )' );
<a name="l4491"><span class="linenum">4491</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'email__blocked SET emblk_address = LOWER( emblk_address )' );
<a name="l4492"><span class="linenum">4492</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_email__returns SET emret_address = LOWER( emret_address )' );
<a name="l4493"><span class="linenum">4493</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_email__log SET emlog_to = LOWER( emlog_to )' );
<a name="l4494"><span class="linenum">4494</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments
<a name="l4495"><span class="linenum">4495</span></a>                SET comment_author_email = LOWER( comment_author_email )
<a name="l4496"><span class="linenum">4496</span></a>              WHERE comment_author_email IS NOT NULL' );
<a name="l4497"><span class="linenum">4497</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4498"><span class="linenum">4498</span></a>  
<a name="l4499"><span class="linenum">4499</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blogs table...' );
<a name="l4500"><span class="linenum">4500</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_blogs', 'blog_order', 'int(11) NULL DEFAULT NULL' );
<a name="l4501"><span class="linenum">4501</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_blogs
<a name="l4502"><span class="linenum">4502</span></a>                          SET blog_order = blog_ID' );
<a name="l4503"><span class="linenum">4503</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4504"><span class="linenum">4504</span></a>  
<a name="l4505"><span class="linenum">4505</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating general settings...' );
<a name="l4506"><span class="linenum">4506</span></a>          <a class="var it6062" onMouseOver="hilite(6062)" onMouseOut="lolite()" onClick="logVariable('site_skins_enabled')" href="../../_variables/site_skins_enabled.html">$site_skins_enabled</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT set_value
<a name="l4507"><span class="linenum">4507</span></a>               FROM T_settings
<a name="l4508"><span class="linenum">4508</span></a>              WHERE set_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'site_skins_enabled' ) );
<a name="l4509"><span class="linenum">4509</span></a>          if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it6062" onMouseOver="hilite(6062)" onMouseOut="lolite()" onClick="logVariable('site_skins_enabled')" href="../../_variables/site_skins_enabled.html">$site_skins_enabled</a> ) )
<a name="l4510"><span class="linenum">4510</span></a>          { // Insert new setting to disable site skins
<a name="l4511"><span class="linenum">4511</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_settings ( set_name, set_value )
<a name="l4512"><span class="linenum">4512</span></a>                  VALUES ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'site_skins_enabled' ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( '0' ).' )' );
<a name="l4513"><span class="linenum">4513</span></a>          }
<a name="l4514"><span class="linenum">4514</span></a>          elseif( <a class="var it6062" onMouseOver="hilite(6062)" onMouseOut="lolite()" onClick="logVariable('site_skins_enabled')" href="../../_variables/site_skins_enabled.html">$site_skins_enabled</a> == '1' )
<a name="l4515"><span class="linenum">4515</span></a>          { // Disable site skins if it is enabled
<a name="l4516"><span class="linenum">4516</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_settings
<a name="l4517"><span class="linenum">4517</span></a>                    SET set_value = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( '0' ).'
<a name="l4518"><span class="linenum">4518</span></a>                  WHERE set_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'site_skins_enabled' ) );
<a name="l4519"><span class="linenum">4519</span></a>          }
<a name="l4520"><span class="linenum">4520</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4521"><span class="linenum">4521</span></a>  
<a name="l4522"><span class="linenum">4522</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blogs table...' );
<a name="l4523"><span class="linenum">4523</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_blogs', 'blog_favorite', 'TINYINT(1) NOT NULL DEFAULT 1' );
<a name="l4524"><span class="linenum">4524</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4525"><span class="linenum">4525</span></a>  
<a name="l4526"><span class="linenum">4526</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrade table of base domains... ' );
<a name="l4527"><span class="linenum">4527</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_basedomains CHANGE COLUMN dom_status dom_status ENUM('unknown','trusted','suspect','blocked') NOT NULL DEFAULT 'unknown'&quot; );
<a name="l4528"><span class="linenum">4528</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4529"><span class="linenum">4529</span></a>  
<a name="l4530"><span class="linenum">4530</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for file links voting... ' );
<a name="l4531"><span class="linenum">4531</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'links__vote (
<a name="l4532"><span class="linenum">4532</span></a>                  lvot_link_ID       int(11) UNSIGNED NOT NULL,
<a name="l4533"><span class="linenum">4533</span></a>                  lvot_user_ID       int(11) UNSIGNED NOT NULL,
<a name="l4534"><span class="linenum">4534</span></a>                  lvot_like          tinyint(1),
<a name="l4535"><span class="linenum">4535</span></a>                  lvot_inappropriate tinyint(1),
<a name="l4536"><span class="linenum">4536</span></a>                  lvot_spam          tinyint(1),
<a name="l4537"><span class="linenum">4537</span></a>                  primary <a class="phpfunction" onClick="logFunction('key')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a> (lvot_link_ID, lvot_user_ID)
<a name="l4538"><span class="linenum">4538</span></a>              ) ENGINE = innodb' );
<a name="l4539"><span class="linenum">4539</span></a>  
<a name="l4540"><span class="linenum">4540</span></a>  <span class="comment">        // Convert all file votes to link votes</span>
<a name="l4541"><span class="linenum">4541</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'links__vote ( lvot_link_ID, lvot_user_ID, lvot_like, lvot_inappropriate, lvot_spam )
<a name="l4542"><span class="linenum">4542</span></a>                          SELECT link_ID, fvot_user_ID, fvot_like, fvot_inappropriate, fvot_spam
<a name="l4543"><span class="linenum">4543</span></a>                          FROM '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'files__vote
<a name="l4544"><span class="linenum">4544</span></a>                          LEFT JOIN T_links ON link_file_ID = fvot_file_ID
<a name="l4545"><span class="linenum">4545</span></a>                          WHERE link_ID IS NOT NULL' );
<a name="l4546"><span class="linenum">4546</span></a>  
<a name="l4547"><span class="linenum">4547</span></a>  <span class="comment">        // Delete old file voting table</span>
<a name="l4548"><span class="linenum">4548</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DROP TABLE IF EXISTS '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'files__vote' );
<a name="l4549"><span class="linenum">4549</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4550"><span class="linenum">4550</span></a>  
<a name="l4551"><span class="linenum">4551</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for goal categories... ' );
<a name="l4552"><span class="linenum">4552</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_track__goalcat (
<a name="l4553"><span class="linenum">4553</span></a>                  gcat_ID     int(10) unsigned NOT NULL auto_increment,
<a name="l4554"><span class="linenum">4554</span></a>                  gcat_name   varchar(50) default NULL,
<a name="l4555"><span class="linenum">4555</span></a>                  gcat_color  char(7) default NULL,
<a name="l4556"><span class="linenum">4556</span></a>                  PRIMARY <a class="phpfunction" onClick="logFunction('KEY')" href="../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">KEY</a> (gcat_ID)
<a name="l4557"><span class="linenum">4557</span></a>              ) ENGINE = myisam' );
<a name="l4558"><span class="linenum">4558</span></a>  <span class="comment">        // Insert default goal category</span>
<a name="l4559"><span class="linenum">4559</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_track__goalcat ( gcat_name, gcat_color )
<a name="l4560"><span class="linenum">4560</span></a>              VALUES ( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'Default' ).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( '#999999' ).' )' );
<a name="l4561"><span class="linenum">4561</span></a>          <a class="var it6063" onMouseOver="hilite(6063)" onMouseOut="lolite()" onClick="logVariable('default_goalcat_ID')" href="../../_variables/default_goalcat_ID.html">$default_goalcat_ID</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('insert_id')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/insert_id.html">insert_id</a>;
<a name="l4562"><span class="linenum">4562</span></a>  
<a name="l4563"><span class="linenum">4563</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_track__goal', 'goal_gcat_ID', 'int(10) unsigned NOT NULL DEFAULT &quot;'.<a class="var it6063" onMouseOver="hilite(6063)" onMouseOut="lolite()" onClick="logVariable('default_goalcat_ID')" href="../../_variables/default_goalcat_ID.html">$default_goalcat_ID</a>.'&quot; AFTER goal_ID' );
<a name="l4564"><span class="linenum">4564</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_track__goal
<a name="l4565"><span class="linenum">4565</span></a>              CHANGE goal_gcat_ID goal_gcat_ID int(10) unsigned NOT NULL' );
<a name="l4566"><span class="linenum">4566</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4567"><span class="linenum">4567</span></a>  
<a name="l4568"><span class="linenum">4568</span></a>  <span class="comment">        // This task was not required, but we would like to make sure that we have future proof link_datecreated and link_datemodified fields.</span>
<a name="l4569"><span class="linenum">4569</span></a>  <span class="comment">        // There were previous versions, when these fields were set to '1970-01-01' because the $localtimenow was not initialized during the install script</span>
<a name="l4570"><span class="linenum">4570</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Update links table...' );
<a name="l4571"><span class="linenum">4571</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_links SET link_datecreated = concat( '2000-01-01 ', <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>( link_datecreated ) )
<a name="l4572"><span class="linenum">4572</span></a>                          WHERE <a class="phpfunction" onClick="logFunction('date')" href="../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( link_datecreated ) = '1970-01-01'&quot; );
<a name="l4573"><span class="linenum">4573</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;UPDATE T_links SET link_datemodified = concat( '2000-01-01 ', <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>( link_datemodified ) )
<a name="l4574"><span class="linenum">4574</span></a>                          WHERE <a class="phpfunction" onClick="logFunction('date')" href="../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( link_datemodified ) = '1970-01-01'&quot; );
<a name="l4575"><span class="linenum">4575</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4576"><span class="linenum">4576</span></a>  
<a name="l4577"><span class="linenum">4577</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Blogs table...' );
<a name="l4578"><span class="linenum">4578</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_blogs CHANGE blog_description blog_shortdesc varchar(250) NULL default &quot;&quot;' );
<a name="l4579"><span class="linenum">4579</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4580"><span class="linenum">4580</span></a>  
<a name="l4581"><span class="linenum">4581</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Comments table...' );
<a name="l4582"><span class="linenum">4582</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_comments
<a name="l4583"><span class="linenum">4583</span></a>              CHANGE comment_post_ID   comment_item_ID        int(11) unsigned NOT NULL default 0,
<a name="l4584"><span class="linenum">4584</span></a>              CHANGE comment_author_ID comment_author_user_ID int unsigned NULL default NULL,
<a name="l4585"><span class="linenum">4585</span></a>              DROP INDEX comment_post_ID,
<a name="l4586"><span class="linenum">4586</span></a>              ADD KEY comment_item_ID ( comment_item_ID )' );
<a name="l4587"><span class="linenum">4587</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4588"><span class="linenum">4588</span></a>  
<a name="l4589"><span class="linenum">4589</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Files table...' );
<a name="l4590"><span class="linenum">4590</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_files
<a name="l4591"><span class="linenum">4591</span></a>              DROP INDEX file,
<a name="l4592"><span class="linenum">4592</span></a>              ADD COLUMN file_path_hash char(32) default NULL' );
<a name="l4593"><span class="linenum">4593</span></a>  <span class="comment">        // Change file path length to the max allowed value</span>
<a name="l4594"><span class="linenum">4594</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_files CHANGE COLUMN file_path file_path VARCHAR(767) NOT NULL DEFAULT ''&quot; );
<a name="l4595"><span class="linenum">4595</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_files SET file_path_hash = MD5( CONCAT( file_root_type, file_root_ID, file_path ) )');
<a name="l4596"><span class="linenum">4596</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_files ADD UNIQUE <a class="function" onClick="logFunction('file_path')" href="../../_functions/file_path.html" onMouseOver="funcPopup(event,'file_path')">file_path</a> (file_path_hash)' );
<a name="l4597"><span class="linenum">4597</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4598"><span class="linenum">4598</span></a>  
<a name="l4599"><span class="linenum">4599</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for email campaigns... ' );
<a name="l4600"><span class="linenum">4600</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_email__campaign (
<a name="l4601"><span class="linenum">4601</span></a>              ecmp_ID          INT NOT NULL AUTO_INCREMENT,
<a name="l4602"><span class="linenum">4602</span></a>              ecmp_date_ts     TIMESTAMP NOT NULL DEFAULT \'2000-01-01 00:00:00\',
<a name="l4603"><span class="linenum">4603</span></a>              ecmp_name        VARCHAR(255) NOT NULL,
<a name="l4604"><span class="linenum">4604</span></a>              ecmp_email_title VARCHAR(255) NULL,
<a name="l4605"><span class="linenum">4605</span></a>              ecmp_email_html  TEXT NULL,
<a name="l4606"><span class="linenum">4606</span></a>              ecmp_email_text  TEXT NULL,
<a name="l4607"><span class="linenum">4607</span></a>              ecmp_sent_ts     TIMESTAMP NULL,
<a name="l4608"><span class="linenum">4608</span></a>              PRIMARY KEY      (ecmp_ID)
<a name="l4609"><span class="linenum">4609</span></a>              ) ENGINE = myisam' );
<a name="l4610"><span class="linenum">4610</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4611"><span class="linenum">4611</span></a>  
<a name="l4612"><span class="linenum">4612</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Create table for email campaign send data... ' );
<a name="l4613"><span class="linenum">4613</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'CREATE TABLE T_email__campaign_send (
<a name="l4614"><span class="linenum">4614</span></a>              csnd_camp_ID  INT(11) UNSIGNED NOT NULL,
<a name="l4615"><span class="linenum">4615</span></a>              csnd_user_ID  INT(11) UNSIGNED NOT NULL,
<a name="l4616"><span class="linenum">4616</span></a>              csnd_emlog_ID INT(11) UNSIGNED NULL,
<a name="l4617"><span class="linenum">4617</span></a>              PRIMARY KEY   csnd_PK ( csnd_camp_ID, csnd_user_ID )
<a name="l4618"><span class="linenum">4618</span></a>              ) ENGINE = myisam' );
<a name="l4619"><span class="linenum">4619</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4620"><span class="linenum">4620</span></a>  
<a name="l4621"><span class="linenum">4621</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Rename table &quot;email blocked&quot; to &quot;email address&quot;... ' );
<a name="l4622"><span class="linenum">4622</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'RENAME TABLE '.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.'email__blocked TO T_email__address' );
<a name="l4623"><span class="linenum">4623</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_email__address
<a name="l4624"><span class="linenum">4624</span></a>              CHANGE emblk_ID                    emadr_ID                    INT(10) UNSIGNED NOT NULL auto_increment,
<a name="l4625"><span class="linenum">4625</span></a>              CHANGE emblk_address               emadr_address               VARCHAR(255) DEFAULT NULL,
<a name="l4626"><span class="linenum">4626</span></a>              CHANGE emblk_status                emadr_status                ENUM ( 'unknown', 'warning', 'suspicious1', 'suspicious2', 'suspicious3', 'prmerror', 'spammer' ) NOT NULL DEFAULT 'unknown',
<a name="l4627"><span class="linenum">4627</span></a>              CHANGE emblk_sent_count            emadr_sent_count            INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l4628"><span class="linenum">4628</span></a>              CHANGE emblk_sent_last_returnerror emadr_sent_last_returnerror INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l4629"><span class="linenum">4629</span></a>              CHANGE emblk_prmerror_count        emadr_prmerror_count        INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l4630"><span class="linenum">4630</span></a>              CHANGE emblk_tmperror_count        emadr_tmperror_count        INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l4631"><span class="linenum">4631</span></a>              CHANGE emblk_spamerror_count       emadr_spamerror_count       INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l4632"><span class="linenum">4632</span></a>              CHANGE emblk_othererror_count      emadr_othererror_count      INT(10) UNSIGNED NOT NULL DEFAULT 0,
<a name="l4633"><span class="linenum">4633</span></a>              CHANGE emblk_last_sent_ts          emadr_last_sent_ts          TIMESTAMP NULL,
<a name="l4634"><span class="linenum">4634</span></a>              CHANGE emblk_last_error_ts         emadr_last_error_ts         TIMESTAMP NULL,
<a name="l4635"><span class="linenum">4635</span></a>              DROP INDEX emblk_address,
<a name="l4636"><span class="linenum">4636</span></a>              ADD UNIQUE emadr_address ( emadr_address )&quot; );
<a name="l4637"><span class="linenum">4637</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4638"><span class="linenum">4638</span></a>  
<a name="l4639"><span class="linenum">4639</span></a>  <span class="comment">        // Add new email status 'redemption'</span>
<a name="l4640"><span class="linenum">4640</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading table of email addresses...' );
<a name="l4641"><span class="linenum">4641</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_email__address
<a name="l4642"><span class="linenum">4642</span></a>              CHANGE emadr_status   emadr_status ENUM ( 'unknown', 'redemption', 'warning', 'suspicious1', 'suspicious2', 'suspicious3', 'prmerror', 'spammer' ) NOT NULL DEFAULT 'unknown'&quot; );
<a name="l4643"><span class="linenum">4643</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4644"><span class="linenum">4644</span></a>  
<a name="l4645"><span class="linenum">4645</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blog-group permissions table...' );
<a name="l4646"><span class="linenum">4646</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_group_perms', 'bloggroup_can_be_assignee', 'tinyint NOT NULL default 0 AFTER bloggroup_ismember' );
<a name="l4647"><span class="linenum">4647</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_coll_group_perms
<a name="l4648"><span class="linenum">4648</span></a>                SET bloggroup_can_be_assignee = 1
<a name="l4649"><span class="linenum">4649</span></a>              WHERE bloggroup_group_ID IN ( 1, 2 )' );
<a name="l4650"><span class="linenum">4650</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4651"><span class="linenum">4651</span></a>  
<a name="l4652"><span class="linenum">4652</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading blog-user permissions table...' );
<a name="l4653"><span class="linenum">4653</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_coll_user_perms', 'bloguser_can_be_assignee', 'tinyint NOT NULL default 0 AFTER bloguser_ismember' );
<a name="l4654"><span class="linenum">4654</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4655"><span class="linenum">4655</span></a>  
<a name="l4656"><span class="linenum">4656</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Dropping obsolete columns from table Links...' );
<a name="l4657"><span class="linenum">4657</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_links
<a name="l4658"><span class="linenum">4658</span></a>                                      DROP COLUMN link_external_url,
<a name="l4659"><span class="linenum">4659</span></a>                                      DROP COLUMN link_title,
<a name="l4660"><span class="linenum">4660</span></a>                                      DROP COLUMN link_dest_itm_ID' );
<a name="l4661"><span class="linenum">4661</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4662"><span class="linenum">4662</span></a>  
<a name="l4663"><span class="linenum">4663</span></a>  <span class="comment">        // This task was added later to turn OFF smart view counting on upgrade from v5.0 to v5.1 for better performance</span>
<a name="l4664"><span class="linenum">4664</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Turn off smart view counting...' );
<a name="l4665"><span class="linenum">4665</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_settings WHERE set_name = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( 'smart_view_count' ) );
<a name="l4666"><span class="linenum">4666</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4667"><span class="linenum">4667</span></a>  
<a name="l4668"><span class="linenum">4668</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Posts table...' );
<a name="l4669"><span class="linenum">4669</span></a>          <a class="function" onClick="logFunction('db_drop_col')" href="../../_functions/db_drop_col.html" onMouseOver="funcPopup(event,'db_drop_col')">db_drop_col</a>( 'T_items__item', 'post_views' );
<a name="l4670"><span class="linenum">4670</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4671"><span class="linenum">4671</span></a>  
<a name="l4672"><span class="linenum">4672</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading Files table... ' );
<a name="l4673"><span class="linenum">4673</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_files
<a name="l4674"><span class="linenum">4674</span></a>              CHANGE COLUMN file_root_type file_root_type enum('absolute','user','collection','shared','skins','import') not null default 'absolute'&quot; );
<a name="l4675"><span class="linenum">4675</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4676"><span class="linenum">4676</span></a>  
<a name="l4677"><span class="linenum">4677</span></a>  <span class="comment">        // Set flag to recreate autogenerated excerpts due to modifications on the excerpt generation</span>
<a name="l4678"><span class="linenum">4678</span></a>  <span class="comment">        // Note: We need to generate this in the end of the upgrade script, because the database must be up to date</span>
<a name="l4679"><span class="linenum">4679</span></a>          <a class="var it5979" onMouseOver="hilite(5979)" onMouseOut="lolite()" onClick="logVariable('recreate_autogenerated_excerpts')" href="../../_variables/recreate_autogenerated_excerpts.html">$recreate_autogenerated_excerpts</a> = true;
<a name="l4680"><span class="linenum">4680</span></a>  
<a name="l4681"><span class="linenum">4681</span></a>          <span class="comment">/*</span>
<a name="l4682"><span class="linenum">4682</span></a>  <span class="comment">         * ADD UPGRADES FOR i6 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l4683"><span class="linenum">4683</span></a>  <span class="comment">         *</span>
<a name="l4684"><span class="linenum">4684</span></a>  <span class="comment">         * This part will be included in trunk and i6 branches</span>
<a name="l4685"><span class="linenum">4685</span></a>  <span class="comment">         */</span>
<a name="l4686"><span class="linenum">4686</span></a>  
<a name="l4687"><span class="linenum">4687</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11200' );
<a name="l4688"><span class="linenum">4688</span></a>      }
<a name="l4689"><span class="linenum">4689</span></a>  
<a name="l4690"><span class="linenum">4690</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11208 )
<a name="l4691"><span class="linenum">4691</span></a>      { // part 15.a trunk aka second part of &quot;i6&quot;
<a name="l4692"><span class="linenum">4692</span></a>  
<a name="l4693"><span class="linenum">4693</span></a>  <span class="comment">        // Note create a separate block for the hitlog upgrade because it may require very long time</span>
<a name="l4694"><span class="linenum">4694</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrade hitlog table...' );
<a name="l4695"><span class="linenum">4695</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_hitlog
<a name="l4696"><span class="linenum">4696</span></a>              CHANGE COLUMN hit_ID            hit_ID            INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
<a name="l4697"><span class="linenum">4697</span></a>              CHANGE COLUMN hit_datetime      hit_datetime      TIMESTAMP NOT NULL DEFAULT \'2000-01-01 00:00:00\',
<a name="l4698"><span class="linenum">4698</span></a>              CHANGE COLUMN hit_serprank      hit_serprank      SMALLINT UNSIGNED DEFAULT NULL,
<a name="l4699"><span class="linenum">4699</span></a>              CHANGE COLUMN hit_blog_ID       hit_coll_ID       INT(10) UNSIGNED NULL DEFAULT NULL,
<a name="l4700"><span class="linenum">4700</span></a>              CHANGE COLUMN hit_response_code hit_response_code SMALLINT DEFAULT NULL,
<a name="l4701"><span class="linenum">4701</span></a>              ADD COLUMN hit_agent_ID SMALLINT UNSIGNED NULL DEFAULT NULL AFTER hit_agent_type,
<a name="l4702"><span class="linenum">4702</span></a>              DROP INDEX hit_blog_ID,
<a name="l4703"><span class="linenum">4703</span></a>              ADD KEY hit_coll_ID ( hit_coll_ID )' );
<a name="l4704"><span class="linenum">4704</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4705"><span class="linenum">4705</span></a>  
<a name="l4706"><span class="linenum">4706</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11208' );
<a name="l4707"><span class="linenum">4707</span></a>      }
<a name="l4708"><span class="linenum">4708</span></a>  
<a name="l4709"><span class="linenum">4709</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11210 )
<a name="l4710"><span class="linenum">4710</span></a>      { // part 15.b trunk aka third part of &quot;i6&quot;
<a name="l4711"><span class="linenum">4711</span></a>  
<a name="l4712"><span class="linenum">4712</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating widgets setting...' );
<a name="l4713"><span class="linenum">4713</span></a>  <span class="comment">        // Unset those widgets allow blockcache value which current settings allow blockcache but the caching is always forbidden on runtime;</span>
<a name="l4714"><span class="linenum">4714</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_widget
<a name="l4715"><span class="linenum">4715</span></a>                  SET wi_params = <a class="function" onClick="logFunction('REPLACE')" href="../../_functions/replace.html" onMouseOver="funcPopup(event,'replace')">REPLACE</a>( wi_params, \'s:16:&quot;allow_blockcache&quot;;i:1\', \'s:16:&quot;allow_blockcache&quot;;i:0\' )
<a name="l4716"><span class="linenum">4716</span></a>                  WHERE wi_params LIKE \'%s:16:&quot;allow_blockcache&quot;;i:1%\' AND (
<a name="l4717"><span class="linenum">4717</span></a>                      wi_code = &quot;user_tools&quot; OR wi_code = &quot;user_login&quot; OR ( wi_code = &quot;msg_menu_link&quot; AND wi_params LIKE \'%s:9:&quot;link_type&quot;;s:8:&quot;messages&quot;%\' )
<a name="l4718"><span class="linenum">4718</span></a>                      OR ( wi_code = &quot;menu_link&quot; AND ( wi_params LIKE \'%s:9:&quot;link_type&quot;;s:5:&quot;login&quot;%\' OR wi_params LIKE \'%s:9:&quot;link_type&quot;;s:8:&quot;register&quot;%\' ) )
<a name="l4719"><span class="linenum">4719</span></a>                      )' );
<a name="l4720"><span class="linenum">4720</span></a>  <span class="comment">        // Unset 'show_badge' setting in case of msg_menu_link widgets where the link_type is contacts</span>
<a name="l4721"><span class="linenum">4721</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_widget
<a name="l4722"><span class="linenum">4722</span></a>                  SET wi_params = <a class="function" onClick="logFunction('REPLACE')" href="../../_functions/replace.html" onMouseOver="funcPopup(event,'replace')">REPLACE</a>( wi_params, \'s:10:&quot;show_badge&quot;;i:1\', \'s:10:&quot;show_badge&quot;;i:0\' )
<a name="l4723"><span class="linenum">4723</span></a>                  WHERE wi_code = &quot;msg_menu_link&quot; AND wi_params LIKE \'%s:9:&quot;link_type&quot;;s:8:&quot;contacts&quot;%\' AND wi_params LIKE \'%s:10:&quot;show_badge&quot;;i:1%\'' );
<a name="l4724"><span class="linenum">4724</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4725"><span class="linenum">4725</span></a>  
<a name="l4726"><span class="linenum">4726</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating files hash values...' );
<a name="l4727"><span class="linenum">4727</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_files MODIFY COLUMN file_hash VARBINARY(32), MODIFY COLUMN file_path_hash VARBINARY(32)' );
<a name="l4728"><span class="linenum">4728</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_files SET file_hash = UNHEX( file_hash ), file_path_hash = UNHEX( file_path_hash )' );
<a name="l4729"><span class="linenum">4729</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_files MODIFY COLUMN file_hash BINARY(16) default NULL, MODIFY COLUMN file_path_hash BINARY(16) default NULL' );
<a name="l4730"><span class="linenum">4730</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4731"><span class="linenum">4731</span></a>  
<a name="l4732"><span class="linenum">4732</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading goals table...' );
<a name="l4733"><span class="linenum">4733</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_track__goal
<a name="l4734"><span class="linenum">4734</span></a>              ADD COLUMN goal_temp_redir_url varchar(255) default NULL AFTER goal_redir_url,
<a name="l4735"><span class="linenum">4735</span></a>              ADD COLUMN goal_temp_start_ts  TIMESTAMP NULL            AFTER goal_temp_redir_url,
<a name="l4736"><span class="linenum">4736</span></a>              ADD COLUMN goal_temp_end_ts    TIMESTAMP NULL            AFTER goal_temp_start_ts,
<a name="l4737"><span class="linenum">4737</span></a>              ADD COLUMN goal_notes          TEXT DEFAULT NULL' );
<a name="l4738"><span class="linenum">4738</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4739"><span class="linenum">4739</span></a>  
<a name="l4740"><span class="linenum">4740</span></a>          <span class="comment">/*</span>
<a name="l4741"><span class="linenum">4741</span></a>  <span class="comment">         * ADD UPGRADES FOR i6 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l4742"><span class="linenum">4742</span></a>  <span class="comment">         *</span>
<a name="l4743"><span class="linenum">4743</span></a>  <span class="comment">         * This part will be included in trunk and i6 branches</span>
<a name="l4744"><span class="linenum">4744</span></a>  <span class="comment">         */</span>
<a name="l4745"><span class="linenum">4745</span></a>  
<a name="l4746"><span class="linenum">4746</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11210' );
<a name="l4747"><span class="linenum">4747</span></a>      }
<a name="l4748"><span class="linenum">4748</span></a>  
<a name="l4749"><span class="linenum">4749</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11220 )
<a name="l4750"><span class="linenum">4750</span></a>      { // part 16.a trunk aka fourth part of &quot;i6&quot;
<a name="l4751"><span class="linenum">4751</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Upgrading countries table...' );
<a name="l4752"><span class="linenum">4752</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_regional__country
<a name="l4753"><span class="linenum">4753</span></a>              ADD COLUMN ctry_status      enum( \'trusted\', \'suspect\', \'blocked\' ) NULL DEFAULT NULL,
<a name="l4754"><span class="linenum">4754</span></a>              ADD COLUMN ctry_block_count int(10) unsigned DEFAULT 0' );
<a name="l4755"><span class="linenum">4755</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4756"><span class="linenum">4756</span></a>  
<a name="l4757"><span class="linenum">4757</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11220' );
<a name="l4758"><span class="linenum">4758</span></a>      }
<a name="l4759"><span class="linenum">4759</span></a>  
<a name="l4760"><span class="linenum">4760</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11230 )
<a name="l4761"><span class="linenum">4761</span></a>      { // part 16.b trunk aka fifth part of &quot;i6&quot;
<a name="l4762"><span class="linenum">4762</span></a>  
<a name="l4763"><span class="linenum">4763</span></a>  <span class="comment">        // This upgrade block updates all char, enum and set colums collation to 'ascii_bin'.</span>
<a name="l4764"><span class="linenum">4764</span></a>  <span class="comment">        // Also all varchar columns are updated which may contain only ascii characters.</span>
<a name="l4765"><span class="linenum">4765</span></a>  
<a name="l4766"><span class="linenum">4766</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating groups table...' );
<a name="l4767"><span class="linenum">4767</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_groups
<a name="l4768"><span class="linenum">4768</span></a>              MODIFY grp_perm_blogs enum('user','viewall','editall') COLLATE ascii_bin NOT NULL default 'user',
<a name="l4769"><span class="linenum">4769</span></a>              MODIFY grp_perm_xhtmlvalidation VARCHAR(10) COLLATE ascii_bin NOT NULL default 'always',
<a name="l4770"><span class="linenum">4770</span></a>              MODIFY grp_perm_xhtmlvalidation_xmlrpc  VARCHAR(10) COLLATE ascii_bin NOT NULL default 'always',
<a name="l4771"><span class="linenum">4771</span></a>              MODIFY grp_perm_stats enum('none','user','view','edit') COLLATE ascii_bin NOT NULL default 'none'&quot; );
<a name="l4772"><span class="linenum">4772</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4773"><span class="linenum">4773</span></a>  
<a name="l4774"><span class="linenum">4774</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating group settings table...' );
<a name="l4775"><span class="linenum">4775</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_groups__groupsettings MODIFY gset_name VARCHAR(30) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4776"><span class="linenum">4776</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4777"><span class="linenum">4777</span></a>  
<a name="l4778"><span class="linenum">4778</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating settings table...' );
<a name="l4779"><span class="linenum">4779</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_settings MODIFY set_name VARCHAR(30) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4780"><span class="linenum">4780</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4781"><span class="linenum">4781</span></a>  
<a name="l4782"><span class="linenum">4782</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating global cahce table...' );
<a name="l4783"><span class="linenum">4783</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_global__cache MODIFY cach_name VARCHAR(30) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4784"><span class="linenum">4784</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4785"><span class="linenum">4785</span></a>  
<a name="l4786"><span class="linenum">4786</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating users table...' );
<a name="l4787"><span class="linenum">4787</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_users
<a name="l4788"><span class="linenum">4788</span></a>              MODIFY user_email varchar(255) COLLATE ascii_bin NOT NULL,
<a name="l4789"><span class="linenum">4789</span></a>              MODIFY user_status enum( 'activated', 'autoactivated', 'closed', 'deactivated', 'emailchanged', 'failedactivation', 'new' ) COLLATE ascii_bin NOT NULL default 'new',
<a name="l4790"><span class="linenum">4790</span></a>              MODIFY user_pass CHAR(32) COLLATE ascii_bin NOT NULL,
<a name="l4791"><span class="linenum">4791</span></a>              MODIFY user_gender CHAR(1) COLLATE ascii_bin NULL,
<a name="l4792"><span class="linenum">4792</span></a>              MODIFY user_unsubscribe_key CHAR(32) COLLATE ascii_bin NOT NULL default '' COMMENT 'A specific key, it is used when a user wants to unsubscribe from a post comments without signing in'&quot; );
<a name="l4793"><span class="linenum">4793</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4794"><span class="linenum">4794</span></a>  
<a name="l4795"><span class="linenum">4795</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating user field definitions table...' );
<a name="l4796"><span class="linenum">4796</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_users__fielddefs
<a name="l4797"><span class="linenum">4797</span></a>              MODIFY ufdf_type CHAR(8) COLLATE ascii_bin NOT NULL,
<a name="l4798"><span class="linenum">4798</span></a>              MODIFY ufdf_required enum('hidden','optional','recommended','require') COLLATE ascii_bin NOT NULL default 'optional',
<a name="l4799"><span class="linenum">4799</span></a>              MODIFY ufdf_duplicated enum('forbidden','allowed','list') COLLATE ascii_bin NOT NULL default 'allowed'&quot; );
<a name="l4800"><span class="linenum">4800</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4801"><span class="linenum">4801</span></a>  
<a name="l4802"><span class="linenum">4802</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating user report table...' );
<a name="l4803"><span class="linenum">4803</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_users__reports
<a name="l4804"><span class="linenum">4804</span></a>              MODIFY urep_status enum('fake', 'guidelines', 'harass', 'spam', 'other') COLLATE ascii_bin&quot; );
<a name="l4805"><span class="linenum">4805</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4806"><span class="linenum">4806</span></a>  
<a name="l4807"><span class="linenum">4807</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating locales table...' );
<a name="l4808"><span class="linenum">4808</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_locales
<a name="l4809"><span class="linenum">4809</span></a>              MODIFY loc_charset varchar(15) COLLATE ascii_bin NOT NULL default 'iso-8859-1',
<a name="l4810"><span class="linenum">4810</span></a>              MODIFY loc_datefmt varchar(20) COLLATE ascii_bin NOT NULL default 'y-m-d',
<a name="l4811"><span class="linenum">4811</span></a>              MODIFY loc_timefmt varchar(20) COLLATE ascii_bin NOT NULL default 'H:i:s'&quot; );
<a name="l4812"><span class="linenum">4812</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4813"><span class="linenum">4813</span></a>  
<a name="l4814"><span class="linenum">4814</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating antispam keyword table...' );
<a name="l4815"><span class="linenum">4815</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE &quot;.<a class="var it748" onMouseOver="hilite(748)" onMouseOut="lolite()" onClick="logVariable('tableprefix')" href="../../_variables/tableprefix.html">$tableprefix</a>.&quot;antispam
<a name="l4816"><span class="linenum">4816</span></a>              MODIFY aspm_source enum( 'local','reported','central' ) COLLATE ascii_bin NOT NULL default 'reported'&quot; );
<a name="l4817"><span class="linenum">4817</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4818"><span class="linenum">4818</span></a>  
<a name="l4819"><span class="linenum">4819</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating antispam iprange table...' );
<a name="l4820"><span class="linenum">4820</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_antispam__iprange
<a name="l4821"><span class="linenum">4821</span></a>              MODIFY aipr_status enum('trusted', 'suspect', 'blocked') COLLATE ascii_bin NULL DEFAULT NULL&quot; );
<a name="l4822"><span class="linenum">4822</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4823"><span class="linenum">4823</span></a>  
<a name="l4824"><span class="linenum">4824</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating user settings table...' );
<a name="l4825"><span class="linenum">4825</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_users__usersettings MODIFY uset_name VARCHAR(30) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4826"><span class="linenum">4826</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4827"><span class="linenum">4827</span></a>  
<a name="l4828"><span class="linenum">4828</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating plugins table...' );
<a name="l4829"><span class="linenum">4829</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_plugins
<a name="l4830"><span class="linenum">4830</span></a>              MODIFY plug_classname VARCHAR(40) COLLATE ascii_bin NOT NULL default '',
<a name="l4831"><span class="linenum">4831</span></a>              MODIFY plug_code VARCHAR(32) COLLATE ascii_bin NULL,
<a name="l4832"><span class="linenum">4832</span></a>              MODIFY plug_version VARCHAR(42) COLLATE ascii_bin NOT NULL default '0',
<a name="l4833"><span class="linenum">4833</span></a>              MODIFY plug_status ENUM( 'enabled', 'disabled', 'needs_config', 'broken' ) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4834"><span class="linenum">4834</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4835"><span class="linenum">4835</span></a>  
<a name="l4836"><span class="linenum">4836</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating plugin settings table...' );
<a name="l4837"><span class="linenum">4837</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_pluginsettings MODIFY pset_name VARCHAR(30) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4838"><span class="linenum">4838</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4839"><span class="linenum">4839</span></a>  
<a name="l4840"><span class="linenum">4840</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating plugin user settings table...' );
<a name="l4841"><span class="linenum">4841</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_pluginusersettings MODIFY puset_name VARCHAR(30) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4842"><span class="linenum">4842</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4843"><span class="linenum">4843</span></a>  
<a name="l4844"><span class="linenum">4844</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating plugin events table...' );
<a name="l4845"><span class="linenum">4845</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_pluginevents MODIFY pevt_event VARCHAR(40) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4846"><span class="linenum">4846</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4847"><span class="linenum">4847</span></a>  
<a name="l4848"><span class="linenum">4848</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating cron tasks table...' );
<a name="l4849"><span class="linenum">4849</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_cron__task MODIFY ctsk_controller varchar(50) COLLATE ascii_bin not null&quot; );
<a name="l4850"><span class="linenum">4850</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4851"><span class="linenum">4851</span></a>  
<a name="l4852"><span class="linenum">4852</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating cron logs table...' );
<a name="l4853"><span class="linenum">4853</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_cron__log
<a name="l4854"><span class="linenum">4854</span></a>              MODIFY clog_status enum('started','finished','error','timeout') COLLATE ascii_bin not null default 'started'&quot; );
<a name="l4855"><span class="linenum">4855</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4856"><span class="linenum">4856</span></a>  
<a name="l4857"><span class="linenum">4857</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating regional tables...' );
<a name="l4858"><span class="linenum">4858</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_regional__country
<a name="l4859"><span class="linenum">4859</span></a>              MODIFY ctry_code CHAR(2) COLLATE ascii_bin NOT NULL,
<a name="l4860"><span class="linenum">4860</span></a>              MODIFY ctry_status enum('trusted', 'suspect', 'blocked') COLLATE ascii_bin NULL DEFAULT NULL&quot; );
<a name="l4861"><span class="linenum">4861</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_regional__region MODIFY rgn_code CHAR(6) COLLATE ascii_bin NOT NULL' );
<a name="l4862"><span class="linenum">4862</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_regional__subregion MODIFY subrg_code CHAR(6) COLLATE ascii_bin NOT NULL' );
<a name="l4863"><span class="linenum">4863</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_regional__city MODIFY city_postcode CHAR(12) COLLATE ascii_bin NOT NULL' );
<a name="l4864"><span class="linenum">4864</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_regional__currency MODIFY curr_code CHAR(3) COLLATE ascii_bin NOT NULL' );
<a name="l4865"><span class="linenum">4865</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4866"><span class="linenum">4866</span></a>  
<a name="l4867"><span class="linenum">4867</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating slugs table...' );
<a name="l4868"><span class="linenum">4868</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_slug
<a name="l4869"><span class="linenum">4869</span></a>              MODIFY slug_title varchar(255) COLLATE ascii_bin NOT NULL,
<a name="l4870"><span class="linenum">4870</span></a>              MODIFY slug_type char(6) COLLATE ascii_bin NOT NULL DEFAULT 'item'&quot; );
<a name="l4871"><span class="linenum">4871</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4872"><span class="linenum">4872</span></a>  
<a name="l4873"><span class="linenum">4873</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating email log table...' );
<a name="l4874"><span class="linenum">4874</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_email__log
<a name="l4875"><span class="linenum">4875</span></a>              MODIFY emlog_to VARCHAR(255) COLLATE ascii_bin DEFAULT NULL,
<a name="l4876"><span class="linenum">4876</span></a>              MODIFY emlog_result ENUM('ok', 'error', 'blocked') COLLATE ascii_bin NOT NULL DEFAULT 'ok'&quot; );
<a name="l4877"><span class="linenum">4877</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4878"><span class="linenum">4878</span></a>  
<a name="l4879"><span class="linenum">4879</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating email returns table...' );
<a name="l4880"><span class="linenum">4880</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_email__returns
<a name="l4881"><span class="linenum">4881</span></a>              MODIFY emret_address VARCHAR(255) COLLATE ascii_bin DEFAULT NULL,
<a name="l4882"><span class="linenum">4882</span></a>              MODIFY emret_errtype CHAR(1) COLLATE ascii_bin NOT NULL DEFAULT 'U'&quot; );
<a name="l4883"><span class="linenum">4883</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4884"><span class="linenum">4884</span></a>  
<a name="l4885"><span class="linenum">4885</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating email address table...' );
<a name="l4886"><span class="linenum">4886</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_email__address
<a name="l4887"><span class="linenum">4887</span></a>              MODIFY emadr_address VARCHAR(255) COLLATE ascii_bin DEFAULT NULL,
<a name="l4888"><span class="linenum">4888</span></a>              MODIFY emadr_status ENUM('unknown', 'redemption', 'warning', 'suspicious1', 'suspicious2', 'suspicious3', 'prmerror', 'spammer') COLLATE ascii_bin NOT NULL DEFAULT 'unknown'&quot; );
<a name="l4889"><span class="linenum">4889</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4890"><span class="linenum">4890</span></a>  
<a name="l4891"><span class="linenum">4891</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating skins table...' );
<a name="l4892"><span class="linenum">4892</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_skins__skin
<a name="l4893"><span class="linenum">4893</span></a>              MODIFY skin_type enum('normal', 'feed', 'sitemap', 'mobile', 'tablet') COLLATE ascii_bin NOT NULL default 'normal'&quot; );
<a name="l4894"><span class="linenum">4894</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4895"><span class="linenum">4895</span></a>  
<a name="l4896"><span class="linenum">4896</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating blogs table...' );
<a name="l4897"><span class="linenum">4897</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_blogs
<a name="l4898"><span class="linenum">4898</span></a>              MODIFY blog_access_type VARCHAR(10) COLLATE ascii_bin NOT NULL DEFAULT 'extrapath',
<a name="l4899"><span class="linenum">4899</span></a>              MODIFY blog_urlname VARCHAR(255) COLLATE ascii_bin NOT NULL DEFAULT 'urlname',
<a name="l4900"><span class="linenum">4900</span></a>              MODIFY blog_media_location ENUM( 'default', 'subdir', 'custom', 'none' ) COLLATE ascii_bin DEFAULT 'default' NOT NULL,
<a name="l4901"><span class="linenum">4901</span></a>              MODIFY blog_type ENUM( 'std', 'photo', 'group', 'forum', 'manual' ) COLLATE ascii_bin DEFAULT 'std' NOT NULL&quot; );
<a name="l4902"><span class="linenum">4902</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4903"><span class="linenum">4903</span></a>  
<a name="l4904"><span class="linenum">4904</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating collection settings table...' );
<a name="l4905"><span class="linenum">4905</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_settings MODIFY cset_name VARCHAR( 50 ) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4906"><span class="linenum">4906</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4907"><span class="linenum">4907</span></a>  
<a name="l4908"><span class="linenum">4908</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating components table...' );
<a name="l4909"><span class="linenum">4909</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_widget
<a name="l4910"><span class="linenum">4910</span></a>              MODIFY wi_type ENUM( 'core', 'plugin' ) COLLATE ascii_bin NOT NULL DEFAULT 'core',
<a name="l4911"><span class="linenum">4911</span></a>              MODIFY wi_code VARCHAR(32) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4912"><span class="linenum">4912</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4913"><span class="linenum">4913</span></a>  
<a name="l4914"><span class="linenum">4914</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating categories table...' );
<a name="l4915"><span class="linenum">4915</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_categories MODIFY cat_urlname varchar(255) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4916"><span class="linenum">4916</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4917"><span class="linenum">4917</span></a>  
<a name="l4918"><span class="linenum">4918</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating posts table...' );
<a name="l4919"><span class="linenum">4919</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item
<a name="l4920"><span class="linenum">4920</span></a>              MODIFY post_status enum('published','community','deprecated','protected','private','review','draft','redirected') COLLATE ascii_bin NOT NULL default 'published',
<a name="l4921"><span class="linenum">4921</span></a>              MODIFY post_urltitle VARCHAR(210) COLLATE ascii_bin NOT NULL,
<a name="l4922"><span class="linenum">4922</span></a>              MODIFY post_notifications_status ENUM('noreq','todo','started','finished') COLLATE ascii_bin NOT NULL DEFAULT 'noreq',
<a name="l4923"><span class="linenum">4923</span></a>              MODIFY post_comment_status ENUM('disabled', 'open', 'closed') COLLATE ascii_bin NOT NULL DEFAULT 'open'&quot; );
<a name="l4924"><span class="linenum">4924</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4925"><span class="linenum">4925</span></a>  
<a name="l4926"><span class="linenum">4926</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating comments table...' );
<a name="l4927"><span class="linenum">4927</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_comments
<a name="l4928"><span class="linenum">4928</span></a>              MODIFY comment_type ENUM('comment','linkback','trackback','pingback') COLLATE ascii_bin NOT NULL default 'comment',
<a name="l4929"><span class="linenum">4929</span></a>              MODIFY comment_status ENUM('published','community','deprecated','protected','private','review','draft','trash') COLLATE ascii_bin DEFAULT 'published' NOT NULL,
<a name="l4930"><span class="linenum">4930</span></a>              MODIFY comment_author_email VARCHAR(255) COLLATE ascii_bin NULL,
<a name="l4931"><span class="linenum">4931</span></a>              MODIFY comment_author_IP VARCHAR(23) COLLATE ascii_bin NOT NULL default '',
<a name="l4932"><span class="linenum">4932</span></a>              MODIFY comment_secret CHAR(32) COLLATE ascii_bin NULL default NULL,
<a name="l4933"><span class="linenum">4933</span></a>              MODIFY comment_notif_status ENUM('noreq','todo','started','finished') COLLATE ascii_bin NOT NULL DEFAULT 'noreq' COMMENT 'Have notifications been sent for this comment? How far are we in the process?'&quot; );
<a name="l4934"><span class="linenum">4934</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4935"><span class="linenum">4935</span></a>  
<a name="l4936"><span class="linenum">4936</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating item prerendering cache table...' );
<a name="l4937"><span class="linenum">4937</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__prerendering
<a name="l4938"><span class="linenum">4938</span></a>              MODIFY itpr_format ENUM('htmlbody','entityencoded','xml','text') COLLATE ascii_bin NOT NULL&quot; );
<a name="l4939"><span class="linenum">4939</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4940"><span class="linenum">4940</span></a>  
<a name="l4941"><span class="linenum">4941</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating comment prerendering cache table...' );
<a name="l4942"><span class="linenum">4942</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_comments__prerendering
<a name="l4943"><span class="linenum">4943</span></a>              MODIFY cmpr_format ENUM('htmlbody','entityencoded','xml','text') COLLATE ascii_bin NOT NULL&quot; );
<a name="l4944"><span class="linenum">4944</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4945"><span class="linenum">4945</span></a>  
<a name="l4946"><span class="linenum">4946</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating item versions table...' );
<a name="l4947"><span class="linenum">4947</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__version
<a name="l4948"><span class="linenum">4948</span></a>              MODIFY iver_status ENUM('published','community','deprecated','protected','private','review','draft','redirected') COLLATE ascii_bin NULL&quot; );
<a name="l4949"><span class="linenum">4949</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4950"><span class="linenum">4950</span></a>  
<a name="l4951"><span class="linenum">4951</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating item settings table...' );
<a name="l4952"><span class="linenum">4952</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_items__item_settings MODIFY iset_name varchar( 50 ) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4953"><span class="linenum">4953</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4954"><span class="linenum">4954</span></a>  
<a name="l4955"><span class="linenum">4955</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating blog-user permissions table...' );
<a name="l4956"><span class="linenum">4956</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_user_perms
<a name="l4957"><span class="linenum">4957</span></a>              MODIFY bloguser_perm_poststatuses <a class="function" onClick="logFunction('SET')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">SET</a>('review','draft','private','protected','deprecated','community','published','redirected') COLLATE ascii_bin NOT NULL default '',
<a name="l4958"><span class="linenum">4958</span></a>              MODIFY bloguser_perm_edit ENUM('no','own','lt','le','all','redirected') COLLATE ascii_bin NOT NULL default 'no',
<a name="l4959"><span class="linenum">4959</span></a>              MODIFY bloguser_perm_cmtstatuses <a class="function" onClick="logFunction('SET')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">SET</a>('review','draft','private','protected','deprecated','community','published') COLLATE ascii_bin NOT NULL default '',
<a name="l4960"><span class="linenum">4960</span></a>              MODIFY bloguser_perm_edit_cmt ENUM('no','own','anon','lt','le','all') COLLATE ascii_bin NOT NULL default 'no'&quot; );
<a name="l4961"><span class="linenum">4961</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4962"><span class="linenum">4962</span></a>  
<a name="l4963"><span class="linenum">4963</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating blog-group permissions table...' );
<a name="l4964"><span class="linenum">4964</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_coll_group_perms
<a name="l4965"><span class="linenum">4965</span></a>              MODIFY bloggroup_perm_poststatuses <a class="function" onClick="logFunction('SET')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">SET</a>('review','draft','private','protected','deprecated','community','published','redirected') COLLATE ascii_bin NOT NULL default '',
<a name="l4966"><span class="linenum">4966</span></a>              MODIFY bloggroup_perm_edit ENUM('no','own','lt','le','all','redirected') COLLATE ascii_bin NOT NULL default 'no',
<a name="l4967"><span class="linenum">4967</span></a>              MODIFY bloggroup_perm_cmtstatuses <a class="function" onClick="logFunction('SET')" href="../../_functions/set.html" onMouseOver="funcPopup(event,'set')">SET</a>('review','draft','private','protected','deprecated','community','published') COLLATE ascii_bin NOT NULL default '',
<a name="l4968"><span class="linenum">4968</span></a>              MODIFY bloggroup_perm_edit_cmt ENUM('no','own','anon','lt','le','all') COLLATE ascii_bin NOT NULL default 'no'&quot; );
<a name="l4969"><span class="linenum">4969</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4970"><span class="linenum">4970</span></a>  
<a name="l4971"><span class="linenum">4971</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating links table...' );
<a name="l4972"><span class="linenum">4972</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_links MODIFY link_position varchar(10) COLLATE ascii_bin NOT NULL&quot; );
<a name="l4973"><span class="linenum">4973</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4974"><span class="linenum">4974</span></a>  
<a name="l4975"><span class="linenum">4975</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating files table...' );
<a name="l4976"><span class="linenum">4976</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_files
<a name="l4977"><span class="linenum">4977</span></a>              MODIFY file_root_type enum('absolute','user','collection','shared','skins','import') COLLATE ascii_bin NOT NULL DEFAULT 'absolute'&quot; );
<a name="l4978"><span class="linenum">4978</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4979"><span class="linenum">4979</span></a>  
<a name="l4980"><span class="linenum">4980</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating file types table...' );
<a name="l4981"><span class="linenum">4981</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_filetypes
<a name="l4982"><span class="linenum">4982</span></a>              MODIFY ftyp_extensions varchar(30) COLLATE ascii_bin NOT NULL,
<a name="l4983"><span class="linenum">4983</span></a>              MODIFY ftyp_viewtype varchar(10) COLLATE ascii_bin NOT NULL,
<a name="l4984"><span class="linenum">4984</span></a>              MODIFY ftyp_allowed enum('any','registered','admin') COLLATE ascii_bin NOT NULL default 'admin'&quot; );
<a name="l4985"><span class="linenum">4985</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l4986"><span class="linenum">4986</span></a>  
<a name="l4987"><span class="linenum">4987</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11230' );
<a name="l4988"><span class="linenum">4988</span></a>      }
<a name="l4989"><span class="linenum">4989</span></a>  
<a name="l4990"><span class="linenum">4990</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11235 )
<a name="l4991"><span class="linenum">4991</span></a>      { // part 16.c trunk aka sixth part of &quot;i6&quot;
<a name="l4992"><span class="linenum">4992</span></a>  
<a name="l4993"><span class="linenum">4993</span></a>  <span class="comment">        // A separate upgrade block was created to update collations in the sessions module, because the T_hitlog update may require long time.</span>
<a name="l4994"><span class="linenum">4994</span></a>  
<a name="l4995"><span class="linenum">4995</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating sessions table...' );
<a name="l4996"><span class="linenum">4996</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_sessions
<a name="l4997"><span class="linenum">4997</span></a>              MODIFY sess_key CHAR(32) COLLATE ascii_bin NULL,
<a name="l4998"><span class="linenum">4998</span></a>              MODIFY sess_ipaddress VARCHAR(39) COLLATE ascii_bin NOT NULL DEFAULT '',
<a name="l4999"><span class="linenum">4999</span></a>              MODIFY sess_device VARCHAR(8) COLLATE ascii_bin NOT NULL DEFAULT ''&quot; );
<a name="l5000"><span class="linenum">5000</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5001"><span class="linenum">5001</span></a>  
<a name="l5002"><span class="linenum">5002</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating base domains table...' );
<a name="l5003"><span class="linenum">5003</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_basedomains
<a name="l5004"><span class="linenum">5004</span></a>              MODIFY dom_status ENUM('unknown','trusted','suspect','blocked') COLLATE ascii_bin NOT NULL DEFAULT 'unknown',
<a name="l5005"><span class="linenum">5005</span></a>              MODIFY dom_type ENUM('unknown','normal','searcheng','aggregator','email') COLLATE ascii_bin NOT NULL DEFAULT 'unknown'&quot; );
<a name="l5006"><span class="linenum">5006</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5007"><span class="linenum">5007</span></a>  
<a name="l5008"><span class="linenum">5008</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating hit logs table...' );
<a name="l5009"><span class="linenum">5009</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;ALTER TABLE T_hitlog
<a name="l5010"><span class="linenum">5010</span></a>              MODIFY hit_ctrl VARCHAR(30) COLLATE ascii_bin DEFAULT NULL,
<a name="l5011"><span class="linenum">5011</span></a>              MODIFY hit_type ENUM('standard','rss','admin','ajax', 'service') COLLATE ascii_bin DEFAULT 'standard' NOT NULL,
<a name="l5012"><span class="linenum">5012</span></a>              MODIFY hit_referer_type ENUM('search','special','spam','referer','direct','self') COLLATE ascii_bin NOT NULL,
<a name="l5013"><span class="linenum">5013</span></a>              MODIFY hit_remote_addr VARCHAR(40) COLLATE ascii_bin DEFAULT NULL,
<a name="l5014"><span class="linenum">5014</span></a>              MODIFY hit_agent_type ENUM('robot','browser','unknown') COLLATE ascii_bin DEFAULT 'unknown' NOT NULL&quot; );
<a name="l5015"><span class="linenum">5015</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5016"><span class="linenum">5016</span></a>  
<a name="l5017"><span class="linenum">5017</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating goal categories table...' );
<a name="l5018"><span class="linenum">5018</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'ALTER TABLE T_track__goalcat MODIFY gcat_color CHAR(7) COLLATE ascii_bin default NULL' );
<a name="l5019"><span class="linenum">5019</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5020"><span class="linenum">5020</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11235' );
<a name="l5021"><span class="linenum">5021</span></a>      }
<a name="l5022"><span class="linenum">5022</span></a>  
<a name="l5023"><span class="linenum">5023</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11240 )
<a name="l5024"><span class="linenum">5024</span></a>      { // part 16.d trunk aka seventh part of &quot;i6&quot;
<a name="l5025"><span class="linenum">5025</span></a>  
<a name="l5026"><span class="linenum">5026</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating general settings...' );
<a name="l5027"><span class="linenum">5027</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_settings SET
<a name="l5028"><span class="linenum">5028</span></a>              set_name = CASE
<a name="l5029"><span class="linenum">5029</span></a>                  WHEN set_name = &quot;user_closing_allow&quot; THEN &quot;account_close_enabled&quot;
<a name="l5030"><span class="linenum">5030</span></a>                  WHEN set_name = &quot;user_closing_intro&quot; THEN &quot;account_close_intro&quot;
<a name="l5031"><span class="linenum">5031</span></a>                  WHEN set_name = &quot;user_closing_reasons&quot; THEN &quot;account_close_reasons&quot;
<a name="l5032"><span class="linenum">5032</span></a>                  WHEN set_name = &quot;user_closing_byemsg&quot; THEN &quot;account_close_byemsg&quot;
<a name="l5033"><span class="linenum">5033</span></a>                  ELSE set_name
<a name="l5034"><span class="linenum">5034</span></a>              END' );
<a name="l5035"><span class="linenum">5035</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5036"><span class="linenum">5036</span></a>  
<a name="l5037"><span class="linenum">5037</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11240' );
<a name="l5038"><span class="linenum">5038</span></a>      }
<a name="l5039"><span class="linenum">5039</span></a>  
<a name="l5040"><span class="linenum">5040</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11245 )
<a name="l5041"><span class="linenum">5041</span></a>      { // part 16.e trunk aka eighth part of &quot;i6&quot;
<a name="l5042"><span class="linenum">5042</span></a>  
<a name="l5043"><span class="linenum">5043</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating Antispam IP Ranges table...' );
<a name="l5044"><span class="linenum">5044</span></a>          <a class="function" onClick="logFunction('db_add_col')" href="../../_functions/db_add_col.html" onMouseOver="funcPopup(event,'db_add_col')">db_add_col</a>( 'T_antispam__iprange', 'aipr_contact_email_count', 'int(10) unsigned DEFAULT 0 AFTER aipr_user_count' );
<a name="l5045"><span class="linenum">5045</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5046"><span class="linenum">5046</span></a>  
<a name="l5047"><span class="linenum">5047</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating invalid locale settings...' );
<a name="l5048"><span class="linenum">5048</span></a>          <a class="var it2811" onMouseOver="hilite(2811)" onMouseOut="lolite()" onClick="logVariable('current_default_locale')" href="../../_variables/current_default_locale.html">$current_default_locale</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT set_value FROM T_settings WHERE set_name = &quot;default_locale&quot;' );
<a name="l5049"><span class="linenum">5049</span></a>          if( empty( <a class="var it2811" onMouseOver="hilite(2811)" onMouseOut="lolite()" onClick="logVariable('current_default_locale')" href="../../_variables/current_default_locale.html">$current_default_locale</a> ) )
<a name="l5050"><span class="linenum">5050</span></a>          { // The default locale is not set in the database, use the one from the config file
<a name="l5051"><span class="linenum">5051</span></a>              global <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>;
<a name="l5052"><span class="linenum">5052</span></a>              <a class="var it2811" onMouseOver="hilite(2811)" onMouseOut="lolite()" onClick="logVariable('current_default_locale')" href="../../_variables/current_default_locale.html">$current_default_locale</a> = <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>;
<a name="l5053"><span class="linenum">5053</span></a>          }
<a name="l5054"><span class="linenum">5054</span></a>          if( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT loc_enabled FROM T_locales WHERE loc_locale = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it2811" onMouseOver="hilite(2811)" onMouseOut="lolite()" onClick="logVariable('current_default_locale')" href="../../_variables/current_default_locale.html">$current_default_locale</a> ) ) )
<a name="l5055"><span class="linenum">5055</span></a>          { // Update invalid user and collection locales to the default, but only if the default exists and it is enabled
<a name="l5056"><span class="linenum">5056</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users
<a name="l5057"><span class="linenum">5057</span></a>                  SET user_locale = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it2811" onMouseOver="hilite(2811)" onMouseOut="lolite()" onClick="logVariable('current_default_locale')" href="../../_variables/current_default_locale.html">$current_default_locale</a> ).'
<a name="l5058"><span class="linenum">5058</span></a>                  WHERE  user_locale NOT IN ( SELECT loc_locale FROM T_locales WHERE loc_enabled = 1 )'
<a name="l5059"><span class="linenum">5059</span></a>              );
<a name="l5060"><span class="linenum">5060</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_blogs
<a name="l5061"><span class="linenum">5061</span></a>                  SET blog_locale = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it2811" onMouseOver="hilite(2811)" onMouseOut="lolite()" onClick="logVariable('current_default_locale')" href="../../_variables/current_default_locale.html">$current_default_locale</a> ).'
<a name="l5062"><span class="linenum">5062</span></a>                  WHERE  blog_locale NOT IN ( SELECT loc_locale FROM T_locales WHERE loc_enabled = 1 )'
<a name="l5063"><span class="linenum">5063</span></a>              );
<a name="l5064"><span class="linenum">5064</span></a>          }
<a name="l5065"><span class="linenum">5065</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5066"><span class="linenum">5066</span></a>  
<a name="l5067"><span class="linenum">5067</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11245' );
<a name="l5068"><span class="linenum">5068</span></a>      }
<a name="l5069"><span class="linenum">5069</span></a>  
<a name="l5070"><span class="linenum">5070</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11250 )
<a name="l5071"><span class="linenum">5071</span></a>      { // part 16.f trunk aka ninth part of &quot;i6&quot;
<a name="l5072"><span class="linenum">5072</span></a>  
<a name="l5073"><span class="linenum">5073</span></a>  <span class="comment">        // Convert item content separators to new format</span>
<a name="l5074"><span class="linenum">5074</span></a>          <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('tools/model/_dbmaintenance.funcs.php');
<a name="l5075"><span class="linenum">5075</span></a>          <a class="function" onClick="logFunction('dbm_convert_item_content_separators')" href="../../_functions/dbm_convert_item_content_separators.html" onMouseOver="funcPopup(event,'dbm_convert_item_content_separators')">dbm_convert_item_content_separators</a>();
<a name="l5076"><span class="linenum">5076</span></a>          <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( '11250' );
<a name="l5077"><span class="linenum">5077</span></a>      }
<a name="l5078"><span class="linenum">5078</span></a>  
<a name="l5079"><span class="linenum">5079</span></a>      if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> &lt; 11255 )
<a name="l5080"><span class="linenum">5080</span></a>      { // part 16.g trunk aka tenth part of &quot;i6&quot;
<a name="l5081"><span class="linenum">5081</span></a>  
<a name="l5082"><span class="linenum">5082</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Updating post types...' );
<a name="l5083"><span class="linenum">5083</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;INSERT INTO T_items__type ( ptyp_ID, ptyp_name )
<a name="l5084"><span class="linenum">5084</span></a>              VALUES ( 1400, 'Intro-Front' )&quot; );
<a name="l5085"><span class="linenum">5085</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5086"><span class="linenum">5086</span></a>  
<a name="l5087"><span class="linenum">5087</span></a>          <span class="comment">/*</span>
<a name="l5088"><span class="linenum">5088</span></a>  <span class="comment">         * ADD UPGRADES FOR i6 BRANCH __ABOVE__ IN THIS BLOCK.</span>
<a name="l5089"><span class="linenum">5089</span></a>  <span class="comment">         *</span>
<a name="l5090"><span class="linenum">5090</span></a>  <span class="comment">         * This part will be included in trunk and i6 branches</span>
<a name="l5091"><span class="linenum">5091</span></a>  <span class="comment">         */</span>
<a name="l5092"><span class="linenum">5092</span></a>  
<a name="l5093"><span class="linenum">5093</span></a>  <span class="comment">        // set_upgrade_checkpoint( '11255' );</span>
<a name="l5094"><span class="linenum">5094</span></a>      }
<a name="l5095"><span class="linenum">5095</span></a>  
<a name="l5096"><span class="linenum">5096</span></a>  <span class="comment">    // Execute general upgrade tasks.</span>
<a name="l5097"><span class="linenum">5097</span></a>  <span class="comment">    // These tasks needs to be called after every upgrade process, except if they were already executed but the upgrade was not finished because of the max execution time check.</span>
<a name="l5098"><span class="linenum">5098</span></a>      if( <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'exec_general_tasks', 'boolean', 1 ) )
<a name="l5099"><span class="linenum">5099</span></a>      {    // We haven't executed these general tasks yet:
<a name="l5100"><span class="linenum">5100</span></a>  
<a name="l5101"><span class="linenum">5101</span></a>  <span class="comment">        // Update modules own b2evo tables</span>
<a name="l5102"><span class="linenum">5102</span></a>          echo &quot;Calling modules for individual upgrades...&lt;br&gt;\n&quot;;
<a name="l5103"><span class="linenum">5103</span></a>          <a class="function" onClick="logFunction('evo_flush')" href="../../_functions/evo_flush.html" onMouseOver="funcPopup(event,'evo_flush')">evo_flush</a>();
<a name="l5104"><span class="linenum">5104</span></a>          <a class="function" onClick="logFunction('modules_call_method')" href="../../_functions/modules_call_method.html" onMouseOver="funcPopup(event,'modules_call_method')">modules_call_method</a>( 'upgrade_b2evo_tables' );
<a name="l5105"><span class="linenum">5105</span></a>  
<a name="l5106"><span class="linenum">5106</span></a>  <span class="comment">        // Just in case, make sure the db schema version is up to date at the end.</span>
<a name="l5107"><span class="linenum">5107</span></a>          if( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> != <a class="var it4135" onMouseOver="hilite(4135)" onMouseOut="lolite()" onClick="logVariable('new_db_version')" href="../../_variables/new_db_version.html">$new_db_version</a> )
<a name="l5108"><span class="linenum">5108</span></a>          { // Update DB schema version to <a class="var it4135" onMouseOver="hilite(4135)" onMouseOut="lolite()" onClick="logVariable('new_db_version')" href="../../_variables/new_db_version.html">$new_db_version</a>
<a name="l5109"><span class="linenum">5109</span></a>              <a class="function" onClick="logFunction('set_upgrade_checkpoint')" href="../../_functions/set_upgrade_checkpoint.html" onMouseOver="funcPopup(event,'set_upgrade_checkpoint')">set_upgrade_checkpoint</a>( <a class="var it4135" onMouseOver="hilite(4135)" onMouseOut="lolite()" onClick="logVariable('new_db_version')" href="../../_variables/new_db_version.html">$new_db_version</a> );
<a name="l5110"><span class="linenum">5110</span></a>          }
<a name="l5111"><span class="linenum">5111</span></a>  
<a name="l5112"><span class="linenum">5112</span></a>  <span class="comment">        // We're going to need some environment in order to init caches and create profile picture links...</span>
<a name="l5113"><span class="linenum">5113</span></a>          if( ! <a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>( <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../_variables/Settings.html">$Settings</a> ) )
<a name="l5114"><span class="linenum">5114</span></a>          { // create Settings object
<a name="l5115"><span class="linenum">5115</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'settings/model/_generalsettings.class.php', 'GeneralSettings' );
<a name="l5116"><span class="linenum">5116</span></a>              <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../_variables/Settings.html">$Settings</a> = <span class="keyword">new </span><a class="class" onClick="logClass('GeneralSettings')" href="../../_classes/generalsettings.html" onMouseOver="classPopup(event,'generalsettings')">GeneralSettings</a>();
<a name="l5117"><span class="linenum">5117</span></a>          }
<a name="l5118"><span class="linenum">5118</span></a>          if( ! <a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>( <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../_variables/Plugins.html">$Plugins</a> ) )
<a name="l5119"><span class="linenum">5119</span></a>          { // create Plugins object
<a name="l5120"><span class="linenum">5120</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'plugins/model/_plugins.class.php', 'Plugins' );
<a name="l5121"><span class="linenum">5121</span></a>              <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../_variables/Plugins.html">$Plugins</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Plugins')" href="../../_classes/plugins.html" onMouseOver="classPopup(event,'plugins')">Plugins</a>();
<a name="l5122"><span class="linenum">5122</span></a>          }
<a name="l5123"><span class="linenum">5123</span></a>  
<a name="l5124"><span class="linenum">5124</span></a>  <span class="comment">        // Init Caches: (it should be possible to do this with each upgrade)</span>
<a name="l5125"><span class="linenum">5125</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( '(Re-)Initializing caches...' );
<a name="l5126"><span class="linenum">5126</span></a>          <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('tools/model/_system.funcs.php');
<a name="l5127"><span class="linenum">5127</span></a>          if( <a class="function" onClick="logFunction('system_init_caches')" href="../../_functions/system_init_caches.html" onMouseOver="funcPopup(event,'system_init_caches')">system_init_caches</a>() )
<a name="l5128"><span class="linenum">5128</span></a>          { // cache was initialized successfully
<a name="l5129"><span class="linenum">5129</span></a>  <span class="comment">            // Check all cache folders if exist and work properly. Try to repair cache folders if they aren't ready for operation.</span>
<a name="l5130"><span class="linenum">5130</span></a>              <a class="function" onClick="logFunction('system_check_caches')" href="../../_functions/system_check_caches.html" onMouseOver="funcPopup(event,'system_check_caches')">system_check_caches</a>();
<a name="l5131"><span class="linenum">5131</span></a>          }
<a name="l5132"><span class="linenum">5132</span></a>          else
<a name="l5133"><span class="linenum">5133</span></a>          {
<a name="l5134"><span class="linenum">5134</span></a>              echo &quot;&lt;strong&gt;&quot;.<a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The /cache folder could not be created/written to. b2evolution will still work but without caching, which will make it operate slower than optimal.').&quot;&lt;/strong&gt;&lt;br /&gt;\n&quot;;
<a name="l5135"><span class="linenum">5135</span></a>          }
<a name="l5136"><span class="linenum">5136</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5137"><span class="linenum">5137</span></a>  
<a name="l5138"><span class="linenum">5138</span></a>  <span class="comment">        // Check if profile picture links should be recreated. It won't be executed in each upgrade, but only in those cases when it is required.</span>
<a name="l5139"><span class="linenum">5139</span></a>  <span class="comment">        // This requires an up to date database, and also $Plugins and $GeneralSettings objects must be initialized before this.</span>
<a name="l5140"><span class="linenum">5140</span></a>  <span class="comment">        // Note: Check $create_profile_picture_links intialization and usage above to get more information.</span>
<a name="l5141"><span class="linenum">5141</span></a>          if( <a class="var it6054" onMouseOver="hilite(6054)" onMouseOut="lolite()" onClick="logVariable('create_profile_picture_links')" href="../../_variables/create_profile_picture_links.html">$create_profile_picture_links</a> )
<a name="l5142"><span class="linenum">5142</span></a>          { // Create links for all files from the users profile_pictures folder
<a name="l5143"><span class="linenum">5143</span></a>              <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Creating profile picture links...' );
<a name="l5144"><span class="linenum">5144</span></a>              <a class="function" onClick="logFunction('create_profile_picture_links')" href="../../_functions/create_profile_picture_links.html" onMouseOver="funcPopup(event,'create_profile_picture_links')">create_profile_picture_links</a>();
<a name="l5145"><span class="linenum">5145</span></a>              <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5146"><span class="linenum">5146</span></a>          }
<a name="l5147"><span class="linenum">5147</span></a>  
<a name="l5148"><span class="linenum">5148</span></a>  <span class="comment">        // Invalidate all page caches after every upgrade.</span>
<a name="l5149"><span class="linenum">5149</span></a>  <span class="comment">        // A new version of b2evolution may not use the same links to access special pages.</span>
<a name="l5150"><span class="linenum">5150</span></a>  <span class="comment">        // We want to play it safe here so that people don't think that upgrading broke their blog!</span>
<a name="l5151"><span class="linenum">5151</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Invalidating all page caches to make sure they don\'t contain old action links...' );
<a name="l5152"><span class="linenum">5152</span></a>          <a class="function" onClick="logFunction('invalidate_pagecaches')" href="../../_functions/invalidate_pagecaches.html" onMouseOver="funcPopup(event,'invalidate_pagecaches')">invalidate_pagecaches</a>();
<a name="l5153"><span class="linenum">5153</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5154"><span class="linenum">5154</span></a>  
<a name="l5155"><span class="linenum">5155</span></a>  
<a name="l5156"><span class="linenum">5156</span></a>  <span class="comment">        // Reload plugins after every upgrade, to detect even those changes on plugins which didn't require db modifications</span>
<a name="l5157"><span class="linenum">5157</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Reloading installed plugins to make sure their config is up to date...' );
<a name="l5158"><span class="linenum">5158</span></a>          <a class="var it39" onMouseOver="hilite(39)" onMouseOut="lolite()" onClick="logVariable('Plugins_admin')" href="../../_variables/Plugins_admin.html">$Plugins_admin</a> = &amp; get_Plugins_admin();
<a name="l5159"><span class="linenum">5159</span></a>          <a class="var it39" onMouseOver="hilite(39)" onMouseOut="lolite()" onClick="logVariable('Plugins_admin')" href="../../_variables/Plugins_admin.html">$Plugins_admin</a>-&gt;<a class="function" onClick="logFunction('reload_plugins')" href="../../_functions/reload_plugins.html" onMouseOver="funcPopup(event,'reload_plugins')">reload_plugins</a>();
<a name="l5160"><span class="linenum">5160</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5161"><span class="linenum">5161</span></a>  
<a name="l5162"><span class="linenum">5162</span></a>  
<a name="l5163"><span class="linenum">5163</span></a>  <span class="comment">        // This has to be at the end because plugin install may fail if the DB schema is not current (matching Plugins class).</span>
<a name="l5164"><span class="linenum">5164</span></a>  <span class="comment">        // Only new default plugins will be installed, based on $old_db_version.</span>
<a name="l5165"><span class="linenum">5165</span></a>  <span class="comment">        // dh&gt; NOTE: if this fails (e.g. fatal error in one of the plugins), it will not get repeated</span>
<a name="l5166"><span class="linenum">5166</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Installing new default <a class="function" onClick="logFunction('plugins')" href="../../_functions/plugins.html" onMouseOver="funcPopup(event,'plugins')">plugins</a> (if any)...' );
<a name="l5167"><span class="linenum">5167</span></a>          <a class="function" onClick="logFunction('install_basic_plugins')" href="../../_functions/install_basic_plugins.html" onMouseOver="funcPopup(event,'install_basic_plugins')">install_basic_plugins</a>( <a class="var it5443" onMouseOver="hilite(5443)" onMouseOut="lolite()" onClick="logVariable('old_db_version')" href="../../_variables/old_db_version.html">$old_db_version</a> );
<a name="l5168"><span class="linenum">5168</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5169"><span class="linenum">5169</span></a>  
<a name="l5170"><span class="linenum">5170</span></a>  <span class="comment">        // Create default cron jobs (this can be done at each upgrade):</span>
<a name="l5171"><span class="linenum">5171</span></a>          echo &quot;Checking if some default cron jobs need to be installed...&lt;br/&gt;\n&quot;;
<a name="l5172"><span class="linenum">5172</span></a>          <a class="function" onClick="logFunction('evo_flush')" href="../../_functions/evo_flush.html" onMouseOver="funcPopup(event,'evo_flush')">evo_flush</a>();
<a name="l5173"><span class="linenum">5173</span></a>          require_once <a class="phpfunction" onClick="logFunction('dirname')" href="../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(__FILE__).'/_functions_create.php';
<a name="l5174"><span class="linenum">5174</span></a>          <a class="function" onClick="logFunction('create_default_jobs')" href="../../_functions/create_default_jobs.html" onMouseOver="funcPopup(event,'create_default_jobs')">create_default_jobs</a>( true );
<a name="l5175"><span class="linenum">5175</span></a>  
<a name="l5176"><span class="linenum">5176</span></a>  <span class="comment">        // &quot;Time running low&quot; test: Check if the upgrade script elapsed time is close to the max execution time.</span>
<a name="l5177"><span class="linenum">5177</span></a>  <span class="comment">        // Note: This should not really happen except the case when many plugins must be installed.</span>
<a name="l5178"><span class="linenum">5178</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Checking timing of upgrade...' );
<a name="l5179"><span class="linenum">5179</span></a>          <a class="var it5980" onMouseOver="hilite(5980)" onMouseOut="lolite()" onClick="logVariable('elapsed_time')" href="../../_variables/elapsed_time.html">$elapsed_time</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() - <a class="var it3765" onMouseOver="hilite(3765)" onMouseOut="lolite()" onClick="logVariable('script_start_time')" href="../../_variables/script_start_time.html">$script_start_time</a>;
<a name="l5180"><span class="linenum">5180</span></a>          <a class="var it5981" onMouseOver="hilite(5981)" onMouseOut="lolite()" onClick="logVariable('max_exe_time')" href="../../_variables/max_exe_time.html">$max_exe_time</a> = <a class="phpfunction" onClick="logFunction('ini_get')" href="../../_functions/ini_get.html" onMouseOver="phpfuncPopup(event,'ini_get')">ini_get</a>( 'max_execution_time' );
<a name="l5181"><span class="linenum">5181</span></a>          if( <a class="var it5981" onMouseOver="hilite(5981)" onMouseOut="lolite()" onClick="logVariable('max_exe_time')" href="../../_variables/max_exe_time.html">$max_exe_time</a> &amp;&amp; ( <a class="var it5980" onMouseOver="hilite(5980)" onMouseOut="lolite()" onClick="logVariable('elapsed_time')" href="../../_variables/elapsed_time.html">$elapsed_time</a> &gt; ( <a class="var it5981" onMouseOver="hilite(5981)" onMouseOut="lolite()" onClick="logVariable('max_exe_time')" href="../../_variables/max_exe_time.html">$max_exe_time</a> - 20 ) ) )
<a name="l5182"><span class="linenum">5182</span></a>          { // Max exe time not disabled and we're recahing the end
<a name="l5183"><span class="linenum">5183</span></a>  <span class="comment">            // URL to continue the upgrade process from install folder</span>
<a name="l5184"><span class="linenum">5184</span></a>              <a class="var it5983" onMouseOver="hilite(5983)" onMouseOut="lolite()" onClick="logVariable('recreate_excerpts')" href="../../_variables/recreate_excerpts.html">$recreate_excerpts</a> = <a class="var it5979" onMouseOver="hilite(5979)" onMouseOut="lolite()" onClick="logVariable('recreate_autogenerated_excerpts')" href="../../_variables/recreate_autogenerated_excerpts.html">$recreate_autogenerated_excerpts</a> ? '&amp;amp;recreate_excerpts=1' : '';
<a name="l5185"><span class="linenum">5185</span></a>              <a class="var it6064" onMouseOver="hilite(6064)" onMouseOut="lolite()" onClick="logVariable('upgrade_continue_url')" href="../../_variables/upgrade_continue_url.html">$upgrade_continue_url</a> = <a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../_variables/baseurl.html">$baseurl</a>.'install/index.php?locale='.<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('locale')" href="../../_variables/locale.html">$locale</a>.'&amp;amp;action='.<a class="var it5982" onMouseOver="hilite(5982)" onMouseOut="lolite()" onClick="logVariable('upgrade_action')" href="../../_variables/upgrade_action.html">$upgrade_action</a>.'&amp;amp;exec_general_tasks=0'.<a class="var it5983" onMouseOver="hilite(5983)" onMouseOut="lolite()" onClick="logVariable('recreate_excerpts')" href="../../_variables/recreate_excerpts.html">$recreate_excerpts</a>;
<a name="l5186"><span class="linenum">5186</span></a>              echo 'We are reaching the time limit for this script. Please click &lt;a href=&quot;'.<a class="var it6064" onMouseOver="hilite(6064)" onMouseOut="lolite()" onClick="logVariable('upgrade_continue_url')" href="../../_variables/upgrade_continue_url.html">$upgrade_continue_url</a>.'&quot;&gt;continue&lt;/a&gt;...';
<a name="l5187"><span class="linenum">5187</span></a>  <span class="comment">            // Dirty temporary solution:</span>
<a name="l5188"><span class="linenum">5188</span></a>              exit(0);
<a name="l5189"><span class="linenum">5189</span></a>          }
<a name="l5190"><span class="linenum">5190</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5191"><span class="linenum">5191</span></a>      }
<a name="l5192"><span class="linenum">5192</span></a>  
<a name="l5193"><span class="linenum">5193</span></a>      if( <a class="var it5979" onMouseOver="hilite(5979)" onMouseOut="lolite()" onClick="logVariable('recreate_autogenerated_excerpts')" href="../../_variables/recreate_autogenerated_excerpts.html">$recreate_autogenerated_excerpts</a> )
<a name="l5194"><span class="linenum">5194</span></a>      {
<a name="l5195"><span class="linenum">5195</span></a>          if( ! <a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>( <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../_variables/Settings.html">$Settings</a> ) )
<a name="l5196"><span class="linenum">5196</span></a>          { // create Settings object
<a name="l5197"><span class="linenum">5197</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'settings/model/_generalsettings.class.php', 'GeneralSettings' );
<a name="l5198"><span class="linenum">5198</span></a>              <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../_variables/Settings.html">$Settings</a> = <span class="keyword">new </span><a class="class" onClick="logClass('GeneralSettings')" href="../../_classes/generalsettings.html" onMouseOver="classPopup(event,'generalsettings')">GeneralSettings</a>();
<a name="l5199"><span class="linenum">5199</span></a>          }
<a name="l5200"><span class="linenum">5200</span></a>          if( ! <a class="phpfunction" onClick="logFunction('is_object')" href="../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>( <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../_variables/Plugins.html">$Plugins</a> ) )
<a name="l5201"><span class="linenum">5201</span></a>          { // create Plugins object
<a name="l5202"><span class="linenum">5202</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'plugins/model/_plugins.class.php', 'Plugins' );
<a name="l5203"><span class="linenum">5203</span></a>              <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../_variables/Plugins.html">$Plugins</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Plugins')" href="../../_classes/plugins.html" onMouseOver="classPopup(event,'plugins')">Plugins</a>();
<a name="l5204"><span class="linenum">5204</span></a>          }
<a name="l5205"><span class="linenum">5205</span></a>  
<a name="l5206"><span class="linenum">5206</span></a>          <a class="function" onClick="logFunction('task_begin')" href="../../_functions/task_begin.html" onMouseOver="funcPopup(event,'task_begin')">task_begin</a>( 'Recreate autogenerated post excerpts...' );
<a name="l5207"><span class="linenum">5207</span></a>          <a class="var it6064" onMouseOver="hilite(6064)" onMouseOut="lolite()" onClick="logVariable('upgrade_continue_url')" href="../../_variables/upgrade_continue_url.html">$upgrade_continue_url</a> = <a class="var it153" onMouseOver="hilite(153)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../_variables/baseurl.html">$baseurl</a>.'install/index.php?locale='.<a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('locale')" href="../../_variables/locale.html">$locale</a>.'&amp;amp;action='.<a class="var it5982" onMouseOver="hilite(5982)" onMouseOut="lolite()" onClick="logVariable('upgrade_action')" href="../../_variables/upgrade_action.html">$upgrade_action</a>.'&amp;amp;exec_general_tasks=0&amp;amp;recreate_excerpts=1';
<a name="l5208"><span class="linenum">5208</span></a>          <a class="var it6065" onMouseOver="hilite(6065)" onMouseOut="lolite()" onClick="logVariable('all_excerpt')" href="../../_variables/all_excerpt.html">$all_excerpt</a> = <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'all_excerpt', 'integer', 0 );
<a name="l5209"><span class="linenum">5209</span></a>          <a class="function" onClick="logFunction('recreate_autogenerated_excerpts')" href="../../_functions/recreate_autogenerated_excerpts.html" onMouseOver="funcPopup(event,'recreate_autogenerated_excerpts')">recreate_autogenerated_excerpts</a>( <a class="var it6064" onMouseOver="hilite(6064)" onMouseOut="lolite()" onClick="logVariable('upgrade_continue_url')" href="../../_variables/upgrade_continue_url.html">$upgrade_continue_url</a>, <a class="var it6065" onMouseOver="hilite(6065)" onMouseOut="lolite()" onClick="logVariable('all_excerpt')" href="../../_variables/all_excerpt.html">$all_excerpt</a> == 0 );
<a name="l5210"><span class="linenum">5210</span></a>          <a class="function" onClick="logFunction('task_end')" href="../../_functions/task_end.html" onMouseOver="funcPopup(event,'task_end')">task_end</a>();
<a name="l5211"><span class="linenum">5211</span></a>      }
<a name="l5212"><span class="linenum">5212</span></a>  
<a name="l5213"><span class="linenum">5213</span></a>  
<a name="l5214"><span class="linenum">5214</span></a>      <span class="comment">/*</span>
<a name="l5215"><span class="linenum">5215</span></a>  <span class="comment">     * -----------------------------------------------</span>
<a name="l5216"><span class="linenum">5216</span></a>  <span class="comment">     * Check to make sure the DB schema is up to date:</span>
<a name="l5217"><span class="linenum">5217</span></a>  <span class="comment">     * -----------------------------------------------</span>
<a name="l5218"><span class="linenum">5218</span></a>  <span class="comment">     */</span>
<a name="l5219"><span class="linenum">5219</span></a>      echo &quot;Starting to check DB...&lt;br/&gt;\n&quot;;
<a name="l5220"><span class="linenum">5220</span></a>      <a class="function" onClick="logFunction('evo_flush')" href="../../_functions/evo_flush.html" onMouseOver="funcPopup(event,'evo_flush')">evo_flush</a>();
<a name="l5221"><span class="linenum">5221</span></a>  
<a name="l5222"><span class="linenum">5222</span></a>      <a class="var it6066" onMouseOver="hilite(6066)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas')" href="../../_variables/upgrade_db_deltas.html">$upgrade_db_deltas</a> = array(); <span class="comment">// This holds changes to make, if any (just all queries)</span>
<a name="l5223"><span class="linenum">5223</span></a>  
<a name="l5224"><span class="linenum">5224</span></a>      global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('debug')" href="../../_variables/debug.html">$debug</a>;
<a name="l5225"><span class="linenum">5225</span></a>  
<a name="l5226"><span class="linenum">5226</span></a>      foreach( <a class="var it4003" onMouseOver="hilite(4003)" onMouseOut="lolite()" onClick="logVariable('schema_queries')" href="../../_variables/schema_queries.html">$schema_queries</a> as <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> =&gt; <a class="var it5013" onMouseOver="hilite(5013)" onMouseOut="lolite()" onClick="logVariable('query_info')" href="../../_variables/query_info.html">$query_info</a> )
<a name="l5227"><span class="linenum">5227</span></a>      {    // For each table in the schema, check diffs...
<a name="l5228"><span class="linenum">5228</span></a>          if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('debug')" href="../../_variables/debug.html">$debug</a> )
<a name="l5229"><span class="linenum">5229</span></a>          {
<a name="l5230"><span class="linenum">5230</span></a>              echo '&lt;br /&gt;Checking table: '.<a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a>.': ';
<a name="l5231"><span class="linenum">5231</span></a>          }
<a name="l5232"><span class="linenum">5232</span></a>          <a class="var it3763" onMouseOver="hilite(3763)" onMouseOut="lolite()" onClick="logVariable('updates')" href="../../_variables/updates.html">$updates</a> = <a class="function" onClick="logFunction('db_delta')" href="../../_functions/db_delta.html" onMouseOver="funcPopup(event,'db_delta')">db_delta</a>( <a class="var it5013" onMouseOver="hilite(5013)" onMouseOut="lolite()" onClick="logVariable('query_info')" href="../../_variables/query_info.html">$query_info</a>[1], array('drop_column', 'drop_index'), false, true );
<a name="l5233"><span class="linenum">5233</span></a>          if( empty(<a class="var it3763" onMouseOver="hilite(3763)" onMouseOut="lolite()" onClick="logVariable('updates')" href="../../_variables/updates.html">$updates</a>) )
<a name="l5234"><span class="linenum">5234</span></a>          {
<a name="l5235"><span class="linenum">5235</span></a>              if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('debug')" href="../../_variables/debug.html">$debug</a> ) echo 'ok';
<a name="l5236"><span class="linenum">5236</span></a>          }
<a name="l5237"><span class="linenum">5237</span></a>          else
<a name="l5238"><span class="linenum">5238</span></a>          {
<a name="l5239"><span class="linenum">5239</span></a>              if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('debug')" href="../../_variables/debug.html">$debug</a> ) echo 'NEEDS UPDATE!';
<a name="l5240"><span class="linenum">5240</span></a>              foreach( <a class="var it3763" onMouseOver="hilite(3763)" onMouseOut="lolite()" onClick="logVariable('updates')" href="../../_variables/updates.html">$updates</a> as <a class="var it944" onMouseOver="hilite(944)" onMouseOut="lolite()" onClick="logVariable('table')" href="../../_variables/table.html">$table</a> =&gt; <a class="var it3913" onMouseOver="hilite(3913)" onMouseOut="lolite()" onClick="logVariable('queries')" href="../../_variables/queries.html">$queries</a> )
<a name="l5241"><span class="linenum">5241</span></a>              {
<a name="l5242"><span class="linenum">5242</span></a>                  foreach( <a class="var it3913" onMouseOver="hilite(3913)" onMouseOut="lolite()" onClick="logVariable('queries')" href="../../_variables/queries.html">$queries</a> as <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('qinfo')" href="../../_variables/qinfo.html">$qinfo</a> )
<a name="l5243"><span class="linenum">5243</span></a>                  {
<a name="l5244"><span class="linenum">5244</span></a>                      foreach( <a class="var it6067" onMouseOver="hilite(6067)" onMouseOut="lolite()" onClick="logVariable('qinfo')" href="../../_variables/qinfo.html">$qinfo</a>['queries'] as <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a> )
<a name="l5245"><span class="linenum">5245</span></a>                      { // subqueries for this <a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a> (usually one, but may include required other queries)
<a name="l5246"><span class="linenum">5246</span></a>                          <a class="var it6066" onMouseOver="hilite(6066)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas')" href="../../_variables/upgrade_db_deltas.html">$upgrade_db_deltas</a>[] = <a class="var it1660" onMouseOver="hilite(1660)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../_variables/query.html">$query</a>;
<a name="l5247"><span class="linenum">5247</span></a>                      }
<a name="l5248"><span class="linenum">5248</span></a>                  }
<a name="l5249"><span class="linenum">5249</span></a>              }
<a name="l5250"><span class="linenum">5250</span></a>          }
<a name="l5251"><span class="linenum">5251</span></a>      }
<a name="l5252"><span class="linenum">5252</span></a>  
<a name="l5253"><span class="linenum">5253</span></a>      if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('debug')" href="../../_variables/debug.html">$debug</a> )
<a name="l5254"><span class="linenum">5254</span></a>      {
<a name="l5255"><span class="linenum">5255</span></a>          echo '&lt;br /&gt;';
<a name="l5256"><span class="linenum">5256</span></a>      }
<a name="l5257"><span class="linenum">5257</span></a>  
<a name="l5258"><span class="linenum">5258</span></a>      if( empty(<a class="var it6066" onMouseOver="hilite(6066)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas')" href="../../_variables/upgrade_db_deltas.html">$upgrade_db_deltas</a>) )
<a name="l5259"><span class="linenum">5259</span></a>      {    // no upgrades needed:
<a name="l5260"><span class="linenum">5260</span></a>          echo '&lt;p&gt;'.<a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The database schema is up to date.').'&lt;/p&gt;';
<a name="l5261"><span class="linenum">5261</span></a>      }
<a name="l5262"><span class="linenum">5262</span></a>      else
<a name="l5263"><span class="linenum">5263</span></a>      {    // Upgrades are needed:
<a name="l5264"><span class="linenum">5264</span></a>  
<a name="l5265"><span class="linenum">5265</span></a>          <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('confirmed_db_upgrade')" href="../../_variables/confirmed_db_upgrade.html">$confirmed_db_upgrade</a> = <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>('confirmed', 'integer', 0); <span class="comment">// force confirmation</span>
<a name="l5266"><span class="linenum">5266</span></a>          <a class="var it6069" onMouseOver="hilite(6069)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas_confirm_md5')" href="../../_variables/upgrade_db_deltas_confirm_md5.html">$upgrade_db_deltas_confirm_md5</a> = <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'upgrade_db_deltas_confirm_md5', 'string', '' );
<a name="l5267"><span class="linenum">5267</span></a>  
<a name="l5268"><span class="linenum">5268</span></a>          if( ! <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('confirmed_db_upgrade')" href="../../_variables/confirmed_db_upgrade.html">$confirmed_db_upgrade</a> )
<a name="l5269"><span class="linenum">5269</span></a>          {
<a name="l5270"><span class="linenum">5270</span></a>              if( ! empty(<a class="var it6069" onMouseOver="hilite(6069)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas_confirm_md5')" href="../../_variables/upgrade_db_deltas_confirm_md5.html">$upgrade_db_deltas_confirm_md5</a>) )
<a name="l5271"><span class="linenum">5271</span></a>              { // received confirmation from form
<a name="l5272"><span class="linenum">5272</span></a>                  if( <a class="var it6069" onMouseOver="hilite(6069)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas_confirm_md5')" href="../../_variables/upgrade_db_deltas_confirm_md5.html">$upgrade_db_deltas_confirm_md5</a> != md5( <a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>('', <a class="var it6066" onMouseOver="hilite(6066)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas')" href="../../_variables/upgrade_db_deltas.html">$upgrade_db_deltas</a>) ) )
<a name="l5273"><span class="linenum">5273</span></a>                  { // unlikely to happen
<a name="l5274"><span class="linenum">5274</span></a>                      echo '&lt;p class=&quot;error&quot;&gt;'
<a name="l5275"><span class="linenum">5275</span></a>                          .<a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The DB schema has been changed since confirmation.')
<a name="l5276"><span class="linenum">5276</span></a>                          .'&lt;/p&gt;';
<a name="l5277"><span class="linenum">5277</span></a>                  }
<a name="l5278"><span class="linenum">5278</span></a>                  else
<a name="l5279"><span class="linenum">5279</span></a>                  {
<a name="l5280"><span class="linenum">5280</span></a>                      <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('confirmed_db_upgrade')" href="../../_variables/confirmed_db_upgrade.html">$confirmed_db_upgrade</a> = true;
<a name="l5281"><span class="linenum">5281</span></a>                  }
<a name="l5282"><span class="linenum">5282</span></a>              }
<a name="l5283"><span class="linenum">5283</span></a>          }
<a name="l5284"><span class="linenum">5284</span></a>  
<a name="l5285"><span class="linenum">5285</span></a>          if( ! <a class="var it6068" onMouseOver="hilite(6068)" onMouseOut="lolite()" onClick="logVariable('confirmed_db_upgrade')" href="../../_variables/confirmed_db_upgrade.html">$confirmed_db_upgrade</a> )
<a name="l5286"><span class="linenum">5286</span></a>          {
<a name="l5287"><span class="linenum">5287</span></a>              global <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a>, <a class="var it975" onMouseOver="hilite(975)" onMouseOut="lolite()" onClick="logVariable('form_action')" href="../../_variables/form_action.html">$form_action</a>;
<a name="l5288"><span class="linenum">5288</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( '_core/ui/forms/_form.class.php', 'Form' );
<a name="l5289"><span class="linenum">5289</span></a>  
<a name="l5290"><span class="linenum">5290</span></a>              if( !empty( <a class="var it975" onMouseOver="hilite(975)" onMouseOut="lolite()" onClick="logVariable('form_action')" href="../../_variables/form_action.html">$form_action</a> ) )
<a name="l5291"><span class="linenum">5291</span></a>              {
<a name="l5292"><span class="linenum">5292</span></a>                  <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Form')" href="../../_classes/form.html" onMouseOver="classPopup(event,'form')">Form</a>( <a class="var it975" onMouseOver="hilite(975)" onMouseOut="lolite()" onClick="logVariable('form_action')" href="../../_variables/form_action.html">$form_action</a>, '', 'post' );
<a name="l5293"><span class="linenum">5293</span></a>              }
<a name="l5294"><span class="linenum">5294</span></a>              else
<a name="l5295"><span class="linenum">5295</span></a>              {
<a name="l5296"><span class="linenum">5296</span></a>                  <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Form')" href="../../_classes/form.html" onMouseOver="classPopup(event,'form')">Form</a>( NULL, '', 'post' );
<a name="l5297"><span class="linenum">5297</span></a>              }
<a name="l5298"><span class="linenum">5298</span></a>  
<a name="l5299"><span class="linenum">5299</span></a>              <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('begin_form')" href="../../_functions/begin_form.html" onMouseOver="funcPopup(event,'begin_form')">begin_form</a>( 'fform', <a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Upgrade database') );
<a name="l5300"><span class="linenum">5300</span></a>  
<a name="l5301"><span class="linenum">5301</span></a>              <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('begin_fieldset')" href="../../_functions/begin_fieldset.html" onMouseOver="funcPopup(event,'begin_fieldset')">begin_fieldset</a>();
<a name="l5302"><span class="linenum">5302</span></a>              <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('hidden')" href="../../_functions/hidden.html" onMouseOver="funcPopup(event,'hidden')">hidden</a>( 'upgrade_db_deltas_confirm_md5', md5(<a class="phpfunction" onClick="logFunction('implode')" href="../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( '', <a class="var it6066" onMouseOver="hilite(6066)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas')" href="../../_variables/upgrade_db_deltas.html">$upgrade_db_deltas</a> )) );
<a name="l5303"><span class="linenum">5303</span></a>              <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('hidden')" href="../../_functions/hidden.html" onMouseOver="funcPopup(event,'hidden')">hidden</a>( 'action', <a class="var it225" onMouseOver="hilite(225)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../_variables/action.html">$action</a> );
<a name="l5304"><span class="linenum">5304</span></a>              <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('hidden')" href="../../_functions/hidden.html" onMouseOver="funcPopup(event,'hidden')">hidden</a>( 'locale', <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('locale')" href="../../_variables/locale.html">$locale</a> );
<a name="l5305"><span class="linenum">5305</span></a>  
<a name="l5306"><span class="linenum">5306</span></a>  
<a name="l5307"><span class="linenum">5307</span></a>              echo '&lt;p&gt;'.<a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The version number is correct, but we have detected changes in the database schema. This can happen with CVS versions...').'&lt;/p&gt;';
<a name="l5308"><span class="linenum">5308</span></a>  
<a name="l5309"><span class="linenum">5309</span></a>              echo '&lt;p&gt;'.<a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The following database changes will be carried out. If you are not sure what this means, it will probably be alright.').'&lt;/p&gt;';
<a name="l5310"><span class="linenum">5310</span></a>  
<a name="l5311"><span class="linenum">5311</span></a>              echo '&lt;ul&gt;';
<a name="l5312"><span class="linenum">5312</span></a>              foreach( <a class="var it6066" onMouseOver="hilite(6066)" onMouseOut="lolite()" onClick="logVariable('upgrade_db_deltas')" href="../../_variables/upgrade_db_deltas.html">$upgrade_db_deltas</a> as <a class="var it3645" onMouseOver="hilite(3645)" onMouseOut="lolite()" onClick="logVariable('l_delta')" href="../../_variables/l_delta.html">$l_delta</a> )
<a name="l5313"><span class="linenum">5313</span></a>              {
<a name="l5314"><span class="linenum">5314</span></a>  <span class="comment">                #echo '&lt;li&gt;&lt;code&gt;'.nl2br($l_delta).'&lt;/code&gt;&lt;/li&gt;';</span>
<a name="l5315"><span class="linenum">5315</span></a>                  echo '&lt;li&gt;&lt;pre&gt;'.<a class="phpfunction" onClick="logFunction('str_replace')" href="../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( &quot;\t&quot;, '  ', <a class="var it3645" onMouseOver="hilite(3645)" onMouseOut="lolite()" onClick="logVariable('l_delta')" href="../../_variables/l_delta.html">$l_delta</a> ).'&lt;/pre&gt;&lt;/li&gt;';
<a name="l5316"><span class="linenum">5316</span></a>              }
<a name="l5317"><span class="linenum">5317</span></a>              echo '&lt;/ul&gt;';
<a name="l5318"><span class="linenum">5318</span></a>              <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('submit')" href="../../_functions/submit.html" onMouseOver="funcPopup(event,'submit')">submit</a>( array( '', <a class="function" onClick="logFunction('T_')" href="../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Upgrade database!'), 'ActionButton' ) );
<a name="l5319"><span class="linenum">5319</span></a>              <a class="var it131" onMouseOver="hilite(131)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('end_form')" href="../../_functions/end_form.html" onMouseOver="funcPopup(event,'end_form')">end_form</a>();
<a name="l5320"><span class="linenum">5320</span></a>  
<a name="l5321"><span class="linenum">5321</span></a>              return false;
<a name="l5322"><span class="linenum">5322</span></a>          }
<a name="l5323"><span class="linenum">5323</span></a>  
<a name="l5324"><span class="linenum">5324</span></a>  <span class="comment">        // Alter DB to match DB schema:</span>
<a name="l5325"><span class="linenum">5325</span></a>          <a class="function" onClick="logFunction('install_make_db_schema_current')" href="../../_functions/install_make_db_schema_current.html" onMouseOver="funcPopup(event,'install_make_db_schema_current')">install_make_db_schema_current</a>( true );
<a name="l5326"><span class="linenum">5326</span></a>      }
<a name="l5327"><span class="linenum">5327</span></a>  
<a name="l5328"><span class="linenum">5328</span></a>      <a class="function" onClick="logFunction('track_step')" href="../../_functions/track_step.html" onMouseOver="funcPopup(event,'track_step')">track_step</a>( 'upgrade-success' );
<a name="l5329"><span class="linenum">5329</span></a>  
<a name="l5330"><span class="linenum">5330</span></a>      return true;
<a name="l5331"><span class="linenum">5331</span></a>  }
<a name="l5332"><span class="linenum">5332</span></a>  
<a name="l5333"><span class="linenum">5333</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_db_version': ['get_db_version', '', [['blogs/install','_functions_install.php',244]], 4],
'db_add_col': ['db_add_col', 'Add a column, if it does not already exist. If it exists already, a "ALTER TABLE" statement will get executed instead. ', [['blogs/install','_functions_evoupgrade.php',124]], 74],
'country': ['country', 'Constructor ', [['blogs/inc/regional/model','_country.class.php',50]], 15],
'begin_form': ['begin_form', 'Builds the form field ', [['blogs/inc/_core/ui/forms','_form.class.php',1499]], 172],
'recreate_autogenerated_excerpts': ['recreate_autogenerated_excerpts', 'Recreate posts autogenerated excerpts Only those posts excerpt will be recreated which are visible in the front office ', [['blogs/inc/items/model','_item.funcs.php',889]], 2],
'evo_strlen': ['evo_strlen', 'mbstring wrapper for strlen function ', [['blogs/inc/_core','_misc.funcs.php',691]], 33],
'begin_fieldset': ['begin_fieldset', 'Builds a fieldset tag. This is a "fieldset" element by default, but a "th" element for table layout. ', [['blogs/inc/_core/ui/forms','_form.class.php',586]], 273],
'create_profile_picture_links': ['create_profile_picture_links', 'Create links between users and image files from the users profile_pictures folder ', [['blogs/inc/files/model','_file.funcs.php',1986]], 1],
'system_check_caches': ['system_check_caches', '', [['blogs/inc/tools/model','_system.funcs.php',258]], 4],
'end_form': ['end_form', 'Ends the form, optionally displays buttons and closes all open fieldsets. ', [['blogs/inc/_core/ui/forms','_form.class.php',1617]], 184],
'create_default_subregions': ['create_default_subregions', 'Create default sub-regions ', [['blogs/install','_functions_create.php',873]], 2],
'param': ['param', 'Sets a parameter with values from the request or to provided default, except if param is already set! ', [['blogs/inc/_core','_param.funcs.php',50]], 1906],
'create_default_jobs': ['create_default_jobs', 'Create default scheduled jobs that don\'t exist yet: - Prune page cache - Prune hit log & session log from stats - Poll antispam blacklist ', [['blogs/install','_functions_create.php',996]], 2],
'begin': ['begin', 'BEGIN A TRANSCATION ', [['blogs/inc/_core/model/db','_db.class.php',1547]], 101],
'db_add_index': ['db_add_index', 'Add an INDEX. If another index with the same name already exists, it will get dropped before. ', [['blogs/install','_functions_evoupgrade.php',144]], 4],
'debug_die': ['debug_die', 'Outputs Unexpected Error message. When in debug mode it also prints a backtrace. ', [['blogs/inc/_core','_misc.funcs.php',2535]], 216],
'date2mysql': ['date2mysql', 'Convert timestamp to MySQL/ISO format. ', [['blogs/inc/_core','_misc.funcs.php',1238]], 40],
'replace_special_chars': ['replace_special_chars', 'Convert special chars (like german umlauts) to ASCII characters. ', [['blogs/inc/locales','_charset.funcs.php',104]], 6],
'ip2int': ['ip2int', 'Convert IP address to integer (get only 32bits of IPv6 address) ', [['blogs/inc/_core','_misc.funcs.php',6047]], 47],
'db_drop_col': ['db_drop_col', 'Drops a column, if it exists. ', [['blogs/install','_functions_evoupgrade.php',111]], 43],
'select': ['select', 'Set SELECT clause ', [['blogs/inc/_core/model/db','_sql.class.php',194],['blogs/inc/_core/model/db','_db.class.php',466],['blogs/inc/_core/ui/forms','_form.class.php',1820]], 461],
'escape': ['escape', 'Format a string correctly for safe insert under all PHP conditions ', [['blogs/inc/_core/model/db','_db.class.php',494]], 145],
'get_assoc': ['get_assoc', 'Function to get the second column from the cached result indexed by the first column ', [['blogs/inc/_core/model/db','_db.class.php',1066]], 49],
'bpost_count_words': ['bpost_count_words', 'Returns the number of the words in a string, sans HTML ', [['blogs/inc/items/model','_item.funcs.php',573]], 4],
'task_end': ['task_end', 'End install task. This will offer other display methods in the future ', [['blogs/install','_functions_install.php',234]], 314],
'reload_plugins': ['reload_plugins', 'Reload all plugins to detect changes - Register new events - Unregister obsolete events - Detect plugins with no code and try to have at least one plugin with the default code ', [['blogs/inc/plugins/model','_plugins_admin.class.php',858]], 2],
'evo_substr': ['evo_substr', 'mbstring wrapper for substr function ', [['blogs/inc/_core','_misc.funcs.php',729]], 26],
'invalidate_pagecaches': ['invalidate_pagecaches', 'Invalidate all page caches. This function should be processed every time, when some users or global settings was modified, and this modification has an imortant influence for the front office display. Modifications that requires to invalidate all page caches: - installing/removing/reloading/enabling/disabling plugins - editing user settings like allow profile pics, new users can register, user settings>display ', [['blogs/inc/_core','_misc.funcs.php',5463]], 10],
'generate_random_key': ['generate_random_key', 'Generate a valid key of size $length. ', [['blogs/inc/_core','_misc.funcs.php',4509]], 26],
't_': ['t_', 'TRANSLATE! ', [['blogs/inc/locales','_locale.funcs.php',48],['blogs/inc/locales','_locale.funcs.php',240],['blogs/inc/skins/model','_skin.class.php',672],['blogs/inc/_core/model','_module.class.php',79],['blogs/rsc/js','blog_widgets.js',422],['blogs/inc/plugins','_plugin.class.php',2617]], 10201],
'get_var': ['get_var', 'Get one variable from the DB - see docs for more detail ', [['blogs/inc/_core/model/db','_db.class.php',961]], 137],
'db_index_exists': ['db_index_exists', '', [['blogs/install','_functions_evoupgrade.php',73]], 4],
'cleanup_comment_quotes': ['cleanup_comment_quotes', 'Clean up extra quotes in comments ', [['blogs/install','_functions_install.php',325]], 1],
'db_col_exists': ['db_col_exists', '', [['blogs/install','_functions_install.php',303]], 8],
'get_results': ['get_results', 'Return the the query as a result set - see docs for more details ', [['blogs/inc/_core/model/db','_db.class.php',1092]], 140],
'plugins': ['plugins', 'Constructor. Sets {@link $plugins_path} and load events. ', [['blogs/inc/plugins/model','_plugins.class.php',164]], 5],
'convert': ['convert', '', [['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',16784]], 2],
'task_begin': ['task_begin', 'Begin install task. This will offer other display methods in the future ', [['blogs/install','_functions_install.php',223]], 314],
'db_drop_foreign_key': ['db_drop_foreign_key', 'Drop a Foreign Key constraint. If this foreign key not exists the function won\'t give error. ', [['blogs/install','_functions_evoupgrade.php',198]], 0],
'get_antispam_query': ['get_antispam_query', 'Return antispam SQL query. This is obfuscated because some hosting companies prevent uploading PHP files containing "spam" strings. ', [['blogs/install','_functions_install.php',1032]], 2],
'from': ['from', '', [['blogs/inc/_core/model/db','_sql.class.php',219]], 380],
'form_date': ['form_date', '', [['blogs/inc/_core','_misc.funcs.php',4361]], 27],
'get_col': ['get_col', 'Function to get 1 column from the cached result set based on X index see docs for usage and info ', [['blogs/inc/_core/model/db','_db.class.php',1041]], 88],
'set_upgrade_checkpoint': ['set_upgrade_checkpoint', 'Create a DB version checkpoint ', [['blogs/install','_functions_evoupgrade.php',24]], 83],
'restore_error_state': ['restore_error_state', 'Call this after {@link save_halt_on_error()} to restore the previous error state. This can be chained. ', [['blogs/inc/_core/model/db','_db.class.php',741]], 7],
'modules_call_method': ['modules_call_method', 'Call a method for all modules in a row ', [['blogs/inc/_core','_misc.funcs.php',49]], 26],
'db_key_exists': ['db_key_exists', 'Check if a key item value already exists on database ', [['blogs/install','_functions_evoupgrade.php',159]], 4],
'dbinsert': ['dbinsert', 'Insert object into DB based on previously recorded changes. ', [['blogs/inc/chapters/model','_chapter.class.php',287],['blogs/inc/generic/model','_genericordered.class.php',101],['blogs/inc/users/model','_group.class.php',451],['blogs/inc/widgets/model','_widget.class.php',725],['blogs/inc/collections/model','_blog.class.php',2171],['blogs/inc/users/model','_user.class.php',2872],['blogs/inc/skins/model','_skin.class.php',370],['blogs/inc/comments/model','_comment.class.php',3511],['blogs/inc/items/model','_item.class.php',4685],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',210],['blogs/inc/files/model','_file.class.php',1698]], 93],
'db_add_foreign_key': ['db_add_foreign_key', 'Add a Foreign Key constraint. If another foreign key exists between these two fields then the old FK will be deleted and a new will be created. If the table engine is not InnoDB, then it will be changed automatically. If the FK table contains data which would prevent foreign key creation then these records will be deleted. ', [['blogs/install','_functions_evoupgrade.php',171]], 1],
'set': ['set', 'Set param value ', [['blogs/inc/users/model','_userfield.class.php',243],['blogs/inc/generic/model','_genericordered.class.php',75],['blogs/inc/users/model','_group.class.php',204],['blogs/inc/items/model','_itemlight.class.php',1258],['blogs/inc/plugins/model','_pluginsettings.class.php',70],['blogs/inc/widgets/model','_widget.class.php',321],['blogs/inc/regional/model','_region.class.php',102],['blogs/inc/regional/model','_city.class.php',110],['blogs/inc/collections/model','_blog.class.php',1102],['blogs/inc/settings/model','_abstractsettings.class.php',446],['blogs/inc/plugins/model','_pluginusersettings.class.php',82],['blogs/inc/users/model','_user.class.php',1861],['blogs/inc/generic/model','_genericcategory.class.php',100],['blogs/inc/tools/model','_emailaddress.class.php',85],['blogs/inc/users/model','_usersettings.class.php',187],['blogs/inc/regional/model','_country.class.php',106],['blogs/inc/comments/model','_comment.class.php',315],['blogs/inc/users/model','_groupsettings.class.php',140],['blogs/inc/cron/model','_cronjob.class.php',79],['blogs/inc/items/model','_item.class.php',4497],['blogs/inc/files/model','_filetype.class.php',149],['blogs/inc/users/model','_userfieldgroup.class.php',92],['blogs/inc/sessions/model','_session.class.php',420],['blogs/plugins','_calendar.plugin.php',530],['blogs/inc/slugs/model','_slug.class.php',80],['blogs/inc/regional/model','_currency.class.php',96],['blogs/inc/messaging/model','_thread.class.php',185],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',614],['blogs/inc/regional/model','_subregion.class.php',119],['blogs/inc/antispam/model','_iprange.class.php',81],['blogs/inc/sessions/model','_goal.class.php',199]], 1121],
'create_default_regions': ['create_default_regions', 'Create default regions ', [['blogs/install','_functions_create.php',776]], 2],
'track_step': ['track_step', 'We use the following tracking to determine the installer reliability (% of failed vs successful installs). ', [['blogs/install','_functions_install.php',1047]], 6],
'currency': ['currency', 'Constructor ', [['blogs/inc/regional/model','_currency.class.php',47]], 15],
'db_delta': ['db_delta', 'Get the delta query to adjust the current database according to a given (list of) "CREATE TABLE"-, "CREATE DATABASE"-, "INSERT"- or "UPDATE"-statement(s). ', [['blogs/inc/_core/model/db','_upgrade.funcs.php',34]], 5],
'insert': ['insert', 'Create a new Item/Post and insert it into the DB ', [['blogs/inc/items/model','_item.class.php',4622]], 78],
'where': ['where', '', [['blogs/inc/_core/model/db','_sql.class.php',240]], 238],
'usersettings': ['usersettings', 'Constructor ', [['blogs/inc/users/model','_usersettings.class.php',142]], 10],
'file_path': ['file_path', '', [['blogs/inc/files/views','_file_links.view.php',87]], 3],
'install_make_db_schema_current': ['install_make_db_schema_current', 'Alter the DB schema to match the current expected one ({@link $schema_queries}). ', [['blogs/inc/_core/model/db','_upgrade.funcs.php',1413]], 2],
'create_default_settings': ['create_default_settings', 'Insert default settings into T_settings. ', [['blogs/install','_functions_install.php',382]], 2],
'hidden': ['hidden', 'Builds an hidden input tag, overwriting any previous hidden values (except for "foo[]"). ', [['blogs/inc/_core/ui/forms','_form.class.php',2657]], 600],
'convert_lang_to_locale': ['convert_lang_to_locale', 'Converts languages in a given table into according locales ', [['blogs/install','_functions_evoupgrade.php',222]], 2],
'submit': ['submit', 'Builds a submit input tag ', [['blogs/inc/_core/ui/forms','_form.class.php',2832]], 46],
'load_db_schema': ['load_db_schema', 'Loads the b2evo database scheme. ', [['blogs/install','_functions_install.php',887]], 3],
'install_basic_plugins': ['install_basic_plugins', 'Install basic plugins. ', [['blogs/install','_functions_install.php',526]], 2],
'dbm_convert_item_content_separators': ['dbm_convert_item_content_separators', 'Convert item content separators to new format ', [['blogs/inc/tools/model','_dbmaintenance.funcs.php',814]], 2],
'exists': ['exists', 'Does the File/folder exist on disk? ', [['blogs/inc/files/model','_file.class.php',412]], 34],
'install_basic_skins': ['install_basic_skins', 'Install basic skins. ', [['blogs/install','_functions_install.php',474]], 2],
'create_default_countries': ['create_default_countries', 'Create default countries with relations to currencies ', [['blogs/install','_functions_create.php',504]], 2],
'system_init_caches': ['system_init_caches', 'Initialize cache settings and folders (during install or upgrade) ', [['blogs/inc/tools/model','_system.funcs.php',307]], 2],
'extract_params_from_referer': ['extract_params_from_referer', 'Extracts a keyword from a raw not encoded URL. Will only extract keyword if a known search engine has been detected. Returns the keyword: - in UTF8: automatically converted from other charsets when applicable - strtolowered: "QUErY test!" will return "query test!" - trimmed: extra spaces before and after are removed ', [['blogs/inc/sessions/model','_hit.class.php',1474]], 5],
'replace': ['replace', '', [['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',1682],['blogs/plugins/tinymce_plugin/tiny_mce/plugins/searchreplace/js','searchreplace.js',64]], 612],
'db_delta_foreign_keys': ['db_delta_foreign_keys', 'Get the delta queries between existing foreign key values and new foreign key values in the given table ', [['blogs/inc/_core/model/db','_upgrade.funcs.php',1225]], 3],
'get': ['get', '', [['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',941],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',15011],['blogs/plugins/tinymce_plugin/tiny_mce/plugins/media/js','media.js',7],['blogs/inc/links/model','_linkowner.class.php',221],['blogs/inc/_core/model/db','_sql.class.php',64],['blogs/inc/plugins/model','_pluginsettings.class.php',58],['blogs/inc/collections/model','_blog.class.php',1822],['blogs/inc/settings/model','_generalsettings.class.php',383],['blogs/inc/settings/model','_abstractsettings.class.php',271],['blogs/inc/plugins/model','_pluginusersettings.class.php',58],['blogs/inc/users/model','_user.class.php',1126],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_gzip.js',38],['blogs/inc/users/model','_usersettings.class.php',151],['blogs/inc/comments/model','_comment.class.php',301],['blogs/inc/users/model','_groupsettings.class.php',124],['blogs/inc/cron/model','_cronjob.class.php',104],['blogs/inc/items/model','_item.class.php',5742],['blogs/inc/sessions/model','_session.class.php',397],['blogs/inc/links/model','_linkuser.class.php',141],['blogs/inc/links/model','_linkitem.class.php',155],['blogs/inc/slugs/model','_slug.class.php',68],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',574],['blogs/plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['blogs/inc/antispam/model','_iprange.class.php',69],['blogs/inc/links/model','_linkcomment.class.php',132],['blogs/inc/files/model','_file.class.php',532]], 2417],
'install_basic_widgets': ['install_basic_widgets', 'Install basic widgets. ', [['blogs/install','_functions_install.php',665]], 2],
'now': ['now', '', [['blogs/rsc/js/bootstrap','typeahead.bundle.js',253]], 10],
'load_funcs': ['load_funcs', '', [['blogs/inc/_core','_misc.funcs.php',115]], 214],
'commit': ['commit', 'Commit current transaction ', [['blogs/inc/_core/model/db','_db.class.php',1591]], 114],
'urltitle_validate': ['urltitle_validate', 'Validate URL title (slug) / Also used for category slugs ', [['blogs/inc/items/model','_item.funcs.php',351]], 9],
'load_class': ['load_class', 'Load class file ', [['blogs/inc/_core','_class4.funcs.php',28],['blogs/inc/_core','_class5.funcs.php',79]], 408],
'evo_flush': ['evo_flush', 'Flush the output buffer ', [['blogs/inc/_core','_misc.funcs.php',6282]], 156],
'query': ['query', 'Run Query: GET DATA ROWS *** HEAVY *** ', [['blogs/inc/items/model','_itemlist.class.php',256],['blogs/inc/items/model','_itemlistlight.class.php',751],['blogs/inc/_core/model/db','_db.class.php',761],['blogs/inc/users/model','_userlist.class.php',474],['blogs/inc/_core/ui/results','_results.class.php',439],['blogs/inc/comments/model','_commentlist.class.php',515]], 972],
'save_error_state': ['save_error_state', 'Save the vars responsible for error handling. This can be chained. ', [['blogs/inc/_core/model/db','_db.class.php',725]], 7],
'quote': ['quote', 'Quote a msgid/msgstr, preferrable with single quotes. ', [['blogs/inc/locales','_pofile.class.php',267],['blogs/inc/_core/model/db','_db.class.php',503]], 791],
'get_row': ['get_row', 'Get one row from the DB. ', [['blogs/inc/_core/model/db','_db.class.php',996]], 57],
'upgrade_b2evo_tables': ['upgrade_b2evo_tables', 'upgrade_b2evo_tables(-) ', [['blogs/install','_functions_evoupgrade.php',289],['blogs/inc/_core/model','_module.class.php',103]], 1],
'db_cols_exist': ['db_cols_exist', '', [['blogs/install','_functions_evoupgrade.php',97]], 1],
'where_and': ['where_and', 'Extends the WHERE clause with AND ', [['blogs/inc/_core/model/db','_sql.class.php',245]], 280],
'create_default_currencies': ['create_default_currencies', 'Create default currencies ', [['blogs/install','_functions_create.php',325]], 2],
'array_keys': ['array_keys', '', [], 69],
'stripslashes': ['stripslashes', '', [], 8],
'time': ['time', '', [], 57],
'file': ['file', '', [], 70],
'uniqid': ['uniqid', '', [], 10],
'preg_match': ['preg_match', '', [], 363],
'strtolower': ['strtolower', '', [], 168],
'implode': ['implode', '', [], 456],
'array_search': ['array_search', '', [], 30],
'dirname': ['dirname', '', [], 186],
'date': ['date', '', [], 361],
'is_null': ['is_null', '', [], 251],
'array_unique': ['array_unique', '', [], 30],
'max': ['max', '', [], 97],
'key': ['key', '', [], 154],
'preg_replace': ['preg_replace', '', [], 281],
'floor': ['floor', '', [], 79],
'count': ['count', '', [], 754],
'trim': ['trim', '', [], 351],
'strpos': ['strpos', '', [], 280],
'str_replace': ['str_replace', '', [], 403],
'explode': ['explode', '', [], 249],
'substr': ['substr', '', [], 657],
'defined': ['defined', '', [], 874],
'is_object': ['is_object', '', [], 57],
'ini_get': ['ini_get', '', [], 38]};
CLASS_DATA={
'hit': ['hit', 'A hit to a blog. ', [['blogs/inc/sessions/model','_hit.class.php',40]], 13],
'sql': ['sql', 'SQL class: help constructing queries ', [['blogs/inc/_core/model/db','_sql.class.php',32]], 273],
'generalsettings': ['generalsettings', 'Class to handle the global settings. ', [['blogs/inc/settings/model','_generalsettings.class.php',38]], 5],
'form': ['form', 'Form class ', [['blogs/inc/_core/ui/forms','_form.class.php',53]], 181],
'group': ['group', 'User Group ', [['blogs/inc/users/model','_group.class.php',34]], 61],
'plugins': ['plugins', 'Plugins Class ', [['blogs/inc/plugins/model','_plugins.class.php',46]], 13],
'user': ['user', 'User Class ', [['blogs/inc/users/model','_user.class.php',43]], 126]};
CONST_DATA={
'EVO_MAIN_INIT': ['EVO_MAIN_INIT', '', [['blogs/inc','_main.inc.php',55],['blogs/install','index.php',25],['blogs/install','debug.php',22]], 827],
'OBJECT': ['OBJECT', '', [['blogs/inc/_core/model/db','_db.class.php',69]], 53],
'ARRAY_A': ['ARRAY_A', '', [['blogs/inc/_core/model/db','_db.class.php',70]], 31]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Jul  5 12:18:44 2014</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
