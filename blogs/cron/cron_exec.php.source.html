<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /blogs/cron/cron_exec.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Jul  5 12:18:44 2014 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='blogs/cron';
filename='cron_exec.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/blogs/cron/</a> -> <a href="cron_exec.php.html">cron_exec.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="cron_exec.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="cron_exec.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * Execute cron jobs.</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * Example to use CLI:</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * &gt;c:\php4\php cron_exec.php</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * &gt;c:\php4\php-cli cron_exec.php</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> *</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * @version $Id: cron_exec.php 5875 2014-02-03 13:38:59Z attila $</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> */</span>
<a name="l11"><span class="linenum">  11</span></a>  
<a name="l12"><span class="linenum">  12</span></a>  
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment">/**</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> * Include config</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> */</span>
<a name="l16"><span class="linenum">  16</span></a>  require_once <a class="phpfunction" onClick="logFunction('dirname')" href="../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(__FILE__).'/../conf/_config.php';
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Include main initialization</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * Note: This will initialize only the required objects ( e.g. $Session or $Hit objects will NOT be initialized in cli mode ).</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> */</span>
<a name="l22"><span class="linenum">  22</span></a>  require_once <a class="var it246" onMouseOver="hilite(246)" onMouseOut="lolite()" onClick="logVariable('inc_path')" href="../../_variables/inc_path.html">$inc_path</a> .'_main.inc.php';
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  if( <a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'system_lock' ) )
<a name="l25"><span class="linenum">  25</span></a>  { // System is locked down for maintenance, Stop cron execution
<a name="l26"><span class="linenum">  26</span></a>      echo 'The site is locked for maintenance. All scheduled jobs are postponed. No job was executed.';
<a name="l27"><span class="linenum">  27</span></a>      exit(0);
<a name="l28"><span class="linenum">  28</span></a>  }
<a name="l29"><span class="linenum">  29</span></a>  
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment">/**</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> * Cron support functions</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> */</span>
<a name="l33"><span class="linenum">  33</span></a>  <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( 'cron/_cron.funcs.php' );
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment">/**</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * @global integer Quietness.</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> *         1 suppresses trivial/informative messages,</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> *         2 suppresses success messages,</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> *         3 suppresses errors.</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment"> */</span>
<a name="l41"><span class="linenum">  41</span></a>  <a class="var it343" onMouseOver="hilite(343)" onMouseOut="lolite()" onClick="logVariable('quiet')" href="../../_variables/quiet.html">$quiet</a> = 0;
<a name="l42"><span class="linenum">  42</span></a>  if( <a class="var it3118" onMouseOver="hilite(3118)" onMouseOut="lolite()" onClick="logVariable('is_cli')" href="../../_variables/is_cli.html">$is_cli</a> )
<a name="l43"><span class="linenum">  43</span></a>  { // called through Command Line Interface, handle args:
<a name="l44"><span class="linenum">  44</span></a>  
<a name="l45"><span class="linenum">  45</span></a>  <span class="comment">    // Load required functions ( we need to load here, because in CLI mode it is not loaded )</span>
<a name="l46"><span class="linenum">  46</span></a>      <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( '_core/_url.funcs.php' );
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>      if( isset( <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['argc'], <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['argv'] ) )
<a name="l49"><span class="linenum">  49</span></a>      {
<a name="l50"><span class="linenum">  50</span></a>          <a class="var it8109" onMouseOver="hilite(8109)" onMouseOut="lolite()" onClick="logVariable('argc')" href="../../_variables/argc.html">$argc</a> = <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['argc'];
<a name="l51"><span class="linenum">  51</span></a>          <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('argv')" href="../../_variables/argv.html">$argv</a> = <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['argv'];
<a name="l52"><span class="linenum">  52</span></a>      }
<a name="l53"><span class="linenum">  53</span></a>  
<a name="l54"><span class="linenum">  54</span></a>      if( isset(<a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('argv')" href="../../_variables/argv.html">$argv</a>) )
<a name="l55"><span class="linenum">  55</span></a>      { // may not be set for CGI
<a name="l56"><span class="linenum">  56</span></a>          foreach( <a class="phpfunction" onClick="logFunction('array_slice')" href="../../_functions/array_slice.html" onMouseOver="phpfuncPopup(event,'array_slice')">array_slice</a>(<a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('argv')" href="../../_variables/argv.html">$argv</a>, 1) as <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a> )
<a name="l57"><span class="linenum">  57</span></a>          {
<a name="l58"><span class="linenum">  58</span></a>              switch( <a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a> )
<a name="l59"><span class="linenum">  59</span></a>              {
<a name="l60"><span class="linenum">  60</span></a>                  case '-h':
<a name="l61"><span class="linenum">  61</span></a>                  case '--help':
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">                    // display help:</span>
<a name="l63"><span class="linenum">  63</span></a>                      echo <a class="var it7983" onMouseOver="hilite(7983)" onMouseOut="lolite()" onClick="logVariable('argv')" href="../../_variables/argv.html">$argv</a>[0].&quot; - Execute cron jobs for b2evolution\n&quot;;
<a name="l64"><span class="linenum">  64</span></a>                      echo &quot;\n&quot;;
<a name="l65"><span class="linenum">  65</span></a>                      echo &quot;Options:\n&quot;;
<a name="l66"><span class="linenum">  66</span></a>                      echo &quot; -q --quiet: Be quiet (do not output a message, if there are no jobs).\n&quot;;
<a name="l67"><span class="linenum">  67</span></a>                      echo &quot;             This is especially useful, when running as a cron job.\n&quot;;
<a name="l68"><span class="linenum">  68</span></a>                      echo &quot;             You can use this up to three times to increase quietness.\n&quot;;
<a name="l69"><span class="linenum">  69</span></a>                      echo &quot;             Successful runs can be made silent with \&quot;-q -q\&quot;.\n&quot;;
<a name="l70"><span class="linenum">  70</span></a>                      exit(0);
<a name="l71"><span class="linenum">  71</span></a>                      break;
<a name="l72"><span class="linenum">  72</span></a>  
<a name="l73"><span class="linenum">  73</span></a>                  case '-q':
<a name="l74"><span class="linenum">  74</span></a>                  case '--quiet':
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">                    // increase quietness:</span>
<a name="l76"><span class="linenum">  76</span></a>                      <a class="var it343" onMouseOver="hilite(343)" onMouseOut="lolite()" onClick="logVariable('quiet')" href="../../_variables/quiet.html">$quiet</a>++;
<a name="l77"><span class="linenum">  77</span></a>                      break;
<a name="l78"><span class="linenum">  78</span></a>  
<a name="l79"><span class="linenum">  79</span></a>                  default:
<a name="l80"><span class="linenum">  80</span></a>                      echo 'Invalid option &quot;'.<a class="var it396" onMouseOver="hilite(396)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../_variables/v.html">$v</a>.'&quot;. Use &quot;-h&quot; or &quot;--help&quot; for a list of options.'.&quot;\n&quot;;
<a name="l81"><span class="linenum">  81</span></a>                      die(1);
<a name="l82"><span class="linenum">  82</span></a>              }
<a name="l83"><span class="linenum">  83</span></a>          }
<a name="l84"><span class="linenum">  84</span></a>      }
<a name="l85"><span class="linenum">  85</span></a>  
<a name="l86"><span class="linenum">  86</span></a>      global <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a>, <a class="var it1626" onMouseOver="hilite(1626)" onMouseOut="lolite()" onClick="logVariable('current_charset')" href="../../_variables/current_charset.html">$current_charset</a>;
<a name="l87"><span class="linenum">  87</span></a>  
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">    // We don't load _init_session.inc.php in CLI mode, so we set locale and DB connection charset here</span>
<a name="l89"><span class="linenum">  89</span></a>      <a class="function" onClick="logFunction('locale_overwritefromDB')" href="../../_functions/locale_overwritefromdb.html" onMouseOver="funcPopup(event,'locale_overwritefromdb')">locale_overwritefromDB</a>();
<a name="l90"><span class="linenum">  90</span></a>      <a class="function" onClick="logFunction('locale_activate')" href="../../_functions/locale_activate.html" onMouseOver="funcPopup(event,'locale_activate')">locale_activate</a>( <a class="var it2782" onMouseOver="hilite(2782)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../_variables/default_locale.html">$default_locale</a> );
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>  <span class="comment">    // Init charset handling - this will also set the encoding for MySQL connection</span>
<a name="l93"><span class="linenum">  93</span></a>      <a class="function" onClick="logFunction('init_charsets')" href="../../_functions/init_charsets.html" onMouseOver="funcPopup(event,'init_charsets')">init_charsets</a>( <a class="var it1626" onMouseOver="hilite(1626)" onMouseOut="lolite()" onClick="logVariable('current_charset')" href="../../_variables/current_charset.html">$current_charset</a> );
<a name="l94"><span class="linenum">  94</span></a>  }
<a name="l95"><span class="linenum">  95</span></a>  else
<a name="l96"><span class="linenum">  96</span></a>  { // This is a web request: (for testing purposes only. Not designed for production)
<a name="l97"><span class="linenum">  97</span></a>  
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">    // Make sure the response is never cached:</span>
<a name="l99"><span class="linenum">  99</span></a>      <a class="function" onClick="logFunction('header_nocache')" href="../../_functions/header_nocache.html" onMouseOver="funcPopup(event,'header_nocache')">header_nocache</a>();
<a name="l100"><span class="linenum"> 100</span></a>      <a class="function" onClick="logFunction('header_content_type')" href="../../_functions/header_content_type.html" onMouseOver="funcPopup(event,'header_content_type')">header_content_type</a>();
<a name="l101"><span class="linenum"> 101</span></a>  
<a name="l102"><span class="linenum"> 102</span></a>  <span class="comment">    // Add CSS:</span>
<a name="l103"><span class="linenum"> 103</span></a>      <a class="function" onClick="logFunction('require_css')" href="../../_functions/require_css.html" onMouseOver="funcPopup(event,'require_css')">require_css</a>( 'basic_styles.css', 'rsc_url' ); <span class="comment">// the REAL basic styles</span>
<a name="l104"><span class="linenum"> 104</span></a>      <a class="function" onClick="logFunction('require_css')" href="../../_functions/require_css.html" onMouseOver="funcPopup(event,'require_css')">require_css</a>( 'basic.css', 'rsc_url' ); <span class="comment">// Basic styles</span>
<a name="l105"><span class="linenum"> 105</span></a>      ?&gt;
<a name="l106"><span class="linenum"> 106</span></a>      &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;&gt;
<a name="l107"><span class="linenum"> 107</span></a>      &lt;html&gt;
<a name="l108"><span class="linenum"> 108</span></a>      &lt;head&gt;
<a name="l109"><span class="linenum"> 109</span></a>          &lt;title&gt;Cron exec&lt;/title&gt;
<a name="l110"><span class="linenum"> 110</span></a>          &lt;?php <a class="function" onClick="logFunction('include_headlines')" href="../../_functions/include_headlines.html" onMouseOver="funcPopup(event,'include_headlines')">include_headlines</a>() <span class="comment">/* Add javascript and css files included by plugins and skin */</span> ?&gt;
<a name="l111"><span class="linenum"> 111</span></a>      &lt;/head&gt;
<a name="l112"><span class="linenum"> 112</span></a>      &lt;body&gt;
<a name="l113"><span class="linenum"> 113</span></a>          &lt;h1&gt;Cron exec&lt;/h1&gt;
<a name="l114"><span class="linenum"> 114</span></a>          &lt;p&gt;This script will execute the next task in the cron queue.
<a name="l115"><span class="linenum"> 115</span></a>          You should normally call it with the CLI (command line interface) version of PHP
<a name="l116"><span class="linenum"> 116</span></a>          and automate that call through a cron.&lt;/p&gt;
<a name="l117"><span class="linenum"> 117</span></a>      &lt;?php
<a name="l118"><span class="linenum"> 118</span></a>  }
<a name="l119"><span class="linenum"> 119</span></a>  
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">/*</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment"> * The following will feel a little bloated...</span>
<a name="l122"><span class="linenum"> 122</span></a>  <span class="comment"> * BUT it is actually a pretty nifty design to prevent double execution of tasks without any transaction!</span>
<a name="l123"><span class="linenum"> 123</span></a>  <span class="comment"> * The trick is to rely on the primary key of the cron__log table.</span>
<a name="l124"><span class="linenum"> 124</span></a>  <span class="comment"> */</span>
<a name="l125"><span class="linenum"> 125</span></a>  
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">// Get next task to run in queue which has not started execution yet:</span>
<a name="l127"><span class="linenum"> 127</span></a>  <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'SELECT *
<a name="l128"><span class="linenum"> 128</span></a>                      FROM T_cron__task LEFT JOIN T_cron__log ON ctsk_ID = clog_ctsk_ID
<a name="l129"><span class="linenum"> 129</span></a>                   WHERE clog_ctsk_ID IS NULL
<a name="l130"><span class="linenum"> 130</span></a>                       AND ctsk_start_datetime &lt;= '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('date2mysql')" href="../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../_variables/localtimenow.html">$localtimenow</a>) ).'
<a name="l131"><span class="linenum"> 131</span></a>                   ORDER BY ctsk_start_datetime ASC, ctsk_ID ASC
<a name="l132"><span class="linenum"> 132</span></a>                   LIMIT 1';
<a name="l133"><span class="linenum"> 133</span></a>  <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a> = <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, <a class="constant" onClick="logConstant('OBJECT')" href="../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 0, 'Get next task to run in queue which has not started execution yet' );
<a name="l134"><span class="linenum"> 134</span></a>  <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('error_task')" href="../../_variables/error_task.html">$error_task</a> = NULL;
<a name="l135"><span class="linenum"> 135</span></a>  
<a name="l136"><span class="linenum"> 136</span></a>  if( empty( <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a> ) )
<a name="l137"><span class="linenum"> 137</span></a>  {
<a name="l138"><span class="linenum"> 138</span></a>      <a class="function" onClick="logFunction('cron_log')" href="../../_functions/cron_log.html" onMouseOver="funcPopup(event,'cron_log')">cron_log</a>( 'There is no task to execute yet.', 0 );
<a name="l139"><span class="linenum"> 139</span></a>  }
<a name="l140"><span class="linenum"> 140</span></a>  else
<a name="l141"><span class="linenum"> 141</span></a>  {
<a name="l142"><span class="linenum"> 142</span></a>      <a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('ctsk_ID')" href="../../_variables/ctsk_ID.html">$ctsk_ID</a> = <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_ID')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_ID.html">ctsk_ID</a>;
<a name="l143"><span class="linenum"> 143</span></a>      <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('ctsk_name')" href="../../_variables/ctsk_name.html">$ctsk_name</a> = <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_name')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_name.html">ctsk_name</a>;
<a name="l144"><span class="linenum"> 144</span></a>  
<a name="l145"><span class="linenum"> 145</span></a>      <a class="function" onClick="logFunction('cron_log')" href="../../_functions/cron_log.html" onMouseOver="funcPopup(event,'cron_log')">cron_log</a>( 'Requesting lock on task #'.<a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('ctsk_ID')" href="../../_variables/ctsk_ID.html">$ctsk_ID</a>.' ['.<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('ctsk_name')" href="../../_variables/ctsk_name.html">$ctsk_name</a>.']', 0 );
<a name="l146"><span class="linenum"> 146</span></a>  
<a name="l147"><span class="linenum"> 147</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('halt_on_error')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/halt_on_error.html">halt_on_error</a> = false;
<a name="l148"><span class="linenum"> 148</span></a>      <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('show_errors')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/show_errors.html">show_errors</a> = false;
<a name="l149"><span class="linenum"> 149</span></a>      <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'INSERT INTO T_cron__log( clog_ctsk_ID, clog_realstart_datetime, clog_status)
<a name="l150"><span class="linenum"> 150</span></a>                      VALUES( '.<a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('ctsk_ID')" href="../../_variables/ctsk_ID.html">$ctsk_ID</a>.', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('date2mysql')" href="../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>(<a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../_variables/localtimenow.html">$localtimenow</a>) ).', &quot;started&quot; )';
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">    // Duplicate query for tests!</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment">    // $DB-&gt;query( $sql, 'Request lock' );</span>
<a name="l153"><span class="linenum"> 153</span></a>      if( <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, 'Request lock' ) != 1 )
<a name="l154"><span class="linenum"> 154</span></a>      { // This has no affected exactly ONE row: error! (probably locked -- duplicate key -- by a concurrent process)
<a name="l155"><span class="linenum"> 155</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('show_errors')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/show_errors.html">show_errors</a> = true;
<a name="l156"><span class="linenum"> 156</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('halt_on_error')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/halt_on_error.html">halt_on_error</a> = true;
<a name="l157"><span class="linenum"> 157</span></a>          <a class="function" onClick="logFunction('cron_log')" href="../../_functions/cron_log.html" onMouseOver="funcPopup(event,'cron_log')">cron_log</a>( 'Could not lock. Task is probably handled by another process.', 2 );
<a name="l158"><span class="linenum"> 158</span></a>      }
<a name="l159"><span class="linenum"> 159</span></a>      else
<a name="l160"><span class="linenum"> 160</span></a>      {
<a name="l161"><span class="linenum"> 161</span></a>          if( !empty( <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_repeat_after')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_repeat_after.html">ctsk_repeat_after</a> ) )
<a name="l162"><span class="linenum"> 162</span></a>          {    // This task wants to be repeated:
<a name="l163"><span class="linenum"> 163</span></a>  <span class="comment">            // Note: we use the current time for 2 reasons: 1) prevent scheduling something in the past AND 2) introduce variety so that everyone doesn't run his repeated tasks at the same exact time, especially pings, pollings...</span>
<a name="l164"><span class="linenum"> 164</span></a>              if( <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_controller')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_controller.html">ctsk_controller</a> == 'cron/_antispam_poll.job.php' )
<a name="l165"><span class="linenum"> 165</span></a>              {    // THIS IS A HACK. Guess why we need that!? :P  Please do not override or you'll kill our server :(
<a name="l166"><span class="linenum"> 166</span></a>                  <a class="var it8110" onMouseOver="hilite(8110)" onMouseOut="lolite()" onClick="logVariable('new_start_datetime')" href="../../_variables/new_start_datetime.html">$new_start_datetime</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../_variables/localtimenow.html">$localtimenow</a> + <a class="phpfunction" onClick="logFunction('rand')" href="../../_functions/rand.html" onMouseOver="phpfuncPopup(event,'rand')">rand</a>( 43200, 86400 ); <span class="comment">// 12 to 24 hours</span>
<a name="l167"><span class="linenum"> 167</span></a>              }
<a name="l168"><span class="linenum"> 168</span></a>              else
<a name="l169"><span class="linenum"> 169</span></a>              {    // Normal
<a name="l170"><span class="linenum"> 170</span></a>                  <a class="var it8110" onMouseOver="hilite(8110)" onMouseOut="lolite()" onClick="logVariable('new_start_datetime')" href="../../_variables/new_start_datetime.html">$new_start_datetime</a> = <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../_variables/localtimenow.html">$localtimenow</a> + <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_repeat_after')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_repeat_after.html">ctsk_repeat_after</a>;
<a name="l171"><span class="linenum"> 171</span></a>              }
<a name="l172"><span class="linenum"> 172</span></a>              <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = 'INSERT INTO T_cron__task( ctsk_start_datetime, ctsk_repeat_after, ctsk_name, ctsk_controller, ctsk_params )
<a name="l173"><span class="linenum"> 173</span></a>                              VALUES( '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="function" onClick="logFunction('date2mysql')" href="../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>(<a class="var it8110" onMouseOver="hilite(8110)" onMouseOut="lolite()" onClick="logVariable('new_start_datetime')" href="../../_variables/new_start_datetime.html">$new_start_datetime</a>)).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_repeat_after')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_repeat_after.html">ctsk_repeat_after</a>).', '
<a name="l174"><span class="linenum"> 174</span></a>                                                  .<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('ctsk_name')" href="../../_variables/ctsk_name.html">$ctsk_name</a>).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_controller')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_controller.html">ctsk_controller</a>).', '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_params')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_params.html">ctsk_params</a>).' )';
<a name="l175"><span class="linenum"> 175</span></a>              <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, 'Schedule repeated task.' );
<a name="l176"><span class="linenum"> 176</span></a>          }
<a name="l177"><span class="linenum"> 177</span></a>  
<a name="l178"><span class="linenum"> 178</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('show_errors')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/show_errors.html">show_errors</a> = true;
<a name="l179"><span class="linenum"> 179</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('halt_on_error')" class="var it8966" onMouseOver="hilite(8966)" onMouseOut="lolite()" href="../../_variables/halt_on_error.html">halt_on_error</a> = true;
<a name="l180"><span class="linenum"> 180</span></a>          <a class="function" onClick="logFunction('cron_log')" href="../../_functions/cron_log.html" onMouseOver="funcPopup(event,'cron_log')">cron_log</a>( 'Starting task #'.<a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('ctsk_ID')" href="../../_variables/ctsk_ID.html">$ctsk_ID</a>.' ['.<a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('ctsk_name')" href="../../_variables/ctsk_name.html">$ctsk_name</a>.'] at '.<a class="phpfunction" onClick="logFunction('date')" href="../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'H:i:s', <a class="var it13" onMouseOver="hilite(13)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../_variables/localtimenow.html">$localtimenow</a> ).'.', 1 );
<a name="l181"><span class="linenum"> 181</span></a>  
<a name="l182"><span class="linenum"> 182</span></a>          if( empty(<a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_params')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_params.html">ctsk_params</a>) )
<a name="l183"><span class="linenum"> 183</span></a>          {
<a name="l184"><span class="linenum"> 184</span></a>              <a class="var it8111" onMouseOver="hilite(8111)" onMouseOut="lolite()" onClick="logVariable('cron_params')" href="../../_variables/cron_params.html">$cron_params</a> = array();
<a name="l185"><span class="linenum"> 185</span></a>          }
<a name="l186"><span class="linenum"> 186</span></a>          else
<a name="l187"><span class="linenum"> 187</span></a>          {
<a name="l188"><span class="linenum"> 188</span></a>              <a class="var it8111" onMouseOver="hilite(8111)" onMouseOut="lolite()" onClick="logVariable('cron_params')" href="../../_variables/cron_params.html">$cron_params</a> = <a class="phpfunction" onClick="logFunction('unserialize')" href="../../_functions/unserialize.html" onMouseOver="phpfuncPopup(event,'unserialize')">unserialize</a>( <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_params')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_params.html">ctsk_params</a> );
<a name="l189"><span class="linenum"> 189</span></a>          }
<a name="l190"><span class="linenum"> 190</span></a>  
<a name="l191"><span class="linenum"> 191</span></a>  <span class="comment">        // The job may need to know its ID and name (to set logical locks for example):</span>
<a name="l192"><span class="linenum"> 192</span></a>          <a class="var it8111" onMouseOver="hilite(8111)" onMouseOut="lolite()" onClick="logVariable('cron_params')" href="../../_variables/cron_params.html">$cron_params</a>['ctsk_ID'] = <a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('ctsk_ID')" href="../../_variables/ctsk_ID.html">$ctsk_ID</a>;
<a name="l193"><span class="linenum"> 193</span></a>  
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">        // EXECUTE</span>
<a name="l195"><span class="linenum"> 195</span></a>          <a class="var it350" onMouseOver="hilite(350)" onMouseOut="lolite()" onClick="logVariable('error_message')" href="../../_variables/error_message.html">$error_message</a> = <a class="function" onClick="logFunction('call_job')" href="../../_functions/call_job.html" onMouseOver="funcPopup(event,'call_job')">call_job</a>( <a class="var it1372" onMouseOver="hilite(1372)" onMouseOut="lolite()" onClick="logVariable('task')" href="../../_variables/task.html">$task</a>-&gt;<a onClick="logVariable('ctsk_controller')" class="var it9110" onMouseOver="hilite(9110)" onMouseOut="lolite()" href="../../_variables/ctsk_controller.html">ctsk_controller</a>, <a class="var it8111" onMouseOver="hilite(8111)" onMouseOut="lolite()" onClick="logVariable('cron_params')" href="../../_variables/cron_params.html">$cron_params</a> );
<a name="l196"><span class="linenum"> 196</span></a>          if( !empty( <a class="var it350" onMouseOver="hilite(350)" onMouseOut="lolite()" onClick="logVariable('error_message')" href="../../_variables/error_message.html">$error_message</a> ) )
<a name="l197"><span class="linenum"> 197</span></a>          {
<a name="l198"><span class="linenum"> 198</span></a>              <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('error_task')" href="../../_variables/error_task.html">$error_task</a> = array(
<a name="l199"><span class="linenum"> 199</span></a>                      'ID'      =&gt; <a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('ctsk_ID')" href="../../_variables/ctsk_ID.html">$ctsk_ID</a>,
<a name="l200"><span class="linenum"> 200</span></a>                      'name'    =&gt; <a class="var it2246" onMouseOver="hilite(2246)" onMouseOut="lolite()" onClick="logVariable('ctsk_name')" href="../../_variables/ctsk_name.html">$ctsk_name</a>,
<a name="l201"><span class="linenum"> 201</span></a>                      'message' =&gt; <a class="var it350" onMouseOver="hilite(350)" onMouseOut="lolite()" onClick="logVariable('error_message')" href="../../_variables/error_message.html">$error_message</a>,
<a name="l202"><span class="linenum"> 202</span></a>                  );
<a name="l203"><span class="linenum"> 203</span></a>          }
<a name="l204"><span class="linenum"> 204</span></a>  
<a name="l205"><span class="linenum"> 205</span></a>  <span class="comment">        // Record task as finished:</span>
<a name="l206"><span class="linenum"> 206</span></a>          if( empty(<a class="var it348" onMouseOver="hilite(348)" onMouseOut="lolite()" onClick="logVariable('timestop')" href="../../_variables/timestop.html">$timestop</a>) )
<a name="l207"><span class="linenum"> 207</span></a>          {
<a name="l208"><span class="linenum"> 208</span></a>              <a class="var it348" onMouseOver="hilite(348)" onMouseOut="lolite()" onClick="logVariable('timestop')" href="../../_variables/timestop.html">$timestop</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() + <a class="var it349" onMouseOver="hilite(349)" onMouseOut="lolite()" onClick="logVariable('time_difference')" href="../../_variables/time_difference.html">$time_difference</a>;
<a name="l209"><span class="linenum"> 209</span></a>          }
<a name="l210"><span class="linenum"> 210</span></a>  
<a name="l211"><span class="linenum"> 211</span></a>          if( <a class="phpfunction" onClick="logFunction('is_array')" href="../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>( <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('result_message')" href="../../_variables/result_message.html">$result_message</a> ) )
<a name="l212"><span class="linenum"> 212</span></a>          {    // If result is array we should store it as serialized data
<a name="l213"><span class="linenum"> 213</span></a>              <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('result_message')" href="../../_variables/result_message.html">$result_message</a> = <a class="phpfunction" onClick="logFunction('serialize')" href="../../_functions/serialize.html" onMouseOver="phpfuncPopup(event,'serialize')">serialize</a>( <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('result_message')" href="../../_variables/result_message.html">$result_message</a> );
<a name="l214"><span class="linenum"> 214</span></a>          }
<a name="l215"><span class="linenum"> 215</span></a>  
<a name="l216"><span class="linenum"> 216</span></a>          <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a> = ' UPDATE T_cron__log
<a name="l217"><span class="linenum"> 217</span></a>                                  SET clog_status = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it347" onMouseOver="hilite(347)" onMouseOut="lolite()" onClick="logVariable('result_status')" href="../../_variables/result_status.html">$result_status</a>).',
<a name="l218"><span class="linenum"> 218</span></a>                                          clog_realstop_datetime = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('date2mysql')" href="../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>( <a class="var it348" onMouseOver="hilite(348)" onMouseOut="lolite()" onClick="logVariable('timestop')" href="../../_variables/timestop.html">$timestop</a> ) ).',
<a name="l219"><span class="linenum"> 219</span></a>                                          clog_messages = '.<a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it340" onMouseOver="hilite(340)" onMouseOut="lolite()" onClick="logVariable('result_message')" href="../../_variables/result_message.html">$result_message</a> ) <span class="comment">/* May be NULL */</span>.'
<a name="l220"><span class="linenum"> 220</span></a>                              WHERE clog_ctsk_ID = '.<a class="var it2244" onMouseOver="hilite(2244)" onMouseOut="lolite()" onClick="logVariable('ctsk_ID')" href="../../_variables/ctsk_ID.html">$ctsk_ID</a>;
<a name="l221"><span class="linenum"> 221</span></a>          <a class="var it12" onMouseOver="hilite(12)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it42" onMouseOver="hilite(42)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../_variables/sql.html">$sql</a>, 'Record task as finished.' );
<a name="l222"><span class="linenum"> 222</span></a>      }
<a name="l223"><span class="linenum"> 223</span></a>  }
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>  
<a name="l226"><span class="linenum"> 226</span></a>  <span class="comment">//echo 'detecting timeouts...';</span>
<a name="l227"><span class="linenum"> 227</span></a>  <span class="comment">// Detect timed out tasks:</span>
<a name="l228"><span class="linenum"> 228</span></a>  <a class="function" onClick="logFunction('detect_timeout_cron_jobs')" href="../../_functions/detect_timeout_cron_jobs.html" onMouseOver="funcPopup(event,'detect_timeout_cron_jobs')">detect_timeout_cron_jobs</a>( <a class="var it361" onMouseOver="hilite(361)" onMouseOut="lolite()" onClick="logVariable('error_task')" href="../../_variables/error_task.html">$error_task</a> );
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>  
<a name="l231"><span class="linenum"> 231</span></a>  
<a name="l232"><span class="linenum"> 232</span></a>  if( ! <a class="var it3118" onMouseOver="hilite(3118)" onMouseOut="lolite()" onClick="logVariable('is_cli')" href="../../_variables/is_cli.html">$is_cli</a> )
<a name="l233"><span class="linenum"> 233</span></a>  { // This is a web request:
<a name="l234"><span class="linenum"> 234</span></a>      echo '&lt;p&gt;&lt;a href=&quot;cron_exec.php&quot;&gt;Refresh Now!&lt;/a&gt;&lt;/p&gt;';
<a name="l235"><span class="linenum"> 235</span></a>      echo '&lt;p&gt;This page should refresh automatically in 15 seconds...&lt;/p&gt;';
<a name="l236"><span class="linenum"> 236</span></a>      echo '&lt;!-- This is invalid HTML but it is SOOOOOO helpful! (Delay will be triggered when we reach that point --&gt;';
<a name="l237"><span class="linenum"> 237</span></a>      echo '&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;15&quot; /&gt;';
<a name="l238"><span class="linenum"> 238</span></a>      ?&gt;
<a name="l239"><span class="linenum"> 239</span></a>      &lt;/body&gt;
<a name="l240"><span class="linenum"> 240</span></a>      &lt;/html&gt;
<a name="l241"><span class="linenum"> 241</span></a>      &lt;?php
<a name="l242"><span class="linenum"> 242</span></a>  }
<a name="l243"><span class="linenum"> 243</span></a>  
<a name="l244"><span class="linenum"> 244</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'cron_log': ['cron_log', 'Log a message from cron. ', [['blogs/inc/cron','_cron.funcs.php',32]], 7],
'date2mysql': ['date2mysql', 'Convert timestamp to MySQL/ISO format. ', [['blogs/inc/_core','_misc.funcs.php',1238]], 40],
'init_charsets': ['init_charsets', 'Init charset handling between Input/Output ($io_charset) and the internal handling ($evo_charset). ', [['blogs/inc/locales','_locale.funcs.php',1081]], 12],
'locale_overwritefromdb': ['locale_overwritefromdb', 'load locales from DB into $locales array. Also sets $default_locale. ', [['blogs/inc/locales','_locale.funcs.php',710]], 3],
'locale_activate': ['locale_activate', 'Activate a locale. ', [['blogs/inc/locales','_locale.funcs.php',314]], 17],
'require_css': ['require_css', 'Memorize that a specific css that file will be required by the current page. All requested files will be included in the page head only once (when headlines is called) ', [['blogs/inc/_core','_template.funcs.php',947]], 236],
'detect_timeout_cron_jobs': ['detect_timeout_cron_jobs', 'Detect timed out cron jobs and Send notifications ', [['blogs/inc/cron','_cron.funcs.php',213]], 2],
'header_nocache': ['header_nocache', 'Sends HTTP headers to avoid caching of the page at the browser level (at least without revalidating with the server to make sure whether the content has changed or not). ', [['blogs/inc/_core','_template.funcs.php',270]], 9],
'include_headlines': ['include_headlines', 'Outputs the collected HTML HEAD lines. ', [['blogs/inc/_core','_template.funcs.php',1567]], 14],
'header_content_type': ['header_content_type', 'Template tag. Output content-type header ', [['blogs/inc/_core','_template.funcs.php',37]], 6],
'load_funcs': ['load_funcs', '', [['blogs/inc/_core','_misc.funcs.php',115]], 214],
'get': ['get', '', [['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',941],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',15011],['blogs/plugins/tinymce_plugin/tiny_mce/plugins/media/js','media.js',7],['blogs/inc/links/model','_linkowner.class.php',221],['blogs/inc/_core/model/db','_sql.class.php',64],['blogs/inc/plugins/model','_pluginsettings.class.php',58],['blogs/inc/collections/model','_blog.class.php',1822],['blogs/inc/settings/model','_generalsettings.class.php',383],['blogs/inc/settings/model','_abstractsettings.class.php',271],['blogs/inc/plugins/model','_pluginusersettings.class.php',58],['blogs/inc/users/model','_user.class.php',1126],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_gzip.js',38],['blogs/inc/users/model','_usersettings.class.php',151],['blogs/inc/comments/model','_comment.class.php',301],['blogs/inc/users/model','_groupsettings.class.php',124],['blogs/inc/cron/model','_cronjob.class.php',104],['blogs/inc/items/model','_item.class.php',5742],['blogs/inc/sessions/model','_session.class.php',397],['blogs/inc/links/model','_linkuser.class.php',141],['blogs/inc/links/model','_linkitem.class.php',155],['blogs/inc/slugs/model','_slug.class.php',68],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',574],['blogs/plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['blogs/inc/antispam/model','_iprange.class.php',69],['blogs/inc/links/model','_linkcomment.class.php',132],['blogs/inc/files/model','_file.class.php',532]], 2417],
'get_row': ['get_row', 'Get one row from the DB. ', [['blogs/inc/_core/model/db','_db.class.php',996]], 57],
'quote': ['quote', 'Quote a msgid/msgstr, preferrable with single quotes. ', [['blogs/inc/locales','_pofile.class.php',267],['blogs/inc/_core/model/db','_db.class.php',503]], 791],
'call_job': ['call_job', 'Call a cron job. ', [['blogs/inc/cron','_cron.funcs.php',59]], 1],
'query': ['query', 'Run Query: GET DATA ROWS *** HEAVY *** ', [['blogs/inc/items/model','_itemlist.class.php',256],['blogs/inc/items/model','_itemlistlight.class.php',751],['blogs/inc/_core/model/db','_db.class.php',761],['blogs/inc/users/model','_userlist.class.php',474],['blogs/inc/_core/ui/results','_results.class.php',439],['blogs/inc/comments/model','_commentlist.class.php',515]], 972],
'dirname': ['dirname', '', [], 186],
'array_slice': ['array_slice', '', [], 41],
'time': ['time', '', [], 57],
'rand': ['rand', '', [], 22],
'unserialize': ['unserialize', '', [], 16],
'date': ['date', '', [], 361],
'is_array': ['is_array', '', [], 243],
'serialize': ['serialize', '', [], 109]};
CLASS_DATA={
};
CONST_DATA={
'OBJECT': ['OBJECT', '', [['blogs/inc/_core/model/db','_db.class.php',69]], 53]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Jul  5 12:18:44 2014</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
