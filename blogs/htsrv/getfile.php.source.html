<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /blogs/htsrv/getfile.php source</title>
    <link rel="stylesheet" href="../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Jul  5 12:18:44 2014 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../';
subdir='blogs/htsrv';
filename='getfile.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/blogs/htsrv/</a> -> <a href="getfile.php.html">getfile.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="getfile.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="getfile.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This file implements the File view (including resizing of images)</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * This file is part of the evoCore framework - {@link http://evocore.net/}</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * See also {@link http://sourceforge.net/projects/evocms/}.</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> *</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * @copyright (c)2003-2014 by Francois Planque - {@link http://fplanque.com/}</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * Parts of this file are copyright (c)2005-2006 by PROGIDISTRI - {@link http://progidistri.com/}.</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> *</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * {@internal License choice</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> * - If you have received this file as part of a package, please find the license.txt file in</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> *   the same folder or the closest folder above for complete license terms.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> * - If you have received this file individually (e-g: from http://evocms.cvs.sourceforge.net/)</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> *   then you must choose one of the following licenses before using the file:</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment"> *   - GNU General Public License 2 (GPL) - http://www.opensource.org/licenses/gpl-license.php</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> *   - Mozilla Public License 1.1 (MPL) - http://www.opensource.org/licenses/mozilla1.1.php</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * }}</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> *</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * {@internal Open Source relicensing agreement:</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * PROGIDISTRI S.A.S. grants Francois PLANQUE the right to license</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * PROGIDISTRI S.A.S.'s contributions to this file and the b2evolution project</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> * under any OSI approved OSS license (http://www.opensource.org/licenses/).</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * }}</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> *</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> * @package htsrv</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> *</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * @todo dh&gt; Add support for ETag / If-Modified-Since. Maybe send &quot;Expires&quot;, too? (to &quot;force&quot; caching)</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> *       fp&gt; for more efficient caching (like creating a thumbnail on view 1 then displaying the thumbnail again on view 2), this should probably redirect to the static file right after creating it (when $public_access_to_media=true OF COURSE)</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> *       dh&gt; this would add another redirect/HTTP request and no cache handling, assuming</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> *           that the server is not configured for smart caching.</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="comment"> *           Additionally, it does not help for non-public access, which is the meat of this file.</span>
<a name="l33"><span class="linenum">  33</span></a>  <span class="comment"> *           I've added &quot;Expires: in ten years&quot; now, but not for thumbs (see comment there).</span>
<a name="l34"><span class="linenum">  34</span></a>  <span class="comment"> *</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment"> * {@internal Below is a list of authors who have contributed to design/coding of this file: }}</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment"> * @author blueyed: Daniel HAHLER</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment"> * @author fplanque: Francois PLANQUE.</span>
<a name="l38"><span class="linenum">  38</span></a>  <span class="comment"> * @author mbruneau: Marc BRUNEAU / PROGIDISTRI</span>
<a name="l39"><span class="linenum">  39</span></a>  <span class="comment"> */</span>
<a name="l40"><span class="linenum">  40</span></a>  
<a name="l41"><span class="linenum">  41</span></a>  
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">/**</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment"> * Load config, init and get the {@link $mode mode param}.</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment"> */</span>
<a name="l45"><span class="linenum">  45</span></a>  require_once <a class="phpfunction" onClick="logFunction('dirname')" href="../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(__FILE__).'/../conf/_config.php';
<a name="l46"><span class="linenum">  46</span></a>  require_once <a class="var it246" onMouseOver="hilite(246)" onMouseOut="lolite()" onClick="logVariable('inc_path')" href="../../_variables/inc_path.html">$inc_path</a>.'/_main.inc.php';
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>  if( ! isset(<a class="var it542" onMouseOver="hilite(542)" onMouseOut="lolite()" onClick="logVariable('GLOBALS')" href="../../_variables/GLOBALS.html">$GLOBALS</a>['files_Module']) )
<a name="l49"><span class="linenum">  49</span></a>  {
<a name="l50"><span class="linenum">  50</span></a>      <a class="function" onClick="logFunction('debug_die')" href="../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'Files module is disabled or missing!' );
<a name="l51"><span class="linenum">  51</span></a>  }
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment">// We need this param early to check blog perms, if possible</span>
<a name="l54"><span class="linenum">  54</span></a>  <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'root', 'string', true ); <span class="comment">// the root directory from the dropdown box (user_X or blog_X; X is ID - 'user' for current user (default))</span>
<a name="l55"><span class="linenum">  55</span></a>  
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">// Check permission:</span>
<a name="l57"><span class="linenum">  57</span></a>  if( ! <a class="var it2198" onMouseOver="hilite(2198)" onMouseOut="lolite()" onClick="logVariable('public_access_to_media')" href="../../_variables/public_access_to_media.html">$public_access_to_media</a> )
<a name="l58"><span class="linenum">  58</span></a>  {
<a name="l59"><span class="linenum">  59</span></a>      if( ! isset(<a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../_variables/current_User.html">$current_User</a>) )
<a name="l60"><span class="linenum">  60</span></a>      {
<a name="l61"><span class="linenum">  61</span></a>          <a class="function" onClick="logFunction('debug_die')" href="../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'No permission to get <a class="phpfunction" onClick="logFunction('file')" href="../../_functions/file.html" onMouseOver="phpfuncPopup(event,'file')">file</a> (not logged in)!', array('status'=&gt;'403 Forbidden') );
<a name="l62"><span class="linenum">  62</span></a>      }
<a name="l63"><span class="linenum">  63</span></a>  
<a name="l64"><span class="linenum">  64</span></a>  
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">    // fp&gt; I don't think we need the following if public_access_to_media</span>
<a name="l66"><span class="linenum">  66</span></a>      if( <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '/^collection_(\d+)$/', <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('root')" href="../../_variables/root.html">$root</a>, <a class="var it2199" onMouseOver="hilite(2199)" onMouseOut="lolite()" onClick="logVariable('perm_blog')" href="../../_variables/perm_blog.html">$perm_blog</a> ) )
<a name="l67"><span class="linenum">  67</span></a>      {    // OK, we got a blog ID:
<a name="l68"><span class="linenum">  68</span></a>          <a class="var it2199" onMouseOver="hilite(2199)" onMouseOut="lolite()" onClick="logVariable('perm_blog')" href="../../_variables/perm_blog.html">$perm_blog</a> = <a class="var it2199" onMouseOver="hilite(2199)" onMouseOut="lolite()" onClick="logVariable('perm_blog')" href="../../_variables/perm_blog.html">$perm_blog</a>[1];
<a name="l69"><span class="linenum">  69</span></a>      }
<a name="l70"><span class="linenum">  70</span></a>      else
<a name="l71"><span class="linenum">  71</span></a>      {    // No blog ID, we will check the global group perm
<a name="l72"><span class="linenum">  72</span></a>          <a class="var it2199" onMouseOver="hilite(2199)" onMouseOut="lolite()" onClick="logVariable('perm_blog')" href="../../_variables/perm_blog.html">$perm_blog</a> = NULL;
<a name="l73"><span class="linenum">  73</span></a>      }
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">    //pre_dump( $perm_blog );</span>
<a name="l75"><span class="linenum">  75</span></a>  
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">    // Check permission (#2):</span>
<a name="l77"><span class="linenum">  77</span></a>      <a class="var it11" onMouseOver="hilite(11)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'files', 'view', true, <a class="var it2199" onMouseOver="hilite(2199)" onMouseOut="lolite()" onClick="logVariable('perm_blog')" href="../../_variables/perm_blog.html">$perm_blog</a> );
<a name="l78"><span class="linenum">  78</span></a>  }
<a name="l79"><span class="linenum">  79</span></a>  
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">// Load the other params:</span>
<a name="l81"><span class="linenum">  81</span></a>  <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'path', 'string', true );
<a name="l82"><span class="linenum">  82</span></a>  <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'size', 'string', NULL ); <span class="comment">// Can be used for images.</span>
<a name="l83"><span class="linenum">  83</span></a>  <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'size_x', 'integer', 1 ); <span class="comment">// Ratio size, can be 1, 2 and etc.</span>
<a name="l84"><span class="linenum">  84</span></a>  <a class="function" onClick="logFunction('param')" href="../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'mtime', 'integer', 0 );  <span class="comment">// used for unique URLs (that never expire).</span>
<a name="l85"><span class="linenum">  85</span></a>  
<a name="l86"><span class="linenum">  86</span></a>  if( <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> != 1 &amp;&amp; <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> != 2 )
<a name="l87"><span class="linenum">  87</span></a>  { // Allow only 1x and 2x sizes, in order to avoid hack that creates many x versions
<a name="l88"><span class="linenum">  88</span></a>      <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> = 1;
<a name="l89"><span class="linenum">  89</span></a>  }
<a name="l90"><span class="linenum">  90</span></a>  
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">// TODO: dh&gt; this failed with filenames containing multiple dots!</span>
<a name="l92"><span class="linenum">  92</span></a>  if ( false !== <a class="phpfunction" onClick="logFunction('strpos')" href="../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="phpfunction" onClick="logFunction('urldecode')" href="../../_functions/urldecode.html" onMouseOver="phpfuncPopup(event,'urldecode')">urldecode</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a> ), '..' ) )
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">// TODO: dh&gt; fix this better. by adding is_relative_path()?</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">// fp&gt; the following doesn't look secure. I can't take the risk. What if the path ends with or is just '..' ? I don't want to allow this to go through.</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">// if( preg_match( '~\.\.[/\\\]~', urldecode( $path ) ) )</span>
<a name="l96"><span class="linenum">  96</span></a>  {
<a name="l97"><span class="linenum">  97</span></a>      <a class="function" onClick="logFunction('debug_die')" href="../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'Relative pathnames not allowed!' );
<a name="l98"><span class="linenum">  98</span></a>  }
<a name="l99"><span class="linenum">  99</span></a>  
<a name="l100"><span class="linenum"> 100</span></a>  <span class="comment">// Load fileroot info:</span>
<a name="l101"><span class="linenum"> 101</span></a>  <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../_variables/FileRootCache.html">$FileRootCache</a> = &amp; get_FileRootCache();
<a name="l102"><span class="linenum"> 102</span></a>  <a class="var it783" onMouseOver="hilite(783)" onMouseOut="lolite()" onClick="logVariable('FileRoot')" href="../../_variables/FileRoot.html">$FileRoot</a> = &amp; <a class="var it782" onMouseOver="hilite(782)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../_variables/FileRootCache.html">$FileRootCache</a>-&gt;get_by_ID( <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('root')" href="../../_variables/root.html">$root</a> );
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">// Load file object (not the file content):</span>
<a name="l105"><span class="linenum"> 105</span></a>  <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a> = <span class="keyword">new </span><a class="class" onClick="logClass('File')" href="../../_classes/file.html" onMouseOver="classPopup(event,'file')">File</a>( <a class="var it783" onMouseOver="hilite(783)" onMouseOut="lolite()" onClick="logVariable('FileRoot')" href="../../_variables/FileRoot.html">$FileRoot</a>-&gt;<a onClick="logVariable('type')" class="var it9064" onMouseOver="hilite(9064)" onMouseOut="lolite()" href="../../_variables/type.html">type</a>, <a class="var it783" onMouseOver="hilite(783)" onMouseOut="lolite()" onClick="logVariable('FileRoot')" href="../../_variables/FileRoot.html">$FileRoot</a>-&gt;<a onClick="logVariable('in_type_ID')" class="var it9064" onMouseOver="hilite(9064)" onMouseOut="lolite()" href="../../_variables/in_type_ID.html">in_type_ID</a>, <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('path')" href="../../_variables/path.html">$path</a> );
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>  <span class="comment">// Check if the request has an If-Modified-Since date</span>
<a name="l108"><span class="linenum"> 108</span></a>  if( <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( 'HTTP_IF_MODIFIED_SINCE', <a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a> ) )
<a name="l109"><span class="linenum"> 109</span></a>  {
<a name="l110"><span class="linenum"> 110</span></a>      <a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('if_modified_since')" href="../../_variables/if_modified_since.html">$if_modified_since</a> = <a class="phpfunction" onClick="logFunction('strtotime')" href="../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>('/;.*$/','',<a class="var it202" onMouseOver="hilite(202)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../_variables/_SERVER.html">$_SERVER</a>['HTTP_IF_MODIFIED_SINCE']) );
<a name="l111"><span class="linenum"> 111</span></a>      <a class="var it2201" onMouseOver="hilite(2201)" onMouseOut="lolite()" onClick="logVariable('file_lastmode_ts')" href="../../_variables/file_lastmode_ts.html">$file_lastmode_ts</a> = <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_lastmod_ts')" href="../../_functions/get_lastmod_ts.html" onMouseOver="funcPopup(event,'get_lastmod_ts')">get_lastmod_ts</a>();
<a name="l112"><span class="linenum"> 112</span></a>      if( <a class="var it2201" onMouseOver="hilite(2201)" onMouseOut="lolite()" onClick="logVariable('file_lastmode_ts')" href="../../_variables/file_lastmode_ts.html">$file_lastmode_ts</a> &lt;= <a class="var it2200" onMouseOver="hilite(2200)" onMouseOut="lolite()" onClick="logVariable('if_modified_since')" href="../../_variables/if_modified_since.html">$if_modified_since</a> )
<a name="l113"><span class="linenum"> 113</span></a>      { // file was not modified since if_modified_since ts
<a name="l114"><span class="linenum"> 114</span></a>          <a class="function" onClick="logFunction('header_http_response')" href="../../_functions/header_http_response.html" onMouseOver="funcPopup(event,'header_http_response')">header_http_response</a>( '304 Not Modified' );
<a name="l115"><span class="linenum"> 115</span></a>          exit(0);
<a name="l116"><span class="linenum"> 116</span></a>      }
<a name="l117"><span class="linenum"> 117</span></a>  }
<a name="l118"><span class="linenum"> 118</span></a>  
<a name="l119"><span class="linenum"> 119</span></a>  if( ! empty( <a class="var it450" onMouseOver="hilite(450)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../_variables/size.html">$size</a> ) &amp;&amp; <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('is_image')" href="../../_functions/is_image.html" onMouseOver="funcPopup(event,'is_image')">is_image</a>() )
<a name="l120"><span class="linenum"> 120</span></a>  {    // We want a thumbnail:
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">    // fp&gt; TODO: for more efficient caching, this should probably redirect to the static file right after creating it (when $public_access_to_media=true OF COURSE)</span>
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>      global <a class="var it1498" onMouseOver="hilite(1498)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>;
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>      <a class="function" onClick="logFunction('load_funcs')" href="../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( '/files/model/_image.funcs.php' );
<a name="l126"><span class="linenum"> 126</span></a>  
<a name="l127"><span class="linenum"> 127</span></a>      <a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a> = <a class="var it450" onMouseOver="hilite(450)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../_variables/size.html">$size</a>;
<a name="l128"><span class="linenum"> 128</span></a>      if( ! isset( <a class="var it1498" onMouseOver="hilite(1498)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[<a class="var it450" onMouseOver="hilite(450)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../_variables/size.html">$size</a>] ) )
<a name="l129"><span class="linenum"> 129</span></a>      { // this file size alias is not defined, use default:
<a name="l130"><span class="linenum"> 130</span></a>  <span class="comment">        // TODO: dh&gt; this causes links for e.g. &quot;fit-50x50&quot; to work also, but with the drawback of images not getting served from the</span>
<a name="l131"><span class="linenum"> 131</span></a>  <span class="comment">        //           .evocache directory directly. I think invalid $size params should bark out here.</span>
<a name="l132"><span class="linenum"> 132</span></a>  <span class="comment">        // fp&gt; ok.</span>
<a name="l133"><span class="linenum"> 133</span></a>          <a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a> = 'fit-80x80';
<a name="l134"><span class="linenum"> 134</span></a>      }
<a name="l135"><span class="linenum"> 135</span></a>  
<a name="l136"><span class="linenum"> 136</span></a>      if( ! isset ( <a class="var it1498" onMouseOver="hilite(1498)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[<a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>][4] ) )
<a name="l137"><span class="linenum"> 137</span></a>      {    // Set blur percent in 0 by default
<a name="l138"><span class="linenum"> 138</span></a>          <a class="var it1498" onMouseOver="hilite(1498)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[<a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>][4] = 0;
<a name="l139"><span class="linenum"> 139</span></a>      }
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">    // Set all params for requested size:</span>
<a name="l141"><span class="linenum"> 141</span></a>      <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('thumb_type')" href="../../_variables/thumb_type.html">$thumb_type</a>, <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('thumb_width')" href="../../_variables/thumb_width.html">$thumb_width</a>, <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('thumb_height')" href="../../_variables/thumb_height.html">$thumb_height</a>, <a class="var it2203" onMouseOver="hilite(2203)" onMouseOut="lolite()" onClick="logVariable('thumb_quality')" href="../../_variables/thumb_quality.html">$thumb_quality</a>, <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('thumb_percent_blur')" href="../../_variables/thumb_percent_blur.html">$thumb_percent_blur</a> ) = <a class="var it1498" onMouseOver="hilite(1498)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[<a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>];
<a name="l142"><span class="linenum"> 142</span></a>  
<a name="l143"><span class="linenum"> 143</span></a>      <a class="var it1544" onMouseOver="hilite(1544)" onMouseOut="lolite()" onClick="logVariable('Filetype')" href="../../_variables/Filetype.html">$Filetype</a> = &amp; <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;get_Filetype();
<a name="l144"><span class="linenum"> 144</span></a>  <span class="comment">    // pre_dump( $Filetype );</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">    // TODO: dh&gt; Filetype may be NULL here! see also r1.18 (IIRC)</span>
<a name="l146"><span class="linenum"> 146</span></a>      <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a> = <a class="var it1544" onMouseOver="hilite(1544)" onMouseOut="lolite()" onClick="logVariable('Filetype')" href="../../_variables/Filetype.html">$Filetype</a>-&gt;<a onClick="logVariable('mimetype')" class="var it9065" onMouseOver="hilite(9065)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a>;
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">    // pre_dump( $mimetype );</span>
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">    // Try to output the cached thumbnail:</span>
<a name="l150"><span class="linenum"> 150</span></a>      <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('output_cached_thumb')" href="../../_functions/output_cached_thumb.html" onMouseOver="funcPopup(event,'output_cached_thumb')">output_cached_thumb</a>( <a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>, <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>, <a class="var it2204" onMouseOver="hilite(2204)" onMouseOut="lolite()" onClick="logVariable('mtime')" href="../../_variables/mtime.html">$mtime</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> );
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment">    //pre_dump( $err );</span>
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>      if( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> == '!Thumbnail not found in'.<a class="var it10" onMouseOver="hilite(10)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'evocache_foldername' ) )
<a name="l154"><span class="linenum"> 154</span></a>      {    // The thumbnail wasn't already in the cache, try to generate and cache it now:
<a name="l155"><span class="linenum"> 155</span></a>          <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = NULL;        <span class="comment">// Short error code</span>
<a name="l156"><span class="linenum"> 156</span></a>  
<a name="l157"><span class="linenum"> 157</span></a>          <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it1501" onMouseOver="hilite(1501)" onMouseOut="lolite()" onClick="logVariable('src_width')" href="../../_variables/src_width.html">$src_width</a>, <a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('src_height')" href="../../_variables/src_height.html">$src_height</a> ) = <a class="function" onClick="logFunction('imgsize')" href="../../_functions/imgsize.html" onMouseOver="funcPopup(event,'imgsize')">imgsize</a>( <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_full_path')" href="../../_functions/get_full_path.html" onMouseOver="funcPopup(event,'get_full_path')">get_full_path</a>() );
<a name="l158"><span class="linenum"> 158</span></a>  
<a name="l159"><span class="linenum"> 159</span></a>          if( ! <a class="var it2205" onMouseOver="hilite(2205)" onMouseOut="lolite()" onClick="logVariable('resample_all_images')" href="../../_variables/resample_all_images.html">$resample_all_images</a> &amp;&amp; <a class="var it1501" onMouseOver="hilite(1501)" onMouseOut="lolite()" onClick="logVariable('src_width')" href="../../_variables/src_width.html">$src_width</a> &lt;= <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('thumb_width')" href="../../_variables/thumb_width.html">$thumb_width</a> &amp;&amp; <a class="var it1502" onMouseOver="hilite(1502)" onMouseOut="lolite()" onClick="logVariable('src_height')" href="../../_variables/src_height.html">$src_height</a> &lt;= <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('thumb_height')" href="../../_variables/thumb_height.html">$thumb_height</a> )
<a name="l160"><span class="linenum"> 160</span></a>          {    // There is no need to resample, use original!
<a name="l161"><span class="linenum"> 161</span></a>              <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_af_thumb_path')" href="../../_functions/get_af_thumb_path.html" onMouseOver="funcPopup(event,'get_af_thumb_path')">get_af_thumb_path</a>( <a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>, <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>, true, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> );
<a name="l162"><span class="linenum"> 162</span></a>  
<a name="l163"><span class="linenum"> 163</span></a>              if( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>[0] != '!' &amp;&amp; @<a class="phpfunction" onClick="logFunction('copy')" href="../../_functions/copy.html" onMouseOver="phpfuncPopup(event,'copy')">copy</a>( <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_full_path')" href="../../_functions/get_full_path.html" onMouseOver="funcPopup(event,'get_full_path')">get_full_path</a>(), <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> ) )
<a name="l164"><span class="linenum"> 164</span></a>              {    // File was saved. Ouput that same file immediately:
<a name="l165"><span class="linenum"> 165</span></a>  <span class="comment">                // note: @copy returns FALSE on failure, if not muted it'll print the error on screen</span>
<a name="l166"><span class="linenum"> 166</span></a>                  <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('output_cached_thumb')" href="../../_functions/output_cached_thumb.html" onMouseOver="funcPopup(event,'output_cached_thumb')">output_cached_thumb</a>( <a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>, <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>, <a class="var it2204" onMouseOver="hilite(2204)" onMouseOut="lolite()" onClick="logVariable('mtime')" href="../../_variables/mtime.html">$mtime</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> );
<a name="l167"><span class="linenum"> 167</span></a>              }
<a name="l168"><span class="linenum"> 168</span></a>          }
<a name="l169"><span class="linenum"> 169</span></a>          else
<a name="l170"><span class="linenum"> 170</span></a>          {    // Resample
<a name="l171"><span class="linenum"> 171</span></a>              <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>, <a class="var it1525" onMouseOver="hilite(1525)" onMouseOut="lolite()" onClick="logVariable('src_imh')" href="../../_variables/src_imh.html">$src_imh</a> ) = <a class="function" onClick="logFunction('load_image')" href="../../_functions/load_image.html" onMouseOver="funcPopup(event,'load_image')">load_image</a>( <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_full_path')" href="../../_functions/get_full_path.html" onMouseOver="funcPopup(event,'get_full_path')">get_full_path</a>(), <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a> );
<a name="l172"><span class="linenum"> 172</span></a>  
<a name="l173"><span class="linenum"> 173</span></a>              if( empty( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> ) )
<a name="l174"><span class="linenum"> 174</span></a>              {
<a name="l175"><span class="linenum"> 175</span></a>                  <a class="function" onClick="logFunction('list')" href="../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>, <a class="var it1535" onMouseOver="hilite(1535)" onMouseOut="lolite()" onClick="logVariable('dest_imh')" href="../../_variables/dest_imh.html">$dest_imh</a> ) = <a class="function" onClick="logFunction('generate_thumb')" href="../../_functions/generate_thumb.html" onMouseOver="funcPopup(event,'generate_thumb')">generate_thumb</a>( <a class="var it1525" onMouseOver="hilite(1525)" onMouseOut="lolite()" onClick="logVariable('src_imh')" href="../../_variables/src_imh.html">$src_imh</a>, <a class="var it1526" onMouseOver="hilite(1526)" onMouseOut="lolite()" onClick="logVariable('thumb_type')" href="../../_variables/thumb_type.html">$thumb_type</a>, <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('thumb_width')" href="../../_variables/thumb_width.html">$thumb_width</a>, <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('thumb_height')" href="../../_variables/thumb_height.html">$thumb_height</a>, <a class="var it1529" onMouseOver="hilite(1529)" onMouseOut="lolite()" onClick="logVariable('thumb_percent_blur')" href="../../_variables/thumb_percent_blur.html">$thumb_percent_blur</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> );
<a name="l176"><span class="linenum"> 176</span></a>                  if( empty( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> ) )
<a name="l177"><span class="linenum"> 177</span></a>                  {
<a name="l178"><span class="linenum"> 178</span></a>                      <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('save_thumb_to_cache')" href="../../_functions/save_thumb_to_cache.html" onMouseOver="funcPopup(event,'save_thumb_to_cache')">save_thumb_to_cache</a>( <a class="var it1535" onMouseOver="hilite(1535)" onMouseOut="lolite()" onClick="logVariable('dest_imh')" href="../../_variables/dest_imh.html">$dest_imh</a>, <a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>, <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>, <a class="var it2203" onMouseOver="hilite(2203)" onMouseOut="lolite()" onClick="logVariable('thumb_quality')" href="../../_variables/thumb_quality.html">$thumb_quality</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> );
<a name="l179"><span class="linenum"> 179</span></a>                      if( empty( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> ) )
<a name="l180"><span class="linenum"> 180</span></a>                      {    // File was saved. Ouput that same file immediately:
<a name="l181"><span class="linenum"> 181</span></a>  <span class="comment">                        // This is probably better than recompressing the memory image..</span>
<a name="l182"><span class="linenum"> 182</span></a>                          <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('output_cached_thumb')" href="../../_functions/output_cached_thumb.html" onMouseOver="funcPopup(event,'output_cached_thumb')">output_cached_thumb</a>( <a class="var it2202" onMouseOver="hilite(2202)" onMouseOut="lolite()" onClick="logVariable('size_name')" href="../../_variables/size_name.html">$size_name</a>, <a class="var it739" onMouseOver="hilite(739)" onMouseOut="lolite()" onClick="logVariable('mimetype')" href="../../_variables/mimetype.html">$mimetype</a>, <a class="var it2204" onMouseOver="hilite(2204)" onMouseOut="lolite()" onClick="logVariable('mtime')" href="../../_variables/mtime.html">$mtime</a>, <a class="var it1530" onMouseOver="hilite(1530)" onMouseOut="lolite()" onClick="logVariable('size_x')" href="../../_variables/size_x.html">$size_x</a> );
<a name="l183"><span class="linenum"> 183</span></a>                      }
<a name="l184"><span class="linenum"> 184</span></a>                      else
<a name="l185"><span class="linenum"> 185</span></a>                      {    // File could not be saved.
<a name="l186"><span class="linenum"> 186</span></a>  <span class="comment">                        // fp&gt; We might want to output dynamically...</span>
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment">                        // $err = output_image( $dest_imh, $mimetype );</span>
<a name="l188"><span class="linenum"> 188</span></a>                      }
<a name="l189"><span class="linenum"> 189</span></a>                  }
<a name="l190"><span class="linenum"> 190</span></a>              }
<a name="l191"><span class="linenum"> 191</span></a>          }
<a name="l192"><span class="linenum"> 192</span></a>      }
<a name="l193"><span class="linenum"> 193</span></a>  
<a name="l194"><span class="linenum"> 194</span></a>  <span class="comment">    // ERROR IMAGE</span>
<a name="l195"><span class="linenum"> 195</span></a>      if( !empty( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> ) )
<a name="l196"><span class="linenum"> 196</span></a>      {    // Generate an error image and try to squeeze an error message inside:
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment">        // Note: we write small and close to the upper left in order to have as much text as possible on small thumbs</span>
<a name="l198"><span class="linenum"> 198</span></a>          <a class="var it2206" onMouseOver="hilite(2206)" onMouseOut="lolite()" onClick="logVariable('line_height')" href="../../_variables/line_height.html">$line_height</a> = 11;
<a name="l199"><span class="linenum"> 199</span></a>          <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>, 1 ); <span class="comment">// crop 1st car</span>
<a name="l200"><span class="linenum"> 200</span></a>          <a class="var it2207" onMouseOver="hilite(2207)" onMouseOut="lolite()" onClick="logVariable('car_width')" href="../../_variables/car_width.html">$car_width</a> = <a class="phpfunction" onClick="logFunction('ceil')" href="../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>( (<a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('thumb_width')" href="../../_variables/thumb_width.html">$thumb_width</a>-4)/6 );
<a name="l201"><span class="linenum"> 201</span></a>  <span class="comment">        // $err = 'w='.$car_width.' '.$err;</span>
<a name="l202"><span class="linenum"> 202</span></a>  
<a name="l203"><span class="linenum"> 203</span></a>  <span class="comment">        // Wrap error message and split it into lines:</span>
<a name="l204"><span class="linenum"> 204</span></a>          <a class="var it2208" onMouseOver="hilite(2208)" onMouseOut="lolite()" onClick="logVariable('err_lines')" href="../../_variables/err_lines.html">$err_lines</a> = <a class="phpfunction" onClick="logFunction('preg_split')" href="../../_functions/preg_split.html" onMouseOver="phpfuncPopup(event,'preg_split')">preg_split</a>( '~\n~', <a class="phpfunction" onClick="logFunction('wordwrap')" href="../../_functions/wordwrap.html" onMouseOver="phpfuncPopup(event,'wordwrap')">wordwrap</a>( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>, <a class="var it2207" onMouseOver="hilite(2207)" onMouseOut="lolite()" onClick="logVariable('car_width')" href="../../_variables/car_width.html">$car_width</a>, &quot;\n&quot;, true ) );
<a name="l205"><span class="linenum"> 205</span></a>          <a class="var it2209" onMouseOver="hilite(2209)" onMouseOut="lolite()" onClick="logVariable('im_handle')" href="../../_variables/im_handle.html">$im_handle</a> = <a class="phpfunction" onClick="logFunction('imagecreatetruecolor')" href="../../_functions/imagecreatetruecolor.html" onMouseOver="phpfuncPopup(event,'imagecreatetruecolor')">imagecreatetruecolor</a>( <a class="var it1527" onMouseOver="hilite(1527)" onMouseOut="lolite()" onClick="logVariable('thumb_width')" href="../../_variables/thumb_width.html">$thumb_width</a>, <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('thumb_height')" href="../../_variables/thumb_height.html">$thumb_height</a> ); <span class="comment">// Create a black image</span>
<a name="l206"><span class="linenum"> 206</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(<a class="var it2208" onMouseOver="hilite(2208)" onMouseOut="lolite()" onClick="logVariable('err_lines')" href="../../_variables/err_lines.html">$err_lines</a>)*<a class="var it2206" onMouseOver="hilite(2206)" onMouseOut="lolite()" onClick="logVariable('line_height')" href="../../_variables/line_height.html">$line_height</a> &gt; <a class="var it1528" onMouseOver="hilite(1528)" onMouseOut="lolite()" onClick="logVariable('thumb_height')" href="../../_variables/thumb_height.html">$thumb_height</a> )
<a name="l207"><span class="linenum"> 207</span></a>          { // Message does not fit into picture:
<a name="l208"><span class="linenum"> 208</span></a>  <span class="comment">          // Rewrite error messages, so they fit better into the generated images.</span>
<a name="l209"><span class="linenum"> 209</span></a>              <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('rewritten')" href="../../_variables/rewritten.html">$rewritten</a> = true;
<a name="l210"><span class="linenum"> 210</span></a>              if( <a class="phpfunction" onClick="logFunction('preg_match')" href="../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>('~Unable to open \'.*?\' for writing: Permission denied~', <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>) )
<a name="l211"><span class="linenum"> 211</span></a>                  <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a> = 'Cannot write: permission denied';
<a name="l212"><span class="linenum"> 212</span></a>              else
<a name="l213"><span class="linenum"> 213</span></a>                  <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('rewritten')" href="../../_variables/rewritten.html">$rewritten</a> = false;
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment">            // Recreate error lines, if it has been rewritten/shortened.</span>
<a name="l215"><span class="linenum"> 215</span></a>              if( <a class="var it2210" onMouseOver="hilite(2210)" onMouseOut="lolite()" onClick="logVariable('rewritten')" href="../../_variables/rewritten.html">$rewritten</a> )
<a name="l216"><span class="linenum"> 216</span></a>              {
<a name="l217"><span class="linenum"> 217</span></a>                  <a class="var it2208" onMouseOver="hilite(2208)" onMouseOut="lolite()" onClick="logVariable('err_lines')" href="../../_variables/err_lines.html">$err_lines</a> = <a class="phpfunction" onClick="logFunction('preg_split')" href="../../_functions/preg_split.html" onMouseOver="phpfuncPopup(event,'preg_split')">preg_split</a>( '~\n~', <a class="phpfunction" onClick="logFunction('wordwrap')" href="../../_functions/wordwrap.html" onMouseOver="phpfuncPopup(event,'wordwrap')">wordwrap</a>( <a class="var it1509" onMouseOver="hilite(1509)" onMouseOut="lolite()" onClick="logVariable('err')" href="../../_variables/err.html">$err</a>, <a class="var it2207" onMouseOver="hilite(2207)" onMouseOut="lolite()" onClick="logVariable('car_width')" href="../../_variables/car_width.html">$car_width</a>, &quot;\n&quot;, true ) );
<a name="l218"><span class="linenum"> 218</span></a>              }
<a name="l219"><span class="linenum"> 219</span></a>          }
<a name="l220"><span class="linenum"> 220</span></a>  
<a name="l221"><span class="linenum"> 221</span></a>          <a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('text_color')" href="../../_variables/text_color.html">$text_color</a> = <a class="phpfunction" onClick="logFunction('imagecolorallocate')" href="../../_functions/imagecolorallocate.html" onMouseOver="phpfuncPopup(event,'imagecolorallocate')">imagecolorallocate</a>( <a class="var it2209" onMouseOver="hilite(2209)" onMouseOut="lolite()" onClick="logVariable('im_handle')" href="../../_variables/im_handle.html">$im_handle</a>, 255, 0, 0 );
<a name="l222"><span class="linenum"> 222</span></a>          <a class="var it1507" onMouseOver="hilite(1507)" onMouseOut="lolite()" onClick="logVariable('y')" href="../../_variables/y.html">$y</a> = 0;
<a name="l223"><span class="linenum"> 223</span></a>          foreach( <a class="var it2208" onMouseOver="hilite(2208)" onMouseOut="lolite()" onClick="logVariable('err_lines')" href="../../_variables/err_lines.html">$err_lines</a> as <a class="var it2211" onMouseOver="hilite(2211)" onMouseOut="lolite()" onClick="logVariable('err_string')" href="../../_variables/err_string.html">$err_string</a> )
<a name="l224"><span class="linenum"> 224</span></a>          {
<a name="l225"><span class="linenum"> 225</span></a>              <a class="phpfunction" onClick="logFunction('imagestring')" href="../../_functions/imagestring.html" onMouseOver="phpfuncPopup(event,'imagestring')">imagestring</a>( <a class="var it2209" onMouseOver="hilite(2209)" onMouseOut="lolite()" onClick="logVariable('im_handle')" href="../../_variables/im_handle.html">$im_handle</a>, 2, 2, <a class="var it1507" onMouseOver="hilite(1507)" onMouseOut="lolite()" onClick="logVariable('y')" href="../../_variables/y.html">$y</a>, <a class="var it2211" onMouseOver="hilite(2211)" onMouseOut="lolite()" onClick="logVariable('err_string')" href="../../_variables/err_string.html">$err_string</a>, <a class="var it747" onMouseOver="hilite(747)" onMouseOut="lolite()" onClick="logVariable('text_color')" href="../../_variables/text_color.html">$text_color</a>);
<a name="l226"><span class="linenum"> 226</span></a>              <a class="var it1507" onMouseOver="hilite(1507)" onMouseOut="lolite()" onClick="logVariable('y')" href="../../_variables/y.html">$y</a> += <a class="var it2206" onMouseOver="hilite(2206)" onMouseOut="lolite()" onClick="logVariable('line_height')" href="../../_variables/line_height.html">$line_height</a>;
<a name="l227"><span class="linenum"> 227</span></a>          }
<a name="l228"><span class="linenum"> 228</span></a>  
<a name="l229"><span class="linenum"> 229</span></a>          <a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Content-type: image/png' );
<a name="l230"><span class="linenum"> 230</span></a>          <a class="function" onClick="logFunction('header_nocache')" href="../../_functions/header_nocache.html" onMouseOver="funcPopup(event,'header_nocache')">header_nocache</a>();    <span class="comment">// Do NOT cache errors! People won't see they have fixed them!!</span>
<a name="l231"><span class="linenum"> 231</span></a>  
<a name="l232"><span class="linenum"> 232</span></a>          <a class="phpfunction" onClick="logFunction('imagepng')" href="../../_functions/imagepng.html" onMouseOver="phpfuncPopup(event,'imagepng')">imagepng</a>( <a class="var it2209" onMouseOver="hilite(2209)" onMouseOut="lolite()" onClick="logVariable('im_handle')" href="../../_variables/im_handle.html">$im_handle</a> );
<a name="l233"><span class="linenum"> 233</span></a>      }
<a name="l234"><span class="linenum"> 234</span></a>  }
<a name="l235"><span class="linenum"> 235</span></a>  else
<a name="l236"><span class="linenum"> 236</span></a>  {    // We want the regular file:
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment">    // Headers to display the file directly in the browser</span>
<a name="l238"><span class="linenum"> 238</span></a>      if( ! <a class="phpfunction" onClick="logFunction('is_readable')" href="../../_functions/is_readable.html" onMouseOver="phpfuncPopup(event,'is_readable')">is_readable</a>(<a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_full_path')" href="../../_functions/get_full_path.html" onMouseOver="funcPopup(event,'get_full_path')">get_full_path</a>()) )
<a name="l239"><span class="linenum"> 239</span></a>      {
<a name="l240"><span class="linenum"> 240</span></a>          <a class="function" onClick="logFunction('debug_die')" href="../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( sprintf('File &quot;%s&quot; is not readable!', <a class="function" onClick="logFunction('rel_path_to_base')" href="../../_functions/rel_path_to_base.html" onMouseOver="funcPopup(event,'rel_path_to_base')">rel_path_to_base</a>(<a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_full_path')" href="../../_functions/get_full_path.html" onMouseOver="funcPopup(event,'get_full_path')">get_full_path</a>())) );
<a name="l241"><span class="linenum"> 241</span></a>      }
<a name="l242"><span class="linenum"> 242</span></a>  
<a name="l243"><span class="linenum"> 243</span></a>      <a class="var it1544" onMouseOver="hilite(1544)" onMouseOut="lolite()" onClick="logVariable('Filetype')" href="../../_variables/Filetype.html">$Filetype</a> = &amp; <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;get_Filetype();
<a name="l244"><span class="linenum"> 244</span></a>      if( ! empty(<a class="var it1544" onMouseOver="hilite(1544)" onMouseOut="lolite()" onClick="logVariable('Filetype')" href="../../_variables/Filetype.html">$Filetype</a>) )
<a name="l245"><span class="linenum"> 245</span></a>      {
<a name="l246"><span class="linenum"> 246</span></a>          <a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Content-type: '.<a class="var it1544" onMouseOver="hilite(1544)" onMouseOut="lolite()" onClick="logVariable('Filetype')" href="../../_variables/Filetype.html">$Filetype</a>-&gt;<a onClick="logVariable('mimetype')" class="var it9065" onMouseOver="hilite(9065)" onMouseOut="lolite()" href="../../_variables/mimetype.html">mimetype</a> );
<a name="l247"><span class="linenum"> 247</span></a>          if( <a class="var it1544" onMouseOver="hilite(1544)" onMouseOut="lolite()" onClick="logVariable('Filetype')" href="../../_variables/Filetype.html">$Filetype</a>-&gt;<a onClick="logVariable('viewtype')" class="var it9065" onMouseOver="hilite(9065)" onMouseOut="lolite()" href="../../_variables/viewtype.html">viewtype</a> == 'download' )
<a name="l248"><span class="linenum"> 248</span></a>          {
<a name="l249"><span class="linenum"> 249</span></a>              <a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Content-disposition: attachment; filename=&quot;'
<a name="l250"><span class="linenum"> 250</span></a>                  .<a class="phpfunction" onClick="logFunction('addcslashes')" href="../../_functions/addcslashes.html" onMouseOver="phpfuncPopup(event,'addcslashes')">addcslashes</a>(<a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>(), '\\&quot;').'&quot;' ); <span class="comment">// escape quotes and slashes, according to RFC</span>
<a name="l251"><span class="linenum"> 251</span></a>          }
<a name="l252"><span class="linenum"> 252</span></a>      }
<a name="l253"><span class="linenum"> 253</span></a>      <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../_variables/file_path.html">$file_path</a> = <a class="var it613" onMouseOver="hilite(613)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_full_path')" href="../../_functions/get_full_path.html" onMouseOver="funcPopup(event,'get_full_path')">get_full_path</a>();
<a name="l254"><span class="linenum"> 254</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>('Content-Length: '.<a class="phpfunction" onClick="logFunction('filesize')" href="../../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../_variables/file_path.html">$file_path</a> ) );
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">    // The URL refers to this specific file, therefore we can tell the browser that</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">    // it does not expire anytime soon.</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">    // fp&gt; I don't think mtime changes anything to the cacheability of the data</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">    // if( $mtime &amp;&amp; $mtime == $File-&gt;get_lastmod_ts() ) // TODO: dh&gt; use salt here?! fp&gt;what for?</span>
<a name="l260"><span class="linenum"> 260</span></a>      <a class="function" onClick="logFunction('header_noexpire')" href="../../_functions/header_noexpire.html" onMouseOver="funcPopup(event,'header_noexpire')">header_noexpire</a>();    <span class="comment">// static file</span>
<a name="l261"><span class="linenum"> 261</span></a>  
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">    // Display the content of the file</span>
<a name="l263"><span class="linenum"> 263</span></a>      <a class="phpfunction" onClick="logFunction('readfile')" href="../../_functions/readfile.html" onMouseOver="phpfuncPopup(event,'readfile')">readfile</a>( <a class="var it849" onMouseOver="hilite(849)" onMouseOut="lolite()" onClick="logVariable('file_path')" href="../../_variables/file_path.html">$file_path</a> );
<a name="l264"><span class="linenum"> 264</span></a>  }
<a name="l265"><span class="linenum"> 265</span></a>  
<a name="l266"><span class="linenum"> 266</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_lastmod_ts': ['get_lastmod_ts', 'Get timestamp of last modification. ', [['blogs/inc/files/model','_file.class.php',750]], 9],
'rel_path_to_base': ['rel_path_to_base', 'Return the path without the leading {@link $basepath}, or if not below {@link $basepath}, just the basename of it. ', [['blogs/inc/files/model','_file.funcs.php',722]], 26],
'header_http_response': ['header_http_response', 'Update global $http_response_code and call function header() ', [['blogs/inc/_core','_misc.funcs.php',5835]], 16],
'get_af_thumb_path': ['get_af_thumb_path', 'Get the full path to the thumbnail for this file. ', [['blogs/inc/files/model','_file.class.php',2246]], 5],
'list': ['list', '', [['blogs/rsc/js/bootstrap','typeahead.bundle.js',156]], 95],
'debug_die': ['debug_die', 'Outputs Unexpected Error message. When in debug mode it also prints a backtrace. ', [['blogs/inc/_core','_misc.funcs.php',2535]], 216],
'generate_thumb': ['generate_thumb', 'Generate a thumbnail ', [['blogs/inc/files/model','_image.funcs.php',336]], 2],
'param': ['param', 'Sets a parameter with values from the request or to provided default, except if param is already set! ', [['blogs/inc/_core','_param.funcs.php',50]], 1906],
'get_name': ['get_name', 'Get name of widget ', [['blogs/inc/widgets/widgets','_menu_link.widget.php',83],['blogs/inc/widgets/widgets','_linkblog.widget.php',76],['blogs/inc/widgets/widgets','_coll_related_post_list.widget.php',76],['blogs/inc/widgets/widgets','_msg_menu_link.widget.php',55],['blogs/inc/users/model','_userfield.class.php',264],['blogs/inc/widgets/widgets','_coll_title.widget.php',49],['blogs/inc/generic/model','_genericelement.class.php',129],['blogs/inc/sessions/model','_goalcat.class.php',74],['blogs/inc/widgets/widgets','_coll_link_list.widget.php',76],['blogs/inc/widgets/widgets','_coll_tagline.widget.php',49],['blogs/inc/widgets/widgets','_user_login.widget.php',50],['blogs/inc/widgets/widgets','_online_users.widget.php',49],['blogs/inc/widgets/widgets','_free_html.widget.php',49],['blogs/plugins/twitter_plugin/twitteroauth','oauth.php',102],['blogs/plugins/twitter_plugin/twitteroauth','oauth.php',128],['blogs/plugins/twitter_plugin/twitteroauth','oauth.php',155],['blogs/inc/widgets/widgets','_coll_common_links.widget.php',53],['blogs/inc/widgets/widgets','_coll_media_index.widget.php',142],['blogs/inc/users/model','_group.class.php',440],['blogs/inc/widgets/widgets','_coll_item_list.widget.php',211],['blogs/inc/widgets/model','_widget.class.php',157],['blogs/inc/widgets/widgets','_coll_longdesc.widget.php',49],['blogs/inc/regional/model','_region.class.php',126],['blogs/inc/regional/model','_city.class.php',133],['blogs/inc/collections/model','_blog.class.php',2583],['blogs/inc/widgets/widgets','_coll_post_list.widget.php',76],['blogs/inc/widgets/widgets','_mobile_skin_switcher.widget.php',49],['blogs/inc/skins/model','_skin.class.php',127],['blogs/inc/items/model','_itemtype.class.php',99],['blogs/inc/regional/model','_country.class.php',131],['blogs/inc/widgets/widgets','_coll_search_form.widget.php',49],['blogs/inc/widgets/widgets','_coll_xml_feeds.widget.php',49],['blogs/inc/users/model','_userfieldgroup.class.php',106],['blogs/inc/widgets/widgets','_coll_category_list.widget.php',51],['blogs/inc/widgets/widgets','_coll_page_list.widget.php',76],['blogs/inc/widgets/widgets','_user_avatars.widget.php',117],['blogs/inc/regional/model','_currency.class.php',132],['blogs/inc/widgets/widgets','_coll_logo.widget.php',49],['blogs/inc/widgets/widgets','_colls_list_public.widget.php',49],['blogs/inc/widgets/widgets','_user_tools.widget.php',225],['blogs/inc/widgets/widgets','_coll_tag_cloud.widget.php',64],['blogs/inc/regional/model','_subregion.class.php',143],['blogs/inc/widgets/widgets','_coll_featured_intro.widget.php',120],['blogs/inc/antispam/model','_iprange.class.php',137],['blogs/inc/widgets/widgets','_colls_list_owner.widget.php',49],['blogs/inc/sessions/model','_goal.class.php',193],['blogs/inc/widgets/widgets','_coll_comment_list.widget.php',102],['blogs/inc/widgets/widgets','_coll_avatar.widget.php',51],['blogs/inc/files/model','_file.class.php',551]], 78],
'get': ['get', '', [['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',941],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_src.js',15011],['blogs/plugins/tinymce_plugin/tiny_mce/plugins/media/js','media.js',7],['blogs/inc/links/model','_linkowner.class.php',221],['blogs/inc/_core/model/db','_sql.class.php',64],['blogs/inc/plugins/model','_pluginsettings.class.php',58],['blogs/inc/collections/model','_blog.class.php',1822],['blogs/inc/settings/model','_generalsettings.class.php',383],['blogs/inc/settings/model','_abstractsettings.class.php',271],['blogs/inc/plugins/model','_pluginusersettings.class.php',58],['blogs/inc/users/model','_user.class.php',1126],['blogs/plugins/tinymce_plugin/tiny_mce','tiny_mce_gzip.js',38],['blogs/inc/users/model','_usersettings.class.php',151],['blogs/inc/comments/model','_comment.class.php',301],['blogs/inc/users/model','_groupsettings.class.php',124],['blogs/inc/cron/model','_cronjob.class.php',104],['blogs/inc/items/model','_item.class.php',5742],['blogs/inc/sessions/model','_session.class.php',397],['blogs/inc/links/model','_linkuser.class.php',141],['blogs/inc/links/model','_linkitem.class.php',155],['blogs/inc/slugs/model','_slug.class.php',68],['blogs/inc/_core/model/dataobjects','_dataobject.class.php',574],['blogs/plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['blogs/inc/antispam/model','_iprange.class.php',69],['blogs/inc/links/model','_linkcomment.class.php',132],['blogs/inc/files/model','_file.class.php',532]], 2417],
'header_noexpire': ['header_noexpire', 'This is to "force" (strongly suggest) caching. ', [['blogs/inc/_core','_template.funcs.php',291]], 1],
'imgsize': ['imgsize', 'Get the size of an image file ', [['blogs/inc/files/model','_file.funcs.php',328]], 6],
'load_funcs': ['load_funcs', '', [['blogs/inc/_core','_misc.funcs.php',115]], 214],
'get_full_path': ['get_full_path', 'Get the full path (directory and name) to the file. ', [['blogs/inc/files/model','_file.class.php',615]], 44],
'save_thumb_to_cache': ['save_thumb_to_cache', 'Save thumbnail for file ', [['blogs/inc/files/model','_file.class.php',2289]], 1],
'load_image': ['load_image', 'Load an image from a file into memory ', [['blogs/inc/files/model','_image.funcs.php',148]], 3],
'is_image': ['is_image', 'Is the File an image? ', [['blogs/inc/files/model','_file.class.php',438]], 25],
'output_cached_thumb': ['output_cached_thumb', 'Output previously saved thumbnail for file ', [['blogs/inc/files/model','_file.class.php',2323]], 3],
'header_nocache': ['header_nocache', 'Sends HTTP headers to avoid caching of the page at the browser level (at least without revalidating with the server to make sure whether the content has changed or not). ', [['blogs/inc/_core','_template.funcs.php',270]], 9],
'check_perm': ['check_perm', 'Check permission on a message ', [['blogs/inc/messaging/model','_message.class.php',467],['blogs/inc/users/model','_group.class.php',257],['blogs/inc/users/model','_user.class.php',2022],['blogs/inc/links/model','_linkuser.class.php',51],['blogs/inc/links/model','_linkitem.class.php',54],['blogs/inc/_core/model','_module.class.php',233],['blogs/inc/messaging/model','_thread.class.php',476],['blogs/inc/links/model','_linkcomment.class.php',53],['blogs/inc/sessions/model','_goal.class.php',92]], 967],
'substr': ['substr', '', [], 657],
'readfile': ['readfile', '', [], 9],
'strtotime': ['strtotime', '', [], 31],
'wordwrap': ['wordwrap', '', [], 2],
'header': ['header', '', [], 85],
'imagestring': ['imagestring', '', [], 1],
'preg_replace': ['preg_replace', '', [], 281],
'count': ['count', '', [], 754],
'copy': ['copy', '', [], 14],
'imagecreatetruecolor': ['imagecreatetruecolor', '', [], 5],
'urldecode': ['urldecode', '', [], 25],
'is_readable': ['is_readable', '', [], 15],
'strpos': ['strpos', '', [], 280],
'preg_match': ['preg_match', '', [], 363],
'imagecolorallocate': ['imagecolorallocate', '', [], 5],
'addcslashes': ['addcslashes', '', [], 1],
'dirname': ['dirname', '', [], 186],
'array_key_exists': ['array_key_exists', '', [], 36],
'ceil': ['ceil', '', [], 36],
'file': ['file', '', [], 70],
'preg_split': ['preg_split', '', [], 29],
'filesize': ['filesize', '', [], 21],
'imagepng': ['imagepng', '', [], 2]};
CLASS_DATA={
'file': ['file', 'Represents a file or folder on disk. Optionnaly stores meta data from DB. ', [['blogs/inc/files/model','_file.class.php',44]], 78]};
CONST_DATA={
};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Jul  5 12:18:44 2014</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
