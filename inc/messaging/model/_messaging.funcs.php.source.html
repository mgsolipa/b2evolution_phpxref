<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /inc/messaging/model/_messaging.funcs.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Nov 21 22:13:19 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='inc/messaging/model';
filename='_messaging.funcs.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/inc/messaging/model/</a> -> <a href="_messaging.funcs.php.html">_messaging.funcs.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="_messaging.funcs.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="_messaging.funcs.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This file is part of b2evolution - {@link http://b2evolution.net/}</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> * See also {@link https://github.com/b2evolution/b2evolution}.</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> *</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * @license GNU GPL v2 - {@link http://b2evolution.net/about/gnu-gpl-license}</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> *</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * @copyright (c)2009-2015 by Francois Planque - {@link http://fplanque.com/}</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * Parts of this file are copyright (c)2009 by The Evo Factory - {@link http://www.evofactory.com/}.</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> *</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * Released under GNU GPL License - {@link http://b2evolution.net/about/gnu-gpl-license}</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> *</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * @package messaging</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> */</span>
<a name="l15"><span class="linenum">  15</span></a>  if( !<a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('EVO_MAIN_INIT')" href="../../../_constants/EVO_MAIN_INIT.html" onMouseOver="constPopup(event,'EVO_MAIN_INIT')">EVO_MAIN_INIT</a>') ) die( 'Please, do not access this page directly.' );
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">/**</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> * Load all of the recipients of current thread into the UserCache</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> *</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> * @param current thread ID</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> */</span>
<a name="l23"><span class="linenum">  23</span></a>  function <a class="function" onClick="logFunction('load_messaging_thread_recipients')" href="../../../_functions/load_messaging_thread_recipients.html" onMouseOver="funcPopup(event,'load_messaging_thread_recipients')">load_messaging_thread_recipients</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a> )
<a name="l24"><span class="linenum">  24</span></a>  {
<a name="l25"><span class="linenum">  25</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l26"><span class="linenum">  26</span></a>  
<a name="l27"><span class="linenum">  27</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l28"><span class="linenum">  28</span></a>  
<a name="l29"><span class="linenum">  29</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'u.*' );
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus ts
<a name="l32"><span class="linenum">  32</span></a>                      INNER JOIN T_users u
<a name="l33"><span class="linenum">  33</span></a>                          ON ts.tsta_user_ID = u.user_ID' );
<a name="l34"><span class="linenum">  34</span></a>  
<a name="l35"><span class="linenum">  35</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'ts.tsta_thread_ID = '.<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a> );
<a name="l36"><span class="linenum">  36</span></a>  
<a name="l37"><span class="linenum">  37</span></a>      <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l38"><span class="linenum">  38</span></a>  
<a name="l39"><span class="linenum">  39</span></a>      foreach( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) as <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> )
<a name="l40"><span class="linenum">  40</span></a>      {
<a name="l41"><span class="linenum">  41</span></a>          if( !isset(<a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;<a onClick="logVariable('cache')" class="var it10780" onMouseOver="hilite(10780)" onMouseOut="lolite()" href="../../../_variables/cache.html">cache</a>[<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a>]) )
<a name="l42"><span class="linenum">  42</span></a>          {
<a name="l43"><span class="linenum">  43</span></a>              <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <span class="keyword">new </span><a class="class" onClick="logClass('User')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">User</a>( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> ) );
<a name="l44"><span class="linenum">  44</span></a>          }
<a name="l45"><span class="linenum">  45</span></a>      }
<a name="l46"><span class="linenum">  46</span></a>  }
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>  
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">/**</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment"> * Check blocked contacts in recipients list.</span>
<a name="l51"><span class="linenum">  51</span></a>  <span class="comment"> * Note: If current User has only reply permission then users who didn't have the current User in their contact list will be considerated as blocked contacts!</span>
<a name="l52"><span class="linenum">  52</span></a>  <span class="comment"> *</span>
<a name="l53"><span class="linenum">  53</span></a>  <span class="comment"> * @param array recipients list</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment"> * @return array blocked contacts</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment"> */</span>
<a name="l56"><span class="linenum">  56</span></a>  function <a class="function" onClick="logFunction('check_blocked_contacts')" href="../../../_functions/check_blocked_contacts.html" onMouseOver="funcPopup(event,'check_blocked_contacts')">check_blocked_contacts</a>( <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('recipients_list')" href="../../../_variables/recipients_list.html">$recipients_list</a> )
<a name="l57"><span class="linenum">  57</span></a>  {
<a name="l58"><span class="linenum">  58</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>      if( empty( <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('recipients_list')" href="../../../_variables/recipients_list.html">$recipients_list</a> ) )
<a name="l61"><span class="linenum">  61</span></a>      { // there are no recipients to check
<a name="l62"><span class="linenum">  62</span></a>          return NULL;
<a name="l63"><span class="linenum">  63</span></a>      }
<a name="l64"><span class="linenum">  64</span></a>  
<a name="l65"><span class="linenum">  65</span></a>      if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'delete' ) )
<a name="l66"><span class="linenum">  66</span></a>      { // user with delete messaging permission are allowed to send private messages to anyone who has access to read them.
<a name="l67"><span class="linenum">  67</span></a>          return NULL;
<a name="l68"><span class="linenum">  68</span></a>      }
<a name="l69"><span class="linenum">  69</span></a>  
<a name="l70"><span class="linenum">  70</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l71"><span class="linenum">  71</span></a>  
<a name="l72"><span class="linenum">  72</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'u.user_login' );
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>      if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'write', false ) )
<a name="l75"><span class="linenum">  75</span></a>      { // get blocked contacts for user with write permission
<a name="l76"><span class="linenum">  76</span></a>          <a class="var it4982" onMouseOver="hilite(4982)" onMouseOut="lolite()" onClick="logVariable('sub_SQL')" href="../../../_variables/sub_SQL.html">$sub_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l77"><span class="linenum">  77</span></a>  
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">        // Select users who has blocked current_User</span>
<a name="l79"><span class="linenum">  79</span></a>          <a class="var it4982" onMouseOver="hilite(4982)" onMouseOut="lolite()" onClick="logVariable('sub_SQL')" href="../../../_variables/sub_SQL.html">$sub_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'mct_from_user_ID as user_ID' );
<a name="l80"><span class="linenum">  80</span></a>          <a class="var it4982" onMouseOver="hilite(4982)" onMouseOut="lolite()" onClick="logVariable('sub_SQL')" href="../../../_variables/sub_SQL.html">$sub_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact' );
<a name="l81"><span class="linenum">  81</span></a>          <a class="var it4982" onMouseOver="hilite(4982)" onMouseOut="lolite()" onClick="logVariable('sub_SQL')" href="../../../_variables/sub_SQL.html">$sub_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'mct_to_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l82"><span class="linenum">  82</span></a>          <a class="var it4982" onMouseOver="hilite(4982)" onMouseOut="lolite()" onClick="logVariable('sub_SQL')" href="../../../_variables/sub_SQL.html">$sub_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'mct_blocked = 1' );
<a name="l83"><span class="linenum">  83</span></a>  
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">        // Select users from sub query result</span>
<a name="l85"><span class="linenum">  85</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users u' );
<a name="l86"><span class="linenum">  86</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'u.user_ID IN ( '.<a class="var it4982" onMouseOver="hilite(4982)" onMouseOut="lolite()" onClick="logVariable('sub_SQL')" href="../../../_variables/sub_SQL.html">$sub_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>().' )' );
<a name="l87"><span class="linenum">  87</span></a>      }
<a name="l88"><span class="linenum">  88</span></a>      else
<a name="l89"><span class="linenum">  89</span></a>      { // get every user, except non blocked contacts, for users with only reply permission
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">        // This will select users who has blocked current user, and users blocked by current User won't be selected, and this is OK!</span>
<a name="l91"><span class="linenum">  91</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users u
<a name="l92"><span class="linenum">  92</span></a>                          LEFT OUTER JOIN T_messaging__contact mcu
<a name="l93"><span class="linenum">  93</span></a>                              ON u.user_ID = mcu.mct_from_user_ID
<a name="l94"><span class="linenum">  94</span></a>                              AND mcu.mct_to_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l95"><span class="linenum">  95</span></a>                              AND mcu.mct_blocked = 0' );
<a name="l96"><span class="linenum">  96</span></a>  
<a name="l97"><span class="linenum">  97</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'u.user_ID &lt;&gt; '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l98"><span class="linenum">  98</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'mcu.mct_from_user_ID IS NULL' );
<a name="l99"><span class="linenum">  99</span></a>      }
<a name="l100"><span class="linenum"> 100</span></a>  
<a name="l101"><span class="linenum"> 101</span></a>  <span class="comment">    // check if recipient list contains blocked contacts, if yes return them</span>
<a name="l102"><span class="linenum"> 102</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'u.user_ID IN ('.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('recipients_list')" href="../../../_variables/recipients_list.html">$recipients_list</a> ).')' );
<a name="l103"><span class="linenum"> 103</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'u.user_login' );
<a name="l104"><span class="linenum"> 104</span></a>  
<a name="l105"><span class="linenum"> 105</span></a>      <a class="var it4983" onMouseOver="hilite(4983)" onMouseOut="lolite()" onClick="logVariable('blocked_contacts')" href="../../../_variables/blocked_contacts.html">$blocked_contacts</a> = array();
<a name="l106"><span class="linenum"> 106</span></a>      foreach( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) as <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> )
<a name="l107"><span class="linenum"> 107</span></a>      {
<a name="l108"><span class="linenum"> 108</span></a>          <a class="var it4983" onMouseOver="hilite(4983)" onMouseOut="lolite()" onClick="logVariable('blocked_contacts')" href="../../../_variables/blocked_contacts.html">$blocked_contacts</a>[] = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('user_login')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/user_login.html">user_login</a>;
<a name="l109"><span class="linenum"> 109</span></a>      }
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>      return <a class="var it4983" onMouseOver="hilite(4983)" onMouseOut="lolite()" onClick="logVariable('blocked_contacts')" href="../../../_variables/blocked_contacts.html">$blocked_contacts</a>;
<a name="l112"><span class="linenum"> 112</span></a>  }
<a name="l113"><span class="linenum"> 113</span></a>  
<a name="l114"><span class="linenum"> 114</span></a>  
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">/**</span>
<a name="l116"><span class="linenum"> 116</span></a>  <span class="comment"> * Block or unblock contact</span>
<a name="l117"><span class="linenum"> 117</span></a>  <span class="comment"> *</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment"> * @param integer contact user id</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment"> * @param boolean true to block | false to unblock</span>
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment"> * @result mixed 1 on success, 0 if the given user was not in the current user contact list, false on error</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment"> */</span>
<a name="l122"><span class="linenum"> 122</span></a>  function <a class="function" onClick="logFunction('set_contact_blocked')" href="../../../_functions/set_contact_blocked.html" onMouseOver="funcPopup(event,'set_contact_blocked')">set_contact_blocked</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> )
<a name="l123"><span class="linenum"> 123</span></a>  {
<a name="l124"><span class="linenum"> 124</span></a>      global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l125"><span class="linenum"> 125</span></a>  
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">    // Check if user is in contact list</span>
<a name="l127"><span class="linenum"> 127</span></a>      <a class="var it4985" onMouseOver="hilite(4985)" onMouseOut="lolite()" onClick="logVariable('is_contact')" href="../../../_variables/is_contact.html">$is_contact</a> = <a class="function" onClick="logFunction('check_contact')" href="../../../_functions/check_contact.html" onMouseOver="funcPopup(event,'check_contact')">check_contact</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l128"><span class="linenum"> 128</span></a>  
<a name="l129"><span class="linenum"> 129</span></a>      if( <a class="var it4985" onMouseOver="hilite(4985)" onMouseOut="lolite()" onClick="logVariable('is_contact')" href="../../../_variables/is_contact.html">$is_contact</a> === NULL )
<a name="l130"><span class="linenum"> 130</span></a>      { // Add user to the contacts list
<a name="l131"><span class="linenum"> 131</span></a>          global <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l132"><span class="linenum"> 132</span></a>          <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> );
<a name="l133"><span class="linenum"> 133</span></a>          <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_messaging__contact
<a name="l134"><span class="linenum"> 134</span></a>              ( mct_from_user_ID, mct_to_user_ID, mct_blocked, mct_last_contact_datetime ) VALUES
<a name="l135"><span class="linenum"> 135</span></a>              ( '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> ).' )';
<a name="l136"><span class="linenum"> 136</span></a>      }
<a name="l137"><span class="linenum"> 137</span></a>      else
<a name="l138"><span class="linenum"> 138</span></a>      { // Update the block status
<a name="l139"><span class="linenum"> 139</span></a>          <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'UPDATE T_messaging__contact
<a name="l140"><span class="linenum"> 140</span></a>              SET mct_blocked = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> ).'
<a name="l141"><span class="linenum"> 141</span></a>            WHERE mct_from_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l142"><span class="linenum"> 142</span></a>              AND mct_to_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l143"><span class="linenum"> 143</span></a>      }
<a name="l144"><span class="linenum"> 144</span></a>  
<a name="l145"><span class="linenum"> 145</span></a>      return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> );
<a name="l146"><span class="linenum"> 146</span></a>  }
<a name="l147"><span class="linenum"> 147</span></a>  
<a name="l148"><span class="linenum"> 148</span></a>  
<a name="l149"><span class="linenum"> 149</span></a>  <span class="comment">/**</span>
<a name="l150"><span class="linenum"> 150</span></a>  <span class="comment"> * Create new messaging thread from request</span>
<a name="l151"><span class="linenum"> 151</span></a>  <span class="comment"> *</span>
<a name="l152"><span class="linenum"> 152</span></a>  <span class="comment"> * @return boolean true on success</span>
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment"> */</span>
<a name="l154"><span class="linenum"> 154</span></a>  function <a class="function" onClick="logFunction('create_new_thread')" href="../../../_functions/create_new_thread.html" onMouseOver="funcPopup(event,'create_new_thread')">create_new_thread</a>()
<a name="l155"><span class="linenum"> 155</span></a>  {
<a name="l156"><span class="linenum"> 156</span></a>      global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a>, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>, <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a>;
<a name="l157"><span class="linenum"> 157</span></a>  
<a name="l158"><span class="linenum"> 158</span></a>  <span class="comment">    // Insert new thread:</span>
<a name="l159"><span class="linenum"> 159</span></a>      <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">Thread</a>();
<a name="l160"><span class="linenum"> 160</span></a>      <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Message')" href="../../../_classes/message.html" onMouseOver="classPopup(event,'message')">Message</a>();
<a name="l161"><span class="linenum"> 161</span></a>      <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a onClick="logVariable('Thread')" class="var it10740" onMouseOver="hilite(10740)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a> = &amp; <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a>;
<a name="l162"><span class="linenum"> 162</span></a>  
<a name="l163"><span class="linenum"> 163</span></a>  <span class="comment">    // Check permission:</span>
<a name="l164"><span class="linenum"> 164</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'reply', true );
<a name="l165"><span class="linenum"> 165</span></a>  
<a name="l166"><span class="linenum"> 166</span></a>      if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('system_lock') )
<a name="l167"><span class="linenum"> 167</span></a>      { // System is locked for maintenance, All users cannot send a message
<a name="l168"><span class="linenum"> 168</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You cannot send a message at this time because the system is under maintenance. Please try again in a few moments.'), 'error' );
<a name="l169"><span class="linenum"> 169</span></a>          return false;
<a name="l170"><span class="linenum"> 170</span></a>      }
<a name="l171"><span class="linenum"> 171</span></a>  
<a name="l172"><span class="linenum"> 172</span></a>      <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'thrd_recipients', 'string' );
<a name="l173"><span class="linenum"> 173</span></a>      <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'thrd_recipients_array', 'array' );
<a name="l174"><span class="linenum"> 174</span></a>  
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">    // Load data from request</span>
<a name="l176"><span class="linenum"> 176</span></a>      if( <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('load_from_Request')" href="../../../_functions/load_from_request.html" onMouseOver="funcPopup(event,'load_from_request')">load_from_Request</a>() )
<a name="l177"><span class="linenum"> 177</span></a>      { // We could load data from form without errors:
<a name="l178"><span class="linenum"> 178</span></a>          if( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a> == 'preview' )
<a name="l179"><span class="linenum"> 179</span></a>          { // Don't insert message in preview mode
<a name="l180"><span class="linenum"> 180</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('This is a preview only! Do not forget to send your message!'), 'error' );
<a name="l181"><span class="linenum"> 181</span></a>          }
<a name="l182"><span class="linenum"> 182</span></a>          else//<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a> == 'create'
<a name="l183"><span class="linenum"> 183</span></a>          { // Insert in DB:
<a name="l184"><span class="linenum"> 184</span></a>              if( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'thrdtype', 'string', 'discussion' ) == 'discussion' )
<a name="l185"><span class="linenum"> 185</span></a>              {
<a name="l186"><span class="linenum"> 186</span></a>                  <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('dbinsert_discussion')" href="../../../_functions/dbinsert_discussion.html" onMouseOver="funcPopup(event,'dbinsert_discussion')">dbinsert_discussion</a>();
<a name="l187"><span class="linenum"> 187</span></a>  <span class="comment">                // update author user last new thread setting</span>
<a name="l188"><span class="linenum"> 188</span></a>                  <a class="function" onClick="logFunction('update_todays_thread_settings')" href="../../../_functions/update_todays_thread_settings.html" onMouseOver="funcPopup(event,'update_todays_thread_settings')">update_todays_thread_settings</a>( 1 );
<a name="l189"><span class="linenum"> 189</span></a>              }
<a name="l190"><span class="linenum"> 190</span></a>              else
<a name="l191"><span class="linenum"> 191</span></a>              {
<a name="l192"><span class="linenum"> 192</span></a>                  <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('dbinsert_individual')" href="../../../_functions/dbinsert_individual.html" onMouseOver="funcPopup(event,'dbinsert_individual')">dbinsert_individual</a>();
<a name="l193"><span class="linenum"> 193</span></a>  <span class="comment">                // update author user last new thread setting</span>
<a name="l194"><span class="linenum"> 194</span></a>                  if( empty( <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a>-&gt;<a onClick="logVariable('recipients_list')" class="var it10741" onMouseOver="hilite(10741)" onMouseOut="lolite()" href="../../../_variables/recipients_list.html">recipients_list</a> ) )
<a name="l195"><span class="linenum"> 195</span></a>                  {
<a name="l196"><span class="linenum"> 196</span></a>                      <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a>-&gt;<a class="function" onClick="logFunction('load_recipients')" href="../../../_functions/load_recipients.html" onMouseOver="funcPopup(event,'load_recipients')">load_recipients</a>();
<a name="l197"><span class="linenum"> 197</span></a>                  }
<a name="l198"><span class="linenum"> 198</span></a>                  <a class="function" onClick="logFunction('update_todays_thread_settings')" href="../../../_functions/update_todays_thread_settings.html" onMouseOver="funcPopup(event,'update_todays_thread_settings')">update_todays_thread_settings</a>( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a>-&gt;<a onClick="logVariable('recipients_list')" class="var it10741" onMouseOver="hilite(10741)" onMouseOut="lolite()" href="../../../_variables/recipients_list.html">recipients_list</a> ) );
<a name="l199"><span class="linenum"> 199</span></a>              }
<a name="l200"><span class="linenum"> 200</span></a>  
<a name="l201"><span class="linenum"> 201</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Your private message has been sent.'), 'success' );
<a name="l202"><span class="linenum"> 202</span></a>          }
<a name="l203"><span class="linenum"> 203</span></a>  
<a name="l204"><span class="linenum"> 204</span></a>          return true;
<a name="l205"><span class="linenum"> 205</span></a>      }
<a name="l206"><span class="linenum"> 206</span></a>      return false;
<a name="l207"><span class="linenum"> 207</span></a>  }
<a name="l208"><span class="linenum"> 208</span></a>  
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>  <span class="comment">/**</span>
<a name="l211"><span class="linenum"> 211</span></a>  <span class="comment"> * Create a new message from request in the given thread</span>
<a name="l212"><span class="linenum"> 212</span></a>  <span class="comment"> *</span>
<a name="l213"><span class="linenum"> 213</span></a>  <span class="comment"> * @param integer thread ID</span>
<a name="l214"><span class="linenum"> 214</span></a>  <span class="comment"> * @return boolean true on success</span>
<a name="l215"><span class="linenum"> 215</span></a>  <span class="comment"> */</span>
<a name="l216"><span class="linenum"> 216</span></a>  function <a class="function" onClick="logFunction('create_new_message')" href="../../../_functions/create_new_message.html" onMouseOver="funcPopup(event,'create_new_message')">create_new_message</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a> )
<a name="l217"><span class="linenum"> 217</span></a>  {
<a name="l218"><span class="linenum"> 218</span></a>      global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>, <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a>;
<a name="l219"><span class="linenum"> 219</span></a>  
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">    // Insert new message:</span>
<a name="l221"><span class="linenum"> 221</span></a>      <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Message')" href="../../../_classes/message.html" onMouseOver="classPopup(event,'message')">Message</a>();
<a name="l222"><span class="linenum"> 222</span></a>      <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10740" onMouseOver="hilite(10740)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> = <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>;
<a name="l223"><span class="linenum"> 223</span></a>  
<a name="l224"><span class="linenum"> 224</span></a>  <span class="comment">    // Check permission:</span>
<a name="l225"><span class="linenum"> 225</span></a>      <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'reply', true );
<a name="l226"><span class="linenum"> 226</span></a>  
<a name="l227"><span class="linenum"> 227</span></a>      if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('system_lock') )
<a name="l228"><span class="linenum"> 228</span></a>      { // System is locked for maintenance, All users cannot send a message
<a name="l229"><span class="linenum"> 229</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You cannot send a message at this time because the system is under maintenance. Please try again in a few moments.'), 'error' );
<a name="l230"><span class="linenum"> 230</span></a>          return false;
<a name="l231"><span class="linenum"> 231</span></a>      }
<a name="l232"><span class="linenum"> 232</span></a>  
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment">    // Load data from request</span>
<a name="l234"><span class="linenum"> 234</span></a>      if( <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('load_from_Request')" href="../../../_functions/load_from_request.html" onMouseOver="funcPopup(event,'load_from_request')">load_from_Request</a>() )
<a name="l235"><span class="linenum"> 235</span></a>      { // We could load data from form without errors:
<a name="l236"><span class="linenum"> 236</span></a>          if( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a> == 'preview' )
<a name="l237"><span class="linenum"> 237</span></a>          { // Don't insert message in preview mode
<a name="l238"><span class="linenum"> 238</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('This is a preview only! Do not forget to send your message!'), 'error' );
<a name="l239"><span class="linenum"> 239</span></a>          }
<a name="l240"><span class="linenum"> 240</span></a>          else//<a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a> == 'create'
<a name="l241"><span class="linenum"> 241</span></a>          { // Insert in DB:
<a name="l242"><span class="linenum"> 242</span></a>              <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('dbinsert_message')" href="../../../_functions/dbinsert_message.html" onMouseOver="funcPopup(event,'dbinsert_message')">dbinsert_message</a>();
<a name="l243"><span class="linenum"> 243</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Your private message has been sent.'), 'success' );
<a name="l244"><span class="linenum"> 244</span></a>          }
<a name="l245"><span class="linenum"> 245</span></a>  
<a name="l246"><span class="linenum"> 246</span></a>          return true;
<a name="l247"><span class="linenum"> 247</span></a>      }
<a name="l248"><span class="linenum"> 248</span></a>  
<a name="l249"><span class="linenum"> 249</span></a>      return false;
<a name="l250"><span class="linenum"> 250</span></a>  }
<a name="l251"><span class="linenum"> 251</span></a>  
<a name="l252"><span class="linenum"> 252</span></a>  
<a name="l253"><span class="linenum"> 253</span></a>  <span class="comment">/**</span>
<a name="l254"><span class="linenum"> 254</span></a>  <span class="comment"> * User leave a thread</span>
<a name="l255"><span class="linenum"> 255</span></a>  <span class="comment"> *</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment"> * @param integer thread ID</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment"> * @param integer user ID</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment"> * @param boolean set true to close the thread, which means no one can reply, leave false if thread must remain open</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment"> * @return mixed number 1 on success, false otherwise</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment"> */</span>
<a name="l261"><span class="linenum"> 261</span></a>  function <a class="function" onClick="logFunction('leave_thread')" href="../../../_functions/leave_thread.html" onMouseOver="funcPopup(event,'leave_thread')">leave_thread</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="var it4986" onMouseOver="hilite(4986)" onMouseOut="lolite()" onClick="logVariable('close_thread')" href="../../../_variables/close_thread.html">$close_thread</a> = false )
<a name="l262"><span class="linenum"> 262</span></a>  {
<a name="l263"><span class="linenum"> 263</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l264"><span class="linenum"> 264</span></a>  
<a name="l265"><span class="linenum"> 265</span></a>      <a class="var it1072" onMouseOver="hilite(1072)" onMouseOut="lolite()" onClick="logVariable('ThreadCache')" href="../../../_variables/ThreadCache.html">$ThreadCache</a> = &amp; get_ThreadCache();
<a name="l266"><span class="linenum"> 266</span></a>      <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a> = &amp; <a class="var it1072" onMouseOver="hilite(1072)" onMouseOut="lolite()" onClick="logVariable('ThreadCache')" href="../../../_variables/ThreadCache.html">$ThreadCache</a>-&gt;get_by_ID( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> );
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>      if( !<a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a>-&gt;<a class="function" onClick="logFunction('check_thread_recipient')" href="../../../_functions/check_thread_recipient.html" onMouseOver="funcPopup(event,'check_thread_recipient')">check_thread_recipient</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) )
<a name="l269"><span class="linenum"> 269</span></a>      { // user is not between the thread recipients
<a name="l270"><span class="linenum"> 270</span></a>          <a class="function" onClick="logFunction('debug_die')" href="../../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'Invalid request, current User is not recipient of the selected thread!' );
<a name="l271"><span class="linenum"> 271</span></a>      }
<a name="l272"><span class="linenum"> 272</span></a>  
<a name="l273"><span class="linenum"> 273</span></a>  <span class="comment">    // create subquery to select the last message ID in this thread. This will be the last visible message for the user from this thread.</span>
<a name="l274"><span class="linenum"> 274</span></a>      <a class="var it4987" onMouseOver="hilite(4987)" onMouseOut="lolite()" onClick="logVariable('msg_subquery')" href="../../../_variables/msg_subquery.html">$msg_subquery</a> = 'SELECT msg_ID FROM T_messaging__message
<a name="l275"><span class="linenum"> 275</span></a>                          WHERE msg_thread_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> ).'
<a name="l276"><span class="linenum"> 276</span></a>                          ORDER BY msg_datetime DESC
<a name="l277"><span class="linenum"> 277</span></a>                          LIMIT 1';
<a name="l278"><span class="linenum"> 278</span></a>  <span class="comment">    // set last visible thread ID query</span>
<a name="l279"><span class="linenum"> 279</span></a>      <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> = 'UPDATE T_messaging__threadstatus
<a name="l280"><span class="linenum"> 280</span></a>              SET tsta_thread_leave_msg_ID = ( '.<a class="var it4987" onMouseOver="hilite(4987)" onMouseOut="lolite()" onClick="logVariable('msg_subquery')" href="../../../_variables/msg_subquery.html">$msg_subquery</a>.' )
<a name="l281"><span class="linenum"> 281</span></a>          WHERE tsta_thread_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> ).'
<a name="l282"><span class="linenum"> 282</span></a>              AND tsta_thread_leave_msg_ID IS NULL';
<a name="l283"><span class="linenum"> 283</span></a>      if( ! <a class="var it4986" onMouseOver="hilite(4986)" onMouseOut="lolite()" onClick="logVariable('close_thread')" href="../../../_variables/close_thread.html">$close_thread</a> )
<a name="l284"><span class="linenum"> 284</span></a>      { // don't close the thread for all user only the given user wants to leave
<a name="l285"><span class="linenum"> 285</span></a>          <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> .= ' AND tsta_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l286"><span class="linenum"> 286</span></a>      }
<a name="l287"><span class="linenum"> 287</span></a>  
<a name="l288"><span class="linenum"> 288</span></a>      return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> );
<a name="l289"><span class="linenum"> 289</span></a>  }
<a name="l290"><span class="linenum"> 290</span></a>  
<a name="l291"><span class="linenum"> 291</span></a>  
<a name="l292"><span class="linenum"> 292</span></a>  <span class="comment">/**</span>
<a name="l293"><span class="linenum"> 293</span></a>  <span class="comment"> * Get messaging menu urls</span>
<a name="l294"><span class="linenum"> 294</span></a>  <span class="comment"> *</span>
<a name="l295"><span class="linenum"> 295</span></a>  <span class="comment"> * @param string specific sub entry url, possible values: 'threads', 'contacts', 'messages'</span>
<a name="l296"><span class="linenum"> 296</span></a>  <span class="comment"> */</span>
<a name="l297"><span class="linenum"> 297</span></a>  function <a class="function" onClick="logFunction('get_messaging_url')" href="../../../_functions/get_messaging_url.html" onMouseOver="funcPopup(event,'get_messaging_url')">get_messaging_url</a>( <a class="var it45" onMouseOver="hilite(45)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../_variables/disp.html">$disp</a> = 'threads' )
<a name="l298"><span class="linenum"> 298</span></a>  {
<a name="l299"><span class="linenum"> 299</span></a>      global <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>, <a class="var it488" onMouseOver="hilite(488)" onMouseOut="lolite()" onClick="logVariable('is_admin_page')" href="../../../_variables/is_admin_page.html">$is_admin_page</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l300"><span class="linenum"> 300</span></a>      if( <a class="var it488" onMouseOver="hilite(488)" onMouseOut="lolite()" onClick="logVariable('is_admin_page')" href="../../../_variables/is_admin_page.html">$is_admin_page</a> || empty( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> ) )
<a name="l301"><span class="linenum"> 301</span></a>      {
<a name="l302"><span class="linenum"> 302</span></a>          return <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>.'?ctrl='.<a class="var it45" onMouseOver="hilite(45)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../_variables/disp.html">$disp</a>;
<a name="l303"><span class="linenum"> 303</span></a>      }
<a name="l304"><span class="linenum"> 304</span></a>      return <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('gen_blogurl')" href="../../../_functions/gen_blogurl.html" onMouseOver="funcPopup(event,'gen_blogurl')">gen_blogurl</a>(), 'disp='.<a class="var it45" onMouseOver="hilite(45)" onMouseOut="lolite()" onClick="logVariable('disp')" href="../../../_variables/disp.html">$disp</a> );
<a name="l305"><span class="linenum"> 305</span></a>  }
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>  
<a name="l308"><span class="linenum"> 308</span></a>  <span class="comment">/**</span>
<a name="l309"><span class="linenum"> 309</span></a>  <span class="comment"> * Get messaging urls for the messaging notification emails</span>
<a name="l310"><span class="linenum"> 310</span></a>  <span class="comment"> *</span>
<a name="l311"><span class="linenum"> 311</span></a>  <span class="comment"> * @param integer thread ID the corresponding thread ID to display messages, and null to display all threads</span>
<a name="l312"><span class="linenum"> 312</span></a>  <span class="comment"> * @return array( threads/messages url, messaging preferences url )</span>
<a name="l313"><span class="linenum"> 313</span></a>  <span class="comment"> */</span>
<a name="l314"><span class="linenum"> 314</span></a>  function <a class="function" onClick="logFunction('get_messages_link_to')" href="../../../_functions/get_messages_link_to.html" onMouseOver="funcPopup(event,'get_messages_link_to')">get_messages_link_to</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> = NULL )
<a name="l315"><span class="linenum"> 315</span></a>  {
<a name="l316"><span class="linenum"> 316</span></a>      global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>;
<a name="l317"><span class="linenum"> 317</span></a>  
<a name="l318"><span class="linenum"> 318</span></a>      if( empty( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> ) )
<a name="l319"><span class="linenum"> 319</span></a>      {
<a name="l320"><span class="linenum"> 320</span></a>          <a class="var it4988" onMouseOver="hilite(4988)" onMouseOut="lolite()" onClick="logVariable('link_tail')" href="../../../_variables/link_tail.html">$link_tail</a> = 'threads';
<a name="l321"><span class="linenum"> 321</span></a>      }
<a name="l322"><span class="linenum"> 322</span></a>      else
<a name="l323"><span class="linenum"> 323</span></a>      {
<a name="l324"><span class="linenum"> 324</span></a>          <a class="var it4988" onMouseOver="hilite(4988)" onMouseOut="lolite()" onClick="logVariable('link_tail')" href="../../../_variables/link_tail.html">$link_tail</a> = 'messages&amp;thrd_ID='.<a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a>;
<a name="l325"><span class="linenum"> 325</span></a>      }
<a name="l326"><span class="linenum"> 326</span></a>  
<a name="l327"><span class="linenum"> 327</span></a>      if( <a class="var it2219" onMouseOver="hilite(2219)" onMouseOut="lolite()" onClick="logVariable('msg_Blog')" href="../../../_variables/msg_Blog.html">$msg_Blog</a> = &amp; get_setting_Blog( 'msg_blog_ID' ) )
<a name="l328"><span class="linenum"> 328</span></a>      { // Link to blog that is used for messaging
<a name="l329"><span class="linenum"> 329</span></a>          <a class="var it4736" onMouseOver="hilite(4736)" onMouseOut="lolite()" onClick="logVariable('message_link')" href="../../../_variables/message_link.html">$message_link</a> = <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it2219" onMouseOver="hilite(2219)" onMouseOut="lolite()" onClick="logVariable('msg_Blog')" href="../../../_variables/msg_Blog.html">$msg_Blog</a>-&gt;<a class="function" onClick="logFunction('gen_blogurl')" href="../../../_functions/gen_blogurl.html" onMouseOver="funcPopup(event,'gen_blogurl')">gen_blogurl</a>(), 'disp='.<a class="var it4988" onMouseOver="hilite(4988)" onMouseOut="lolite()" onClick="logVariable('link_tail')" href="../../../_variables/link_tail.html">$link_tail</a> );
<a name="l330"><span class="linenum"> 330</span></a>          <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('prefs_link')" href="../../../_variables/prefs_link.html">$prefs_link</a> = <a class="var it2219" onMouseOver="hilite(2219)" onMouseOut="lolite()" onClick="logVariable('msg_Blog')" href="../../../_variables/msg_Blog.html">$msg_Blog</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'userprefsurl' );
<a name="l331"><span class="linenum"> 331</span></a>      }
<a name="l332"><span class="linenum"> 332</span></a>      else
<a name="l333"><span class="linenum"> 333</span></a>      { // Link to admin messaging managment
<a name="l334"><span class="linenum"> 334</span></a>          <a class="var it4736" onMouseOver="hilite(4736)" onMouseOut="lolite()" onClick="logVariable('message_link')" href="../../../_variables/message_link.html">$message_link</a> = <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>.'?ctrl='.<a class="var it4988" onMouseOver="hilite(4988)" onMouseOut="lolite()" onClick="logVariable('link_tail')" href="../../../_variables/link_tail.html">$link_tail</a>;
<a name="l335"><span class="linenum"> 335</span></a>          <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('prefs_link')" href="../../../_variables/prefs_link.html">$prefs_link</a> = <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>.'?ctrl=user&amp;user_tab=userprefs';
<a name="l336"><span class="linenum"> 336</span></a>      }
<a name="l337"><span class="linenum"> 337</span></a>  
<a name="l338"><span class="linenum"> 338</span></a>      return array( <a class="var it4736" onMouseOver="hilite(4736)" onMouseOut="lolite()" onClick="logVariable('message_link')" href="../../../_variables/message_link.html">$message_link</a>, <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('prefs_link')" href="../../../_variables/prefs_link.html">$prefs_link</a> );
<a name="l339"><span class="linenum"> 339</span></a>  }
<a name="l340"><span class="linenum"> 340</span></a>  
<a name="l341"><span class="linenum"> 341</span></a>  
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">/**</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment"> * Get messaging menu sub entries</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment"> *</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment"> * @param boolean true to get admin interface messaging sub menu entries, false to get front office messaging sub menu entries</span>
<a name="l346"><span class="linenum"> 346</span></a>  <span class="comment"> * @param integer owner user ID</span>
<a name="l347"><span class="linenum"> 347</span></a>  <span class="comment"> * @return array user sub entries</span>
<a name="l348"><span class="linenum"> 348</span></a>  <span class="comment"> */</span>
<a name="l349"><span class="linenum"> 349</span></a>  function <a class="function" onClick="logFunction('get_messaging_sub_entries')" href="../../../_functions/get_messaging_sub_entries.html" onMouseOver="funcPopup(event,'get_messaging_sub_entries')">get_messaging_sub_entries</a>( <a class="var it2552" onMouseOver="hilite(2552)" onMouseOut="lolite()" onClick="logVariable('is_admin')" href="../../../_variables/is_admin.html">$is_admin</a> )
<a name="l350"><span class="linenum"> 350</span></a>  {
<a name="l351"><span class="linenum"> 351</span></a>      global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l352"><span class="linenum"> 352</span></a>  
<a name="l353"><span class="linenum"> 353</span></a>      if( <a class="var it2552" onMouseOver="hilite(2552)" onMouseOut="lolite()" onClick="logVariable('is_admin')" href="../../../_variables/is_admin.html">$is_admin</a> )
<a name="l354"><span class="linenum"> 354</span></a>      {
<a name="l355"><span class="linenum"> 355</span></a>          <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a> = '?ctrl=';
<a name="l356"><span class="linenum"> 356</span></a>      }
<a name="l357"><span class="linenum"> 357</span></a>      else
<a name="l358"><span class="linenum"> 358</span></a>      {
<a name="l359"><span class="linenum"> 359</span></a>          <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a> = <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('gen_blogurl')" href="../../../_functions/gen_blogurl.html" onMouseOver="funcPopup(event,'gen_blogurl')">gen_blogurl</a>(), 'disp=' );
<a name="l360"><span class="linenum"> 360</span></a>      }
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>      <a class="var it4989" onMouseOver="hilite(4989)" onMouseOut="lolite()" onClick="logVariable('messaging_sub_entries')" href="../../../_variables/messaging_sub_entries.html">$messaging_sub_entries</a> = array(
<a name="l363"><span class="linenum"> 363</span></a>                                  'threads' =&gt; array(
<a name="l364"><span class="linenum"> 364</span></a>                                      'text' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Messages'),
<a name="l365"><span class="linenum"> 365</span></a>                                      'href' =&gt; <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a>.'threads' ),
<a name="l366"><span class="linenum"> 366</span></a>                                  'contacts' =&gt; array(
<a name="l367"><span class="linenum"> 367</span></a>                                      'text' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Contacts'),
<a name="l368"><span class="linenum"> 368</span></a>                                      'href' =&gt; <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a>.'contacts' ),
<a name="l369"><span class="linenum"> 369</span></a>                              );
<a name="l370"><span class="linenum"> 370</span></a>  
<a name="l371"><span class="linenum"> 371</span></a>      if( <a class="var it2552" onMouseOver="hilite(2552)" onMouseOut="lolite()" onClick="logVariable('is_admin')" href="../../../_variables/is_admin.html">$is_admin</a> &amp;&amp; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'options', 'edit' ) )
<a name="l372"><span class="linenum"> 372</span></a>      {
<a name="l373"><span class="linenum"> 373</span></a>          <a class="var it4989" onMouseOver="hilite(4989)" onMouseOut="lolite()" onClick="logVariable('messaging_sub_entries')" href="../../../_variables/messaging_sub_entries.html">$messaging_sub_entries</a>[ 'msgsettings' ] = array(
<a name="l374"><span class="linenum"> 374</span></a>                                                      'text' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Settings'),
<a name="l375"><span class="linenum"> 375</span></a>                                                      'href' =&gt; <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a>.'msgsettings'
<a name="l376"><span class="linenum"> 376</span></a>                                                  );
<a name="l377"><span class="linenum"> 377</span></a>      }
<a name="l378"><span class="linenum"> 378</span></a>      if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'abuse' ) )
<a name="l379"><span class="linenum"> 379</span></a>      {
<a name="l380"><span class="linenum"> 380</span></a>          <a class="var it4989" onMouseOver="hilite(4989)" onMouseOut="lolite()" onClick="logVariable('messaging_sub_entries')" href="../../../_variables/messaging_sub_entries.html">$messaging_sub_entries</a>[ 'abuse' ] = array(
<a name="l381"><span class="linenum"> 381</span></a>                                                      'text' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Abuse Management'),
<a name="l382"><span class="linenum"> 382</span></a>                                                      'href' =&gt; <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a>.'abuse'
<a name="l383"><span class="linenum"> 383</span></a>                                                  );
<a name="l384"><span class="linenum"> 384</span></a>      }
<a name="l385"><span class="linenum"> 385</span></a>  
<a name="l386"><span class="linenum"> 386</span></a>      return <a class="var it4989" onMouseOver="hilite(4989)" onMouseOut="lolite()" onClick="logVariable('messaging_sub_entries')" href="../../../_variables/messaging_sub_entries.html">$messaging_sub_entries</a>;
<a name="l387"><span class="linenum"> 387</span></a>  }
<a name="l388"><span class="linenum"> 388</span></a>  
<a name="l389"><span class="linenum"> 389</span></a>  
<a name="l390"><span class="linenum"> 390</span></a>  <span class="comment">/**</span>
<a name="l391"><span class="linenum"> 391</span></a>  <span class="comment"> * Save message form params into the current Session</span>
<a name="l392"><span class="linenum"> 392</span></a>  <span class="comment"> *</span>
<a name="l393"><span class="linenum"> 393</span></a>  <span class="comment"> * @param Array message form params</span>
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment"> */</span>
<a name="l395"><span class="linenum"> 395</span></a>  function <a class="function" onClick="logFunction('save_message_params_to_session')" href="../../../_functions/save_message_params_to_session.html" onMouseOver="funcPopup(event,'save_message_params_to_session')">save_message_params_to_session</a>( <a class="var it4990" onMouseOver="hilite(4990)" onMouseOut="lolite()" onClick="logVariable('unsaved_message_Array')" href="../../../_variables/unsaved_message_Array.html">$unsaved_message_Array</a> )
<a name="l396"><span class="linenum"> 396</span></a>  {
<a name="l397"><span class="linenum"> 397</span></a>      global <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>;
<a name="l398"><span class="linenum"> 398</span></a>      <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'core.unsaved_message_Array', <a class="var it4990" onMouseOver="hilite(4990)" onMouseOut="lolite()" onClick="logVariable('unsaved_message_Array')" href="../../../_variables/unsaved_message_Array.html">$unsaved_message_Array</a> );
<a name="l399"><span class="linenum"> 399</span></a>  }
<a name="l400"><span class="linenum"> 400</span></a>  
<a name="l401"><span class="linenum"> 401</span></a>  
<a name="l402"><span class="linenum"> 402</span></a>  <span class="comment">/**</span>
<a name="l403"><span class="linenum"> 403</span></a>  <span class="comment"> * Get message form params from the current Session</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment"> *</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment"> * @return Array|NULL message form params array if Session core.unsaved_message_Array is set, NULL otherwise</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment"> */</span>
<a name="l407"><span class="linenum"> 407</span></a>  function <a class="function" onClick="logFunction('get_message_params_from_session')" href="../../../_functions/get_message_params_from_session.html" onMouseOver="funcPopup(event,'get_message_params_from_session')">get_message_params_from_session</a>()
<a name="l408"><span class="linenum"> 408</span></a>  {
<a name="l409"><span class="linenum"> 409</span></a>      global <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>;
<a name="l410"><span class="linenum"> 410</span></a>      if( ( <a class="var it4990" onMouseOver="hilite(4990)" onMouseOut="lolite()" onClick="logVariable('unsaved_message_Array')" href="../../../_variables/unsaved_message_Array.html">$unsaved_message_Array</a> = <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'core.unsaved_message_Array' ) ) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>( <a class="var it4990" onMouseOver="hilite(4990)" onMouseOut="lolite()" onClick="logVariable('unsaved_message_Array')" href="../../../_variables/unsaved_message_Array.html">$unsaved_message_Array</a> ) )
<a name="l411"><span class="linenum"> 411</span></a>      {
<a name="l412"><span class="linenum"> 412</span></a>          <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'core.unsaved_message_Array' );
<a name="l413"><span class="linenum"> 413</span></a>          return <a class="var it4990" onMouseOver="hilite(4990)" onMouseOut="lolite()" onClick="logVariable('unsaved_message_Array')" href="../../../_variables/unsaved_message_Array.html">$unsaved_message_Array</a>;
<a name="l414"><span class="linenum"> 414</span></a>      }
<a name="l415"><span class="linenum"> 415</span></a>      return NULL;
<a name="l416"><span class="linenum"> 416</span></a>  }
<a name="l417"><span class="linenum"> 417</span></a>  
<a name="l418"><span class="linenum"> 418</span></a>  
<a name="l419"><span class="linenum"> 419</span></a>  <span class="comment">/**</span>
<a name="l420"><span class="linenum"> 420</span></a>  <span class="comment"> * Get threads recipients SQL</span>
<a name="l421"><span class="linenum"> 421</span></a>  <span class="comment"> *</span>
<a name="l422"><span class="linenum"> 422</span></a>  <span class="comment"> * @param integer Thread ID</span>
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment"> * @return SQL object</span>
<a name="l424"><span class="linenum"> 424</span></a>  <span class="comment"> */</span>
<a name="l425"><span class="linenum"> 425</span></a>  function <a class="function" onClick="logFunction('get_threads_recipients_sql')" href="../../../_functions/get_threads_recipients_sql.html" onMouseOver="funcPopup(event,'get_threads_recipients_sql')">get_threads_recipients_sql</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> = 0 )
<a name="l426"><span class="linenum"> 426</span></a>  {
<a name="l427"><span class="linenum"> 427</span></a>      global <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l428"><span class="linenum"> 428</span></a>  
<a name="l429"><span class="linenum"> 429</span></a>      <a class="var it4991" onMouseOver="hilite(4991)" onMouseOut="lolite()" onClick="logVariable('read_user_sql_limit')" href="../../../_variables/read_user_sql_limit.html">$read_user_sql_limit</a> = '';
<a name="l430"><span class="linenum"> 430</span></a>      <a class="var it4992" onMouseOver="hilite(4992)" onMouseOut="lolite()" onClick="logVariable('unread_user_sql_limit')" href="../../../_variables/unread_user_sql_limit.html">$unread_user_sql_limit</a> = '';
<a name="l431"><span class="linenum"> 431</span></a>      <a class="var it4993" onMouseOver="hilite(4993)" onMouseOut="lolite()" onClick="logVariable('left_user_sql_limit')" href="../../../_variables/left_user_sql_limit.html">$left_user_sql_limit</a> = '';
<a name="l432"><span class="linenum"> 432</span></a>      if( ! <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> )
<a name="l433"><span class="linenum"> 433</span></a>      {    // Non abuse management
<a name="l434"><span class="linenum"> 434</span></a>          <a class="var it4991" onMouseOver="hilite(4991)" onMouseOut="lolite()" onClick="logVariable('read_user_sql_limit')" href="../../../_variables/read_user_sql_limit.html">$read_user_sql_limit</a> = ' AND ur.user_ID &lt;&gt; '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l435"><span class="linenum"> 435</span></a>          <a class="var it4992" onMouseOver="hilite(4992)" onMouseOut="lolite()" onClick="logVariable('unread_user_sql_limit')" href="../../../_variables/unread_user_sql_limit.html">$unread_user_sql_limit</a> = ' AND uu.user_ID &lt;&gt; '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l436"><span class="linenum"> 436</span></a>          <a class="var it4993" onMouseOver="hilite(4993)" onMouseOut="lolite()" onClick="logVariable('left_user_sql_limit')" href="../../../_variables/left_user_sql_limit.html">$left_user_sql_limit</a> = ' AND ul.user_ID &lt;&gt; '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l437"><span class="linenum"> 437</span></a>      }
<a name="l438"><span class="linenum"> 438</span></a>  
<a name="l439"><span class="linenum"> 439</span></a>      <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l440"><span class="linenum"> 440</span></a>  
<a name="l441"><span class="linenum"> 441</span></a>      <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'ts.tsta_thread_ID AS thr_ID,
<a name="l442"><span class="linenum"> 442</span></a>                                  GROUP_CONCAT(DISTINCT ur.user_login ORDER BY ur.user_login SEPARATOR \', \') AS thr_read,
<a name="l443"><span class="linenum"> 443</span></a>                                  GROUP_CONCAT(DISTINCT uu.user_login ORDER BY uu.user_login SEPARATOR \', \') AS thr_unread,
<a name="l444"><span class="linenum"> 444</span></a>                                  GROUP_CONCAT(DISTINCT ul.user_login ORDER BY ul.user_login SEPARATOR \', \') AS thr_left' );
<a name="l445"><span class="linenum"> 445</span></a>  
<a name="l446"><span class="linenum"> 446</span></a>      <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus ts
<a name="l447"><span class="linenum"> 447</span></a>                                  LEFT OUTER JOIN T_messaging__threadstatus tsr
<a name="l448"><span class="linenum"> 448</span></a>                                      ON ts.tsta_thread_ID = tsr.tsta_thread_ID AND tsr.tsta_first_unread_msg_ID IS NULL
<a name="l449"><span class="linenum"> 449</span></a>                                          AND tsr.tsta_thread_leave_msg_ID IS NULL
<a name="l450"><span class="linenum"> 450</span></a>                                  LEFT OUTER JOIN T_users ur
<a name="l451"><span class="linenum"> 451</span></a>                                      ON tsr.tsta_user_ID = ur.user_ID'.<a class="var it4991" onMouseOver="hilite(4991)" onMouseOut="lolite()" onClick="logVariable('read_user_sql_limit')" href="../../../_variables/read_user_sql_limit.html">$read_user_sql_limit</a>.'
<a name="l452"><span class="linenum"> 452</span></a>                                  LEFT OUTER JOIN T_messaging__threadstatus tsu
<a name="l453"><span class="linenum"> 453</span></a>                                      ON ts.tsta_thread_ID = tsu.tsta_thread_ID AND tsu.tsta_first_unread_msg_ID IS NOT NULL
<a name="l454"><span class="linenum"> 454</span></a>                                          AND tsu.tsta_thread_leave_msg_ID IS NULL
<a name="l455"><span class="linenum"> 455</span></a>                                  LEFT OUTER JOIN T_users uu
<a name="l456"><span class="linenum"> 456</span></a>                                      ON tsu.tsta_user_ID = uu.user_ID'.<a class="var it4992" onMouseOver="hilite(4992)" onMouseOut="lolite()" onClick="logVariable('unread_user_sql_limit')" href="../../../_variables/unread_user_sql_limit.html">$unread_user_sql_limit</a>.'
<a name="l457"><span class="linenum"> 457</span></a>                                  LEFT OUTER JOIN T_messaging__threadstatus tsl
<a name="l458"><span class="linenum"> 458</span></a>                                      ON ts.tsta_thread_ID = tsl.tsta_thread_ID AND tsl.tsta_thread_leave_msg_ID IS NOT NULL
<a name="l459"><span class="linenum"> 459</span></a>                                  LEFT OUTER JOIN T_users ul
<a name="l460"><span class="linenum"> 460</span></a>                                      ON tsl.tsta_user_ID = ul.user_ID'.<a class="var it4993" onMouseOver="hilite(4993)" onMouseOut="lolite()" onClick="logVariable('left_user_sql_limit')" href="../../../_variables/left_user_sql_limit.html">$left_user_sql_limit</a> );
<a name="l461"><span class="linenum"> 461</span></a>  
<a name="l462"><span class="linenum"> 462</span></a>      if( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> &gt; 0 )
<a name="l463"><span class="linenum"> 463</span></a>      {    // Limit with thread ID
<a name="l464"><span class="linenum"> 464</span></a>          <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'ts.tsta_thread_ID = '.<a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> );
<a name="l465"><span class="linenum"> 465</span></a>      }
<a name="l466"><span class="linenum"> 466</span></a>  
<a name="l467"><span class="linenum"> 467</span></a>      if( ! <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> )
<a name="l468"><span class="linenum"> 468</span></a>      {    // Get a messages only of current user
<a name="l469"><span class="linenum"> 469</span></a>          <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'ts.tsta_user_ID ='.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l470"><span class="linenum"> 470</span></a>      }
<a name="l471"><span class="linenum"> 471</span></a>  
<a name="l472"><span class="linenum"> 472</span></a>      <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a>-&gt;<a class="function" onClick="logFunction('GROUP_BY')" href="../../../_functions/group_by.html" onMouseOver="funcPopup(event,'group_by')">GROUP_BY</a>( 'ts.tsta_thread_ID' );
<a name="l473"><span class="linenum"> 473</span></a>  
<a name="l474"><span class="linenum"> 474</span></a>      return <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a>;
<a name="l475"><span class="linenum"> 475</span></a>  }
<a name="l476"><span class="linenum"> 476</span></a>  
<a name="l477"><span class="linenum"> 477</span></a>  
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">/**</span>
<a name="l479"><span class="linenum"> 479</span></a>  <span class="comment"> * Get all those user threads and their recipients where the corresponding users have unread messages.</span>
<a name="l480"><span class="linenum"> 480</span></a>  <span class="comment"> * This function is used for the different email notifications.</span>
<a name="l481"><span class="linenum"> 481</span></a>  <span class="comment"> *</span>
<a name="l482"><span class="linenum"> 482</span></a>  <span class="comment"> * @param array required user id list</span>
<a name="l483"><span class="linenum"> 483</span></a>  <span class="comment"> * @param integer a thread ID that should be skipped from the result list. Leave it to NULL if you don't want to skip any thread.</span>
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment"> * @param string Threads format ( string | array )</span>
<a name="l485"><span class="linenum"> 485</span></a>  <span class="comment"> * @param string User logins format ( text | html )</span>
<a name="l486"><span class="linenum"> 486</span></a>  <span class="comment"> * @return array ( user_ID -&gt; (string or array) ) pairs, the string contains the users unread threads titles and their recipients list</span>
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment"> */</span>
<a name="l488"><span class="linenum"> 488</span></a>  function <a class="function" onClick="logFunction('get_users_unread_threads')" href="../../../_functions/get_users_unread_threads.html" onMouseOver="funcPopup(event,'get_users_unread_threads')">get_users_unread_threads</a>( <a class="var it4995" onMouseOver="hilite(4995)" onMouseOut="lolite()" onClick="logVariable('userid_list')" href="../../../_variables/userid_list.html">$userid_list</a>, <a class="var it4996" onMouseOver="hilite(4996)" onMouseOut="lolite()" onClick="logVariable('skip_thread_ID')" href="../../../_variables/skip_thread_ID.html">$skip_thread_ID</a> = NULL, <a class="var it4997" onMouseOver="hilite(4997)" onMouseOut="lolite()" onClick="logVariable('threads_format')" href="../../../_variables/threads_format.html">$threads_format</a> = 'string', <a class="var it4998" onMouseOver="hilite(4998)" onMouseOut="lolite()" onClick="logVariable('login_format')" href="../../../_variables/login_format.html">$login_format</a> = 'text' )
<a name="l489"><span class="linenum"> 489</span></a>  {
<a name="l490"><span class="linenum"> 490</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l491"><span class="linenum"> 491</span></a>      <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = array();
<a name="l492"><span class="linenum"> 492</span></a>  
<a name="l493"><span class="linenum"> 493</span></a>      if( empty( <a class="var it4995" onMouseOver="hilite(4995)" onMouseOut="lolite()" onClick="logVariable('userid_list')" href="../../../_variables/userid_list.html">$userid_list</a> ) )
<a name="l494"><span class="linenum"> 494</span></a>      { // requested user id list is empty, return empty result
<a name="l495"><span class="linenum"> 495</span></a>          return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l496"><span class="linenum"> 496</span></a>      }
<a name="l497"><span class="linenum"> 497</span></a>  
<a name="l498"><span class="linenum"> 498</span></a>  <span class="comment">    // Get all those user threads where the corresponding user has unread messages, and sort descending by last modifiaction date</span>
<a name="l499"><span class="linenum"> 499</span></a>      <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> = 'SELECT DISTINCT tsta_user_ID, GROUP_CONCAT( CONVERT( thrd_ID, CHAR(10) ) ORDER BY thrd_datemodified DESC SEPARATOR &quot;,&quot; ) as threads
<a name="l500"><span class="linenum"> 500</span></a>              FROM T_messaging__threadstatus
<a name="l501"><span class="linenum"> 501</span></a>              LEFT JOIN T_messaging__thread ON thrd_ID = tsta_thread_ID
<a name="l502"><span class="linenum"> 502</span></a>              WHERE tsta_first_unread_msg_ID IS NOT NULL AND tsta_user_ID IN ( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it4995" onMouseOver="hilite(4995)" onMouseOut="lolite()" onClick="logVariable('userid_list')" href="../../../_variables/userid_list.html">$userid_list</a> ).')
<a name="l503"><span class="linenum"> 503</span></a>              GROUP BY tsta_user_ID';
<a name="l504"><span class="linenum"> 504</span></a>      <a class="var it4999" onMouseOver="hilite(4999)" onMouseOut="lolite()" onClick="logVariable('user_unread_threads')" href="../../../_variables/user_unread_threads.html">$user_unread_threads</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a>, 'Get all threads where the corresponding users have unread messages' );
<a name="l505"><span class="linenum"> 505</span></a>  
<a name="l506"><span class="linenum"> 506</span></a>      if( empty( <a class="var it4999" onMouseOver="hilite(4999)" onMouseOut="lolite()" onClick="logVariable('user_unread_threads')" href="../../../_variables/user_unread_threads.html">$user_unread_threads</a> ) )
<a name="l507"><span class="linenum"> 507</span></a>      { // requested users have no unread threads
<a name="l508"><span class="linenum"> 508</span></a>          return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l509"><span class="linenum"> 509</span></a>      }
<a name="l510"><span class="linenum"> 510</span></a>  
<a name="l511"><span class="linenum"> 511</span></a>      <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('all_involved_threads')" href="../../../_variables/all_involved_threads.html">$all_involved_threads</a> = array();
<a name="l512"><span class="linenum"> 512</span></a>      <a class="var it5001" onMouseOver="hilite(5001)" onMouseOut="lolite()" onClick="logVariable('user_threads')" href="../../../_variables/user_threads.html">$user_threads</a> = array();
<a name="l513"><span class="linenum"> 513</span></a>  <span class="comment">    // create an all involved threads array</span>
<a name="l514"><span class="linenum"> 514</span></a>      foreach( <a class="var it4999" onMouseOver="hilite(4999)" onMouseOut="lolite()" onClick="logVariable('user_unread_threads')" href="../../../_variables/user_unread_threads.html">$user_unread_threads</a> as <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> =&gt; <a class="var it5002" onMouseOver="hilite(5002)" onMouseOut="lolite()" onClick="logVariable('threads')" href="../../../_variables/threads.html">$threads</a> )
<a name="l515"><span class="linenum"> 515</span></a>      {
<a name="l516"><span class="linenum"> 516</span></a>          <a class="var it5001" onMouseOver="hilite(5001)" onMouseOut="lolite()" onClick="logVariable('user_threads')" href="../../../_variables/user_threads.html">$user_threads</a>[ <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> ] = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( ',', <a class="var it5002" onMouseOver="hilite(5002)" onMouseOut="lolite()" onClick="logVariable('threads')" href="../../../_variables/threads.html">$threads</a> );
<a name="l517"><span class="linenum"> 517</span></a>          <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('all_involved_threads')" href="../../../_variables/all_involved_threads.html">$all_involved_threads</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('all_involved_threads')" href="../../../_variables/all_involved_threads.html">$all_involved_threads</a>, <a class="var it5001" onMouseOver="hilite(5001)" onMouseOut="lolite()" onClick="logVariable('user_threads')" href="../../../_variables/user_threads.html">$user_threads</a>[ <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a> ] );
<a name="l518"><span class="linenum"> 518</span></a>      }
<a name="l519"><span class="linenum"> 519</span></a>      <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('all_involved_threads')" href="../../../_variables/all_involved_threads.html">$all_involved_threads</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>( <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('all_involved_threads')" href="../../../_variables/all_involved_threads.html">$all_involved_threads</a> );
<a name="l520"><span class="linenum"> 520</span></a>  
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">    // Get all required threads recipients and titles</span>
<a name="l522"><span class="linenum"> 522</span></a>      <a class="var it5003" onMouseOver="hilite(5003)" onMouseOut="lolite()" onClick="logVariable('recipients_query')" href="../../../_variables/recipients_query.html">$recipients_query</a> = 'SELECT tsta_thread_ID as thread_ID, thrd_title, user_login
<a name="l523"><span class="linenum"> 523</span></a>              FROM T_messaging__threadstatus
<a name="l524"><span class="linenum"> 524</span></a>              LEFT JOIN T_users ON user_ID = tsta_user_ID
<a name="l525"><span class="linenum"> 525</span></a>              LEFT JOIN T_messaging__thread ON thrd_ID = tsta_thread_ID
<a name="l526"><span class="linenum"> 526</span></a>                  WHERE tsta_thread_ID IN ( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it5000" onMouseOver="hilite(5000)" onMouseOut="lolite()" onClick="logVariable('all_involved_threads')" href="../../../_variables/all_involved_threads.html">$all_involved_threads</a> ).' )';
<a name="l527"><span class="linenum"> 527</span></a>      <a class="var it5004" onMouseOver="hilite(5004)" onMouseOut="lolite()" onClick="logVariable('all_threads_recipients')" href="../../../_variables/all_threads_recipients.html">$all_threads_recipients</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it5003" onMouseOver="hilite(5003)" onMouseOut="lolite()" onClick="logVariable('recipients_query')" href="../../../_variables/recipients_query.html">$recipients_query</a>, <a class="constant" onClick="logConstant('OBJECT')" href="../../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 'Load all required threads title and recipients' );
<a name="l528"><span class="linenum"> 528</span></a>      <a class="var it5005" onMouseOver="hilite(5005)" onMouseOut="lolite()" onClick="logVariable('thread_recipients')" href="../../../_variables/thread_recipients.html">$thread_recipients</a> = array();
<a name="l529"><span class="linenum"> 529</span></a>      <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('thread_titles')" href="../../../_variables/thread_titles.html">$thread_titles</a> = array();
<a name="l530"><span class="linenum"> 530</span></a>      foreach( <a class="var it5004" onMouseOver="hilite(5004)" onMouseOut="lolite()" onClick="logVariable('all_threads_recipients')" href="../../../_variables/all_threads_recipients.html">$all_threads_recipients</a> as <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> )
<a name="l531"><span class="linenum"> 531</span></a>      {
<a name="l532"><span class="linenum"> 532</span></a>          if( !isset( <a class="var it5005" onMouseOver="hilite(5005)" onMouseOut="lolite()" onClick="logVariable('thread_recipients')" href="../../../_variables/thread_recipients.html">$thread_recipients</a>[ <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> ] ) )
<a name="l533"><span class="linenum"> 533</span></a>          {
<a name="l534"><span class="linenum"> 534</span></a>              <a class="var it5005" onMouseOver="hilite(5005)" onMouseOut="lolite()" onClick="logVariable('thread_recipients')" href="../../../_variables/thread_recipients.html">$thread_recipients</a>[ <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> ] = array();
<a name="l535"><span class="linenum"> 535</span></a>          }
<a name="l536"><span class="linenum"> 536</span></a>          if( empty( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('user_login')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/user_login.html">user_login</a> ) )
<a name="l537"><span class="linenum"> 537</span></a>          { // User was deleted
<a name="l538"><span class="linenum"> 538</span></a>              <a class="var it5005" onMouseOver="hilite(5005)" onMouseOut="lolite()" onClick="logVariable('thread_recipients')" href="../../../_variables/thread_recipients.html">$thread_recipients</a>[<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a>][] = 'Deleted user';
<a name="l539"><span class="linenum"> 539</span></a>          }
<a name="l540"><span class="linenum"> 540</span></a>          else
<a name="l541"><span class="linenum"> 541</span></a>          { // User exists
<a name="l542"><span class="linenum"> 542</span></a>              if( <a class="var it4998" onMouseOver="hilite(4998)" onMouseOut="lolite()" onClick="logVariable('login_format')" href="../../../_variables/login_format.html">$login_format</a> == 'text' )
<a name="l543"><span class="linenum"> 543</span></a>              { // Use simple login as text
<a name="l544"><span class="linenum"> 544</span></a>                  <a class="var it5005" onMouseOver="hilite(5005)" onMouseOut="lolite()" onClick="logVariable('thread_recipients')" href="../../../_variables/thread_recipients.html">$thread_recipients</a>[<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a>][] = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('user_login')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/user_login.html">user_login</a>;
<a name="l545"><span class="linenum"> 545</span></a>              }
<a name="l546"><span class="linenum"> 546</span></a>              else // 'html'
<a name="l547"><span class="linenum"> 547</span></a>              { // Use a colored login with avatar
<a name="l548"><span class="linenum"> 548</span></a>                  <a class="var it5005" onMouseOver="hilite(5005)" onMouseOut="lolite()" onClick="logVariable('thread_recipients')" href="../../../_variables/thread_recipients.html">$thread_recipients</a>[<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a>][] = <a class="function" onClick="logFunction('get_user_colored_login')" href="../../../_functions/get_user_colored_login.html" onMouseOver="funcPopup(event,'get_user_colored_login')">get_user_colored_login</a>( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('user_login')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/user_login.html">user_login</a> );
<a name="l549"><span class="linenum"> 549</span></a>              }
<a name="l550"><span class="linenum"> 550</span></a>          }
<a name="l551"><span class="linenum"> 551</span></a>          if( !isset( <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('thread_titles')" href="../../../_variables/thread_titles.html">$thread_titles</a>[ <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> ] ) )
<a name="l552"><span class="linenum"> 552</span></a>          {
<a name="l553"><span class="linenum"> 553</span></a>              <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('thread_titles')" href="../../../_variables/thread_titles.html">$thread_titles</a>[ <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> ] = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thrd_title')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thrd_title.html">thrd_title</a>;
<a name="l554"><span class="linenum"> 554</span></a>          }
<a name="l555"><span class="linenum"> 555</span></a>      }
<a name="l556"><span class="linenum"> 556</span></a>  
<a name="l557"><span class="linenum"> 557</span></a>      foreach( <a class="var it4995" onMouseOver="hilite(4995)" onMouseOut="lolite()" onClick="logVariable('userid_list')" href="../../../_variables/userid_list.html">$userid_list</a> as <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l558"><span class="linenum"> 558</span></a>      {
<a name="l559"><span class="linenum"> 559</span></a>          if( !isset( <a class="var it5001" onMouseOver="hilite(5001)" onMouseOut="lolite()" onClick="logVariable('user_threads')" href="../../../_variables/user_threads.html">$user_threads</a>[ <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ] ) )
<a name="l560"><span class="linenum"> 560</span></a>          {
<a name="l561"><span class="linenum"> 561</span></a>              <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>[ <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ] = NULL;
<a name="l562"><span class="linenum"> 562</span></a>              continue;
<a name="l563"><span class="linenum"> 563</span></a>          }
<a name="l564"><span class="linenum"> 564</span></a>          <a class="var it5002" onMouseOver="hilite(5002)" onMouseOut="lolite()" onClick="logVariable('threads')" href="../../../_variables/threads.html">$threads</a> = <a class="var it5001" onMouseOver="hilite(5001)" onMouseOut="lolite()" onClick="logVariable('user_threads')" href="../../../_variables/user_threads.html">$user_threads</a>[ <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ];
<a name="l565"><span class="linenum"> 565</span></a>          <a class="var it2954" onMouseOver="hilite(2954)" onMouseOut="lolite()" onClick="logVariable('unread_threads')" href="../../../_variables/unread_threads.html">$unread_threads</a> = <a class="var it4997" onMouseOver="hilite(4997)" onMouseOut="lolite()" onClick="logVariable('threads_format')" href="../../../_variables/threads_format.html">$threads_format</a> == 'string' ? '' : array();
<a name="l566"><span class="linenum"> 566</span></a>  <span class="comment">        // List all unread threads, starting with the most recent updated threads,</span>
<a name="l567"><span class="linenum"> 567</span></a>  <span class="comment">        // so that each new reminder looks as different as possible from the one from 72 hours before</span>
<a name="l568"><span class="linenum"> 568</span></a>          foreach( <a class="var it5002" onMouseOver="hilite(5002)" onMouseOut="lolite()" onClick="logVariable('threads')" href="../../../_variables/threads.html">$threads</a> as <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> )
<a name="l569"><span class="linenum"> 569</span></a>          {
<a name="l570"><span class="linenum"> 570</span></a>              if( <a class="var it4996" onMouseOver="hilite(4996)" onMouseOut="lolite()" onClick="logVariable('skip_thread_ID')" href="../../../_variables/skip_thread_ID.html">$skip_thread_ID</a> == <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> )
<a name="l571"><span class="linenum"> 571</span></a>              {
<a name="l572"><span class="linenum"> 572</span></a>                  continue;
<a name="l573"><span class="linenum"> 573</span></a>              }
<a name="l574"><span class="linenum"> 574</span></a>              <a class="var it5008" onMouseOver="hilite(5008)" onMouseOut="lolite()" onClick="logVariable('recipient_names')" href="../../../_variables/recipient_names.html">$recipient_names</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it5005" onMouseOver="hilite(5005)" onMouseOut="lolite()" onClick="logVariable('thread_recipients')" href="../../../_variables/thread_recipients.html">$thread_recipients</a>[ <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> ] );
<a name="l575"><span class="linenum"> 575</span></a>              if( <a class="var it4997" onMouseOver="hilite(4997)" onMouseOut="lolite()" onClick="logVariable('threads_format')" href="../../../_variables/threads_format.html">$threads_format</a> == 'string' )
<a name="l576"><span class="linenum"> 576</span></a>              {    // Store all threads in one string
<a name="l577"><span class="linenum"> 577</span></a>                  <a class="var it2954" onMouseOver="hilite(2954)" onMouseOut="lolite()" onClick="logVariable('unread_threads')" href="../../../_variables/unread_threads.html">$unread_threads</a> .= &quot;\t - &quot;.sprintf( '&quot;%s&quot; ( %s )', <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('thread_titles')" href="../../../_variables/thread_titles.html">$thread_titles</a>[ <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> ], <a class="var it5008" onMouseOver="hilite(5008)" onMouseOut="lolite()" onClick="logVariable('recipient_names')" href="../../../_variables/recipient_names.html">$recipient_names</a> ).&quot;\n&quot;;
<a name="l578"><span class="linenum"> 578</span></a>              }
<a name="l579"><span class="linenum"> 579</span></a>              else
<a name="l580"><span class="linenum"> 580</span></a>              {    // Store all threads in array
<a name="l581"><span class="linenum"> 581</span></a>                  <a class="var it2954" onMouseOver="hilite(2954)" onMouseOut="lolite()" onClick="logVariable('unread_threads')" href="../../../_variables/unread_threads.html">$unread_threads</a>[] = sprintf( '&quot;%s&quot; ( %s )', <a class="var it5006" onMouseOver="hilite(5006)" onMouseOut="lolite()" onClick="logVariable('thread_titles')" href="../../../_variables/thread_titles.html">$thread_titles</a>[ <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> ], <a class="var it5008" onMouseOver="hilite(5008)" onMouseOut="lolite()" onClick="logVariable('recipient_names')" href="../../../_variables/recipient_names.html">$recipient_names</a> );
<a name="l582"><span class="linenum"> 582</span></a>              }
<a name="l583"><span class="linenum"> 583</span></a>          }
<a name="l584"><span class="linenum"> 584</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>[<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>] = <a class="var it2954" onMouseOver="hilite(2954)" onMouseOut="lolite()" onClick="logVariable('unread_threads')" href="../../../_variables/unread_threads.html">$unread_threads</a>;
<a name="l585"><span class="linenum"> 585</span></a>      }
<a name="l586"><span class="linenum"> 586</span></a>  
<a name="l587"><span class="linenum"> 587</span></a>      return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l588"><span class="linenum"> 588</span></a>  }
<a name="l589"><span class="linenum"> 589</span></a>  
<a name="l590"><span class="linenum"> 590</span></a>  
<a name="l591"><span class="linenum"> 591</span></a>  <span class="comment">/**</span>
<a name="l592"><span class="linenum"> 592</span></a>  <span class="comment"> * Get threads SQL</span>
<a name="l593"><span class="linenum"> 593</span></a>  <span class="comment"> *</span>
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment"> * @param array Params</span>
<a name="l595"><span class="linenum"> 595</span></a>  <span class="comment"> * @return Results object</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment"> */</span>
<a name="l597"><span class="linenum"> 597</span></a>  function <a class="function" onClick="logFunction('get_threads_results')" href="../../../_functions/get_threads_results.html" onMouseOver="funcPopup(event,'get_threads_results')">get_threads_results</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l598"><span class="linenum"> 598</span></a>  {
<a name="l599"><span class="linenum"> 599</span></a>      global <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l600"><span class="linenum"> 600</span></a>  
<a name="l601"><span class="linenum"> 601</span></a>  <span class="comment">    // Make sure we are not missing any param:</span>
<a name="l602"><span class="linenum"> 602</span></a>      <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l603"><span class="linenum"> 603</span></a>              'results_param_prefix' =&gt; 'thrd_', // Param prefix for results list
<a name="l604"><span class="linenum"> 604</span></a>              'user_ID' =&gt; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>,    // To limit messages only by this user's ID
<a name="l605"><span class="linenum"> 605</span></a>              'sent_user_ID' =&gt; '',              // To limit messages only for sent by given user ID
<a name="l606"><span class="linenum"> 606</span></a>              'search_word' =&gt; '',               // Filter by this keyword
<a name="l607"><span class="linenum"> 607</span></a>              'search_user' =&gt; '',               // Filter by this user name
<a name="l608"><span class="linenum"> 608</span></a>              'show_closed_threads' =&gt; NULL,     // Show closed conversations
<a name="l609"><span class="linenum"> 609</span></a>              'only_sql' =&gt; false,               // TRUE - to return only SQL object, FALSE - Results object
<a name="l610"><span class="linenum"> 610</span></a>          ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l611"><span class="linenum"> 611</span></a>  
<a name="l612"><span class="linenum"> 612</span></a>  
<a name="l613"><span class="linenum"> 613</span></a>      <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> = '';
<a name="l614"><span class="linenum"> 614</span></a>      if( !empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_word'] ) || !empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_user'] ) || !empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['sent_user_ID'] ) )
<a name="l615"><span class="linenum"> 615</span></a>      {    // We want to filter on search keyword:
<a name="l616"><span class="linenum"> 616</span></a>          <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> = array();
<a name="l617"><span class="linenum"> 617</span></a>          if( !empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_word'] ) )
<a name="l618"><span class="linenum"> 618</span></a>          { // Search by title
<a name="l619"><span class="linenum"> 619</span></a>              <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a>[] = 'thrd_title LIKE &quot;%'.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('escape')" href="../../../_functions/escape.html" onMouseOver="funcPopup(event,'escape')">escape</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_word'] ).'%&quot;';
<a name="l620"><span class="linenum"> 620</span></a>          }
<a name="l621"><span class="linenum"> 621</span></a>          if( !empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_user'] ) )
<a name="l622"><span class="linenum"> 622</span></a>          { // Search by user names
<a name="l623"><span class="linenum"> 623</span></a>  
<a name="l624"><span class="linenum"> 624</span></a>  <span class="comment">            // Get all threads IDs with searching user name</span>
<a name="l625"><span class="linenum"> 625</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l626"><span class="linenum"> 626</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'tsta_thread_ID' );
<a name="l627"><span class="linenum"> 627</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users' );
<a name="l628"><span class="linenum"> 628</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_messaging__threadstatus ON tsta_user_ID = user_ID' );
<a name="l629"><span class="linenum"> 629</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'user_login LIKE &quot;%'.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('escape')" href="../../../_functions/escape.html" onMouseOver="funcPopup(event,'escape')">escape</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_user'] ).'%&quot;' );
<a name="l630"><span class="linenum"> 630</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_or')" href="../../../_functions/where_or.html" onMouseOver="funcPopup(event,'where_or')">WHERE_or</a>( 'user_firstname LIKE &quot;%'.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('escape')" href="../../../_functions/escape.html" onMouseOver="funcPopup(event,'escape')">escape</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_user'] ).'%&quot;' );
<a name="l631"><span class="linenum"> 631</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_or')" href="../../../_functions/where_or.html" onMouseOver="funcPopup(event,'where_or')">WHERE_or</a>( 'user_lastname LIKE &quot;%'.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('escape')" href="../../../_functions/escape.html" onMouseOver="funcPopup(event,'escape')">escape</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_user'] ).'%&quot;' );
<a name="l632"><span class="linenum"> 632</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_or')" href="../../../_functions/where_or.html" onMouseOver="funcPopup(event,'where_or')">WHERE_or</a>( 'user_nickname LIKE &quot;%'.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('escape')" href="../../../_functions/escape.html" onMouseOver="funcPopup(event,'escape')">escape</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['search_user'] ).'%&quot;' );
<a name="l633"><span class="linenum"> 633</span></a>              <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l634"><span class="linenum"> 634</span></a>  
<a name="l635"><span class="linenum"> 635</span></a>              if( empty( <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a> ) )
<a name="l636"><span class="linenum"> 636</span></a>              {    // No found related threads
<a name="l637"><span class="linenum"> 637</span></a>                  <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a>[] = '-1';
<a name="l638"><span class="linenum"> 638</span></a>              }
<a name="l639"><span class="linenum"> 639</span></a>  
<a name="l640"><span class="linenum"> 640</span></a>              <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a>[] = 'tsta_thread_ID IN ( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a> ).' )';
<a name="l641"><span class="linenum"> 641</span></a>          }
<a name="l642"><span class="linenum"> 642</span></a>          if( !empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[ 'sent_user_ID' ] ) )
<a name="l643"><span class="linenum"> 643</span></a>          {
<a name="l644"><span class="linenum"> 644</span></a>  <span class="comment">            // Get all threads IDs with searching user name</span>
<a name="l645"><span class="linenum"> 645</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l646"><span class="linenum"> 646</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'DISTINCT( msg_thread_ID )' );
<a name="l647"><span class="linenum"> 647</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__message' );
<a name="l648"><span class="linenum"> 648</span></a>              <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'msg_author_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[ 'sent_user_ID' ] ) );
<a name="l649"><span class="linenum"> 649</span></a>              <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l650"><span class="linenum"> 650</span></a>  
<a name="l651"><span class="linenum"> 651</span></a>              if( empty( <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a> ) )
<a name="l652"><span class="linenum"> 652</span></a>              {    // No found related threads
<a name="l653"><span class="linenum"> 653</span></a>                  <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a>[] = '-1';
<a name="l654"><span class="linenum"> 654</span></a>              }
<a name="l655"><span class="linenum"> 655</span></a>  
<a name="l656"><span class="linenum"> 656</span></a>              <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a>[] = 'tsta_thread_ID IN ( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it5011" onMouseOver="hilite(5011)" onMouseOut="lolite()" onClick="logVariable('threads_IDs')" href="../../../_variables/threads_IDs.html">$threads_IDs</a> ).' )';
<a name="l657"><span class="linenum"> 657</span></a>          }
<a name="l658"><span class="linenum"> 658</span></a>          <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> = ( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> ) &gt; 0 ) ? <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ' OR ', <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a>) : '';
<a name="l659"><span class="linenum"> 659</span></a>      }
<a name="l660"><span class="linenum"> 660</span></a>  
<a name="l661"><span class="linenum"> 661</span></a>      <a class="var it5012" onMouseOver="hilite(5012)" onMouseOut="lolite()" onClick="logVariable('thrd_msg_ID')" href="../../../_variables/thrd_msg_ID.html">$thrd_msg_ID</a> = <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> ? '&quot;abuse&quot;' : 'tsta_first_unread_msg_ID';
<a name="l662"><span class="linenum"> 662</span></a>  
<a name="l663"><span class="linenum"> 663</span></a>  <span class="comment">    // Create SELECT SQL query</span>
<a name="l664"><span class="linenum"> 664</span></a>      <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l665"><span class="linenum"> 665</span></a>      <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'thrd_ID, thrd_title, thrd_datemodified, '.<a class="var it5012" onMouseOver="hilite(5012)" onMouseOut="lolite()" onClick="logVariable('thrd_msg_ID')" href="../../../_variables/thrd_msg_ID.html">$thrd_msg_ID</a>.' AS thrd_msg_ID, tsta_thread_leave_msg_ID, msg_datetime AS thrd_unread_since' );
<a name="l666"><span class="linenum"> 666</span></a>      <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus' );
<a name="l667"><span class="linenum"> 667</span></a>      <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_messaging__thread ON tsta_thread_ID = thrd_ID' );
<a name="l668"><span class="linenum"> 668</span></a>      <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'LEFT OUTER JOIN T_messaging__message ON tsta_first_unread_msg_ID = msg_ID' );
<a name="l669"><span class="linenum"> 669</span></a>      if( ! <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> )
<a name="l670"><span class="linenum"> 670</span></a>      { // Limit threads by current user
<a name="l671"><span class="linenum"> 671</span></a>          <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'tsta_user_ID = '.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_ID'] );
<a name="l672"><span class="linenum"> 672</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['show_closed_threads'] === NULL )
<a name="l673"><span class="linenum"> 673</span></a>          { // Explicit param value was not set, use the default
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment">            // Show closed messages by default only if there are unread messages in closed conversations</span>
<a name="l675"><span class="linenum"> 675</span></a>              <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['show_closed_threads'] = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>(
<a name="l676"><span class="linenum"> 676</span></a>                  'SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( tsta_thread_ID )
<a name="l677"><span class="linenum"> 677</span></a>                      FROM T_messaging__threadstatus
<a name="l678"><span class="linenum"> 678</span></a>                      WHERE tsta_thread_leave_msg_ID IS NOT NULL AND tsta_first_unread_msg_ID IS NOT NULL
<a name="l679"><span class="linenum"> 679</span></a>                      AND tsta_first_unread_msg_ID &lt;= tsta_thread_leave_msg_ID AND tsta_user_ID = '.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_ID']
<a name="l680"><span class="linenum"> 680</span></a>              );
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">            // Set 'show_closed' param value, so the checkobx filter can be displayed correctly</span>
<a name="l682"><span class="linenum"> 682</span></a>              <a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( 'show_closed', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['show_closed_threads'] ? true : false );
<a name="l683"><span class="linenum"> 683</span></a>          }
<a name="l684"><span class="linenum"> 684</span></a>          if( ! <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['show_closed_threads'] )
<a name="l685"><span class="linenum"> 685</span></a>          { // Don't show the closed conversations
<a name="l686"><span class="linenum"> 686</span></a>              <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( '( tsta_thread_leave_msg_ID IS NULL )' );
<a name="l687"><span class="linenum"> 687</span></a>          }
<a name="l688"><span class="linenum"> 688</span></a>      }
<a name="l689"><span class="linenum"> 689</span></a>      if( !empty( <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> ) )
<a name="l690"><span class="linenum"> 690</span></a>      {    // Filter
<a name="l691"><span class="linenum"> 691</span></a>          <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> );
<a name="l692"><span class="linenum"> 692</span></a>      }
<a name="l693"><span class="linenum"> 693</span></a>      <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'tsta_first_unread_msg_ID DESC, thrd_datemodified DESC' );
<a name="l694"><span class="linenum"> 694</span></a>      if( <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> )
<a name="l695"><span class="linenum"> 695</span></a>      {
<a name="l696"><span class="linenum"> 696</span></a>          <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('GROUP_BY')" href="../../../_functions/group_by.html" onMouseOver="funcPopup(event,'group_by')">GROUP_BY</a>( 'tsta_thread_ID' );
<a name="l697"><span class="linenum"> 697</span></a>      }
<a name="l698"><span class="linenum"> 698</span></a>  
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">    // Create COUNT SQL query</span>
<a name="l700"><span class="linenum"> 700</span></a>      <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l701"><span class="linenum"> 701</span></a>      <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( DISTINCT tsta_thread_ID )' );
<a name="l702"><span class="linenum"> 702</span></a>      <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus' );
<a name="l703"><span class="linenum"> 703</span></a>      if( ! empty( <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> ) )
<a name="l704"><span class="linenum"> 704</span></a>      { // Filter
<a name="l705"><span class="linenum"> 705</span></a>          <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_messaging__thread ON tsta_thread_ID = thrd_ID' );
<a name="l706"><span class="linenum"> 706</span></a>      }
<a name="l707"><span class="linenum"> 707</span></a>      if( ! <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> )
<a name="l708"><span class="linenum"> 708</span></a>      { // Limit threads by current user
<a name="l709"><span class="linenum"> 709</span></a>          <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'tsta_user_ID = '.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_ID'] );
<a name="l710"><span class="linenum"> 710</span></a>          if( ! <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['show_closed_threads'] )
<a name="l711"><span class="linenum"> 711</span></a>          { // Don't show the closed conversations
<a name="l712"><span class="linenum"> 712</span></a>              <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( '( tsta_thread_leave_msg_ID IS NULL )' );
<a name="l713"><span class="linenum"> 713</span></a>          }
<a name="l714"><span class="linenum"> 714</span></a>      }
<a name="l715"><span class="linenum"> 715</span></a>      if( !empty( <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> ) )
<a name="l716"><span class="linenum"> 716</span></a>      { // Filter
<a name="l717"><span class="linenum"> 717</span></a>          <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( <a class="var it5009" onMouseOver="hilite(5009)" onMouseOut="lolite()" onClick="logVariable('filter_sql')" href="../../../_variables/filter_sql.html">$filter_sql</a> );
<a name="l718"><span class="linenum"> 718</span></a>      }
<a name="l719"><span class="linenum"> 719</span></a>  
<a name="l720"><span class="linenum"> 720</span></a>      if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['only_sql'] )
<a name="l721"><span class="linenum"> 721</span></a>      { // Return only SQL object
<a name="l722"><span class="linenum"> 722</span></a>          return <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>;
<a name="l723"><span class="linenum"> 723</span></a>      }
<a name="l724"><span class="linenum"> 724</span></a>  
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">    // Create result set:</span>
<a name="l726"><span class="linenum"> 726</span></a>      <a class="var it110" onMouseOver="hilite(110)" onMouseOut="lolite()" onClick="logVariable('Results')" href="../../../_variables/Results.html">$Results</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Results')" href="../../../_classes/results.html" onMouseOver="classPopup(event,'results')">Results</a>( <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>(), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['results_param_prefix'], '', NULL, <a class="var it109" onMouseOver="hilite(109)" onMouseOut="lolite()" onClick="logVariable('count_SQL')" href="../../../_variables/count_SQL.html">$count_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l727"><span class="linenum"> 727</span></a>  
<a name="l728"><span class="linenum"> 728</span></a>      return <a class="var it110" onMouseOver="hilite(110)" onMouseOut="lolite()" onClick="logVariable('Results')" href="../../../_variables/Results.html">$Results</a>;
<a name="l729"><span class="linenum"> 729</span></a>  }
<a name="l730"><span class="linenum"> 730</span></a>  
<a name="l731"><span class="linenum"> 731</span></a>  
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment">/**</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment"> * Insert user to contacts</span>
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment"> *</span>
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment"> * @param integer User ID</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment"> * @param boolean set true to add as a blocked contact</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment"> * @return true if success, else false</span>
<a name="l738"><span class="linenum"> 738</span></a>  <span class="comment"> */</span>
<a name="l739"><span class="linenum"> 739</span></a>  function <a class="function" onClick="logFunction('create_contacts_user')" href="../../../_functions/create_contacts_user.html" onMouseOver="funcPopup(event,'create_contacts_user')">create_contacts_user</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> = false )
<a name="l740"><span class="linenum"> 740</span></a>  {
<a name="l741"><span class="linenum"> 741</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l742"><span class="linenum"> 742</span></a>  
<a name="l743"><span class="linenum"> 743</span></a>      <a class="var it5013" onMouseOver="hilite(5013)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../../../_variables/contact.html">$contact</a> = <a class="function" onClick="logFunction('check_contact')" href="../../../_functions/check_contact.html" onMouseOver="funcPopup(event,'check_contact')">check_contact</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l744"><span class="linenum"> 744</span></a>      if( !<a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it5013" onMouseOver="hilite(5013)" onMouseOut="lolite()" onClick="logVariable('contact')" href="../../../_variables/contact.html">$contact</a> ) )
<a name="l745"><span class="linenum"> 745</span></a>      { // This user already exists in the contact list for current user
<a name="l746"><span class="linenum"> 746</span></a>          return true;
<a name="l747"><span class="linenum"> 747</span></a>      }
<a name="l748"><span class="linenum"> 748</span></a>  
<a name="l749"><span class="linenum"> 749</span></a>      <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> );
<a name="l750"><span class="linenum"> 750</span></a>      <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> = <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> ? 1 : 0;
<a name="l751"><span class="linenum"> 751</span></a>  
<a name="l752"><span class="linenum"> 752</span></a>      <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_messaging__contact
<a name="l753"><span class="linenum"> 753</span></a>                 ( mct_from_user_ID, mct_to_user_ID, mct_blocked, mct_last_contact_datetime )
<a name="l754"><span class="linenum"> 754</span></a>          VALUES ( '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', '.<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>.', '.<a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> ).' )';
<a name="l755"><span class="linenum"> 755</span></a>  
<a name="l756"><span class="linenum"> 756</span></a>      return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert contacts' );
<a name="l757"><span class="linenum"> 757</span></a>  }
<a name="l758"><span class="linenum"> 758</span></a>  
<a name="l759"><span class="linenum"> 759</span></a>  
<a name="l760"><span class="linenum"> 760</span></a>  <span class="comment">/**</span>
<a name="l761"><span class="linenum"> 761</span></a>  <span class="comment"> * Insert contacts group into database</span>
<a name="l762"><span class="linenum"> 762</span></a>  <span class="comment"> *</span>
<a name="l763"><span class="linenum"> 763</span></a>  <span class="comment"> * @param string Group name</span>
<a name="l764"><span class="linenum"> 764</span></a>  <span class="comment"> * @return integer Group ID if success, else false</span>
<a name="l765"><span class="linenum"> 765</span></a>  <span class="comment"> */</span>
<a name="l766"><span class="linenum"> 766</span></a>  function <a class="function" onClick="logFunction('create_contacts_group')" href="../../../_functions/create_contacts_group.html" onMouseOver="funcPopup(event,'create_contacts_group')">create_contacts_group</a>( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> )
<a name="l767"><span class="linenum"> 767</span></a>  {
<a name="l768"><span class="linenum"> 768</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l769"><span class="linenum"> 769</span></a>  
<a name="l770"><span class="linenum"> 770</span></a>      if( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> != '' )
<a name="l771"><span class="linenum"> 771</span></a>      {    // Check <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a> name for duplicates
<a name="l772"><span class="linenum"> 772</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l773"><span class="linenum"> 773</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgr_ID' );
<a name="l774"><span class="linenum"> 774</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l775"><span class="linenum"> 775</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l776"><span class="linenum"> 776</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgr_name = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> ) );
<a name="l777"><span class="linenum"> 777</span></a>  
<a name="l778"><span class="linenum"> 778</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l779"><span class="linenum"> 779</span></a>          if( !<a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> ) )
<a name="l780"><span class="linenum"> 780</span></a>          {    // Duplicate group
<a name="l781"><span class="linenum"> 781</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You already have a group with this name.'), 'error' );
<a name="l782"><span class="linenum"> 782</span></a>          }
<a name="l783"><span class="linenum"> 783</span></a>      }
<a name="l784"><span class="linenum"> 784</span></a>  
<a name="l785"><span class="linenum"> 785</span></a>      if( <a class="function" onClick="logFunction('param_errors_detected')" href="../../../_functions/param_errors_detected.html" onMouseOver="funcPopup(event,'param_errors_detected')">param_errors_detected</a>() )
<a name="l786"><span class="linenum"> 786</span></a>      {    // Errors exist, Exit here
<a name="l787"><span class="linenum"> 787</span></a>          return false;
<a name="l788"><span class="linenum"> 788</span></a>      }
<a name="l789"><span class="linenum"> 789</span></a>  
<a name="l790"><span class="linenum"> 790</span></a>      <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_messaging__contact_groups
<a name="l791"><span class="linenum"> 791</span></a>                   ( cgr_user_ID, cgr_name )
<a name="l792"><span class="linenum"> 792</span></a>          VALUES ( '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> ).' )';
<a name="l793"><span class="linenum"> 793</span></a>  
<a name="l794"><span class="linenum"> 794</span></a>      if( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert contacts group' ) )
<a name="l795"><span class="linenum"> 795</span></a>      {    // Success query, Return ID of <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a>
<a name="l796"><span class="linenum"> 796</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('insert_id')" class="var it10754" onMouseOver="hilite(10754)" onMouseOut="lolite()" href="../../../_variables/insert_id.html">insert_id</a>;
<a name="l797"><span class="linenum"> 797</span></a>      }
<a name="l798"><span class="linenum"> 798</span></a>      else
<a name="l799"><span class="linenum"> 799</span></a>      {    // Failed query
<a name="l800"><span class="linenum"> 800</span></a>          return false;
<a name="l801"><span class="linenum"> 801</span></a>      }
<a name="l802"><span class="linenum"> 802</span></a>  }
<a name="l803"><span class="linenum"> 803</span></a>  
<a name="l804"><span class="linenum"> 804</span></a>  
<a name="l805"><span class="linenum"> 805</span></a>  <span class="comment">/**</span>
<a name="l806"><span class="linenum"> 806</span></a>  <span class="comment"> * Rename contacts group</span>
<a name="l807"><span class="linenum"> 807</span></a>  <span class="comment"> *</span>
<a name="l808"><span class="linenum"> 808</span></a>  <span class="comment"> * @param integer Group ID</span>
<a name="l809"><span class="linenum"> 809</span></a>  <span class="comment"> * @param string Name of input with new group name</span>
<a name="l810"><span class="linenum"> 810</span></a>  <span class="comment"> * @return boolean TRUE if group was renamed successfully</span>
<a name="l811"><span class="linenum"> 811</span></a>  <span class="comment"> */</span>
<a name="l812"><span class="linenum"> 812</span></a>  function <a class="function" onClick="logFunction('rename_contacts_group')" href="../../../_functions/rename_contacts_group.html" onMouseOver="funcPopup(event,'rename_contacts_group')">rename_contacts_group</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>, <a class="var it2108" onMouseOver="hilite(2108)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../../_variables/field_name.html">$field_name</a> = 'name' )
<a name="l813"><span class="linenum"> 813</span></a>  {
<a name="l814"><span class="linenum"> 814</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l815"><span class="linenum"> 815</span></a>  
<a name="l816"><span class="linenum"> 816</span></a>      <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( <a class="var it2108" onMouseOver="hilite(2108)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../../_variables/field_name.html">$field_name</a>, 'string', '' );
<a name="l817"><span class="linenum"> 817</span></a>      <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( <a class="var it2108" onMouseOver="hilite(2108)" onMouseOut="lolite()" onClick="logVariable('field_name')" href="../../../_variables/field_name.html">$field_name</a>, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter group name') );
<a name="l818"><span class="linenum"> 818</span></a>  
<a name="l819"><span class="linenum"> 819</span></a>  <span class="comment">    // Check if user is owner of this group</span>
<a name="l820"><span class="linenum"> 820</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l821"><span class="linenum"> 821</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgr_ID' );
<a name="l822"><span class="linenum"> 822</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l823"><span class="linenum"> 823</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l824"><span class="linenum"> 824</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ) );
<a name="l825"><span class="linenum"> 825</span></a>  
<a name="l826"><span class="linenum"> 826</span></a>      if( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) == NULL )
<a name="l827"><span class="linenum"> 827</span></a>      {
<a name="l828"><span class="linenum"> 828</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'You don\'t have this group', 'error' );
<a name="l829"><span class="linenum"> 829</span></a>          return false;
<a name="l830"><span class="linenum"> 830</span></a>      }
<a name="l831"><span class="linenum"> 831</span></a>  
<a name="l832"><span class="linenum"> 832</span></a>  <span class="comment">    // Rename a group</span>
<a name="l833"><span class="linenum"> 833</span></a>      <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'UPDATE T_messaging__contact_groups
<a name="l834"><span class="linenum"> 834</span></a>            SET cgr_name = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it164" onMouseOver="hilite(164)" onMouseOut="lolite()" onClick="logVariable('name')" href="../../../_variables/name.html">$name</a> ).'
<a name="l835"><span class="linenum"> 835</span></a>          WHERE cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ).'
<a name="l836"><span class="linenum"> 836</span></a>            AND cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l837"><span class="linenum"> 837</span></a>  
<a name="l838"><span class="linenum"> 838</span></a>      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Rename contacts group' );
<a name="l839"><span class="linenum"> 839</span></a>  
<a name="l840"><span class="linenum"> 840</span></a>      return true;
<a name="l841"><span class="linenum"> 841</span></a>  }
<a name="l842"><span class="linenum"> 842</span></a>  
<a name="l843"><span class="linenum"> 843</span></a>  
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">/**</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment"> * Delete contacts group</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment"> *</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment"> * @param integer Group ID</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment"> * @return boolean TRUE if group was renamed successfully</span>
<a name="l849"><span class="linenum"> 849</span></a>  <span class="comment"> */</span>
<a name="l850"><span class="linenum"> 850</span></a>  function <a class="function" onClick="logFunction('delete_contacts_group')" href="../../../_functions/delete_contacts_group.html" onMouseOver="funcPopup(event,'delete_contacts_group')">delete_contacts_group</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> )
<a name="l851"><span class="linenum"> 851</span></a>  {
<a name="l852"><span class="linenum"> 852</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l853"><span class="linenum"> 853</span></a>  
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">    // Check if user is owner of this group</span>
<a name="l855"><span class="linenum"> 855</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l856"><span class="linenum"> 856</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgr_ID' );
<a name="l857"><span class="linenum"> 857</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l858"><span class="linenum"> 858</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l859"><span class="linenum"> 859</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ) );
<a name="l860"><span class="linenum"> 860</span></a>  
<a name="l861"><span class="linenum"> 861</span></a>      if( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) == NULL )
<a name="l862"><span class="linenum"> 862</span></a>      {
<a name="l863"><span class="linenum"> 863</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'You don\'t have this group', 'error' );
<a name="l864"><span class="linenum"> 864</span></a>          return false;
<a name="l865"><span class="linenum"> 865</span></a>      }
<a name="l866"><span class="linenum"> 866</span></a>  
<a name="l867"><span class="linenum"> 867</span></a>  <span class="comment">    // Delete a group</span>
<a name="l868"><span class="linenum"> 868</span></a>      <a class="var it5014" onMouseOver="hilite(5014)" onMouseOut="lolite()" onClick="logVariable('sql_groups')" href="../../../_variables/sql_groups.html">$sql_groups</a> = 'DELETE FROM T_messaging__contact_groups
<a name="l869"><span class="linenum"> 869</span></a>          WHERE cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ).'
<a name="l870"><span class="linenum"> 870</span></a>            AND cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l871"><span class="linenum"> 871</span></a>      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it5014" onMouseOver="hilite(5014)" onMouseOut="lolite()" onClick="logVariable('sql_groups')" href="../../../_variables/sql_groups.html">$sql_groups</a>, 'Delete contacts group' );
<a name="l872"><span class="linenum"> 872</span></a>  
<a name="l873"><span class="linenum"> 873</span></a>  <span class="comment">    // Delete users from this group</span>
<a name="l874"><span class="linenum"> 874</span></a>      <a class="var it5015" onMouseOver="hilite(5015)" onMouseOut="lolite()" onClick="logVariable('sql_users')" href="../../../_variables/sql_users.html">$sql_users</a> = 'DELETE FROM T_messaging__contact_groupusers
<a name="l875"><span class="linenum"> 875</span></a>          WHERE cgu_cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> );
<a name="l876"><span class="linenum"> 876</span></a>      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it5015" onMouseOver="hilite(5015)" onMouseOut="lolite()" onClick="logVariable('sql_users')" href="../../../_variables/sql_users.html">$sql_users</a>, 'Delete users from contacts group' );
<a name="l877"><span class="linenum"> 877</span></a>  
<a name="l878"><span class="linenum"> 878</span></a>      return true;
<a name="l879"><span class="linenum"> 879</span></a>  }
<a name="l880"><span class="linenum"> 880</span></a>  
<a name="l881"><span class="linenum"> 881</span></a>  
<a name="l882"><span class="linenum"> 882</span></a>  <span class="comment">/**</span>
<a name="l883"><span class="linenum"> 883</span></a>  <span class="comment"> * Insert users for contacts group into database</span>
<a name="l884"><span class="linenum"> 884</span></a>  <span class="comment"> *</span>
<a name="l885"><span class="linenum"> 885</span></a>  <span class="comment"> * @param integer/string Group ID or 'new'</span>
<a name="l886"><span class="linenum"> 886</span></a>  <span class="comment"> * @param string Users IDs separated with comma</span>
<a name="l887"><span class="linenum"> 887</span></a>  <span class="comment"> * @param string Name of input element with new group name</span>
<a name="l888"><span class="linenum"> 888</span></a>  <span class="comment"> * @return array/boolean Array( 'count_users', 'group_name' ) if success, else false</span>
<a name="l889"><span class="linenum"> 889</span></a>  <span class="comment"> */</span>
<a name="l890"><span class="linenum"> 890</span></a>  function <a class="function" onClick="logFunction('create_contacts_group_users')" href="../../../_functions/create_contacts_group_users.html" onMouseOver="funcPopup(event,'create_contacts_group_users')">create_contacts_group_users</a>( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>, <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a>, <a class="var it5016" onMouseOver="hilite(5016)" onMouseOut="lolite()" onClick="logVariable('new_group_field_name')" href="../../../_variables/new_group_field_name.html">$new_group_field_name</a> = 'group_combo' )
<a name="l891"><span class="linenum"> 891</span></a>  {
<a name="l892"><span class="linenum"> 892</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l893"><span class="linenum"> 893</span></a>  
<a name="l894"><span class="linenum"> 894</span></a>      <a class="var it3681" onMouseOver="hilite(3681)" onMouseOut="lolite()" onClick="logVariable('users_IDs')" href="../../../_variables/users_IDs.html">$users_IDs</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( ',', <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a> );
<a name="l895"><span class="linenum"> 895</span></a>      if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it3681" onMouseOver="hilite(3681)" onMouseOut="lolite()" onClick="logVariable('users_IDs')" href="../../../_variables/users_IDs.html">$users_IDs</a> ) == 0 || strlen( <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a> ) == 0 )
<a name="l896"><span class="linenum"> 896</span></a>      {    // No selected users
<a name="l897"><span class="linenum"> 897</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select at least one user.'), 'error' );
<a name="l898"><span class="linenum"> 898</span></a>          return false;
<a name="l899"><span class="linenum"> 899</span></a>      }
<a name="l900"><span class="linenum"> 900</span></a>  
<a name="l901"><span class="linenum"> 901</span></a>      if( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> == 'new' || (int)<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> &lt; 0 )
<a name="l902"><span class="linenum"> 902</span></a>      {    // Add <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a>
<a name="l903"><span class="linenum"> 903</span></a>          if( (int)<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> &lt; 0 )
<a name="l904"><span class="linenum"> 904</span></a>          {    // Default group
<a name="l905"><span class="linenum"> 905</span></a>              <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a> = <a class="function" onClick="logFunction('get_contacts_groups_default')" href="../../../_functions/get_contacts_groups_default.html" onMouseOver="funcPopup(event,'get_contacts_groups_default')">get_contacts_groups_default</a>();
<a name="l906"><span class="linenum"> 906</span></a>              if( isset( <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a>[<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>] ) )
<a name="l907"><span class="linenum"> 907</span></a>              {    // Get group name
<a name="l908"><span class="linenum"> 908</span></a>                  <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> = <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a>[<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>];
<a name="l909"><span class="linenum"> 909</span></a>              }
<a name="l910"><span class="linenum"> 910</span></a>              else
<a name="l911"><span class="linenum"> 911</span></a>              {    // Error
<a name="l912"><span class="linenum"> 912</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'No found this group.', 'error' );
<a name="l913"><span class="linenum"> 913</span></a>                  return false;
<a name="l914"><span class="linenum"> 914</span></a>              }
<a name="l915"><span class="linenum"> 915</span></a>          }
<a name="l916"><span class="linenum"> 916</span></a>          else
<a name="l917"><span class="linenum"> 917</span></a>          {    // New entered group
<a name="l918"><span class="linenum"> 918</span></a>              <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( <a class="var it5016" onMouseOver="hilite(5016)" onMouseOut="lolite()" onClick="logVariable('new_group_field_name')" href="../../../_variables/new_group_field_name.html">$new_group_field_name</a>, 'string', true );
<a name="l919"><span class="linenum"> 919</span></a>              <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( <a class="var it5016" onMouseOver="hilite(5016)" onMouseOut="lolite()" onClick="logVariable('new_group_field_name')" href="../../../_variables/new_group_field_name.html">$new_group_field_name</a>, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter name for <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a>.') );
<a name="l920"><span class="linenum"> 920</span></a>          }
<a name="l921"><span class="linenum"> 921</span></a>  
<a name="l922"><span class="linenum"> 922</span></a>          if( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> = <a class="function" onClick="logFunction('create_contacts_group')" href="../../../_functions/create_contacts_group.html" onMouseOver="funcPopup(event,'create_contacts_group')">create_contacts_group</a>( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> ) )
<a name="l923"><span class="linenum"> 923</span></a>          {    // Create group
<a name="l924"><span class="linenum"> 924</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('New contacts group has been created.'), 'success' );
<a name="l925"><span class="linenum"> 925</span></a>          }
<a name="l926"><span class="linenum"> 926</span></a>          else
<a name="l927"><span class="linenum"> 927</span></a>          {    // Errors
<a name="l928"><span class="linenum"> 928</span></a>              return false;
<a name="l929"><span class="linenum"> 929</span></a>          }
<a name="l930"><span class="linenum"> 930</span></a>      }
<a name="l931"><span class="linenum"> 931</span></a>      else
<a name="l932"><span class="linenum"> 932</span></a>      {    // Existing group
<a name="l933"><span class="linenum"> 933</span></a>          <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> = (int)<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>;
<a name="l934"><span class="linenum"> 934</span></a>  
<a name="l935"><span class="linenum"> 935</span></a>          if( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> == 0 )
<a name="l936"><span class="linenum"> 936</span></a>          {    // No defined group ID
<a name="l937"><span class="linenum"> 937</span></a>              return false;
<a name="l938"><span class="linenum"> 938</span></a>          }
<a name="l939"><span class="linenum"> 939</span></a>  
<a name="l940"><span class="linenum"> 940</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l941"><span class="linenum"> 941</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgr_name AS name' );
<a name="l942"><span class="linenum"> 942</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l943"><span class="linenum"> 943</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l944"><span class="linenum"> 944</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ) );
<a name="l945"><span class="linenum"> 945</span></a>  
<a name="l946"><span class="linenum"> 946</span></a>          <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l947"><span class="linenum"> 947</span></a>          if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> ) )
<a name="l948"><span class="linenum"> 948</span></a>          {    // User try use a group of another user
<a name="l949"><span class="linenum"> 949</span></a>              return false;
<a name="l950"><span class="linenum"> 950</span></a>          }
<a name="l951"><span class="linenum"> 951</span></a>          <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> = <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('name')" class="var it10870" onMouseOver="hilite(10870)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>;
<a name="l952"><span class="linenum"> 952</span></a>      }
<a name="l953"><span class="linenum"> 953</span></a>  
<a name="l954"><span class="linenum"> 954</span></a>  <span class="comment">    // Get all Users IDs of selected group in order to exclude duplicates</span>
<a name="l955"><span class="linenum"> 955</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l956"><span class="linenum"> 956</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgu_user_ID, cgu_cgr_ID' );
<a name="l957"><span class="linenum"> 957</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groupusers' );
<a name="l958"><span class="linenum"> 958</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgu_cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ) );
<a name="l959"><span class="linenum"> 959</span></a>      <a class="var it5018" onMouseOver="hilite(5018)" onMouseOut="lolite()" onClick="logVariable('users_already_grouped')" href="../../../_variables/users_already_grouped.html">$users_already_grouped</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l960"><span class="linenum"> 960</span></a>  
<a name="l961"><span class="linenum"> 961</span></a>      <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_messaging__contact_groupusers ( cgu_user_ID, cgu_cgr_ID ) VALUES ';
<a name="l962"><span class="linenum"> 962</span></a>  
<a name="l963"><span class="linenum"> 963</span></a>      <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = array();
<a name="l964"><span class="linenum"> 964</span></a>      foreach( <a class="var it3681" onMouseOver="hilite(3681)" onMouseOut="lolite()" onClick="logVariable('users_IDs')" href="../../../_variables/users_IDs.html">$users_IDs</a> as <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l965"><span class="linenum"> 965</span></a>      {
<a name="l966"><span class="linenum"> 966</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> = (int)<a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l967"><span class="linenum"> 967</span></a>          if( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> == 0 )
<a name="l968"><span class="linenum"> 968</span></a>          {    // User ID is empty
<a name="l969"><span class="linenum"> 969</span></a>              continue;
<a name="l970"><span class="linenum"> 970</span></a>          }
<a name="l971"><span class="linenum"> 971</span></a>          else if( isset( <a class="var it5018" onMouseOver="hilite(5018)" onMouseOut="lolite()" onClick="logVariable('users_already_grouped')" href="../../../_variables/users_already_grouped.html">$users_already_grouped</a>[<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>] ) )
<a name="l972"><span class="linenum"> 972</span></a>          {
<a name="l973"><span class="linenum"> 973</span></a>              if( <a class="var it5018" onMouseOver="hilite(5018)" onMouseOut="lolite()" onClick="logVariable('users_already_grouped')" href="../../../_variables/users_already_grouped.html">$users_already_grouped</a>[<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>] == <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> )
<a name="l974"><span class="linenum"> 974</span></a>              {    // This user already is added in selected group
<a name="l975"><span class="linenum"> 975</span></a>                  continue;
<a name="l976"><span class="linenum"> 976</span></a>              }
<a name="l977"><span class="linenum"> 977</span></a>          }
<a name="l978"><span class="linenum"> 978</span></a>          <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a>[] = '( '.<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ).' )';
<a name="l979"><span class="linenum"> 979</span></a>      }
<a name="l980"><span class="linenum"> 980</span></a>      <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> .= <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> );
<a name="l981"><span class="linenum"> 981</span></a>  
<a name="l982"><span class="linenum"> 982</span></a>      if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> ) == 0 )
<a name="l983"><span class="linenum"> 983</span></a>      {    // No data to add
<a name="l984"><span class="linenum"> 984</span></a>          return false;
<a name="l985"><span class="linenum"> 985</span></a>      }
<a name="l986"><span class="linenum"> 986</span></a>  
<a name="l987"><span class="linenum"> 987</span></a>      if( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert users for contacts group' ) )
<a name="l988"><span class="linenum"> 988</span></a>      {    // Success query
<a name="l989"><span class="linenum"> 989</span></a>          return array(
<a name="l990"><span class="linenum"> 990</span></a>              'count_users' =&gt; <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> ),
<a name="l991"><span class="linenum"> 991</span></a>              'group_name'  =&gt; <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> );
<a name="l992"><span class="linenum"> 992</span></a>      }
<a name="l993"><span class="linenum"> 993</span></a>      else
<a name="l994"><span class="linenum"> 994</span></a>      {    // Failed query
<a name="l995"><span class="linenum"> 995</span></a>          return false;
<a name="l996"><span class="linenum"> 996</span></a>      }
<a name="l997"><span class="linenum"> 997</span></a>  }
<a name="l998"><span class="linenum"> 998</span></a>  
<a name="l999"><span class="linenum"> 999</span></a>  
<a name="l1000"><span class="linenum">1000</span></a>  <span class="comment">/**</span>
<a name="l1001"><span class="linenum">1001</span></a>  <span class="comment"> * Remove user from contacts group</span>
<a name="l1002"><span class="linenum">1002</span></a>  <span class="comment"> *</span>
<a name="l1003"><span class="linenum">1003</span></a>  <span class="comment"> * @param integer/string Group ID or 'new'</span>
<a name="l1004"><span class="linenum">1004</span></a>  <span class="comment"> * @param string Users IDs separated with comma</span>
<a name="l1005"><span class="linenum">1005</span></a>  <span class="comment"> * @param string Name of input element with new group name</span>
<a name="l1006"><span class="linenum">1006</span></a>  <span class="comment"> * @return boolean true if success</span>
<a name="l1007"><span class="linenum">1007</span></a>  <span class="comment"> */</span>
<a name="l1008"><span class="linenum">1008</span></a>  function <a class="function" onClick="logFunction('remove_contacts_group_user')" href="../../../_functions/remove_contacts_group_user.html" onMouseOver="funcPopup(event,'remove_contacts_group_user')">remove_contacts_group_user</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l1009"><span class="linenum">1009</span></a>  {
<a name="l1010"><span class="linenum">1010</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l1011"><span class="linenum">1011</span></a>  
<a name="l1012"><span class="linenum">1012</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1013"><span class="linenum">1013</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgr_name AS name' );
<a name="l1014"><span class="linenum">1014</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l1015"><span class="linenum">1015</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'LEFT JOIN T_messaging__contact_groupusers ON cgr_ID = cgu_cgr_ID' );
<a name="l1016"><span class="linenum">1016</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1017"><span class="linenum">1017</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgu_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) );
<a name="l1018"><span class="linenum">1018</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgu_cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ) );
<a name="l1019"><span class="linenum">1019</span></a>  
<a name="l1020"><span class="linenum">1020</span></a>      <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1021"><span class="linenum">1021</span></a>      if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> ) )
<a name="l1022"><span class="linenum">1022</span></a>      {    // User try use a group of another user
<a name="l1023"><span class="linenum">1023</span></a>          return false;
<a name="l1024"><span class="linenum">1024</span></a>      }
<a name="l1025"><span class="linenum">1025</span></a>  
<a name="l1026"><span class="linenum">1026</span></a>      <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'DELETE FROM T_messaging__contact_groupusers
<a name="l1027"><span class="linenum">1027</span></a>          WHERE cgu_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ).'
<a name="l1028"><span class="linenum">1028</span></a>            AND cgu_cgr_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> );
<a name="l1029"><span class="linenum">1029</span></a>  
<a name="l1030"><span class="linenum">1030</span></a>      if( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Remove user from contacts group' ) )
<a name="l1031"><span class="linenum">1031</span></a>      {    // Success query
<a name="l1032"><span class="linenum">1032</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l1033"><span class="linenum">1033</span></a>          <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a> = &amp; <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_ID( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l1034"><span class="linenum">1034</span></a>  
<a name="l1035"><span class="linenum">1035</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('User &amp;laquo;%s&amp;raquo; has been removed from the &amp;laquo;%s&amp;raquo; group.'), <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a class="function" onClick="logFunction('get_preferred_name')" href="../../../_functions/get_preferred_name.html" onMouseOver="funcPopup(event,'get_preferred_name')">get_preferred_name</a>(), <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>-&gt;<a onClick="logVariable('name')" class="var it10870" onMouseOver="hilite(10870)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a> ), 'success' );
<a name="l1036"><span class="linenum">1036</span></a>          return true;
<a name="l1037"><span class="linenum">1037</span></a>      }
<a name="l1038"><span class="linenum">1038</span></a>      else
<a name="l1039"><span class="linenum">1039</span></a>      {    // Failed query
<a name="l1040"><span class="linenum">1040</span></a>          return false;
<a name="l1041"><span class="linenum">1041</span></a>      }
<a name="l1042"><span class="linenum">1042</span></a>  }
<a name="l1043"><span class="linenum">1043</span></a>  
<a name="l1044"><span class="linenum">1044</span></a>  
<a name="l1045"><span class="linenum">1045</span></a>  <span class="comment">/**</span>
<a name="l1046"><span class="linenum">1046</span></a>  <span class="comment"> * Update contact groups for user in database</span>
<a name="l1047"><span class="linenum">1047</span></a>  <span class="comment"> *</span>
<a name="l1048"><span class="linenum">1048</span></a>  <span class="comment"> * @param string Users ID</span>
<a name="l1049"><span class="linenum">1049</span></a>  <span class="comment"> * @param array Group IDs</span>
<a name="l1050"><span class="linenum">1050</span></a>  <span class="comment"> * @param boolean TRUE to block the contact, FALSE to unblock, NULL to don't touch the contact block status</span>
<a name="l1051"><span class="linenum">1051</span></a>  <span class="comment"> * @return boolean TRUE if success, else FALSE</span>
<a name="l1052"><span class="linenum">1052</span></a>  <span class="comment"> */</span>
<a name="l1053"><span class="linenum">1053</span></a>  function <a class="function" onClick="logFunction('update_contacts_groups_user')" href="../../../_functions/update_contacts_groups_user.html" onMouseOver="funcPopup(event,'update_contacts_groups_user')">update_contacts_groups_user</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a>, <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> = NULL )
<a name="l1054"><span class="linenum">1054</span></a>  {
<a name="l1055"><span class="linenum">1055</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l1056"><span class="linenum">1056</span></a>  
<a name="l1057"><span class="linenum">1057</span></a>      if( empty( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) )
<a name="l1058"><span class="linenum">1058</span></a>      { // No selected user
<a name="l1059"><span class="linenum">1059</span></a>          return false;
<a name="l1060"><span class="linenum">1060</span></a>      }
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>      if( <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> !== NULL )
<a name="l1063"><span class="linenum">1063</span></a>      { // Update the contact block status
<a name="l1064"><span class="linenum">1064</span></a>          <a class="function" onClick="logFunction('set_contact_blocked')" href="../../../_functions/set_contact_blocked.html" onMouseOver="funcPopup(event,'set_contact_blocked')">set_contact_blocked</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it4984" onMouseOver="hilite(4984)" onMouseOut="lolite()" onClick="logVariable('blocked')" href="../../../_variables/blocked.html">$blocked</a> ) );
<a name="l1065"><span class="linenum">1065</span></a>      }
<a name="l1066"><span class="linenum">1066</span></a>  
<a name="l1067"><span class="linenum">1067</span></a>      <a class="var it5020" onMouseOver="hilite(5020)" onMouseOut="lolite()" onClick="logVariable('insert_sql')" href="../../../_variables/insert_sql.html">$insert_sql</a> = 'REPLACE INTO T_messaging__contact_groupusers ( cgu_user_ID, cgu_cgr_ID ) VALUES ';
<a name="l1068"><span class="linenum">1068</span></a>  
<a name="l1069"><span class="linenum">1069</span></a>      <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> = array();
<a name="l1070"><span class="linenum">1070</span></a>      foreach( <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a> as <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> )
<a name="l1071"><span class="linenum">1071</span></a>      {
<a name="l1072"><span class="linenum">1072</span></a>          if( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> == 'new' || <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> ) &lt; 0 )
<a name="l1073"><span class="linenum">1073</span></a>          { // Add <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a>
<a name="l1074"><span class="linenum">1074</span></a>              if( <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> ) &lt; 0 )
<a name="l1075"><span class="linenum">1075</span></a>              { // Default group
<a name="l1076"><span class="linenum">1076</span></a>                  <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a> = <a class="function" onClick="logFunction('get_contacts_groups_default')" href="../../../_functions/get_contacts_groups_default.html" onMouseOver="funcPopup(event,'get_contacts_groups_default')">get_contacts_groups_default</a>();
<a name="l1077"><span class="linenum">1077</span></a>                  if( isset( <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a>[<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>] ) )
<a name="l1078"><span class="linenum">1078</span></a>                  { // Get group name
<a name="l1079"><span class="linenum">1079</span></a>                      <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> = <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a>[<a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a>];
<a name="l1080"><span class="linenum">1080</span></a>                  }
<a name="l1081"><span class="linenum">1081</span></a>              }
<a name="l1082"><span class="linenum">1082</span></a>              else
<a name="l1083"><span class="linenum">1083</span></a>              { // New entered group
<a name="l1084"><span class="linenum">1084</span></a>                  <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'contact_group_new', 'string' );
<a name="l1085"><span class="linenum">1085</span></a>                  if( empty( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> ) )
<a name="l1086"><span class="linenum">1086</span></a>                  {
<a name="l1087"><span class="linenum">1087</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter name for <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a>.'), 'error' );
<a name="l1088"><span class="linenum">1088</span></a>                  }
<a name="l1089"><span class="linenum">1089</span></a>              }
<a name="l1090"><span class="linenum">1090</span></a>  
<a name="l1091"><span class="linenum">1091</span></a>              if( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> = <a class="function" onClick="logFunction('create_contacts_group')" href="../../../_functions/create_contacts_group.html" onMouseOver="funcPopup(event,'create_contacts_group')">create_contacts_group</a>( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> ) )
<a name="l1092"><span class="linenum">1092</span></a>              { // Create <span class="keyword">new </span><a class="class" onClick="logClass('group')" href="../../../_classes/group.html" onMouseOver="classPopup(event,'group')">group</a>
<a name="l1093"><span class="linenum">1093</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('New contacts group has been created.'), 'success' );
<a name="l1094"><span class="linenum">1094</span></a>              }
<a name="l1095"><span class="linenum">1095</span></a>          }
<a name="l1096"><span class="linenum">1096</span></a>          else
<a name="l1097"><span class="linenum">1097</span></a>          { // Existing group
<a name="l1098"><span class="linenum">1098</span></a>              <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> = <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it163" onMouseOver="hilite(163)" onMouseOut="lolite()" onClick="logVariable('group')" href="../../../_variables/group.html">$group</a> );
<a name="l1099"><span class="linenum">1099</span></a>          }
<a name="l1100"><span class="linenum">1100</span></a>  
<a name="l1101"><span class="linenum">1101</span></a>          if( empty( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ) )
<a name="l1102"><span class="linenum">1102</span></a>          { // No defined group ID
<a name="l1103"><span class="linenum">1103</span></a>              continue;
<a name="l1104"><span class="linenum">1104</span></a>          }
<a name="l1105"><span class="linenum">1105</span></a>  
<a name="l1106"><span class="linenum">1106</span></a>          <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a>[] = '( '.<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ).' )';
<a name="l1107"><span class="linenum">1107</span></a>      }
<a name="l1108"><span class="linenum">1108</span></a>  
<a name="l1109"><span class="linenum">1109</span></a>      <a class="var it5021" onMouseOver="hilite(5021)" onMouseOut="lolite()" onClick="logVariable('current_user_groups')" href="../../../_variables/current_user_groups.html">$current_user_groups</a> = <a class="function" onClick="logFunction('get_contacts_groups_array')" href="../../../_functions/get_contacts_groups_array.html" onMouseOver="funcPopup(event,'get_contacts_groups_array')">get_contacts_groups_array</a>( false );
<a name="l1110"><span class="linenum">1110</span></a>      if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5021" onMouseOver="hilite(5021)" onMouseOut="lolite()" onClick="logVariable('current_user_groups')" href="../../../_variables/current_user_groups.html">$current_user_groups</a> ) &gt; 0 )
<a name="l1111"><span class="linenum">1111</span></a>      { // Clear previous selected groups for the user before new updating, in order to delete the user from the unchecked groups
<a name="l1112"><span class="linenum">1112</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_messaging__contact_groupusers
<a name="l1113"><span class="linenum">1113</span></a>              WHERE cgu_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ).'
<a name="l1114"><span class="linenum">1114</span></a>                AND cgu_cgr_ID IN ( '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it5021" onMouseOver="hilite(5021)" onMouseOut="lolite()" onClick="logVariable('current_user_groups')" href="../../../_variables/current_user_groups.html">$current_user_groups</a> ) ).' )' );
<a name="l1115"><span class="linenum">1115</span></a>      }
<a name="l1116"><span class="linenum">1116</span></a>  
<a name="l1117"><span class="linenum">1117</span></a>      if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> ) == 0 )
<a name="l1118"><span class="linenum">1118</span></a>      { // No data to add
<a name="l1119"><span class="linenum">1119</span></a>          return true;
<a name="l1120"><span class="linenum">1120</span></a>      }
<a name="l1121"><span class="linenum">1121</span></a>  
<a name="l1122"><span class="linenum">1122</span></a>      <a class="var it5020" onMouseOver="hilite(5020)" onMouseOut="lolite()" onClick="logVariable('insert_sql')" href="../../../_variables/insert_sql.html">$insert_sql</a> .= <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it5019" onMouseOver="hilite(5019)" onMouseOut="lolite()" onClick="logVariable('records')" href="../../../_variables/records.html">$records</a> );
<a name="l1123"><span class="linenum">1123</span></a>      if( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it5020" onMouseOver="hilite(5020)" onMouseOut="lolite()" onClick="logVariable('insert_sql')" href="../../../_variables/insert_sql.html">$insert_sql</a>, 'Insert user for contact groups' ) )
<a name="l1124"><span class="linenum">1124</span></a>      { // Success query
<a name="l1125"><span class="linenum">1125</span></a>          return true;
<a name="l1126"><span class="linenum">1126</span></a>      }
<a name="l1127"><span class="linenum">1127</span></a>      else
<a name="l1128"><span class="linenum">1128</span></a>      { // Failed query
<a name="l1129"><span class="linenum">1129</span></a>          return false;
<a name="l1130"><span class="linenum">1130</span></a>      }
<a name="l1131"><span class="linenum">1131</span></a>  }
<a name="l1132"><span class="linenum">1132</span></a>  
<a name="l1133"><span class="linenum">1133</span></a>  
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment">/**</span>
<a name="l1135"><span class="linenum">1135</span></a>  <span class="comment"> * Get default groups for user contacts</span>
<a name="l1136"><span class="linenum">1136</span></a>  <span class="comment"> *</span>
<a name="l1137"><span class="linenum">1137</span></a>  <span class="comment"> * @return array Groups</span>
<a name="l1138"><span class="linenum">1138</span></a>  <span class="comment"> */</span>
<a name="l1139"><span class="linenum">1139</span></a>  function <a class="function" onClick="logFunction('get_contacts_groups_default')" href="../../../_functions/get_contacts_groups_default.html" onMouseOver="funcPopup(event,'get_contacts_groups_default')">get_contacts_groups_default</a>()
<a name="l1140"><span class="linenum">1140</span></a>  {
<a name="l1141"><span class="linenum">1141</span></a>      <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a> = array(
<a name="l1142"><span class="linenum">1142</span></a>              '-1' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Close Friends'),
<a name="l1143"><span class="linenum">1143</span></a>              '-2' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Acquaintances'),
<a name="l1144"><span class="linenum">1144</span></a>          );
<a name="l1145"><span class="linenum">1145</span></a>  
<a name="l1146"><span class="linenum">1146</span></a>      return <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a>;
<a name="l1147"><span class="linenum">1147</span></a>  }
<a name="l1148"><span class="linenum">1148</span></a>  
<a name="l1149"><span class="linenum">1149</span></a>  
<a name="l1150"><span class="linenum">1150</span></a>  <span class="comment">/**</span>
<a name="l1151"><span class="linenum">1151</span></a>  <span class="comment"> * Get all contact groups of the current User</span>
<a name="l1152"><span class="linenum">1152</span></a>  <span class="comment"> *</span>
<a name="l1153"><span class="linenum">1153</span></a>  <span class="comment"> * @param boolean TRUE to include the default groups</span>
<a name="l1154"><span class="linenum">1154</span></a>  <span class="comment"> * @return array Groups</span>
<a name="l1155"><span class="linenum">1155</span></a>  <span class="comment"> */</span>
<a name="l1156"><span class="linenum">1156</span></a>  function <a class="function" onClick="logFunction('get_contacts_groups_array')" href="../../../_functions/get_contacts_groups_array.html" onMouseOver="funcPopup(event,'get_contacts_groups_array')">get_contacts_groups_array</a>( <a class="var it5022" onMouseOver="hilite(5022)" onMouseOut="lolite()" onClick="logVariable('include_default_groups')" href="../../../_variables/include_default_groups.html">$include_default_groups</a> = true )
<a name="l1157"><span class="linenum">1157</span></a>  {
<a name="l1158"><span class="linenum">1158</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l1159"><span class="linenum">1159</span></a>  
<a name="l1160"><span class="linenum">1160</span></a>  <span class="comment">    // Get user groups</span>
<a name="l1161"><span class="linenum">1161</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1162"><span class="linenum">1162</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgr_ID AS ID, cgr_name AS name' );
<a name="l1163"><span class="linenum">1163</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l1164"><span class="linenum">1164</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l1165"><span class="linenum">1165</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'cgr_name' );
<a name="l1166"><span class="linenum">1166</span></a>      <a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('user_groups')" href="../../../_variables/user_groups.html">$user_groups</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1167"><span class="linenum">1167</span></a>  
<a name="l1168"><span class="linenum">1168</span></a>  <span class="comment">    // Merge default and user groups (don't use a function array_merge() because it clears the keys)</span>
<a name="l1169"><span class="linenum">1169</span></a>      <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a> = array();
<a name="l1170"><span class="linenum">1170</span></a>      if( <a class="var it5022" onMouseOver="hilite(5022)" onMouseOut="lolite()" onClick="logVariable('include_default_groups')" href="../../../_variables/include_default_groups.html">$include_default_groups</a> )
<a name="l1171"><span class="linenum">1171</span></a>      { // Include the default groups
<a name="l1172"><span class="linenum">1172</span></a>          <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a> = <a class="function" onClick="logFunction('get_contacts_groups_default')" href="../../../_functions/get_contacts_groups_default.html" onMouseOver="funcPopup(event,'get_contacts_groups_default')">get_contacts_groups_default</a>();
<a name="l1173"><span class="linenum">1173</span></a>          foreach( <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a> as <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> =&gt; <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> )
<a name="l1174"><span class="linenum">1174</span></a>          {
<a name="l1175"><span class="linenum">1175</span></a>              if( ! <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>, <a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('user_groups')" href="../../../_variables/user_groups.html">$user_groups</a> ) )
<a name="l1176"><span class="linenum">1176</span></a>              { // Set this default group If it doesn't exist in DB
<a name="l1177"><span class="linenum">1177</span></a>                  <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a>[ <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ] = <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>;
<a name="l1178"><span class="linenum">1178</span></a>              }
<a name="l1179"><span class="linenum">1179</span></a>          }
<a name="l1180"><span class="linenum">1180</span></a>      }
<a name="l1181"><span class="linenum">1181</span></a>      foreach( <a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('user_groups')" href="../../../_variables/user_groups.html">$user_groups</a> as <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> =&gt; <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> )
<a name="l1182"><span class="linenum">1182</span></a>      {
<a name="l1183"><span class="linenum">1183</span></a>          <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a>[ <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ] = <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>;
<a name="l1184"><span class="linenum">1184</span></a>      }
<a name="l1185"><span class="linenum">1185</span></a>  
<a name="l1186"><span class="linenum">1186</span></a>      return <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a>;
<a name="l1187"><span class="linenum">1187</span></a>  }
<a name="l1188"><span class="linenum">1188</span></a>  
<a name="l1189"><span class="linenum">1189</span></a>  
<a name="l1190"><span class="linenum">1190</span></a>  <span class="comment">/**</span>
<a name="l1191"><span class="linenum">1191</span></a>  <span class="comment"> * Get what contact groups are selected for the user by current User</span>
<a name="l1192"><span class="linenum">1192</span></a>  <span class="comment"> *</span>
<a name="l1193"><span class="linenum">1193</span></a>  <span class="comment"> * @param integer</span>
<a name="l1194"><span class="linenum">1194</span></a>  <span class="comment"> * @return array Group IDs</span>
<a name="l1195"><span class="linenum">1195</span></a>  <span class="comment"> */</span>
<a name="l1196"><span class="linenum">1196</span></a>  function <a class="function" onClick="logFunction('get_contacts_groups_by_user_ID')" href="../../../_functions/get_contacts_groups_by_user_id.html" onMouseOver="funcPopup(event,'get_contacts_groups_by_user_id')">get_contacts_groups_by_user_ID</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l1197"><span class="linenum">1197</span></a>  {
<a name="l1198"><span class="linenum">1198</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l1199"><span class="linenum">1199</span></a>  
<a name="l1200"><span class="linenum">1200</span></a>  <span class="comment">    // Get user groups</span>
<a name="l1201"><span class="linenum">1201</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1202"><span class="linenum">1202</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgu_cgr_ID' );
<a name="l1203"><span class="linenum">1203</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l1204"><span class="linenum">1204</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_messaging__contact_groupusers ON cgu_cgr_ID=cgr_ID' );
<a name="l1205"><span class="linenum">1205</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l1206"><span class="linenum">1206</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cgu_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) );
<a name="l1207"><span class="linenum">1207</span></a>      return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1208"><span class="linenum">1208</span></a>  }
<a name="l1209"><span class="linenum">1209</span></a>  
<a name="l1210"><span class="linenum">1210</span></a>  
<a name="l1211"><span class="linenum">1211</span></a>  <span class="comment">/**</span>
<a name="l1212"><span class="linenum">1212</span></a>  <span class="comment"> * Get tags &lt;option&gt; for contacts groups of current User</span>
<a name="l1213"><span class="linenum">1213</span></a>  <span class="comment"> *</span>
<a name="l1214"><span class="linenum">1214</span></a>  <span class="comment"> * @param integer Selected group ID</span>
<a name="l1215"><span class="linenum">1215</span></a>  <span class="comment"> * @param boolean TRUE if we need in null option, else FALSE</span>
<a name="l1216"><span class="linenum">1216</span></a>  <span class="comment"> * @return string Tags &lt;option&gt;</span>
<a name="l1217"><span class="linenum">1217</span></a>  <span class="comment"> */</span>
<a name="l1218"><span class="linenum">1218</span></a>  function <a class="function" onClick="logFunction('get_contacts_groups_options')" href="../../../_functions/get_contacts_groups_options.html" onMouseOver="funcPopup(event,'get_contacts_groups_options')">get_contacts_groups_options</a>( <a class="var it5023" onMouseOver="hilite(5023)" onMouseOut="lolite()" onClick="logVariable('selected_group_ID')" href="../../../_variables/selected_group_ID.html">$selected_group_ID</a> = NULL, <a class="var it5024" onMouseOver="hilite(5024)" onMouseOut="lolite()" onClick="logVariable('value_null')" href="../../../_variables/value_null.html">$value_null</a> = true )
<a name="l1219"><span class="linenum">1219</span></a>  {
<a name="l1220"><span class="linenum">1220</span></a>      <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a> = <a class="function" onClick="logFunction('get_contacts_groups_array')" href="../../../_functions/get_contacts_groups_array.html" onMouseOver="funcPopup(event,'get_contacts_groups_array')">get_contacts_groups_array</a>();
<a name="l1221"><span class="linenum">1221</span></a>  
<a name="l1222"><span class="linenum">1222</span></a>      <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> = '';
<a name="l1223"><span class="linenum">1223</span></a>  
<a name="l1224"><span class="linenum">1224</span></a>      if( <a class="var it5024" onMouseOver="hilite(5024)" onMouseOut="lolite()" onClick="logVariable('value_null')" href="../../../_variables/value_null.html">$value_null</a> )
<a name="l1225"><span class="linenum">1225</span></a>      { // Null option
<a name="l1226"><span class="linenum">1226</span></a>          <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> .= '&lt;option value=&quot;0&quot;&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('All').'&lt;/option&gt;'.&quot;\n&quot;;
<a name="l1227"><span class="linenum">1227</span></a>      }
<a name="l1228"><span class="linenum">1228</span></a>  
<a name="l1229"><span class="linenum">1229</span></a>      foreach( <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a> as <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> =&gt; <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> )
<a name="l1230"><span class="linenum">1230</span></a>      {
<a name="l1231"><span class="linenum">1231</span></a>          <a class="var it3465" onMouseOver="hilite(3465)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a> = '';
<a name="l1232"><span class="linenum">1232</span></a>          if( <a class="var it5023" onMouseOver="hilite(5023)" onMouseOut="lolite()" onClick="logVariable('selected_group_ID')" href="../../../_variables/selected_group_ID.html">$selected_group_ID</a> == <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> )
<a name="l1233"><span class="linenum">1233</span></a>          { // Group is selected
<a name="l1234"><span class="linenum">1234</span></a>              <a class="var it3465" onMouseOver="hilite(3465)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a> = ' selected=&quot;selected&quot;';
<a name="l1235"><span class="linenum">1235</span></a>          }
<a name="l1236"><span class="linenum">1236</span></a>          <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a> .= '&lt;option value=&quot;'.<a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>.'&quot;'.<a class="var it3465" onMouseOver="hilite(3465)" onMouseOut="lolite()" onClick="logVariable('selected')" href="../../../_variables/selected.html">$selected</a>.'&gt;'.<a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>.'&lt;/option&gt;'.&quot;\n&quot;;
<a name="l1237"><span class="linenum">1237</span></a>      }
<a name="l1238"><span class="linenum">1238</span></a>  
<a name="l1239"><span class="linenum">1239</span></a>      return <a class="var it240" onMouseOver="hilite(240)" onMouseOut="lolite()" onClick="logVariable('options')" href="../../../_variables/options.html">$options</a>;
<a name="l1240"><span class="linenum">1240</span></a>  }
<a name="l1241"><span class="linenum">1241</span></a>  
<a name="l1242"><span class="linenum">1242</span></a>  
<a name="l1243"><span class="linenum">1243</span></a>  <span class="comment">/**</span>
<a name="l1244"><span class="linenum">1244</span></a>  <span class="comment"> * Get list with contacts groups of current User</span>
<a name="l1245"><span class="linenum">1245</span></a>  <span class="comment"> *</span>
<a name="l1246"><span class="linenum">1246</span></a>  <span class="comment"> * @param integer User ID</span>
<a name="l1247"><span class="linenum">1247</span></a>  <span class="comment"> * @param array Params</span>
<a name="l1248"><span class="linenum">1248</span></a>  <span class="comment"> * @return string HTML list</span>
<a name="l1249"><span class="linenum">1249</span></a>  <span class="comment"> */</span>
<a name="l1250"><span class="linenum">1250</span></a>  function <a class="function" onClick="logFunction('get_contacts_groups_list')" href="../../../_functions/get_contacts_groups_list.html" onMouseOver="funcPopup(event,'get_contacts_groups_list')">get_contacts_groups_list</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l1251"><span class="linenum">1251</span></a>  {
<a name="l1252"><span class="linenum">1252</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l1253"><span class="linenum">1253</span></a>  
<a name="l1254"><span class="linenum">1254</span></a>      <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l1255"><span class="linenum">1255</span></a>              'list_start'  =&gt; '&lt;table cellspacing=&quot;0&quot; class=&quot;user_contacts_groups&quot;&gt;',
<a name="l1256"><span class="linenum">1256</span></a>              'col1_header' =&gt; '&lt;tr&gt;&lt;th class=&quot;col1&quot;&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('In these groups').'&lt;/th&gt;',
<a name="l1257"><span class="linenum">1257</span></a>              'col2_header' =&gt; '&lt;th&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Not in these groups').'&lt;/th&gt;&lt;/tr&gt;',
<a name="l1258"><span class="linenum">1258</span></a>              'col1_start'  =&gt; '&lt;tr&gt;&lt;td class=&quot;col1&quot;&gt;',
<a name="l1259"><span class="linenum">1259</span></a>              'col1_end'    =&gt; '&lt;/td&gt;',
<a name="l1260"><span class="linenum">1260</span></a>              'col2_start'  =&gt; '&lt;td&gt;',
<a name="l1261"><span class="linenum">1261</span></a>              'col2_end'    =&gt; '&lt;/tr&gt;',
<a name="l1262"><span class="linenum">1262</span></a>              'list_end'    =&gt; '&lt;/table&gt;',
<a name="l1263"><span class="linenum">1263</span></a>          ) );
<a name="l1264"><span class="linenum">1264</span></a>  
<a name="l1265"><span class="linenum">1265</span></a>      <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a> = <a class="function" onClick="logFunction('get_contacts_groups_default')" href="../../../_functions/get_contacts_groups_default.html" onMouseOver="funcPopup(event,'get_contacts_groups_default')">get_contacts_groups_default</a>();
<a name="l1266"><span class="linenum">1266</span></a>  
<a name="l1267"><span class="linenum">1267</span></a>  <span class="comment">    // Get all groups of current User</span>
<a name="l1268"><span class="linenum">1268</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1269"><span class="linenum">1269</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgr_ID AS ID, cgr_name AS name' );
<a name="l1270"><span class="linenum">1270</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groups' );
<a name="l1271"><span class="linenum">1271</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgr_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1272"><span class="linenum">1272</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'cgr_name' );
<a name="l1273"><span class="linenum">1273</span></a>      <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('all_groups')" href="../../../_variables/all_groups.html">$all_groups</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1274"><span class="linenum">1274</span></a>  
<a name="l1275"><span class="linenum">1275</span></a>  <span class="comment">    // Merge default and user groups (don't use a function array_merge() because it clears the keys)</span>
<a name="l1276"><span class="linenum">1276</span></a>      <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a> = array();
<a name="l1277"><span class="linenum">1277</span></a>      foreach( <a class="var it5017" onMouseOver="hilite(5017)" onMouseOut="lolite()" onClick="logVariable('default_groups')" href="../../../_variables/default_groups.html">$default_groups</a> as <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> =&gt; <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> )
<a name="l1278"><span class="linenum">1278</span></a>      {
<a name="l1279"><span class="linenum">1279</span></a>          if( !<a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>, <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('all_groups')" href="../../../_variables/all_groups.html">$all_groups</a> ) )
<a name="l1280"><span class="linenum">1280</span></a>          {    // Set this default group If it doesn't exist in DB
<a name="l1281"><span class="linenum">1281</span></a>              <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a>[<a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>] = <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>;
<a name="l1282"><span class="linenum">1282</span></a>          }
<a name="l1283"><span class="linenum">1283</span></a>      }
<a name="l1284"><span class="linenum">1284</span></a>      foreach( <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('all_groups')" href="../../../_variables/all_groups.html">$all_groups</a> as <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> =&gt; <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> )
<a name="l1285"><span class="linenum">1285</span></a>      {
<a name="l1286"><span class="linenum">1286</span></a>          <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a>[<a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>] = <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>;
<a name="l1287"><span class="linenum">1287</span></a>      }
<a name="l1288"><span class="linenum">1288</span></a>      <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('all_groups')" href="../../../_variables/all_groups.html">$all_groups</a> = <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a>;
<a name="l1289"><span class="linenum">1289</span></a>      unset( <a class="var it188" onMouseOver="hilite(188)" onMouseOut="lolite()" onClick="logVariable('groups')" href="../../../_variables/groups.html">$groups</a> );
<a name="l1290"><span class="linenum">1290</span></a>  
<a name="l1291"><span class="linenum">1291</span></a>      if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('all_groups')" href="../../../_variables/all_groups.html">$all_groups</a> ) == 0 )
<a name="l1292"><span class="linenum">1292</span></a>      {    // No groups
<a name="l1293"><span class="linenum">1293</span></a>          return;
<a name="l1294"><span class="linenum">1294</span></a>      }
<a name="l1295"><span class="linenum">1295</span></a>  
<a name="l1296"><span class="linenum">1296</span></a>  <span class="comment">    // Get groups of selected User</span>
<a name="l1297"><span class="linenum">1297</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1298"><span class="linenum">1298</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cgu_cgr_ID, cgu_user_ID' );
<a name="l1299"><span class="linenum">1299</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact_groupusers' );
<a name="l1300"><span class="linenum">1300</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cgu_user_ID = '.<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l1301"><span class="linenum">1301</span></a>      <a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('user_groups')" href="../../../_variables/user_groups.html">$user_groups</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1302"><span class="linenum">1302</span></a>  
<a name="l1303"><span class="linenum">1303</span></a>      if( !empty( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> ) )
<a name="l1304"><span class="linenum">1304</span></a>      {    // Set url to contacts list
<a name="l1305"><span class="linenum">1305</span></a>          <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('contacts_url')" href="../../../_variables/contacts_url.html">$contacts_url</a> = <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'contactsurl' );
<a name="l1306"><span class="linenum">1306</span></a>      }
<a name="l1307"><span class="linenum">1307</span></a>  
<a name="l1308"><span class="linenum">1308</span></a>      <a class="var it5026" onMouseOver="hilite(5026)" onMouseOut="lolite()" onClick="logVariable('groups_1st')" href="../../../_variables/groups_1st.html">$groups_1st</a> = array();
<a name="l1309"><span class="linenum">1309</span></a>      <a class="var it5027" onMouseOver="hilite(5027)" onMouseOut="lolite()" onClick="logVariable('groups_2nd')" href="../../../_variables/groups_2nd.html">$groups_2nd</a> = array();
<a name="l1310"><span class="linenum">1310</span></a>      foreach( <a class="var it5025" onMouseOver="hilite(5025)" onMouseOut="lolite()" onClick="logVariable('all_groups')" href="../../../_variables/all_groups.html">$all_groups</a> as <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> =&gt; <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a> )
<a name="l1311"><span class="linenum">1311</span></a>      {
<a name="l1312"><span class="linenum">1312</span></a>          if( !empty( <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('contacts_url')" href="../../../_variables/contacts_url.html">$contacts_url</a> ) &amp;&amp; <a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> &gt; 0 )
<a name="l1313"><span class="linenum">1313</span></a>          {    // Set link to contacts list with filtered by current group
<a name="l1314"><span class="linenum">1314</span></a>              <a class="var it5028" onMouseOver="hilite(5028)" onMouseOut="lolite()" onClick="logVariable('group_link')" href="../../../_variables/group_link.html">$group_link</a> = '&lt;a href=&quot;'.<a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it1081" onMouseOver="hilite(1081)" onMouseOut="lolite()" onClick="logVariable('contacts_url')" href="../../../_variables/contacts_url.html">$contacts_url</a>, 'g='.<a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a> ).'&quot;&gt;'.<a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>.'&lt;/a&gt;';
<a name="l1315"><span class="linenum">1315</span></a>          }
<a name="l1316"><span class="linenum">1316</span></a>          else
<a name="l1317"><span class="linenum">1317</span></a>          {    // No link, use name
<a name="l1318"><span class="linenum">1318</span></a>              <a class="var it5028" onMouseOver="hilite(5028)" onMouseOut="lolite()" onClick="logVariable('group_link')" href="../../../_variables/group_link.html">$group_link</a> = <a class="var it190" onMouseOver="hilite(190)" onMouseOut="lolite()" onClick="logVariable('group_name')" href="../../../_variables/group_name.html">$group_name</a>;
<a name="l1319"><span class="linenum">1319</span></a>          }
<a name="l1320"><span class="linenum">1320</span></a>          if( isset( <a class="var it160" onMouseOver="hilite(160)" onMouseOut="lolite()" onClick="logVariable('user_groups')" href="../../../_variables/user_groups.html">$user_groups</a>[<a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>] ) )
<a name="l1321"><span class="linenum">1321</span></a>          {    // User is in this group
<a name="l1322"><span class="linenum">1322</span></a>              <a class="var it5026" onMouseOver="hilite(5026)" onMouseOut="lolite()" onClick="logVariable('groups_1st')" href="../../../_variables/groups_1st.html">$groups_1st</a>[] = '&lt;th&gt;&lt;strong&gt;'.<a class="var it5028" onMouseOver="hilite(5028)" onMouseOut="lolite()" onClick="logVariable('group_link')" href="../../../_variables/group_link.html">$group_link</a>.'&lt;/strong&gt;&lt;/th&gt;'.
<a name="l1323"><span class="linenum">1323</span></a>                      '&lt;td&gt;'.<a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Remove from group'), 'move_right', <a class="function" onClick="logFunction('get_dispctrl_url')" href="../../../_functions/get_dispctrl_url.html" onMouseOver="funcPopup(event,'get_dispctrl_url')">get_dispctrl_url</a>( 'contacts', 'action=remove_user&amp;amp;user_ID='.<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>.'&amp;amp;group_ID='.<a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>.'&amp;amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'messaging_contacts' ) ) ).'&lt;/td&gt;';
<a name="l1324"><span class="linenum">1324</span></a>          }
<a name="l1325"><span class="linenum">1325</span></a>          else
<a name="l1326"><span class="linenum">1326</span></a>          {
<a name="l1327"><span class="linenum">1327</span></a>              <a class="var it5027" onMouseOver="hilite(5027)" onMouseOut="lolite()" onClick="logVariable('groups_2nd')" href="../../../_variables/groups_2nd.html">$groups_2nd</a>[] = '&lt;td&gt;'.<a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Add to group'), 'move_left', <a class="function" onClick="logFunction('get_dispctrl_url')" href="../../../_functions/get_dispctrl_url.html" onMouseOver="funcPopup(event,'get_dispctrl_url')">get_dispctrl_url</a>( 'contacts', 'action=add_user&amp;amp;user_ID='.<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>.'&amp;amp;group_ID='.<a class="var it526" onMouseOver="hilite(526)" onMouseOut="lolite()" onClick="logVariable('group_ID')" href="../../../_variables/group_ID.html">$group_ID</a>.'&amp;amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'messaging_contacts' ) ) ).'&lt;/td&gt;'.
<a name="l1328"><span class="linenum">1328</span></a>                      '&lt;th&gt;'.<a class="var it5028" onMouseOver="hilite(5028)" onMouseOut="lolite()" onClick="logVariable('group_link')" href="../../../_variables/group_link.html">$group_link</a>.'&lt;/th&gt;';
<a name="l1329"><span class="linenum">1329</span></a>          }
<a name="l1330"><span class="linenum">1330</span></a>      }
<a name="l1331"><span class="linenum">1331</span></a>  
<a name="l1332"><span class="linenum">1332</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['list_start'];
<a name="l1333"><span class="linenum">1333</span></a>  
<a name="l1334"><span class="linenum">1334</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['col1_header'];
<a name="l1335"><span class="linenum">1335</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['col2_header'];
<a name="l1336"><span class="linenum">1336</span></a>  
<a name="l1337"><span class="linenum">1337</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['col1_start'];
<a name="l1338"><span class="linenum">1338</span></a>      if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5026" onMouseOver="hilite(5026)" onMouseOut="lolite()" onClick="logVariable('groups_1st')" href="../../../_variables/groups_1st.html">$groups_1st</a> ) &gt;0 )
<a name="l1339"><span class="linenum">1339</span></a>      {
<a name="l1340"><span class="linenum">1340</span></a>          <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= '&lt;table cellspacing=&quot;0&quot;&gt;&lt;tr&gt;'.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( '&lt;/tr&gt;&lt;tr&gt;', <a class="var it5026" onMouseOver="hilite(5026)" onMouseOut="lolite()" onClick="logVariable('groups_1st')" href="../../../_variables/groups_1st.html">$groups_1st</a> ).'&lt;/tr&gt;&lt;/table&gt;';
<a name="l1341"><span class="linenum">1341</span></a>      }
<a name="l1342"><span class="linenum">1342</span></a>      else
<a name="l1343"><span class="linenum">1343</span></a>      {
<a name="l1344"><span class="linenum">1344</span></a>          <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= '&amp;nbsp;';
<a name="l1345"><span class="linenum">1345</span></a>      }
<a name="l1346"><span class="linenum">1346</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['col1_end'];
<a name="l1347"><span class="linenum">1347</span></a>  
<a name="l1348"><span class="linenum">1348</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['col2_start'];
<a name="l1349"><span class="linenum">1349</span></a>      if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it5027" onMouseOver="hilite(5027)" onMouseOut="lolite()" onClick="logVariable('groups_2nd')" href="../../../_variables/groups_2nd.html">$groups_2nd</a> ) &gt;0 )
<a name="l1350"><span class="linenum">1350</span></a>      {
<a name="l1351"><span class="linenum">1351</span></a>          <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= '&lt;table cellspacing=&quot;0&quot;&gt;&lt;tr&gt;'.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( '&lt;/tr&gt;&lt;tr&gt;', <a class="var it5027" onMouseOver="hilite(5027)" onMouseOut="lolite()" onClick="logVariable('groups_2nd')" href="../../../_variables/groups_2nd.html">$groups_2nd</a> ).'&lt;/tr&gt;&lt;/table&gt;';
<a name="l1352"><span class="linenum">1352</span></a>      }
<a name="l1353"><span class="linenum">1353</span></a>      else
<a name="l1354"><span class="linenum">1354</span></a>      {
<a name="l1355"><span class="linenum">1355</span></a>          <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= '&amp;nbsp;';
<a name="l1356"><span class="linenum">1356</span></a>      }
<a name="l1357"><span class="linenum">1357</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['col2_end'];
<a name="l1358"><span class="linenum">1358</span></a>  
<a name="l1359"><span class="linenum">1359</span></a>      <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['list_end'];
<a name="l1360"><span class="linenum">1360</span></a>  
<a name="l1361"><span class="linenum">1361</span></a>      return <a class="var it5029" onMouseOver="hilite(5029)" onMouseOut="lolite()" onClick="logVariable('groups_list')" href="../../../_variables/groups_list.html">$groups_list</a>;
<a name="l1362"><span class="linenum">1362</span></a>  }
<a name="l1363"><span class="linenum">1363</span></a>  
<a name="l1364"><span class="linenum">1364</span></a>  
<a name="l1365"><span class="linenum">1365</span></a>  <span class="comment">/**</span>
<a name="l1366"><span class="linenum">1366</span></a>  <span class="comment"> * Check contact for current user with selected user</span>
<a name="l1367"><span class="linenum">1367</span></a>  <span class="comment"> *</span>
<a name="l1368"><span class="linenum">1368</span></a>  <span class="comment"> * @param integer User ID</span>
<a name="l1369"><span class="linenum">1369</span></a>  <span class="comment"> * @return mixed NULL if contact was not found, boolean TRUE if contact is not blocked, FALSE otherwise</span>
<a name="l1370"><span class="linenum">1370</span></a>  <span class="comment"> */</span>
<a name="l1371"><span class="linenum">1371</span></a>  function <a class="function" onClick="logFunction('check_contact')" href="../../../_functions/check_contact.html" onMouseOver="funcPopup(event,'check_contact')">check_contact</a>( <a class="var it542" onMouseOver="hilite(542)" onMouseOut="lolite()" onClick="logVariable('to_user_ID')" href="../../../_variables/to_user_ID.html">$to_user_ID</a> )
<a name="l1372"><span class="linenum">1372</span></a>  {
<a name="l1373"><span class="linenum">1373</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l1374"><span class="linenum">1374</span></a>  
<a name="l1375"><span class="linenum">1375</span></a>      <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('is_blocked')" href="../../../_variables/is_blocked.html">$is_blocked</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT mct_blocked
<a name="l1376"><span class="linenum">1376</span></a>           FROM T_messaging__contact
<a name="l1377"><span class="linenum">1377</span></a>          WHERE mct_from_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l1378"><span class="linenum">1378</span></a>            AND mct_to_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it542" onMouseOver="hilite(542)" onMouseOut="lolite()" onClick="logVariable('to_user_ID')" href="../../../_variables/to_user_ID.html">$to_user_ID</a> ) );
<a name="l1379"><span class="linenum">1379</span></a>  
<a name="l1380"><span class="linenum">1380</span></a>      if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('is_blocked')" href="../../../_variables/is_blocked.html">$is_blocked</a> ) )
<a name="l1381"><span class="linenum">1381</span></a>      {
<a name="l1382"><span class="linenum">1382</span></a>          return NULL;
<a name="l1383"><span class="linenum">1383</span></a>      }
<a name="l1384"><span class="linenum">1384</span></a>      return !<a class="var it1262" onMouseOver="hilite(1262)" onMouseOut="lolite()" onClick="logVariable('is_blocked')" href="../../../_variables/is_blocked.html">$is_blocked</a>;
<a name="l1385"><span class="linenum">1385</span></a>  }
<a name="l1386"><span class="linenum">1386</span></a>  
<a name="l1387"><span class="linenum">1387</span></a>  
<a name="l1388"><span class="linenum">1388</span></a>  <span class="comment">/**</span>
<a name="l1389"><span class="linenum">1389</span></a>  <span class="comment"> * Update current User last new thread timestamp, and today's new thread count</span>
<a name="l1390"><span class="linenum">1390</span></a>  <span class="comment"> *</span>
<a name="l1391"><span class="linenum">1391</span></a>  <span class="comment"> * @param integer how many new thread was just created</span>
<a name="l1392"><span class="linenum">1392</span></a>  <span class="comment"> */</span>
<a name="l1393"><span class="linenum">1393</span></a>  function <a class="function" onClick="logFunction('update_todays_thread_settings')" href="../../../_functions/update_todays_thread_settings.html" onMouseOver="funcPopup(event,'update_todays_thread_settings')">update_todays_thread_settings</a>( <a class="var it5030" onMouseOver="hilite(5030)" onMouseOut="lolite()" onClick="logVariable('new_threads_count')" href="../../../_variables/new_threads_count.html">$new_threads_count</a> )
<a name="l1394"><span class="linenum">1394</span></a>  {
<a name="l1395"><span class="linenum">1395</span></a>      global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l1396"><span class="linenum">1396</span></a>  
<a name="l1397"><span class="linenum">1397</span></a>      <a class="var it5031" onMouseOver="hilite(5031)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_ts')" href="../../../_variables/last_new_thread_ts.html">$last_new_thread_ts</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'last_new_thread',  <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1398"><span class="linenum">1398</span></a>      if( empty( <a class="var it5031" onMouseOver="hilite(5031)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_ts')" href="../../../_variables/last_new_thread_ts.html">$last_new_thread_ts</a> ) )
<a name="l1399"><span class="linenum">1399</span></a>      { // this is the current User first <span class="keyword">new </span><a class="class" onClick="logClass('thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">thread</a>
<a name="l1400"><span class="linenum">1400</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'last_new_thread', <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1401"><span class="linenum">1401</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'new_thread_count', <a class="var it5030" onMouseOver="hilite(5030)" onMouseOut="lolite()" onClick="logVariable('new_threads_count')" href="../../../_variables/new_threads_count.html">$new_threads_count</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1402"><span class="linenum">1402</span></a>      }
<a name="l1403"><span class="linenum">1403</span></a>      else
<a name="l1404"><span class="linenum">1404</span></a>      {
<a name="l1405"><span class="linenum">1405</span></a>          <a class="var it5032" onMouseOver="hilite(5032)" onMouseOut="lolite()" onClick="logVariable('today')" href="../../../_variables/today.html">$today</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d', <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> );
<a name="l1406"><span class="linenum">1406</span></a>          <a class="var it5033" onMouseOver="hilite(5033)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_date')" href="../../../_variables/last_new_thread_date.html">$last_new_thread_date</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d', <a class="var it5031" onMouseOver="hilite(5031)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_ts')" href="../../../_variables/last_new_thread_ts.html">$last_new_thread_ts</a> );
<a name="l1407"><span class="linenum">1407</span></a>          if( <a class="var it5033" onMouseOver="hilite(5033)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_date')" href="../../../_variables/last_new_thread_date.html">$last_new_thread_date</a> &lt; <a class="var it5032" onMouseOver="hilite(5032)" onMouseOut="lolite()" onClick="logVariable('today')" href="../../../_variables/today.html">$today</a> )
<a name="l1408"><span class="linenum">1408</span></a>          { // this is the current User first <span class="keyword">new </span><a class="class" onClick="logClass('thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">thread</a> today
<a name="l1409"><span class="linenum">1409</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'new_thread_count', <a class="var it5030" onMouseOver="hilite(5030)" onMouseOut="lolite()" onClick="logVariable('new_threads_count')" href="../../../_variables/new_threads_count.html">$new_threads_count</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1410"><span class="linenum">1410</span></a>          }
<a name="l1411"><span class="linenum">1411</span></a>          else
<a name="l1412"><span class="linenum">1412</span></a>          { // current User has already created other new threads today
<a name="l1413"><span class="linenum">1413</span></a>              <a class="var it5034" onMouseOver="hilite(5034)" onMouseOut="lolite()" onClick="logVariable('new_thread_count')" href="../../../_variables/new_thread_count.html">$new_thread_count</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'new_thread_count', <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1414"><span class="linenum">1414</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'new_thread_count', <a class="var it5034" onMouseOver="hilite(5034)" onMouseOut="lolite()" onClick="logVariable('new_thread_count')" href="../../../_variables/new_thread_count.html">$new_thread_count</a> + <a class="var it5030" onMouseOver="hilite(5030)" onMouseOut="lolite()" onClick="logVariable('new_threads_count')" href="../../../_variables/new_threads_count.html">$new_threads_count</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1415"><span class="linenum">1415</span></a>          }
<a name="l1416"><span class="linenum">1416</span></a>  <span class="comment">        // update last new thread timestamp</span>
<a name="l1417"><span class="linenum">1417</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'last_new_thread', <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1418"><span class="linenum">1418</span></a>      }
<a name="l1419"><span class="linenum">1419</span></a>  <span class="comment">    // update User Settings</span>
<a name="l1420"><span class="linenum">1420</span></a>      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l1421"><span class="linenum">1421</span></a>  }
<a name="l1422"><span class="linenum">1422</span></a>  
<a name="l1423"><span class="linenum">1423</span></a>  
<a name="l1424"><span class="linenum">1424</span></a>  <span class="comment">/**</span>
<a name="l1425"><span class="linenum">1425</span></a>  <span class="comment"> * Get current User max new threads settings for today</span>
<a name="l1426"><span class="linenum">1426</span></a>  <span class="comment"> *</span>
<a name="l1427"><span class="linenum">1427</span></a>  <span class="comment"> * @return array ( max new threads per day, how many threads has already created today )</span>
<a name="l1428"><span class="linenum">1428</span></a>  <span class="comment"> */</span>
<a name="l1429"><span class="linenum">1429</span></a>  function <a class="function" onClick="logFunction('get_todays_thread_settings')" href="../../../_functions/get_todays_thread_settings.html" onMouseOver="funcPopup(event,'get_todays_thread_settings')">get_todays_thread_settings</a>()
<a name="l1430"><span class="linenum">1430</span></a>  {
<a name="l1431"><span class="linenum">1431</span></a>      global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l1432"><span class="linenum">1432</span></a>  
<a name="l1433"><span class="linenum">1433</span></a>      <a class="var it3830" onMouseOver="hilite(3830)" onMouseOut="lolite()" onClick="logVariable('user_Group')" href="../../../_variables/user_Group.html">$user_Group</a> = &amp; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;get_Group();
<a name="l1434"><span class="linenum">1434</span></a>      <a class="var it5035" onMouseOver="hilite(5035)" onMouseOut="lolite()" onClick="logVariable('user_GroupSettings')" href="../../../_variables/user_GroupSettings.html">$user_GroupSettings</a> = &amp; <a class="var it3830" onMouseOver="hilite(3830)" onMouseOut="lolite()" onClick="logVariable('user_Group')" href="../../../_variables/user_Group.html">$user_Group</a>-&gt;get_GroupSettings();
<a name="l1435"><span class="linenum">1435</span></a>      <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a> = <a class="var it5035" onMouseOver="hilite(5035)" onMouseOut="lolite()" onClick="logVariable('user_GroupSettings')" href="../../../_variables/user_GroupSettings.html">$user_GroupSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'max_new_threads', <a class="var it3830" onMouseOver="hilite(3830)" onMouseOut="lolite()" onClick="logVariable('user_Group')" href="../../../_variables/user_Group.html">$user_Group</a>-&gt;<a onClick="logVariable('ID')" class="var it10983" onMouseOver="hilite(10983)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1436"><span class="linenum">1436</span></a>      if( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a> === '0' )
<a name="l1437"><span class="linenum">1437</span></a>      { // user limit is 0, user must not be able to create new threads
<a name="l1438"><span class="linenum">1438</span></a>          return array( '0', 0 );
<a name="l1439"><span class="linenum">1439</span></a>      }
<a name="l1440"><span class="linenum">1440</span></a>  
<a name="l1441"><span class="linenum">1441</span></a>      <a class="var it5031" onMouseOver="hilite(5031)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_ts')" href="../../../_variables/last_new_thread_ts.html">$last_new_thread_ts</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'last_new_thread', <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1442"><span class="linenum">1442</span></a>      if( empty( <a class="var it5031" onMouseOver="hilite(5031)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_ts')" href="../../../_variables/last_new_thread_ts.html">$last_new_thread_ts</a> ) )
<a name="l1443"><span class="linenum">1443</span></a>      { // user has not created any new threads yet
<a name="l1444"><span class="linenum">1444</span></a>          return array( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a>, 0 );
<a name="l1445"><span class="linenum">1445</span></a>      }
<a name="l1446"><span class="linenum">1446</span></a>  
<a name="l1447"><span class="linenum">1447</span></a>      <a class="var it5032" onMouseOver="hilite(5032)" onMouseOut="lolite()" onClick="logVariable('today')" href="../../../_variables/today.html">$today</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d', <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> );
<a name="l1448"><span class="linenum">1448</span></a>      <a class="var it5033" onMouseOver="hilite(5033)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_date')" href="../../../_variables/last_new_thread_date.html">$last_new_thread_date</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d', <a class="var it5031" onMouseOver="hilite(5031)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_ts')" href="../../../_variables/last_new_thread_ts.html">$last_new_thread_ts</a> );
<a name="l1449"><span class="linenum">1449</span></a>      if( <a class="var it5033" onMouseOver="hilite(5033)" onMouseOut="lolite()" onClick="logVariable('last_new_thread_date')" href="../../../_variables/last_new_thread_date.html">$last_new_thread_date</a> &lt; <a class="var it5032" onMouseOver="hilite(5032)" onMouseOut="lolite()" onClick="logVariable('today')" href="../../../_variables/today.html">$today</a> )
<a name="l1450"><span class="linenum">1450</span></a>      { // user's last <span class="keyword">new </span><a class="class" onClick="logClass('thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">thread</a> was not created today, it's older
<a name="l1451"><span class="linenum">1451</span></a>          return array( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a>, 0 );
<a name="l1452"><span class="linenum">1452</span></a>      }
<a name="l1453"><span class="linenum">1453</span></a>  
<a name="l1454"><span class="linenum">1454</span></a>  <span class="comment">    // User has already created at least one new thread today</span>
<a name="l1455"><span class="linenum">1455</span></a>      <a class="var it5034" onMouseOver="hilite(5034)" onMouseOut="lolite()" onClick="logVariable('new_thread_count')" href="../../../_variables/new_thread_count.html">$new_thread_count</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'new_thread_count', <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1456"><span class="linenum">1456</span></a>      return array( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a>, <a class="var it5034" onMouseOver="hilite(5034)" onMouseOut="lolite()" onClick="logVariable('new_thread_count')" href="../../../_variables/new_thread_count.html">$new_thread_count</a> );
<a name="l1457"><span class="linenum">1457</span></a>  }
<a name="l1458"><span class="linenum">1458</span></a>  
<a name="l1459"><span class="linenum">1459</span></a>  
<a name="l1460"><span class="linenum">1460</span></a>  <span class="comment">/**</span>
<a name="l1461"><span class="linenum">1461</span></a>  <span class="comment"> * Check if current User already reached his 'create new thread' limit for today or not.</span>
<a name="l1462"><span class="linenum">1462</span></a>  <span class="comment"> * Important: The current User messaging permission is not checked here!</span>
<a name="l1463"><span class="linenum">1463</span></a>  <span class="comment"> *</span>
<a name="l1464"><span class="linenum">1464</span></a>  <span class="comment"> * @param boolean true to add a success/error message to $Messages about the current User thread limit, false otherwise</span>
<a name="l1465"><span class="linenum">1465</span></a>  <span class="comment"> * @return boolean true if current user already reached his limit, false otherwise</span>
<a name="l1466"><span class="linenum">1466</span></a>  <span class="comment"> */</span>
<a name="l1467"><span class="linenum">1467</span></a>  function <a class="function" onClick="logFunction('check_create_thread_limit')" href="../../../_functions/check_create_thread_limit.html" onMouseOver="funcPopup(event,'check_create_thread_limit')">check_create_thread_limit</a>( <a class="var it5036" onMouseOver="hilite(5036)" onMouseOut="lolite()" onClick="logVariable('add_message')" href="../../../_variables/add_message.html">$add_message</a> = false )
<a name="l1468"><span class="linenum">1468</span></a>  {
<a name="l1469"><span class="linenum">1469</span></a>      global <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l1470"><span class="linenum">1470</span></a>  
<a name="l1471"><span class="linenum">1471</span></a>      <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a>, <a class="var it5030" onMouseOver="hilite(5030)" onMouseOut="lolite()" onClick="logVariable('new_threads_count')" href="../../../_variables/new_threads_count.html">$new_threads_count</a> ) = <a class="function" onClick="logFunction('get_todays_thread_settings')" href="../../../_functions/get_todays_thread_settings.html" onMouseOver="funcPopup(event,'get_todays_thread_settings')">get_todays_thread_settings</a>();
<a name="l1472"><span class="linenum">1472</span></a>      if( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a> === '0' )
<a name="l1473"><span class="linenum">1473</span></a>      { // user new conversation limit is 0
<a name="l1474"><span class="linenum">1474</span></a>          if( <a class="var it5036" onMouseOver="hilite(5036)" onMouseOut="lolite()" onClick="logVariable('add_message')" href="../../../_variables/add_message.html">$add_message</a> )
<a name="l1475"><span class="linenum">1475</span></a>          {
<a name="l1476"><span class="linenum">1476</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'You are not allowed to start a new conversation, because your limit is 0.' ) );
<a name="l1477"><span class="linenum">1477</span></a>          }
<a name="l1478"><span class="linenum">1478</span></a>          return true;
<a name="l1479"><span class="linenum">1479</span></a>      }
<a name="l1480"><span class="linenum">1480</span></a>  
<a name="l1481"><span class="linenum">1481</span></a>      if( empty( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a> ) )
<a name="l1482"><span class="linenum">1482</span></a>      { // user has no limit
<a name="l1483"><span class="linenum">1483</span></a>          return false;
<a name="l1484"><span class="linenum">1484</span></a>      }
<a name="l1485"><span class="linenum">1485</span></a>  
<a name="l1486"><span class="linenum">1486</span></a>      if( <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a> &gt; <a class="var it5030" onMouseOver="hilite(5030)" onMouseOut="lolite()" onClick="logVariable('new_threads_count')" href="../../../_variables/new_threads_count.html">$new_threads_count</a> )
<a name="l1487"><span class="linenum">1487</span></a>      { // user didn't reach his limit yet
<a name="l1488"><span class="linenum">1488</span></a>          if( <a class="var it5036" onMouseOver="hilite(5036)" onMouseOut="lolite()" onClick="logVariable('add_message')" href="../../../_variables/add_message.html">$add_message</a> )
<a name="l1489"><span class="linenum">1489</span></a>          {
<a name="l1490"><span class="linenum">1490</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'You can still start %d new conversations today.' ), <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a> - <a class="var it5030" onMouseOver="hilite(5030)" onMouseOut="lolite()" onClick="logVariable('new_threads_count')" href="../../../_variables/new_threads_count.html">$new_threads_count</a> ), 'success' );
<a name="l1491"><span class="linenum">1491</span></a>          }
<a name="l1492"><span class="linenum">1492</span></a>          return false;
<a name="l1493"><span class="linenum">1493</span></a>      }
<a name="l1494"><span class="linenum">1494</span></a>  
<a name="l1495"><span class="linenum">1495</span></a>      if( <a class="var it5036" onMouseOver="hilite(5036)" onMouseOut="lolite()" onClick="logVariable('add_message')" href="../../../_variables/add_message.html">$add_message</a> )
<a name="l1496"><span class="linenum">1496</span></a>      { // user has already reached his limit
<a name="l1497"><span class="linenum">1497</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'You have reached the limit of %d new conversations today. You can start new conversations again tomorrow.' ), <a class="var it1075" onMouseOver="hilite(1075)" onMouseOut="lolite()" onClick="logVariable('max_new_threads')" href="../../../_variables/max_new_threads.html">$max_new_threads</a> ) );
<a name="l1498"><span class="linenum">1498</span></a>      }
<a name="l1499"><span class="linenum">1499</span></a>      return true;
<a name="l1500"><span class="linenum">1500</span></a>  }
<a name="l1501"><span class="linenum">1501</span></a>  
<a name="l1502"><span class="linenum">1502</span></a>  
<a name="l1503"><span class="linenum">1503</span></a>  <span class="comment">/**</span>
<a name="l1504"><span class="linenum">1504</span></a>  <span class="comment"> * Get a count of unread messages for the user</span>
<a name="l1505"><span class="linenum">1505</span></a>  <span class="comment"> *</span>
<a name="l1506"><span class="linenum">1506</span></a>  <span class="comment"> * @param integer User ID (0 - current user)</span>
<a name="l1507"><span class="linenum">1507</span></a>  <span class="comment"> * @return integer A count of unread messages</span>
<a name="l1508"><span class="linenum">1508</span></a>  <span class="comment"> */</span>
<a name="l1509"><span class="linenum">1509</span></a>  function <a class="function" onClick="logFunction('get_unread_messages_count')" href="../../../_functions/get_unread_messages_count.html" onMouseOver="funcPopup(event,'get_unread_messages_count')">get_unread_messages_count</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> = 0 )
<a name="l1510"><span class="linenum">1510</span></a>  {
<a name="l1511"><span class="linenum">1511</span></a>      if( empty( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) )
<a name="l1512"><span class="linenum">1512</span></a>      {    // Current user
<a name="l1513"><span class="linenum">1513</span></a>          if( !<a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l1514"><span class="linenum">1514</span></a>          {
<a name="l1515"><span class="linenum">1515</span></a>              return 0;
<a name="l1516"><span class="linenum">1516</span></a>          }
<a name="l1517"><span class="linenum">1517</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l1518"><span class="linenum">1518</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l1519"><span class="linenum">1519</span></a>      }
<a name="l1520"><span class="linenum">1520</span></a>  
<a name="l1521"><span class="linenum">1521</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1522"><span class="linenum">1522</span></a>  
<a name="l1523"><span class="linenum">1523</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1524"><span class="linenum">1524</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*)' );
<a name="l1525"><span class="linenum">1525</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus ts' );
<a name="l1526"><span class="linenum">1526</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'LEFT OUTER JOIN T_messaging__message mu
<a name="l1527"><span class="linenum">1527</span></a>                  ON ts.tsta_first_unread_msg_ID = mu.msg_ID' );
<a name="l1528"><span class="linenum">1528</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_messaging__message mm
<a name="l1529"><span class="linenum">1529</span></a>                  ON ts.tsta_thread_ID = mm.msg_thread_ID
<a name="l1530"><span class="linenum">1530</span></a>                  AND mm.msg_datetime &gt;= mu.msg_datetime' );
<a name="l1531"><span class="linenum">1531</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'ts.tsta_first_unread_msg_ID IS NOT NULL' );
<a name="l1532"><span class="linenum">1532</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'ts.tsta_thread_leave_msg_ID IS NULL OR ts.tsta_first_unread_msg_ID &lt;= tsta_thread_leave_msg_ID' );
<a name="l1533"><span class="linenum">1533</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'ts.tsta_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) );
<a name="l1534"><span class="linenum">1534</span></a>  
<a name="l1535"><span class="linenum">1535</span></a>      return (int) <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1536"><span class="linenum">1536</span></a>  }
<a name="l1537"><span class="linenum">1537</span></a>  
<a name="l1538"><span class="linenum">1538</span></a>  
<a name="l1539"><span class="linenum">1539</span></a>  <span class="comment">/**</span>
<a name="l1540"><span class="linenum">1540</span></a>  <span class="comment"> * Get the first ( oldest ) unread message of the user</span>
<a name="l1541"><span class="linenum">1541</span></a>  <span class="comment"> *</span>
<a name="l1542"><span class="linenum">1542</span></a>  <span class="comment"> * @param integer user ID</span>
<a name="l1543"><span class="linenum">1543</span></a>  <span class="comment"> * @return mixed NULL if the user doesn't have unread messages, or the oldest unread message datetime otherwise</span>
<a name="l1544"><span class="linenum">1544</span></a>  <span class="comment"> */</span>
<a name="l1545"><span class="linenum">1545</span></a>  function <a class="function" onClick="logFunction('get_first_unread_message_date')" href="../../../_functions/get_first_unread_message_date.html" onMouseOver="funcPopup(event,'get_first_unread_message_date')">get_first_unread_message_date</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l1546"><span class="linenum">1546</span></a>  {
<a name="l1547"><span class="linenum">1547</span></a>      if( empty( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) )
<a name="l1548"><span class="linenum">1548</span></a>      {    // Current user
<a name="l1549"><span class="linenum">1549</span></a>          if( !<a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l1550"><span class="linenum">1550</span></a>          {
<a name="l1551"><span class="linenum">1551</span></a>              return NULL;
<a name="l1552"><span class="linenum">1552</span></a>          }
<a name="l1553"><span class="linenum">1553</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l1554"><span class="linenum">1554</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l1555"><span class="linenum">1555</span></a>      }
<a name="l1556"><span class="linenum">1556</span></a>  
<a name="l1557"><span class="linenum">1557</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1558"><span class="linenum">1558</span></a>  
<a name="l1559"><span class="linenum">1559</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1560"><span class="linenum">1560</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('min')" href="../../../_functions/min.html" onMouseOver="phpfuncPopup(event,'min')">min</a>( msg_datetime )' );
<a name="l1561"><span class="linenum">1561</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus ts' );
<a name="l1562"><span class="linenum">1562</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_messaging__message mu
<a name="l1563"><span class="linenum">1563</span></a>                  ON ts.tsta_first_unread_msg_ID = mu.msg_ID' );
<a name="l1564"><span class="linenum">1564</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'ts.tsta_first_unread_msg_ID IS NOT NULL' );
<a name="l1565"><span class="linenum">1565</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'ts.tsta_thread_leave_msg_ID IS NULL OR ts.tsta_first_unread_msg_ID &lt;= ts.tsta_thread_leave_msg_ID' );
<a name="l1566"><span class="linenum">1566</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'ts.tsta_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) );
<a name="l1567"><span class="linenum">1567</span></a>  
<a name="l1568"><span class="linenum">1568</span></a>      return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1569"><span class="linenum">1569</span></a>  }
<a name="l1570"><span class="linenum">1570</span></a>  
<a name="l1571"><span class="linenum">1571</span></a>  
<a name="l1572"><span class="linenum">1572</span></a>  <span class="comment">/**</span>
<a name="l1573"><span class="linenum">1573</span></a>  <span class="comment"> * Get next 'Unread message reminder' datetime information for the given user. This is used on the user admin settings form.</span>
<a name="l1574"><span class="linenum">1574</span></a>  <span class="comment"> *</span>
<a name="l1575"><span class="linenum">1575</span></a>  <span class="comment"> * @param integer user ID</span>
<a name="l1576"><span class="linenum">1576</span></a>  <span class="comment"> * @result mixed string with the info field content if additional note is not required, and array( info, note ) otherwise</span>
<a name="l1577"><span class="linenum">1577</span></a>  <span class="comment"> */</span>
<a name="l1578"><span class="linenum">1578</span></a>  function <a class="function" onClick="logFunction('get_next_reminder_info')" href="../../../_functions/get_next_reminder_info.html" onMouseOver="funcPopup(event,'get_next_reminder_info')">get_next_reminder_info</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l1579"><span class="linenum">1579</span></a>  {
<a name="l1580"><span class="linenum">1580</span></a>      global <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>, <a class="var it2941" onMouseOver="hilite(2941)" onMouseOut="lolite()" onClick="logVariable('unread_message_reminder_delay')" href="../../../_variables/unread_message_reminder_delay.html">$unread_message_reminder_delay</a>, <a class="var it2942" onMouseOver="hilite(2942)" onMouseOut="lolite()" onClick="logVariable('unread_messsage_reminder_threshold')" href="../../../_variables/unread_messsage_reminder_threshold.html">$unread_messsage_reminder_threshold</a>;
<a name="l1581"><span class="linenum">1581</span></a>  
<a name="l1582"><span class="linenum">1582</span></a>      if( ! <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notify_unread_messages', <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) )
<a name="l1583"><span class="linenum">1583</span></a>      { // The user doesn't want to recive unread messages reminders
<a name="l1584"><span class="linenum">1584</span></a>          return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('This user doesn\'t want to receive notification emails about unread messages.');
<a name="l1585"><span class="linenum">1585</span></a>      }
<a name="l1586"><span class="linenum">1586</span></a>  
<a name="l1587"><span class="linenum">1587</span></a>      <a class="var it5037" onMouseOver="hilite(5037)" onMouseOut="lolite()" onClick="logVariable('first_unread_message_date')" href="../../../_variables/first_unread_message_date.html">$first_unread_message_date</a> = <a class="function" onClick="logFunction('get_first_unread_message_date')" href="../../../_functions/get_first_unread_message_date.html" onMouseOver="funcPopup(event,'get_first_unread_message_date')">get_first_unread_message_date</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l1588"><span class="linenum">1588</span></a>      if( empty( <a class="var it5037" onMouseOver="hilite(5037)" onMouseOut="lolite()" onClick="logVariable('first_unread_message_date')" href="../../../_variables/first_unread_message_date.html">$first_unread_message_date</a> ) )
<a name="l1589"><span class="linenum">1589</span></a>      { // The user doesn't have unread messages
<a name="l1590"><span class="linenum">1590</span></a>          return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('This user doesn\'t have unread messages.');
<a name="l1591"><span class="linenum">1591</span></a>      }
<a name="l1592"><span class="linenum">1592</span></a>  
<a name="l1593"><span class="linenum">1593</span></a>  <span class="comment">    // We assume that reminder is not delayed because of the user was not logged in since too many days</span>
<a name="l1594"><span class="linenum">1594</span></a>      <a class="var it5038" onMouseOver="hilite(5038)" onMouseOut="lolite()" onClick="logVariable('reminder_is_delayed')" href="../../../_variables/reminder_is_delayed.html">$reminder_is_delayed</a> = false;
<a name="l1595"><span class="linenum">1595</span></a>      <a class="var it5039" onMouseOver="hilite(5039)" onMouseOut="lolite()" onClick="logVariable('last_unread_messages_reminder')" href="../../../_variables/last_unread_messages_reminder.html">$last_unread_messages_reminder</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'last_unread_messages_reminder', <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l1596"><span class="linenum">1596</span></a>      if( empty( <a class="var it5039" onMouseOver="hilite(5039)" onMouseOut="lolite()" onClick="logVariable('last_unread_messages_reminder')" href="../../../_variables/last_unread_messages_reminder.html">$last_unread_messages_reminder</a> ) )
<a name="l1597"><span class="linenum">1597</span></a>      { // User didn't get <span class="keyword">new </span><a class="class" onClick="logClass('message')" href="../../../_classes/message.html" onMouseOver="classPopup(event,'message')">message</a> notification or unread message reminder yet
<a name="l1598"><span class="linenum">1598</span></a>  <span class="comment">        // Set reminder issue timestamp to one day after the first unread message was received</span>
<a name="l1599"><span class="linenum">1599</span></a>          <a class="var it5040" onMouseOver="hilite(5040)" onMouseOut="lolite()" onClick="logVariable('reminder_issue_ts')" href="../../../_variables/reminder_issue_ts.html">$reminder_issue_ts</a> = <a class="phpfunction" onClick="logFunction('strtotime')" href="../../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( '+1 day', <a class="phpfunction" onClick="logFunction('strtotime')" href="../../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( <a class="var it5037" onMouseOver="hilite(5037)" onMouseOut="lolite()" onClick="logVariable('first_unread_message_date')" href="../../../_variables/first_unread_message_date.html">$first_unread_message_date</a> ) );
<a name="l1600"><span class="linenum">1600</span></a>      }
<a name="l1601"><span class="linenum">1601</span></a>      else
<a name="l1602"><span class="linenum">1602</span></a>      { // Count next unread message reminder date, this can be delayed if the edited User didn't logged in since many days
<a name="l1603"><span class="linenum">1603</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l1604"><span class="linenum">1604</span></a>          <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a> = &amp; <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_ID( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l1605"><span class="linenum">1605</span></a>          <a class="var it630" onMouseOver="hilite(630)" onMouseOut="lolite()" onClick="logVariable('lastseen_ts')" href="../../../_variables/lastseen_ts.html">$lastseen_ts</a> = <a class="phpfunction" onClick="logFunction('strtotime')" href="../../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'lastseen_ts' ) );
<a name="l1606"><span class="linenum">1606</span></a>          <a class="var it2949" onMouseOver="hilite(2949)" onMouseOut="lolite()" onClick="logVariable('days_since_lastseen')" href="../../../_variables/days_since_lastseen.html">$days_since_lastseen</a> = <a class="phpfunction" onClick="logFunction('floor')" href="../../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>(( <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> - <a class="var it630" onMouseOver="hilite(630)" onMouseOut="lolite()" onClick="logVariable('lastseen_ts')" href="../../../_variables/lastseen_ts.html">$lastseen_ts</a> )/(60*60*24));
<a name="l1607"><span class="linenum">1607</span></a>  <span class="comment">        // Presuppose that the User was not logged in since so many days, that should not get reminder any more</span>
<a name="l1608"><span class="linenum">1608</span></a>          <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('dont_send_reminder')" href="../../../_variables/dont_send_reminder.html">$dont_send_reminder</a> = true;
<a name="l1609"><span class="linenum">1609</span></a>  <span class="comment">        // Get the number of delayed days for that case when we have to space out the notifications</span>
<a name="l1610"><span class="linenum">1610</span></a>          foreach( <a class="var it2941" onMouseOver="hilite(2941)" onMouseOut="lolite()" onClick="logVariable('unread_message_reminder_delay')" href="../../../_variables/unread_message_reminder_delay.html">$unread_message_reminder_delay</a> as <a class="var it2952" onMouseOver="hilite(2952)" onMouseOut="lolite()" onClick="logVariable('lastseen')" href="../../../_variables/lastseen.html">$lastseen</a> =&gt; <a class="var it2953" onMouseOver="hilite(2953)" onMouseOut="lolite()" onClick="logVariable('delay')" href="../../../_variables/delay.html">$delay</a> )
<a name="l1611"><span class="linenum">1611</span></a>          { // Get the corresponding number of delay for the edited User
<a name="l1612"><span class="linenum">1612</span></a>              if( <a class="var it2949" onMouseOver="hilite(2949)" onMouseOut="lolite()" onClick="logVariable('days_since_lastseen')" href="../../../_variables/days_since_lastseen.html">$days_since_lastseen</a> &lt; <a class="var it2952" onMouseOver="hilite(2952)" onMouseOut="lolite()" onClick="logVariable('lastseen')" href="../../../_variables/lastseen.html">$lastseen</a> )
<a name="l1613"><span class="linenum">1613</span></a>              { // We have found the correct delay value, reminders should be sent
<a name="l1614"><span class="linenum">1614</span></a>                  <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('dont_send_reminder')" href="../../../_variables/dont_send_reminder.html">$dont_send_reminder</a> = false;
<a name="l1615"><span class="linenum">1615</span></a>                  break;
<a name="l1616"><span class="linenum">1616</span></a>              }
<a name="l1617"><span class="linenum">1617</span></a>  <span class="comment">            // The reminder is delayed because the user was not logged in since more days then the first key of the delay array</span>
<a name="l1618"><span class="linenum">1618</span></a>              <a class="var it5038" onMouseOver="hilite(5038)" onMouseOut="lolite()" onClick="logVariable('reminder_is_delayed')" href="../../../_variables/reminder_is_delayed.html">$reminder_is_delayed</a> = true;
<a name="l1619"><span class="linenum">1619</span></a>          }
<a name="l1620"><span class="linenum">1620</span></a>          if( <a class="var it2951" onMouseOver="hilite(2951)" onMouseOut="lolite()" onClick="logVariable('dont_send_reminder')" href="../../../_variables/dont_send_reminder.html">$dont_send_reminder</a> )
<a name="l1621"><span class="linenum">1621</span></a>          { // User was not logged in since too long
<a name="l1622"><span class="linenum">1622</span></a>              return sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The user has not logged in for %d days, so we will not send him notifications any more'), <a class="var it2949" onMouseOver="hilite(2949)" onMouseOut="lolite()" onClick="logVariable('days_since_lastseen')" href="../../../_variables/days_since_lastseen.html">$days_since_lastseen</a> );
<a name="l1623"><span class="linenum">1623</span></a>          }
<a name="l1624"><span class="linenum">1624</span></a>  
<a name="l1625"><span class="linenum">1625</span></a>  <span class="comment">        // Set reminder issue timestamp to x days after the last unread message notification date, where x is the delay from the configuration array</span>
<a name="l1626"><span class="linenum">1626</span></a>          <a class="var it5040" onMouseOver="hilite(5040)" onMouseOut="lolite()" onClick="logVariable('reminder_issue_ts')" href="../../../_variables/reminder_issue_ts.html">$reminder_issue_ts</a> = <a class="phpfunction" onClick="logFunction('strtotime')" href="../../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( '+'.<a class="var it2953" onMouseOver="hilite(2953)" onMouseOut="lolite()" onClick="logVariable('delay')" href="../../../_variables/delay.html">$delay</a>.' day', <a class="phpfunction" onClick="logFunction('strtotime')" href="../../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( <a class="var it5039" onMouseOver="hilite(5039)" onMouseOut="lolite()" onClick="logVariable('last_unread_messages_reminder')" href="../../../_variables/last_unread_messages_reminder.html">$last_unread_messages_reminder</a> ) );
<a name="l1627"><span class="linenum">1627</span></a>      }
<a name="l1628"><span class="linenum">1628</span></a>  
<a name="l1629"><span class="linenum">1629</span></a>      if( <a class="var it5040" onMouseOver="hilite(5040)" onMouseOut="lolite()" onClick="logVariable('reminder_issue_ts')" href="../../../_variables/reminder_issue_ts.html">$reminder_issue_ts</a> &gt; <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> )
<a name="l1630"><span class="linenum">1630</span></a>      { // The next reminder issue date is in the future
<a name="l1631"><span class="linenum">1631</span></a>          <a class="var it3310" onMouseOver="hilite(3310)" onMouseOut="lolite()" onClick="logVariable('time_left')" href="../../../_variables/time_left.html">$time_left</a> = <a class="function" onClick="logFunction('seconds_to_period')" href="../../../_functions/seconds_to_period.html" onMouseOver="funcPopup(event,'seconds_to_period')">seconds_to_period</a>( <a class="var it5040" onMouseOver="hilite(5040)" onMouseOut="lolite()" onClick="logVariable('reminder_issue_ts')" href="../../../_variables/reminder_issue_ts.html">$reminder_issue_ts</a> - <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> );
<a name="l1632"><span class="linenum">1632</span></a>          <a class="var it1133" onMouseOver="hilite(1133)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%s left before next notification - sent by &quot;Send reminders about unread messages&quot; scheduled job'), <a class="var it3310" onMouseOver="hilite(3310)" onMouseOut="lolite()" onClick="logVariable('time_left')" href="../../../_variables/time_left.html">$time_left</a> );
<a name="l1633"><span class="linenum">1633</span></a>      }
<a name="l1634"><span class="linenum">1634</span></a>      else
<a name="l1635"><span class="linenum">1635</span></a>      { // The next reminder issue date was in the past
<a name="l1636"><span class="linenum">1636</span></a>          <a class="var it3311" onMouseOver="hilite(3311)" onMouseOut="lolite()" onClick="logVariable('time_since')" href="../../../_variables/time_since.html">$time_since</a> = <a class="function" onClick="logFunction('seconds_to_period')" href="../../../_functions/seconds_to_period.html" onMouseOver="funcPopup(event,'seconds_to_period')">seconds_to_period</a>( <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> - <a class="var it5040" onMouseOver="hilite(5040)" onMouseOut="lolite()" onClick="logVariable('reminder_issue_ts')" href="../../../_variables/reminder_issue_ts.html">$reminder_issue_ts</a> );
<a name="l1637"><span class="linenum">1637</span></a>          <a class="var it1133" onMouseOver="hilite(1133)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('next notification pending since %s - check the &quot;Send reminders about unread messages&quot; scheduled job'), <a class="var it3311" onMouseOver="hilite(3311)" onMouseOut="lolite()" onClick="logVariable('time_since')" href="../../../_variables/time_since.html">$time_since</a> );
<a name="l1638"><span class="linenum">1638</span></a>      }
<a name="l1639"><span class="linenum">1639</span></a>  
<a name="l1640"><span class="linenum">1640</span></a>      if( <a class="var it5038" onMouseOver="hilite(5038)" onMouseOut="lolite()" onClick="logVariable('reminder_is_delayed')" href="../../../_variables/reminder_is_delayed.html">$reminder_is_delayed</a> )
<a name="l1641"><span class="linenum">1641</span></a>      { // Reminder is delayed, add a note about this
<a name="l1642"><span class="linenum">1642</span></a>          <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../../_variables/note.html">$note</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The user has not logged in for %d days, so we will space out notifications by %d days.'), <a class="var it2949" onMouseOver="hilite(2949)" onMouseOut="lolite()" onClick="logVariable('days_since_lastseen')" href="../../../_variables/days_since_lastseen.html">$days_since_lastseen</a>, <a class="var it2953" onMouseOver="hilite(2953)" onMouseOut="lolite()" onClick="logVariable('delay')" href="../../../_variables/delay.html">$delay</a> );
<a name="l1643"><span class="linenum">1643</span></a>      }
<a name="l1644"><span class="linenum">1644</span></a>      elseif( empty( <a class="var it5039" onMouseOver="hilite(5039)" onMouseOut="lolite()" onClick="logVariable('last_unread_messages_reminder')" href="../../../_variables/last_unread_messages_reminder.html">$last_unread_messages_reminder</a> ) )
<a name="l1645"><span class="linenum">1645</span></a>      { // The user didn't get unread messages reminder emails before
<a name="l1646"><span class="linenum">1646</span></a>          <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../../_variables/note.html">$note</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The user has never received a notification yet, so the first notification is sent with %s delay'), <a class="function" onClick="logFunction('seconds_to_period')" href="../../../_functions/seconds_to_period.html" onMouseOver="funcPopup(event,'seconds_to_period')">seconds_to_period</a>( <a class="var it2942" onMouseOver="hilite(2942)" onMouseOut="lolite()" onClick="logVariable('unread_messsage_reminder_threshold')" href="../../../_variables/unread_messsage_reminder_threshold.html">$unread_messsage_reminder_threshold</a> ) );
<a name="l1647"><span class="linenum">1647</span></a>      }
<a name="l1648"><span class="linenum">1648</span></a>      else
<a name="l1649"><span class="linenum">1649</span></a>      { // Reminder is not delayed
<a name="l1650"><span class="linenum">1650</span></a>          <a class="phpfunction" onClick="logFunction('reset')" href="../../../_functions/reset.html" onMouseOver="phpfuncPopup(event,'reset')">reset</a>( <a class="var it2941" onMouseOver="hilite(2941)" onMouseOut="lolite()" onClick="logVariable('unread_message_reminder_delay')" href="../../../_variables/unread_message_reminder_delay.html">$unread_message_reminder_delay</a> );
<a name="l1651"><span class="linenum">1651</span></a>          <a class="var it5041" onMouseOver="hilite(5041)" onMouseOut="lolite()" onClick="logVariable('lasstseen_threshold')" href="../../../_variables/lasstseen_threshold.html">$lasstseen_threshold</a> = <a class="phpfunction" onClick="logFunction('key')" href="../../../_functions/key.html" onMouseOver="phpfuncPopup(event,'key')">key</a>( <a class="var it2941" onMouseOver="hilite(2941)" onMouseOut="lolite()" onClick="logVariable('unread_message_reminder_delay')" href="../../../_variables/unread_message_reminder_delay.html">$unread_message_reminder_delay</a> );
<a name="l1652"><span class="linenum">1652</span></a>          <a class="var it2953" onMouseOver="hilite(2953)" onMouseOut="lolite()" onClick="logVariable('delay')" href="../../../_variables/delay.html">$delay</a> = <a class="var it2941" onMouseOver="hilite(2941)" onMouseOut="lolite()" onClick="logVariable('unread_message_reminder_delay')" href="../../../_variables/unread_message_reminder_delay.html">$unread_message_reminder_delay</a>[<a class="var it5041" onMouseOver="hilite(5041)" onMouseOut="lolite()" onClick="logVariable('lasstseen_threshold')" href="../../../_variables/lasstseen_threshold.html">$lasstseen_threshold</a>];
<a name="l1653"><span class="linenum">1653</span></a>          <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../../_variables/note.html">$note</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The user has logged in in the last %d days, so we will space out notifications by %d days.'), <a class="var it5041" onMouseOver="hilite(5041)" onMouseOut="lolite()" onClick="logVariable('lasstseen_threshold')" href="../../../_variables/lasstseen_threshold.html">$lasstseen_threshold</a>, <a class="var it2953" onMouseOver="hilite(2953)" onMouseOut="lolite()" onClick="logVariable('delay')" href="../../../_variables/delay.html">$delay</a> );
<a name="l1654"><span class="linenum">1654</span></a>      }
<a name="l1655"><span class="linenum">1655</span></a>  
<a name="l1656"><span class="linenum">1656</span></a>      return array( <a class="var it1133" onMouseOver="hilite(1133)" onMouseOut="lolite()" onClick="logVariable('info')" href="../../../_variables/info.html">$info</a>, <a class="var it1068" onMouseOver="hilite(1068)" onMouseOut="lolite()" onClick="logVariable('note')" href="../../../_variables/note.html">$note</a> );
<a name="l1657"><span class="linenum">1657</span></a>  }
<a name="l1658"><span class="linenum">1658</span></a>  
<a name="l1659"><span class="linenum">1659</span></a>  
<a name="l1660"><span class="linenum">1660</span></a>  <span class="comment">/**</span>
<a name="l1661"><span class="linenum">1661</span></a>  <span class="comment"> * Mark a thread as read by the given user.</span>
<a name="l1662"><span class="linenum">1662</span></a>  <span class="comment"> *</span>
<a name="l1663"><span class="linenum">1663</span></a>  <span class="comment"> * @param integer thread ID</span>
<a name="l1664"><span class="linenum">1664</span></a>  <span class="comment"> * @param integer user ID</span>
<a name="l1665"><span class="linenum">1665</span></a>  <span class="comment"> */</span>
<a name="l1666"><span class="linenum">1666</span></a>  function <a class="function" onClick="logFunction('mark_as_read_by_user')" href="../../../_functions/mark_as_read_by_user.html" onMouseOver="funcPopup(event,'mark_as_read_by_user')">mark_as_read_by_user</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l1667"><span class="linenum">1667</span></a>  {
<a name="l1668"><span class="linenum">1668</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1669"><span class="linenum">1669</span></a>  
<a name="l1670"><span class="linenum">1670</span></a>  <span class="comment">    // Update user unread message status in the given thread</span>
<a name="l1671"><span class="linenum">1671</span></a>      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_messaging__threadstatus
<a name="l1672"><span class="linenum">1672</span></a>                      SET tsta_first_unread_msg_ID = NULL
<a name="l1673"><span class="linenum">1673</span></a>                      WHERE tsta_thread_ID = '.<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>.'
<a name="l1674"><span class="linenum">1674</span></a>                      AND tsta_user_ID = '.<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> );
<a name="l1675"><span class="linenum">1675</span></a>  }
<a name="l1676"><span class="linenum">1676</span></a>  
<a name="l1677"><span class="linenum">1677</span></a>  
<a name="l1678"><span class="linenum">1678</span></a>  <span class="comment">/**</span>
<a name="l1679"><span class="linenum">1679</span></a>  <span class="comment"> * Delete orphan threads</span>
<a name="l1680"><span class="linenum">1680</span></a>  <span class="comment"> *</span>
<a name="l1681"><span class="linenum">1681</span></a>  <span class="comment"> * @param integer or array of integers - one or multiple user ids - to delete those orphan threads where only the given user(s) was/were involved, leave it to NULL to delete all orphan threads</span>
<a name="l1682"><span class="linenum">1682</span></a>  <span class="comment"> * @return boolean true on success</span>
<a name="l1683"><span class="linenum">1683</span></a>  <span class="comment"> */</span>
<a name="l1684"><span class="linenum">1684</span></a>  function <a class="function" onClick="logFunction('delete_orphan_threads')" href="../../../_functions/delete_orphan_threads.html" onMouseOver="funcPopup(event,'delete_orphan_threads')">delete_orphan_threads</a>( <a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> = NULL )
<a name="l1685"><span class="linenum">1685</span></a>  {
<a name="l1686"><span class="linenum">1686</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1687"><span class="linenum">1687</span></a>  
<a name="l1688"><span class="linenum">1688</span></a>      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l1689"><span class="linenum">1689</span></a>  
<a name="l1690"><span class="linenum">1690</span></a>      if( <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>( <a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> ) )
<a name="l1691"><span class="linenum">1691</span></a>      {
<a name="l1692"><span class="linenum">1692</span></a>          <a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> );
<a name="l1693"><span class="linenum">1693</span></a>          <a class="var it5042" onMouseOver="hilite(5042)" onMouseOut="lolite()" onClick="logVariable('in_users_condition')" href="../../../_variables/in_users_condition.html">$in_users_condition</a> = ' OR user_ID IN ( '.<a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a>.' )';
<a name="l1694"><span class="linenum">1694</span></a>          <a class="var it5043" onMouseOver="hilite(5043)" onMouseOut="lolite()" onClick="logVariable('not_in_users_condition')" href="../../../_variables/not_in_users_condition.html">$not_in_users_condition</a> = ' AND user_ID NOT IN ( '.<a class="var it536" onMouseOver="hilite(536)" onMouseOut="lolite()" onClick="logVariable('users')" href="../../../_variables/users.html">$users</a>.' )';
<a name="l1695"><span class="linenum">1695</span></a>      }
<a name="l1696"><span class="linenum">1696</span></a>      else
<a name="l1697"><span class="linenum">1697</span></a>      {
<a name="l1698"><span class="linenum">1698</span></a>          <a class="var it5042" onMouseOver="hilite(5042)" onMouseOut="lolite()" onClick="logVariable('in_users_condition')" href="../../../_variables/in_users_condition.html">$in_users_condition</a> = <a class="function" onClick="logFunction('is_number')" href="../../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>( <a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> ) ? ' OR user_ID = '.<a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> : '';
<a name="l1699"><span class="linenum">1699</span></a>          <a class="var it5043" onMouseOver="hilite(5043)" onMouseOut="lolite()" onClick="logVariable('not_in_users_condition')" href="../../../_variables/not_in_users_condition.html">$not_in_users_condition</a> = <a class="function" onClick="logFunction('is_number')" href="../../../_functions/is_number.html" onMouseOver="funcPopup(event,'is_number')">is_number</a>( <a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> ) ? ' AND user_ID != '.<a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> : '';
<a name="l1700"><span class="linenum">1700</span></a>      }
<a name="l1701"><span class="linenum">1701</span></a>  
<a name="l1702"><span class="linenum">1702</span></a>  <span class="comment">    // Get those thread ids which have already deleted participants or which participants will be deleted now</span>
<a name="l1703"><span class="linenum">1703</span></a>      <a class="var it5044" onMouseOver="hilite(5044)" onMouseOut="lolite()" onClick="logVariable('affected_threads_ids')" href="../../../_variables/affected_threads_ids.html">$affected_threads_ids</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>(
<a name="l1704"><span class="linenum">1704</span></a>          'SELECT DISTINCT tsta_thread_ID
<a name="l1705"><span class="linenum">1705</span></a>          FROM T_messaging__threadstatus
<a name="l1706"><span class="linenum">1706</span></a>          LEFT JOIN T_users ON tsta_user_ID = user_ID
<a name="l1707"><span class="linenum">1707</span></a>          WHERE user_ID IS NULL'.<a class="var it5042" onMouseOver="hilite(5042)" onMouseOut="lolite()" onClick="logVariable('in_users_condition')" href="../../../_variables/in_users_condition.html">$in_users_condition</a> );
<a name="l1708"><span class="linenum">1708</span></a>  
<a name="l1709"><span class="linenum">1709</span></a>      if( empty( <a class="var it5044" onMouseOver="hilite(5044)" onMouseOut="lolite()" onClick="logVariable('affected_threads_ids')" href="../../../_variables/affected_threads_ids.html">$affected_threads_ids</a> ) )
<a name="l1710"><span class="linenum">1710</span></a>      { // There are no affected thread ids, nothing to delete
<a name="l1711"><span class="linenum">1711</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l1712"><span class="linenum">1712</span></a>          return true;
<a name="l1713"><span class="linenum">1713</span></a>      }
<a name="l1714"><span class="linenum">1714</span></a>  
<a name="l1715"><span class="linenum">1715</span></a>  <span class="comment">    // Filter previously collected thread ids to get those which have existing users outside of the deleted ones</span>
<a name="l1716"><span class="linenum">1716</span></a>      <a class="var it5045" onMouseOver="hilite(5045)" onMouseOut="lolite()" onClick="logVariable('not_orphan_threads')" href="../../../_variables/not_orphan_threads.html">$not_orphan_threads</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>(
<a name="l1717"><span class="linenum">1717</span></a>          'SELECT DISTINCT tsta_thread_ID
<a name="l1718"><span class="linenum">1718</span></a>          FROM T_messaging__threadstatus
<a name="l1719"><span class="linenum">1719</span></a>          LEFT JOIN T_users ON tsta_user_ID = user_ID
<a name="l1720"><span class="linenum">1720</span></a>          WHERE tsta_thread_ID IN ( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it5044" onMouseOver="hilite(5044)" onMouseOut="lolite()" onClick="logVariable('affected_threads_ids')" href="../../../_variables/affected_threads_ids.html">$affected_threads_ids</a> ).' )
<a name="l1721"><span class="linenum">1721</span></a>              AND user_ID IS NOT NULL'.<a class="var it5043" onMouseOver="hilite(5043)" onMouseOut="lolite()" onClick="logVariable('not_in_users_condition')" href="../../../_variables/not_in_users_condition.html">$not_in_users_condition</a> );
<a name="l1722"><span class="linenum">1722</span></a>  
<a name="l1723"><span class="linenum">1723</span></a>  <span class="comment">    // Orphan thread ids are the affected threads minus the ones with existing users</span>
<a name="l1724"><span class="linenum">1724</span></a>      <a class="var it4735" onMouseOver="hilite(4735)" onMouseOut="lolite()" onClick="logVariable('orphan_thread_ids')" href="../../../_variables/orphan_thread_ids.html">$orphan_thread_ids</a> = <a class="phpfunction" onClick="logFunction('array_diff')" href="../../../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>( <a class="var it5044" onMouseOver="hilite(5044)" onMouseOut="lolite()" onClick="logVariable('affected_threads_ids')" href="../../../_variables/affected_threads_ids.html">$affected_threads_ids</a>, <a class="var it5045" onMouseOver="hilite(5045)" onMouseOut="lolite()" onClick="logVariable('not_orphan_threads')" href="../../../_variables/not_orphan_threads.html">$not_orphan_threads</a> );
<a name="l1725"><span class="linenum">1725</span></a>  
<a name="l1726"><span class="linenum">1726</span></a>      if( ! empty( <a class="var it4735" onMouseOver="hilite(4735)" onMouseOut="lolite()" onClick="logVariable('orphan_thread_ids')" href="../../../_variables/orphan_thread_ids.html">$orphan_thread_ids</a> ) )
<a name="l1727"><span class="linenum">1727</span></a>      { // There are orphan threads ( or orphan thread targets )
<a name="l1728"><span class="linenum">1728</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'messaging/model/_thread.class.php', 'Thread' );
<a name="l1729"><span class="linenum">1729</span></a>  <span class="comment">        // Delete all orphan threads with all cascade relations</span>
<a name="l1730"><span class="linenum">1730</span></a>          if( <a class="class" onClick="logClass('Thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">Thread</a>::<a class="function" onClick="logFunction('db_delete_where')" href="../../../_functions/db_delete_where.html" onMouseOver="funcPopup(event,'db_delete_where')">db_delete_where</a>( 'Thread', NULL, <a class="var it4735" onMouseOver="hilite(4735)" onMouseOut="lolite()" onClick="logVariable('orphan_thread_ids')" href="../../../_variables/orphan_thread_ids.html">$orphan_thread_ids</a>, array( 'use_transaction' =&gt; false ) ) === false )
<a name="l1731"><span class="linenum">1731</span></a>          { // Deleting orphan threads failed
<a name="l1732"><span class="linenum">1732</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l1733"><span class="linenum">1733</span></a>              return false;
<a name="l1734"><span class="linenum">1734</span></a>          }
<a name="l1735"><span class="linenum">1735</span></a>      }
<a name="l1736"><span class="linenum">1736</span></a>  
<a name="l1737"><span class="linenum">1737</span></a>      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l1738"><span class="linenum">1738</span></a>      return true;
<a name="l1739"><span class="linenum">1739</span></a>  }
<a name="l1740"><span class="linenum">1740</span></a>  
<a name="l1741"><span class="linenum">1741</span></a>  
<a name="l1742"><span class="linenum">1742</span></a>  <span class="comment">/**</span>
<a name="l1743"><span class="linenum">1743</span></a>  <span class="comment"> * Get ID of previous/next thread</span>
<a name="l1744"><span class="linenum">1744</span></a>  <span class="comment"> *</span>
<a name="l1745"><span class="linenum">1745</span></a>  <span class="comment"> * @param integer Current thread ID</span>
<a name="l1746"><span class="linenum">1746</span></a>  <span class="comment"> * @param string Type of url ('prev', 'next')</span>
<a name="l1747"><span class="linenum">1747</span></a>  <span class="comment"> * @return integer Thread ID</span>
<a name="l1748"><span class="linenum">1748</span></a>  <span class="comment"> */</span>
<a name="l1749"><span class="linenum">1749</span></a>  function <a class="function" onClick="logFunction('get_thread_prevnext_ID')" href="../../../_functions/get_thread_prevnext_id.html" onMouseOver="funcPopup(event,'get_thread_prevnext_id')">get_thread_prevnext_ID</a>( <a class="var it5046" onMouseOver="hilite(5046)" onMouseOut="lolite()" onClick="logVariable('current_thread_ID')" href="../../../_variables/current_thread_ID.html">$current_thread_ID</a>, <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> = 'prev' )
<a name="l1750"><span class="linenum">1750</span></a>  {
<a name="l1751"><span class="linenum">1751</span></a>      global <a class="var it5047" onMouseOver="hilite(5047)" onMouseOut="lolite()" onClick="logVariable('thread_prevnext_ids_cache')" href="../../../_variables/thread_prevnext_ids_cache.html">$thread_prevnext_ids_cache</a>;
<a name="l1752"><span class="linenum">1752</span></a>  
<a name="l1753"><span class="linenum">1753</span></a>      if( empty( <a class="var it5046" onMouseOver="hilite(5046)" onMouseOut="lolite()" onClick="logVariable('current_thread_ID')" href="../../../_variables/current_thread_ID.html">$current_thread_ID</a> ) )
<a name="l1754"><span class="linenum">1754</span></a>      {
<a name="l1755"><span class="linenum">1755</span></a>          return false;
<a name="l1756"><span class="linenum">1756</span></a>      }
<a name="l1757"><span class="linenum">1757</span></a>  
<a name="l1758"><span class="linenum">1758</span></a>      if( !isset( <a class="var it5047" onMouseOver="hilite(5047)" onMouseOut="lolite()" onClick="logVariable('thread_prevnext_ids_cache')" href="../../../_variables/thread_prevnext_ids_cache.html">$thread_prevnext_ids_cache</a> ) )
<a name="l1759"><span class="linenum">1759</span></a>      {    // Initialize list with threads IDs
<a name="l1760"><span class="linenum">1760</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1761"><span class="linenum">1761</span></a>  
<a name="l1762"><span class="linenum">1762</span></a>          <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a> = <a class="function" onClick="logFunction('get_threads_results')" href="../../../_functions/get_threads_results.html" onMouseOver="funcPopup(event,'get_threads_results')">get_threads_results</a>( array(
<a name="l1763"><span class="linenum">1763</span></a>                  'only_sql' =&gt; true
<a name="l1764"><span class="linenum">1764</span></a>              ) );
<a name="l1765"><span class="linenum">1765</span></a>  
<a name="l1766"><span class="linenum">1766</span></a>          <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'thrd_ID' );
<a name="l1767"><span class="linenum">1767</span></a>          <a class="var it5047" onMouseOver="hilite(5047)" onMouseOut="lolite()" onClick="logVariable('thread_prevnext_ids_cache')" href="../../../_variables/thread_prevnext_ids_cache.html">$thread_prevnext_ids_cache</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it5010" onMouseOver="hilite(5010)" onMouseOut="lolite()" onClick="logVariable('threads_SQL')" href="../../../_variables/threads_SQL.html">$threads_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1768"><span class="linenum">1768</span></a>      }
<a name="l1769"><span class="linenum">1769</span></a>  
<a name="l1770"><span class="linenum">1770</span></a>      <a class="var it5048" onMouseOver="hilite(5048)" onMouseOut="lolite()" onClick="logVariable('side_thread_i')" href="../../../_variables/side_thread_i.html">$side_thread_i</a> = ( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> == 'prev' ) ? 1 : -1;
<a name="l1771"><span class="linenum">1771</span></a>      foreach( <a class="var it5047" onMouseOver="hilite(5047)" onMouseOut="lolite()" onClick="logVariable('thread_prevnext_ids_cache')" href="../../../_variables/thread_prevnext_ids_cache.html">$thread_prevnext_ids_cache</a> as <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('t')" href="../../../_variables/t.html">$t</a> =&gt; <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> )
<a name="l1772"><span class="linenum">1772</span></a>      {
<a name="l1773"><span class="linenum">1773</span></a>          if( isset( <a class="var it5047" onMouseOver="hilite(5047)" onMouseOut="lolite()" onClick="logVariable('thread_prevnext_ids_cache')" href="../../../_variables/thread_prevnext_ids_cache.html">$thread_prevnext_ids_cache</a>[ <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('t')" href="../../../_variables/t.html">$t</a> + <a class="var it5048" onMouseOver="hilite(5048)" onMouseOut="lolite()" onClick="logVariable('side_thread_i')" href="../../../_variables/side_thread_i.html">$side_thread_i</a> ] ) &amp;&amp; <a class="var it5047" onMouseOver="hilite(5047)" onMouseOut="lolite()" onClick="logVariable('thread_prevnext_ids_cache')" href="../../../_variables/thread_prevnext_ids_cache.html">$thread_prevnext_ids_cache</a>[ <a class="var it267" onMouseOver="hilite(267)" onMouseOut="lolite()" onClick="logVariable('t')" href="../../../_variables/t.html">$t</a> + <a class="var it5048" onMouseOver="hilite(5048)" onMouseOut="lolite()" onClick="logVariable('side_thread_i')" href="../../../_variables/side_thread_i.html">$side_thread_i</a> ] == <a class="var it5046" onMouseOver="hilite(5046)" onMouseOut="lolite()" onClick="logVariable('current_thread_ID')" href="../../../_variables/current_thread_ID.html">$current_thread_ID</a> )
<a name="l1774"><span class="linenum">1774</span></a>          {    // This thread is previous/next for current thread
<a name="l1775"><span class="linenum">1775</span></a>              return <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a>;
<a name="l1776"><span class="linenum">1776</span></a>          }
<a name="l1777"><span class="linenum">1777</span></a>      }
<a name="l1778"><span class="linenum">1778</span></a>  }
<a name="l1779"><span class="linenum">1779</span></a>  
<a name="l1780"><span class="linenum">1780</span></a>  
<a name="l1781"><span class="linenum">1781</span></a>  <span class="comment">/**</span>
<a name="l1782"><span class="linenum">1782</span></a>  <span class="comment"> * Get the links for previous/next threads</span>
<a name="l1783"><span class="linenum">1783</span></a>  <span class="comment"> *</span>
<a name="l1784"><span class="linenum">1784</span></a>  <span class="comment"> * @param integer Current thread ID</span>
<a name="l1785"><span class="linenum">1785</span></a>  <span class="comment"> * @param string Type of url ('prev', 'next')</span>
<a name="l1786"><span class="linenum">1786</span></a>  <span class="comment"> * @return integer Thread ID</span>
<a name="l1787"><span class="linenum">1787</span></a>  <span class="comment"> */</span>
<a name="l1788"><span class="linenum">1788</span></a>  function <a class="function" onClick="logFunction('get_thread_prevnext_links')" href="../../../_functions/get_thread_prevnext_links.html" onMouseOver="funcPopup(event,'get_thread_prevnext_links')">get_thread_prevnext_links</a>( <a class="var it5046" onMouseOver="hilite(5046)" onMouseOut="lolite()" onClick="logVariable('current_thread_ID')" href="../../../_variables/current_thread_ID.html">$current_thread_ID</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l1789"><span class="linenum">1789</span></a>  {
<a name="l1790"><span class="linenum">1790</span></a>      <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l1791"><span class="linenum">1791</span></a>              'before'        =&gt; '&lt;div class=&quot;floatright&quot;&gt;',
<a name="l1792"><span class="linenum">1792</span></a>              'after'         =&gt; '&lt;/div&gt;',
<a name="l1793"><span class="linenum">1793</span></a>              'title_text'    =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Conversations').': ',
<a name="l1794"><span class="linenum">1794</span></a>              'separator'     =&gt; ' :: ',
<a name="l1795"><span class="linenum">1795</span></a>              'previous_text' =&gt; '&amp;laquo; '.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Previous'),
<a name="l1796"><span class="linenum">1796</span></a>              'next_text'     =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Next').' &amp;raquo;',
<a name="l1797"><span class="linenum">1797</span></a>          ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l1798"><span class="linenum">1798</span></a>  
<a name="l1799"><span class="linenum">1799</span></a>      <a class="var it5049" onMouseOver="hilite(5049)" onMouseOut="lolite()" onClick="logVariable('prev_thread_ID')" href="../../../_variables/prev_thread_ID.html">$prev_thread_ID</a> = <a class="function" onClick="logFunction('get_thread_prevnext_ID')" href="../../../_functions/get_thread_prevnext_id.html" onMouseOver="funcPopup(event,'get_thread_prevnext_id')">get_thread_prevnext_ID</a>( <a class="var it5046" onMouseOver="hilite(5046)" onMouseOut="lolite()" onClick="logVariable('current_thread_ID')" href="../../../_variables/current_thread_ID.html">$current_thread_ID</a>, 'prev' );
<a name="l1800"><span class="linenum">1800</span></a>      if( !empty( <a class="var it5049" onMouseOver="hilite(5049)" onMouseOut="lolite()" onClick="logVariable('prev_thread_ID')" href="../../../_variables/prev_thread_ID.html">$prev_thread_ID</a> ) )
<a name="l1801"><span class="linenum">1801</span></a>      {    // Link to previous thread
<a name="l1802"><span class="linenum">1802</span></a>          <a class="var it5050" onMouseOver="hilite(5050)" onMouseOut="lolite()" onClick="logVariable('prev_link')" href="../../../_variables/prev_link.html">$prev_link</a> = '&lt;a href=&quot;'.<a class="function" onClick="logFunction('get_dispctrl_url')" href="../../../_functions/get_dispctrl_url.html" onMouseOver="funcPopup(event,'get_dispctrl_url')">get_dispctrl_url</a>( 'messages', 'thrd_ID='.<a class="var it5049" onMouseOver="hilite(5049)" onMouseOut="lolite()" onClick="logVariable('prev_thread_ID')" href="../../../_variables/prev_thread_ID.html">$prev_thread_ID</a> ).'&quot;&gt;'.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['previous_text'].'&lt;/a&gt;';
<a name="l1803"><span class="linenum">1803</span></a>      }
<a name="l1804"><span class="linenum">1804</span></a>  
<a name="l1805"><span class="linenum">1805</span></a>      <a class="var it5051" onMouseOver="hilite(5051)" onMouseOut="lolite()" onClick="logVariable('next_thread_ID')" href="../../../_variables/next_thread_ID.html">$next_thread_ID</a> = <a class="function" onClick="logFunction('get_thread_prevnext_ID')" href="../../../_functions/get_thread_prevnext_id.html" onMouseOver="funcPopup(event,'get_thread_prevnext_id')">get_thread_prevnext_ID</a>( <a class="var it5046" onMouseOver="hilite(5046)" onMouseOut="lolite()" onClick="logVariable('current_thread_ID')" href="../../../_variables/current_thread_ID.html">$current_thread_ID</a>, 'next' );
<a name="l1806"><span class="linenum">1806</span></a>      if( !empty( <a class="var it5051" onMouseOver="hilite(5051)" onMouseOut="lolite()" onClick="logVariable('next_thread_ID')" href="../../../_variables/next_thread_ID.html">$next_thread_ID</a> ) )
<a name="l1807"><span class="linenum">1807</span></a>      {    // Link to previous thread
<a name="l1808"><span class="linenum">1808</span></a>          <a class="var it5052" onMouseOver="hilite(5052)" onMouseOut="lolite()" onClick="logVariable('next_link')" href="../../../_variables/next_link.html">$next_link</a> = '&lt;a href=&quot;'.<a class="function" onClick="logFunction('get_dispctrl_url')" href="../../../_functions/get_dispctrl_url.html" onMouseOver="funcPopup(event,'get_dispctrl_url')">get_dispctrl_url</a>( 'messages', 'thrd_ID='.<a class="var it5051" onMouseOver="hilite(5051)" onMouseOut="lolite()" onClick="logVariable('next_thread_ID')" href="../../../_variables/next_thread_ID.html">$next_thread_ID</a> ).'&quot;&gt;'.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['next_text'].'&lt;/a&gt;';
<a name="l1809"><span class="linenum">1809</span></a>      }
<a name="l1810"><span class="linenum">1810</span></a>  
<a name="l1811"><span class="linenum">1811</span></a>      if( empty( <a class="var it5050" onMouseOver="hilite(5050)" onMouseOut="lolite()" onClick="logVariable('prev_link')" href="../../../_variables/prev_link.html">$prev_link</a> ) &amp;&amp; empty( <a class="var it5052" onMouseOver="hilite(5052)" onMouseOut="lolite()" onClick="logVariable('next_link')" href="../../../_variables/next_link.html">$next_link</a> ) )
<a name="l1812"><span class="linenum">1812</span></a>      {    // No found previous and next threads
<a name="l1813"><span class="linenum">1813</span></a>          return;
<a name="l1814"><span class="linenum">1814</span></a>      }
<a name="l1815"><span class="linenum">1815</span></a>  
<a name="l1816"><span class="linenum">1816</span></a>      <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['before'];
<a name="l1817"><span class="linenum">1817</span></a>      <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['title_text'];
<a name="l1818"><span class="linenum">1818</span></a>  
<a name="l1819"><span class="linenum">1819</span></a>      if( !empty( <a class="var it5050" onMouseOver="hilite(5050)" onMouseOut="lolite()" onClick="logVariable('prev_link')" href="../../../_variables/prev_link.html">$prev_link</a> ) )
<a name="l1820"><span class="linenum">1820</span></a>      {
<a name="l1821"><span class="linenum">1821</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it5050" onMouseOver="hilite(5050)" onMouseOut="lolite()" onClick="logVariable('prev_link')" href="../../../_variables/prev_link.html">$prev_link</a>;
<a name="l1822"><span class="linenum">1822</span></a>      }
<a name="l1823"><span class="linenum">1823</span></a>  
<a name="l1824"><span class="linenum">1824</span></a>      if( !empty( <a class="var it5050" onMouseOver="hilite(5050)" onMouseOut="lolite()" onClick="logVariable('prev_link')" href="../../../_variables/prev_link.html">$prev_link</a> ) &amp;&amp; !empty( <a class="var it5052" onMouseOver="hilite(5052)" onMouseOut="lolite()" onClick="logVariable('next_link')" href="../../../_variables/next_link.html">$next_link</a> ) )
<a name="l1825"><span class="linenum">1825</span></a>      {
<a name="l1826"><span class="linenum">1826</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['separator'];
<a name="l1827"><span class="linenum">1827</span></a>      }
<a name="l1828"><span class="linenum">1828</span></a>  
<a name="l1829"><span class="linenum">1829</span></a>      if( !empty( <a class="var it5052" onMouseOver="hilite(5052)" onMouseOut="lolite()" onClick="logVariable('next_link')" href="../../../_variables/next_link.html">$next_link</a> ) )
<a name="l1830"><span class="linenum">1830</span></a>      {
<a name="l1831"><span class="linenum">1831</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it5052" onMouseOver="hilite(5052)" onMouseOut="lolite()" onClick="logVariable('next_link')" href="../../../_variables/next_link.html">$next_link</a>;
<a name="l1832"><span class="linenum">1832</span></a>      }
<a name="l1833"><span class="linenum">1833</span></a>  
<a name="l1834"><span class="linenum">1834</span></a>      <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['after'];
<a name="l1835"><span class="linenum">1835</span></a>  
<a name="l1836"><span class="linenum">1836</span></a>      return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l1837"><span class="linenum">1837</span></a>  }
<a name="l1838"><span class="linenum">1838</span></a>  
<a name="l1839"><span class="linenum">1839</span></a>  
<a name="l1840"><span class="linenum">1840</span></a>  <span class="comment">/**</span>
<a name="l1841"><span class="linenum">1841</span></a>  <span class="comment"> * Display threads results table</span>
<a name="l1842"><span class="linenum">1842</span></a>  <span class="comment"> *</span>
<a name="l1843"><span class="linenum">1843</span></a>  <span class="comment"> * @param array Params</span>
<a name="l1844"><span class="linenum">1844</span></a>  <span class="comment"> */</span>
<a name="l1845"><span class="linenum">1845</span></a>  function <a class="function" onClick="logFunction('threads_results_block')" href="../../../_functions/threads_results_block.html" onMouseOver="funcPopup(event,'threads_results_block')">threads_results_block</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l1846"><span class="linenum">1846</span></a>  {
<a name="l1847"><span class="linenum">1847</span></a>  <span class="comment">    // Make sure we are not missing any param:</span>
<a name="l1848"><span class="linenum">1848</span></a>      <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l1849"><span class="linenum">1849</span></a>              'edited_User'          =&gt; NULL,
<a name="l1850"><span class="linenum">1850</span></a>              'results_param_prefix' =&gt; 'actv_thrd_',
<a name="l1851"><span class="linenum">1851</span></a>              'results_title'        =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Threads with private messages sent by the user'),
<a name="l1852"><span class="linenum">1852</span></a>              'results_no_text'      =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('User has not sent any private messages'),
<a name="l1853"><span class="linenum">1853</span></a>          ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l1854"><span class="linenum">1854</span></a>  
<a name="l1855"><span class="linenum">1855</span></a>      if( !<a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l1856"><span class="linenum">1856</span></a>      {    // Only logged in users can access to this function
<a name="l1857"><span class="linenum">1857</span></a>          return;
<a name="l1858"><span class="linenum">1858</span></a>      }
<a name="l1859"><span class="linenum">1859</span></a>  
<a name="l1860"><span class="linenum">1860</span></a>      global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l1861"><span class="linenum">1861</span></a>      if( !<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'moderate' ) || !<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'reply' ) )
<a name="l1862"><span class="linenum">1862</span></a>      {    // Check minimum permission:
<a name="l1863"><span class="linenum">1863</span></a>          return;
<a name="l1864"><span class="linenum">1864</span></a>      }
<a name="l1865"><span class="linenum">1865</span></a>  
<a name="l1866"><span class="linenum">1866</span></a>      <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['edited_User'];
<a name="l1867"><span class="linenum">1867</span></a>      if( !<a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a> )
<a name="l1868"><span class="linenum">1868</span></a>      {    // No defined User, probably the function is calling from AJAX request
<a name="l1869"><span class="linenum">1869</span></a>          <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'user_ID', 'integer', 0 );
<a name="l1870"><span class="linenum">1870</span></a>          if( empty( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) )
<a name="l1871"><span class="linenum">1871</span></a>          {    // Bad request, Exit here
<a name="l1872"><span class="linenum">1872</span></a>              return;
<a name="l1873"><span class="linenum">1873</span></a>          }
<a name="l1874"><span class="linenum">1874</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l1875"><span class="linenum">1875</span></a>          if( ( <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a> = &amp; <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_ID( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, false ) ) === false )
<a name="l1876"><span class="linenum">1876</span></a>          {    // Bad request, Exit here
<a name="l1877"><span class="linenum">1877</span></a>              return;
<a name="l1878"><span class="linenum">1878</span></a>          }
<a name="l1879"><span class="linenum">1879</span></a>      }
<a name="l1880"><span class="linenum">1880</span></a>  
<a name="l1881"><span class="linenum">1881</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('AdminUI')" href="../../../_variables/AdminUI.html">$AdminUI</a>;
<a name="l1882"><span class="linenum">1882</span></a>  
<a name="l1883"><span class="linenum">1883</span></a>      <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'user_tab', 'string', '', true );
<a name="l1884"><span class="linenum">1884</span></a>      <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'user_ID', 'integer', 0, true );
<a name="l1885"><span class="linenum">1885</span></a>  
<a name="l1886"><span class="linenum">1886</span></a>      <a class="var it3409" onMouseOver="hilite(3409)" onMouseOut="lolite()" onClick="logVariable('results_params')" href="../../../_variables/results_params.html">$results_params</a> = <a class="var it144" onMouseOver="hilite(144)" onMouseOut="lolite()" onClick="logVariable('AdminUI')" href="../../../_variables/AdminUI.html">$AdminUI</a>-&gt;<a class="function" onClick="logFunction('get_template')" href="../../../_functions/get_template.html" onMouseOver="funcPopup(event,'get_template')">get_template</a>( 'Results' );
<a name="l1887"><span class="linenum">1887</span></a>      <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('display_params')" href="../../../_variables/display_params.html">$display_params</a> = array(
<a name="l1888"><span class="linenum">1888</span></a>          'before' =&gt; <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( '&gt;', ' style=&quot;margin-top:25px&quot; id=&quot;threads_result&quot;&gt;', <a class="var it3409" onMouseOver="hilite(3409)" onMouseOut="lolite()" onClick="logVariable('results_params')" href="../../../_variables/results_params.html">$results_params</a>['before'] ),
<a name="l1889"><span class="linenum">1889</span></a>          'after'  =&gt; <a class="var it3409" onMouseOver="hilite(3409)" onMouseOut="lolite()" onClick="logVariable('results_params')" href="../../../_variables/results_params.html">$results_params</a>['after'],
<a name="l1890"><span class="linenum">1890</span></a>      );
<a name="l1891"><span class="linenum">1891</span></a>  
<a name="l1892"><span class="linenum">1892</span></a>  <span class="comment">    // Check permission:</span>
<a name="l1893"><span class="linenum">1893</span></a>      if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'abuse' ) )
<a name="l1894"><span class="linenum">1894</span></a>      {
<a name="l1895"><span class="linenum">1895</span></a>  <span class="comment">        // Create result set:</span>
<a name="l1896"><span class="linenum">1896</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a> = <a class="function" onClick="logFunction('get_threads_results')" href="../../../_functions/get_threads_results.html" onMouseOver="funcPopup(event,'get_threads_results')">get_threads_results</a>( array(
<a name="l1897"><span class="linenum">1897</span></a>                  'results_param_prefix' =&gt; <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['results_param_prefix'],
<a name="l1898"><span class="linenum">1898</span></a>                  'user_ID' =&gt; <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10701" onMouseOver="hilite(10701)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>,
<a name="l1899"><span class="linenum">1899</span></a>                  'sent_user_ID' =&gt; <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a>-&gt;ID
<a name="l1900"><span class="linenum">1900</span></a>              ) );
<a name="l1901"><span class="linenum">1901</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('Cache')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/Cache.html">Cache</a> = &amp; get_ThreadCache();
<a name="l1902"><span class="linenum">1902</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('title')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/title.html">title</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['results_title'];
<a name="l1903"><span class="linenum">1903</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('no_results_text')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/no_results_text.html">no_results_text</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['results_no_text'];
<a name="l1904"><span class="linenum">1904</span></a>  
<a name="l1905"><span class="linenum">1905</span></a>          if( <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a class="function" onClick="logFunction('get_total_rows')" href="../../../_functions/get_total_rows.html" onMouseOver="funcPopup(event,'get_total_rows')">get_total_rows</a>() &gt; 0 )
<a name="l1906"><span class="linenum">1906</span></a>          {    // Display action icon to delete all records if at least one record exists
<a name="l1907"><span class="linenum">1907</span></a>              <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a class="function" onClick="logFunction('global_icon')" href="../../../_functions/global_icon.html" onMouseOver="funcPopup(event,'global_icon')">global_icon</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Delete all private messages sent by %s'), <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a>-&gt;<a onClick="logVariable('login')" class="var it10701" onMouseOver="hilite(10701)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a> ), 'delete', '?ctrl=user&amp;amp;user_tab=activity&amp;amp;action=delete_all_messages&amp;amp;user_ID='.<a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10701" onMouseOver="hilite(10701)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>('user'), ' '.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Delete all'), 3, 4 );
<a name="l1908"><span class="linenum">1908</span></a>          }
<a name="l1909"><span class="linenum">1909</span></a>  
<a name="l1910"><span class="linenum">1910</span></a>  <span class="comment">        // Load classes</span>
<a name="l1911"><span class="linenum">1911</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'messaging/model/_thread.class.php', 'Thread' );
<a name="l1912"><span class="linenum">1912</span></a>  
<a name="l1913"><span class="linenum">1913</span></a>  <span class="comment">        // Initialize Results object</span>
<a name="l1914"><span class="linenum">1914</span></a>          <a class="function" onClick="logFunction('threads_results')" href="../../../_functions/threads_results.html" onMouseOver="funcPopup(event,'threads_results')">threads_results</a>( <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>, array(
<a name="l1915"><span class="linenum">1915</span></a>                  'abuse_management' =&gt; 1,
<a name="l1916"><span class="linenum">1916</span></a>                  'show_only_date' =&gt; 1,
<a name="l1917"><span class="linenum">1917</span></a>              ) );
<a name="l1918"><span class="linenum">1918</span></a>  
<a name="l1919"><span class="linenum">1919</span></a>          if( <a class="function" onClick="logFunction('is_ajax_content')" href="../../../_functions/is_ajax_content.html" onMouseOver="funcPopup(event,'is_ajax_content')">is_ajax_content</a>() )
<a name="l1920"><span class="linenum">1920</span></a>          { // init results param by template name
<a name="l1921"><span class="linenum">1921</span></a>              if( !isset( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[ 'skin_type' ] ) || ! isset( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[ 'skin_name' ] ) )
<a name="l1922"><span class="linenum">1922</span></a>              {
<a name="l1923"><span class="linenum">1923</span></a>                  <a class="function" onClick="logFunction('debug_die')" href="../../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'Invalid ajax results request!' );
<a name="l1924"><span class="linenum">1924</span></a>              }
<a name="l1925"><span class="linenum">1925</span></a>              <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a class="function" onClick="logFunction('init_params_by_skin')" href="../../../_functions/init_params_by_skin.html" onMouseOver="funcPopup(event,'init_params_by_skin')">init_params_by_skin</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[ 'skin_type' ], <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[ 'skin_name' ] );
<a name="l1926"><span class="linenum">1926</span></a>          }
<a name="l1927"><span class="linenum">1927</span></a>  
<a name="l1928"><span class="linenum">1928</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a class="function" onClick="logFunction('display')" href="../../../_functions/display.html" onMouseOver="funcPopup(event,'display')">display</a>( <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('display_params')" href="../../../_variables/display_params.html">$display_params</a> );
<a name="l1929"><span class="linenum">1929</span></a>  
<a name="l1930"><span class="linenum">1930</span></a>          if( !<a class="function" onClick="logFunction('is_ajax_content')" href="../../../_functions/is_ajax_content.html" onMouseOver="funcPopup(event,'is_ajax_content')">is_ajax_content</a>() )
<a name="l1931"><span class="linenum">1931</span></a>          {    // Create this hidden div to get a function name for AJAX request
<a name="l1932"><span class="linenum">1932</span></a>              echo '&lt;div id=&quot;'.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['results_param_prefix'].'ajax_callback&quot; style=&quot;display:none&quot;&gt;'.__FUNCTION__.'&lt;/div&gt;';
<a name="l1933"><span class="linenum">1933</span></a>          }
<a name="l1934"><span class="linenum">1934</span></a>      }
<a name="l1935"><span class="linenum">1935</span></a>      else
<a name="l1936"><span class="linenum">1936</span></a>      { // No permission for abuse management
<a name="l1937"><span class="linenum">1937</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Table')" href="../../../_classes/table.html" onMouseOver="classPopup(event,'table')">Table</a>();
<a name="l1938"><span class="linenum">1938</span></a>  
<a name="l1939"><span class="linenum">1939</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a onClick="logVariable('title')" class="var it10768" onMouseOver="hilite(10768)" onMouseOut="lolite()" href="../../../_variables/title.html">title</a> = <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Messaging');
<a name="l1940"><span class="linenum">1940</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a onClick="logVariable('no_results_text')" class="var it10768" onMouseOver="hilite(10768)" onMouseOut="lolite()" href="../../../_variables/no_results_text.html">no_results_text</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('User has sent %s private messages'), <a class="var it1199" onMouseOver="hilite(1199)" onMouseOut="lolite()" onClick="logVariable('edited_User')" href="../../../_variables/edited_User.html">$edited_User</a>-&gt;<a class="function" onClick="logFunction('get_num_messages')" href="../../../_functions/get_num_messages.html" onMouseOver="funcPopup(event,'get_num_messages')">get_num_messages</a>( 'sent' ) );
<a name="l1941"><span class="linenum">1941</span></a>  
<a name="l1942"><span class="linenum">1942</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a class="function" onClick="logFunction('display_init')" href="../../../_functions/display_init.html" onMouseOver="funcPopup(event,'display_init')">display_init</a>();
<a name="l1943"><span class="linenum">1943</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a onClick="logVariable('total_pages')" class="var it10768" onMouseOver="hilite(10768)" onMouseOut="lolite()" href="../../../_variables/total_pages.html">total_pages</a> = 0;
<a name="l1944"><span class="linenum">1944</span></a>  
<a name="l1945"><span class="linenum">1945</span></a>          echo <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('display_params')" href="../../../_variables/display_params.html">$display_params</a>['before'];
<a name="l1946"><span class="linenum">1946</span></a>  
<a name="l1947"><span class="linenum">1947</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a class="function" onClick="logFunction('display_head')" href="../../../_functions/display_head.html" onMouseOver="funcPopup(event,'display_head')">display_head</a>();
<a name="l1948"><span class="linenum">1948</span></a>  
<a name="l1949"><span class="linenum">1949</span></a>          echo <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a onClick="logVariable('params')" class="var it10768" onMouseOver="hilite(10768)" onMouseOut="lolite()" href="../../../_variables/params.html">params</a>['content_start'];
<a name="l1950"><span class="linenum">1950</span></a>  
<a name="l1951"><span class="linenum">1951</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a class="function" onClick="logFunction('display_list_start')" href="../../../_functions/display_list_start.html" onMouseOver="funcPopup(event,'display_list_start')">display_list_start</a>();
<a name="l1952"><span class="linenum">1952</span></a>  
<a name="l1953"><span class="linenum">1953</span></a>          <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a class="function" onClick="logFunction('display_list_end')" href="../../../_functions/display_list_end.html" onMouseOver="funcPopup(event,'display_list_end')">display_list_end</a>();
<a name="l1954"><span class="linenum">1954</span></a>  
<a name="l1955"><span class="linenum">1955</span></a>          echo <a class="var it4282" onMouseOver="hilite(4282)" onMouseOut="lolite()" onClick="logVariable('Table')" href="../../../_variables/Table.html">$Table</a>-&gt;<a onClick="logVariable('params')" class="var it10768" onMouseOver="hilite(10768)" onMouseOut="lolite()" href="../../../_variables/params.html">params</a>['content_end'];
<a name="l1956"><span class="linenum">1956</span></a>  
<a name="l1957"><span class="linenum">1957</span></a>          echo <a class="var it123" onMouseOver="hilite(123)" onMouseOut="lolite()" onClick="logVariable('display_params')" href="../../../_variables/display_params.html">$display_params</a>['after'];
<a name="l1958"><span class="linenum">1958</span></a>      }
<a name="l1959"><span class="linenum">1959</span></a>  }
<a name="l1960"><span class="linenum">1960</span></a>  
<a name="l1961"><span class="linenum">1961</span></a>  
<a name="l1962"><span class="linenum">1962</span></a>  <span class="comment">/**</span>
<a name="l1963"><span class="linenum">1963</span></a>  <span class="comment"> * Initialize Results object for threads list</span>
<a name="l1964"><span class="linenum">1964</span></a>  <span class="comment"> *</span>
<a name="l1965"><span class="linenum">1965</span></a>  <span class="comment"> * @param object Results</span>
<a name="l1966"><span class="linenum">1966</span></a>  <span class="comment"> * @param array Params</span>
<a name="l1967"><span class="linenum">1967</span></a>  <span class="comment"> */</span>
<a name="l1968"><span class="linenum">1968</span></a>  function <a class="function" onClick="logFunction('threads_results')" href="../../../_functions/threads_results.html" onMouseOver="funcPopup(event,'threads_results')">threads_results</a>( &amp; <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l1969"><span class="linenum">1969</span></a>  {
<a name="l1970"><span class="linenum">1970</span></a>      global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l1971"><span class="linenum">1971</span></a>  
<a name="l1972"><span class="linenum">1972</span></a>  <span class="comment">    // Make sure we are not missing any param:</span>
<a name="l1973"><span class="linenum">1973</span></a>      <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l1974"><span class="linenum">1974</span></a>              'abuse_management' =&gt; 0, // 1 - abuse management mode
<a name="l1975"><span class="linenum">1975</span></a>              'display_recipients' =&gt; true,
<a name="l1976"><span class="linenum">1976</span></a>              'display_subject' =&gt; true,
<a name="l1977"><span class="linenum">1977</span></a>              'display_date' =&gt; true,
<a name="l1978"><span class="linenum">1978</span></a>              'display_read' =&gt; true,
<a name="l1979"><span class="linenum">1979</span></a>              'display_actions' =&gt; true,
<a name="l1980"><span class="linenum">1980</span></a>              'show_only_date' =&gt; 0,
<a name="l1981"><span class="linenum">1981</span></a>          ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l1982"><span class="linenum">1982</span></a>  
<a name="l1983"><span class="linenum">1983</span></a>      if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['display_recipients'] )
<a name="l1984"><span class="linenum">1984</span></a>      {    // Display Recipients column
<a name="l1985"><span class="linenum">1985</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('cols')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/cols.html">cols</a>[] = array(
<a name="l1986"><span class="linenum">1986</span></a>                  'th' =&gt; <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['abuse_management'] ? <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Between') : <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('With'),
<a name="l1987"><span class="linenum">1987</span></a>                  'th_class' =&gt; 'thread_with shrinkwrap',
<a name="l1988"><span class="linenum">1988</span></a>                  'td_class' =&gt; 'thread_with',
<a name="l1989"><span class="linenum">1989</span></a>                  'td' =&gt; '%<a class="function" onClick="logFunction('col_thread_recipients')" href="../../../_functions/col_thread_recipients.html" onMouseOver="funcPopup(event,'col_thread_recipients')">col_thread_recipients</a>( #thrd_ID#, '.(int)<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['abuse_management'].' )%',
<a name="l1990"><span class="linenum">1990</span></a>              );
<a name="l1991"><span class="linenum">1991</span></a>      }
<a name="l1992"><span class="linenum">1992</span></a>  
<a name="l1993"><span class="linenum">1993</span></a>      if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['display_subject'] )
<a name="l1994"><span class="linenum">1994</span></a>      {    // Display Subject column
<a name="l1995"><span class="linenum">1995</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('cols')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/cols.html">cols</a>[] = array(
<a name="l1996"><span class="linenum">1996</span></a>                  'th' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Subject'),
<a name="l1997"><span class="linenum">1997</span></a>                  'th_class' =&gt; 'thread_subject',
<a name="l1998"><span class="linenum">1998</span></a>                  'td_class' =&gt; 'thread_subject',
<a name="l1999"><span class="linenum">1999</span></a>                  'td' =&gt; '%<a class="function" onClick="logFunction('col_thread_subject_link')" href="../../../_functions/col_thread_subject_link.html" onMouseOver="funcPopup(event,'col_thread_subject_link')">col_thread_subject_link</a>( #thrd_ID#, #thrd_title#, #thrd_msg_ID#, #tsta_thread_leave_msg_ID#, '.(int)<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['abuse_management'].' )%',
<a name="l2000"><span class="linenum">2000</span></a>              );
<a name="l2001"><span class="linenum">2001</span></a>      }
<a name="l2002"><span class="linenum">2002</span></a>  
<a name="l2003"><span class="linenum">2003</span></a>      if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['display_date'] )
<a name="l2004"><span class="linenum">2004</span></a>      {    // Display Date column
<a name="l2005"><span class="linenum">2005</span></a>          <a class="var it184" onMouseOver="hilite(184)" onMouseOut="lolite()" onClick="logVariable('show_only_date')" href="../../../_variables/show_only_date.html">$show_only_date</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>[ 'show_only_date' ];
<a name="l2006"><span class="linenum">2006</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('cols')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/cols.html">cols</a>[] = array(
<a name="l2007"><span class="linenum">2007</span></a>                  'th' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Last msg'),
<a name="l2008"><span class="linenum">2008</span></a>                  'th_class' =&gt; 'shrinkwrap',
<a name="l2009"><span class="linenum">2009</span></a>                  'td_class' =&gt; 'shrinkwrap',
<a name="l2010"><span class="linenum">2010</span></a>                  'td' =&gt; '~<a class="function" onClick="logFunction('conditional')" href="../../../_functions/conditional.html" onMouseOver="funcPopup(event,'conditional')">conditional</a>( #thrd_msg_ID#&gt;0 &amp;&amp; #thrd_msg_ID#!=&quot;abuse&quot;, \'%<a class="function" onClick="logFunction('col_thread_date')" href="../../../_functions/col_thread_date.html" onMouseOver="funcPopup(event,'col_thread_date')">col_thread_date</a>(#thrd_unread_since#,'.<a class="var it184" onMouseOver="hilite(184)" onMouseOut="lolite()" onClick="logVariable('show_only_date')" href="../../../_variables/show_only_date.html">$show_only_date</a>.')%\', \'%<a class="function" onClick="logFunction('col_thread_date')" href="../../../_functions/col_thread_date.html" onMouseOver="funcPopup(event,'col_thread_date')">col_thread_date</a>(#thrd_datemodified#,'.<a class="var it184" onMouseOver="hilite(184)" onMouseOut="lolite()" onClick="logVariable('show_only_date')" href="../../../_variables/show_only_date.html">$show_only_date</a>.')%\')~'
<a name="l2011"><span class="linenum">2011</span></a>              );
<a name="l2012"><span class="linenum">2012</span></a>      }
<a name="l2013"><span class="linenum">2013</span></a>  
<a name="l2014"><span class="linenum">2014</span></a>      if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['display_read'] )
<a name="l2015"><span class="linenum">2015</span></a>      {    // Display Read column
<a name="l2016"><span class="linenum">2016</span></a>          <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('cols')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/cols.html">cols</a>[] = array(
<a name="l2017"><span class="linenum">2017</span></a>                  'th' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Read?'),
<a name="l2018"><span class="linenum">2018</span></a>                  'th_class' =&gt; 'shrinkwrap',
<a name="l2019"><span class="linenum">2019</span></a>                  'td_class' =&gt; 'center',
<a name="l2020"><span class="linenum">2020</span></a>                  'td' =&gt; '%<a class="function" onClick="logFunction('col_thread_read_by')" href="../../../_functions/col_thread_read_by.html" onMouseOver="funcPopup(event,'col_thread_read_by')">col_thread_read_by</a>( #thrd_ID# )%',
<a name="l2021"><span class="linenum">2021</span></a>              );
<a name="l2022"><span class="linenum">2022</span></a>      }
<a name="l2023"><span class="linenum">2023</span></a>  
<a name="l2024"><span class="linenum">2024</span></a>      if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['display_actions'] )
<a name="l2025"><span class="linenum">2025</span></a>      {    // Display Actions column
<a name="l2026"><span class="linenum">2026</span></a>          if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'delete' ) )
<a name="l2027"><span class="linenum">2027</span></a>          {    // We have permission to modify:
<a name="l2028"><span class="linenum">2028</span></a>              <a class="var it5053" onMouseOver="hilite(5053)" onMouseOut="lolite()" onClick="logVariable('threads_Results')" href="../../../_variables/threads_Results.html">$threads_Results</a>-&gt;<a onClick="logVariable('cols')" class="var it10984" onMouseOver="hilite(10984)" onMouseOut="lolite()" href="../../../_variables/cols.html">cols</a>[] = array(
<a name="l2029"><span class="linenum">2029</span></a>                      'th' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Del'),
<a name="l2030"><span class="linenum">2030</span></a>                      'th_class' =&gt; 'shrinkwrap',
<a name="l2031"><span class="linenum">2031</span></a>                      'td_class' =&gt; 'shrinkwrap',
<a name="l2032"><span class="linenum">2032</span></a>                      'td' =&gt; '%<a class="function" onClick="logFunction('col_thread_delete_action')" href="../../../_functions/col_thread_delete_action.html" onMouseOver="funcPopup(event,'col_thread_delete_action')">col_thread_delete_action</a>(  #thrd_ID#  )%',
<a name="l2033"><span class="linenum">2033</span></a>                  );
<a name="l2034"><span class="linenum">2034</span></a>          }
<a name="l2035"><span class="linenum">2035</span></a>      }
<a name="l2036"><span class="linenum">2036</span></a>  }
<a name="l2037"><span class="linenum">2037</span></a>  
<a name="l2038"><span class="linenum">2038</span></a>  
<a name="l2039"><span class="linenum">2039</span></a>  <span class="comment">/**</span>
<a name="l2040"><span class="linenum">2040</span></a>  <span class="comment"> * Helper functions to display Threads results.</span>
<a name="l2041"><span class="linenum">2041</span></a>  <span class="comment"> * New ( not display helper ) functions must be created above threads_results function</span>
<a name="l2042"><span class="linenum">2042</span></a>  <span class="comment"> */</span>
<a name="l2043"><span class="linenum">2043</span></a>  
<a name="l2044"><span class="linenum">2044</span></a>  <span class="comment">/**</span>
<a name="l2045"><span class="linenum">2045</span></a>  <span class="comment"> * Get thread's recipients</span>
<a name="l2046"><span class="linenum">2046</span></a>  <span class="comment"> *</span>
<a name="l2047"><span class="linenum">2047</span></a>  <span class="comment"> * @param integer Thread ID</span>
<a name="l2048"><span class="linenum">2048</span></a>  <span class="comment"> * @param boolean TRUE for abuse management mode</span>
<a name="l2049"><span class="linenum">2049</span></a>  <span class="comment"> * @return string Recipients (avatar + login)</span>
<a name="l2050"><span class="linenum">2050</span></a>  <span class="comment"> */</span>
<a name="l2051"><span class="linenum">2051</span></a>  function <a class="function" onClick="logFunction('col_thread_recipients')" href="../../../_functions/col_thread_recipients.html" onMouseOver="funcPopup(event,'col_thread_recipients')">col_thread_recipients</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a>, <a class="var it5054" onMouseOver="hilite(5054)" onMouseOut="lolite()" onClick="logVariable('abuse_management')" href="../../../_variables/abuse_management.html">$abuse_management</a> )
<a name="l2052"><span class="linenum">2052</span></a>  {
<a name="l2053"><span class="linenum">2053</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l2054"><span class="linenum">2054</span></a>  
<a name="l2055"><span class="linenum">2055</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l2056"><span class="linenum">2056</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'user_login' );
<a name="l2057"><span class="linenum">2057</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus mts' );
<a name="l2058"><span class="linenum">2058</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'LEFT JOIN T_users u ON user_ID = tsta_user_ID' );
<a name="l2059"><span class="linenum">2059</span></a>      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'tsta_thread_ID = '.<a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> );
<a name="l2060"><span class="linenum">2060</span></a>      if( !<a class="var it5054" onMouseOver="hilite(5054)" onMouseOut="lolite()" onClick="logVariable('abuse_management')" href="../../../_variables/abuse_management.html">$abuse_management</a> )
<a name="l2061"><span class="linenum">2061</span></a>      {    // Show current user only in abuse management
<a name="l2062"><span class="linenum">2062</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l2063"><span class="linenum">2063</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'tsta_user_ID != '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l2064"><span class="linenum">2064</span></a>      }
<a name="l2065"><span class="linenum">2065</span></a>      <a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l2066"><span class="linenum">2066</span></a>  
<a name="l2067"><span class="linenum">2067</span></a>      <a class="var it2938" onMouseOver="hilite(2938)" onMouseOut="lolite()" onClick="logVariable('image_size')" href="../../../_variables/image_size.html">$image_size</a> = isset( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> ) ? <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get_setting')" href="../../../_functions/get_setting.html" onMouseOver="funcPopup(event,'get_setting')">get_setting</a>( 'image_size_messaging' ) : 'crop-top-32x32';
<a name="l2068"><span class="linenum">2068</span></a>  
<a name="l2069"><span class="linenum">2069</span></a>      if( empty( <a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a> ) )
<a name="l2070"><span class="linenum">2070</span></a>      { // There are no recipients in this list. This is only possible if the recipients were deleted as spammer
<a name="l2071"><span class="linenum">2071</span></a>          return '&lt;span class=&quot;nowrap&quot;&gt;'
<a name="l2072"><span class="linenum">2072</span></a>               .<a class="function" onClick="logFunction('get_avatar_imgtag_default')" href="../../../_functions/get_avatar_imgtag_default.html" onMouseOver="funcPopup(event,'get_avatar_imgtag_default')">get_avatar_imgtag_default</a>( <a class="var it2938" onMouseOver="hilite(2938)" onMouseOut="lolite()" onClick="logVariable('image_size')" href="../../../_variables/image_size.html">$image_size</a>, 'avatar_before_login_middle mb1' )
<a name="l2073"><span class="linenum">2073</span></a>               .'&lt;span class=&quot;user deleted&quot;&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Deleted <a class="function" onClick="logFunction('user')" href="../../../_functions/user.html" onMouseOver="funcPopup(event,'user')">user</a>(s)' ).'&lt;/span&gt;'
<a name="l2074"><span class="linenum">2074</span></a>               .'&lt;/span&gt;';
<a name="l2075"><span class="linenum">2075</span></a>      }
<a name="l2076"><span class="linenum">2076</span></a>  
<a name="l2077"><span class="linenum">2077</span></a>      return <a class="function" onClick="logFunction('get_avatar_imgtags')" href="../../../_functions/get_avatar_imgtags.html" onMouseOver="funcPopup(event,'get_avatar_imgtags')">get_avatar_imgtags</a>( <a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a>, true, true, <a class="var it2938" onMouseOver="hilite(2938)" onMouseOut="lolite()" onClick="logVariable('image_size')" href="../../../_variables/image_size.html">$image_size</a>, 'avatar_before_login_middle mb1', '', NULL, true, '&lt;br /&gt;', true );
<a name="l2078"><span class="linenum">2078</span></a>  }
<a name="l2079"><span class="linenum">2079</span></a>  
<a name="l2080"><span class="linenum">2080</span></a>  
<a name="l2081"><span class="linenum">2081</span></a>  <span class="comment">/**</span>
<a name="l2082"><span class="linenum">2082</span></a>  <span class="comment"> * Get subject as link with icon (read or unread)</span>
<a name="l2083"><span class="linenum">2083</span></a>  <span class="comment"> *</span>
<a name="l2084"><span class="linenum">2084</span></a>  <span class="comment"> * @param thread ID</span>
<a name="l2085"><span class="linenum">2085</span></a>  <span class="comment"> * @param thread title</span>
<a name="l2086"><span class="linenum">2086</span></a>  <span class="comment"> * @param message ID (If ID &gt; 0 - message is still unread)</span>
<a name="l2087"><span class="linenum">2087</span></a>  <span class="comment"> * @param message ID</span>
<a name="l2088"><span class="linenum">2088</span></a>  <span class="comment"> * @param boolean TRUE for abuse management mode</span>
<a name="l2089"><span class="linenum">2089</span></a>  <span class="comment"> * @return string link with subject</span>
<a name="l2090"><span class="linenum">2090</span></a>  <span class="comment"> */</span>
<a name="l2091"><span class="linenum">2091</span></a>  function <a class="function" onClick="logFunction('col_thread_subject_link')" href="../../../_functions/col_thread_subject_link.html" onMouseOver="funcPopup(event,'col_thread_subject_link')">col_thread_subject_link</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>, <a class="var it5007" onMouseOver="hilite(5007)" onMouseOut="lolite()" onClick="logVariable('thrd_title')" href="../../../_variables/thrd_title.html">$thrd_title</a>, <a class="var it5012" onMouseOver="hilite(5012)" onMouseOut="lolite()" onClick="logVariable('thrd_msg_ID')" href="../../../_variables/thrd_msg_ID.html">$thrd_msg_ID</a>, <a class="var it5055" onMouseOver="hilite(5055)" onMouseOut="lolite()" onClick="logVariable('thrd_leave_msg_ID')" href="../../../_variables/thrd_leave_msg_ID.html">$thrd_leave_msg_ID</a>, <a class="var it5054" onMouseOver="hilite(5054)" onMouseOut="lolite()" onClick="logVariable('abuse_management')" href="../../../_variables/abuse_management.html">$abuse_management</a> )
<a name="l2092"><span class="linenum">2092</span></a>  {
<a name="l2093"><span class="linenum">2093</span></a>      <a class="var it1080" onMouseOver="hilite(1080)" onMouseOut="lolite()" onClick="logVariable('messages_url')" href="../../../_variables/messages_url.html">$messages_url</a> = <a class="function" onClick="logFunction('get_dispctrl_url')" href="../../../_functions/get_dispctrl_url.html" onMouseOver="funcPopup(event,'get_dispctrl_url')">get_dispctrl_url</a>( 'messages' );
<a name="l2094"><span class="linenum">2094</span></a>      if( <a class="var it5007" onMouseOver="hilite(5007)" onMouseOut="lolite()" onClick="logVariable('thrd_title')" href="../../../_variables/thrd_title.html">$thrd_title</a> == '' )
<a name="l2095"><span class="linenum">2095</span></a>      {
<a name="l2096"><span class="linenum">2096</span></a>          <a class="var it5007" onMouseOver="hilite(5007)" onMouseOut="lolite()" onClick="logVariable('thrd_title')" href="../../../_variables/thrd_title.html">$thrd_title</a> = '&lt;i&gt;(no subject)&lt;/i&gt;';
<a name="l2097"><span class="linenum">2097</span></a>      }
<a name="l2098"><span class="linenum">2098</span></a>  
<a name="l2099"><span class="linenum">2099</span></a>      <a class="var it5056" onMouseOver="hilite(5056)" onMouseOut="lolite()" onClick="logVariable('read_icon')" href="../../../_variables/read_icon.html">$read_icon</a> = '';
<a name="l2100"><span class="linenum">2100</span></a>      if( <a class="var it5012" onMouseOver="hilite(5012)" onMouseOut="lolite()" onClick="logVariable('thrd_msg_ID')" href="../../../_variables/thrd_msg_ID.html">$thrd_msg_ID</a> != 'abuse' )
<a name="l2101"><span class="linenum">2101</span></a>      {    // Don't show the read status for abuse management
<a name="l2102"><span class="linenum">2102</span></a>          if( !empty( <a class="var it5055" onMouseOver="hilite(5055)" onMouseOut="lolite()" onClick="logVariable('thrd_leave_msg_ID')" href="../../../_variables/thrd_leave_msg_ID.html">$thrd_leave_msg_ID</a> ) )
<a name="l2103"><span class="linenum">2103</span></a>          { // Conversation is left
<a name="l2104"><span class="linenum">2104</span></a>              <a class="var it5056" onMouseOver="hilite(5056)" onMouseOut="lolite()" onClick="logVariable('read_icon')" href="../../../_variables/read_icon.html">$read_icon</a> = <a class="function" onClick="logFunction('get_icon')" href="../../../_functions/get_icon.html" onMouseOver="funcPopup(event,'get_icon')">get_icon</a>( 'bullet_black', 'imgtag', array( 'style' =&gt; 'margin:0 2px', 'alt' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( &quot;Conversation left&quot; ) ) );
<a name="l2105"><span class="linenum">2105</span></a>              if( <a class="var it5012" onMouseOver="hilite(5012)" onMouseOut="lolite()" onClick="logVariable('thrd_msg_ID')" href="../../../_variables/thrd_msg_ID.html">$thrd_msg_ID</a> &gt; 0 )
<a name="l2106"><span class="linenum">2106</span></a>              { // also show unread messages icon, because user has not seen all messages yet
<a name="l2107"><span class="linenum">2107</span></a>                  <a class="var it5056" onMouseOver="hilite(5056)" onMouseOut="lolite()" onClick="logVariable('read_icon')" href="../../../_variables/read_icon.html">$read_icon</a> .= <a class="function" onClick="logFunction('get_icon')" href="../../../_functions/get_icon.html" onMouseOver="funcPopup(event,'get_icon')">get_icon</a>( 'bullet_red', 'imgtag', array( 'style' =&gt; 'margin:0 2px', 'alt' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( &quot;You have unread messages&quot; ) ) );
<a name="l2108"><span class="linenum">2108</span></a>              }
<a name="l2109"><span class="linenum">2109</span></a>          }
<a name="l2110"><span class="linenum">2110</span></a>          elseif( <a class="var it5012" onMouseOver="hilite(5012)" onMouseOut="lolite()" onClick="logVariable('thrd_msg_ID')" href="../../../_variables/thrd_msg_ID.html">$thrd_msg_ID</a> &gt; 0 )
<a name="l2111"><span class="linenum">2111</span></a>          { // Message is unread OR Show all messages in Abuse Management as unread
<a name="l2112"><span class="linenum">2112</span></a>              <a class="var it5056" onMouseOver="hilite(5056)" onMouseOut="lolite()" onClick="logVariable('read_icon')" href="../../../_variables/read_icon.html">$read_icon</a> = <a class="function" onClick="logFunction('get_icon')" href="../../../_functions/get_icon.html" onMouseOver="funcPopup(event,'get_icon')">get_icon</a>( 'bullet_red', 'imgtag', array( 'style' =&gt; 'margin:0 2px', 'alt' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( &quot;You have unread messages&quot; ) ) );
<a name="l2113"><span class="linenum">2113</span></a>          }
<a name="l2114"><span class="linenum">2114</span></a>          else
<a name="l2115"><span class="linenum">2115</span></a>          { // Message is read
<a name="l2116"><span class="linenum">2116</span></a>              <a class="var it5056" onMouseOver="hilite(5056)" onMouseOut="lolite()" onClick="logVariable('read_icon')" href="../../../_variables/read_icon.html">$read_icon</a> = <a class="function" onClick="logFunction('get_icon')" href="../../../_functions/get_icon.html" onMouseOver="funcPopup(event,'get_icon')">get_icon</a>( 'allowback', 'imgtag', array( 'alt' =&gt; &quot;You have read all messages&quot; ) );
<a name="l2117"><span class="linenum">2117</span></a>          }
<a name="l2118"><span class="linenum">2118</span></a>      }
<a name="l2119"><span class="linenum">2119</span></a>  
<a name="l2120"><span class="linenum">2120</span></a>      <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('tab')" href="../../../_variables/tab.html">$tab</a> = '';
<a name="l2121"><span class="linenum">2121</span></a>      if( <a class="var it5054" onMouseOver="hilite(5054)" onMouseOut="lolite()" onClick="logVariable('abuse_management')" href="../../../_variables/abuse_management.html">$abuse_management</a> )
<a name="l2122"><span class="linenum">2122</span></a>      { // We are in Abuse Management
<a name="l2123"><span class="linenum">2123</span></a>          <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('tab')" href="../../../_variables/tab.html">$tab</a> = '&amp;amp;tab=abuse';
<a name="l2124"><span class="linenum">2124</span></a>      }
<a name="l2125"><span class="linenum">2125</span></a>  
<a name="l2126"><span class="linenum">2126</span></a>      <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a> = <a class="var it5056" onMouseOver="hilite(5056)" onMouseOut="lolite()" onClick="logVariable('read_icon')" href="../../../_variables/read_icon.html">$read_icon</a>.'&lt;a href=&quot;'.<a class="var it1080" onMouseOver="hilite(1080)" onMouseOut="lolite()" onClick="logVariable('messages_url')" href="../../../_variables/messages_url.html">$messages_url</a>.'&amp;amp;thrd_ID='.<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>.<a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('tab')" href="../../../_variables/tab.html">$tab</a>.'&quot; title=&quot;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Show messages...').'&quot;&gt;';
<a name="l2127"><span class="linenum">2127</span></a>      <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a> .= '&lt;strong&gt;'.<a class="var it5007" onMouseOver="hilite(5007)" onMouseOut="lolite()" onClick="logVariable('thrd_title')" href="../../../_variables/thrd_title.html">$thrd_title</a>.'&lt;/strong&gt;';
<a name="l2128"><span class="linenum">2128</span></a>      <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a> .= '&lt;/a&gt;';
<a name="l2129"><span class="linenum">2129</span></a>  
<a name="l2130"><span class="linenum">2130</span></a>      return <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a>;
<a name="l2131"><span class="linenum">2131</span></a>  }
<a name="l2132"><span class="linenum">2132</span></a>  
<a name="l2133"><span class="linenum">2133</span></a>  
<a name="l2134"><span class="linenum">2134</span></a>  <span class="comment">/**</span>
<a name="l2135"><span class="linenum">2135</span></a>  <span class="comment"> * Return the given date in the correct date format</span>
<a name="l2136"><span class="linenum">2136</span></a>  <span class="comment"> *</span>
<a name="l2137"><span class="linenum">2137</span></a>  <span class="comment"> * @param string Date</span>
<a name="l2138"><span class="linenum">2138</span></a>  <span class="comment"> * @param boolean TRUE to show only date</span>
<a name="l2139"><span class="linenum">2139</span></a>  <span class="comment"> * @return string Date</span>
<a name="l2140"><span class="linenum">2140</span></a>  <span class="comment">*/</span>
<a name="l2141"><span class="linenum">2141</span></a>  function <a class="function" onClick="logFunction('col_thread_date')" href="../../../_functions/col_thread_date.html" onMouseOver="funcPopup(event,'col_thread_date')">col_thread_date</a>( <a class="var it183" onMouseOver="hilite(183)" onMouseOut="lolite()" onClick="logVariable('date')" href="../../../_variables/date.html">$date</a>, <a class="var it184" onMouseOver="hilite(184)" onMouseOut="lolite()" onClick="logVariable('show_only_date')" href="../../../_variables/show_only_date.html">$show_only_date</a> )
<a name="l2142"><span class="linenum">2142</span></a>  {
<a name="l2143"><span class="linenum">2143</span></a>      if( <a class="var it184" onMouseOver="hilite(184)" onMouseOut="lolite()" onClick="logVariable('show_only_date')" href="../../../_variables/show_only_date.html">$show_only_date</a> )
<a name="l2144"><span class="linenum">2144</span></a>      {
<a name="l2145"><span class="linenum">2145</span></a>          return <a class="function" onClick="logFunction('mysql2localedate')" href="../../../_functions/mysql2localedate.html" onMouseOver="funcPopup(event,'mysql2localedate')">mysql2localedate</a>( <a class="var it183" onMouseOver="hilite(183)" onMouseOut="lolite()" onClick="logVariable('date')" href="../../../_variables/date.html">$date</a> );
<a name="l2146"><span class="linenum">2146</span></a>      }
<a name="l2147"><span class="linenum">2147</span></a>  
<a name="l2148"><span class="linenum">2148</span></a>      return <a class="function" onClick="logFunction('mysql2localedatetime')" href="../../../_functions/mysql2localedatetime.html" onMouseOver="funcPopup(event,'mysql2localedatetime')">mysql2localedatetime</a>( <a class="var it183" onMouseOver="hilite(183)" onMouseOut="lolite()" onClick="logVariable('date')" href="../../../_variables/date.html">$date</a> );
<a name="l2149"><span class="linenum">2149</span></a>  }
<a name="l2150"><span class="linenum">2150</span></a>  
<a name="l2151"><span class="linenum">2151</span></a>  
<a name="l2152"><span class="linenum">2152</span></a>  <span class="comment">/**</span>
<a name="l2153"><span class="linenum">2153</span></a>  <span class="comment"> * Read? column</span>
<a name="l2154"><span class="linenum">2154</span></a>  <span class="comment"> *</span>
<a name="l2155"><span class="linenum">2155</span></a>  <span class="comment"> * @param integer Thread ID</span>
<a name="l2156"><span class="linenum">2156</span></a>  <span class="comment"> * @return string Status icons</span>
<a name="l2157"><span class="linenum">2157</span></a>  <span class="comment"> */</span>
<a name="l2158"><span class="linenum">2158</span></a>  function <a class="function" onClick="logFunction('col_thread_read_by')" href="../../../_functions/col_thread_read_by.html" onMouseOver="funcPopup(event,'col_thread_read_by')">col_thread_read_by</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> )
<a name="l2159"><span class="linenum">2159</span></a>  {
<a name="l2160"><span class="linenum">2160</span></a>      global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l2161"><span class="linenum">2161</span></a>  
<a name="l2162"><span class="linenum">2162</span></a>  <span class="comment">    // Select read/unread users for this thread</span>
<a name="l2163"><span class="linenum">2163</span></a>      <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a> = <a class="function" onClick="logFunction('get_threads_recipients_sql')" href="../../../_functions/get_threads_recipients_sql.html" onMouseOver="funcPopup(event,'get_threads_recipients_sql')">get_threads_recipients_sql</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> );
<a name="l2164"><span class="linenum">2164</span></a>  
<a name="l2165"><span class="linenum">2165</span></a>      <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> = '';
<a name="l2166"><span class="linenum">2166</span></a>  
<a name="l2167"><span class="linenum">2167</span></a>      if( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( <a class="var it4994" onMouseOver="hilite(4994)" onMouseOut="lolite()" onClick="logVariable('recipients_SQL')" href="../../../_variables/recipients_SQL.html">$recipients_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) )
<a name="l2168"><span class="linenum">2168</span></a>      {
<a name="l2169"><span class="linenum">2169</span></a>          if( !empty( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thr_read')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thr_read.html">thr_read</a> ) )
<a name="l2170"><span class="linenum">2170</span></a>          {
<a name="l2171"><span class="linenum">2171</span></a>              <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= <a class="function" onClick="logFunction('get_avatar_imgtags')" href="../../../_functions/get_avatar_imgtags.html" onMouseOver="funcPopup(event,'get_avatar_imgtags')">get_avatar_imgtags</a>( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thr_read')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thr_read.html">thr_read</a>, false, false, 'crop-top-15x15', '', '', true, false );
<a name="l2172"><span class="linenum">2172</span></a>          }
<a name="l2173"><span class="linenum">2173</span></a>  
<a name="l2174"><span class="linenum">2174</span></a>          if( !empty( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thr_unread')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thr_unread.html">thr_unread</a> ) )
<a name="l2175"><span class="linenum">2175</span></a>          {
<a name="l2176"><span class="linenum">2176</span></a>              if( !empty( <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> ) )
<a name="l2177"><span class="linenum">2177</span></a>              {
<a name="l2178"><span class="linenum">2178</span></a>                  <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= '&lt;br /&gt;';
<a name="l2179"><span class="linenum">2179</span></a>              }
<a name="l2180"><span class="linenum">2180</span></a>              <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= <a class="function" onClick="logFunction('get_avatar_imgtags')" href="../../../_functions/get_avatar_imgtags.html" onMouseOver="funcPopup(event,'get_avatar_imgtags')">get_avatar_imgtags</a>( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thr_unread')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thr_unread.html">thr_unread</a>, false, false, 'crop-top-15x15', '', '', false, false );
<a name="l2181"><span class="linenum">2181</span></a>          }
<a name="l2182"><span class="linenum">2182</span></a>  
<a name="l2183"><span class="linenum">2183</span></a>          if( !empty( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thr_left')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thr_left.html">thr_left</a> ) )
<a name="l2184"><span class="linenum">2184</span></a>          {
<a name="l2185"><span class="linenum">2185</span></a>              if( !empty( <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> ) )
<a name="l2186"><span class="linenum">2186</span></a>              {
<a name="l2187"><span class="linenum">2187</span></a>                  <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= '&lt;br /&gt;';
<a name="l2188"><span class="linenum">2188</span></a>              }
<a name="l2189"><span class="linenum">2189</span></a>              <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= <a class="function" onClick="logFunction('get_avatar_imgtags')" href="../../../_functions/get_avatar_imgtags.html" onMouseOver="funcPopup(event,'get_avatar_imgtags')">get_avatar_imgtags</a>( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('thr_left')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/thr_left.html">thr_left</a>, false, false, 'crop-top-15x15', '', '', 'left', false );
<a name="l2190"><span class="linenum">2190</span></a>          }
<a name="l2191"><span class="linenum">2191</span></a>      }
<a name="l2192"><span class="linenum">2192</span></a>  
<a name="l2193"><span class="linenum">2193</span></a>      return <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a>;
<a name="l2194"><span class="linenum">2194</span></a>  }
<a name="l2195"><span class="linenum">2195</span></a>  
<a name="l2196"><span class="linenum">2196</span></a>  
<a name="l2197"><span class="linenum">2197</span></a>  <span class="comment">/**</span>
<a name="l2198"><span class="linenum">2198</span></a>  <span class="comment"> * Get action icons to delete thread</span>
<a name="l2199"><span class="linenum">2199</span></a>  <span class="comment"> *</span>
<a name="l2200"><span class="linenum">2200</span></a>  <span class="comment"> * @param integer Thread ID</span>
<a name="l2201"><span class="linenum">2201</span></a>  <span class="comment"> * @return string Action icon</span>
<a name="l2202"><span class="linenum">2202</span></a>  <span class="comment"> */</span>
<a name="l2203"><span class="linenum">2203</span></a>  function <a class="function" onClick="logFunction('col_thread_delete_action')" href="../../../_functions/col_thread_delete_action.html" onMouseOver="funcPopup(event,'col_thread_delete_action')">col_thread_delete_action</a>( <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a> )
<a name="l2204"><span class="linenum">2204</span></a>  {
<a name="l2205"><span class="linenum">2205</span></a>      global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>, <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('samedomain_htsrv_url')" href="../../../_variables/samedomain_htsrv_url.html">$samedomain_htsrv_url</a>, <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>;
<a name="l2206"><span class="linenum">2206</span></a>  
<a name="l2207"><span class="linenum">2207</span></a>      if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l2208"><span class="linenum">2208</span></a>      {
<a name="l2209"><span class="linenum">2209</span></a>          <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = <a class="phpfunction" onClick="logFunction('rawurlencode')" href="../../../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>( <a class="function" onClick="logFunction('regenerate_url')" href="../../../_functions/regenerate_url.html" onMouseOver="funcPopup(event,'regenerate_url')">regenerate_url</a>( '', '', '', '&amp;' ) );
<a name="l2210"><span class="linenum">2210</span></a>          return <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Delete'), 'delete', <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>.'?ctrl=threads&amp;amp;thrd_ID='.<a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a>.'&amp;amp;action=delete&amp;amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'messaging_threads' ).'&amp;amp;redirect_to='.<a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> );
<a name="l2211"><span class="linenum">2211</span></a>      }
<a name="l2212"><span class="linenum">2212</span></a>      else
<a name="l2213"><span class="linenum">2213</span></a>      {
<a name="l2214"><span class="linenum">2214</span></a>          <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = <a class="function" onClick="logFunction('get_dispctrl_url')" href="../../../_functions/get_dispctrl_url.html" onMouseOver="funcPopup(event,'get_dispctrl_url')">get_dispctrl_url</a>( 'threads' );
<a name="l2215"><span class="linenum">2215</span></a>          return <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Delete'), 'delete', <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('samedomain_htsrv_url')" href="../../../_variables/samedomain_htsrv_url.html">$samedomain_htsrv_url</a>.'action.php?mname=messaging&amp;thrd_ID='.<a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a>.'&amp;action=delete&amp;redirect_to='.<a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'messaging_threads' ) );
<a name="l2216"><span class="linenum">2216</span></a>      }
<a name="l2217"><span class="linenum">2217</span></a>  }
<a name="l2218"><span class="linenum">2218</span></a>  
<a name="l2219"><span class="linenum">2219</span></a>  <span class="comment">/**</span>
<a name="l2220"><span class="linenum">2220</span></a>  <span class="comment"> * Create author cell for message list table</span>
<a name="l2221"><span class="linenum">2221</span></a>  <span class="comment"> *</span>
<a name="l2222"><span class="linenum">2222</span></a>  <span class="comment"> * @param integer user ID</span>
<a name="l2223"><span class="linenum">2223</span></a>  <span class="comment"> * @param string login</span>
<a name="l2224"><span class="linenum">2224</span></a>  <span class="comment"> * @param string first name</span>
<a name="l2225"><span class="linenum">2225</span></a>  <span class="comment"> * @param string last name</span>
<a name="l2226"><span class="linenum">2226</span></a>  <span class="comment"> * @param integer avatar ID</span>
<a name="l2227"><span class="linenum">2227</span></a>  <span class="comment"> * @param string datetime</span>
<a name="l2228"><span class="linenum">2228</span></a>  <span class="comment"> */</span>
<a name="l2229"><span class="linenum">2229</span></a>  function <a class="function" onClick="logFunction('col_msg_author')" href="../../../_functions/col_msg_author.html" onMouseOver="funcPopup(event,'col_msg_author')">col_msg_author</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> )
<a name="l2230"><span class="linenum">2230</span></a>  {
<a name="l2231"><span class="linenum">2231</span></a>      <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('author')" href="../../../_variables/author.html">$author</a> = <a class="function" onClick="logFunction('get_user_avatar_styled')" href="../../../_functions/get_user_avatar_styled.html" onMouseOver="funcPopup(event,'get_user_avatar_styled')">get_user_avatar_styled</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, array( 'size' =&gt; 'crop-top-80x80' ) );
<a name="l2232"><span class="linenum">2232</span></a>      return <a class="var it518" onMouseOver="hilite(518)" onMouseOut="lolite()" onClick="logVariable('author')" href="../../../_variables/author.html">$author</a>.'&lt;div class=&quot;note black&quot;&gt;'.<a class="function" onClick="logFunction('mysql2date')" href="../../../_functions/mysql2date.html" onMouseOver="funcPopup(event,'mysql2date')">mysql2date</a>( <a class="function" onClick="logFunction('locale_datefmt')" href="../../../_functions/locale_datefmt.html" onMouseOver="funcPopup(event,'locale_datefmt')">locale_datefmt</a>().'&lt;\b\r /&gt;'.<a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( ':s', '', <a class="function" onClick="logFunction('locale_timefmt')" href="../../../_functions/locale_timefmt.html" onMouseOver="funcPopup(event,'locale_timefmt')">locale_timefmt</a>() ), <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> ).'&lt;/div&gt;';
<a name="l2233"><span class="linenum">2233</span></a>  }
<a name="l2234"><span class="linenum">2234</span></a>  
<a name="l2235"><span class="linenum">2235</span></a>  
<a name="l2236"><span class="linenum">2236</span></a>  <span class="comment">/**</span>
<a name="l2237"><span class="linenum">2237</span></a>  <span class="comment"> * Get formatted message text</span>
<a name="l2238"><span class="linenum">2238</span></a>  <span class="comment"> *</span>
<a name="l2239"><span class="linenum">2239</span></a>  <span class="comment"> * @param integer Message ID</span>
<a name="l2240"><span class="linenum">2240</span></a>  <span class="comment"> * @param string Thread title</span>
<a name="l2241"><span class="linenum">2241</span></a>  <span class="comment"> * @return string Formatted message text</span>
<a name="l2242"><span class="linenum">2242</span></a>  <span class="comment"> */</span>
<a name="l2243"><span class="linenum">2243</span></a>  function <a class="function" onClick="logFunction('col_msg_format_text')" href="../../../_functions/col_msg_format_text.html" onMouseOver="funcPopup(event,'col_msg_format_text')">col_msg_format_text</a>( <a class="var it1094" onMouseOver="hilite(1094)" onMouseOut="lolite()" onClick="logVariable('msg_ID')" href="../../../_variables/msg_ID.html">$msg_ID</a>, <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a> )
<a name="l2244"><span class="linenum">2244</span></a>  {
<a name="l2245"><span class="linenum">2245</span></a>      <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('MessageCache')" href="../../../_variables/MessageCache.html">$MessageCache</a> = &amp; get_MessageCache();
<a name="l2246"><span class="linenum">2246</span></a>      if( <a class="var it4228" onMouseOver="hilite(4228)" onMouseOut="lolite()" onClick="logVariable('Message')" href="../../../_variables/Message.html">$Message</a> = &amp; <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('MessageCache')" href="../../../_variables/MessageCache.html">$MessageCache</a>-&gt;get_by_ID( <a class="var it1094" onMouseOver="hilite(1094)" onMouseOut="lolite()" onClick="logVariable('msg_ID')" href="../../../_variables/msg_ID.html">$msg_ID</a>, false, false ) )
<a name="l2247"><span class="linenum">2247</span></a>      { // Get the prerendered content
<a name="l2248"><span class="linenum">2248</span></a>          <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a> = <a class="var it4228" onMouseOver="hilite(4228)" onMouseOut="lolite()" onClick="logVariable('Message')" href="../../../_variables/Message.html">$Message</a>-&gt;<a class="function" onClick="logFunction('get_content')" href="../../../_functions/get_content.html" onMouseOver="funcPopup(event,'get_content')">get_content</a>();
<a name="l2249"><span class="linenum">2249</span></a>      }
<a name="l2250"><span class="linenum">2250</span></a>  
<a name="l2251"><span class="linenum">2251</span></a>      if( empty( <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a> ) )
<a name="l2252"><span class="linenum">2252</span></a>      {
<a name="l2253"><span class="linenum">2253</span></a>          return <a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a>, 'htmlspecialchars' );
<a name="l2254"><span class="linenum">2254</span></a>      }
<a name="l2255"><span class="linenum">2255</span></a>  
<a name="l2256"><span class="linenum">2256</span></a>      <span class="comment">/**** yura&gt; This below code is moved to the Plugins and to $Message-&gt;get_content() :</span>
<a name="l2257"><span class="linenum">2257</span></a>  <span class="comment"></span>
<a name="l2258"><span class="linenum">2258</span></a>  <span class="comment">    // WARNING: the messages may contain MALICIOUS HTML and javascript snippets. They must ALWAYS be ESCAPED prior to display!</span>
<a name="l2259"><span class="linenum">2259</span></a>  <span class="comment">    $msg_text = htmlentities( $msg_text, ENT_COMPAT, $evo_charset );</span>
<a name="l2260"><span class="linenum">2260</span></a>  <span class="comment"></span>
<a name="l2261"><span class="linenum">2261</span></a>  <span class="comment">    $msg_text = make_clickable( $msg_text );</span>
<a name="l2262"><span class="linenum">2262</span></a>  <span class="comment">    $msg_text = preg_replace( '#&lt;a #i', '&lt;a rel=&quot;nofollow&quot; target=&quot;_blank&quot;', $msg_text );</span>
<a name="l2263"><span class="linenum">2263</span></a>  <span class="comment">    $msg_text = nl2br( $msg_text );</span>
<a name="l2264"><span class="linenum">2264</span></a>  <span class="comment"></span>
<a name="l2265"><span class="linenum">2265</span></a>  <span class="comment">    ****/</span>
<a name="l2266"><span class="linenum">2266</span></a>  
<a name="l2267"><span class="linenum">2267</span></a>      return <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a>;
<a name="l2268"><span class="linenum">2268</span></a>  }
<a name="l2269"><span class="linenum">2269</span></a>  
<a name="l2270"><span class="linenum">2270</span></a>  
<a name="l2271"><span class="linenum">2271</span></a>  <span class="comment">/**</span>
<a name="l2272"><span class="linenum">2272</span></a>  <span class="comment"> * Get authors list to display who already had read current message</span>
<a name="l2273"><span class="linenum">2273</span></a>  <span class="comment"> *</span>
<a name="l2274"><span class="linenum">2274</span></a>  <span class="comment"> * @param integer Message ID</span>
<a name="l2275"><span class="linenum">2275</span></a>  <span class="comment"> * @return string Authors list with red/green bullet icons</span>
<a name="l2276"><span class="linenum">2276</span></a>  <span class="comment"> */</span>
<a name="l2277"><span class="linenum">2277</span></a>  function <a class="function" onClick="logFunction('col_msg_read_by')" href="../../../_functions/col_msg_read_by.html" onMouseOver="funcPopup(event,'col_msg_read_by')">col_msg_read_by</a>( <a class="var it5061" onMouseOver="hilite(5061)" onMouseOut="lolite()" onClick="logVariable('message_ID')" href="../../../_variables/message_ID.html">$message_ID</a> )
<a name="l2278"><span class="linenum">2278</span></a>  {
<a name="l2279"><span class="linenum">2279</span></a>      global <a class="var it5062" onMouseOver="hilite(5062)" onMouseOut="lolite()" onClick="logVariable('read_status_list')" href="../../../_variables/read_status_list.html">$read_status_list</a>, <a class="var it5063" onMouseOver="hilite(5063)" onMouseOut="lolite()" onClick="logVariable('leave_status_list')" href="../../../_variables/leave_status_list.html">$leave_status_list</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a>;
<a name="l2280"><span class="linenum">2280</span></a>  
<a name="l2281"><span class="linenum">2281</span></a>      <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l2282"><span class="linenum">2282</span></a>  
<a name="l2283"><span class="linenum">2283</span></a>      if( empty( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> ) )
<a name="l2284"><span class="linenum">2284</span></a>      {    // Set avatar size for a case when blog is not defined
<a name="l2285"><span class="linenum">2285</span></a>          <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('avatar_size')" href="../../../_variables/avatar_size.html">$avatar_size</a> = 'crop-top-32x32';
<a name="l2286"><span class="linenum">2286</span></a>      }
<a name="l2287"><span class="linenum">2287</span></a>      else
<a name="l2288"><span class="linenum">2288</span></a>      {    // Get avatar size from blog settings
<a name="l2289"><span class="linenum">2289</span></a>          <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('avatar_size')" href="../../../_variables/avatar_size.html">$avatar_size</a> = <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get_setting')" href="../../../_functions/get_setting.html" onMouseOver="funcPopup(event,'get_setting')">get_setting</a>('image_size_messaging');
<a name="l2290"><span class="linenum">2290</span></a>      }
<a name="l2291"><span class="linenum">2291</span></a>  
<a name="l2292"><span class="linenum">2292</span></a>      <a class="var it5064" onMouseOver="hilite(5064)" onMouseOut="lolite()" onClick="logVariable('read_recipients')" href="../../../_variables/read_recipients.html">$read_recipients</a> = array();
<a name="l2293"><span class="linenum">2293</span></a>      <a class="var it5065" onMouseOver="hilite(5065)" onMouseOut="lolite()" onClick="logVariable('unread_recipients')" href="../../../_variables/unread_recipients.html">$unread_recipients</a> = array();
<a name="l2294"><span class="linenum">2294</span></a>      foreach( <a class="var it5062" onMouseOver="hilite(5062)" onMouseOut="lolite()" onClick="logVariable('read_status_list')" href="../../../_variables/read_status_list.html">$read_status_list</a> as <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> =&gt; <a class="var it5066" onMouseOver="hilite(5066)" onMouseOut="lolite()" onClick="logVariable('first_unread_msg_ID')" href="../../../_variables/first_unread_msg_ID.html">$first_unread_msg_ID</a> )
<a name="l2295"><span class="linenum">2295</span></a>      {
<a name="l2296"><span class="linenum">2296</span></a>          if( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> == <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l2297"><span class="linenum">2297</span></a>          { // Current user status: current user should not be displayed except in case of abuse management
<a name="l2298"><span class="linenum">2298</span></a>              if( <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> )
<a name="l2299"><span class="linenum">2299</span></a>              { // current user has seen all received messages for sure, set first unread msg to NULL
<a name="l2300"><span class="linenum">2300</span></a>                  <a class="var it5066" onMouseOver="hilite(5066)" onMouseOut="lolite()" onClick="logVariable('first_unread_msg_ID')" href="../../../_variables/first_unread_msg_ID.html">$first_unread_msg_ID</a> = NULL;
<a name="l2301"><span class="linenum">2301</span></a>              }
<a name="l2302"><span class="linenum">2302</span></a>              else
<a name="l2303"><span class="linenum">2303</span></a>              { // not abuse management
<a name="l2304"><span class="linenum">2304</span></a>                  continue;
<a name="l2305"><span class="linenum">2305</span></a>              }
<a name="l2306"><span class="linenum">2306</span></a>          }
<a name="l2307"><span class="linenum">2307</span></a>  
<a name="l2308"><span class="linenum">2308</span></a>          <a class="var it551" onMouseOver="hilite(551)" onMouseOut="lolite()" onClick="logVariable('recipient_User')" href="../../../_variables/recipient_User.html">$recipient_User</a> = <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_ID( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, false );
<a name="l2309"><span class="linenum">2309</span></a>          if( !<a class="var it551" onMouseOver="hilite(551)" onMouseOut="lolite()" onClick="logVariable('recipient_User')" href="../../../_variables/recipient_User.html">$recipient_User</a> )
<a name="l2310"><span class="linenum">2310</span></a>          { // user not exists
<a name="l2311"><span class="linenum">2311</span></a>              continue;
<a name="l2312"><span class="linenum">2312</span></a>          }
<a name="l2313"><span class="linenum">2313</span></a>  
<a name="l2314"><span class="linenum">2314</span></a>          <a class="var it5067" onMouseOver="hilite(5067)" onMouseOut="lolite()" onClick="logVariable('leave_msg_ID')" href="../../../_variables/leave_msg_ID.html">$leave_msg_ID</a> = <a class="var it5063" onMouseOver="hilite(5063)" onMouseOut="lolite()" onClick="logVariable('leave_status_list')" href="../../../_variables/leave_status_list.html">$leave_status_list</a>[ <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ];
<a name="l2315"><span class="linenum">2315</span></a>          if( !empty( <a class="var it5067" onMouseOver="hilite(5067)" onMouseOut="lolite()" onClick="logVariable('leave_msg_ID')" href="../../../_variables/leave_msg_ID.html">$leave_msg_ID</a> ) &amp;&amp; ( <a class="var it5067" onMouseOver="hilite(5067)" onMouseOut="lolite()" onClick="logVariable('leave_msg_ID')" href="../../../_variables/leave_msg_ID.html">$leave_msg_ID</a> &lt; <a class="var it5061" onMouseOver="hilite(5061)" onMouseOut="lolite()" onClick="logVariable('message_ID')" href="../../../_variables/message_ID.html">$message_ID</a> ) )
<a name="l2316"><span class="linenum">2316</span></a>          { // user has left the conversation and didn't receive this message
<a name="l2317"><span class="linenum">2317</span></a>              <a class="var it5068" onMouseOver="hilite(5068)" onMouseOut="lolite()" onClick="logVariable('left_recipients')" href="../../../_variables/left_recipients.html">$left_recipients</a>[] = <a class="var it551" onMouseOver="hilite(551)" onMouseOut="lolite()" onClick="logVariable('recipient_User')" href="../../../_variables/recipient_User.html">$recipient_User</a>-&gt;<a onClick="logVariable('login')" class="var it10700" onMouseOver="hilite(10700)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l2318"><span class="linenum">2318</span></a>          }
<a name="l2319"><span class="linenum">2319</span></a>          elseif( empty( <a class="var it5066" onMouseOver="hilite(5066)" onMouseOut="lolite()" onClick="logVariable('first_unread_msg_ID')" href="../../../_variables/first_unread_msg_ID.html">$first_unread_msg_ID</a> ) || ( <a class="var it5066" onMouseOver="hilite(5066)" onMouseOut="lolite()" onClick="logVariable('first_unread_msg_ID')" href="../../../_variables/first_unread_msg_ID.html">$first_unread_msg_ID</a> &gt; <a class="var it5061" onMouseOver="hilite(5061)" onMouseOut="lolite()" onClick="logVariable('message_ID')" href="../../../_variables/message_ID.html">$message_ID</a> ) )
<a name="l2320"><span class="linenum">2320</span></a>          { // user has read all message from this thread or at least this message
<a name="l2321"><span class="linenum">2321</span></a>  <span class="comment">            // user didn't leave the conversation before this message</span>
<a name="l2322"><span class="linenum">2322</span></a>              <a class="var it5064" onMouseOver="hilite(5064)" onMouseOut="lolite()" onClick="logVariable('read_recipients')" href="../../../_variables/read_recipients.html">$read_recipients</a>[] = <a class="var it551" onMouseOver="hilite(551)" onMouseOut="lolite()" onClick="logVariable('recipient_User')" href="../../../_variables/recipient_User.html">$recipient_User</a>-&gt;<a onClick="logVariable('login')" class="var it10700" onMouseOver="hilite(10700)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l2323"><span class="linenum">2323</span></a>          }
<a name="l2324"><span class="linenum">2324</span></a>          else
<a name="l2325"><span class="linenum">2325</span></a>          { // User didn't read this message, but didn't leave the conversation either
<a name="l2326"><span class="linenum">2326</span></a>              <a class="var it5065" onMouseOver="hilite(5065)" onMouseOut="lolite()" onClick="logVariable('unread_recipients')" href="../../../_variables/unread_recipients.html">$unread_recipients</a>[] = <a class="var it551" onMouseOver="hilite(551)" onMouseOut="lolite()" onClick="logVariable('recipient_User')" href="../../../_variables/recipient_User.html">$recipient_User</a>-&gt;<a onClick="logVariable('login')" class="var it10700" onMouseOver="hilite(10700)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l2327"><span class="linenum">2327</span></a>          }
<a name="l2328"><span class="linenum">2328</span></a>      }
<a name="l2329"><span class="linenum">2329</span></a>  
<a name="l2330"><span class="linenum">2330</span></a>      <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> = '';
<a name="l2331"><span class="linenum">2331</span></a>      if( !empty( <a class="var it5064" onMouseOver="hilite(5064)" onMouseOut="lolite()" onClick="logVariable('read_recipients')" href="../../../_variables/read_recipients.html">$read_recipients</a> ) )
<a name="l2332"><span class="linenum">2332</span></a>      { // There are users who have read this message
<a name="l2333"><span class="linenum">2333</span></a>          <a class="phpfunction" onClick="logFunction('asort')" href="../../../_functions/asort.html" onMouseOver="phpfuncPopup(event,'asort')">asort</a>( <a class="var it5064" onMouseOver="hilite(5064)" onMouseOut="lolite()" onClick="logVariable('read_recipients')" href="../../../_variables/read_recipients.html">$read_recipients</a> );
<a name="l2334"><span class="linenum">2334</span></a>          <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= '&lt;div&gt;'.<a class="function" onClick="logFunction('get_avatar_imgtags')" href="../../../_functions/get_avatar_imgtags.html" onMouseOver="funcPopup(event,'get_avatar_imgtags')">get_avatar_imgtags</a>( <a class="var it5064" onMouseOver="hilite(5064)" onMouseOut="lolite()" onClick="logVariable('read_recipients')" href="../../../_variables/read_recipients.html">$read_recipients</a>, true, false, <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('avatar_size')" href="../../../_variables/avatar_size.html">$avatar_size</a>, '', '', true, false );
<a name="l2335"><span class="linenum">2335</span></a>          if( !empty ( <a class="var it5065" onMouseOver="hilite(5065)" onMouseOut="lolite()" onClick="logVariable('unread_recipients')" href="../../../_variables/unread_recipients.html">$unread_recipients</a> ) )
<a name="l2336"><span class="linenum">2336</span></a>          {
<a name="l2337"><span class="linenum">2337</span></a>              <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= '&lt;br /&gt;';
<a name="l2338"><span class="linenum">2338</span></a>          }
<a name="l2339"><span class="linenum">2339</span></a>          <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= '&lt;/div&gt;';
<a name="l2340"><span class="linenum">2340</span></a>      }
<a name="l2341"><span class="linenum">2341</span></a>  
<a name="l2342"><span class="linenum">2342</span></a>      if( !empty ( <a class="var it5065" onMouseOver="hilite(5065)" onMouseOut="lolite()" onClick="logVariable('unread_recipients')" href="../../../_variables/unread_recipients.html">$unread_recipients</a> ) )
<a name="l2343"><span class="linenum">2343</span></a>      { // There are users who didn't read this message
<a name="l2344"><span class="linenum">2344</span></a>          <a class="phpfunction" onClick="logFunction('asort')" href="../../../_functions/asort.html" onMouseOver="phpfuncPopup(event,'asort')">asort</a>( <a class="var it5065" onMouseOver="hilite(5065)" onMouseOut="lolite()" onClick="logVariable('unread_recipients')" href="../../../_variables/unread_recipients.html">$unread_recipients</a> );
<a name="l2345"><span class="linenum">2345</span></a>          <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= '&lt;div&gt;'.<a class="function" onClick="logFunction('get_avatar_imgtags')" href="../../../_functions/get_avatar_imgtags.html" onMouseOver="funcPopup(event,'get_avatar_imgtags')">get_avatar_imgtags</a>( <a class="var it5065" onMouseOver="hilite(5065)" onMouseOut="lolite()" onClick="logVariable('unread_recipients')" href="../../../_variables/unread_recipients.html">$unread_recipients</a>, true, false, <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('avatar_size')" href="../../../_variables/avatar_size.html">$avatar_size</a>, '', '', false, false ).'&lt;/div&gt;';
<a name="l2346"><span class="linenum">2346</span></a>      }
<a name="l2347"><span class="linenum">2347</span></a>  
<a name="l2348"><span class="linenum">2348</span></a>      if( !empty ( <a class="var it5068" onMouseOver="hilite(5068)" onMouseOut="lolite()" onClick="logVariable('left_recipients')" href="../../../_variables/left_recipients.html">$left_recipients</a> ) )
<a name="l2349"><span class="linenum">2349</span></a>      { // There are users who left the conversation before this message
<a name="l2350"><span class="linenum">2350</span></a>          <a class="phpfunction" onClick="logFunction('asort')" href="../../../_functions/asort.html" onMouseOver="phpfuncPopup(event,'asort')">asort</a>( <a class="var it5068" onMouseOver="hilite(5068)" onMouseOut="lolite()" onClick="logVariable('left_recipients')" href="../../../_variables/left_recipients.html">$left_recipients</a> );
<a name="l2351"><span class="linenum">2351</span></a>          <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a> .= '&lt;div&gt;'.<a class="function" onClick="logFunction('get_avatar_imgtags')" href="../../../_functions/get_avatar_imgtags.html" onMouseOver="funcPopup(event,'get_avatar_imgtags')">get_avatar_imgtags</a>( <a class="var it5068" onMouseOver="hilite(5068)" onMouseOut="lolite()" onClick="logVariable('left_recipients')" href="../../../_variables/left_recipients.html">$left_recipients</a>, true, false, <a class="var it174" onMouseOver="hilite(174)" onMouseOut="lolite()" onClick="logVariable('avatar_size')" href="../../../_variables/avatar_size.html">$avatar_size</a>, '', '', 'left_message', false ).'&lt;/div&gt;';
<a name="l2352"><span class="linenum">2352</span></a>      }
<a name="l2353"><span class="linenum">2353</span></a>      return <a class="var it5057" onMouseOver="hilite(5057)" onMouseOut="lolite()" onClick="logVariable('read_by')" href="../../../_variables/read_by.html">$read_by</a>;
<a name="l2354"><span class="linenum">2354</span></a>  }
<a name="l2355"><span class="linenum">2355</span></a>  
<a name="l2356"><span class="linenum">2356</span></a>  
<a name="l2357"><span class="linenum">2357</span></a>  <span class="comment">/**</span>
<a name="l2358"><span class="linenum">2358</span></a>  <span class="comment"> *</span>
<a name="l2359"><span class="linenum">2359</span></a>  <span class="comment"> *</span>
<a name="l2360"><span class="linenum">2360</span></a>  <span class="comment"> * @param mixed $thrd_ID</span>
<a name="l2361"><span class="linenum">2361</span></a>  <span class="comment"> * @param mixed $msg_ID</span>
<a name="l2362"><span class="linenum">2362</span></a>  <span class="comment"> * @return string</span>
<a name="l2363"><span class="linenum">2363</span></a>  <span class="comment"> */</span>
<a name="l2364"><span class="linenum">2364</span></a>  function <a class="function" onClick="logFunction('col_msg_actions')" href="../../../_functions/col_msg_actions.html" onMouseOver="funcPopup(event,'col_msg_actions')">col_msg_actions</a>( <a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>, <a class="var it1094" onMouseOver="hilite(1094)" onMouseOut="lolite()" onClick="logVariable('msg_ID')" href="../../../_variables/msg_ID.html">$msg_ID</a> )
<a name="l2365"><span class="linenum">2365</span></a>  {
<a name="l2366"><span class="linenum">2366</span></a>      global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>, <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('samedomain_htsrv_url')" href="../../../_variables/samedomain_htsrv_url.html">$samedomain_htsrv_url</a>, <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a>;
<a name="l2367"><span class="linenum">2367</span></a>  
<a name="l2368"><span class="linenum">2368</span></a>      if( <a class="var it1094" onMouseOver="hilite(1094)" onMouseOut="lolite()" onClick="logVariable('msg_ID')" href="../../../_variables/msg_ID.html">$msg_ID</a> &lt; 1 )
<a name="l2369"><span class="linenum">2369</span></a>      { // Don't display actions in preview mode
<a name="l2370"><span class="linenum">2370</span></a>          return '&amp;nbsp;';
<a name="l2371"><span class="linenum">2371</span></a>      }
<a name="l2372"><span class="linenum">2372</span></a>      else if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l2373"><span class="linenum">2373</span></a>      {
<a name="l2374"><span class="linenum">2374</span></a>          <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('tab')" href="../../../_variables/tab.html">$tab</a> = '';
<a name="l2375"><span class="linenum">2375</span></a>          if( <a class="var it2711" onMouseOver="hilite(2711)" onMouseOut="lolite()" onClick="logVariable('perm_abuse_management')" href="../../../_variables/perm_abuse_management.html">$perm_abuse_management</a> )
<a name="l2376"><span class="linenum">2376</span></a>          {    // We are in Abuse Management
<a name="l2377"><span class="linenum">2377</span></a>              <a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('tab')" href="../../../_variables/tab.html">$tab</a> = '&amp;tab=abuse';
<a name="l2378"><span class="linenum">2378</span></a>          }
<a name="l2379"><span class="linenum">2379</span></a>          return <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Delete'), 'delete', <a class="function" onClick="logFunction('regenerate_url')" href="../../../_functions/regenerate_url.html" onMouseOver="funcPopup(event,'regenerate_url')">regenerate_url</a>( 'action', 'thrd_ID='.<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>.'&amp;msg_ID='.<a class="var it1094" onMouseOver="hilite(1094)" onMouseOut="lolite()" onClick="logVariable('msg_ID')" href="../../../_variables/msg_ID.html">$msg_ID</a>.'&amp;action=delete'.<a class="var it1211" onMouseOver="hilite(1211)" onMouseOut="lolite()" onClick="logVariable('tab')" href="../../../_variables/tab.html">$tab</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'messaging_messages' ) ) );
<a name="l2380"><span class="linenum">2380</span></a>      }
<a name="l2381"><span class="linenum">2381</span></a>      else
<a name="l2382"><span class="linenum">2382</span></a>      {
<a name="l2383"><span class="linenum">2383</span></a>          <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('gen_blogurl')" href="../../../_functions/gen_blogurl.html" onMouseOver="funcPopup(event,'gen_blogurl')">gen_blogurl</a>(), 'disp=messages&amp;thrd_ID='.<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a> );
<a name="l2384"><span class="linenum">2384</span></a>          <a class="var it169" onMouseOver="hilite(169)" onMouseOut="lolite()" onClick="logVariable('action_url')" href="../../../_variables/action_url.html">$action_url</a> = <a class="var it126" onMouseOver="hilite(126)" onMouseOut="lolite()" onClick="logVariable('samedomain_htsrv_url')" href="../../../_variables/samedomain_htsrv_url.html">$samedomain_htsrv_url</a>.'action.php?mname=messaging&amp;disp=messages&amp;thrd_ID='.<a class="var it1083" onMouseOver="hilite(1083)" onMouseOut="lolite()" onClick="logVariable('thrd_ID')" href="../../../_variables/thrd_ID.html">$thrd_ID</a>.'&amp;msg_ID='.<a class="var it1094" onMouseOver="hilite(1094)" onMouseOut="lolite()" onClick="logVariable('msg_ID')" href="../../../_variables/msg_ID.html">$msg_ID</a>.'&amp;action=delete&amp;blog='.<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a onClick="logVariable('ID')" class="var it10696" onMouseOver="hilite(10696)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l2385"><span class="linenum">2385</span></a>          <a class="var it169" onMouseOver="hilite(169)" onMouseOut="lolite()" onClick="logVariable('action_url')" href="../../../_variables/action_url.html">$action_url</a> = <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it169" onMouseOver="hilite(169)" onMouseOut="lolite()" onClick="logVariable('action_url')" href="../../../_variables/action_url.html">$action_url</a>, 'redirect_to='.<a class="phpfunction" onClick="logFunction('rawurlencode')" href="../../../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>( <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> ), '&amp;' );
<a name="l2386"><span class="linenum">2386</span></a>          return <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Delete'), 'delete', <a class="var it169" onMouseOver="hilite(169)" onMouseOut="lolite()" onClick="logVariable('action_url')" href="../../../_variables/action_url.html">$action_url</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'messaging_messages' ) );
<a name="l2387"><span class="linenum">2387</span></a>      }
<a name="l2388"><span class="linenum">2388</span></a>  }
<a name="l2389"><span class="linenum">2389</span></a>  
<a name="l2390"><span class="linenum">2390</span></a>  <span class="comment">/**</span>
<a name="l2391"><span class="linenum">2391</span></a>  <span class="comment"> * Helper functions to display Threads results.</span>
<a name="l2392"><span class="linenum">2392</span></a>  <span class="comment"> * New ( not display helper ) functions must be created above threads_results function</span>
<a name="l2393"><span class="linenum">2393</span></a>  <span class="comment"> */</span>
<a name="l2394"><span class="linenum">2394</span></a>  
<a name="l2395"><span class="linenum">2395</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'create_new_message': ['create_new_message', 'Create a new message from request in the given thread ', [['inc/messaging/model','_messaging.funcs.php',210]], 4],
'get_preferred_name': ['get_preferred_name', 'Get preferred name of the user ', [['inc/users/model','_user.class.php',1345]], 13],
'is_admin_page': ['is_admin_page', 'Is the current page an admin/backoffice page? ', [['inc/_core','_misc.funcs.php',5028]], 118],
'dbinsert_message': ['dbinsert_message', 'Insert message in existing thread ', [['inc/messaging/model','_message.class.php',285]], 1],
'begin': ['begin', 'BEGIN A TRANSCATION ', [['inc/_core/model/db','_db.class.php',1537]], 114],
'dbinsert_individual': ['dbinsert_individual', 'Insert new thread for each recipient ', [['inc/messaging/model','_message.class.php',261]], 3],
'get_unread_messages_count': ['get_unread_messages_count', 'Get a count of unread messages for the user ', [['inc/messaging/model','_messaging.funcs.php',1503]], 2],
'get_avatar_imgtags': ['get_avatar_imgtags', 'Get avatar <img> tags for list of user logins ', [['inc/users/model','_user.funcs.php',1624]], 8],
'create_contacts_group': ['create_contacts_group', 'Insert contacts group into database ', [['inc/messaging/model','_messaging.funcs.php',760]], 2],
'gen_blogurl': ['gen_blogurl', 'Generate blog URL. That is the URL of the main page/home page of the blog. This will nto necessarily be a folder. For example, it can end in index.php?blog=4 ', [['inc/collections/model','_blog.class.php',1128]], 94],
'mysql2localedate': ['mysql2localedate', 'Format a MYSQL date to current locale date format. ', [['inc/_core','_misc.funcs.php',1263]], 13],
'display_list_start': ['display_list_start', 'Display list/table start. ', [['inc/_core/ui','_uiwidget.class.php',602],['inc/_core/ui/results','_resultsel.class.php',87]], 12],
'col_msg_author': ['col_msg_author', 'Create author cell for message list table ', [['inc/messaging/model','_messaging.funcs.php',2219]], 2],
'global_icon': ['global_icon', 'Registers a global action icon ', [['inc/_core/ui','_uiwidget.class.php',70]], 166],
'load_recipients': ['load_recipients', 'Load recipients of the current thread ', [['inc/messaging/model','_thread.class.php',455]], 5],
'set_contact_blocked': ['set_contact_blocked', 'Block or unblock contact ', [['inc/messaging/model','_messaging.funcs.php',115]], 8],
'check_blocked_contacts': ['check_blocked_contacts', 'Check blocked contacts in recipients list. Note: If current User has only reply permission then users who didn\'t have the current User in their contact list will be considerated as blocked contacts! ', [['inc/messaging/model','_messaging.funcs.php',49]], 2],
'conditional': ['conditional', '', [['inc/_core/ui/results','_results.class.php',2351]], 19],
'param': ['param', 'Sets a parameter with values from the request or to provided default, except if param is already set! ', [['inc/_core','_param.funcs.php',35]], 2141],
'load_from_request': ['load_from_request', 'Init filter params from Request params ', [['inc/items/model','_itemlistlight.class.php',324],['inc/items/model','_item.class.php',570],['inc/widgets/widgets','_coll_tag_cloud.widget.php',37],['inc/tools/model','_emailaddress.class.php',90],['inc/email_campaigns/model','_emailcampaign.class.php',186],['inc/maintenance/model','_backup.class.php',159],['inc/items/model','_itemstatus.class.php',63],['inc/sessions/model','_domain.class.php',54],['inc/regional/model','_country.class.php',70],['inc/users/model','_user.class.php',341],['inc/skins/model','_skin.class.php',158],['inc/comments/model','_commentlist.class.php',253],['inc/messaging/model','_message.class.php',124],['inc/users/model','_userlist.class.php',260],['inc/messaging/model','_thread.class.php',186],['inc/items/model','_itemtype.class.php',148],['inc/regional/model','_subregion.class.php',78],['inc/files/model','_filetype.class.php',61],['inc/collections/model','_blog.class.php',375],['inc/cron/model','_cronjob.class.php',107],['inc/users/model','_userfield.class.php',172],['inc/regional/model','_city.class.php',68],['inc/slugs/model','_slug.class.php',94],['inc/users/model','_group.class.php',122],['inc/users/model','_invitation.class.php',69],['inc/regional/model','_currency.class.php',62],['inc/widgets/model','_widget.class.php',138],['inc/regional/model','_region.class.php',66],['inc/chapters/model','_chapter.class.php',286],['inc/antispam/model','_iprange.class.php',86],['inc/sessions/model','_goalcat.class.php',59],['inc/items/model','_itemtag.class.php',75],['inc/sessions/model','_goal.class.php',112],['inc/users/model','_userfieldgroup.class.php',64],['inc/users/model','_organization.class.php',67]], 82],
'get_contacts_groups_array': ['get_contacts_groups_array', 'Get all contact groups of the current User ', [['inc/messaging/model','_messaging.funcs.php',1150]], 3],
'get_first_unread_message_date': ['get_first_unread_message_date', 'Get the first ( oldest ) unread message of the user ', [['inc/messaging/model','_messaging.funcs.php',1539]], 1],
'locale_datefmt': ['locale_datefmt', 'Returns the current locale\'s default date format ', [['inc/locales','_locale.funcs.php',385]], 71],
'col_thread_subject_link': ['col_thread_subject_link', 'Get subject as link with icon (read or unread) ', [['inc/messaging/model','_messaging.funcs.php',2081]], 1],
'get_thread_prevnext_links': ['get_thread_prevnext_links', 'Get the links for previous/next threads ', [['inc/messaging/model','_messaging.funcs.php',1781]], 1],
'delete_contacts_group': ['delete_contacts_group', 'Delete contacts group ', [['inc/messaging/model','_messaging.funcs.php',844]], 2],
'dbinsert_discussion': ['dbinsert_discussion', '', [['inc/messaging/model','_message.class.php',224]], 2],
'param_errors_detected': ['param_errors_detected', 'Check if there have been validation errors ', [['inc/_core','_param.funcs.php',1480]], 61],
'delete_orphan_threads': ['delete_orphan_threads', 'Delete orphan threads ', [['inc/messaging/model','_messaging.funcs.php',1678]], 1],
'seconds_to_period': ['seconds_to_period', 'Convert seconds to readable period ', [['inc/_core','_misc.funcs.php',1467]], 17],
'from': ['from', '', [['inc/_core/model/db','_sql.class.php',221]], 513],
'is_ajax_content': ['is_ajax_content', 'Check if current request is AJAX Used in order to get only content of the requested page ', [['inc/_core','_misc.funcs.php',6533]], 31],
't_': ['t_', 'Provide translation in the context of this module: ', [['inc/_core/model','_module.class.php',67],['rsc/js','blog_widgets.js',467],['inc/skins/model','_skin.class.php',1131],['inc/plugins','_plugin.class.php',2799],['inc/locales','_locale.funcs.php',29],['inc/locales','_locale.funcs.php',226]], 12118],
'check_thread_recipient': ['check_thread_recipient', 'Check if user is recipient of the current thread ', [['inc/messaging/model','_thread.class.php',495]], 7],
'get_assoc': ['get_assoc', 'Function to get the second column from the cached result indexed by the first column ', [['inc/_core/model/db','_db.class.php',1057]], 60],
'init_params_by_skin': ['init_params_by_skin', 'Init results params from skin template params. It\'s used when Results table is filled from ajax result. ', [['inc/_core/ui','_uiwidget.class.php',1156]], 9],
'check_contact': ['check_contact', 'Check contact for current user with selected user ', [['inc/messaging/model','_messaging.funcs.php',1365]], 6],
'add': ['add', '', [['inc/_ext/pclzip','pclzip.lib.php',455],['rsc/js/tiny_mce/plugins/spellchecker/includes','Engine.php',141],['inc/skins/model','_skincache.class.php',50],['inc/_core/model','_messages.class.php',114],['inc/_ext/swift/classes/Swift/Plugins','LoggerPlugin.php',33],['inc/_ext/swift/classes/Swift/Plugins','Logger.php',20],['inc/files/model','_filetypecache.class.php',38],['inc/_core/model/dataobjects','_dataobjectcache.class.php',339],['inc/_ext/swift/classes/Swift/Plugins/Loggers','EchoLogger.php',33],['inc/_core/model','_log.class.php',109],['inc/_core/model','_log.class.php',577],['inc/users/model','_usercache.class.php',239],['inc/_ext/swift/classes/Swift/Plugins/Loggers','ArrayLogger.php',44],['inc/links/model','_linkcache.class.php',86],['inc/users/model','_groupsettings.class.php',103],['inc/chapters/model','_chaptercache.class.php',98],['inc/files/model','_filelist.class.php',373],['inc/collections/model','_blogcache.class.php',50]], 1695],
'create_contacts_group_users': ['create_contacts_group_users', 'Insert users for contacts group into database ', [['inc/messaging/model','_messaging.funcs.php',882]], 3],
'query': ['query', 'Run Query: GET DATA ROWS *** HEAVY *** ', [['inc/items/model','_itemlist.class.php',249],['inc/items/model','_itemlistlight.class.php',742],['inc/comments/model','_commentlist.class.php',507],['inc/users/model','_userlist.class.php',511],['inc/_core/ui/results','_results.class.php',468],['inc/_core/model/db','_db.class.php',749]], 1144],
'display_head': ['display_head', 'Display list/table head. ', [['inc/_core/ui','_uiwidget.class.php',640]], 7],
'check_create_thread_limit': ['check_create_thread_limit', 'Check if current User already reached his \'create new thread\' limit for today or not. Important: The current User messaging permission is not checked here! ', [['inc/messaging/model','_messaging.funcs.php',1460]], 7],
'col_thread_date': ['col_thread_date', 'Return the given date in the correct date format ', [['inc/messaging/model','_messaging.funcs.php',2134]], 2],
'rename_contacts_group': ['rename_contacts_group', 'Rename contacts group ', [['inc/messaging/model','_messaging.funcs.php',805]], 2],
'list': ['list', '', [['rsc/js/bootstrap','typeahead.bundle.js',156]], 105],
'select': ['select', 'Set SELECT clause ', [['inc/_core/model/db','_sql.class.php',196],['inc/_core/ui/forms','_form.class.php',2189],['inc/_core/model/db','_db.class.php',454]], 475],
'debug_die': ['debug_die', 'Outputs Unexpected Error message. When in debug mode it also prints a backtrace. ', [['inc/_core','_misc.funcs.php',2523]], 225],
'group_by': ['group_by', '', [['inc/_core/model/db','_sql.class.php',290]], 60],
'param_check_not_empty': ['param_check_not_empty', '', [['inc/_core','_param.funcs.php',564]], 53],
'order_by': ['order_by', '', [['inc/_core/model/db','_sql.class.php',321]], 85],
'get_dispctrl_url': ['get_dispctrl_url', 'Get disp urls for Frontoffice part OR ctrl urls for Backoffice ', [['inc/_core','_url.funcs.php',876]], 31],
'get_threads_recipients_sql': ['get_threads_recipients_sql', 'Get threads recipients SQL ', [['inc/messaging/model','_messaging.funcs.php',419]], 1],
'mark_as_read_by_user': ['mark_as_read_by_user', 'Mark a thread as read by the given user. ', [['inc/messaging/model','_messaging.funcs.php',1660]], 2],
'get_contacts_groups_list': ['get_contacts_groups_list', 'Get list with contacts groups of current User ', [['inc/messaging/model','_messaging.funcs.php',1243]], 0],
'remove_contacts_group_user': ['remove_contacts_group_user', 'Remove user from contacts group ', [['inc/messaging/model','_messaging.funcs.php',1000]], 2],
'is_logged_in': ['is_logged_in', 'is_logged_in(-) ', [['inc/users/model','_user.funcs.php',38]], 274],
'col_thread_read_by': ['col_thread_read_by', 'Read? column ', [['inc/messaging/model','_messaging.funcs.php',2152]], 1],
'get_user_colored_login': ['get_user_colored_login', 'Get user\'s login with gender color ', [['inc/users/model','_user.funcs.php',129]], 2],
'mysql2date': ['mysql2date', 'Format a MYSQL date. ', [['inc/_core','_misc.funcs.php',1302]], 45],
'user': ['user', 'Constructor ', [['inc/users/model','_user.class.php',144]], 37],
'threads_results_block': ['threads_results_block', 'Display threads results table ', [['inc/messaging/model','_messaging.funcs.php',1840]], 1],
'locale_timefmt': ['locale_timefmt', 'Returns the current locale\'s default time format ', [['inc/locales','_locale.funcs.php',404]], 17],
'quote': ['quote', 'Quote a msgid/msgstr, preferrable with single quotes. ', [['inc/locales','_pofile.class.php',261],['inc/_core/model/db','_db.class.php',491]], 1085],
'load_class': ['load_class', 'In PHP4, this really loads the class. In PHP5, it\'s smarter than that: It only registers the class & file name so that __autoload() can later load the class IF and ONLY IF the class is actually needed during execution. ', [['inc/_core','_class5.funcs.php',64],['inc/_core','_class4.funcs.php',19]], 435],
'check_perm': ['check_perm', 'Check module permission ', [['inc/_core/model','_module.class.php',234],['inc/users/model','_user.class.php',2234],['inc/messaging/model','_message.class.php',595],['inc/messaging/model','_thread.class.php',482],['inc/links/model','_linkcomment.class.php',49],['inc/links/model','_linkitem.class.php',50],['inc/users/model','_group.class.php',265],['inc/sessions/model','_goal.class.php',94],['inc/links/model','_linkuser.class.php',47]], 1082],
'get_num_messages': ['get_num_messages', 'Get the number of user messages ', [['inc/users/model','_user.class.php',1775]], 6],
'col_thread_delete_action': ['col_thread_delete_action', 'Get action icons to delete thread ', [['inc/messaging/model','_messaging.funcs.php',2197]], 1],
'get_contacts_groups_options': ['get_contacts_groups_options', 'Get tags <option> for contacts groups of current User ', [['inc/messaging/model','_messaging.funcs.php',1211]], 1],
'dbupdate': ['dbupdate', 'Update the DB based on previously recorded changes ', [['inc/items/model','_item.class.php',5287],['inc/_core/model/dataobjects','_dataobject.class.php',386],['inc/users/model','_user.class.php',3249],['inc/skins/model','_skin.class.php',416],['inc/settings/model','_abstractsettings.class.php',575],['inc/items/model','_itemtype.class.php',433],['inc/files/model','_filetype.class.php',242],['inc/collections/model','_blog.class.php',2630],['inc/comments/model','_comment.class.php',3747],['inc/cron/model','_cronjob.class.php',188],['inc/slugs/model','_slug.class.php',265],['inc/users/model','_group.class.php',478],['inc/widgets/model','_widget.class.php',861],['inc/users/model','_groupsettings.class.php',159],['inc/chapters/model','_chapter.class.php',564],['inc/files/model','_file.class.php',1825]], 289],
'get_thread_prevnext_id': ['get_thread_prevnext_id', 'Get ID of previous/next thread ', [['inc/messaging/model','_messaging.funcs.php',1742]], 2],
'display': ['display', 'Display the widget! ', [['inc/widgets/widgets','_coll_tag_cloud.widget.php',170],['inc/_core/model/db','_sql.class.php',68],['inc/widgets/widgets','_coll_logo.widget.php',138],['inc/widgets/widgets','_mobile_skin_switcher.widget.php',105],['inc/widgets/widgets','_online_users.widget.php',95],['inc/widgets/widgets','_user_login.widget.php',195],['inc/widgets/widgets','_coll_item_list.widget.php',274],['inc/_core/model','_messages.class.php',183],['inc/widgets/widgets','_user_links.widget.php',114],['inc/widgets/widgets','_coll_featured_intro.widget.php',171],['plugins','_calendar.plugin.php',619],['inc/widgets/widgets','_coll_search_form.widget.php',135],['inc/widgets/widgets','_coll_longdesc.widget.php',99],['inc/widgets/widgets','_content_hierarchy.widget.php',120],['inc/widgets/widgets','_coll_tagline.widget.php',79],['inc/widgets/widgets','_coll_current_filters.widget.php',113],['inc/widgets/widgets','_coll_category_list.widget.php',198],['inc/widgets/widgets','_org_members.widget.php',147],['inc/widgets/widgets','_coll_comment_list.widget.php',129],['inc/_core/model','_log.class.php',276],['inc/_core/model','_log.class.php',602],['inc/widgets/widgets','_member_count.widget.php',66],['inc/widgets/widgets','_menu_link.widget.php',202],['inc/_core/ui/results','_results.class.php',916],['inc/widgets/widgets','_free_html.widget.php',110],['inc/widgets/widgets','_breadcrumb_path.widget.php',103],['inc/widgets/widgets','_image.widget.php',139],['inc/widgets/widgets','_profile_menu_link.widget.php',128],['inc/widgets/widgets','_coll_media_index.widget.php',199],['inc/widgets/model','_widget.class.php',513],['inc/widgets/widgets','_colls_list_owner.widget.php',121],['inc/widgets/widgets','_user_tools.widget.php',252],['inc/widgets/widgets','_coll_common_links.widget.php',167],['inc/widgets/widgets','_msg_menu_link.widget.php',191],['inc/widgets/widgets','_user_avatars.widget.php',177],['inc/widgets/widgets','_coll_xml_feeds.widget.php',120],['inc/widgets/widgets','_coll_avatar.widget.php',92],['inc/widgets/widgets','_user_register.widget.php',156],['inc/widgets/widgets','_colls_list_public.widget.php',121],['inc/widgets/widgets','_coll_title.widget.php',100]], 129],
'get_users_unread_threads': ['get_users_unread_threads', 'Get all those user threads and their recipients where the corresponding users have unread messages. This function is used for the different email notifications. ', [['inc/messaging/model','_messaging.funcs.php',478]], 3],
'leave_thread': ['leave_thread', 'User leave a thread ', [['inc/messaging/model','_messaging.funcs.php',253]], 4],
'set_param': ['set_param', 'Set the value of a param (by force! :P) ', [['inc/_core','_param.funcs.php',1678],['inc/_core/model/dataobjects','_dataobject.class.php',890]], 127],
'load_messaging_thread_recipients': ['load_messaging_thread_recipients', 'Load all of the recipients of current thread into the UserCache ', [['inc/messaging/model','_messaging.funcs.php',18]], 3],
'get_next_reminder_info': ['get_next_reminder_info', 'Get next \'Unread message reminder\' datetime information for the given user. This is used on the user admin settings form. ', [['inc/messaging/model','_messaging.funcs.php',1572]], 1],
'get_results': ['get_results', 'Return the the query as a result set - see docs for more details ', [['inc/_core/model/db','_db.class.php',1083]], 152],
'rollback': ['rollback', 'Rollback current transaction ', [['inc/_core/model/db','_db.class.php',1625]], 48],
'format_to_output': ['format_to_output', 'Format a string/content for being output ', [['inc/_core','_misc.funcs.php',264]], 318],
'get_avatar_imgtag_default': ['get_avatar_imgtag_default', 'Get avatar <img> tag with default picture ', [['inc/users/model','_user.funcs.php',1731]], 6],
'mysql2localedatetime': ['mysql2localedatetime', '', [['inc/_core','_misc.funcs.php',1278]], 13],
'url_add_param': ['url_add_param', 'Add param(s) at the end of an URL, using either "?" or "&amp;" depending on existing url ', [['inc/_core','_url.funcs.php',525]], 256],
'get_todays_thread_settings': ['get_todays_thread_settings', 'Get current User max new threads settings for today ', [['inc/messaging/model','_messaging.funcs.php',1424]], 2],
'get': ['get', 'Get a member param by its name ', [['inc/items/model','_item.class.php',6187],['inc/_core/model/db','_sql.class.php',50],['inc/_core/model/dataobjects','_dataobject.class.php',834],['inc/plugins/model','_pluginusersettings.class.php',40],['inc/users/model','_user.class.php',1227],['rsc/js/tiny_mce/plugins/spellchecker/includes','Engine.php',145],['inc/settings/model','_abstractsettings.class.php',252],['inc/settings/model','_generalsettings.class.php',379],['inc/users/model','_usersettings.class.php',148],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',95],['inc/links/model','_linkcomment.class.php',150],['inc/links/model','_linkitem.class.php',205],['inc/sessions/model','_session.class.php',428],['inc/collections/model','_blog.class.php',1842],['inc/comments/model','_comment.class.php',386],['inc/cron/model','_cronjob.class.php',89],['inc/plugins/model','_pluginsettings.class.php',40],['inc/links/model','_linkowner.class.php',218],['plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['inc/slugs/model','_slug.class.php',68],['inc/users/model','_groupsettings.class.php',124],['inc/chapters/model','_chapter.class.php',600],['inc/antispam/model','_iprange.class.php',60],['inc/files/model','_file.class.php',555],['inc/links/model','_linkuser.class.php',154],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',165]], 2630],
'get_messaging_sub_entries': ['get_messaging_sub_entries', 'Get messaging menu sub entries ', [['inc/messaging/model','_messaging.funcs.php',342]], 1],
'from_add': ['from_add', 'Extends the FROM clause. ', [['inc/_core/model/db','_sql.class.php',226]], 200],
'action_icon': ['action_icon', 'Generate requested action icon depending on perm ', [['inc/_core/model/dataobjects','_dataobject.class.php',1071],['inc/_core','_misc.funcs.php',3977]], 289],
'get_total_rows': ['get_total_rows', 'Get the number of total rows in the result ', [['inc/_core/ui/results','_results.class.php',876]], 18],
'delete': ['delete', '', [['inc/_ext/pclzip','pclzip.lib.php',1007],['inc/plugins/model','_pluginusersettings.class.php',89],['inc/settings/model','_abstractsettings.class.php',504],['inc/users/model','_usersettings.class.php',209],['inc/sessions/model','_session.class.php',483],['inc/plugins/model','_pluginsettings.class.php',65],['plugins/twitter_plugin/twitteroauth','twitteroauth.php',168],['inc/users/model','_groupsettings.class.php',181]], 99],
'get_message_params_from_session': ['get_message_params_from_session', 'Get message form params from the current Session ', [['inc/messaging/model','_messaging.funcs.php',402]], 4],
'col_msg_read_by': ['col_msg_read_by', 'Get authors list to display who already had read current message ', [['inc/messaging/model','_messaging.funcs.php',2271]], 2],
'col_thread_recipients': ['col_thread_recipients', 'Get thread\'s recipients ', [['inc/messaging/model','_messaging.funcs.php',2044]], 1],
'display_init': ['display_init', 'Get ready for displaying the skin. ', [['skins/photoblog','_skin.class.php',161],['skins/dating_mood','_skin.class.php',120],['skins/bootstrap_gallery_legacy','_skin.class.php',254],['inc/skins/model','_skin.class.php',783],['skins/evocamp','_skin.class.php',114],['skins/bootstrap_main_skin','_skin.class.php',277],['inc/_core/ui','_uiwidget.class.php',360],['skins/pureforums','_skin.class.php',151],['skins/bootstrap_blog_skin','_skin.class.php',200],['skins/photoalbums','_skin.class.php',193],['skins/bootstrap_gallery_skin','_skin.class.php',254],['inc/_core/ui/results','_results.class.php',1018],['skins/forums','_skin.class.php',165],['skins/bootstrap_forums_skin','_skin.class.php',275],['skins/manual','_skin.class.php',153],['skins/touch','_skin.class.php',120],['skins/bootstrap_manual_skin','_skin.class.php',190],['skins/evopress','_skin.class.php',139]], 45],
'is_number': ['is_number', 'Checks if the param is an integer (no float, e.g. 3.14). ', [['inc/_core','_misc.funcs.php',1765]], 9],
'url_crumb': ['url_crumb', 'Create a crumb param to be passed in action urls... ', [['inc/_core','_url.funcs.php',597]], 281],
'get_content': ['get_content', 'Get a content of the uploaded file ', [['htsrv','quick_upload.php',66],['htsrv','quick_upload.php',163],['inc/messaging/model','_message.class.php',843],['inc/comments/model','_comment.class.php',2602]], 8],
'col_msg_format_text': ['col_msg_format_text', 'Get formatted message text ', [['inc/messaging/model','_messaging.funcs.php',2236]], 2],
'get_var': ['get_var', 'Get one variable from the DB - see docs for more detail ', [['inc/_core/model/db','_db.class.php',952]], 166],
'threads_results': ['threads_results', 'Initialize Results object for threads list ', [['inc/messaging/model','_messaging.funcs.php',1962]], 2],
'update_todays_thread_settings': ['update_todays_thread_settings', 'Update current User last new thread timestamp, and today\'s new thread count ', [['inc/messaging/model','_messaging.funcs.php',1388]], 2],
'regenerate_url': ['regenerate_url', 'Regenerate current URL from parameters This may clean it up But it is also useful when generating static pages: you cannot rely on $_REQUEST[] ', [['inc/_core','_param.funcs.php',1748]], 503],
'get_template': ['get_template', 'Get a template by name and depth. ', [['skins_adm/chicago','_adminUI.class.php',163],['skins/bootstrap_gallery_legacy','_skin.class.php',397],['skins_adm/bootstrap','_adminUI.class.php',240],['inc/skins/model','_skin.class.php',1180],['inc/_core/ui/forms','_form.class.php',185],['skins/bootstrap_main_skin','_skin.class.php',416],['skins/pureforums','_skin.class.php',322],['skins/bootstrap_blog_skin','_skin.class.php',233],['inc/plugins','_plugin.class.php',378],['skins/bootstrap_gallery_skin','_skin.class.php',397],['skins_adm','_adminUI_general.class.php',859],['skins/forums','_skin.class.php',346],['skins/bootstrap_forums_skin','_skin.class.php',410],['inc/_core/ui','_menu.class.php',430],['skins/bootstrap_manual_skin','_skin.class.php',254]], 211],
'get_col': ['get_col', 'Function to get 1 column from the cached result set based on X index see docs for usage and info ', [['inc/_core/model/db','_db.class.php',1032]], 117],
'display_list_end': ['display_list_end', 'Display list/table end. ', [['inc/_core/ui','_uiwidget.class.php',622],['inc/_core/ui/results','_resultsel.class.php',125]], 12],
'where_or': ['where_or', 'Extends the WHERE clause with OR ', [['inc/_core/model/db','_sql.class.php',267]], 4],
'commit': ['commit', 'For any bytes that are currently buffered inside the stream, force them off the buffer. ', [['inc/_ext/swift/classes/Swift/ByteStream','AbstractFilterableInputStream.php',97],['inc/_ext/swift/classes/Swift/Signers','DKIMSigner.php',223],['inc/_ext/swift/classes/Swift/ByteStream','ArrayByteStream.php',116],['inc/_ext/swift/classes/Swift/Plugins','BandwidthMonitorPlugin.php',90],['inc/_ext/swift/classes/Swift','InputByteStream.php',41],['inc/_ext/swift/classes/Swift/Signers','DomainKeySigner.php',178],['inc/_ext/swift/classes/Swift/KeyCache','SimpleKeyCacheInputStream.php',71],['inc/_core/model/db','_db.class.php',1589]], 135],
'get_contacts_groups_by_user_id': ['get_contacts_groups_by_user_id', 'Get what contact groups are selected for the user by current User ', [['inc/messaging/model','_messaging.funcs.php',1190]], 1],
'escape': ['escape', '', [['rsc/js/jquery','jquery.ui.b2evo.js',6537],['rsc/js/jquery','jquery.ui.all.js',9814],['inc/_core/model/db','_db.class.php',482]], 103],
'get_contacts_groups_default': ['get_contacts_groups_default', 'Get default groups for user contacts ', [['inc/messaging/model','_messaging.funcs.php',1134]], 4],
'col_msg_actions': ['col_msg_actions', '', [['inc/messaging/model','_messaging.funcs.php',2364]], 1],
'where': ['where', '', [['inc/_core/model/db','_sql.class.php',242]], 288],
'get_icon': ['get_icon', 'Return the img html code of the icon ', [['inc/files/model','_filetype.class.php',153],['inc/files/model','_file.class.php',978],['inc/_core','_misc.funcs.php',4122]], 428],
'create_new_thread': ['create_new_thread', 'Create new messaging thread from request ', [['inc/messaging/model','_messaging.funcs.php',149]], 3],
'create_contacts_user': ['create_contacts_user', 'Insert user to contacts ', [['inc/messaging/model','_messaging.funcs.php',732]], 2],
'get_row': ['get_row', 'Get one row from the DB. ', [['inc/_core/model/db','_db.class.php',987]], 60],
'get_messaging_url': ['get_messaging_url', 'Get messaging menu urls ', [['inc/messaging/model','_messaging.funcs.php',292]], 0],
'get_setting': ['get_setting', 'Get a setting. ', [['inc/items/model','_item.class.php',6656],['inc/skins/model','_skin.class.php',661],['inc/collections/model','_blog.class.php',2109]], 728],
'get_messages_link_to': ['get_messages_link_to', 'Get messaging urls for the messaging notification emails ', [['inc/messaging/model','_messaging.funcs.php',308]], 2],
'set': ['set', 'Set param value ', [['inc/items/model','_item.class.php',4909],['inc/tools/model','_emailaddress.class.php',76],['inc/_core/model/dataobjects','_dataobject.class.php',874],['inc/plugins/model','_pluginusersettings.class.php',64],['inc/regional/model','_country.class.php',94],['inc/users/model','_user.class.php',2059],['inc/settings/model','_abstractsettings.class.php',427],['inc/messaging/model','_thread.class.php',211],['inc/regional/model','_subregion.class.php',107],['inc/users/model','_usersettings.class.php',184],['plugins','_calendar.plugin.php',613],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',81],['inc/files/model','_filetype.class.php',128],['inc/sessions/model','_session.class.php',451],['inc/collections/model','_blog.class.php',1104],['inc/comments/model','_comment.class.php',400],['inc/cron/model','_cronjob.class.php',64],['inc/plugins/model','_pluginsettings.class.php',52],['inc/users/model','_userfield.class.php',257],['inc/regional/model','_city.class.php',98],['inc/slugs/model','_slug.class.php',80],['inc/users/model','_group.class.php',212],['inc/regional/model','_currency.class.php',84],['inc/widgets/model','_widget.class.php',369],['inc/regional/model','_region.class.php',90],['inc/users/model','_groupsettings.class.php',140],['inc/chapters/model','_chapter.class.php',809],['inc/antispam/model','_iprange.class.php',72],['inc/items/model','_itemtag.class.php',61],['inc/sessions/model','_goal.class.php',201],['inc/items/model','_itemlight.class.php',1328],['inc/users/model','_userfieldgroup.class.php',83],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',148]], 1238],
'where_and': ['where_and', 'Extends the WHERE clause with AND ', [['inc/_core/model/db','_sql.class.php',247]], 369],
'get_user_avatar_styled': ['get_user_avatar_styled', 'Get styled avatar ', [['inc/users/model','_user.funcs.php',1685]], 1],
'db_delete_where': ['db_delete_where', 'Delete the given class objects from the database which corresponds to the given condition or to the given ids array This function must be overriden on those classes where the db delete requires some updates on other table content or some files/folders delete. Note: the delete cascade arrays are handled! Delete cascades are handled recursively only if the cascade arrays from the reffering class contains the class and class_path params ( e.g. see User class )! ', [['inc/_core/model/dataobjects','_dataobject.class.php',175],['inc/users/model','_user.class.php',3308],['inc/messaging/model','_message.class.php',503],['inc/sessions/model','_session.class.php',281],['inc/comments/model','_comment.class.php',290]], 11],
'get_threads_results': ['get_threads_results', 'Get threads SQL ', [['inc/messaging/model','_messaging.funcs.php',591]], 3],
'save_message_params_to_session': ['save_message_params_to_session', 'Save message form params into the current Session ', [['inc/messaging/model','_messaging.funcs.php',390]], 3],
'update_contacts_groups_user': ['update_contacts_groups_user', 'Update contact groups for user in database ', [['inc/messaging/model','_messaging.funcs.php',1045]], 1],
'rawurlencode': ['rawurlencode', '', [], 137],
'floor': ['floor', '', [], 116],
'key': ['key', '', [], 172],
'explode': ['explode', '', [], 263],
'count': ['count', '', [], 928],
'strtotime': ['strtotime', '', [], 46],
'defined': ['defined', '', [], 962],
'is_null': ['is_null', '', [], 299],
'array_unique': ['array_unique', '', [], 38],
'str_replace': ['str_replace', '', [], 531],
'asort': ['asort', '', [], 5],
'array_diff': ['array_diff', '', [], 31],
'date': ['date', '', [], 446],
'implode': ['implode', '', [], 571],
'is_array': ['is_array', '', [], 311],
'min': ['min', '', [], 131],
'trim': ['trim', '', [], 398],
'intval': ['intval', '', [], 221],
'reset': ['reset', '', [], 63],
'array_merge': ['array_merge', '', [], 702],
'array_keys': ['array_keys', '', [], 94],
'in_array': ['in_array', '', [], 417]};
CLASS_DATA={
'table': ['table', 'Class Table ', [['inc/_core/ui','_uiwidget.class.php',290]], 11],
'group': ['group', 'User Group ', [['inc/users/model','_group.class.php',19]], 73],
'results': ['results', 'Results class ', [['inc/_core/ui/results','_results.class.php',25]], 65],
'message': ['message', 'Message Class ', [['inc/messaging/model','_message.class.php',19]], 42],
'user': ['user', 'User Class ', [['inc/users/model','_user.class.php',24]], 175],
'sql': ['sql', 'SQL class: help constructing queries ', [['inc/_core/model/db','_sql.class.php',17]], 334],
'thread': ['thread', 'Thread Class ', [['inc/messaging/model','_thread.class.php',19]], 35]};
CONST_DATA={
'OBJECT': ['OBJECT', '', [['inc/_core/model/db','_db.class.php',49]], 54],
'EVO_MAIN_INIT': ['EVO_MAIN_INIT', '', [['install','index.php',26],['inc','_main.inc.php',36],['install','debug.php',22]], 912]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Nov 21 22:13:19 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
