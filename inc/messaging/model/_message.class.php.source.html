<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /inc/messaging/model/_message.class.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Nov 21 22:13:19 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='inc/messaging/model';
filename='_message.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/inc/messaging/model/</a> -> <a href="_message.class.php.html">_message.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="_message.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="_message.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This file is part of b2evolution - {@link http://b2evolution.net/}</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> * See also {@link https://github.com/b2evolution/b2evolution}.</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> *</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * @license GNU GPL v2 - {@link http://b2evolution.net/about/gnu-gpl-license}</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> *</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * @copyright (c)2009-2015 by Francois Planque - {@link http://fplanque.com/}</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * Parts of this file are copyright (c)2009 by The Evo Factory - {@link http://www.evofactory.com/}.</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> *</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * Released under GNU GPL License - {@link http://b2evolution.net/about/gnu-gpl-license}</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> *</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * @package messaging</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> */</span>
<a name="l15"><span class="linenum">  15</span></a>  if( !<a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('EVO_MAIN_INIT')" href="../../../_constants/EVO_MAIN_INIT.html" onMouseOver="constPopup(event,'EVO_MAIN_INIT')">EVO_MAIN_INIT</a>') ) die( 'Please, do not access this page directly.' );
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( '_core/model/dataobjects/_dataobject.class.php', 'DataObject' );
<a name="l18"><span class="linenum">  18</span></a>  
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment">/**</span>
<a name="l20"><span class="linenum">  20</span></a>  <span class="comment"> * Message Class</span>
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment"> *</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> */</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('Message')" href="../../../_classes/message.html" onMouseOver="classPopup(event,'message')">Message</a> <span class="keyword">extends</span> <a class="class" onClick="logClass('DataObject')" href="../../../_classes/dataobject.html" onMouseOver="classPopup(event,'dataobject')">DataObject</a>
<a name="l24"><span class="linenum">  24</span></a>  {
<a name="l25"><span class="linenum">  25</span></a>      <span class="comment">/**</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment">     * Available message statuses constants</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment">     *</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment">     * @internal Tblue&gt; Class constants are PHP5-only!</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment">     */</span>
<a name="l30"><span class="linenum">  30</span></a>      var <a class="var it4709" onMouseOver="hilite(4709)" onMouseOut="lolite()" onClick="logVariable('AUTHOR')" href="../../../_variables/AUTHOR.html">$AUTHOR</a> = 0;
<a name="l31"><span class="linenum">  31</span></a>      var <a class="var it4710" onMouseOver="hilite(4710)" onMouseOut="lolite()" onClick="logVariable('READ')" href="../../../_variables/READ.html">$READ</a> = 1;
<a name="l32"><span class="linenum">  32</span></a>      var <a class="var it4711" onMouseOver="hilite(4711)" onMouseOut="lolite()" onClick="logVariable('UNREAD')" href="../../../_variables/UNREAD.html">$UNREAD</a> = 2;
<a name="l33"><span class="linenum">  33</span></a>  
<a name="l34"><span class="linenum">  34</span></a>      var <a class="var it543" onMouseOver="hilite(543)" onMouseOut="lolite()" onClick="logVariable('thread_ID')" href="../../../_variables/thread_ID.html">$thread_ID</a>;
<a name="l35"><span class="linenum">  35</span></a>      var <a class="var it1138" onMouseOver="hilite(1138)" onMouseOut="lolite()" onClick="logVariable('author_user_ID')" href="../../../_variables/author_user_ID.html">$author_user_ID</a>;
<a name="l36"><span class="linenum">  36</span></a>      var <a class="var it552" onMouseOver="hilite(552)" onMouseOut="lolite()" onClick="logVariable('author_name')" href="../../../_variables/author_name.html">$author_name</a> = '';
<a name="l37"><span class="linenum">  37</span></a>      var <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> = '';
<a name="l38"><span class="linenum">  38</span></a>  
<a name="l39"><span class="linenum">  39</span></a>      <span class="comment">/**</span>
<a name="l40"><span class="linenum">  40</span></a>  <span class="comment">     * The content of the message</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     * WARNING: It may contains MALICIOUS HTML and javascript snippets. They must ALWAYS be ESCAPED prior to display!</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">     *</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">     * @var string</span>
<a name="l44"><span class="linenum">  44</span></a>  <span class="comment">     */</span>
<a name="l45"><span class="linenum">  45</span></a>      var <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = '';
<a name="l46"><span class="linenum">  46</span></a>      var <a class="var it1087" onMouseOver="hilite(1087)" onMouseOut="lolite()" onClick="logVariable('original_text')" href="../../../_variables/original_text.html">$original_text</a> = '';
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>      <span class="comment">/**</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">     * @var string</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">     */</span>
<a name="l51"><span class="linenum">  51</span></a>      var <a class="var it333" onMouseOver="hilite(333)" onMouseOut="lolite()" onClick="logVariable('renderers')" href="../../../_variables/renderers.html">$renderers</a>;
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>      <span class="comment">/**</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     * Thread lazy filled</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     *</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">     * @var instance of Thread class</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     */</span>
<a name="l58"><span class="linenum">  58</span></a>      var <a class="var it1076" onMouseOver="hilite(1076)" onMouseOut="lolite()" onClick="logVariable('Thread')" href="../../../_variables/Thread.html">$Thread</a>;
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>      <span class="comment">/**</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">     * Constructor</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     *</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">     * @param db_row database row</span>
<a name="l65"><span class="linenum">  65</span></a>  <span class="comment">     */</span>
<a name="l66"><span class="linenum">  66</span></a>  	function <a class="function" onClick="logFunction('Message')" href="../../../_functions/message.html" onMouseOver="funcPopup(event,'message')">Message</a>( <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a> = NULL )
<a name="l67"><span class="linenum">  67</span></a>      {
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">        // Call parent constructor:</span>
<a name="l69"><span class="linenum">  69</span></a>          parent::<a class="function" onClick="logFunction('DataObject')" href="../../../_functions/dataobject.html" onMouseOver="funcPopup(event,'dataobject')">DataObject</a>( 'T_messaging__message', 'msg_', 'msg_ID', 'datetime', '', 'author_user_ID' );
<a name="l70"><span class="linenum">  70</span></a>  
<a name="l71"><span class="linenum">  71</span></a>          if( <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a> == NULL )
<a name="l72"><span class="linenum">  72</span></a>          {
<a name="l73"><span class="linenum">  73</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_renderers')" href="../../../_functions/set_renderers.html" onMouseOver="funcPopup(event,'set_renderers')">set_renderers</a>( array( 'default' ) );
<a name="l74"><span class="linenum">  74</span></a>          }
<a name="l75"><span class="linenum">  75</span></a>          else
<a name="l76"><span class="linenum">  76</span></a>          {
<a name="l77"><span class="linenum">  77</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>                = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('msg_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/msg_ID.html">msg_ID</a>;
<a name="l78"><span class="linenum">  78</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a>         = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('msg_thread_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/msg_thread_ID.html">msg_thread_ID</a>;
<a name="l79"><span class="linenum">  79</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a>    = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('msg_author_user_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/msg_author_user_ID.html">msg_author_user_ID</a>;
<a name="l80"><span class="linenum">  80</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('datetime')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/datetime.html">datetime</a>          = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('msg_datetime')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/msg_datetime.html">msg_datetime</a>;
<a name="l81"><span class="linenum">  81</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('text')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/text.html">text</a>              = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('msg_text')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/msg_text.html">msg_text</a>;
<a name="l82"><span class="linenum">  82</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('renderers')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/renderers.html">renderers</a>         = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('msg_renderers')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/msg_renderers.html">msg_renderers</a>;
<a name="l83"><span class="linenum">  83</span></a>          }
<a name="l84"><span class="linenum">  84</span></a>      }
<a name="l85"><span class="linenum">  85</span></a>  
<a name="l86"><span class="linenum">  86</span></a>  
<a name="l87"><span class="linenum">  87</span></a>      <span class="comment">/**</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">     * Get this class db table config params</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     *</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">     * @return array</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">     */</span>
<a name="l92"><span class="linenum">  92</span></a>  	static function <a class="function" onClick="logFunction('get_class_db_config')" href="../../../_functions/get_class_db_config.html" onMouseOver="funcPopup(event,'get_class_db_config')">get_class_db_config</a>()
<a name="l93"><span class="linenum">  93</span></a>      {
<a name="l94"><span class="linenum">  94</span></a>          static <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('message_db_config')" href="../../../_variables/message_db_config.html">$message_db_config</a>;
<a name="l95"><span class="linenum">  95</span></a>  
<a name="l96"><span class="linenum">  96</span></a>          if( !isset( <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('message_db_config')" href="../../../_variables/message_db_config.html">$message_db_config</a> ) )
<a name="l97"><span class="linenum">  97</span></a>          {
<a name="l98"><span class="linenum">  98</span></a>              <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('message_db_config')" href="../../../_variables/message_db_config.html">$message_db_config</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( parent::<a class="function" onClick="logFunction('get_class_db_config')" href="../../../_functions/get_class_db_config.html" onMouseOver="funcPopup(event,'get_class_db_config')">get_class_db_config</a>(),
<a name="l99"><span class="linenum">  99</span></a>                  array(
<a name="l100"><span class="linenum"> 100</span></a>                      'dbtablename'        =&gt; 'T_messaging__message',
<a name="l101"><span class="linenum"> 101</span></a>                      'dbprefix'           =&gt; 'msg_',
<a name="l102"><span class="linenum"> 102</span></a>                      'dbIDname'           =&gt; 'msg_ID',
<a name="l103"><span class="linenum"> 103</span></a>                  )
<a name="l104"><span class="linenum"> 104</span></a>              );
<a name="l105"><span class="linenum"> 105</span></a>          }
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>          return <a class="var it4717" onMouseOver="hilite(4717)" onMouseOut="lolite()" onClick="logVariable('message_db_config')" href="../../../_variables/message_db_config.html">$message_db_config</a>;
<a name="l108"><span class="linenum"> 108</span></a>      }
<a name="l109"><span class="linenum"> 109</span></a>  
<a name="l110"><span class="linenum"> 110</span></a>  
<a name="l111"><span class="linenum"> 111</span></a>      <span class="comment">/**</span>
<a name="l112"><span class="linenum"> 112</span></a>  <span class="comment">     * Get delete cascade settings</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">     *</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment">     * @return array</span>
<a name="l115"><span class="linenum"> 115</span></a>  <span class="comment">     */</span>
<a name="l116"><span class="linenum"> 116</span></a>  	static function <a class="function" onClick="logFunction('get_delete_cascades')" href="../../../_functions/get_delete_cascades.html" onMouseOver="funcPopup(event,'get_delete_cascades')">get_delete_cascades</a>()
<a name="l117"><span class="linenum"> 117</span></a>      {
<a name="l118"><span class="linenum"> 118</span></a>          return array(
<a name="l119"><span class="linenum"> 119</span></a>                  array( 'table'=&gt;'T_messaging__prerendering', 'fk'=&gt;'mspr_msg_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d prerendered content') )
<a name="l120"><span class="linenum"> 120</span></a>              );
<a name="l121"><span class="linenum"> 121</span></a>      }
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>      <span class="comment">/**</span>
<a name="l125"><span class="linenum"> 125</span></a>  <span class="comment">     * Load data from Request form fields.</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">     *</span>
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">     * @return boolean true if loaded data seems valid.</span>
<a name="l128"><span class="linenum"> 128</span></a>  <span class="comment">     */</span>
<a name="l129"><span class="linenum"> 129</span></a>  	function <a class="function" onClick="logFunction('load_from_Request')" href="../../../_functions/load_from_request.html" onMouseOver="funcPopup(event,'load_from_request')">load_from_Request</a>()
<a name="l130"><span class="linenum"> 130</span></a>      {
<a name="l131"><span class="linenum"> 131</span></a>          global <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>, <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l132"><span class="linenum"> 132</span></a>  
<a name="l133"><span class="linenum"> 133</span></a>          <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('new_thread')" href="../../../_variables/new_thread.html">$new_thread</a> = empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> );
<a name="l134"><span class="linenum"> 134</span></a>  
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment">        // Renderers:</span>
<a name="l136"><span class="linenum"> 136</span></a>          if( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'renderers_displayed', 'integer', 0 ) )
<a name="l137"><span class="linenum"> 137</span></a>          { // use &quot;renderers&quot; value only if it has been displayed (may be empty)
<a name="l138"><span class="linenum"> 138</span></a>              <a class="var it333" onMouseOver="hilite(333)" onMouseOut="lolite()" onClick="logVariable('renderers')" href="../../../_variables/renderers.html">$renderers</a> = <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('validate_renderer_list')" href="../../../_functions/validate_renderer_list.html" onMouseOver="funcPopup(event,'validate_renderer_list')">validate_renderer_list</a>( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'renderers', 'array:string', array() ), array( 'Message' =&gt; &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> ) );
<a name="l139"><span class="linenum"> 139</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_renderers')" href="../../../_functions/set_renderers.html" onMouseOver="funcPopup(event,'set_renderers')">set_renderers</a>( <a class="var it333" onMouseOver="hilite(333)" onMouseOut="lolite()" onClick="logVariable('renderers')" href="../../../_variables/renderers.html">$renderers</a> );
<a name="l140"><span class="linenum"> 140</span></a>          }
<a name="l141"><span class="linenum"> 141</span></a>  
<a name="l142"><span class="linenum"> 142</span></a>  <span class="comment">        // Text</span>
<a name="l143"><span class="linenum"> 143</span></a>          if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'allow_html_message' ) )
<a name="l144"><span class="linenum"> 144</span></a>          { // HTML is allowed for messages
<a name="l145"><span class="linenum"> 145</span></a>              <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('text_format')" href="../../../_variables/text_format.html">$text_format</a> = 'html';
<a name="l146"><span class="linenum"> 146</span></a>          }
<a name="l147"><span class="linenum"> 147</span></a>          else
<a name="l148"><span class="linenum"> 148</span></a>          { // HTML is disallowed for messages
<a name="l149"><span class="linenum"> 149</span></a>              <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('text_format')" href="../../../_variables/text_format.html">$text_format</a> = 'htmlspecialchars';
<a name="l150"><span class="linenum"> 150</span></a>          }
<a name="l151"><span class="linenum"> 151</span></a>          <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'msg_text', <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('text_format')" href="../../../_variables/text_format.html">$text_format</a> );
<a name="l152"><span class="linenum"> 152</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('original_text')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/original_text.html">original_text</a> = <a class="phpfunction" onClick="logFunction('html_entity_decode')" href="../../../_functions/html_entity_decode.html" onMouseOver="phpfuncPopup(event,'html_entity_decode')">html_entity_decode</a>( <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a> );
<a name="l153"><span class="linenum"> 153</span></a>  
<a name="l154"><span class="linenum"> 154</span></a>  <span class="comment">        // This must get triggered before any internal validation and must pass all relevant params.</span>
<a name="l155"><span class="linenum"> 155</span></a>          <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('trigger_event')" href="../../../_functions/trigger_event.html" onMouseOver="funcPopup(event,'trigger_event')">trigger_event</a>( 'MessageThreadFormSent', array(
<a name="l156"><span class="linenum"> 156</span></a>                  'content' =&gt; &amp; <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a>,
<a name="l157"><span class="linenum"> 157</span></a>                  'dont_remove_pre' =&gt; true,
<a name="l158"><span class="linenum"> 158</span></a>                  'renderers' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_renderers_validated')" href="../../../_functions/get_renderers_validated.html" onMouseOver="funcPopup(event,'get_renderers_validated')">get_renderers_validated</a>(),
<a name="l159"><span class="linenum"> 159</span></a>              ) );
<a name="l160"><span class="linenum"> 160</span></a>  
<a name="l161"><span class="linenum"> 161</span></a>          if( ! <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('new_thread')" href="../../../_variables/new_thread.html">$new_thread</a> )
<a name="l162"><span class="linenum"> 162</span></a>          {
<a name="l163"><span class="linenum"> 163</span></a>              <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( 'msg_text' );
<a name="l164"><span class="linenum"> 164</span></a>          }
<a name="l165"><span class="linenum"> 165</span></a>          if( <a class="var it323" onMouseOver="hilite(323)" onMouseOut="lolite()" onClick="logVariable('text_format')" href="../../../_variables/text_format.html">$text_format</a> == 'html' )
<a name="l166"><span class="linenum"> 166</span></a>          { // message text may contain html, check the html sanity
<a name="l167"><span class="linenum"> 167</span></a>              <a class="function" onClick="logFunction('param_check_html')" href="../../../_functions/param_check_html.html" onMouseOver="funcPopup(event,'param_check_html')">param_check_html</a>( 'msg_text', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Invalid message content.') );
<a name="l168"><span class="linenum"> 168</span></a>          }
<a name="l169"><span class="linenum"> 169</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'text', <a class="function" onClick="logFunction('get_param')" href="../../../_functions/get_param.html" onMouseOver="funcPopup(event,'get_param')">get_param</a>( 'msg_text' ) );
<a name="l170"><span class="linenum"> 170</span></a>  
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">        // Thread</span>
<a name="l172"><span class="linenum"> 172</span></a>          if( <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('new_thread')" href="../../../_variables/new_thread.html">$new_thread</a> )
<a name="l173"><span class="linenum"> 173</span></a>          {
<a name="l174"><span class="linenum"> 174</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;<a class="function" onClick="logFunction('load_from_Request')" href="../../../_functions/load_from_request.html" onMouseOver="funcPopup(event,'load_from_request')">load_from_Request</a>();
<a name="l175"><span class="linenum"> 175</span></a>          }
<a name="l176"><span class="linenum"> 176</span></a>          else
<a name="l177"><span class="linenum"> 177</span></a>          { // this is a reply to an existing conversation, check if current User is allowed to reply
<a name="l178"><span class="linenum"> 178</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Thread();
<a name="l179"><span class="linenum"> 179</span></a>              if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;<a class="function" onClick="logFunction('check_allow_reply')" href="../../../_functions/check_allow_reply.html" onMouseOver="funcPopup(event,'check_allow_reply')">check_allow_reply</a>() )
<a name="l180"><span class="linenum"> 180</span></a>              { // If reply is allowed we should check if this message is not a duplicate
<a name="l181"><span class="linenum"> 181</span></a>                  global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l182"><span class="linenum"> 182</span></a>  
<a name="l183"><span class="linenum"> 183</span></a>  <span class="comment">                // Get last message of current user in this thread</span>
<a name="l184"><span class="linenum"> 184</span></a>                  <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l185"><span class="linenum"> 185</span></a>                  <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'msg_text' );
<a name="l186"><span class="linenum"> 186</span></a>                  <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__message' );
<a name="l187"><span class="linenum"> 187</span></a>                  <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'msg_thread_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID );
<a name="l188"><span class="linenum"> 188</span></a>                  <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'msg_author_user_ID = '.<a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l189"><span class="linenum"> 189</span></a>                  <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'msg_ID DESC' );
<a name="l190"><span class="linenum"> 190</span></a>                  <a class="var it4719" onMouseOver="hilite(4719)" onMouseOut="lolite()" onClick="logVariable('last_message')" href="../../../_variables/last_message.html">$last_message</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l191"><span class="linenum"> 191</span></a>  
<a name="l192"><span class="linenum"> 192</span></a>                  if( <a class="var it4719" onMouseOver="hilite(4719)" onMouseOut="lolite()" onClick="logVariable('last_message')" href="../../../_variables/last_message.html">$last_message</a> == <a class="var it545" onMouseOver="hilite(545)" onMouseOut="lolite()" onClick="logVariable('msg_text')" href="../../../_variables/msg_text.html">$msg_text</a> )
<a name="l193"><span class="linenum"> 193</span></a>                  {
<a name="l194"><span class="linenum"> 194</span></a>                      <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'msg_text', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('It seems you tried to send the same message twice. We only kept one copy.') );
<a name="l195"><span class="linenum"> 195</span></a>                  }
<a name="l196"><span class="linenum"> 196</span></a>              }
<a name="l197"><span class="linenum"> 197</span></a>          }
<a name="l198"><span class="linenum"> 198</span></a>  
<a name="l199"><span class="linenum"> 199</span></a>          return ! <a class="function" onClick="logFunction('param_errors_detected')" href="../../../_functions/param_errors_detected.html" onMouseOver="funcPopup(event,'param_errors_detected')">param_errors_detected</a>();
<a name="l200"><span class="linenum"> 200</span></a>      }
<a name="l201"><span class="linenum"> 201</span></a>  
<a name="l202"><span class="linenum"> 202</span></a>  
<a name="l203"><span class="linenum"> 203</span></a>      <span class="comment">/**</span>
<a name="l204"><span class="linenum"> 204</span></a>  <span class="comment">     * Get Thread object</span>
<a name="l205"><span class="linenum"> 205</span></a>  <span class="comment">     */</span>
<a name="l206"><span class="linenum"> 206</span></a>      function &amp; get_Thread()
<a name="l207"><span class="linenum"> 207</span></a>      {
<a name="l208"><span class="linenum"> 208</span></a>          if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>) &amp;&amp; !empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a>) )
<a name="l209"><span class="linenum"> 209</span></a>          {
<a name="l210"><span class="linenum"> 210</span></a>              <a class="var it1072" onMouseOver="hilite(1072)" onMouseOut="lolite()" onClick="logVariable('ThreadCache')" href="../../../_variables/ThreadCache.html">$ThreadCache</a> = &amp; get_ThreadCache();
<a name="l211"><span class="linenum"> 211</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a> = <a class="var it1072" onMouseOver="hilite(1072)" onMouseOut="lolite()" onClick="logVariable('ThreadCache')" href="../../../_variables/ThreadCache.html">$ThreadCache</a>-&gt;get_by_ID( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> );
<a name="l212"><span class="linenum"> 212</span></a>          }
<a name="l213"><span class="linenum"> 213</span></a>  
<a name="l214"><span class="linenum"> 214</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>;
<a name="l215"><span class="linenum"> 215</span></a>      }
<a name="l216"><span class="linenum"> 216</span></a>  
<a name="l217"><span class="linenum"> 217</span></a>  
<a name="l218"><span class="linenum"> 218</span></a>      <span class="comment">/**</span>
<a name="l219"><span class="linenum"> 219</span></a>  <span class="comment">     * Insert discussion (one thread for all recipients)</span>
<a name="l220"><span class="linenum"> 220</span></a>  <span class="comment">     *</span>
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment">     * @param User who sent the message, it must be set only if it is not the current User</span>
<a name="l222"><span class="linenum"> 222</span></a>  <span class="comment">     * @return true if success, false otherwise</span>
<a name="l223"><span class="linenum"> 223</span></a>  <span class="comment">     */</span>
<a name="l224"><span class="linenum"> 224</span></a>  	function <a class="function" onClick="logFunction('dbinsert_discussion')" href="../../../_functions/dbinsert_discussion.html" onMouseOver="funcPopup(event,'dbinsert_discussion')">dbinsert_discussion</a>( <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a> = NULL )
<a name="l225"><span class="linenum"> 225</span></a>      {
<a name="l226"><span class="linenum"> 226</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l227"><span class="linenum"> 227</span></a>  
<a name="l228"><span class="linenum"> 228</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != 0 ) die( 'Existing object cannot be inserted!' );
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l231"><span class="linenum"> 231</span></a>  
<a name="l232"><span class="linenum"> 232</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Thread();
<a name="l233"><span class="linenum"> 233</span></a>  
<a name="l234"><span class="linenum"> 234</span></a>          if ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;<a class="function" onClick="logFunction('dbinsert')" href="../../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>() )
<a name="l235"><span class="linenum"> 235</span></a>          {
<a name="l236"><span class="linenum"> 236</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( 'thread_ID', 'integer', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID);
<a name="l237"><span class="linenum"> 237</span></a>  
<a name="l238"><span class="linenum"> 238</span></a>              if( parent::<a class="function" onClick="logFunction('dbinsert')" href="../../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>() )
<a name="l239"><span class="linenum"> 239</span></a>              {
<a name="l240"><span class="linenum"> 240</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbinsert_threadstatus')" href="../../../_functions/dbinsert_threadstatus.html" onMouseOver="funcPopup(event,'dbinsert_threadstatus')">dbinsert_threadstatus</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;recipients_list ) )
<a name="l241"><span class="linenum"> 241</span></a>                  {
<a name="l242"><span class="linenum"> 242</span></a>                      if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbinsert_contacts')" href="../../../_functions/dbinsert_contacts.html" onMouseOver="funcPopup(event,'dbinsert_contacts')">dbinsert_contacts</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;recipients_list ) )
<a name="l243"><span class="linenum"> 243</span></a>                      {
<a name="l244"><span class="linenum"> 244</span></a>                          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate_last_contact_datetime')" href="../../../_functions/dbupdate_last_contact_datetime.html" onMouseOver="funcPopup(event,'dbupdate_last_contact_datetime')">dbupdate_last_contact_datetime</a>() )
<a name="l245"><span class="linenum"> 245</span></a>                          {
<a name="l246"><span class="linenum"> 246</span></a>                              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l247"><span class="linenum"> 247</span></a>  
<a name="l248"><span class="linenum"> 248</span></a>                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_email_notifications')" href="../../../_functions/send_email_notifications.html" onMouseOver="funcPopup(event,'send_email_notifications')">send_email_notifications</a>( true, <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a> );
<a name="l249"><span class="linenum"> 249</span></a>                              return true;
<a name="l250"><span class="linenum"> 250</span></a>                          }
<a name="l251"><span class="linenum"> 251</span></a>                      }
<a name="l252"><span class="linenum"> 252</span></a>                  }
<a name="l253"><span class="linenum"> 253</span></a>              }
<a name="l254"><span class="linenum"> 254</span></a>          }
<a name="l255"><span class="linenum"> 255</span></a>  
<a name="l256"><span class="linenum"> 256</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l257"><span class="linenum"> 257</span></a>          return false;
<a name="l258"><span class="linenum"> 258</span></a>      }
<a name="l259"><span class="linenum"> 259</span></a>  
<a name="l260"><span class="linenum"> 260</span></a>  
<a name="l261"><span class="linenum"> 261</span></a>      <span class="comment">/**</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">     * Insert new thread for each recipient</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">     *</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">     * @param User who sent the message, it must be set only if it is not the current User</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment">     * @return true if success, instead false</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">     */</span>
<a name="l267"><span class="linenum"> 267</span></a>  	function <a class="function" onClick="logFunction('dbinsert_individual')" href="../../../_functions/dbinsert_individual.html" onMouseOver="funcPopup(event,'dbinsert_individual')">dbinsert_individual</a>( <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a> = NULL )
<a name="l268"><span class="linenum"> 268</span></a>      {
<a name="l269"><span class="linenum"> 269</span></a>          foreach( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;recipients_list as <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a> )
<a name="l270"><span class="linenum"> 270</span></a>          {
<a name="l271"><span class="linenum"> 271</span></a>              <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('clone_message')" href="../../../_functions/clone_message.html" onMouseOver="funcPopup(event,'clone_message')">clone_message</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> );
<a name="l272"><span class="linenum"> 272</span></a>  
<a name="l273"><span class="linenum"> 273</span></a>              <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('Thread')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;recipients_list = array( <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a> );
<a name="l274"><span class="linenum"> 274</span></a>  
<a name="l275"><span class="linenum"> 275</span></a>              if ( !<a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a class="function" onClick="logFunction('dbinsert_discussion')" href="../../../_functions/dbinsert_discussion.html" onMouseOver="funcPopup(event,'dbinsert_discussion')">dbinsert_discussion</a>( <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a> ) )
<a name="l276"><span class="linenum"> 276</span></a>              {
<a name="l277"><span class="linenum"> 277</span></a>                  return false;
<a name="l278"><span class="linenum"> 278</span></a>              }
<a name="l279"><span class="linenum"> 279</span></a>          }
<a name="l280"><span class="linenum"> 280</span></a>  
<a name="l281"><span class="linenum"> 281</span></a>          return true;
<a name="l282"><span class="linenum"> 282</span></a>      }
<a name="l283"><span class="linenum"> 283</span></a>  
<a name="l284"><span class="linenum"> 284</span></a>  
<a name="l285"><span class="linenum"> 285</span></a>      <span class="comment">/**</span>
<a name="l286"><span class="linenum"> 286</span></a>  <span class="comment">     * Insert message in existing thread</span>
<a name="l287"><span class="linenum"> 287</span></a>  <span class="comment">     *</span>
<a name="l288"><span class="linenum"> 288</span></a>  <span class="comment">     * @return true if success, instead false</span>
<a name="l289"><span class="linenum"> 289</span></a>  <span class="comment">     */</span>
<a name="l290"><span class="linenum"> 290</span></a>  	function <a class="function" onClick="logFunction('dbinsert_message')" href="../../../_functions/dbinsert_message.html" onMouseOver="funcPopup(event,'dbinsert_message')">dbinsert_message</a>()
<a name="l291"><span class="linenum"> 291</span></a>      {
<a name="l292"><span class="linenum"> 292</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l293"><span class="linenum"> 293</span></a>  
<a name="l294"><span class="linenum"> 294</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != 0 ) die( 'Existing object cannot be inserted!' );
<a name="l295"><span class="linenum"> 295</span></a>  
<a name="l296"><span class="linenum"> 296</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l297"><span class="linenum"> 297</span></a>  
<a name="l298"><span class="linenum"> 298</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Thread();
<a name="l299"><span class="linenum"> 299</span></a>  
<a name="l300"><span class="linenum"> 300</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;<a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( 'datemodified', 'string', <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> ) );
<a name="l301"><span class="linenum"> 301</span></a>  
<a name="l302"><span class="linenum"> 302</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>() )
<a name="l303"><span class="linenum"> 303</span></a>          {
<a name="l304"><span class="linenum"> 304</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( 'thread_ID', 'integer', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID);
<a name="l305"><span class="linenum"> 305</span></a>  
<a name="l306"><span class="linenum"> 306</span></a>              if( parent::<a class="function" onClick="logFunction('dbinsert')" href="../../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>() )
<a name="l307"><span class="linenum"> 307</span></a>              {
<a name="l308"><span class="linenum"> 308</span></a>                  <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'UPDATE T_messaging__threadstatus
<a name="l309"><span class="linenum"> 309</span></a>                          SET tsta_first_unread_msg_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l310"><span class="linenum"> 310</span></a>                          WHERE tsta_thread_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID.'
<a name="l311"><span class="linenum"> 311</span></a>                              AND tsta_user_ID &lt;&gt; '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a>.'
<a name="l312"><span class="linenum"> 312</span></a>                              AND tsta_first_unread_msg_ID IS NULL';
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert thread statuses' );
<a name="l315"><span class="linenum"> 315</span></a>  
<a name="l316"><span class="linenum"> 316</span></a>  <span class="comment">                // check if contact pairs between sender and recipients exists</span>
<a name="l317"><span class="linenum"> 317</span></a>                  <a class="var it4721" onMouseOver="hilite(4721)" onMouseOut="lolite()" onClick="logVariable('recipient_list')" href="../../../_variables/recipient_list.html">$recipient_list</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;<a class="function" onClick="logFunction('load_recipients')" href="../../../_functions/load_recipients.html" onMouseOver="funcPopup(event,'load_recipients')">load_recipients</a>();
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment">                // remove author user from recipient list</span>
<a name="l319"><span class="linenum"> 319</span></a>                  <a class="var it4721" onMouseOver="hilite(4721)" onMouseOut="lolite()" onClick="logVariable('recipient_list')" href="../../../_variables/recipient_list.html">$recipient_list</a> = <a class="phpfunction" onClick="logFunction('array_diff')" href="../../../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>( <a class="var it4721" onMouseOver="hilite(4721)" onMouseOut="lolite()" onClick="logVariable('recipient_list')" href="../../../_variables/recipient_list.html">$recipient_list</a>, array( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> ) );
<a name="l320"><span class="linenum"> 320</span></a>  <span class="comment">                // insert missing contact pairs if required</span>
<a name="l321"><span class="linenum"> 321</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbinsert_contacts')" href="../../../_functions/dbinsert_contacts.html" onMouseOver="funcPopup(event,'dbinsert_contacts')">dbinsert_contacts</a>( <a class="var it4721" onMouseOver="hilite(4721)" onMouseOut="lolite()" onClick="logVariable('recipient_list')" href="../../../_variables/recipient_list.html">$recipient_list</a> ) )
<a name="l322"><span class="linenum"> 322</span></a>                  {
<a name="l323"><span class="linenum"> 323</span></a>                      if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate_last_contact_datetime')" href="../../../_functions/dbupdate_last_contact_datetime.html" onMouseOver="funcPopup(event,'dbupdate_last_contact_datetime')">dbupdate_last_contact_datetime</a>() )
<a name="l324"><span class="linenum"> 324</span></a>                      {
<a name="l325"><span class="linenum"> 325</span></a>                          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l326"><span class="linenum"> 326</span></a>  
<a name="l327"><span class="linenum"> 327</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_email_notifications')" href="../../../_functions/send_email_notifications.html" onMouseOver="funcPopup(event,'send_email_notifications')">send_email_notifications</a>( false );
<a name="l328"><span class="linenum"> 328</span></a>                          return true;
<a name="l329"><span class="linenum"> 329</span></a>                      }
<a name="l330"><span class="linenum"> 330</span></a>                  }
<a name="l331"><span class="linenum"> 331</span></a>              }
<a name="l332"><span class="linenum"> 332</span></a>          }
<a name="l333"><span class="linenum"> 333</span></a>  
<a name="l334"><span class="linenum"> 334</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l335"><span class="linenum"> 335</span></a>          return false;
<a name="l336"><span class="linenum"> 336</span></a>      }
<a name="l337"><span class="linenum"> 337</span></a>  
<a name="l338"><span class="linenum"> 338</span></a>  
<a name="l339"><span class="linenum"> 339</span></a>      <span class="comment">/**</span>
<a name="l340"><span class="linenum"> 340</span></a>  <span class="comment">     * Insert recipients into database</span>
<a name="l341"><span class="linenum"> 341</span></a>  <span class="comment">     *</span>
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">     * @param recipients</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment">     * @return true if success, instead false</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">     */</span>
<a name="l345"><span class="linenum"> 345</span></a>  	function <a class="function" onClick="logFunction('dbinsert_threadstatus')" href="../../../_functions/dbinsert_threadstatus.html" onMouseOver="funcPopup(event,'dbinsert_threadstatus')">dbinsert_threadstatus</a>( <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('recipients_list')" href="../../../_variables/recipients_list.html">$recipients_list</a> )
<a name="l346"><span class="linenum"> 346</span></a>      {
<a name="l347"><span class="linenum"> 347</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l348"><span class="linenum"> 348</span></a>  
<a name="l349"><span class="linenum"> 349</span></a>          <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_messaging__threadstatus (tsta_thread_ID, tsta_user_ID, tsta_first_unread_msg_ID)
<a name="l350"><span class="linenum"> 350</span></a>                              VALUES';
<a name="l351"><span class="linenum"> 351</span></a>  
<a name="l352"><span class="linenum"> 352</span></a>          foreach ( <a class="var it4722" onMouseOver="hilite(4722)" onMouseOut="lolite()" onClick="logVariable('recipients_list')" href="../../../_variables/recipients_list.html">$recipients_list</a> as <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a> )
<a name="l353"><span class="linenum"> 353</span></a>          {
<a name="l354"><span class="linenum"> 354</span></a>              <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> .= ' ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID.', '.<a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a>.', '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'),';
<a name="l355"><span class="linenum"> 355</span></a>          }
<a name="l356"><span class="linenum"> 356</span></a>          <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> .= ' ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID.', '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a>.', NULL)';
<a name="l357"><span class="linenum"> 357</span></a>  
<a name="l358"><span class="linenum"> 358</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert thread statuses' );
<a name="l359"><span class="linenum"> 359</span></a>      }
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>  
<a name="l362"><span class="linenum"> 362</span></a>      <span class="comment">/**</span>
<a name="l363"><span class="linenum"> 363</span></a>  <span class="comment">     * Insert contacts into database</span>
<a name="l364"><span class="linenum"> 364</span></a>  <span class="comment">     *</span>
<a name="l365"><span class="linenum"> 365</span></a>  <span class="comment">     * @param recipients</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment">     * @return true if success, instead false</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment">     */</span>
<a name="l368"><span class="linenum"> 368</span></a>  	function <a class="function" onClick="logFunction('dbinsert_contacts')" href="../../../_functions/dbinsert_contacts.html" onMouseOver="funcPopup(event,'dbinsert_contacts')">dbinsert_contacts</a>( <a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a> )
<a name="l369"><span class="linenum"> 369</span></a>      {
<a name="l370"><span class="linenum"> 370</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l371"><span class="linenum"> 371</span></a>  
<a name="l372"><span class="linenum"> 372</span></a>  <span class="comment">        // select contacts of the current user</span>
<a name="l373"><span class="linenum"> 373</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'mct_to_user_ID' );
<a name="l376"><span class="linenum"> 376</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact' );
<a name="l377"><span class="linenum"> 377</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'mct_from_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> );
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>          <a class="var it4723" onMouseOver="hilite(4723)" onMouseOut="lolite()" onClick="logVariable('contact_list')" href="../../../_variables/contact_list.html">$contact_list</a> = array();
<a name="l380"><span class="linenum"> 380</span></a>          foreach( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) as <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> )
<a name="l381"><span class="linenum"> 381</span></a>          {
<a name="l382"><span class="linenum"> 382</span></a>              <a class="var it4723" onMouseOver="hilite(4723)" onMouseOut="lolite()" onClick="logVariable('contact_list')" href="../../../_variables/contact_list.html">$contact_list</a>[] = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mct_to_user_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mct_to_user_ID.html">mct_to_user_ID</a>;
<a name="l383"><span class="linenum"> 383</span></a>          }
<a name="l384"><span class="linenum"> 384</span></a>  
<a name="l385"><span class="linenum"> 385</span></a>  <span class="comment">        // get users/recipients which are not in contact list</span>
<a name="l386"><span class="linenum"> 386</span></a>          <a class="var it4723" onMouseOver="hilite(4723)" onMouseOut="lolite()" onClick="logVariable('contact_list')" href="../../../_variables/contact_list.html">$contact_list</a> = <a class="phpfunction" onClick="logFunction('array_diff')" href="../../../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>( <a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a>, <a class="var it4723" onMouseOver="hilite(4723)" onMouseOut="lolite()" onClick="logVariable('contact_list')" href="../../../_variables/contact_list.html">$contact_list</a> );
<a name="l387"><span class="linenum"> 387</span></a>  
<a name="l388"><span class="linenum"> 388</span></a>  <span class="comment">        // select users who have author User on their contact list</span>
<a name="l389"><span class="linenum"> 389</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l390"><span class="linenum"> 390</span></a>  
<a name="l391"><span class="linenum"> 391</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'mct_from_user_ID' );
<a name="l392"><span class="linenum"> 392</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__contact' );
<a name="l393"><span class="linenum"> 393</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'mct_to_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> );
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>          <a class="var it4725" onMouseOver="hilite(4725)" onMouseOut="lolite()" onClick="logVariable('reverse_contact_list')" href="../../../_variables/reverse_contact_list.html">$reverse_contact_list</a> = array();
<a name="l396"><span class="linenum"> 396</span></a>          foreach( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) as <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> )
<a name="l397"><span class="linenum"> 397</span></a>          {
<a name="l398"><span class="linenum"> 398</span></a>              <a class="var it4725" onMouseOver="hilite(4725)" onMouseOut="lolite()" onClick="logVariable('reverse_contact_list')" href="../../../_variables/reverse_contact_list.html">$reverse_contact_list</a>[] = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mct_from_user_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mct_from_user_ID.html">mct_from_user_ID</a>;
<a name="l399"><span class="linenum"> 399</span></a>          }
<a name="l400"><span class="linenum"> 400</span></a>  
<a name="l401"><span class="linenum"> 401</span></a>  <span class="comment">        // get users/recipients which are not in reverse contact list</span>
<a name="l402"><span class="linenum"> 402</span></a>          <a class="var it4725" onMouseOver="hilite(4725)" onMouseOut="lolite()" onClick="logVariable('reverse_contact_list')" href="../../../_variables/reverse_contact_list.html">$reverse_contact_list</a> = <a class="phpfunction" onClick="logFunction('array_diff')" href="../../../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>( <a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a>, <a class="var it4725" onMouseOver="hilite(4725)" onMouseOut="lolite()" onClick="logVariable('reverse_contact_list')" href="../../../_variables/reverse_contact_list.html">$reverse_contact_list</a> );
<a name="l403"><span class="linenum"> 403</span></a>  
<a name="l404"><span class="linenum"> 404</span></a>          if( !empty( <a class="var it4723" onMouseOver="hilite(4723)" onMouseOut="lolite()" onClick="logVariable('contact_list')" href="../../../_variables/contact_list.html">$contact_list</a> ) || !empty( <a class="var it4725" onMouseOver="hilite(4725)" onMouseOut="lolite()" onClick="logVariable('reverse_contact_list')" href="../../../_variables/reverse_contact_list.html">$reverse_contact_list</a> ) )
<a name="l405"><span class="linenum"> 405</span></a>          { // insert users/recipients which are not in contact list
<a name="l406"><span class="linenum"> 406</span></a>  
<a name="l407"><span class="linenum"> 407</span></a>              <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_messaging__contact (mct_from_user_ID, mct_to_user_ID, mct_last_contact_datetime)
<a name="l408"><span class="linenum"> 408</span></a>                                  VALUES';
<a name="l409"><span class="linenum"> 409</span></a>  
<a name="l410"><span class="linenum"> 410</span></a>              <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> );
<a name="l411"><span class="linenum"> 411</span></a>  
<a name="l412"><span class="linenum"> 412</span></a>              <a class="var it4727" onMouseOver="hilite(4727)" onMouseOut="lolite()" onClick="logVariable('statements')" href="../../../_variables/statements.html">$statements</a> = array();
<a name="l413"><span class="linenum"> 413</span></a>              foreach ( <a class="var it4723" onMouseOver="hilite(4723)" onMouseOut="lolite()" onClick="logVariable('contact_list')" href="../../../_variables/contact_list.html">$contact_list</a> as <a class="var it4728" onMouseOver="hilite(4728)" onMouseOut="lolite()" onClick="logVariable('contact_ID')" href="../../../_variables/contact_ID.html">$contact_ID</a> )
<a name="l414"><span class="linenum"> 414</span></a>              {
<a name="l415"><span class="linenum"> 415</span></a>                  if( <a class="var it4728" onMouseOver="hilite(4728)" onMouseOut="lolite()" onClick="logVariable('contact_ID')" href="../../../_variables/contact_ID.html">$contact_ID</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> )
<a name="l416"><span class="linenum"> 416</span></a>                  { // Don't insert a contact from the same user
<a name="l417"><span class="linenum"> 417</span></a>                      <a class="var it4727" onMouseOver="hilite(4727)" onMouseOut="lolite()" onClick="logVariable('statements')" href="../../../_variables/statements.html">$statements</a>[] = ' ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a>.', '.<a class="var it4728" onMouseOver="hilite(4728)" onMouseOut="lolite()" onClick="logVariable('contact_ID')" href="../../../_variables/contact_ID.html">$contact_ID</a>.', \''.<a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a>.'\')';
<a name="l418"><span class="linenum"> 418</span></a>                  }
<a name="l419"><span class="linenum"> 419</span></a>              }
<a name="l420"><span class="linenum"> 420</span></a>              foreach ( <a class="var it4725" onMouseOver="hilite(4725)" onMouseOut="lolite()" onClick="logVariable('reverse_contact_list')" href="../../../_variables/reverse_contact_list.html">$reverse_contact_list</a> as <a class="var it4728" onMouseOver="hilite(4728)" onMouseOut="lolite()" onClick="logVariable('contact_ID')" href="../../../_variables/contact_ID.html">$contact_ID</a> )
<a name="l421"><span class="linenum"> 421</span></a>              {
<a name="l422"><span class="linenum"> 422</span></a>                  if( <a class="var it4728" onMouseOver="hilite(4728)" onMouseOut="lolite()" onClick="logVariable('contact_ID')" href="../../../_variables/contact_ID.html">$contact_ID</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> )
<a name="l423"><span class="linenum"> 423</span></a>                  { // Don't insert a contact from the same user
<a name="l424"><span class="linenum"> 424</span></a>                      <a class="var it4727" onMouseOver="hilite(4727)" onMouseOut="lolite()" onClick="logVariable('statements')" href="../../../_variables/statements.html">$statements</a>[] = ' ('.<a class="var it4728" onMouseOver="hilite(4728)" onMouseOut="lolite()" onClick="logVariable('contact_ID')" href="../../../_variables/contact_ID.html">$contact_ID</a>.', '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a>.', \''.<a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a>.'\')';
<a name="l425"><span class="linenum"> 425</span></a>                  }
<a name="l426"><span class="linenum"> 426</span></a>              }
<a name="l427"><span class="linenum"> 427</span></a>  
<a name="l428"><span class="linenum"> 428</span></a>              if( ! empty( <a class="var it4727" onMouseOver="hilite(4727)" onMouseOut="lolite()" onClick="logVariable('statements')" href="../../../_variables/statements.html">$statements</a> ) )
<a name="l429"><span class="linenum"> 429</span></a>              { // Do insert sql only when data exist
<a name="l430"><span class="linenum"> 430</span></a>                  <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> .= <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it4727" onMouseOver="hilite(4727)" onMouseOut="lolite()" onClick="logVariable('statements')" href="../../../_variables/statements.html">$statements</a> );
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>                  return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert contacts' );
<a name="l433"><span class="linenum"> 433</span></a>              }
<a name="l434"><span class="linenum"> 434</span></a>          }
<a name="l435"><span class="linenum"> 435</span></a>  
<a name="l436"><span class="linenum"> 436</span></a>          return true;
<a name="l437"><span class="linenum"> 437</span></a>      }
<a name="l438"><span class="linenum"> 438</span></a>  
<a name="l439"><span class="linenum"> 439</span></a>  
<a name="l440"><span class="linenum"> 440</span></a>      <span class="comment">/**</span>
<a name="l441"><span class="linenum"> 441</span></a>  <span class="comment">     * Update last contact datetimes</span>
<a name="l442"><span class="linenum"> 442</span></a>  <span class="comment">     *</span>
<a name="l443"><span class="linenum"> 443</span></a>  <span class="comment">     * @return true if success</span>
<a name="l444"><span class="linenum"> 444</span></a>  <span class="comment">     */</span>
<a name="l445"><span class="linenum"> 445</span></a>  	function <a class="function" onClick="logFunction('dbupdate_last_contact_datetime')" href="../../../_functions/dbupdate_last_contact_datetime.html" onMouseOver="funcPopup(event,'dbupdate_last_contact_datetime')">dbupdate_last_contact_datetime</a>()
<a name="l446"><span class="linenum"> 446</span></a>      {
<a name="l447"><span class="linenum"> 447</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l448"><span class="linenum"> 448</span></a>  
<a name="l449"><span class="linenum"> 449</span></a>  <span class="comment">        // efy-maxim&gt; TODO: two SQL queries are used instead one update with subselect,</span>
<a name="l450"><span class="linenum"> 450</span></a>  <span class="comment">        // because T_messaging__threadstatus alias is not converted to real table name.</span>
<a name="l451"><span class="linenum"> 451</span></a>  <span class="comment">        // Also, it can't be improved right now because it depends of</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">        // (pls. see blueyed's comment for $DB-&gt;query() function)</span>
<a name="l453"><span class="linenum"> 453</span></a>  
<a name="l454"><span class="linenum"> 454</span></a>          <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l455"><span class="linenum"> 455</span></a>          <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'GROUP_CONCAT(tsta_user_ID SEPARATOR \',\')' );
<a name="l456"><span class="linenum"> 456</span></a>          <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus' );
<a name="l457"><span class="linenum"> 457</span></a>          <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'tsta_thread_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID );
<a name="l458"><span class="linenum"> 458</span></a>  
<a name="l459"><span class="linenum"> 459</span></a>          <a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it152" onMouseOver="hilite(152)" onMouseOut="lolite()" onClick="logVariable('select_SQL')" href="../../../_variables/select_SQL.html">$select_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l460"><span class="linenum"> 460</span></a>  
<a name="l461"><span class="linenum"> 461</span></a>          <a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> );
<a name="l462"><span class="linenum"> 462</span></a>  
<a name="l463"><span class="linenum"> 463</span></a>          <a class="var it4729" onMouseOver="hilite(4729)" onMouseOut="lolite()" onClick="logVariable('update_sql')" href="../../../_variables/update_sql.html">$update_sql</a> = 'UPDATE T_messaging__contact
<a name="l464"><span class="linenum"> 464</span></a>                      SET mct_last_contact_datetime = \''.<a class="var it4712" onMouseOver="hilite(4712)" onMouseOut="lolite()" onClick="logVariable('datetime')" href="../../../_variables/datetime.html">$datetime</a>.'\'
<a name="l465"><span class="linenum"> 465</span></a>                      WHERE mct_from_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a>.'
<a name="l466"><span class="linenum"> 466</span></a>                          AND mct_to_user_ID IN ('.<a class="var it1296" onMouseOver="hilite(1296)" onMouseOut="lolite()" onClick="logVariable('recipients')" href="../../../_variables/recipients.html">$recipients</a>.')';
<a name="l467"><span class="linenum"> 467</span></a>  
<a name="l468"><span class="linenum"> 468</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it4729" onMouseOver="hilite(4729)" onMouseOut="lolite()" onClick="logVariable('update_sql')" href="../../../_variables/update_sql.html">$update_sql</a>, 'Update last contact datetimes' );
<a name="l469"><span class="linenum"> 469</span></a>  
<a name="l470"><span class="linenum"> 470</span></a>          return true;
<a name="l471"><span class="linenum"> 471</span></a>      }
<a name="l472"><span class="linenum"> 472</span></a>  
<a name="l473"><span class="linenum"> 473</span></a>  
<a name="l474"><span class="linenum"> 474</span></a>      <span class="comment">/**</span>
<a name="l475"><span class="linenum"> 475</span></a>  <span class="comment">     * Clone current message and convert cloned message from 'individual' to 'discussion'.</span>
<a name="l476"><span class="linenum"> 476</span></a>  <span class="comment">     *</span>
<a name="l477"><span class="linenum"> 477</span></a>  <span class="comment">     * @param instance of Message class</span>
<a name="l478"><span class="linenum"> 478</span></a>  <span class="comment">     * @return cloned message</span>
<a name="l479"><span class="linenum"> 479</span></a>  <span class="comment">     */</span>
<a name="l480"><span class="linenum"> 480</span></a>  	function <a class="function" onClick="logFunction('clone_message')" href="../../../_functions/clone_message.html" onMouseOver="funcPopup(event,'clone_message')">clone_message</a>( <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a> )
<a name="l481"><span class="linenum"> 481</span></a>      {
<a name="l482"><span class="linenum"> 482</span></a>          <a class="var it4730" onMouseOver="hilite(4730)" onMouseOut="lolite()" onClick="logVariable('new_Message')" href="../../../_variables/new_Message.html">$new_Message</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Message')" href="../../../_classes/message.html" onMouseOver="classPopup(event,'message')">Message</a>();
<a name="l483"><span class="linenum"> 483</span></a>          <a class="var it4730" onMouseOver="hilite(4730)" onMouseOut="lolite()" onClick="logVariable('new_Message')" href="../../../_variables/new_Message.html">$new_Message</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'text', <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('text')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/text.html">text</a> );
<a name="l484"><span class="linenum"> 484</span></a>          <a class="var it4730" onMouseOver="hilite(4730)" onMouseOut="lolite()" onClick="logVariable('new_Message')" href="../../../_variables/new_Message.html">$new_Message</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'renderers', <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('renderers')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/renderers.html">renderers</a> );
<a name="l485"><span class="linenum"> 485</span></a>          if( !empty( <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> ) )
<a name="l486"><span class="linenum"> 486</span></a>          {
<a name="l487"><span class="linenum"> 487</span></a>              <a class="var it4730" onMouseOver="hilite(4730)" onMouseOut="lolite()" onClick="logVariable('new_Message')" href="../../../_variables/new_Message.html">$new_Message</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'author_user_ID', <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> );
<a name="l488"><span class="linenum"> 488</span></a>          }
<a name="l489"><span class="linenum"> 489</span></a>          if( !empty( <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('creator_user_ID')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/creator_user_ID.html">creator_user_ID</a> ) )
<a name="l490"><span class="linenum"> 490</span></a>          {
<a name="l491"><span class="linenum"> 491</span></a>              <a class="var it4730" onMouseOver="hilite(4730)" onMouseOut="lolite()" onClick="logVariable('new_Message')" href="../../../_variables/new_Message.html">$new_Message</a>-&gt;<a onClick="logVariable('creator_user_ID')" class="var it10982" onMouseOver="hilite(10982)" onMouseOut="lolite()" href="../../../_variables/creator_user_ID.html">creator_user_ID</a> = <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('creator_user_ID')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/creator_user_ID.html">creator_user_ID</a>;
<a name="l492"><span class="linenum"> 492</span></a>          }
<a name="l493"><span class="linenum"> 493</span></a>  
<a name="l494"><span class="linenum"> 494</span></a>          <a class="var it4731" onMouseOver="hilite(4731)" onMouseOut="lolite()" onClick="logVariable('new_Thread')" href="../../../_variables/new_Thread.html">$new_Thread</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">Thread</a>();
<a name="l495"><span class="linenum"> 495</span></a>          <a class="var it4731" onMouseOver="hilite(4731)" onMouseOut="lolite()" onClick="logVariable('new_Thread')" href="../../../_variables/new_Thread.html">$new_Thread</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'title', <a class="var it407" onMouseOver="hilite(407)" onMouseOut="lolite()" onClick="logVariable('message')" href="../../../_variables/message.html">$message</a>-&gt;<a onClick="logVariable('Thread')" class="var it10981" onMouseOver="hilite(10981)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;title );
<a name="l496"><span class="linenum"> 496</span></a>  
<a name="l497"><span class="linenum"> 497</span></a>          <a class="var it4730" onMouseOver="hilite(4730)" onMouseOut="lolite()" onClick="logVariable('new_Message')" href="../../../_variables/new_Message.html">$new_Message</a>-&gt;<a onClick="logVariable('Thread')" class="var it10982" onMouseOver="hilite(10982)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a> = &amp; <a class="var it4731" onMouseOver="hilite(4731)" onMouseOut="lolite()" onClick="logVariable('new_Thread')" href="../../../_variables/new_Thread.html">$new_Thread</a>;
<a name="l498"><span class="linenum"> 498</span></a>  
<a name="l499"><span class="linenum"> 499</span></a>          return <a class="var it4730" onMouseOver="hilite(4730)" onMouseOut="lolite()" onClick="logVariable('new_Message')" href="../../../_variables/new_Message.html">$new_Message</a>;
<a name="l500"><span class="linenum"> 500</span></a>      }
<a name="l501"><span class="linenum"> 501</span></a>  
<a name="l502"><span class="linenum"> 502</span></a>  
<a name="l503"><span class="linenum"> 503</span></a>      <span class="comment">/**</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">     * Delete those messages from the database which corresponds to the given condition or to the given ids array</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment">     * Note: the delete cascade arrays are handled!</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">     *</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">     * @param string the name of this class</span>
<a name="l508"><span class="linenum"> 508</span></a>  <span class="comment">     *   Note: This is required until min phpversion will be 5.3. Since PHP 5.3 we can use static::function_name to achieve late static bindings</span>
<a name="l509"><span class="linenum"> 509</span></a>  <span class="comment">     * @param string where condition</span>
<a name="l510"><span class="linenum"> 510</span></a>  <span class="comment">     * @param array object ids</span>
<a name="l511"><span class="linenum"> 511</span></a>  <span class="comment">     * @return mixed # of rows affected or false if error</span>
<a name="l512"><span class="linenum"> 512</span></a>  <span class="comment">     */</span>
<a name="l513"><span class="linenum"> 513</span></a>  	static function <a class="function" onClick="logFunction('db_delete_where')" href="../../../_functions/db_delete_where.html" onMouseOver="funcPopup(event,'db_delete_where')">db_delete_where</a>( <a class="var it2446" onMouseOver="hilite(2446)" onMouseOut="lolite()" onClick="logVariable('class_name')" href="../../../_variables/class_name.html">$class_name</a>, <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a>, <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> = NULL, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = NULL )
<a name="l514"><span class="linenum"> 514</span></a>      {
<a name="l515"><span class="linenum"> 515</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l516"><span class="linenum"> 516</span></a>  
<a name="l517"><span class="linenum"> 517</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l518"><span class="linenum"> 518</span></a>  
<a name="l519"><span class="linenum"> 519</span></a>          if( ! empty( <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a> ) )
<a name="l520"><span class="linenum"> 520</span></a>          {
<a name="l521"><span class="linenum"> 521</span></a>              <a class="var it4732" onMouseOver="hilite(4732)" onMouseOut="lolite()" onClick="logVariable('messages_to_delete')" href="../../../_variables/messages_to_delete.html">$messages_to_delete</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( 'SELECT msg_ID, msg_thread_ID FROM T_messaging__message WHERE '.<a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a> );
<a name="l522"><span class="linenum"> 522</span></a>              <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it4732" onMouseOver="hilite(4732)" onMouseOut="lolite()" onClick="logVariable('messages_to_delete')" href="../../../_variables/messages_to_delete.html">$messages_to_delete</a> );
<a name="l523"><span class="linenum"> 523</span></a>              <a class="var it4733" onMouseOver="hilite(4733)" onMouseOut="lolite()" onClick="logVariable('thread_ids_to_delete')" href="../../../_variables/thread_ids_to_delete.html">$thread_ids_to_delete</a> = <a class="phpfunction" onClick="logFunction('array_unique')" href="../../../_functions/array_unique.html" onMouseOver="phpfuncPopup(event,'array_unique')">array_unique</a>( <a class="var it4732" onMouseOver="hilite(4732)" onMouseOut="lolite()" onClick="logVariable('messages_to_delete')" href="../../../_variables/messages_to_delete.html">$messages_to_delete</a> );
<a name="l524"><span class="linenum"> 524</span></a>          }
<a name="l525"><span class="linenum"> 525</span></a>  
<a name="l526"><span class="linenum"> 526</span></a>          if( ! <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> )
<a name="l527"><span class="linenum"> 527</span></a>          { // There is no comment to delete
<a name="l528"><span class="linenum"> 528</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l529"><span class="linenum"> 529</span></a>              return;
<a name="l530"><span class="linenum"> 530</span></a>          }
<a name="l531"><span class="linenum"> 531</span></a>  
<a name="l532"><span class="linenum"> 532</span></a>          <a class="var it4734" onMouseOver="hilite(4734)" onMouseOut="lolite()" onClick="logVariable('message_ids_to_delete')" href="../../../_variables/message_ids_to_delete.html">$message_ids_to_delete</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> );
<a name="l533"><span class="linenum"> 533</span></a>          if( empty( <a class="var it4733" onMouseOver="hilite(4733)" onMouseOut="lolite()" onClick="logVariable('thread_ids_to_delete')" href="../../../_variables/thread_ids_to_delete.html">$thread_ids_to_delete</a> ) )
<a name="l534"><span class="linenum"> 534</span></a>          { // Make sure thread ids of the messages are collected
<a name="l535"><span class="linenum"> 535</span></a>              <a class="var it4733" onMouseOver="hilite(4733)" onMouseOut="lolite()" onClick="logVariable('thread_ids_to_delete')" href="../../../_variables/thread_ids_to_delete.html">$thread_ids_to_delete</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( 'SELECT msg_thread_ID FROM T_messaging__message WHERE msg_ID IN ( '.<a class="var it4734" onMouseOver="hilite(4734)" onMouseOut="lolite()" onClick="logVariable('message_ids_to_delete')" href="../../../_variables/message_ids_to_delete.html">$message_ids_to_delete</a>.' )' );
<a name="l536"><span class="linenum"> 536</span></a>          }
<a name="l537"><span class="linenum"> 537</span></a>  
<a name="l538"><span class="linenum"> 538</span></a>  <span class="comment">        // Update thread statuses first unread message IDs</span>
<a name="l539"><span class="linenum"> 539</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_messaging__threadstatus
<a name="l540"><span class="linenum"> 540</span></a>                  SET tsta_first_unread_msg_ID =
<a name="l541"><span class="linenum"> 541</span></a>                  ( SELECT message1.msg_ID
<a name="l542"><span class="linenum"> 542</span></a>                      FROM T_messaging__message as message1
<a name="l543"><span class="linenum"> 543</span></a>                      WHERE message1.msg_thread_ID = tsta_thread_ID
<a name="l544"><span class="linenum"> 544</span></a>                          AND message1.msg_datetime &gt; ( SELECT <a class="phpfunction" onClick="logFunction('MAX')" href="../../../_functions/max.html" onMouseOver="phpfuncPopup(event,'max')">MAX</a>( message2.msg_datetime)
<a name="l545"><span class="linenum"> 545</span></a>                              FROM T_messaging__message as message2
<a name="l546"><span class="linenum"> 546</span></a>                              WHERE message2.msg_ID IN ( '.<a class="var it4734" onMouseOver="hilite(4734)" onMouseOut="lolite()" onClick="logVariable('message_ids_to_delete')" href="../../../_variables/message_ids_to_delete.html">$message_ids_to_delete</a>.' )
<a name="l547"><span class="linenum"> 547</span></a>                                  AND message2.msg_thread_ID = tsta_thread_ID
<a name="l548"><span class="linenum"> 548</span></a>                          )
<a name="l549"><span class="linenum"> 549</span></a>                      ORDER BY message1.msg_datetime ASC
<a name="l550"><span class="linenum"> 550</span></a>                      LIMIT 1
<a name="l551"><span class="linenum"> 551</span></a>                  )
<a name="l552"><span class="linenum"> 552</span></a>                  WHERE tsta_first_unread_msg_ID IN ( '.<a class="var it4734" onMouseOver="hilite(4734)" onMouseOut="lolite()" onClick="logVariable('message_ids_to_delete')" href="../../../_variables/message_ids_to_delete.html">$message_ids_to_delete</a>.')' ) !== false;
<a name="l553"><span class="linenum"> 553</span></a>  
<a name="l554"><span class="linenum"> 554</span></a>          if( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> )
<a name="l555"><span class="linenum"> 555</span></a>          { // Remove messages with all of its delete cascade relations
<a name="l556"><span class="linenum"> 556</span></a>              <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = parent::<a class="function" onClick="logFunction('db_delete_where')" href="../../../_functions/db_delete_where.html" onMouseOver="funcPopup(event,'db_delete_where')">db_delete_where</a>( <a class="var it2446" onMouseOver="hilite(2446)" onMouseOut="lolite()" onClick="logVariable('class_name')" href="../../../_variables/class_name.html">$class_name</a>, <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a>, <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> );
<a name="l557"><span class="linenum"> 557</span></a>          }
<a name="l558"><span class="linenum"> 558</span></a>  
<a name="l559"><span class="linenum"> 559</span></a>          if( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> !== false )
<a name="l560"><span class="linenum"> 560</span></a>          { // Delete those threads where all of the messages were deleted
<a name="l561"><span class="linenum"> 561</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'messaging/model/_thread.class.php', 'Thread' );
<a name="l562"><span class="linenum"> 562</span></a>              <a class="var it4735" onMouseOver="hilite(4735)" onMouseOut="lolite()" onClick="logVariable('orphan_thread_ids')" href="../../../_variables/orphan_thread_ids.html">$orphan_thread_ids</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( '
<a name="l563"><span class="linenum"> 563</span></a>                  SELECT msg_thread_ID FROM T_messaging__message
<a name="l564"><span class="linenum"> 564</span></a>                  WHERE msg_thread_ID IN ( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it4733" onMouseOver="hilite(4733)" onMouseOut="lolite()" onClick="logVariable('thread_ids_to_delete')" href="../../../_variables/thread_ids_to_delete.html">$thread_ids_to_delete</a> ).' )
<a name="l565"><span class="linenum"> 565</span></a>                  GROUP BY msg_thread_ID
<a name="l566"><span class="linenum"> 566</span></a>                      HAVING <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) &lt; 1' );
<a name="l567"><span class="linenum"> 567</span></a>  
<a name="l568"><span class="linenum"> 568</span></a>  <span class="comment">            // Delete orphan threads if there are any</span>
<a name="l569"><span class="linenum"> 569</span></a>              if( ( ! empty( <a class="var it4735" onMouseOver="hilite(4735)" onMouseOut="lolite()" onClick="logVariable('orphan_thread_ids')" href="../../../_variables/orphan_thread_ids.html">$orphan_thread_ids</a> ) ) &amp;&amp; ( <a class="class" onClick="logClass('Thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">Thread</a>::<a class="function" onClick="logFunction('db_delete_where')" href="../../../_functions/db_delete_where.html" onMouseOver="funcPopup(event,'db_delete_where')">db_delete_where</a>( 'Thread', NULL, <a class="var it4735" onMouseOver="hilite(4735)" onMouseOut="lolite()" onClick="logVariable('orphan_thread_ids')" href="../../../_variables/orphan_thread_ids.html">$orphan_thread_ids</a> ) === false ) )
<a name="l570"><span class="linenum"> 570</span></a>              { // Deleting threads was unsuccessful
<a name="l571"><span class="linenum"> 571</span></a>                  <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = false;
<a name="l572"><span class="linenum"> 572</span></a>              }
<a name="l573"><span class="linenum"> 573</span></a>          }
<a name="l574"><span class="linenum"> 574</span></a>  
<a name="l575"><span class="linenum"> 575</span></a>  <span class="comment">        // Commit or rollback the transaction</span>
<a name="l576"><span class="linenum"> 576</span></a>          ( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> !== false ) ? <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>() : <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l577"><span class="linenum"> 577</span></a>  
<a name="l578"><span class="linenum"> 578</span></a>          return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l579"><span class="linenum"> 579</span></a>      }
<a name="l580"><span class="linenum"> 580</span></a>  
<a name="l581"><span class="linenum"> 581</span></a>  
<a name="l582"><span class="linenum"> 582</span></a>      <span class="comment">/**</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">     * Delete message and dependencies from database</span>
<a name="l584"><span class="linenum"> 584</span></a>  <span class="comment">     *</span>
<a name="l585"><span class="linenum"> 585</span></a>  <span class="comment">     * @param Log Log object where output gets added (by reference).</span>
<a name="l586"><span class="linenum"> 586</span></a>  <span class="comment">     */</span>
<a name="l587"><span class="linenum"> 587</span></a>  	function <a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>()
<a name="l588"><span class="linenum"> 588</span></a>      {
<a name="l589"><span class="linenum"> 589</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == 0 ) <a class="function" onClick="logFunction('debug_die')" href="../../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'Non persistant object cannot be deleted!' );
<a name="l590"><span class="linenum"> 590</span></a>  
<a name="l591"><span class="linenum"> 591</span></a>          return parent::<a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>();
<a name="l592"><span class="linenum"> 592</span></a>      }
<a name="l593"><span class="linenum"> 593</span></a>  
<a name="l594"><span class="linenum"> 594</span></a>  
<a name="l595"><span class="linenum"> 595</span></a>      <span class="comment">/**</span>
<a name="l596"><span class="linenum"> 596</span></a>  <span class="comment">     * Check permission on a message</span>
<a name="l597"><span class="linenum"> 597</span></a>  <span class="comment">     *</span>
<a name="l598"><span class="linenum"> 598</span></a>  <span class="comment">     * @return boolean true if granted</span>
<a name="l599"><span class="linenum"> 599</span></a>  <span class="comment">     */</span>
<a name="l600"><span class="linenum"> 600</span></a>  	function <a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a>, <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('assert')" href="../../../_variables/assert.html">$assert</a> = true )
<a name="l601"><span class="linenum"> 601</span></a>      {
<a name="l602"><span class="linenum"> 602</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l603"><span class="linenum"> 603</span></a>  
<a name="l604"><span class="linenum"> 604</span></a>          return <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a>, <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('assert')" href="../../../_variables/assert.html">$assert</a> );
<a name="l605"><span class="linenum"> 605</span></a>      }
<a name="l606"><span class="linenum"> 606</span></a>  
<a name="l607"><span class="linenum"> 607</span></a>  
<a name="l608"><span class="linenum"> 608</span></a>      <span class="comment">/**</span>
<a name="l609"><span class="linenum"> 609</span></a>  <span class="comment">     * Send email notification to recipients on new thread or new message event.</span>
<a name="l610"><span class="linenum"> 610</span></a>  <span class="comment">     *</span>
<a name="l611"><span class="linenum"> 611</span></a>  <span class="comment">     * @param boolean true if new thread, false if new message in the current thread</span>
<a name="l612"><span class="linenum"> 612</span></a>  <span class="comment">     * @param boolean the User who sent the message, in case of current User it may be NULL ( This is not the current User e.g. in case of welcome messages )</span>
<a name="l613"><span class="linenum"> 613</span></a>  <span class="comment">     * @return boolean True if all messages could be sent, false otherwise.</span>
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment">     */</span>
<a name="l615"><span class="linenum"> 615</span></a>  	function <a class="function" onClick="logFunction('send_email_notifications')" href="../../../_functions/send_email_notifications.html" onMouseOver="funcPopup(event,'send_email_notifications')">send_email_notifications</a>( <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('new_thread')" href="../../../_variables/new_thread.html">$new_thread</a> = true, <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a> = NULL )
<a name="l616"><span class="linenum"> 616</span></a>      {
<a name="l617"><span class="linenum"> 617</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>, <a class="var it461" onMouseOver="hilite(461)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../../_variables/baseurl.html">$baseurl</a>, <a class="var it1348" onMouseOver="hilite(1348)" onMouseOut="lolite()" onClick="logVariable('app_name')" href="../../../_variables/app_name.html">$app_name</a>;
<a name="l618"><span class="linenum"> 618</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l619"><span class="linenum"> 619</span></a>  
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">        // Select recipients of the current thread:</span>
<a name="l621"><span class="linenum"> 621</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l622"><span class="linenum"> 622</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'u.user_ID, us.uset_value as notify_messages' );
<a name="l623"><span class="linenum"> 623</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus ts
<a name="l624"><span class="linenum"> 624</span></a>                          INNER JOIN T_messaging__contact c
<a name="l625"><span class="linenum"> 625</span></a>                              ON ts.tsta_user_ID = c.mct_to_user_ID AND c.mct_from_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a>.' AND c.mct_blocked = 0
<a name="l626"><span class="linenum"> 626</span></a>                          INNER JOIN T_users u
<a name="l627"><span class="linenum"> 627</span></a>                              ON ts.tsta_user_ID = u.user_ID
<a name="l628"><span class="linenum"> 628</span></a>                          LEFT OUTER JOIN T_users__usersettings us ON u.user_ID = us.uset_user_ID AND us.uset_name = &quot;notify_messages&quot;' );
<a name="l629"><span class="linenum"> 629</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'ts.tsta_thread_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID.' AND ts.tsta_user_ID &lt;&gt; '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> );
<a name="l630"><span class="linenum"> 630</span></a>  
<a name="l631"><span class="linenum"> 631</span></a>          <a class="var it1085" onMouseOver="hilite(1085)" onMouseOut="lolite()" onClick="logVariable('thrd_recipients')" href="../../../_variables/thrd_recipients.html">$thrd_recipients</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l632"><span class="linenum"> 632</span></a>  
<a name="l633"><span class="linenum"> 633</span></a>  <span class="comment">        // set message link:</span>
<a name="l634"><span class="linenum"> 634</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it4736" onMouseOver="hilite(4736)" onMouseOut="lolite()" onClick="logVariable('message_link')" href="../../../_variables/message_link.html">$message_link</a>, <a class="var it4737" onMouseOver="hilite(4737)" onMouseOut="lolite()" onClick="logVariable('prefs_link')" href="../../../_variables/prefs_link.html">$prefs_link</a> ) = <a class="function" onClick="logFunction('get_messages_link_to')" href="../../../_functions/get_messages_link_to.html" onMouseOver="funcPopup(event,'get_messages_link_to')">get_messages_link_to</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a> );
<a name="l635"><span class="linenum"> 635</span></a>  
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">        // Construct message subject and body:</span>
<a name="l637"><span class="linenum"> 637</span></a>          if( <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('new_thread')" href="../../../_variables/new_thread.html">$new_thread</a> )
<a name="l638"><span class="linenum"> 638</span></a>          {
<a name="l639"><span class="linenum"> 639</span></a>              <a class="var it60" onMouseOver="hilite(60)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../../_variables/subject.html">$subject</a> = <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>( '%s just sent you a <span class="keyword">new </span><a class="class" onClick="logClass('message')" href="../../../_classes/message.html" onMouseOver="classPopup(event,'message')">message</a>!' );
<a name="l640"><span class="linenum"> 640</span></a>          }
<a name="l641"><span class="linenum"> 641</span></a>          elseif( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it1085" onMouseOver="hilite(1085)" onMouseOut="lolite()" onClick="logVariable('thrd_recipients')" href="../../../_variables/thrd_recipients.html">$thrd_recipients</a> ) == 1 )
<a name="l642"><span class="linenum"> 642</span></a>          {
<a name="l643"><span class="linenum"> 643</span></a>              <a class="var it60" onMouseOver="hilite(60)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../../_variables/subject.html">$subject</a> = <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>( '%s just replied to your message!' );
<a name="l644"><span class="linenum"> 644</span></a>          }
<a name="l645"><span class="linenum"> 645</span></a>          else
<a name="l646"><span class="linenum"> 646</span></a>          {
<a name="l647"><span class="linenum"> 647</span></a>              <a class="var it60" onMouseOver="hilite(60)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../../_variables/subject.html">$subject</a> = <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>( '%s just replied to a conversation you are involved in!' );
<a name="l648"><span class="linenum"> 648</span></a>          }
<a name="l649"><span class="linenum"> 649</span></a>  
<a name="l650"><span class="linenum"> 650</span></a>  <span class="comment">        // Get other unread threads</span>
<a name="l651"><span class="linenum"> 651</span></a>          <a class="var it4738" onMouseOver="hilite(4738)" onMouseOut="lolite()" onClick="logVariable('other_unread_threads')" href="../../../_variables/other_unread_threads.html">$other_unread_threads</a> = <a class="function" onClick="logFunction('get_users_unread_threads')" href="../../../_functions/get_users_unread_threads.html" onMouseOver="funcPopup(event,'get_users_unread_threads')">get_users_unread_threads</a>( <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it1085" onMouseOver="hilite(1085)" onMouseOut="lolite()" onClick="logVariable('thrd_recipients')" href="../../../_variables/thrd_recipients.html">$thrd_recipients</a> ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('thread_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/thread_ID.html">thread_ID</a>, 'array', 'html' );
<a name="l652"><span class="linenum"> 652</span></a>  
<a name="l653"><span class="linenum"> 653</span></a>  <span class="comment">        // Load all users who will be notified</span>
<a name="l654"><span class="linenum"> 654</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l655"><span class="linenum"> 655</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;<a class="function" onClick="logFunction('load_list')" href="../../../_functions/load_list.html" onMouseOver="funcPopup(event,'load_list')">load_list</a>( <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it1085" onMouseOver="hilite(1085)" onMouseOut="lolite()" onClick="logVariable('thrd_recipients')" href="../../../_variables/thrd_recipients.html">$thrd_recipients</a> ) );
<a name="l656"><span class="linenum"> 656</span></a>  
<a name="l657"><span class="linenum"> 657</span></a>  <span class="comment">        // Send email notifications.</span>
<a name="l658"><span class="linenum"> 658</span></a>          <a class="var it1033" onMouseOver="hilite(1033)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../../_variables/ret.html">$ret</a> = true;
<a name="l659"><span class="linenum"> 659</span></a>          <a class="var it4739" onMouseOver="hilite(4739)" onMouseOut="lolite()" onClick="logVariable('def_notify_messages')" href="../../../_variables/def_notify_messages.html">$def_notify_messages</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'def_notify_messages' );
<a name="l660"><span class="linenum"> 660</span></a>          foreach( <a class="var it1085" onMouseOver="hilite(1085)" onMouseOut="lolite()" onClick="logVariable('thrd_recipients')" href="../../../_variables/thrd_recipients.html">$thrd_recipients</a> as <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a> =&gt; <a class="var it4740" onMouseOver="hilite(4740)" onMouseOut="lolite()" onClick="logVariable('notify_messages')" href="../../../_variables/notify_messages.html">$notify_messages</a> )
<a name="l661"><span class="linenum"> 661</span></a>          { // Send mail to recipients who needs to be notified. recipients are already loaded into the UserCache
<a name="l662"><span class="linenum"> 662</span></a>              if( !( <a class="var it4740" onMouseOver="hilite(4740)" onMouseOut="lolite()" onClick="logVariable('notify_messages')" href="../../../_variables/notify_messages.html">$notify_messages</a> || ( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it4740" onMouseOver="hilite(4740)" onMouseOut="lolite()" onClick="logVariable('notify_messages')" href="../../../_variables/notify_messages.html">$notify_messages</a> ) &amp;&amp; <a class="var it4739" onMouseOver="hilite(4739)" onMouseOut="lolite()" onClick="logVariable('def_notify_messages')" href="../../../_variables/def_notify_messages.html">$def_notify_messages</a> ) ) )
<a name="l663"><span class="linenum"> 663</span></a>              { // User should NOT be notified
<a name="l664"><span class="linenum"> 664</span></a>                  continue;
<a name="l665"><span class="linenum"> 665</span></a>              }
<a name="l666"><span class="linenum"> 666</span></a>  
<a name="l667"><span class="linenum"> 667</span></a>              <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> = array(
<a name="l668"><span class="linenum"> 668</span></a>                      'recipient_ID'         =&gt; <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a>,
<a name="l669"><span class="linenum"> 669</span></a>                      'new_thread'           =&gt; <a class="var it4718" onMouseOver="hilite(4718)" onMouseOut="lolite()" onClick="logVariable('new_thread')" href="../../../_variables/new_thread.html">$new_thread</a>,
<a name="l670"><span class="linenum"> 670</span></a>                      'thrd_recipients'      =&gt; <a class="var it1085" onMouseOver="hilite(1085)" onMouseOut="lolite()" onClick="logVariable('thrd_recipients')" href="../../../_variables/thrd_recipients.html">$thrd_recipients</a>,
<a name="l671"><span class="linenum"> 671</span></a>                      'Message'              =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>,
<a name="l672"><span class="linenum"> 672</span></a>                      'message_link'         =&gt; <a class="var it4736" onMouseOver="hilite(4736)" onMouseOut="lolite()" onClick="logVariable('message_link')" href="../../../_variables/message_link.html">$message_link</a>,
<a name="l673"><span class="linenum"> 673</span></a>                      'other_unread_threads' =&gt; <a class="var it4738" onMouseOver="hilite(4738)" onMouseOut="lolite()" onClick="logVariable('other_unread_threads')" href="../../../_variables/other_unread_threads.html">$other_unread_threads</a>[<a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a>],
<a name="l674"><span class="linenum"> 674</span></a>                      'from_User'            =&gt; <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a>,
<a name="l675"><span class="linenum"> 675</span></a>                  );
<a name="l676"><span class="linenum"> 676</span></a>              <a class="var it1702" onMouseOver="hilite(1702)" onMouseOut="lolite()" onClick="logVariable('notify_User')" href="../../../_variables/notify_User.html">$notify_User</a> = <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_ID( <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a> );
<a name="l677"><span class="linenum"> 677</span></a>  <span class="comment">            // Change locale here to localize the email subject and content</span>
<a name="l678"><span class="linenum"> 678</span></a>              <a class="function" onClick="logFunction('locale_temp_switch')" href="../../../_functions/locale_temp_switch.html" onMouseOver="funcPopup(event,'locale_temp_switch')">locale_temp_switch</a>( <a class="var it1702" onMouseOver="hilite(1702)" onMouseOut="lolite()" onClick="logVariable('notify_User')" href="../../../_variables/notify_User.html">$notify_User</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'locale' ) );
<a name="l679"><span class="linenum"> 679</span></a>              <a class="var it4741" onMouseOver="hilite(4741)" onMouseOut="lolite()" onClick="logVariable('sender_login')" href="../../../_variables/sender_login.html">$sender_login</a> = ( <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a> === NULL ) ? <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('login')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a> : <a class="var it3356" onMouseOver="hilite(3356)" onMouseOut="lolite()" onClick="logVariable('from_User')" href="../../../_variables/from_User.html">$from_User</a>-&gt;<a onClick="logVariable('login')" class="var it10724" onMouseOver="hilite(10724)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l680"><span class="linenum"> 680</span></a>              <a class="var it3221" onMouseOver="hilite(3221)" onMouseOut="lolite()" onClick="logVariable('localized_subject')" href="../../../_variables/localized_subject.html">$localized_subject</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( <a class="var it60" onMouseOver="hilite(60)" onMouseOut="lolite()" onClick="logVariable('subject')" href="../../../_variables/subject.html">$subject</a> ), <a class="var it4741" onMouseOver="hilite(4741)" onMouseOut="lolite()" onClick="logVariable('sender_login')" href="../../../_variables/sender_login.html">$sender_login</a> );
<a name="l681"><span class="linenum"> 681</span></a>  <span class="comment">            // Note: Not activated users won't get notification email</span>
<a name="l682"><span class="linenum"> 682</span></a>              if( <a class="function" onClick="logFunction('send_mail_to_User')" href="../../../_functions/send_mail_to_user.html" onMouseOver="funcPopup(event,'send_mail_to_user')">send_mail_to_User</a>( <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a>, <a class="var it3221" onMouseOver="hilite(3221)" onMouseOut="lolite()" onClick="logVariable('localized_subject')" href="../../../_variables/localized_subject.html">$localized_subject</a>, 'private_message_new', <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> ) )
<a name="l683"><span class="linenum"> 683</span></a>              { // email sent successful, update las_unread_message_reminder timestamp, because the notification contains all unread messages
<a name="l684"><span class="linenum"> 684</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'last_unread_messages_reminder', <a class="function" onClick="logFunction('date2mysql')" href="../../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>( <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> ), <a class="var it4720" onMouseOver="hilite(4720)" onMouseOut="lolite()" onClick="logVariable('recipient_ID')" href="../../../_variables/recipient_ID.html">$recipient_ID</a> );
<a name="l685"><span class="linenum"> 685</span></a>              }
<a name="l686"><span class="linenum"> 686</span></a>              else
<a name="l687"><span class="linenum"> 687</span></a>              { // message was not sent
<a name="l688"><span class="linenum"> 688</span></a>                  <a class="var it1033" onMouseOver="hilite(1033)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../../_variables/ret.html">$ret</a> = false;
<a name="l689"><span class="linenum"> 689</span></a>              }
<a name="l690"><span class="linenum"> 690</span></a>              <a class="function" onClick="logFunction('locale_restore_previous')" href="../../../_functions/locale_restore_previous.html" onMouseOver="funcPopup(event,'locale_restore_previous')">locale_restore_previous</a>();
<a name="l691"><span class="linenum"> 691</span></a>          }
<a name="l692"><span class="linenum"> 692</span></a>  <span class="comment">        // update reminder timestamp changes</span>
<a name="l693"><span class="linenum"> 693</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l694"><span class="linenum"> 694</span></a>          return <a class="var it1033" onMouseOver="hilite(1033)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../../_variables/ret.html">$ret</a>;
<a name="l695"><span class="linenum"> 695</span></a>      }
<a name="l696"><span class="linenum"> 696</span></a>  
<a name="l697"><span class="linenum"> 697</span></a>  
<a name="l698"><span class="linenum"> 698</span></a>      <span class="comment">/**</span>
<a name="l699"><span class="linenum"> 699</span></a>  <span class="comment">     * Get the list of validated renderers for this Message. This includes stealth plugins etc.</span>
<a name="l700"><span class="linenum"> 700</span></a>  <span class="comment">     * @return array List of validated renderer codes</span>
<a name="l701"><span class="linenum"> 701</span></a>  <span class="comment">     */</span>
<a name="l702"><span class="linenum"> 702</span></a>  	function <a class="function" onClick="logFunction('get_renderers_validated')" href="../../../_functions/get_renderers_validated.html" onMouseOver="funcPopup(event,'get_renderers_validated')">get_renderers_validated</a>()
<a name="l703"><span class="linenum"> 703</span></a>      {
<a name="l704"><span class="linenum"> 704</span></a>          if( ! isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('renderers_validated')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/renderers_validated.html">renderers_validated</a> ) )
<a name="l705"><span class="linenum"> 705</span></a>          {
<a name="l706"><span class="linenum"> 706</span></a>              global <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>;
<a name="l707"><span class="linenum"> 707</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('renderers_validated')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/renderers_validated.html">renderers_validated</a> = <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('validate_renderer_list')" href="../../../_functions/validate_renderer_list.html" onMouseOver="funcPopup(event,'validate_renderer_list')">validate_renderer_list</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_renderers')" href="../../../_functions/get_renderers.html" onMouseOver="funcPopup(event,'get_renderers')">get_renderers</a>(), array( 'Message' =&gt; &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> ) );
<a name="l708"><span class="linenum"> 708</span></a>          }
<a name="l709"><span class="linenum"> 709</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('renderers_validated')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/renderers_validated.html">renderers_validated</a>;
<a name="l710"><span class="linenum"> 710</span></a>      }
<a name="l711"><span class="linenum"> 711</span></a>  
<a name="l712"><span class="linenum"> 712</span></a>  
<a name="l713"><span class="linenum"> 713</span></a>      <span class="comment">/**</span>
<a name="l714"><span class="linenum"> 714</span></a>  <span class="comment">     * Get the list of renderers for this Message.</span>
<a name="l715"><span class="linenum"> 715</span></a>  <span class="comment">     * @return array</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment">     */</span>
<a name="l717"><span class="linenum"> 717</span></a>  	function <a class="function" onClick="logFunction('get_renderers')" href="../../../_functions/get_renderers.html" onMouseOver="funcPopup(event,'get_renderers')">get_renderers</a>()
<a name="l718"><span class="linenum"> 718</span></a>      {
<a name="l719"><span class="linenum"> 719</span></a>          return <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( '.', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('renderers')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/renderers.html">renderers</a> );
<a name="l720"><span class="linenum"> 720</span></a>      }
<a name="l721"><span class="linenum"> 721</span></a>  
<a name="l722"><span class="linenum"> 722</span></a>  
<a name="l723"><span class="linenum"> 723</span></a>      <span class="comment">/**</span>
<a name="l724"><span class="linenum"> 724</span></a>  <span class="comment">     * Set the renderers of the Message.</span>
<a name="l725"><span class="linenum"> 725</span></a>  <span class="comment">     *</span>
<a name="l726"><span class="linenum"> 726</span></a>  <span class="comment">     * @param array List of renderer codes.</span>
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">     * @return boolean true, if it has been set; false if it has not changed</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment">     */</span>
<a name="l729"><span class="linenum"> 729</span></a>  	function <a class="function" onClick="logFunction('set_renderers')" href="../../../_functions/set_renderers.html" onMouseOver="funcPopup(event,'set_renderers')">set_renderers</a>( <a class="var it333" onMouseOver="hilite(333)" onMouseOut="lolite()" onClick="logVariable('renderers')" href="../../../_variables/renderers.html">$renderers</a> )
<a name="l730"><span class="linenum"> 730</span></a>      {
<a name="l731"><span class="linenum"> 731</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( 'renderers', 'string', <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( '.', <a class="var it333" onMouseOver="hilite(333)" onMouseOut="lolite()" onClick="logVariable('renderers')" href="../../../_variables/renderers.html">$renderers</a> ) );
<a name="l732"><span class="linenum"> 732</span></a>      }
<a name="l733"><span class="linenum"> 733</span></a>  
<a name="l734"><span class="linenum"> 734</span></a>  
<a name="l735"><span class="linenum"> 735</span></a>      <span class="comment">/**</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment">     * Get the prerendered content. If it has not been generated yet, it will.</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment">     *</span>
<a name="l738"><span class="linenum"> 738</span></a>  <span class="comment">     * NOTE: This calls {@link Message::dbupdate()}, if renderers get changed (from Plugin hook).</span>
<a name="l739"><span class="linenum"> 739</span></a>  <span class="comment">     *       (not for preview though)</span>
<a name="l740"><span class="linenum"> 740</span></a>  <span class="comment">     *</span>
<a name="l741"><span class="linenum"> 741</span></a>  <span class="comment">     * @param string Format, see {@link format_to_output()}.</span>
<a name="l742"><span class="linenum"> 742</span></a>  <span class="comment">     *        Only &quot;htmlbody&quot;, &quot;entityencoded&quot;, &quot;xml&quot; and &quot;text&quot; get cached.</span>
<a name="l743"><span class="linenum"> 743</span></a>  <span class="comment">     * @return string</span>
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment">     */</span>
<a name="l745"><span class="linenum"> 745</span></a>  	function <a class="function" onClick="logFunction('get_prerendered_content')" href="../../../_functions/get_prerendered_content.html" onMouseOver="funcPopup(event,'get_prerendered_content')">get_prerendered_content</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>  = 'htmlbody' )
<a name="l746"><span class="linenum"> 746</span></a>      {
<a name="l747"><span class="linenum"> 747</span></a>          global <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l748"><span class="linenum"> 748</span></a>  
<a name="l749"><span class="linenum"> 749</span></a>          <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('use_cache')" href="../../../_variables/use_cache.html">$use_cache</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>, array('htmlbody', 'entityencoded', 'xml', 'text') );
<a name="l750"><span class="linenum"> 750</span></a>          if( <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('use_cache')" href="../../../_variables/use_cache.html">$use_cache</a> )
<a name="l751"><span class="linenum"> 751</span></a>          { // the format/comment can be cached:
<a name="l752"><span class="linenum"> 752</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Thread();
<a name="l753"><span class="linenum"> 753</span></a>              <a class="var it4742" onMouseOver="hilite(4742)" onMouseOut="lolite()" onClick="logVariable('message_renderers')" href="../../../_variables/message_renderers.html">$message_renderers</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_renderers_validated')" href="../../../_functions/get_renderers_validated.html" onMouseOver="funcPopup(event,'get_renderers_validated')">get_renderers_validated</a>();
<a name="l754"><span class="linenum"> 754</span></a>              if( empty( <a class="var it4742" onMouseOver="hilite(4742)" onMouseOut="lolite()" onClick="logVariable('message_renderers')" href="../../../_variables/message_renderers.html">$message_renderers</a> ) )
<a name="l755"><span class="linenum"> 755</span></a>              {
<a name="l756"><span class="linenum"> 756</span></a>                  return <a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('text')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/text.html">text</a>, <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l757"><span class="linenum"> 757</span></a>              }
<a name="l758"><span class="linenum"> 758</span></a>              <a class="var it4742" onMouseOver="hilite(4742)" onMouseOut="lolite()" onClick="logVariable('message_renderers')" href="../../../_variables/message_renderers.html">$message_renderers</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( '.', <a class="var it4742" onMouseOver="hilite(4742)" onMouseOut="lolite()" onClick="logVariable('message_renderers')" href="../../../_variables/message_renderers.html">$message_renderers</a> );
<a name="l759"><span class="linenum"> 759</span></a>              <a class="var it1539" onMouseOver="hilite(1539)" onMouseOut="lolite()" onClick="logVariable('cache_key')" href="../../../_variables/cache_key.html">$cache_key</a> = <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>.'/'.<a class="var it4742" onMouseOver="hilite(4742)" onMouseOut="lolite()" onClick="logVariable('message_renderers')" href="../../../_variables/message_renderers.html">$message_renderers</a>;
<a name="l760"><span class="linenum"> 760</span></a>  
<a name="l761"><span class="linenum"> 761</span></a>              <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a> = &amp; get_MessagePrerenderingCache();
<a name="l762"><span class="linenum"> 762</span></a>  
<a name="l763"><span class="linenum"> 763</span></a>              if( isset( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>][<a class="var it1539" onMouseOver="hilite(1539)" onMouseOut="lolite()" onClick="logVariable('cache_key')" href="../../../_variables/cache_key.html">$cache_key</a>] ) )
<a name="l764"><span class="linenum"> 764</span></a>              { // already in PHP cache.
<a name="l765"><span class="linenum"> 765</span></a>                  <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>][<a class="var it1539" onMouseOver="hilite(1539)" onMouseOut="lolite()" onClick="logVariable('cache_key')" href="../../../_variables/cache_key.html">$cache_key</a>];
<a name="l766"><span class="linenum"> 766</span></a>  <span class="comment">                // Save memory, typically only accessed once.</span>
<a name="l767"><span class="linenum"> 767</span></a>                  unset( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>][<a class="var it1539" onMouseOver="hilite(1539)" onMouseOut="lolite()" onClick="logVariable('cache_key')" href="../../../_variables/cache_key.html">$cache_key</a>] );
<a name="l768"><span class="linenum"> 768</span></a>              }
<a name="l769"><span class="linenum"> 769</span></a>              else
<a name="l770"><span class="linenum"> 770</span></a>              { // try loading into Cache
<a name="l771"><span class="linenum"> 771</span></a>                  if( ! isset( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>] ) )
<a name="l772"><span class="linenum"> 772</span></a>                  { // only do the prefetch loading once.
<a name="l773"><span class="linenum"> 773</span></a>                      <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>] = array();
<a name="l774"><span class="linenum"> 774</span></a>  
<a name="l775"><span class="linenum"> 775</span></a>                      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l776"><span class="linenum"> 776</span></a>                      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'mspr_msg_ID, mspr_format, mspr_renderers, mspr_content_prerendered' );
<a name="l777"><span class="linenum"> 777</span></a>                      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__prerendering' );
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment">                    // load prerendered cache for each message which belongs to this messages Thread</span>
<a name="l779"><span class="linenum"> 779</span></a>                      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_messaging__message ON mspr_msg_ID = msg_ID' );
<a name="l780"><span class="linenum"> 780</span></a>                      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'msg_thread_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Thread')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;ID );
<a name="l781"><span class="linenum"> 781</span></a>                      <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'mspr_format = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> ) );
<a name="l782"><span class="linenum"> 782</span></a>                      <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../../_variables/rows.html">$rows</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>(), <a class="constant" onClick="logConstant('OBJECT')" href="../../../_constants/OBJECT.html" onMouseOver="constPopup(event,'OBJECT')">OBJECT</a>, 'Preload prerendered messages <a class="function" onClick="logFunction('content')" href="../../../_functions/content.html" onMouseOver="funcPopup(event,'content')">content</a> ('.<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>.')' );
<a name="l783"><span class="linenum"> 783</span></a>                      foreach( <a class="var it191" onMouseOver="hilite(191)" onMouseOut="lolite()" onClick="logVariable('rows')" href="../../../_variables/rows.html">$rows</a> as <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> )
<a name="l784"><span class="linenum"> 784</span></a>                      {
<a name="l785"><span class="linenum"> 785</span></a>                          <a class="var it1543" onMouseOver="hilite(1543)" onMouseOut="lolite()" onClick="logVariable('row_cache_key')" href="../../../_variables/row_cache_key.html">$row_cache_key</a> = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mspr_format')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mspr_format.html">mspr_format</a>.'/'.<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mspr_renderers')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mspr_renderers.html">mspr_renderers</a>;
<a name="l786"><span class="linenum"> 786</span></a>  
<a name="l787"><span class="linenum"> 787</span></a>                          if( ! isset( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mspr_msg_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mspr_msg_ID.html">mspr_msg_ID</a>] ) )
<a name="l788"><span class="linenum"> 788</span></a>                          { // init list
<a name="l789"><span class="linenum"> 789</span></a>                              <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mspr_msg_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mspr_msg_ID.html">mspr_msg_ID</a>] = array();
<a name="l790"><span class="linenum"> 790</span></a>                          }
<a name="l791"><span class="linenum"> 791</span></a>  
<a name="l792"><span class="linenum"> 792</span></a>                          <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mspr_msg_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mspr_msg_ID.html">mspr_msg_ID</a>][<a class="var it1543" onMouseOver="hilite(1543)" onMouseOut="lolite()" onClick="logVariable('row_cache_key')" href="../../../_variables/row_cache_key.html">$row_cache_key</a>] = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('mspr_content_prerendered')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/mspr_content_prerendered.html">mspr_content_prerendered</a>;
<a name="l793"><span class="linenum"> 793</span></a>                      }
<a name="l794"><span class="linenum"> 794</span></a>  
<a name="l795"><span class="linenum"> 795</span></a>  <span class="comment">                    // Get the value for current Comment.</span>
<a name="l796"><span class="linenum"> 796</span></a>                      if( isset( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>][<a class="var it1539" onMouseOver="hilite(1539)" onMouseOut="lolite()" onClick="logVariable('cache_key')" href="../../../_variables/cache_key.html">$cache_key</a>] ) )
<a name="l797"><span class="linenum"> 797</span></a>                      {
<a name="l798"><span class="linenum"> 798</span></a>                          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>][<a class="var it1539" onMouseOver="hilite(1539)" onMouseOut="lolite()" onClick="logVariable('cache_key')" href="../../../_variables/cache_key.html">$cache_key</a>];
<a name="l799"><span class="linenum"> 799</span></a>  <span class="comment">                        // Save memory, typically only accessed once.</span>
<a name="l800"><span class="linenum"> 800</span></a>                          unset( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>][<a class="var it1539" onMouseOver="hilite(1539)" onMouseOut="lolite()" onClick="logVariable('cache_key')" href="../../../_variables/cache_key.html">$cache_key</a>] );
<a name="l801"><span class="linenum"> 801</span></a>                      }
<a name="l802"><span class="linenum"> 802</span></a>                  }
<a name="l803"><span class="linenum"> 803</span></a>              }
<a name="l804"><span class="linenum"> 804</span></a>          }
<a name="l805"><span class="linenum"> 805</span></a>  
<a name="l806"><span class="linenum"> 806</span></a>          if( !isset( <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> ) )
<a name="l807"><span class="linenum"> 807</span></a>          {
<a name="l808"><span class="linenum"> 808</span></a>              <a class="var it92" onMouseOver="hilite(92)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('text')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/text.html">text</a>;
<a name="l809"><span class="linenum"> 809</span></a>              <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('trigger_event')" href="../../../_functions/trigger_event.html" onMouseOver="funcPopup(event,'trigger_event')">trigger_event</a>( 'FilterMsgContent', array( 'data' =&gt; &amp; <a class="var it92" onMouseOver="hilite(92)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>, 'Message' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> ) );
<a name="l810"><span class="linenum"> 810</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="var it92" onMouseOver="hilite(92)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>, <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l811"><span class="linenum"> 811</span></a>  
<a name="l812"><span class="linenum"> 812</span></a>              if( <a class="var it1540" onMouseOver="hilite(1540)" onMouseOut="lolite()" onClick="logVariable('use_cache')" href="../../../_variables/use_cache.html">$use_cache</a> )
<a name="l813"><span class="linenum"> 813</span></a>              { // save into DB (using REPLACE INTO because it may have been pre-rendered by another thread since the SELECT above)
<a name="l814"><span class="linenum"> 814</span></a>                  global <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l815"><span class="linenum"> 815</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_messaging__prerendering ( mspr_msg_ID, mspr_format, mspr_renderers, mspr_content_prerendered, mspr_datemodified )
<a name="l816"><span class="linenum"> 816</span></a>                       VALUES ( '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4742" onMouseOver="hilite(4742)" onMouseOut="lolite()" onClick="logVariable('message_renderers')" href="../../../_variables/message_renderers.html">$message_renderers</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="function" onClick="logFunction('date2mysql')" href="../../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>( <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> ) ).' )', 'Cache prerendered message content' );
<a name="l817"><span class="linenum"> 817</span></a>              }
<a name="l818"><span class="linenum"> 818</span></a>          }
<a name="l819"><span class="linenum"> 819</span></a>  
<a name="l820"><span class="linenum"> 820</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l821"><span class="linenum"> 821</span></a>      }
<a name="l822"><span class="linenum"> 822</span></a>  
<a name="l823"><span class="linenum"> 823</span></a>  
<a name="l824"><span class="linenum"> 824</span></a>      <span class="comment">/**</span>
<a name="l825"><span class="linenum"> 825</span></a>  <span class="comment">     * Unset any prerendered content for this message (in PHP cache).</span>
<a name="l826"><span class="linenum"> 826</span></a>  <span class="comment">     */</span>
<a name="l827"><span class="linenum"> 827</span></a>  	function <a class="function" onClick="logFunction('delete_prerendered_content')" href="../../../_functions/delete_prerendered_content.html" onMouseOver="funcPopup(event,'delete_prerendered_content')">delete_prerendered_content</a>()
<a name="l828"><span class="linenum"> 828</span></a>      {
<a name="l829"><span class="linenum"> 829</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l830"><span class="linenum"> 830</span></a>  
<a name="l831"><span class="linenum"> 831</span></a>  <span class="comment">        // Delete DB rows.</span>
<a name="l832"><span class="linenum"> 832</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_messaging__prerendering WHERE mspr_msg_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l833"><span class="linenum"> 833</span></a>  
<a name="l834"><span class="linenum"> 834</span></a>  <span class="comment">        // Delete cache.</span>
<a name="l835"><span class="linenum"> 835</span></a>          <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a> = &amp; get_MessagePrerenderingCache();
<a name="l836"><span class="linenum"> 836</span></a>          foreach( <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a> ) as <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> )
<a name="l837"><span class="linenum"> 837</span></a>          {
<a name="l838"><span class="linenum"> 838</span></a>              unset( <a class="var it1071" onMouseOver="hilite(1071)" onMouseOut="lolite()" onClick="logVariable('MessagePrerenderingCache')" href="../../../_variables/MessagePrerenderingCache.html">$MessagePrerenderingCache</a>[<a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a>][<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>] );
<a name="l839"><span class="linenum"> 839</span></a>          }
<a name="l840"><span class="linenum"> 840</span></a>      }
<a name="l841"><span class="linenum"> 841</span></a>  
<a name="l842"><span class="linenum"> 842</span></a>  
<a name="l843"><span class="linenum"> 843</span></a>      <span class="comment">/**</span>
<a name="l844"><span class="linenum"> 844</span></a>  <span class="comment">     * Template function: get content of message</span>
<a name="l845"><span class="linenum"> 845</span></a>  <span class="comment">     *</span>
<a name="l846"><span class="linenum"> 846</span></a>  <span class="comment">     * @param string Output format, see {@link format_to_output()}</span>
<a name="l847"><span class="linenum"> 847</span></a>  <span class="comment">     * @return string</span>
<a name="l848"><span class="linenum"> 848</span></a>  <span class="comment">     */</span>
<a name="l849"><span class="linenum"> 849</span></a>  	function <a class="function" onClick="logFunction('get_content')" href="../../../_functions/get_content.html" onMouseOver="funcPopup(event,'get_content')">get_content</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l850"><span class="linenum"> 850</span></a>      {
<a name="l851"><span class="linenum"> 851</span></a>          <span class="comment">/* yura&gt; This code was commented after we added new setting 'Allow html in messages content'</span>
<a name="l852"><span class="linenum"> 852</span></a>  <span class="comment">                 The preparing of message content is in Message::load_from_Request()</span>
<a name="l853"><span class="linenum"> 853</span></a>  <span class="comment"></span>
<a name="l854"><span class="linenum"> 854</span></a>  <span class="comment">        global $evo_charset;</span>
<a name="l855"><span class="linenum"> 855</span></a>  <span class="comment"></span>
<a name="l856"><span class="linenum"> 856</span></a>  <span class="comment">        // WARNING: the messages may contain MALICIOUS HTML and javascript snippets. They must ALWAYS be ESCAPED prior to display!</span>
<a name="l857"><span class="linenum"> 857</span></a>  <span class="comment">        $this-&gt;text = htmlentities( $this-&gt;text, ENT_COMPAT, $evo_charset );</span>
<a name="l858"><span class="linenum"> 858</span></a>  <span class="comment">        */</span>
<a name="l859"><span class="linenum"> 859</span></a>  
<a name="l860"><span class="linenum"> 860</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_prerendered_content')" href="../../../_functions/get_prerendered_content.html" onMouseOver="funcPopup(event,'get_prerendered_content')">get_prerendered_content</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l861"><span class="linenum"> 861</span></a>      }
<a name="l862"><span class="linenum"> 862</span></a>  }
<a name="l863"><span class="linenum"> 863</span></a>  
<a name="l864"><span class="linenum"> 864</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'get_content': ['get_content', 'Get a content of the uploaded file ', [['htsrv','quick_upload.php',66],['htsrv','quick_upload.php',163],['inc/messaging/model','_message.class.php',843],['inc/comments/model','_comment.class.php',2602]], 8],
'nt_': ['nt_', 'No Translation. Does nothing. ', [['conf','_locales.php',15]], 356],
'trigger_event': ['trigger_event', 'Call all plugins for a given event. ', [['inc/plugins/model','_plugins.class.php',817]], 130],
'from_add': ['from_add', 'Extends the FROM clause. ', [['inc/_core/model/db','_sql.class.php',226]], 200],
'load_list': ['load_list', 'Load a list of objects into the cache. ', [['inc/_core/model/dataobjects','_dataobjectcache.class.php',213]], 21],
'get': ['get', 'Get a member param by its name ', [['inc/items/model','_item.class.php',6187],['inc/_core/model/db','_sql.class.php',50],['inc/_core/model/dataobjects','_dataobject.class.php',834],['inc/plugins/model','_pluginusersettings.class.php',40],['inc/users/model','_user.class.php',1227],['rsc/js/tiny_mce/plugins/spellchecker/includes','Engine.php',145],['inc/settings/model','_abstractsettings.class.php',252],['inc/settings/model','_generalsettings.class.php',379],['inc/users/model','_usersettings.class.php',148],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',95],['inc/links/model','_linkcomment.class.php',150],['inc/links/model','_linkitem.class.php',205],['inc/sessions/model','_session.class.php',428],['inc/collections/model','_blog.class.php',1842],['inc/comments/model','_comment.class.php',386],['inc/cron/model','_cronjob.class.php',89],['inc/plugins/model','_pluginsettings.class.php',40],['inc/links/model','_linkowner.class.php',218],['plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['inc/slugs/model','_slug.class.php',68],['inc/users/model','_groupsettings.class.php',124],['inc/chapters/model','_chapter.class.php',600],['inc/antispam/model','_iprange.class.php',60],['inc/files/model','_file.class.php',555],['inc/links/model','_linkuser.class.php',154],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',165]], 2630],
'format_to_output': ['format_to_output', 'Format a string/content for being output ', [['inc/_core','_misc.funcs.php',264]], 318],
'get_results': ['get_results', 'Return the the query as a result set - see docs for more details ', [['inc/_core/model/db','_db.class.php',1083]], 152],
'rollback': ['rollback', 'Rollback current transaction ', [['inc/_core/model/db','_db.class.php',1625]], 48],
'set_param': ['set_param', 'Set the value of a param (by force! :P) ', [['inc/_core','_param.funcs.php',1678],['inc/_core/model/dataobjects','_dataobject.class.php',890]], 127],
'clone_message': ['clone_message', 'Clone current message and convert cloned message from \'individual\' to \'discussion\'. ', [['inc/messaging/model','_message.class.php',474]], 1],
'locale_temp_switch': ['locale_temp_switch', 'Template function: Temporarily switch to this post\'s locale or to current blog\'s locale depending on setting ', [['inc/items/model','_itemlight.class.php',919],['inc/locales','_locale.funcs.php',250]], 62],
'get_prerendered_content': ['get_prerendered_content', 'Get the prerendered content. If it has not been generated yet, it will. ', [['inc/items/model','_item.class.php',1452],['inc/messaging/model','_message.class.php',735],['inc/comments/model','_comment.class.php',2490]], 7],
'param_check_html': ['param_check_html', 'Checks for sanitized code. ', [['inc/_core','_param.funcs.php',2080]], 12],
'send_email_notifications': ['send_email_notifications', 'Send email notifications to subscribed users ', [['inc/items/model','_item.class.php',5980],['inc/messaging/model','_message.class.php',608],['inc/comments/model','_comment.class.php',3369]], 7],
'get_users_unread_threads': ['get_users_unread_threads', 'Get all those user threads and their recipients where the corresponding users have unread messages. This function is used for the different email notifications. ', [['inc/messaging/model','_messaging.funcs.php',478]], 3],
'locale_restore_previous': ['locale_restore_previous', 'Restore the locale in use before the switch ', [['inc/locales','_locale.funcs.php',281]], 61],
'dbinsert_contacts': ['dbinsert_contacts', 'Insert contacts into database ', [['inc/messaging/model','_message.class.php',362]], 2],
'db_delete_where': ['db_delete_where', 'Delete the given class objects from the database which corresponds to the given condition or to the given ids array This function must be overriden on those classes where the db delete requires some updates on other table content or some files/folders delete. Note: the delete cascade arrays are handled! Delete cascades are handled recursively only if the cascade arrays from the reffering class contains the class and class_path params ( e.g. see User class )! ', [['inc/_core/model/dataobjects','_dataobject.class.php',175],['inc/users/model','_user.class.php',3308],['inc/messaging/model','_message.class.php',503],['inc/sessions/model','_session.class.php',281],['inc/comments/model','_comment.class.php',290]], 11],
'dataobject': ['dataobject', 'Constructor ', [['inc/_core/model/dataobjects','_dataobject.class.php',65]], 35],
'where_and': ['where_and', 'Extends the WHERE clause with AND ', [['inc/_core/model/db','_sql.class.php',247]], 369],
'get_param': ['get_param', 'Get the value of a param. ', [['inc/_core','_param.funcs.php',1694],['inc/widgets/model','_widget.class.php',343]], 340],
'set': ['set', 'Set param value ', [['inc/items/model','_item.class.php',4909],['inc/tools/model','_emailaddress.class.php',76],['inc/_core/model/dataobjects','_dataobject.class.php',874],['inc/plugins/model','_pluginusersettings.class.php',64],['inc/regional/model','_country.class.php',94],['inc/users/model','_user.class.php',2059],['inc/settings/model','_abstractsettings.class.php',427],['inc/messaging/model','_thread.class.php',211],['inc/regional/model','_subregion.class.php',107],['inc/users/model','_usersettings.class.php',184],['plugins','_calendar.plugin.php',613],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',81],['inc/files/model','_filetype.class.php',128],['inc/sessions/model','_session.class.php',451],['inc/collections/model','_blog.class.php',1104],['inc/comments/model','_comment.class.php',400],['inc/cron/model','_cronjob.class.php',64],['inc/plugins/model','_pluginsettings.class.php',52],['inc/users/model','_userfield.class.php',257],['inc/regional/model','_city.class.php',98],['inc/slugs/model','_slug.class.php',80],['inc/users/model','_group.class.php',212],['inc/regional/model','_currency.class.php',84],['inc/widgets/model','_widget.class.php',369],['inc/regional/model','_region.class.php',90],['inc/users/model','_groupsettings.class.php',140],['inc/chapters/model','_chapter.class.php',809],['inc/antispam/model','_iprange.class.php',72],['inc/items/model','_itemtag.class.php',61],['inc/sessions/model','_goal.class.php',201],['inc/items/model','_itemlight.class.php',1328],['inc/users/model','_userfieldgroup.class.php',83],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',148]], 1238],
'get_messages_link_to': ['get_messages_link_to', 'Get messaging urls for the messaging notification emails ', [['inc/messaging/model','_messaging.funcs.php',308]], 2],
'dbdelete': ['dbdelete', 'Trigger event AfterItemDelete after calling parent method. ', [['inc/items/model','_item.class.php',5506],['inc/_core/model/dataobjects','_dataobject.class.php',591],['inc/users/model','_user.class.php',3376],['inc/messaging/model','_message.class.php',582],['inc/messaging/model','_thread.class.php',444],['inc/items/model','_itemtype.class.php',451],['inc/files/model','_filetype.class.php',271],['inc/collections/model','_blog.class.php',2664],['inc/comments/model','_comment.class.php',3872],['inc/users/model','_group.class.php',497]], 62],
'where': ['where', '', [['inc/_core/model/db','_sql.class.php',242]], 288],
'param_error': ['param_error', 'Add an error for a variable, either to the Form\'s field and/or the global {@link $Messages} object. ', [['inc/_core','_param.funcs.php',1524]], 148],
'commit': ['commit', 'For any bytes that are currently buffered inside the stream, force them off the buffer. ', [['inc/_ext/swift/classes/Swift/ByteStream','AbstractFilterableInputStream.php',97],['inc/_ext/swift/classes/Swift/Signers','DKIMSigner.php',223],['inc/_ext/swift/classes/Swift/ByteStream','ArrayByteStream.php',116],['inc/_ext/swift/classes/Swift/Plugins','BandwidthMonitorPlugin.php',90],['inc/_ext/swift/classes/Swift','InputByteStream.php',41],['inc/_ext/swift/classes/Swift/Signers','DomainKeySigner.php',178],['inc/_ext/swift/classes/Swift/KeyCache','SimpleKeyCacheInputStream.php',71],['inc/_core/model/db','_db.class.php',1589]], 135],
'get_renderers_validated': ['get_renderers_validated', 'Get the list of validated renderers for this Item. This includes stealth plugins etc. ', [['inc/items/model','_item.class.php',6281],['inc/messaging/model','_message.class.php',698],['inc/comments/model','_comment.class.php',2922]], 30],
'get_var': ['get_var', 'Get one variable from the DB - see docs for more detail ', [['inc/_core/model/db','_db.class.php',952]], 166],
'get_col': ['get_col', 'Function to get 1 column from the cached result set based on X index see docs for usage and info ', [['inc/_core/model/db','_db.class.php',1032]], 117],
'from': ['from', '', [['inc/_core/model/db','_sql.class.php',221]], 513],
'dbinsert_threadstatus': ['dbinsert_threadstatus', 'Insert recipients into database ', [['inc/messaging/model','_message.class.php',339]], 1],
'get_renderers': ['get_renderers', 'Get the list of renderers for this Item. ', [['inc/items/model','_item.class.php',6271],['inc/messaging/model','_message.class.php',713],['inc/comments/model','_comment.class.php',2937]], 8],
't_': ['t_', 'Provide translation in the context of this module: ', [['inc/_core/model','_module.class.php',67],['rsc/js','blog_widgets.js',467],['inc/skins/model','_skin.class.php',1131],['inc/plugins','_plugin.class.php',2799],['inc/locales','_locale.funcs.php',29],['inc/locales','_locale.funcs.php',226]], 12118],
'dbinsert_discussion': ['dbinsert_discussion', '', [['inc/messaging/model','_message.class.php',224]], 2],
'dbinsert': ['dbinsert', 'Insert object into DB based on previously recorded changes ', [['inc/items/model','_item.class.php',5108],['inc/_core/model/dataobjects','_dataobject.class.php',470],['inc/users/model','_user.class.php',3187],['inc/skins/model','_skin.class.php',438],['inc/items/model','_itemtype.class.php',405],['inc/files/model','_filetype.class.php',213],['inc/tools/model','_syslog.class.php',58],['inc/collections/model','_blog.class.php',2272],['inc/comments/model','_comment.class.php',3815],['inc/users/model','_group.class.php',459],['inc/widgets/model','_widget.class.php',829],['inc/chapters/model','_chapter.class.php',532],['inc/files/model','_file.class.php',1784]], 99],
'delete_prerendered_content': ['delete_prerendered_content', 'Unset any prerendered content for this item (in PHP cache). ', [['inc/items/model','_item.class.php',1606],['inc/messaging/model','_message.class.php',824],['inc/comments/model','_comment.class.php',2583]], 2],
'param_errors_detected': ['param_errors_detected', 'Check if there have been validation errors ', [['inc/_core','_param.funcs.php',1480]], 61],
'load_from_request': ['load_from_request', 'Init filter params from Request params ', [['inc/items/model','_itemlistlight.class.php',324],['inc/items/model','_item.class.php',570],['inc/widgets/widgets','_coll_tag_cloud.widget.php',37],['inc/tools/model','_emailaddress.class.php',90],['inc/email_campaigns/model','_emailcampaign.class.php',186],['inc/maintenance/model','_backup.class.php',159],['inc/items/model','_itemstatus.class.php',63],['inc/sessions/model','_domain.class.php',54],['inc/regional/model','_country.class.php',70],['inc/users/model','_user.class.php',341],['inc/skins/model','_skin.class.php',158],['inc/comments/model','_commentlist.class.php',253],['inc/messaging/model','_message.class.php',124],['inc/users/model','_userlist.class.php',260],['inc/messaging/model','_thread.class.php',186],['inc/items/model','_itemtype.class.php',148],['inc/regional/model','_subregion.class.php',78],['inc/files/model','_filetype.class.php',61],['inc/collections/model','_blog.class.php',375],['inc/cron/model','_cronjob.class.php',107],['inc/users/model','_userfield.class.php',172],['inc/regional/model','_city.class.php',68],['inc/slugs/model','_slug.class.php',94],['inc/users/model','_group.class.php',122],['inc/users/model','_invitation.class.php',69],['inc/regional/model','_currency.class.php',62],['inc/widgets/model','_widget.class.php',138],['inc/regional/model','_region.class.php',66],['inc/chapters/model','_chapter.class.php',286],['inc/antispam/model','_iprange.class.php',86],['inc/sessions/model','_goalcat.class.php',59],['inc/items/model','_itemtag.class.php',75],['inc/sessions/model','_goal.class.php',112],['inc/users/model','_userfieldgroup.class.php',64],['inc/users/model','_organization.class.php',67]], 82],
'set_renderers': ['set_renderers', 'Set the renderers of the Item. ', [['inc/items/model','_item.class.php',4975],['inc/messaging/model','_message.class.php',723],['inc/comments/model','_comment.class.php',2947]], 12],
'get_delete_cascades': ['get_delete_cascades', 'Get delete cascade settings ', [['inc/email_campaigns/model','_emailcampaign.class.php',71],['inc/_core/model/dataobjects','_dataobject.class.php',152],['inc/users/model','_user.class.php',278],['inc/skins/model','_skin.class.php',95],['inc/messaging/model','_message.class.php',111],['inc/messaging/model','_thread.class.php',171],['inc/items/model','_itemtype.class.php',134],['inc/collections/model','_blog.class.php',190],['inc/comments/model','_comment.class.php',274],['inc/users/model','_userfield.class.php',74],['inc/links/model','_link.class.php',108],['inc/items/model','_itemtag.class.php',48],['inc/sessions/model','_goal.class.php',62],['inc/items/model','_itemlight.class.php',175]], 1],
'param': ['param', 'Sets a parameter with values from the request or to provided default, except if param is already set! ', [['inc/_core','_param.funcs.php',35]], 2141],
'load_recipients': ['load_recipients', 'Load recipients of the current thread ', [['inc/messaging/model','_thread.class.php',455]], 5],
'send_mail_to_user': ['send_mail_to_user', 'Sends an email to User ', [['inc/_core','_misc.funcs.php',3584]], 14],
'dbinsert_individual': ['dbinsert_individual', 'Insert new thread for each recipient ', [['inc/messaging/model','_message.class.php',261]], 3],
'begin': ['begin', 'BEGIN A TRANSCATION ', [['inc/_core/model/db','_db.class.php',1537]], 114],
'dbinsert_message': ['dbinsert_message', 'Insert message in existing thread ', [['inc/messaging/model','_message.class.php',285]], 1],
'check_allow_reply': ['check_allow_reply', 'Check if current User is allowed to reply on this thread. Users are allowed to reply only to those threads where they are involved and there is at least one user between the recipients who didn\'t block the User. Note: Currently it doesn\'t matter if the sender is in the recipients user\'s contact list or not except in that case when the sender is blocked. ', [['inc/messaging/model','_thread.class.php',508]], 1],
'validate_renderer_list': ['validate_renderer_list', '', [['inc/plugins/model','_plugins.class.php',1909]], 10],
'dbupdate': ['dbupdate', 'Update the DB based on previously recorded changes ', [['inc/items/model','_item.class.php',5287],['inc/_core/model/dataobjects','_dataobject.class.php',386],['inc/users/model','_user.class.php',3249],['inc/skins/model','_skin.class.php',416],['inc/settings/model','_abstractsettings.class.php',575],['inc/items/model','_itemtype.class.php',433],['inc/files/model','_filetype.class.php',242],['inc/collections/model','_blog.class.php',2630],['inc/comments/model','_comment.class.php',3747],['inc/cron/model','_cronjob.class.php',188],['inc/slugs/model','_slug.class.php',265],['inc/users/model','_group.class.php',478],['inc/widgets/model','_widget.class.php',861],['inc/users/model','_groupsettings.class.php',159],['inc/chapters/model','_chapter.class.php',564],['inc/files/model','_file.class.php',1825]], 289],
'date2mysql': ['date2mysql', 'Convert timestamp to MySQL/ISO format. ', [['inc/_core','_misc.funcs.php',1226]], 63],
'load_class': ['load_class', 'In PHP4, this really loads the class. In PHP5, it\'s smarter than that: It only registers the class & file name so that __autoload() can later load the class IF and ONLY IF the class is actually needed during execution. ', [['inc/_core','_class5.funcs.php',64],['inc/_core','_class4.funcs.php',19]], 435],
'check_perm': ['check_perm', 'Check module permission ', [['inc/_core/model','_module.class.php',234],['inc/users/model','_user.class.php',2234],['inc/messaging/model','_message.class.php',595],['inc/messaging/model','_thread.class.php',482],['inc/links/model','_linkcomment.class.php',49],['inc/links/model','_linkitem.class.php',50],['inc/users/model','_group.class.php',265],['inc/sessions/model','_goal.class.php',94],['inc/links/model','_linkuser.class.php',47]], 1082],
'dbupdate_last_contact_datetime': ['dbupdate_last_contact_datetime', 'Update last contact datetimes ', [['inc/messaging/model','_message.class.php',440]], 2],
'quote': ['quote', 'Quote a msgid/msgstr, preferrable with single quotes. ', [['inc/locales','_pofile.class.php',261],['inc/_core/model/db','_db.class.php',491]], 1085],
'order_by': ['order_by', '', [['inc/_core/model/db','_sql.class.php',321]], 85],
'param_check_not_empty': ['param_check_not_empty', '', [['inc/_core','_param.funcs.php',564]], 53],
'select': ['select', 'Set SELECT clause ', [['inc/_core/model/db','_sql.class.php',196],['inc/_core/ui/forms','_form.class.php',2189],['inc/_core/model/db','_db.class.php',454]], 475],
'list': ['list', '', [['rsc/js/bootstrap','typeahead.bundle.js',156]], 105],
'content': ['content', 'DEPRECATED ', [['inc/items/model','_item.class.php',1914],['inc/comments/model','_comment.class.php',2618]], 14],
'get_class_db_config': ['get_class_db_config', 'Get this class db table config params ', [['inc/_core/model/dataobjects','_dataobject.class.php',104],['inc/users/model','_user.class.php',231],['inc/messaging/model','_message.class.php',87],['inc/messaging/model','_thread.class.php',147],['inc/sessions/model','_session.class.php',259],['inc/comments/model','_comment.class.php',250],['inc/links/model','_link.class.php',84],['inc/chapters/model','_chapter.class.php',120],['inc/files/model','_file.class.php',250],['inc/items/model','_itemlight.class.php',199]], 7],
'debug_die': ['debug_die', 'Outputs Unexpected Error message. When in debug mode it also prints a backtrace. ', [['inc/_core','_misc.funcs.php',2523]], 225],
'query': ['query', 'Run Query: GET DATA ROWS *** HEAVY *** ', [['inc/items/model','_itemlist.class.php',249],['inc/items/model','_itemlistlight.class.php',742],['inc/comments/model','_commentlist.class.php',507],['inc/users/model','_userlist.class.php',511],['inc/_core/ui/results','_results.class.php',468],['inc/_core/model/db','_db.class.php',749]], 1144],
'message': ['message', 'Constructor ', [['inc/messaging/model','_message.class.php',61]], 22],
'get_assoc': ['get_assoc', 'Function to get the second column from the cached result indexed by the first column ', [['inc/_core/model/db','_db.class.php',1057]], 60],
'explode': ['explode', '', [], 263],
'max': ['max', '', [], 216],
'defined': ['defined', '', [], 962],
'is_null': ['is_null', '', [], 299],
'count': ['count', '', [], 928],
'html_entity_decode': ['html_entity_decode', '', [], 13],
'array_diff': ['array_diff', '', [], 31],
'date': ['date', '', [], 446],
'implode': ['implode', '', [], 571],
'array_unique': ['array_unique', '', [], 38],
'array_merge': ['array_merge', '', [], 702],
'array_keys': ['array_keys', '', [], 94],
'in_array': ['in_array', '', [], 417]};
CLASS_DATA={
'message': ['message', 'Message Class ', [['inc/messaging/model','_message.class.php',19]], 42],
'dataobject': ['dataobject', 'Data Object Base Class ', [['inc/_core/model/dataobjects','_dataobject.class.php',18]], 37],
'sql': ['sql', 'SQL class: help constructing queries ', [['inc/_core/model/db','_sql.class.php',17]], 334],
'thread': ['thread', 'Thread Class ', [['inc/messaging/model','_thread.class.php',19]], 35]};
CONST_DATA={
'EVO_MAIN_INIT': ['EVO_MAIN_INIT', '', [['install','index.php',26],['inc','_main.inc.php',36],['install','debug.php',22]], 912],
'OBJECT': ['OBJECT', '', [['inc/_core/model/db','_db.class.php',49]], 54]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Nov 21 22:13:19 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
