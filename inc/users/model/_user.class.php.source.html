<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /inc/users/model/_user.class.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Nov 21 22:13:19 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='inc/users/model';
filename='_user.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/inc/users/model/</a> -> <a href="_user.class.php.html">_user.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="_user.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="_user.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This file implements the User class.</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * This file is part of the evoCore framework - {@link http://evocore.net/}</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * See also {@link https://github.com/b2evolution/b2evolution}.</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> *</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * @license GNU GPL v2 - {@link http://b2evolution.net/about/gnu-gpl-license}</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> *</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> * @copyright (c)2003-2015 by Francois Planque - {@link http://fplanque.com/}</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * Parts of this file are copyright (c)2004-2006 by Daniel HAHLER - {@link http://thequod.de/contact}.</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> *</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * @package evocore</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> */</span>
<a name="l15"><span class="linenum">  15</span></a>  if( !<a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('EVO_MAIN_INIT')" href="../../../_constants/EVO_MAIN_INIT.html" onMouseOver="constPopup(event,'EVO_MAIN_INIT')">EVO_MAIN_INIT</a>') ) die( 'Please, do not access this page directly.' );
<a name="l16"><span class="linenum">  16</span></a>  
<a name="l17"><span class="linenum">  17</span></a>  
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment">// DEBUG: (Turn switch on or off to log debug info for specified category)</span>
<a name="l19"><span class="linenum">  19</span></a>  <a class="var it575" onMouseOver="hilite(575)" onMouseOut="lolite()" onClick="logVariable('GLOBALS')" href="../../../_variables/GLOBALS.html">$GLOBALS</a>['debug_perms'] = false;
<a name="l20"><span class="linenum">  20</span></a>  
<a name="l21"><span class="linenum">  21</span></a>  
<a name="l22"><span class="linenum">  22</span></a>  <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( '_core/model/dataobjects/_dataobject.class.php', 'DataObject' );
<a name="l23"><span class="linenum">  23</span></a>  
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment">/**</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * User Class</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> *</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * @package evocore</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> */</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('User')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">User</a> <span class="keyword">extends</span> <a class="class" onClick="logClass('DataObject')" href="../../../_classes/dataobject.html" onMouseOver="classPopup(event,'dataobject')">DataObject</a>
<a name="l30"><span class="linenum">  30</span></a>  {
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment">    //var $postcode;</span>
<a name="l32"><span class="linenum">  32</span></a>      var <a class="var it1130" onMouseOver="hilite(1130)" onMouseOut="lolite()" onClick="logVariable('age_min')" href="../../../_variables/age_min.html">$age_min</a>;
<a name="l33"><span class="linenum">  33</span></a>      var <a class="var it1131" onMouseOver="hilite(1131)" onMouseOut="lolite()" onClick="logVariable('age_max')" href="../../../_variables/age_max.html">$age_max</a>;
<a name="l34"><span class="linenum">  34</span></a>      var <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>;
<a name="l35"><span class="linenum">  35</span></a>      var <a class="var it3208" onMouseOver="hilite(3208)" onMouseOut="lolite()" onClick="logVariable('pass')" href="../../../_variables/pass.html">$pass</a>;
<a name="l36"><span class="linenum">  36</span></a>      var <a class="var it3838" onMouseOver="hilite(3838)" onMouseOut="lolite()" onClick="logVariable('salt')" href="../../../_variables/salt.html">$salt</a>;
<a name="l37"><span class="linenum">  37</span></a>      var <a class="var it1773" onMouseOver="hilite(1773)" onMouseOut="lolite()" onClick="logVariable('firstname')" href="../../../_variables/firstname.html">$firstname</a>;
<a name="l38"><span class="linenum">  38</span></a>      var <a class="var it2567" onMouseOver="hilite(2567)" onMouseOut="lolite()" onClick="logVariable('lastname')" href="../../../_variables/lastname.html">$lastname</a>;
<a name="l39"><span class="linenum">  39</span></a>      var <a class="var it2569" onMouseOver="hilite(2569)" onMouseOut="lolite()" onClick="logVariable('nickname')" href="../../../_variables/nickname.html">$nickname</a>;
<a name="l40"><span class="linenum">  40</span></a>      var <a class="var it29" onMouseOver="hilite(29)" onMouseOut="lolite()" onClick="logVariable('locale')" href="../../../_variables/locale.html">$locale</a>;
<a name="l41"><span class="linenum">  41</span></a>      var <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('email')" href="../../../_variables/email.html">$email</a>;
<a name="l42"><span class="linenum">  42</span></a>      var <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a>;
<a name="l43"><span class="linenum">  43</span></a>      var <a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('datecreated')" href="../../../_variables/datecreated.html">$datecreated</a>;
<a name="l44"><span class="linenum">  44</span></a>      var <a class="var it630" onMouseOver="hilite(630)" onMouseOut="lolite()" onClick="logVariable('lastseen_ts')" href="../../../_variables/lastseen_ts.html">$lastseen_ts</a>;
<a name="l45"><span class="linenum">  45</span></a>      var <a class="var it1250" onMouseOver="hilite(1250)" onMouseOut="lolite()" onClick="logVariable('level')" href="../../../_variables/level.html">$level</a>;
<a name="l46"><span class="linenum">  46</span></a>      var <a class="var it2561" onMouseOver="hilite(2561)" onMouseOut="lolite()" onClick="logVariable('avatar_file_ID')" href="../../../_variables/avatar_file_ID.html">$avatar_file_ID</a>;
<a name="l47"><span class="linenum">  47</span></a>      var <a class="var it3839" onMouseOver="hilite(3839)" onMouseOut="lolite()" onClick="logVariable('reg_ctry_ID')" href="../../../_variables/reg_ctry_ID.html">$reg_ctry_ID</a>;
<a name="l48"><span class="linenum">  48</span></a>      var <a class="var it1129" onMouseOver="hilite(1129)" onMouseOut="lolite()" onClick="logVariable('ctry_ID')" href="../../../_variables/ctry_ID.html">$ctry_ID</a>;
<a name="l49"><span class="linenum">  49</span></a>      var <a class="var it1128" onMouseOver="hilite(1128)" onMouseOut="lolite()" onClick="logVariable('rgn_ID')" href="../../../_variables/rgn_ID.html">$rgn_ID</a>;
<a name="l50"><span class="linenum">  50</span></a>      var <a class="var it1127" onMouseOver="hilite(1127)" onMouseOut="lolite()" onClick="logVariable('subrg_ID')" href="../../../_variables/subrg_ID.html">$subrg_ID</a>;
<a name="l51"><span class="linenum">  51</span></a>      var <a class="var it1126" onMouseOver="hilite(1126)" onMouseOut="lolite()" onClick="logVariable('city_ID')" href="../../../_variables/city_ID.html">$city_ID</a>;
<a name="l52"><span class="linenum">  52</span></a>      var <a class="var it22" onMouseOver="hilite(22)" onMouseOut="lolite()" onClick="logVariable('source')" href="../../../_variables/source.html">$source</a>;
<a name="l53"><span class="linenum">  53</span></a>      var <a class="var it569" onMouseOver="hilite(569)" onMouseOut="lolite()" onClick="logVariable('unsubscribe_key')" href="../../../_variables/unsubscribe_key.html">$unsubscribe_key</a>;
<a name="l54"><span class="linenum">  54</span></a>      var <a class="var it1774" onMouseOver="hilite(1774)" onMouseOut="lolite()" onClick="logVariable('gender')" href="../../../_variables/gender.html">$gender</a>;
<a name="l55"><span class="linenum">  55</span></a>      var <a class="var it3840" onMouseOver="hilite(3840)" onMouseOut="lolite()" onClick="logVariable('email_dom_ID')" href="../../../_variables/email_dom_ID.html">$email_dom_ID</a>;
<a name="l56"><span class="linenum">  56</span></a>      var <a class="var it3841" onMouseOver="hilite(3841)" onMouseOut="lolite()" onClick="logVariable('profileupdate_date')" href="../../../_variables/profileupdate_date.html">$profileupdate_date</a>;
<a name="l57"><span class="linenum">  57</span></a>  
<a name="l58"><span class="linenum">  58</span></a>      <span class="comment">/**</span>
<a name="l59"><span class="linenum">  59</span></a>  <span class="comment">     * User account status</span>
<a name="l60"><span class="linenum">  60</span></a>  <span class="comment">     *</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">     * 'new', 'activated', 'autoactivated', 'emailchanged', 'deactivated', 'failedactivation', 'closed'</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">     *</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     * @var string</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">     */</span>
<a name="l65"><span class="linenum">  65</span></a>      var <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a>;
<a name="l66"><span class="linenum">  66</span></a>  
<a name="l67"><span class="linenum">  67</span></a>      <span class="comment">/**</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">     * Number of posts by this user. Use get_num_posts() to access this (lazy filled).</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">     * @var array ( key = status name, value = number of posts with status, key = '' - total number with all statuses )</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">     * @access protected</span>
<a name="l71"><span class="linenum">  71</span></a>  <span class="comment">     */</span>
<a name="l72"><span class="linenum">  72</span></a>      var <a class="var it3842" onMouseOver="hilite(3842)" onMouseOut="lolite()" onClick="logVariable('_num_posts')" href="../../../_variables/_num_posts.html">$_num_posts</a>;
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>      <span class="comment">/**</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">     * Number of comments by this user. Use get_num_comments() to access this (lazy filled).</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">     * @var array  ( key = status name, value = number of comments with status, key = '' - total number with all statuses )</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">     * @access protected</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     */</span>
<a name="l79"><span class="linenum">  79</span></a>      var <a class="var it3843" onMouseOver="hilite(3843)" onMouseOut="lolite()" onClick="logVariable('_num_comments')" href="../../../_variables/_num_comments.html">$_num_comments</a>;
<a name="l80"><span class="linenum">  80</span></a>  
<a name="l81"><span class="linenum">  81</span></a>      <span class="comment">/**</span>
<a name="l82"><span class="linenum">  82</span></a>  <span class="comment">     * Number of files by this user. Use get_num_files() to access this (lazy filled).</span>
<a name="l83"><span class="linenum">  83</span></a>  <span class="comment">     * @var array  ( key = type, value = number of files with type )</span>
<a name="l84"><span class="linenum">  84</span></a>  <span class="comment">     * @access protected</span>
<a name="l85"><span class="linenum">  85</span></a>  <span class="comment">     */</span>
<a name="l86"><span class="linenum">  86</span></a>      var <a class="var it3844" onMouseOver="hilite(3844)" onMouseOut="lolite()" onClick="logVariable('_num_files')" href="../../../_variables/_num_files.html">$_num_files</a>;
<a name="l87"><span class="linenum">  87</span></a>  
<a name="l88"><span class="linenum">  88</span></a>      <span class="comment">/**</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     * The ID of the (primary, currently only) group of the user.</span>
<a name="l90"><span class="linenum">  90</span></a>  <span class="comment">     * @var integer</span>
<a name="l91"><span class="linenum">  91</span></a>  <span class="comment">     */</span>
<a name="l92"><span class="linenum">  92</span></a>      var <a class="var it433" onMouseOver="hilite(433)" onMouseOut="lolite()" onClick="logVariable('grp_ID')" href="../../../_variables/grp_ID.html">$grp_ID</a>;
<a name="l93"><span class="linenum">  93</span></a>  
<a name="l94"><span class="linenum">  94</span></a>      <span class="comment">/**</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">     * Reference to group</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment">     * @see User::get_Group()</span>
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">     * @var Group</span>
<a name="l98"><span class="linenum">  98</span></a>  <span class="comment">     * @access protected</span>
<a name="l99"><span class="linenum">  99</span></a>  <span class="comment">     */</span>
<a name="l100"><span class="linenum"> 100</span></a>      var <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a>;
<a name="l101"><span class="linenum"> 101</span></a>  
<a name="l102"><span class="linenum"> 102</span></a>      <span class="comment">/**</span>
<a name="l103"><span class="linenum"> 103</span></a>  <span class="comment">     * Country lazy filled</span>
<a name="l104"><span class="linenum"> 104</span></a>  <span class="comment">     *</span>
<a name="l105"><span class="linenum"> 105</span></a>  <span class="comment">     * @var country</span>
<a name="l106"><span class="linenum"> 106</span></a>  <span class="comment">     */</span>
<a name="l107"><span class="linenum"> 107</span></a>      var <a class="var it1728" onMouseOver="hilite(1728)" onMouseOut="lolite()" onClick="logVariable('Country')" href="../../../_variables/Country.html">$Country</a>;
<a name="l108"><span class="linenum"> 108</span></a>      var <a class="var it1729" onMouseOver="hilite(1729)" onMouseOut="lolite()" onClick="logVariable('Region')" href="../../../_variables/Region.html">$Region</a>;
<a name="l109"><span class="linenum"> 109</span></a>      var <a class="var it1730" onMouseOver="hilite(1730)" onMouseOut="lolite()" onClick="logVariable('Subregion')" href="../../../_variables/Subregion.html">$Subregion</a>;
<a name="l110"><span class="linenum"> 110</span></a>      var <a class="var it1732" onMouseOver="hilite(1732)" onMouseOut="lolite()" onClick="logVariable('City')" href="../../../_variables/City.html">$City</a>;
<a name="l111"><span class="linenum"> 111</span></a>  
<a name="l112"><span class="linenum"> 112</span></a>      <span class="comment">/**</span>
<a name="l113"><span class="linenum"> 113</span></a>  <span class="comment">     * Blog posts statuses permissions</span>
<a name="l114"><span class="linenum"> 114</span></a>  <span class="comment">     */</span>
<a name="l115"><span class="linenum"> 115</span></a>      var <a class="var it3845" onMouseOver="hilite(3845)" onMouseOut="lolite()" onClick="logVariable('blog_post_statuses')" href="../../../_variables/blog_post_statuses.html">$blog_post_statuses</a> = array();
<a name="l116"><span class="linenum"> 116</span></a>  
<a name="l117"><span class="linenum"> 117</span></a>      <span class="comment">/**</span>
<a name="l118"><span class="linenum"> 118</span></a>  <span class="comment">     * Cache for perms.</span>
<a name="l119"><span class="linenum"> 119</span></a>  <span class="comment">     * @access protected</span>
<a name="l120"><span class="linenum"> 120</span></a>  <span class="comment">     * @var array</span>
<a name="l121"><span class="linenum"> 121</span></a>  <span class="comment">     */</span>
<a name="l122"><span class="linenum"> 122</span></a>      var <a class="var it3846" onMouseOver="hilite(3846)" onMouseOut="lolite()" onClick="logVariable('cache_perms')" href="../../../_variables/cache_perms.html">$cache_perms</a> = array();
<a name="l123"><span class="linenum"> 123</span></a>  
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>      <span class="comment">/**</span>
<a name="l126"><span class="linenum"> 126</span></a>  <span class="comment">     * User fields</span>
<a name="l127"><span class="linenum"> 127</span></a>  <span class="comment">     */</span>
<a name="l128"><span class="linenum"> 128</span></a>      var <a class="var it1147" onMouseOver="hilite(1147)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../../_variables/userfields.html">$userfields</a> = array();
<a name="l129"><span class="linenum"> 129</span></a>      var <a class="var it3847" onMouseOver="hilite(3847)" onMouseOut="lolite()" onClick="logVariable('userfields_by_code')" href="../../../_variables/userfields_by_code.html">$userfields_by_code</a> = array();
<a name="l130"><span class="linenum"> 130</span></a>      var <a class="var it3848" onMouseOver="hilite(3848)" onMouseOut="lolite()" onClick="logVariable('userfields_by_type')" href="../../../_variables/userfields_by_type.html">$userfields_by_type</a> = array();
<a name="l131"><span class="linenum"> 131</span></a>      var <a class="var it3849" onMouseOver="hilite(3849)" onMouseOut="lolite()" onClick="logVariable('updated_fields')" href="../../../_variables/updated_fields.html">$updated_fields</a> = array();
<a name="l132"><span class="linenum"> 132</span></a>      var <a class="var it3850" onMouseOver="hilite(3850)" onMouseOut="lolite()" onClick="logVariable('new_fields')" href="../../../_variables/new_fields.html">$new_fields</a> = array();
<a name="l133"><span class="linenum"> 133</span></a>  
<a name="l134"><span class="linenum"> 134</span></a>      <span class="comment">/**</span>
<a name="l135"><span class="linenum"> 135</span></a>  <span class="comment">     * Userfield defs</span>
<a name="l136"><span class="linenum"> 136</span></a>  <span class="comment">     */</span>
<a name="l137"><span class="linenum"> 137</span></a>      var <a class="var it3851" onMouseOver="hilite(3851)" onMouseOut="lolite()" onClick="logVariable('userfield_defs')" href="../../../_variables/userfield_defs.html">$userfield_defs</a>;
<a name="l138"><span class="linenum"> 138</span></a>  
<a name="l139"><span class="linenum"> 139</span></a>      <span class="comment">/**</span>
<a name="l140"><span class="linenum"> 140</span></a>  <span class="comment">     * The previous values of significant fields which were changed and these changes should be notified.</span>
<a name="l141"><span class="linenum"> 141</span></a>  <span class="comment">     */</span>
<a name="l142"><span class="linenum"> 142</span></a>      var <a class="var it3852" onMouseOver="hilite(3852)" onMouseOut="lolite()" onClick="logVariable('significant_changed_values')" href="../../../_variables/significant_changed_values.html">$significant_changed_values</a> = array();
<a name="l143"><span class="linenum"> 143</span></a>  
<a name="l144"><span class="linenum"> 144</span></a>      <span class="comment">/**</span>
<a name="l145"><span class="linenum"> 145</span></a>  <span class="comment">     * Constructor</span>
<a name="l146"><span class="linenum"> 146</span></a>  <span class="comment">     *</span>
<a name="l147"><span class="linenum"> 147</span></a>  <span class="comment">     * @param object DB row</span>
<a name="l148"><span class="linenum"> 148</span></a>  <span class="comment">     */</span>
<a name="l149"><span class="linenum"> 149</span></a>  	function <a class="function" onClick="logFunction('User')" href="../../../_functions/user.html" onMouseOver="funcPopup(event,'user')">User</a>( <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a> = NULL )
<a name="l150"><span class="linenum"> 150</span></a>      {
<a name="l151"><span class="linenum"> 151</span></a>          global <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../../_variables/default_locale.html">$default_locale</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l152"><span class="linenum"> 152</span></a>  
<a name="l153"><span class="linenum"> 153</span></a>  <span class="comment">        // Call parent constructor:</span>
<a name="l154"><span class="linenum"> 154</span></a>          parent::<a class="function" onClick="logFunction('DataObject')" href="../../../_functions/dataobject.html" onMouseOver="funcPopup(event,'dataobject')">DataObject</a>( 'T_users', 'user_', 'user_ID' );
<a name="l155"><span class="linenum"> 155</span></a>  
<a name="l156"><span class="linenum"> 156</span></a>          if( <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a> == NULL )
<a name="l157"><span class="linenum"> 157</span></a>          { // Setting those object properties, which are not &quot;NULL&quot; in DB (MySQL strict mode):
<a name="l158"><span class="linenum"> 158</span></a>  
<a name="l159"><span class="linenum"> 159</span></a>  <span class="comment">            // echo 'Creating blank user';</span>
<a name="l160"><span class="linenum"> 160</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'login', 'login' );
<a name="l161"><span class="linenum"> 161</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_password')" href="../../../_functions/set_password.html" onMouseOver="funcPopup(event,'set_password')">set_password</a>( 'pass' );
<a name="l162"><span class="linenum"> 162</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'locale',
<a name="l163"><span class="linenum"> 163</span></a>                  isset( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a> )
<a name="l164"><span class="linenum"> 164</span></a>                      ? <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('default_locale') // TODO: (settings) use &quot;new users template setting&quot;
<a name="l165"><span class="linenum"> 165</span></a>                      : <a class="var it624" onMouseOver="hilite(624)" onMouseOut="lolite()" onClick="logVariable('default_locale')" href="../../../_variables/default_locale.html">$default_locale</a> );
<a name="l166"><span class="linenum"> 166</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'email', '' );    <span class="comment">// fp&gt; TODO: this is an invalid value. Saving the object without a valid email should fail! (actually: it should be fixed by providing a valid email)</span>
<a name="l167"><span class="linenum"> 167</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'level', isset( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a> ) ? <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('newusers_level') : 0 );
<a name="l168"><span class="linenum"> 168</span></a>              if( isset(<a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>) )
<a name="l169"><span class="linenum"> 169</span></a>              {
<a name="l170"><span class="linenum"> 170</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_datecreated')" href="../../../_functions/set_datecreated.html" onMouseOver="funcPopup(event,'set_datecreated')">set_datecreated</a>( <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> );
<a name="l171"><span class="linenum"> 171</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'profileupdate_date', <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> ) );
<a name="l172"><span class="linenum"> 172</span></a>              }
<a name="l173"><span class="linenum"> 173</span></a>              else
<a name="l174"><span class="linenum"> 174</span></a>              { // We don't know local time here!
<a name="l175"><span class="linenum"> 175</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_datecreated')" href="../../../_functions/set_datecreated.html" onMouseOver="funcPopup(event,'set_datecreated')">set_datecreated</a>( <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() );
<a name="l176"><span class="linenum"> 176</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'profileupdate_date', <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d', <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>() ) );
<a name="l177"><span class="linenum"> 177</span></a>              }
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>              if( isset( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a> ) )
<a name="l180"><span class="linenum"> 180</span></a>              { // Set Group for this user:
<a name="l181"><span class="linenum"> 181</span></a>                  <a class="var it422" onMouseOver="hilite(422)" onMouseOut="lolite()" onClick="logVariable('GroupCache')" href="../../../_variables/GroupCache.html">$GroupCache</a> = &amp; get_GroupCache();
<a name="l182"><span class="linenum"> 182</span></a>                  <a class="var it3853" onMouseOver="hilite(3853)" onMouseOut="lolite()" onClick="logVariable('new_user_Group')" href="../../../_variables/new_user_Group.html">$new_user_Group</a> = &amp; <a class="var it422" onMouseOver="hilite(422)" onMouseOut="lolite()" onClick="logVariable('GroupCache')" href="../../../_variables/GroupCache.html">$GroupCache</a>-&gt;get_by_ID( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'newusers_grp_ID' ) );
<a name="l183"><span class="linenum"> 183</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_Group')" href="../../../_functions/set_group.html" onMouseOver="funcPopup(event,'set_group')">set_Group</a>( <a class="var it3853" onMouseOver="hilite(3853)" onMouseOut="lolite()" onClick="logVariable('new_user_Group')" href="../../../_variables/new_user_Group.html">$new_user_Group</a> );
<a name="l184"><span class="linenum"> 184</span></a>  <span class="comment">                // set status for this user</span>
<a name="l185"><span class="linenum"> 185</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('newusers_mustvalidate') ? 'new' : 'autoactivated' );
<a name="l186"><span class="linenum"> 186</span></a>              }
<a name="l187"><span class="linenum"> 187</span></a>              else
<a name="l188"><span class="linenum"> 188</span></a>              {
<a name="l189"><span class="linenum"> 189</span></a>  <span class="comment">                // set status for this user</span>
<a name="l190"><span class="linenum"> 190</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', 'new' );
<a name="l191"><span class="linenum"> 191</span></a>              }
<a name="l192"><span class="linenum"> 192</span></a>  
<a name="l193"><span class="linenum"> 193</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'unsubscribe_key', <a class="function" onClick="logFunction('generate_random_key')" href="../../../_functions/generate_random_key.html" onMouseOver="funcPopup(event,'generate_random_key')">generate_random_key</a>() );
<a name="l194"><span class="linenum"> 194</span></a>          }
<a name="l195"><span class="linenum"> 195</span></a>          else
<a name="l196"><span class="linenum"> 196</span></a>          {
<a name="l197"><span class="linenum"> 197</span></a>  <span class="comment">            // echo 'Instanciating existing user';</span>
<a name="l198"><span class="linenum"> 198</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a>;
<a name="l199"><span class="linenum"> 199</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('age_min')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/age_min.html">age_min</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_age_min')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_age_min.html">user_age_min</a>;
<a name="l200"><span class="linenum"> 200</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('age_max')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/age_max.html">age_max</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_age_max')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_age_max.html">user_age_max</a>;
<a name="l201"><span class="linenum"> 201</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_login')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_login.html">user_login</a>;
<a name="l202"><span class="linenum"> 202</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pass')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/pass.html">pass</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_pass')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_pass.html">user_pass</a>;
<a name="l203"><span class="linenum"> 203</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('salt')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/salt.html">salt</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_salt')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_salt.html">user_salt</a>;
<a name="l204"><span class="linenum"> 204</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('firstname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/firstname.html">firstname</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_firstname')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_firstname.html">user_firstname</a>;
<a name="l205"><span class="linenum"> 205</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastname.html">lastname</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_lastname')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_lastname.html">user_lastname</a>;
<a name="l206"><span class="linenum"> 206</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('nickname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/nickname.html">nickname</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_nickname')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_nickname.html">user_nickname</a>;
<a name="l207"><span class="linenum"> 207</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('locale')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/locale.html">locale</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_locale')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_locale.html">user_locale</a>;
<a name="l208"><span class="linenum"> 208</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_email')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_email.html">user_email</a>;
<a name="l209"><span class="linenum"> 209</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_status')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_status.html">user_status</a>;
<a name="l210"><span class="linenum"> 210</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/url.html">url</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_url')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_url.html">user_url</a>;
<a name="l211"><span class="linenum"> 211</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('datecreated')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/datecreated.html">datecreated</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_created_datetime')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_created_datetime.html">user_created_datetime</a>;
<a name="l212"><span class="linenum"> 212</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastseen_ts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastseen_ts.html">lastseen_ts</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_lastseen_ts')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_lastseen_ts.html">user_lastseen_ts</a>;
<a name="l213"><span class="linenum"> 213</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('level')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/level.html">level</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_level')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_level.html">user_level</a>;
<a name="l214"><span class="linenum"> 214</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('unsubscribe_key')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/unsubscribe_key.html">unsubscribe_key</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_unsubscribe_key')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_unsubscribe_key.html">user_unsubscribe_key</a>;
<a name="l215"><span class="linenum"> 215</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gender')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/gender.html">gender</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_gender')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_gender.html">user_gender</a>;
<a name="l216"><span class="linenum"> 216</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('avatar_file_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/avatar_file_ID.html">avatar_file_ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_avatar_file_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_avatar_file_ID.html">user_avatar_file_ID</a>;
<a name="l217"><span class="linenum"> 217</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('reg_ctry_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/reg_ctry_ID.html">reg_ctry_ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_reg_ctry_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_reg_ctry_ID.html">user_reg_ctry_ID</a>;
<a name="l218"><span class="linenum"> 218</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_ctry_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_ctry_ID.html">user_ctry_ID</a>;
<a name="l219"><span class="linenum"> 219</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('rgn_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/rgn_ID.html">rgn_ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_rgn_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_rgn_ID.html">user_rgn_ID</a>;
<a name="l220"><span class="linenum"> 220</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('subrg_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/subrg_ID.html">subrg_ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_subrg_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_subrg_ID.html">user_subrg_ID</a>;
<a name="l221"><span class="linenum"> 221</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('city_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/city_ID.html">city_ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_city_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_city_ID.html">user_city_ID</a>;
<a name="l222"><span class="linenum"> 222</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('source')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/source.html">source</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_source')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_source.html">user_source</a>;
<a name="l223"><span class="linenum"> 223</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('profileupdate_date')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/profileupdate_date.html">profileupdate_date</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_profileupdate_date')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_profileupdate_date.html">user_profileupdate_date</a>;
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>  <span class="comment">            // Group for this user:</span>
<a name="l226"><span class="linenum"> 226</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/grp_ID.html">grp_ID</a> = <a class="var it1469" onMouseOver="hilite(1469)" onMouseOut="lolite()" onClick="logVariable('db_row')" href="../../../_variables/db_row.html">$db_row</a>-&gt;<a onClick="logVariable('user_grp_ID')" class="var it10674" onMouseOver="hilite(10674)" onMouseOut="lolite()" href="../../../_variables/user_grp_ID.html">user_grp_ID</a>;
<a name="l227"><span class="linenum"> 227</span></a>          }
<a name="l228"><span class="linenum"> 228</span></a>      }
<a name="l229"><span class="linenum"> 229</span></a>  
<a name="l230"><span class="linenum"> 230</span></a>  
<a name="l231"><span class="linenum"> 231</span></a>      <span class="comment">/**</span>
<a name="l232"><span class="linenum"> 232</span></a>  <span class="comment">     * Get this class db table config params</span>
<a name="l233"><span class="linenum"> 233</span></a>  <span class="comment">     *</span>
<a name="l234"><span class="linenum"> 234</span></a>  <span class="comment">     * @return array</span>
<a name="l235"><span class="linenum"> 235</span></a>  <span class="comment">     */</span>
<a name="l236"><span class="linenum"> 236</span></a>  	static function <a class="function" onClick="logFunction('get_class_db_config')" href="../../../_functions/get_class_db_config.html" onMouseOver="funcPopup(event,'get_class_db_config')">get_class_db_config</a>()
<a name="l237"><span class="linenum"> 237</span></a>      {
<a name="l238"><span class="linenum"> 238</span></a>          static <a class="var it3869" onMouseOver="hilite(3869)" onMouseOut="lolite()" onClick="logVariable('user_db_config')" href="../../../_variables/user_db_config.html">$user_db_config</a>;
<a name="l239"><span class="linenum"> 239</span></a>  
<a name="l240"><span class="linenum"> 240</span></a>          if( !isset( <a class="var it3869" onMouseOver="hilite(3869)" onMouseOut="lolite()" onClick="logVariable('user_db_config')" href="../../../_variables/user_db_config.html">$user_db_config</a> ) )
<a name="l241"><span class="linenum"> 241</span></a>          {
<a name="l242"><span class="linenum"> 242</span></a>              <a class="var it3869" onMouseOver="hilite(3869)" onMouseOut="lolite()" onClick="logVariable('user_db_config')" href="../../../_variables/user_db_config.html">$user_db_config</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( parent::<a class="function" onClick="logFunction('get_class_db_config')" href="../../../_functions/get_class_db_config.html" onMouseOver="funcPopup(event,'get_class_db_config')">get_class_db_config</a>(),
<a name="l243"><span class="linenum"> 243</span></a>                  array(
<a name="l244"><span class="linenum"> 244</span></a>                      'dbtablename'        =&gt; 'T_users',
<a name="l245"><span class="linenum"> 245</span></a>                      'dbprefix'           =&gt; 'user_',
<a name="l246"><span class="linenum"> 246</span></a>                      'dbIDname'           =&gt; 'user_ID',
<a name="l247"><span class="linenum"> 247</span></a>                  )
<a name="l248"><span class="linenum"> 248</span></a>              );
<a name="l249"><span class="linenum"> 249</span></a>          }
<a name="l250"><span class="linenum"> 250</span></a>  
<a name="l251"><span class="linenum"> 251</span></a>          return <a class="var it3869" onMouseOver="hilite(3869)" onMouseOut="lolite()" onClick="logVariable('user_db_config')" href="../../../_variables/user_db_config.html">$user_db_config</a>;
<a name="l252"><span class="linenum"> 252</span></a>      }
<a name="l253"><span class="linenum"> 253</span></a>  
<a name="l254"><span class="linenum"> 254</span></a>  
<a name="l255"><span class="linenum"> 255</span></a>      <span class="comment">/**</span>
<a name="l256"><span class="linenum"> 256</span></a>  <span class="comment">     * Get delete restriction settings</span>
<a name="l257"><span class="linenum"> 257</span></a>  <span class="comment">     *</span>
<a name="l258"><span class="linenum"> 258</span></a>  <span class="comment">     * @return array</span>
<a name="l259"><span class="linenum"> 259</span></a>  <span class="comment">     */</span>
<a name="l260"><span class="linenum"> 260</span></a>  	static function <a class="function" onClick="logFunction('get_delete_restrictions')" href="../../../_functions/get_delete_restrictions.html" onMouseOver="funcPopup(event,'get_delete_restrictions')">get_delete_restrictions</a>()
<a name="l261"><span class="linenum"> 261</span></a>      {
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">        // fp&gt; These settings should probably be merged with the global database description used by the installer/upgrader. However I'm not sure about how compelx plugins would be able to integrate then...</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">        // asimo&gt; Delete cascades and restrictions handling can't be handled globally in all circumstances because in a few places there is a logic behind the deletion:</span>
<a name="l264"><span class="linenum"> 264</span></a>  <span class="comment">        //        e.g. Delete user as spammer or simply delete the user</span>
<a name="l265"><span class="linenum"> 265</span></a>  <span class="comment">        // asimo&gt; For sure in those cases when the cascade has no condition it would be faster to handled in on the db level.</span>
<a name="l266"><span class="linenum"> 266</span></a>  <span class="comment">        //        The current db_delete_where solution handles the delete cascade generally and handle the speciel cases in the cascaded classes as well ( e.g. delete files )</span>
<a name="l267"><span class="linenum"> 267</span></a>          return array(
<a name="l268"><span class="linenum"> 268</span></a>                  array( 'table'=&gt;'T_blogs', 'fk'=&gt;'blog_owner_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d blogs owned by this user') ),
<a name="l269"><span class="linenum"> 269</span></a>  <span class="comment">                //array( 'table'=&gt;'T_items__item', 'fk'=&gt;'post_lastedit_user_ID', 'msg'=&gt;T_('%d posts last edited by this user') ),</span>
<a name="l270"><span class="linenum"> 270</span></a>                  array( 'table'=&gt;'T_items__item', 'fk'=&gt;'post_assigned_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d posts assigned to this user') ),
<a name="l271"><span class="linenum"> 271</span></a>  <span class="comment">                // Do not delete user private messages</span>
<a name="l272"><span class="linenum"> 272</span></a>  <span class="comment">                //array( 'table'=&gt;'T_messaging__message', 'fk'=&gt;'msg_author_user_ID', 'msg'=&gt;T_('The user has authored %d message(s)') ),</span>
<a name="l273"><span class="linenum"> 273</span></a>  <span class="comment">                //array( 'table'=&gt;'T_messaging__threadstatus', 'fk'=&gt;'tsta_user_ID', 'msg'=&gt;T_('The user is part of %d messaging thread(s)') ),</span>
<a name="l274"><span class="linenum"> 274</span></a>              );
<a name="l275"><span class="linenum"> 275</span></a>      }
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>  
<a name="l278"><span class="linenum"> 278</span></a>      <span class="comment">/**</span>
<a name="l279"><span class="linenum"> 279</span></a>  <span class="comment">     * Get delete cascade settings</span>
<a name="l280"><span class="linenum"> 280</span></a>  <span class="comment">     *</span>
<a name="l281"><span class="linenum"> 281</span></a>  <span class="comment">     * @return array</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">     */</span>
<a name="l283"><span class="linenum"> 283</span></a>  	static function <a class="function" onClick="logFunction('get_delete_cascades')" href="../../../_functions/get_delete_cascades.html" onMouseOver="funcPopup(event,'get_delete_cascades')">get_delete_cascades</a>()
<a name="l284"><span class="linenum"> 284</span></a>      {
<a name="l285"><span class="linenum"> 285</span></a>          return array(
<a name="l286"><span class="linenum"> 286</span></a>                  array( 'table'=&gt;'T_users__usersettings', 'fk'=&gt;'uset_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d user settings on collections') ),
<a name="l287"><span class="linenum"> 287</span></a>                  array( 'table'=&gt;'T_sessions', 'fk'=&gt;'sess_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d sessions opened by this user'),
<a name="l288"><span class="linenum"> 288</span></a>                          'class'=&gt;'Session', 'class_path'=&gt;'sessions/model/_session.class.php' ),
<a name="l289"><span class="linenum"> 289</span></a>                  array( 'table'=&gt;'T_coll_user_perms', 'fk'=&gt;'bloguser_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d user permissions on blogs') ),
<a name="l290"><span class="linenum"> 290</span></a>                  array( 'table'=&gt;'T_comments__votes', 'fk'=&gt;'cmvt_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d user votes on comments') ),
<a name="l291"><span class="linenum"> 291</span></a>                  array( 'table'=&gt;'T_subscriptions', 'fk'=&gt;'sub_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d blog subscriptions') ),
<a name="l292"><span class="linenum"> 292</span></a>                  array( 'table'=&gt;'T_items__item', 'fk'=&gt;'post_creator_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d posts created by this user'),
<a name="l293"><span class="linenum"> 293</span></a>                          'class'=&gt;'Item', 'class_path'=&gt;'items/model/_item.class.php' ),
<a name="l294"><span class="linenum"> 294</span></a>                  array( 'table'=&gt;'T_items__subscriptions', 'fk'=&gt;'isub_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d post subscriptions') ),
<a name="l295"><span class="linenum"> 295</span></a>                  array( 'table'=&gt;'T_messaging__contact', 'fk'=&gt;'mct_to_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d contacts from other users contact list') ),
<a name="l296"><span class="linenum"> 296</span></a>                  array( 'table'=&gt;'T_messaging__contact', 'fk'=&gt;'mct_from_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d contacts from this user contact list') ),
<a name="l297"><span class="linenum"> 297</span></a>                  array( 'table'=&gt;'T_messaging__contact_groups', 'fk'=&gt;'cgr_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d contact groups') ),
<a name="l298"><span class="linenum"> 298</span></a>                  array( 'table'=&gt;'T_messaging__contact_groupusers', 'fk'=&gt;'cgu_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d contacts from contact groups') ),
<a name="l299"><span class="linenum"> 299</span></a>                  array( 'table'=&gt;'T_pluginusersettings', 'fk'=&gt;'puset_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d user settings on plugins') ),
<a name="l300"><span class="linenum"> 300</span></a>                  array( 'table'=&gt;'T_users__fields', 'fk'=&gt;'uf_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d user fields') ),
<a name="l301"><span class="linenum"> 301</span></a>                  array( 'table'=&gt;'T_users__postreadstatus', 'fk'=&gt;'uprs_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d recordings of a post having been read') ),
<a name="l302"><span class="linenum"> 302</span></a>                  array( 'table'=&gt;'T_links', 'fk'=&gt;'link_usr_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d links to this user'),
<a name="l303"><span class="linenum"> 303</span></a>                          'class'=&gt;'Link', 'class_path'=&gt;'links/model/_link.class.php' ),
<a name="l304"><span class="linenum"> 304</span></a>                  array( 'table'=&gt;'T_files', 'fk'=&gt;'file_root_ID', 'and_condition'=&gt;'file_root_type = &quot;user&quot;', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d files from this user file root') ),
<a name="l305"><span class="linenum"> 305</span></a>                  array( 'table'=&gt;'T_email__campaign_send', 'fk'=&gt;'csnd_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d newsletter emails for this user') ),
<a name="l306"><span class="linenum"> 306</span></a>                  array( 'table'=&gt;'T_users__reports', 'fk'=&gt;'urep_target_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d reports about this user') ),
<a name="l307"><span class="linenum"> 307</span></a>                  array( 'table'=&gt;'T_users__reports', 'fk'=&gt;'urep_reporter_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d reports created by this user') ),
<a name="l308"><span class="linenum"> 308</span></a>                  array( 'table'=&gt;'T_users__user_org', 'fk'=&gt;'uorg_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d organization membership') ),
<a name="l309"><span class="linenum"> 309</span></a>              );
<a name="l310"><span class="linenum"> 310</span></a>      }
<a name="l311"><span class="linenum"> 311</span></a>  
<a name="l312"><span class="linenum"> 312</span></a>  
<a name="l313"><span class="linenum"> 313</span></a>      <span class="comment">/**</span>
<a name="l314"><span class="linenum"> 314</span></a>  <span class="comment">     * Initialize relations for restrict and cascade deletion.</span>
<a name="l315"><span class="linenum"> 315</span></a>  <span class="comment">     * Spammer user's deletion will cascade more items.</span>
<a name="l316"><span class="linenum"> 316</span></a>  <span class="comment">     *</span>
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">     * @param boolean Is this user spammer</span>
<a name="l318"><span class="linenum"> 318</span></a>  <span class="comment">     */</span>
<a name="l319"><span class="linenum"> 319</span></a>  	function <a class="function" onClick="logFunction('init_relations')" href="../../../_functions/init_relations.html" onMouseOver="funcPopup(event,'init_relations')">init_relations</a>( <a class="var it3870" onMouseOver="hilite(3870)" onMouseOut="lolite()" onClick="logVariable('is_spammer')" href="../../../_variables/is_spammer.html">$is_spammer</a> = false )
<a name="l320"><span class="linenum"> 320</span></a>      {
<a name="l321"><span class="linenum"> 321</span></a>          if( ! <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('delete_cascades')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/delete_cascades.html">delete_cascades</a> ) || ! <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('delete_restrictions')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/delete_restrictions.html">delete_restrictions</a> ) )
<a name="l322"><span class="linenum"> 322</span></a>          { // Initialize the relations only once
<a name="l323"><span class="linenum"> 323</span></a>              return;
<a name="l324"><span class="linenum"> 324</span></a>          }
<a name="l325"><span class="linenum"> 325</span></a>  
<a name="l326"><span class="linenum"> 326</span></a>          parent::<a class="function" onClick="logFunction('init_relations')" href="../../../_functions/init_relations.html" onMouseOver="funcPopup(event,'init_relations')">init_relations</a>();
<a name="l327"><span class="linenum"> 327</span></a>  
<a name="l328"><span class="linenum"> 328</span></a>          if( <a class="var it3870" onMouseOver="hilite(3870)" onMouseOut="lolite()" onClick="logVariable('is_spammer')" href="../../../_variables/is_spammer.html">$is_spammer</a> )
<a name="l329"><span class="linenum"> 329</span></a>          {
<a name="l330"><span class="linenum"> 330</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('delete_cascades')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/delete_cascades.html">delete_cascades</a>[] = array( 'table'=&gt;'T_messaging__message', 'fk'=&gt;'msg_author_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d messages from this user'),
<a name="l331"><span class="linenum"> 331</span></a>                      'class'=&gt;'Message', 'class_path'=&gt;'messaging/model/_message.class.php' );
<a name="l332"><span class="linenum"> 332</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('delete_cascades')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/delete_cascades.html">delete_cascades</a>[] = array( 'table'=&gt;'T_messaging__threadstatus', 'fk'=&gt;'tsta_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d message read statuses from this user') );
<a name="l333"><span class="linenum"> 333</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('delete_cascades')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/delete_cascades.html">delete_cascades</a>[] = array( 'table'=&gt;'T_comments', 'fk'=&gt;'comment_author_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d comments by this user'),
<a name="l334"><span class="linenum"> 334</span></a>                      'class'=&gt;'Comment', 'class_path'=&gt;'comments/model/_comment.class.php' );
<a name="l335"><span class="linenum"> 335</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('delete_cascades')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/delete_cascades.html">delete_cascades</a>[] = array( 'table'=&gt;'T_links', 'fk'=&gt;'link_creator_user_ID', 'msg'=&gt;<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('%d links created by this user'),
<a name="l336"><span class="linenum"> 336</span></a>                      'class'=&gt;'Link', 'class_path'=&gt;'links/model/_link.class.php' );
<a name="l337"><span class="linenum"> 337</span></a>          }
<a name="l338"><span class="linenum"> 338</span></a>      }
<a name="l339"><span class="linenum"> 339</span></a>  
<a name="l340"><span class="linenum"> 340</span></a>  
<a name="l341"><span class="linenum"> 341</span></a>      <span class="comment">/**</span>
<a name="l342"><span class="linenum"> 342</span></a>  <span class="comment">     * Load data from Request form fields.</span>
<a name="l343"><span class="linenum"> 343</span></a>  <span class="comment">     *</span>
<a name="l344"><span class="linenum"> 344</span></a>  <span class="comment">     * @return boolean true if loaded data seems valid.</span>
<a name="l345"><span class="linenum"> 345</span></a>  <span class="comment">     */</span>
<a name="l346"><span class="linenum"> 346</span></a>  	function <a class="function" onClick="logFunction('load_from_Request')" href="../../../_functions/load_from_request.html" onMouseOver="funcPopup(event,'load_from_request')">load_from_Request</a>()
<a name="l347"><span class="linenum"> 347</span></a>      {
<a name="l348"><span class="linenum"> 348</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it422" onMouseOver="hilite(422)" onMouseOut="lolite()" onClick="logVariable('GroupCache')" href="../../../_variables/GroupCache.html">$GroupCache</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a>;
<a name="l349"><span class="linenum"> 349</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l350"><span class="linenum"> 350</span></a>  
<a name="l351"><span class="linenum"> 351</span></a>          <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> = ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == 0 );
<a name="l352"><span class="linenum"> 352</span></a>  
<a name="l353"><span class="linenum"> 353</span></a>  <span class="comment">        // ---- Login checking / START ----</span>
<a name="l354"><span class="linenum"> 354</span></a>          <a class="var it3872" onMouseOver="hilite(3872)" onMouseOut="lolite()" onClick="logVariable('edited_user_login')" href="../../../_variables/edited_user_login.html">$edited_user_login</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_login', 'string' );
<a name="l355"><span class="linenum"> 355</span></a>          if( empty( <a class="var it3872" onMouseOver="hilite(3872)" onMouseOut="lolite()" onClick="logVariable('edited_user_login')" href="../../../_variables/edited_user_login.html">$edited_user_login</a> ) )
<a name="l356"><span class="linenum"> 356</span></a>          {    // Empty login
<a name="l357"><span class="linenum"> 357</span></a>              <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'edited_user_login', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your login.') );
<a name="l358"><span class="linenum"> 358</span></a>          }
<a name="l359"><span class="linenum"> 359</span></a>          <a class="function" onClick="logFunction('param_check_valid_login')" href="../../../_functions/param_check_valid_login.html" onMouseOver="funcPopup(event,'param_check_valid_login')">param_check_valid_login</a>( 'edited_user_login' );
<a name="l360"><span class="linenum"> 360</span></a>  
<a name="l361"><span class="linenum"> 361</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l362"><span class="linenum"> 362</span></a>          <a class="var it3873" onMouseOver="hilite(3873)" onMouseOut="lolite()" onClick="logVariable('UserLogin')" href="../../../_variables/UserLogin.html">$UserLogin</a> = <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_login( <a class="var it3872" onMouseOver="hilite(3872)" onMouseOut="lolite()" onClick="logVariable('edited_user_login')" href="../../../_variables/edited_user_login.html">$edited_user_login</a> );
<a name="l363"><span class="linenum"> 363</span></a>          if( <a class="var it3873" onMouseOver="hilite(3873)" onMouseOut="lolite()" onClick="logVariable('UserLogin')" href="../../../_variables/UserLogin.html">$UserLogin</a> &amp;&amp; <a class="var it3873" onMouseOver="hilite(3873)" onMouseOut="lolite()" onClick="logVariable('UserLogin')" href="../../../_variables/UserLogin.html">$UserLogin</a>-&gt;<a onClick="logVariable('ID')" class="var it10936" onMouseOver="hilite(10936)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l364"><span class="linenum"> 364</span></a>          {    // The login is already registered
<a name="l365"><span class="linenum"> 365</span></a>              <a class="var it3874" onMouseOver="hilite(3874)" onMouseOut="lolite()" onClick="logVariable('login_error_message')" href="../../../_variables/login_error_message.html">$login_error_message</a> = <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'This login already exists.' );
<a name="l366"><span class="linenum"> 366</span></a>              if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) )
<a name="l367"><span class="linenum"> 367</span></a>              {
<a name="l368"><span class="linenum"> 368</span></a>                  <a class="var it3874" onMouseOver="hilite(3874)" onMouseOut="lolite()" onClick="logVariable('login_error_message')" href="../../../_variables/login_error_message.html">$login_error_message</a> = sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'This login &amp;laquo;%s&amp;raquo; already exists. Do you want to &lt;a %s&gt;edit the existing user&lt;/a&gt;?' ),
<a name="l369"><span class="linenum"> 369</span></a>                      <a class="var it3872" onMouseOver="hilite(3872)" onMouseOut="lolite()" onClick="logVariable('edited_user_login')" href="../../../_variables/edited_user_login.html">$edited_user_login</a>,
<a name="l370"><span class="linenum"> 370</span></a>                      'href=&quot;'.<a class="function" onClick="logFunction('get_user_settings_url')" href="../../../_functions/get_user_settings_url.html" onMouseOver="funcPopup(event,'get_user_settings_url')">get_user_settings_url</a>( 'profile', <a class="var it3873" onMouseOver="hilite(3873)" onMouseOut="lolite()" onClick="logVariable('UserLogin')" href="../../../_variables/UserLogin.html">$UserLogin</a>-&gt;<a onClick="logVariable('ID')" class="var it10936" onMouseOver="hilite(10936)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ).'&quot;' );
<a name="l371"><span class="linenum"> 371</span></a>              }
<a name="l372"><span class="linenum"> 372</span></a>              <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'edited_user_login', <a class="var it3874" onMouseOver="hilite(3874)" onMouseOut="lolite()" onClick="logVariable('login_error_message')" href="../../../_variables/login_error_message.html">$login_error_message</a> );
<a name="l373"><span class="linenum"> 373</span></a>          }
<a name="l374"><span class="linenum"> 374</span></a>  
<a name="l375"><span class="linenum"> 375</span></a>          if( !<a class="function" onClick="logFunction('param_has_error')" href="../../../_functions/param_has_error.html" onMouseOver="funcPopup(event,'param_has_error')">param_has_error</a>( 'edited_user_login' ) )
<a name="l376"><span class="linenum"> 376</span></a>          {    // We want all logins to be lowercase to guarantee uniqueness regardless of the database case handling for UNIQUE indexes:
<a name="l377"><span class="linenum"> 377</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'login', 'edited_user_login', true, 'utf8_strtolower' );
<a name="l378"><span class="linenum"> 378</span></a>          }
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">        // ---- Login checking / END ----</span>
<a name="l380"><span class="linenum"> 380</span></a>  
<a name="l381"><span class="linenum"> 381</span></a>          <a class="var it3875" onMouseOver="hilite(3875)" onMouseOut="lolite()" onClick="logVariable('is_identity_form')" href="../../../_variables/is_identity_form.html">$is_identity_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'identity_form', 'boolean', false );
<a name="l382"><span class="linenum"> 382</span></a>          <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('is_admin_form')" href="../../../_variables/is_admin_form.html">$is_admin_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'admin_form', 'boolean', false );
<a name="l383"><span class="linenum"> 383</span></a>          <a class="var it2549" onMouseOver="hilite(2549)" onMouseOut="lolite()" onClick="logVariable('has_full_access')" href="../../../_variables/has_full_access.html">$has_full_access</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' );
<a name="l384"><span class="linenum"> 384</span></a>          <a class="var it3877" onMouseOver="hilite(3877)" onMouseOut="lolite()" onClick="logVariable('has_moderate_access')" href="../../../_variables/has_moderate_access.html">$has_moderate_access</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'moderate' );
<a name="l385"><span class="linenum"> 385</span></a>  
<a name="l386"><span class="linenum"> 386</span></a>  <span class="comment">        // ******* Admin form or new user create ******* //</span>
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">        // In both cases current user must have users edit permission!</span>
<a name="l388"><span class="linenum"> 388</span></a>          if( ( <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('is_admin_form')" href="../../../_variables/is_admin_form.html">$is_admin_form</a> || ( <a class="var it3875" onMouseOver="hilite(3875)" onMouseOut="lolite()" onClick="logVariable('is_identity_form')" href="../../../_variables/is_identity_form.html">$is_identity_form</a> &amp;&amp; <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> ) ) &amp;&amp; <a class="var it3877" onMouseOver="hilite(3877)" onMouseOut="lolite()" onClick="logVariable('has_moderate_access')" href="../../../_variables/has_moderate_access.html">$has_moderate_access</a> )
<a name="l389"><span class="linenum"> 389</span></a>          { // level/group and email options are displayed on identity form only when creating a <span class="keyword">new </span><a class="class" onClick="logClass('user')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a>.
<a name="l390"><span class="linenum"> 390</span></a>              if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != 1 )
<a name="l391"><span class="linenum"> 391</span></a>              { // the admin user group can't be changed
<a name="l392"><span class="linenum"> 392</span></a>                  <a class="function" onClick="logFunction('param_integer_range')" href="../../../_functions/param_integer_range.html" onMouseOver="funcPopup(event,'param_integer_range')">param_integer_range</a>( 'edited_user_level', 0, 10, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('User level must be between %d and %d.') );
<a name="l393"><span class="linenum"> 393</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'level', 'edited_user_level', true );
<a name="l394"><span class="linenum"> 394</span></a>  
<a name="l395"><span class="linenum"> 395</span></a>                  <a class="var it3878" onMouseOver="hilite(3878)" onMouseOut="lolite()" onClick="logVariable('edited_user_Group')" href="../../../_variables/edited_user_Group.html">$edited_user_Group</a> = <a class="var it422" onMouseOver="hilite(422)" onMouseOut="lolite()" onClick="logVariable('GroupCache')" href="../../../_variables/GroupCache.html">$GroupCache</a>-&gt;get_by_ID( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_grp_ID', 'integer' ) );
<a name="l396"><span class="linenum"> 396</span></a>                  if( <span class="comment">/* User can change to any group: */</span>
<a name="l397"><span class="linenum"> 397</span></a>                      <a class="var it2549" onMouseOver="hilite(2549)" onMouseOut="lolite()" onClick="logVariable('has_full_access')" href="../../../_variables/has_full_access.html">$has_full_access</a> ||
<a name="l398"><span class="linenum"> 398</span></a>  <span class="comment">                    /* User can change only to group with level lower than own group level: */</span>
<a name="l399"><span class="linenum"> 399</span></a>                      ( <a class="var it3877" onMouseOver="hilite(3877)" onMouseOut="lolite()" onClick="logVariable('has_moderate_access')" href="../../../_variables/has_moderate_access.html">$has_moderate_access</a> &amp;&amp; <a class="var it3878" onMouseOver="hilite(3878)" onMouseOut="lolite()" onClick="logVariable('edited_user_Group')" href="../../../_variables/edited_user_Group.html">$edited_user_Group</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'level' ) &lt; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;get_Group()-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'level' ) ) )
<a name="l400"><span class="linenum"> 400</span></a>                  {
<a name="l401"><span class="linenum"> 401</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_Group')" href="../../../_functions/set_group.html" onMouseOver="funcPopup(event,'set_group')">set_Group</a>( <a class="var it3878" onMouseOver="hilite(3878)" onMouseOut="lolite()" onClick="logVariable('edited_user_Group')" href="../../../_variables/edited_user_Group.html">$edited_user_Group</a> );
<a name="l402"><span class="linenum"> 402</span></a>                  }
<a name="l403"><span class="linenum"> 403</span></a>              }
<a name="l404"><span class="linenum"> 404</span></a>  
<a name="l405"><span class="linenum"> 405</span></a>              <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_source', 'string', true );
<a name="l406"><span class="linenum"> 406</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>('source', 'edited_user_source', true);
<a name="l407"><span class="linenum"> 407</span></a>  
<a name="l408"><span class="linenum"> 408</span></a>  <span class="comment">            // set email, without changing the user status</span>
<a name="l409"><span class="linenum"> 409</span></a>              <a class="var it3879" onMouseOver="hilite(3879)" onMouseOut="lolite()" onClick="logVariable('edited_user_email')" href="../../../_variables/edited_user_email.html">$edited_user_email</a> = <a class="function" onClick="logFunction('utf8_strtolower')" href="../../../_functions/utf8_strtolower.html" onMouseOver="funcPopup(event,'utf8_strtolower')">utf8_strtolower</a>( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_email', 'string', true ) );
<a name="l410"><span class="linenum"> 410</span></a>              <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( 'edited_user_email', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your e-mail address.') );
<a name="l411"><span class="linenum"> 411</span></a>              <a class="function" onClick="logFunction('param_check_email')" href="../../../_functions/param_check_email.html" onMouseOver="funcPopup(event,'param_check_email')">param_check_email</a>( 'edited_user_email', true );
<a name="l412"><span class="linenum"> 412</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_email')" href="../../../_functions/set_email.html" onMouseOver="funcPopup(event,'set_email')">set_email</a>( <a class="var it3879" onMouseOver="hilite(3879)" onMouseOut="lolite()" onClick="logVariable('edited_user_email')" href="../../../_variables/edited_user_email.html">$edited_user_email</a>, false );
<a name="l413"><span class="linenum"> 413</span></a>  
<a name="l414"><span class="linenum"> 414</span></a>              if( <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('is_admin_form')" href="../../../_variables/is_admin_form.html">$is_admin_form</a> )
<a name="l415"><span class="linenum"> 415</span></a>              {    // Admin form
<a name="l416"><span class="linenum"> 416</span></a>                  <a class="var it3880" onMouseOver="hilite(3880)" onMouseOut="lolite()" onClick="logVariable('notification_sender_email')" href="../../../_variables/notification_sender_email.html">$notification_sender_email</a> = <a class="function" onClick="logFunction('utf8_strtolower')" href="../../../_functions/utf8_strtolower.html" onMouseOver="funcPopup(event,'utf8_strtolower')">utf8_strtolower</a>( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'notification_sender_email', 'string', true ) );
<a name="l417"><span class="linenum"> 417</span></a>                  <a class="function" onClick="logFunction('param_check_email')" href="../../../_functions/param_check_email.html" onMouseOver="funcPopup(event,'param_check_email')">param_check_email</a>( 'notification_sender_email' );
<a name="l418"><span class="linenum"> 418</span></a>                  if( ! empty( <a class="var it3880" onMouseOver="hilite(3880)" onMouseOut="lolite()" onClick="logVariable('notification_sender_email')" href="../../../_variables/notification_sender_email.html">$notification_sender_email</a> ) )
<a name="l419"><span class="linenum"> 419</span></a>                  { // Change a value of setting
<a name="l420"><span class="linenum"> 420</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notification_sender_email', <a class="var it3880" onMouseOver="hilite(3880)" onMouseOut="lolite()" onClick="logVariable('notification_sender_email')" href="../../../_variables/notification_sender_email.html">$notification_sender_email</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l421"><span class="linenum"> 421</span></a>                  }
<a name="l422"><span class="linenum"> 422</span></a>                  elseif( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notification_sender_email' , <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) != '' )
<a name="l423"><span class="linenum"> 423</span></a>                  { // Delete a setting record from DB
<a name="l424"><span class="linenum"> 424</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'notification_sender_email', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l425"><span class="linenum"> 425</span></a>                  }
<a name="l426"><span class="linenum"> 426</span></a>  
<a name="l427"><span class="linenum"> 427</span></a>                  <a class="var it3881" onMouseOver="hilite(3881)" onMouseOut="lolite()" onClick="logVariable('notification_sender_name')" href="../../../_variables/notification_sender_name.html">$notification_sender_name</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'notification_sender_name', 'string', true );
<a name="l428"><span class="linenum"> 428</span></a>                  if( ! empty( <a class="var it3881" onMouseOver="hilite(3881)" onMouseOut="lolite()" onClick="logVariable('notification_sender_name')" href="../../../_variables/notification_sender_name.html">$notification_sender_name</a> ) )
<a name="l429"><span class="linenum"> 429</span></a>                  { // Change a value of setting
<a name="l430"><span class="linenum"> 430</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notification_sender_name', <a class="var it3881" onMouseOver="hilite(3881)" onMouseOut="lolite()" onClick="logVariable('notification_sender_name')" href="../../../_variables/notification_sender_name.html">$notification_sender_name</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l431"><span class="linenum"> 431</span></a>                  }
<a name="l432"><span class="linenum"> 432</span></a>                  elseif( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notification_sender_name' , <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) != '' )
<a name="l433"><span class="linenum"> 433</span></a>                  { // Delete a setting record from DB
<a name="l434"><span class="linenum"> 434</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'notification_sender_name', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l435"><span class="linenum"> 435</span></a>                  }
<a name="l436"><span class="linenum"> 436</span></a>  
<a name="l437"><span class="linenum"> 437</span></a>                  if( <a class="var it2549" onMouseOver="hilite(2549)" onMouseOut="lolite()" onClick="logVariable('has_full_access')" href="../../../_variables/has_full_access.html">$has_full_access</a> &amp;&amp; !isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('dbchanges')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/dbchanges.html">dbchanges</a>['user_email'] ) )
<a name="l438"><span class="linenum"> 438</span></a>                  {    // If email address is not changed
<a name="l439"><span class="linenum"> 439</span></a>  <span class="comment">                    // Update status of email address in the T_email_address table</span>
<a name="l440"><span class="linenum"> 440</span></a>                      <a class="var it3882" onMouseOver="hilite(3882)" onMouseOut="lolite()" onClick="logVariable('edited_email_status')" href="../../../_variables/edited_email_status.html">$edited_email_status</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_email_status', 'string' );
<a name="l441"><span class="linenum"> 441</span></a>                      <a class="var it430" onMouseOver="hilite(430)" onMouseOut="lolite()" onClick="logVariable('EmailAddressCache')" href="../../../_variables/EmailAddressCache.html">$EmailAddressCache</a> = &amp; get_EmailAddressCache();
<a name="l442"><span class="linenum"> 442</span></a>                      <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> = &amp; <a class="var it430" onMouseOver="hilite(430)" onMouseOut="lolite()" onClick="logVariable('EmailAddressCache')" href="../../../_variables/EmailAddressCache.html">$EmailAddressCache</a>-&gt;get_by_name( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'email' ), false, false );
<a name="l443"><span class="linenum"> 443</span></a>                      if( !<a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> &amp;&amp; <a class="var it3882" onMouseOver="hilite(3882)" onMouseOut="lolite()" onClick="logVariable('edited_email_status')" href="../../../_variables/edited_email_status.html">$edited_email_status</a> != 'unknown' )
<a name="l444"><span class="linenum"> 444</span></a>                      {    // Create new record in the T_email_address table
<a name="l445"><span class="linenum"> 445</span></a>                          <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> = <span class="keyword">new </span><a class="class" onClick="logClass('EmailAddress')" href="../../../_classes/emailaddress.html" onMouseOver="classPopup(event,'emailaddress')">EmailAddress</a>();
<a name="l446"><span class="linenum"> 446</span></a>                          <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'address', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'email' ) );
<a name="l447"><span class="linenum"> 447</span></a>                      }
<a name="l448"><span class="linenum"> 448</span></a>                      if( !empty( <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> ) )
<a name="l449"><span class="linenum"> 449</span></a>                      {    // Save status of an email address
<a name="l450"><span class="linenum"> 450</span></a>                          <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', <a class="var it3882" onMouseOver="hilite(3882)" onMouseOut="lolite()" onClick="logVariable('edited_email_status')" href="../../../_variables/edited_email_status.html">$edited_email_status</a> );
<a name="l451"><span class="linenum"> 451</span></a>                          <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>();
<a name="l452"><span class="linenum"> 452</span></a>                      }
<a name="l453"><span class="linenum"> 453</span></a>                  }
<a name="l454"><span class="linenum"> 454</span></a>  
<a name="l455"><span class="linenum"> 455</span></a>                  if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'spamblacklist', 'edit' ) )
<a name="l456"><span class="linenum"> 456</span></a>                  { // User can edit IP ranges
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">                    // Update status of IP range in DB</span>
<a name="l458"><span class="linenum"> 458</span></a>                      <a class="var it3883" onMouseOver="hilite(3883)" onMouseOut="lolite()" onClick="logVariable('edited_iprange_status')" href="../../../_variables/edited_iprange_status.html">$edited_iprange_status</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_iprange_status', 'string' );
<a name="l459"><span class="linenum"> 459</span></a>                      <a class="var it428" onMouseOver="hilite(428)" onMouseOut="lolite()" onClick="logVariable('IPRangeCache')" href="../../../_variables/IPRangeCache.html">$IPRangeCache</a> = &amp; get_IPRangeCache();
<a name="l460"><span class="linenum"> 460</span></a>                      <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a> = &amp; <a class="var it428" onMouseOver="hilite(428)" onMouseOut="lolite()" onClick="logVariable('IPRangeCache')" href="../../../_variables/IPRangeCache.html">$IPRangeCache</a>-&gt;get_by_ip( <a class="function" onClick="logFunction('int2ip')" href="../../../_functions/int2ip.html" onMouseOver="funcPopup(event,'int2ip')">int2ip</a>( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'created_fromIPv4', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) ) );
<a name="l461"><span class="linenum"> 461</span></a>                      if( !<a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a> &amp;&amp; !empty( <a class="var it3883" onMouseOver="hilite(3883)" onMouseOut="lolite()" onClick="logVariable('edited_iprange_status')" href="../../../_variables/edited_iprange_status.html">$edited_iprange_status</a> ) )
<a name="l462"><span class="linenum"> 462</span></a>                      { // IP range doesn't exist in DB, Create new record
<a name="l463"><span class="linenum"> 463</span></a>                          <a class="var it3885" onMouseOver="hilite(3885)" onMouseOut="lolite()" onClick="logVariable('ip_24bit_start')" href="../../../_variables/ip_24bit_start.html">$ip_24bit_start</a> = <a class="function" onClick="logFunction('ip2int')" href="../../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( '#\.\d{1,3}$#i', '.0', <a class="function" onClick="logFunction('int2ip')" href="../../../_functions/int2ip.html" onMouseOver="funcPopup(event,'int2ip')">int2ip</a>( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'created_fromIPv4', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) ) ) );
<a name="l464"><span class="linenum"> 464</span></a>                          <a class="var it3886" onMouseOver="hilite(3886)" onMouseOut="lolite()" onClick="logVariable('ip_24bit_end')" href="../../../_variables/ip_24bit_end.html">$ip_24bit_end</a> = <a class="function" onClick="logFunction('ip2int')" href="../../../_functions/ip2int.html" onMouseOver="funcPopup(event,'ip2int')">ip2int</a>( <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( '#\.\d{1,3}$#i', '.255', <a class="function" onClick="logFunction('int2ip')" href="../../../_functions/int2ip.html" onMouseOver="funcPopup(event,'int2ip')">int2ip</a>( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'created_fromIPv4', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) ) ) );
<a name="l465"><span class="linenum"> 465</span></a>                          <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a> = <span class="keyword">new </span><a class="class" onClick="logClass('IPRange')" href="../../../_classes/iprange.html" onMouseOver="classPopup(event,'iprange')">IPRange</a>();
<a name="l466"><span class="linenum"> 466</span></a>                          <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'IPv4start', <a class="var it3885" onMouseOver="hilite(3885)" onMouseOut="lolite()" onClick="logVariable('ip_24bit_start')" href="../../../_variables/ip_24bit_start.html">$ip_24bit_start</a> );
<a name="l467"><span class="linenum"> 467</span></a>                          <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'IPv4end', <a class="var it3886" onMouseOver="hilite(3886)" onMouseOut="lolite()" onClick="logVariable('ip_24bit_end')" href="../../../_variables/ip_24bit_end.html">$ip_24bit_end</a> );
<a name="l468"><span class="linenum"> 468</span></a>                          <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'user_count', 1 );
<a name="l469"><span class="linenum"> 469</span></a>                      }
<a name="l470"><span class="linenum"> 470</span></a>                      if( <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a> )
<a name="l471"><span class="linenum"> 471</span></a>                      { // Save status of IP range
<a name="l472"><span class="linenum"> 472</span></a>                          if( <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'status' ) != 'blocked' &amp;&amp; <a class="var it3883" onMouseOver="hilite(3883)" onMouseOut="lolite()" onClick="logVariable('edited_iprange_status')" href="../../../_variables/edited_iprange_status.html">$edited_iprange_status</a> == 'blocked' )
<a name="l473"><span class="linenum"> 473</span></a>                          {    // Status was changed to blocked, we should increase counter
<a name="l474"><span class="linenum"> 474</span></a>                              <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'block_count', <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a onClick="logVariable('block_count')" class="var it10937" onMouseOver="hilite(10937)" onMouseOut="lolite()" href="../../../_variables/block_count.html">block_count</a> + 1 );
<a name="l475"><span class="linenum"> 475</span></a>                          }
<a name="l476"><span class="linenum"> 476</span></a>                          else if( <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'status' ) == 'blocked' &amp;&amp; <a class="var it3883" onMouseOver="hilite(3883)" onMouseOut="lolite()" onClick="logVariable('edited_iprange_status')" href="../../../_variables/edited_iprange_status.html">$edited_iprange_status</a> != 'blocked' )
<a name="l477"><span class="linenum"> 477</span></a>                          { // Status was changed from blocked to another, we should decrease counter
<a name="l478"><span class="linenum"> 478</span></a>                              <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'block_count', <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a onClick="logVariable('block_count')" class="var it10937" onMouseOver="hilite(10937)" onMouseOut="lolite()" href="../../../_variables/block_count.html">block_count</a> - 1 );
<a name="l479"><span class="linenum"> 479</span></a>                          }
<a name="l480"><span class="linenum"> 480</span></a>                          <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', <a class="var it3883" onMouseOver="hilite(3883)" onMouseOut="lolite()" onClick="logVariable('edited_iprange_status')" href="../../../_variables/edited_iprange_status.html">$edited_iprange_status</a>, true );
<a name="l481"><span class="linenum"> 481</span></a>                          <a class="var it3884" onMouseOver="hilite(3884)" onMouseOut="lolite()" onClick="logVariable('IPRange')" href="../../../_variables/IPRange.html">$IPRange</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>();
<a name="l482"><span class="linenum"> 482</span></a>                      }
<a name="l483"><span class="linenum"> 483</span></a>                  }
<a name="l484"><span class="linenum"> 484</span></a>  
<a name="l485"><span class="linenum"> 485</span></a>                  if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'stats', 'edit' ) )
<a name="l486"><span class="linenum"> 486</span></a>                  { // User can edit Domains
<a name="l487"><span class="linenum"> 487</span></a>                      <a class="var it429" onMouseOver="hilite(429)" onMouseOut="lolite()" onClick="logVariable('DomainCache')" href="../../../_variables/DomainCache.html">$DomainCache</a> = &amp; get_DomainCache();
<a name="l488"><span class="linenum"> 488</span></a>  
<a name="l489"><span class="linenum"> 489</span></a>  <span class="comment">                    // Update status of Domain in DB</span>
<a name="l490"><span class="linenum"> 490</span></a>                      <a class="var it3887" onMouseOver="hilite(3887)" onMouseOut="lolite()" onClick="logVariable('edited_domain_status')" href="../../../_variables/edited_domain_status.html">$edited_domain_status</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_domain_status', 'string' );
<a name="l491"><span class="linenum"> 491</span></a>                      <a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('user_domain')" href="../../../_variables/user_domain.html">$user_domain</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'user_domain', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l492"><span class="linenum"> 492</span></a>                      <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> = &amp; <a class="var it429" onMouseOver="hilite(429)" onMouseOut="lolite()" onClick="logVariable('DomainCache')" href="../../../_variables/DomainCache.html">$DomainCache</a>-&gt;get_by_name( <a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('user_domain')" href="../../../_variables/user_domain.html">$user_domain</a>, false, false );
<a name="l493"><span class="linenum"> 493</span></a>                      if( ! <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> &amp;&amp; <a class="var it3887" onMouseOver="hilite(3887)" onMouseOut="lolite()" onClick="logVariable('edited_domain_status')" href="../../../_variables/edited_domain_status.html">$edited_domain_status</a> != 'unknown' &amp;&amp; ! empty( <a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('user_domain')" href="../../../_variables/user_domain.html">$user_domain</a> ) )
<a name="l494"><span class="linenum"> 494</span></a>                      { // Domain doesn't exist in DB, Create new record
<a name="l495"><span class="linenum"> 495</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Domain')" href="../../../_classes/domain.html" onMouseOver="classPopup(event,'domain')">Domain</a>();
<a name="l496"><span class="linenum"> 496</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'name', <a class="var it557" onMouseOver="hilite(557)" onMouseOut="lolite()" onClick="logVariable('user_domain')" href="../../../_variables/user_domain.html">$user_domain</a> );
<a name="l497"><span class="linenum"> 497</span></a>                      }
<a name="l498"><span class="linenum"> 498</span></a>                      if( <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> )
<a name="l499"><span class="linenum"> 499</span></a>                      { // Save status of Domain
<a name="l500"><span class="linenum"> 500</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', <a class="var it3887" onMouseOver="hilite(3887)" onMouseOut="lolite()" onClick="logVariable('edited_domain_status')" href="../../../_variables/edited_domain_status.html">$edited_domain_status</a>, true );
<a name="l501"><span class="linenum"> 501</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>();
<a name="l502"><span class="linenum"> 502</span></a>                      }
<a name="l503"><span class="linenum"> 503</span></a>  
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">                    // Update status of Initial referer in DB</span>
<a name="l505"><span class="linenum"> 505</span></a>                      <a class="function" onClick="logFunction('load_funcs')" href="../../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>('sessions/model/_hitlog.funcs.php');
<a name="l506"><span class="linenum"> 506</span></a>                      <a class="var it3889" onMouseOver="hilite(3889)" onMouseOut="lolite()" onClick="logVariable('edited_initial_referer_status')" href="../../../_variables/edited_initial_referer_status.html">$edited_initial_referer_status</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_initial_referer_status', 'string' );
<a name="l507"><span class="linenum"> 507</span></a>                      <a class="var it3890" onMouseOver="hilite(3890)" onMouseOut="lolite()" onClick="logVariable('initial_referer')" href="../../../_variables/initial_referer.html">$initial_referer</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'initial_referer', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l508"><span class="linenum"> 508</span></a>                      <a class="var it3891" onMouseOver="hilite(3891)" onMouseOut="lolite()" onClick="logVariable('initial_referer_domain')" href="../../../_variables/initial_referer_domain.html">$initial_referer_domain</a> = <a class="function" onClick="logFunction('url_part')" href="../../../_functions/url_part.html" onMouseOver="funcPopup(event,'url_part')">url_part</a>( <a class="var it3890" onMouseOver="hilite(3890)" onMouseOut="lolite()" onClick="logVariable('initial_referer')" href="../../../_variables/initial_referer.html">$initial_referer</a>, 'host' );
<a name="l509"><span class="linenum"> 509</span></a>                      <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> = &amp; get_Domain_by_url( <a class="var it3890" onMouseOver="hilite(3890)" onMouseOut="lolite()" onClick="logVariable('initial_referer')" href="../../../_variables/initial_referer.html">$initial_referer</a> );
<a name="l510"><span class="linenum"> 510</span></a>                      if( ! <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> &amp;&amp; <a class="var it3889" onMouseOver="hilite(3889)" onMouseOut="lolite()" onClick="logVariable('edited_initial_referer_status')" href="../../../_variables/edited_initial_referer_status.html">$edited_initial_referer_status</a> != 'unknown' &amp;&amp; ! empty( <a class="var it3891" onMouseOver="hilite(3891)" onMouseOut="lolite()" onClick="logVariable('initial_referer_domain')" href="../../../_variables/initial_referer_domain.html">$initial_referer_domain</a> ) )
<a name="l511"><span class="linenum"> 511</span></a>                      { // Domain doesn't exist in DB, Create new record
<a name="l512"><span class="linenum"> 512</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Domain')" href="../../../_classes/domain.html" onMouseOver="classPopup(event,'domain')">Domain</a>();
<a name="l513"><span class="linenum"> 513</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'name', <a class="var it3891" onMouseOver="hilite(3891)" onMouseOut="lolite()" onClick="logVariable('initial_referer_domain')" href="../../../_variables/initial_referer_domain.html">$initial_referer_domain</a> );
<a name="l514"><span class="linenum"> 514</span></a>                      }
<a name="l515"><span class="linenum"> 515</span></a>                      if( <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a> )
<a name="l516"><span class="linenum"> 516</span></a>                      { // Save status of Domain
<a name="l517"><span class="linenum"> 517</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', <a class="var it3889" onMouseOver="hilite(3889)" onMouseOut="lolite()" onClick="logVariable('edited_initial_referer_status')" href="../../../_variables/edited_initial_referer_status.html">$edited_initial_referer_status</a>, true );
<a name="l518"><span class="linenum"> 518</span></a>                          <a class="var it3888" onMouseOver="hilite(3888)" onMouseOut="lolite()" onClick="logVariable('Domain')" href="../../../_variables/Domain.html">$Domain</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>();
<a name="l519"><span class="linenum"> 519</span></a>                      }
<a name="l520"><span class="linenum"> 520</span></a>                  }
<a name="l521"><span class="linenum"> 521</span></a>              }
<a name="l522"><span class="linenum"> 522</span></a>          }
<a name="l523"><span class="linenum"> 523</span></a>  
<a name="l524"><span class="linenum"> 524</span></a>  <span class="comment">        // ******* Identity form ******* //</span>
<a name="l525"><span class="linenum"> 525</span></a>          if( <a class="var it3875" onMouseOver="hilite(3875)" onMouseOut="lolite()" onClick="logVariable('is_identity_form')" href="../../../_variables/is_identity_form.html">$is_identity_form</a> )
<a name="l526"><span class="linenum"> 526</span></a>          {
<a name="l527"><span class="linenum"> 527</span></a>              <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' );
<a name="l528"><span class="linenum"> 528</span></a>              <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('edited_user_perms')" href="../../../_variables/edited_user_perms.html">$edited_user_perms</a> = array( 'edited-user', 'edited-user-required' );
<a name="l529"><span class="linenum"> 529</span></a>  
<a name="l530"><span class="linenum"> 530</span></a>              global <a class="var it3893" onMouseOver="hilite(3893)" onMouseOut="lolite()" onClick="logVariable('edited_user_age_min')" href="../../../_variables/edited_user_age_min.html">$edited_user_age_min</a>, <a class="var it3894" onMouseOver="hilite(3894)" onMouseOut="lolite()" onClick="logVariable('edited_user_age_max')" href="../../../_variables/edited_user_age_max.html">$edited_user_age_max</a>;
<a name="l531"><span class="linenum"> 531</span></a>              <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_age_min', 'string', true );
<a name="l532"><span class="linenum"> 532</span></a>              <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_age_max', 'string', true );
<a name="l533"><span class="linenum"> 533</span></a>              <a class="function" onClick="logFunction('param_check_interval')" href="../../../_functions/param_check_interval.html" onMouseOver="funcPopup(event,'param_check_interval')">param_check_interval</a>( 'edited_user_age_min', 'edited_user_age_max', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Age must be a number.'), <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The first age must be lower than (or equal to) the second.') );
<a name="l534"><span class="linenum"> 534</span></a>              if( !<a class="function" onClick="logFunction('param_has_error')" href="../../../_functions/param_has_error.html" onMouseOver="funcPopup(event,'param_has_error')">param_has_error</a>( 'edited_user_age_min' ) &amp;&amp; <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'minimum_age' ) &gt; 0 &amp;&amp;
<a name="l535"><span class="linenum"> 535</span></a>                  !empty( <a class="var it3893" onMouseOver="hilite(3893)" onMouseOut="lolite()" onClick="logVariable('edited_user_age_min')" href="../../../_variables/edited_user_age_min.html">$edited_user_age_min</a> ) &amp;&amp; <a class="var it3893" onMouseOver="hilite(3893)" onMouseOut="lolite()" onClick="logVariable('edited_user_age_min')" href="../../../_variables/edited_user_age_min.html">$edited_user_age_min</a> &lt; <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'minimum_age' ) )
<a name="l536"><span class="linenum"> 536</span></a>              {    // Limit user by minimum age
<a name="l537"><span class="linenum"> 537</span></a>                  <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'edited_user_age_min', sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You must be at least %d years old to use this service.'), <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'minimum_age' ) ) );
<a name="l538"><span class="linenum"> 538</span></a>              }
<a name="l539"><span class="linenum"> 539</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'age_min', 'edited_user_age_min', true );
<a name="l540"><span class="linenum"> 540</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'age_max', 'edited_user_age_max', true );
<a name="l541"><span class="linenum"> 541</span></a>  
<a name="l542"><span class="linenum"> 542</span></a>              <a class="var it2565" onMouseOver="hilite(2565)" onMouseOut="lolite()" onClick="logVariable('firstname_editing')" href="../../../_variables/firstname_editing.html">$firstname_editing</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'firstname_editing' );
<a name="l543"><span class="linenum"> 543</span></a>              if( ( <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it2565" onMouseOver="hilite(2565)" onMouseOut="lolite()" onClick="logVariable('firstname_editing')" href="../../../_variables/firstname_editing.html">$firstname_editing</a>, <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('edited_user_perms')" href="../../../_variables/edited_user_perms.html">$edited_user_perms</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) || ( <a class="var it2565" onMouseOver="hilite(2565)" onMouseOut="lolite()" onClick="logVariable('firstname_editing')" href="../../../_variables/firstname_editing.html">$firstname_editing</a> != 'hidden' &amp;&amp; <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> ) )
<a name="l544"><span class="linenum"> 544</span></a>              {    // User has a permissions to save Firstname
<a name="l545"><span class="linenum"> 545</span></a>                  <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_firstname', 'string', true );
<a name="l546"><span class="linenum"> 546</span></a>                  if( <a class="var it2565" onMouseOver="hilite(2565)" onMouseOut="lolite()" onClick="logVariable('firstname_editing')" href="../../../_variables/firstname_editing.html">$firstname_editing</a> == 'edited-user-required' )
<a name="l547"><span class="linenum"> 547</span></a>                  {    // First name is required
<a name="l548"><span class="linenum"> 548</span></a>                      if( <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> )
<a name="l549"><span class="linenum"> 549</span></a>                      {    // Display a note message if user can edit all users
<a name="l550"><span class="linenum"> 550</span></a>                          <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'edited_user_firstname', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your first name.'), 'note' );
<a name="l551"><span class="linenum"> 551</span></a>                      }
<a name="l552"><span class="linenum"> 552</span></a>                      else
<a name="l553"><span class="linenum"> 553</span></a>                      {    // Display an error message
<a name="l554"><span class="linenum"> 554</span></a>                          <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( 'edited_user_firstname', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your first name.') );
<a name="l555"><span class="linenum"> 555</span></a>                      }
<a name="l556"><span class="linenum"> 556</span></a>                  }
<a name="l557"><span class="linenum"> 557</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>('firstname', 'edited_user_firstname', true);
<a name="l558"><span class="linenum"> 558</span></a>              }
<a name="l559"><span class="linenum"> 559</span></a>  
<a name="l560"><span class="linenum"> 560</span></a>              <a class="var it2566" onMouseOver="hilite(2566)" onMouseOut="lolite()" onClick="logVariable('lastname_editing')" href="../../../_variables/lastname_editing.html">$lastname_editing</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'lastname_editing' );
<a name="l561"><span class="linenum"> 561</span></a>              if( ( <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it2566" onMouseOver="hilite(2566)" onMouseOut="lolite()" onClick="logVariable('lastname_editing')" href="../../../_variables/lastname_editing.html">$lastname_editing</a>, <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('edited_user_perms')" href="../../../_variables/edited_user_perms.html">$edited_user_perms</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) || ( <a class="var it2566" onMouseOver="hilite(2566)" onMouseOut="lolite()" onClick="logVariable('lastname_editing')" href="../../../_variables/lastname_editing.html">$lastname_editing</a> != 'hidden' &amp;&amp; <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> ) )
<a name="l562"><span class="linenum"> 562</span></a>              {    // User has a permissions to save Lastname
<a name="l563"><span class="linenum"> 563</span></a>                  <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_lastname', 'string', true );
<a name="l564"><span class="linenum"> 564</span></a>                  if( <a class="var it2566" onMouseOver="hilite(2566)" onMouseOut="lolite()" onClick="logVariable('lastname_editing')" href="../../../_variables/lastname_editing.html">$lastname_editing</a> == 'edited-user-required' )
<a name="l565"><span class="linenum"> 565</span></a>                  {    // Last name is required
<a name="l566"><span class="linenum"> 566</span></a>                      if( <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> )
<a name="l567"><span class="linenum"> 567</span></a>                      {    // Display a note message if user can edit all users
<a name="l568"><span class="linenum"> 568</span></a>                          <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'edited_user_lastname', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter last name.'), 'note' );
<a name="l569"><span class="linenum"> 569</span></a>                      }
<a name="l570"><span class="linenum"> 570</span></a>                      else
<a name="l571"><span class="linenum"> 571</span></a>                      {    // Display an error message
<a name="l572"><span class="linenum"> 572</span></a>                          <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( 'edited_user_lastname', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter last name.') );
<a name="l573"><span class="linenum"> 573</span></a>                      }
<a name="l574"><span class="linenum"> 574</span></a>                  }
<a name="l575"><span class="linenum"> 575</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>('lastname', 'edited_user_lastname', true);
<a name="l576"><span class="linenum"> 576</span></a>              }
<a name="l577"><span class="linenum"> 577</span></a>  
<a name="l578"><span class="linenum"> 578</span></a>              <a class="var it2568" onMouseOver="hilite(2568)" onMouseOut="lolite()" onClick="logVariable('nickname_editing')" href="../../../_variables/nickname_editing.html">$nickname_editing</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'nickname_editing' );
<a name="l579"><span class="linenum"> 579</span></a>              if( ( <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it2568" onMouseOver="hilite(2568)" onMouseOut="lolite()" onClick="logVariable('nickname_editing')" href="../../../_variables/nickname_editing.html">$nickname_editing</a>, <a class="var it2550" onMouseOver="hilite(2550)" onMouseOut="lolite()" onClick="logVariable('edited_user_perms')" href="../../../_variables/edited_user_perms.html">$edited_user_perms</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) || ( <a class="var it2568" onMouseOver="hilite(2568)" onMouseOut="lolite()" onClick="logVariable('nickname_editing')" href="../../../_variables/nickname_editing.html">$nickname_editing</a> != 'hidden' &amp;&amp; <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> ) )
<a name="l580"><span class="linenum"> 580</span></a>              {    // User has a permissions to save Nickname
<a name="l581"><span class="linenum"> 581</span></a>                  <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_nickname', 'string', true );
<a name="l582"><span class="linenum"> 582</span></a>                  if( <a class="var it2568" onMouseOver="hilite(2568)" onMouseOut="lolite()" onClick="logVariable('nickname_editing')" href="../../../_variables/nickname_editing.html">$nickname_editing</a> == 'edited-user-required' )
<a name="l583"><span class="linenum"> 583</span></a>                  {    // Nickname is required
<a name="l584"><span class="linenum"> 584</span></a>                      if( <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> )
<a name="l585"><span class="linenum"> 585</span></a>                      {    // Display a note message if user can edit all users
<a name="l586"><span class="linenum"> 586</span></a>                          <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'edited_user_nickname', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your nickname.'), 'note' );
<a name="l587"><span class="linenum"> 587</span></a>                      }
<a name="l588"><span class="linenum"> 588</span></a>                      else
<a name="l589"><span class="linenum"> 589</span></a>                      {    // Display an error message
<a name="l590"><span class="linenum"> 590</span></a>                          <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( 'edited_user_nickname', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your nickname.') );
<a name="l591"><span class="linenum"> 591</span></a>                      }
<a name="l592"><span class="linenum"> 592</span></a>                  }
<a name="l593"><span class="linenum"> 593</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>('nickname', 'edited_user_nickname', true);
<a name="l594"><span class="linenum"> 594</span></a>              }
<a name="l595"><span class="linenum"> 595</span></a>  
<a name="l596"><span class="linenum"> 596</span></a>              <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_gender', 'string', '' );
<a name="l597"><span class="linenum"> 597</span></a>              if( <a class="function" onClick="logFunction('param_check_gender')" href="../../../_functions/param_check_gender.html" onMouseOver="funcPopup(event,'param_check_gender')">param_check_gender</a>( 'edited_user_gender', <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'registration_require_gender' ) == 'required' ) )
<a name="l598"><span class="linenum"> 598</span></a>              {
<a name="l599"><span class="linenum"> 599</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>('gender', 'edited_user_gender', true);
<a name="l600"><span class="linenum"> 600</span></a>              }
<a name="l601"><span class="linenum"> 601</span></a>  
<a name="l602"><span class="linenum"> 602</span></a>  <span class="comment">            // ---- Locations / START ----</span>
<a name="l603"><span class="linenum"> 603</span></a>              <a class="function" onClick="logFunction('load_funcs')" href="../../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( 'regional/model/_regional.funcs.php' );
<a name="l604"><span class="linenum"> 604</span></a>  
<a name="l605"><span class="linenum"> 605</span></a>              if( <a class="function" onClick="logFunction('user_country_visible')" href="../../../_functions/user_country_visible.html" onMouseOver="funcPopup(event,'user_country_visible')">user_country_visible</a>() )
<a name="l606"><span class="linenum"> 606</span></a>              { // Save country
<a name="l607"><span class="linenum"> 607</span></a>                  <a class="var it1162" onMouseOver="hilite(1162)" onMouseOut="lolite()" onClick="logVariable('country_ID')" href="../../../_variables/country_ID.html">$country_ID</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_ctry_ID', 'integer', true );
<a name="l608"><span class="linenum"> 608</span></a>                  <a class="var it1512" onMouseOver="hilite(1512)" onMouseOut="lolite()" onClick="logVariable('country_is_required')" href="../../../_variables/country_is_required.html">$country_is_required</a> = ( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'location_country' ) == 'required' &amp;&amp; <a class="function" onClick="logFunction('countries_exist')" href="../../../_functions/countries_exist.html" onMouseOver="funcPopup(event,'countries_exist')">countries_exist</a>() );
<a name="l609"><span class="linenum"> 609</span></a>                  if( <a class="var it1512" onMouseOver="hilite(1512)" onMouseOut="lolite()" onClick="logVariable('country_is_required')" href="../../../_variables/country_is_required.html">$country_is_required</a> &amp;&amp; <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> &amp;&amp; <a class="var it1162" onMouseOver="hilite(1162)" onMouseOut="lolite()" onClick="logVariable('country_ID')" href="../../../_variables/country_ID.html">$country_ID</a> == 0 )
<a name="l610"><span class="linenum"> 610</span></a>                  { // Display a note message if user can edit all users
<a name="l611"><span class="linenum"> 611</span></a>                      <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'edited_user_ctry_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a country.'), 'note' );
<a name="l612"><span class="linenum"> 612</span></a>                  }
<a name="l613"><span class="linenum"> 613</span></a>                  else
<a name="l614"><span class="linenum"> 614</span></a>                  { // Display an error message
<a name="l615"><span class="linenum"> 615</span></a>                      <a class="function" onClick="logFunction('param_check_number')" href="../../../_functions/param_check_number.html" onMouseOver="funcPopup(event,'param_check_number')">param_check_number</a>( 'edited_user_ctry_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a country.'), <a class="var it1512" onMouseOver="hilite(1512)" onMouseOut="lolite()" onClick="logVariable('country_is_required')" href="../../../_variables/country_is_required.html">$country_is_required</a> );
<a name="l616"><span class="linenum"> 616</span></a>                  }
<a name="l617"><span class="linenum"> 617</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'ctry_ID', 'edited_user_ctry_ID', true );
<a name="l618"><span class="linenum"> 618</span></a>              }
<a name="l619"><span class="linenum"> 619</span></a>  
<a name="l620"><span class="linenum"> 620</span></a>              if( <a class="function" onClick="logFunction('user_region_visible')" href="../../../_functions/user_region_visible.html" onMouseOver="funcPopup(event,'user_region_visible')">user_region_visible</a>() )
<a name="l621"><span class="linenum"> 621</span></a>              { // Save region
<a name="l622"><span class="linenum"> 622</span></a>                  <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('region_ID')" href="../../../_variables/region_ID.html">$region_ID</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_rgn_ID', 'integer', true );
<a name="l623"><span class="linenum"> 623</span></a>                  <a class="var it1513" onMouseOver="hilite(1513)" onMouseOut="lolite()" onClick="logVariable('region_is_required')" href="../../../_variables/region_is_required.html">$region_is_required</a> = ( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'location_region' ) == 'required' &amp;&amp; <a class="function" onClick="logFunction('regions_exist')" href="../../../_functions/regions_exist.html" onMouseOver="funcPopup(event,'regions_exist')">regions_exist</a>( <a class="var it1162" onMouseOver="hilite(1162)" onMouseOut="lolite()" onClick="logVariable('country_ID')" href="../../../_variables/country_ID.html">$country_ID</a> ) );
<a name="l624"><span class="linenum"> 624</span></a>                  if( <a class="var it1513" onMouseOver="hilite(1513)" onMouseOut="lolite()" onClick="logVariable('region_is_required')" href="../../../_variables/region_is_required.html">$region_is_required</a> &amp;&amp; <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> &amp;&amp; <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('region_ID')" href="../../../_variables/region_ID.html">$region_ID</a> == 0 )
<a name="l625"><span class="linenum"> 625</span></a>                  { // Display a note message if user can edit all users
<a name="l626"><span class="linenum"> 626</span></a>                      <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'edited_user_rgn_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a region.'), 'note' );
<a name="l627"><span class="linenum"> 627</span></a>                  }
<a name="l628"><span class="linenum"> 628</span></a>                  else
<a name="l629"><span class="linenum"> 629</span></a>                  { // Display an error message
<a name="l630"><span class="linenum"> 630</span></a>                      <a class="function" onClick="logFunction('param_check_number')" href="../../../_functions/param_check_number.html" onMouseOver="funcPopup(event,'param_check_number')">param_check_number</a>( 'edited_user_rgn_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a region'), <a class="var it1513" onMouseOver="hilite(1513)" onMouseOut="lolite()" onClick="logVariable('region_is_required')" href="../../../_variables/region_is_required.html">$region_is_required</a> );
<a name="l631"><span class="linenum"> 631</span></a>                  }
<a name="l632"><span class="linenum"> 632</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'rgn_ID', 'edited_user_rgn_ID', true );
<a name="l633"><span class="linenum"> 633</span></a>              }
<a name="l634"><span class="linenum"> 634</span></a>  
<a name="l635"><span class="linenum"> 635</span></a>              if( <a class="function" onClick="logFunction('user_subregion_visible')" href="../../../_functions/user_subregion_visible.html" onMouseOver="funcPopup(event,'user_subregion_visible')">user_subregion_visible</a>() )
<a name="l636"><span class="linenum"> 636</span></a>              { // Save subregion
<a name="l637"><span class="linenum"> 637</span></a>                  <a class="var it1164" onMouseOver="hilite(1164)" onMouseOut="lolite()" onClick="logVariable('subregion_ID')" href="../../../_variables/subregion_ID.html">$subregion_ID</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_subrg_ID', 'integer', true );
<a name="l638"><span class="linenum"> 638</span></a>                  <a class="var it1514" onMouseOver="hilite(1514)" onMouseOut="lolite()" onClick="logVariable('subregion_is_required')" href="../../../_variables/subregion_is_required.html">$subregion_is_required</a> = ( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'location_subregion' ) == 'required' &amp;&amp; <a class="function" onClick="logFunction('subregions_exist')" href="../../../_functions/subregions_exist.html" onMouseOver="funcPopup(event,'subregions_exist')">subregions_exist</a>( <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('region_ID')" href="../../../_variables/region_ID.html">$region_ID</a> ) );
<a name="l639"><span class="linenum"> 639</span></a>                  if( <a class="var it1514" onMouseOver="hilite(1514)" onMouseOut="lolite()" onClick="logVariable('subregion_is_required')" href="../../../_variables/subregion_is_required.html">$subregion_is_required</a> &amp;&amp; <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> &amp;&amp; <a class="var it1164" onMouseOver="hilite(1164)" onMouseOut="lolite()" onClick="logVariable('subregion_ID')" href="../../../_variables/subregion_ID.html">$subregion_ID</a> == 0 )
<a name="l640"><span class="linenum"> 640</span></a>                  { // Display a note message if user can edit all users
<a name="l641"><span class="linenum"> 641</span></a>                      <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'edited_user_subrg_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a sub-region.'), 'note' );
<a name="l642"><span class="linenum"> 642</span></a>                  }
<a name="l643"><span class="linenum"> 643</span></a>                  else
<a name="l644"><span class="linenum"> 644</span></a>                  { // Display an error message
<a name="l645"><span class="linenum"> 645</span></a>                      <a class="function" onClick="logFunction('param_check_number')" href="../../../_functions/param_check_number.html" onMouseOver="funcPopup(event,'param_check_number')">param_check_number</a>( 'edited_user_subrg_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a sub-region.'), <a class="var it1514" onMouseOver="hilite(1514)" onMouseOut="lolite()" onClick="logVariable('subregion_is_required')" href="../../../_variables/subregion_is_required.html">$subregion_is_required</a> );
<a name="l646"><span class="linenum"> 646</span></a>                  }
<a name="l647"><span class="linenum"> 647</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'subrg_ID', 'edited_user_subrg_ID', true );
<a name="l648"><span class="linenum"> 648</span></a>              }
<a name="l649"><span class="linenum"> 649</span></a>  
<a name="l650"><span class="linenum"> 650</span></a>              if( <a class="function" onClick="logFunction('user_city_visible')" href="../../../_functions/user_city_visible.html" onMouseOver="funcPopup(event,'user_city_visible')">user_city_visible</a>() )
<a name="l651"><span class="linenum"> 651</span></a>              { // Save city
<a name="l652"><span class="linenum"> 652</span></a>                  <a class="var it1126" onMouseOver="hilite(1126)" onMouseOut="lolite()" onClick="logVariable('city_ID')" href="../../../_variables/city_ID.html">$city_ID</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_city_ID', 'integer', true );
<a name="l653"><span class="linenum"> 653</span></a>                  <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('city_is_required')" href="../../../_variables/city_is_required.html">$city_is_required</a> = ( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'location_city' ) == 'required' &amp;&amp; <a class="function" onClick="logFunction('cities_exist')" href="../../../_functions/cities_exist.html" onMouseOver="funcPopup(event,'cities_exist')">cities_exist</a>( <a class="var it1162" onMouseOver="hilite(1162)" onMouseOut="lolite()" onClick="logVariable('country_ID')" href="../../../_variables/country_ID.html">$country_ID</a>, <a class="var it1163" onMouseOver="hilite(1163)" onMouseOut="lolite()" onClick="logVariable('region_ID')" href="../../../_variables/region_ID.html">$region_ID</a>, <a class="var it1164" onMouseOver="hilite(1164)" onMouseOut="lolite()" onClick="logVariable('subregion_ID')" href="../../../_variables/subregion_ID.html">$subregion_ID</a> ) );
<a name="l654"><span class="linenum"> 654</span></a>                  if( <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('city_is_required')" href="../../../_variables/city_is_required.html">$city_is_required</a> &amp;&amp; <a class="var it3892" onMouseOver="hilite(3892)" onMouseOut="lolite()" onClick="logVariable('can_edit_users')" href="../../../_variables/can_edit_users.html">$can_edit_users</a> &amp;&amp; <a class="var it1126" onMouseOver="hilite(1126)" onMouseOut="lolite()" onClick="logVariable('city_ID')" href="../../../_variables/city_ID.html">$city_ID</a> == 0 )
<a name="l655"><span class="linenum"> 655</span></a>                  { // Display a note message if user can edit all users
<a name="l656"><span class="linenum"> 656</span></a>                      <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'edited_user_city_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a city.'), 'note' );
<a name="l657"><span class="linenum"> 657</span></a>                  }
<a name="l658"><span class="linenum"> 658</span></a>                  else
<a name="l659"><span class="linenum"> 659</span></a>                  { // Display an error message
<a name="l660"><span class="linenum"> 660</span></a>                      <a class="function" onClick="logFunction('param_check_number')" href="../../../_functions/param_check_number.html" onMouseOver="funcPopup(event,'param_check_number')">param_check_number</a>( 'edited_user_city_ID', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a city.'), <a class="var it1515" onMouseOver="hilite(1515)" onMouseOut="lolite()" onClick="logVariable('city_is_required')" href="../../../_variables/city_is_required.html">$city_is_required</a> );
<a name="l661"><span class="linenum"> 661</span></a>                  }
<a name="l662"><span class="linenum"> 662</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>( 'city_ID', 'edited_user_city_ID', true );
<a name="l663"><span class="linenum"> 663</span></a>              }
<a name="l664"><span class="linenum"> 664</span></a>  <span class="comment">            // ---- Locations / END ----</span>
<a name="l665"><span class="linenum"> 665</span></a>  
<a name="l666"><span class="linenum"> 666</span></a>  
<a name="l667"><span class="linenum"> 667</span></a>  <span class="comment">            // ---- Organizations / START ----</span>
<a name="l668"><span class="linenum"> 668</span></a>              <a class="var it3895" onMouseOver="hilite(3895)" onMouseOut="lolite()" onClick="logVariable('organizations')" href="../../../_variables/organizations.html">$organizations</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'organizations', 'array:string' );
<a name="l669"><span class="linenum"> 669</span></a>              <a class="var it3896" onMouseOver="hilite(3896)" onMouseOut="lolite()" onClick="logVariable('org_roles')" href="../../../_variables/org_roles.html">$org_roles</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'org_roles', 'array:string' );
<a name="l670"><span class="linenum"> 670</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_organizations')" href="../../../_functions/update_organizations.html" onMouseOver="funcPopup(event,'update_organizations')">update_organizations</a>( <a class="var it3895" onMouseOver="hilite(3895)" onMouseOut="lolite()" onClick="logVariable('organizations')" href="../../../_variables/organizations.html">$organizations</a>, <a class="var it3896" onMouseOver="hilite(3896)" onMouseOut="lolite()" onClick="logVariable('org_roles')" href="../../../_variables/org_roles.html">$org_roles</a> );
<a name="l671"><span class="linenum"> 671</span></a>  <span class="comment">            // ---- Organizations / END ----</span>
<a name="l672"><span class="linenum"> 672</span></a>  
<a name="l673"><span class="linenum"> 673</span></a>  
<a name="l674"><span class="linenum"> 674</span></a>  <span class="comment">            // ---- Additional Fields / START ----</span>
<a name="l675"><span class="linenum"> 675</span></a>  
<a name="l676"><span class="linenum"> 676</span></a>  <span class="comment">            // Load all defined userfields for following checking of required fields</span>
<a name="l677"><span class="linenum"> 677</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_defs_load')" href="../../../_functions/userfield_defs_load.html" onMouseOver="funcPopup(event,'userfield_defs_load')">userfield_defs_load</a>();
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>  <span class="comment">            // EXPERIMENTAL user fields &amp; EXISTING fields:</span>
<a name="l680"><span class="linenum"> 680</span></a>  <span class="comment">            // Get indices of existing userfields:</span>
<a name="l681"><span class="linenum"> 681</span></a>              <a class="var it3897" onMouseOver="hilite(3897)" onMouseOut="lolite()" onClick="logVariable('userfield_IDs')" href="../../../_variables/userfield_IDs.html">$userfield_IDs</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( '
<a name="l682"><span class="linenum"> 682</span></a>                          SELECT uf_ID, uf_ufdf_ID
<a name="l683"><span class="linenum"> 683</span></a>                              FROM T_users__fields
<a name="l684"><span class="linenum"> 684</span></a>                           WHERE uf_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l685"><span class="linenum"> 685</span></a>  
<a name="l686"><span class="linenum"> 686</span></a>              foreach( <a class="var it3897" onMouseOver="hilite(3897)" onMouseOut="lolite()" onClick="logVariable('userfield_IDs')" href="../../../_variables/userfield_IDs.html">$userfield_IDs</a> as <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a> )
<a name="l687"><span class="linenum"> 687</span></a>              {
<a name="l688"><span class="linenum"> 688</span></a>                  if( ! isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>] ) )
<a name="l689"><span class="linenum"> 689</span></a>                  {    // If user field definition doesn't exist in DB then delete field value of this user:
<a name="l690"><span class="linenum"> 690</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_update')" href="../../../_functions/userfield_update.html" onMouseOver="funcPopup(event,'userfield_update')">userfield_update</a>( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, NULL );
<a name="l691"><span class="linenum"> 691</span></a>                      continue;
<a name="l692"><span class="linenum"> 692</span></a>                  }
<a name="l693"><span class="linenum"> 693</span></a>  
<a name="l694"><span class="linenum"> 694</span></a>                  <a class="var it3899" onMouseOver="hilite(3899)" onMouseOut="lolite()" onClick="logVariable('field_type')" href="../../../_variables/field_type.html">$field_type</a> = ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>][0] == 'text' ) ? 'text' : 'string';
<a name="l695"><span class="linenum"> 695</span></a>                  <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'uf_'.<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, <a class="var it3899" onMouseOver="hilite(3899)" onMouseOut="lolite()" onClick="logVariable('field_type')" href="../../../_variables/field_type.html">$field_type</a>, '' );
<a name="l696"><span class="linenum"> 696</span></a>  
<a name="l697"><span class="linenum"> 697</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>][0] == 'list' &amp;&amp; <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> == '---' )
<a name="l698"><span class="linenum"> 698</span></a>                  {    // Option list has a value '---' for empty value
<a name="l699"><span class="linenum"> 699</span></a>                      <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> = '';
<a name="l700"><span class="linenum"> 700</span></a>                  }
<a name="l701"><span class="linenum"> 701</span></a>  
<a name="l702"><span class="linenum"> 702</span></a>                  <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="phpfunction" onClick="logFunction('strip_tags')" href="../../../_functions/strip_tags.html" onMouseOver="phpfuncPopup(event,'strip_tags')">strip_tags</a>( <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> ) );
<a name="l703"><span class="linenum"> 703</span></a>                  if( empty( <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>][2] == 'require' )
<a name="l704"><span class="linenum"> 704</span></a>                  {    // Display error for empty required field
<a name="l705"><span class="linenum"> 705</span></a>                      if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) )
<a name="l706"><span class="linenum"> 706</span></a>                      {    // Display a note message if user can edit all users
<a name="l707"><span class="linenum"> 707</span></a>                          <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'uf_'.<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter a value for the field &quot;%s&quot;.'), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>][1] ), 'note' );
<a name="l708"><span class="linenum"> 708</span></a>                      }
<a name="l709"><span class="linenum"> 709</span></a>                      else
<a name="l710"><span class="linenum"> 710</span></a>                      {    // Display an error message
<a name="l711"><span class="linenum"> 711</span></a>                          <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'uf_'.<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter a value.') );
<a name="l712"><span class="linenum"> 712</span></a>                      }
<a name="l713"><span class="linenum"> 713</span></a>                  }
<a name="l714"><span class="linenum"> 714</span></a>                  else
<a name="l715"><span class="linenum"> 715</span></a>                  {    // Update field
<a name="l716"><span class="linenum"> 716</span></a>                      if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>][0] == 'url' )
<a name="l717"><span class="linenum"> 717</span></a>                      {    // Check url fields
<a name="l718"><span class="linenum"> 718</span></a>                          <a class="function" onClick="logFunction('param_check_url')" href="../../../_functions/param_check_url.html" onMouseOver="funcPopup(event,'param_check_url')">param_check_url</a>( 'uf_'.<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, 'commenting' );
<a name="l719"><span class="linenum"> 719</span></a>                      }
<a name="l720"><span class="linenum"> 720</span></a>                      if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>][4] == 'list' )
<a name="l721"><span class="linenum"> 721</span></a>                      {    // Option &quot;Multiple values&quot; == &quot;List style&quot;
<a name="l722"><span class="linenum"> 722</span></a>  <span class="comment">                        // Split by comma and save each phrase as separate field</span>
<a name="l723"><span class="linenum"> 723</span></a>                          <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( ',', <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> );
<a name="l724"><span class="linenum"> 724</span></a>                          foreach( <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> as <a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../../_variables/v.html">$v</a> =&gt; <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> )
<a name="l725"><span class="linenum"> 725</span></a>                          {
<a name="l726"><span class="linenum"> 726</span></a>                              <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> );
<a name="l727"><span class="linenum"> 727</span></a>                              if( <a class="var it244" onMouseOver="hilite(244)" onMouseOut="lolite()" onClick="logVariable('v')" href="../../../_variables/v.html">$v</a> == 0 )
<a name="l728"><span class="linenum"> 728</span></a>                              {    // Update field with first value
<a name="l729"><span class="linenum"> 729</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_update')" href="../../../_functions/userfield_update.html" onMouseOver="funcPopup(event,'userfield_update')">userfield_update</a>( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> );
<a name="l730"><span class="linenum"> 730</span></a>                              }
<a name="l731"><span class="linenum"> 731</span></a>                              else if( !empty( <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> ) )
<a name="l732"><span class="linenum"> 732</span></a>                              {    // Add a new field for new values
<a name="l733"><span class="linenum"> 733</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_add')" href="../../../_functions/userfield_add.html" onMouseOver="funcPopup(event,'userfield_add')">userfield_add</a>( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>, <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> );
<a name="l734"><span class="linenum"> 734</span></a>                              }
<a name="l735"><span class="linenum"> 735</span></a>                          }
<a name="l736"><span class="linenum"> 736</span></a>                      }
<a name="l737"><span class="linenum"> 737</span></a>                      else
<a name="l738"><span class="linenum"> 738</span></a>                      {    // Forbidden &amp; Allowed fields
<a name="l739"><span class="linenum"> 739</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_update')" href="../../../_functions/userfield_update.html" onMouseOver="funcPopup(event,'userfield_update')">userfield_update</a>( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> );
<a name="l740"><span class="linenum"> 740</span></a>                      }
<a name="l741"><span class="linenum"> 741</span></a>                  }
<a name="l742"><span class="linenum"> 742</span></a>              }
<a name="l743"><span class="linenum"> 743</span></a>  
<a name="l744"><span class="linenum"> 744</span></a>  <span class="comment">            // Duplicate fields:</span>
<a name="l745"><span class="linenum"> 745</span></a>              if( <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> )
<a name="l746"><span class="linenum"> 746</span></a>              {
<a name="l747"><span class="linenum"> 747</span></a>                  <a class="var it2593" onMouseOver="hilite(2593)" onMouseOut="lolite()" onClick="logVariable('user_id')" href="../../../_variables/user_id.html">$user_id</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'orig_user_ID', 'integer', 0 );
<a name="l748"><span class="linenum"> 748</span></a>                  if( <a class="var it2593" onMouseOver="hilite(2593)" onMouseOut="lolite()" onClick="logVariable('user_id')" href="../../../_variables/user_id.html">$user_id</a> !== 0 )
<a name="l749"><span class="linenum"> 749</span></a>                  {
<a name="l750"><span class="linenum"> 750</span></a>                      <a class="var it3897" onMouseOver="hilite(3897)" onMouseOut="lolite()" onClick="logVariable('userfield_IDs')" href="../../../_variables/userfield_IDs.html">$userfield_IDs</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( '
<a name="l751"><span class="linenum"> 751</span></a>                                  SELECT uf_ID, uf_ufdf_ID
<a name="l752"><span class="linenum"> 752</span></a>                                      FROM T_users__fields
<a name="l753"><span class="linenum"> 753</span></a>                                   WHERE uf_user_ID = '.<a class="var it2593" onMouseOver="hilite(2593)" onMouseOut="lolite()" onClick="logVariable('user_id')" href="../../../_variables/user_id.html">$user_id</a> );
<a name="l754"><span class="linenum"> 754</span></a>                      foreach( <a class="var it3897" onMouseOver="hilite(3897)" onMouseOut="lolite()" onClick="logVariable('userfield_IDs')" href="../../../_variables/userfield_IDs.html">$userfield_IDs</a> as <a class="var it3900" onMouseOver="hilite(3900)" onMouseOut="lolite()" onClick="logVariable('userfield_ID')" href="../../../_variables/userfield_ID.html">$userfield_ID</a> )
<a name="l755"><span class="linenum"> 755</span></a>                      {
<a name="l756"><span class="linenum"> 756</span></a>                          <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'uf_'.<a class="var it3900" onMouseOver="hilite(3900)" onMouseOut="lolite()" onClick="logVariable('userfield_ID')" href="../../../_variables/userfield_ID.html">$userfield_ID</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10938" onMouseOver="hilite(10938)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>, 'string', '' );
<a name="l757"><span class="linenum"> 757</span></a>                          <a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a> = <a class="var it3900" onMouseOver="hilite(3900)" onMouseOut="lolite()" onClick="logVariable('userfield_ID')" href="../../../_variables/userfield_ID.html">$userfield_ID</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10938" onMouseOver="hilite(10938)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a>;
<a name="l758"><span class="linenum"> 758</span></a>                          if( !empty(<a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a>) )
<a name="l759"><span class="linenum"> 759</span></a>                          {
<a name="l760"><span class="linenum"> 760</span></a>                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_add')" href="../../../_functions/userfield_add.html" onMouseOver="funcPopup(event,'userfield_add')">userfield_add</a>( <a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a>, <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> );
<a name="l761"><span class="linenum"> 761</span></a>                          }
<a name="l762"><span class="linenum"> 762</span></a>                      }
<a name="l763"><span class="linenum"> 763</span></a>                  }
<a name="l764"><span class="linenum"> 764</span></a>              }
<a name="l765"><span class="linenum"> 765</span></a>  
<a name="l766"><span class="linenum"> 766</span></a>              <a class="var it3325" onMouseOver="hilite(3325)" onMouseOut="lolite()" onClick="logVariable('uf_new_fields')" href="../../../_variables/uf_new_fields.html">$uf_new_fields</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'uf_new', 'array:array:string' );    <span class="comment">// Recommended &amp; required fields (it still not saved in DB)</span>
<a name="l767"><span class="linenum"> 767</span></a>              <a class="var it3902" onMouseOver="hilite(3902)" onMouseOut="lolite()" onClick="logVariable('uf_add_fields')" href="../../../_variables/uf_add_fields.html">$uf_add_fields</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'uf_add', 'array:array:string' );    <span class="comment">// Added fields</span>
<a name="l768"><span class="linenum"> 768</span></a>  
<a name="l769"><span class="linenum"> 769</span></a>  <span class="comment">            // Add a new field: (JS is not enabled)</span>
<a name="l770"><span class="linenum"> 770</span></a>              if( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a> == 'add_field' )
<a name="l771"><span class="linenum"> 771</span></a>              {    // Button 'Add' new field is pressed
<a name="l772"><span class="linenum"> 772</span></a>                  <a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'new_field_type', 'integer', 0 );
<a name="l773"><span class="linenum"> 773</span></a>                  if( empty( <a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a> ) )
<a name="l774"><span class="linenum"> 774</span></a>                  {    // We cannot add a new field without type
<a name="l775"><span class="linenum"> 775</span></a>                      <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'new_field_type', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select a field type.') );
<a name="l776"><span class="linenum"> 776</span></a>                  }
<a name="l777"><span class="linenum"> 777</span></a>                  else
<a name="l778"><span class="linenum"> 778</span></a>                  {    // Save an adding field(in the array) to display it again if errors will be exist
<a name="l779"><span class="linenum"> 779</span></a>                      <a class="var it3903" onMouseOver="hilite(3903)" onMouseOut="lolite()" onClick="logVariable('new_field_type_exists')" href="../../../_variables/new_field_type_exists.html">$new_field_type_exists</a> = false;
<a name="l780"><span class="linenum"> 780</span></a>  
<a name="l781"><span class="linenum"> 781</span></a>                      if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a>][4] == 'allowed' || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a>][4] == 'list' )
<a name="l782"><span class="linenum"> 782</span></a>                      {    // This field can be duplicated
<a name="l783"><span class="linenum"> 783</span></a>                          global <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a>;
<a name="l784"><span class="linenum"> 784</span></a>                          <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a> = array( <a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a> );
<a name="l785"><span class="linenum"> 785</span></a>                      }
<a name="l786"><span class="linenum"> 786</span></a>                      else
<a name="l787"><span class="linenum"> 787</span></a>                      {    // We should to solve we can add this field or don't
<a name="l788"><span class="linenum"> 788</span></a>                          if( ! isset( <a class="var it3325" onMouseOver="hilite(3325)" onMouseOut="lolite()" onClick="logVariable('uf_new_fields')" href="../../../_variables/uf_new_fields.html">$uf_new_fields</a>[<a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a>] ) &amp;&amp; ! isset( <a class="var it3902" onMouseOver="hilite(3902)" onMouseOut="lolite()" onClick="logVariable('uf_add_fields')" href="../../../_variables/uf_add_fields.html">$uf_add_fields</a>[<a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a>] ) )
<a name="l789"><span class="linenum"> 789</span></a>                          {    // User is adding this field first time
<a name="l790"><span class="linenum"> 790</span></a>                              if( <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>( <a class="var it3897" onMouseOver="hilite(3897)" onMouseOut="lolite()" onClick="logVariable('userfield_IDs')" href="../../../_variables/userfield_IDs.html">$userfield_IDs</a> ) &amp;&amp; <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it3897" onMouseOver="hilite(3897)" onMouseOut="lolite()" onClick="logVariable('userfield_IDs')" href="../../../_variables/userfield_IDs.html">$userfield_IDs</a> ) &gt; 0 )
<a name="l791"><span class="linenum"> 791</span></a>                              {    // User has fields that saved in DB
<a name="l792"><span class="linenum"> 792</span></a>                                  foreach( <a class="var it3897" onMouseOver="hilite(3897)" onMouseOut="lolite()" onClick="logVariable('userfield_IDs')" href="../../../_variables/userfield_IDs.html">$userfield_IDs</a> as <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a> )
<a name="l793"><span class="linenum"> 793</span></a>                                  {
<a name="l794"><span class="linenum"> 794</span></a>                                      if( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ufdf_ID.html">uf_ufdf_ID</a> == <a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a> )
<a name="l795"><span class="linenum"> 795</span></a>                                      {    // New adding field already exists for current user in DB
<a name="l796"><span class="linenum"> 796</span></a>                                          <a class="var it3903" onMouseOver="hilite(3903)" onMouseOut="lolite()" onClick="logVariable('new_field_type_exists')" href="../../../_variables/new_field_type_exists.html">$new_field_type_exists</a> = true;
<a name="l797"><span class="linenum"> 797</span></a>                                          break;
<a name="l798"><span class="linenum"> 798</span></a>                                      }
<a name="l799"><span class="linenum"> 799</span></a>                                  }
<a name="l800"><span class="linenum"> 800</span></a>                              }
<a name="l801"><span class="linenum"> 801</span></a>                              if( ! <a class="var it3903" onMouseOver="hilite(3903)" onMouseOut="lolite()" onClick="logVariable('new_field_type_exists')" href="../../../_variables/new_field_type_exists.html">$new_field_type_exists</a> )
<a name="l802"><span class="linenum"> 802</span></a>                              {    // Field doesn't still exist for current user
<a name="l803"><span class="linenum"> 803</span></a>                                  global <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a>;
<a name="l804"><span class="linenum"> 804</span></a>                                  <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a> = array( <a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a> );
<a name="l805"><span class="linenum"> 805</span></a>                              }
<a name="l806"><span class="linenum"> 806</span></a>                          }
<a name="l807"><span class="linenum"> 807</span></a>                          else
<a name="l808"><span class="linenum"> 808</span></a>                          {    // Field exists, no duplicates available
<a name="l809"><span class="linenum"> 809</span></a>                              <a class="var it3903" onMouseOver="hilite(3903)" onMouseOut="lolite()" onClick="logVariable('new_field_type_exists')" href="../../../_variables/new_field_type_exists.html">$new_field_type_exists</a> = true;
<a name="l810"><span class="linenum"> 810</span></a>                          }
<a name="l811"><span class="linenum"> 811</span></a>  
<a name="l812"><span class="linenum"> 812</span></a>                          if( <a class="var it3903" onMouseOver="hilite(3903)" onMouseOut="lolite()" onClick="logVariable('new_field_type_exists')" href="../../../_variables/new_field_type_exists.html">$new_field_type_exists</a> )
<a name="l813"><span class="linenum"> 813</span></a>                          {    // Field already is added for current user, we should display error about this
<a name="l814"><span class="linenum"> 814</span></a>                              <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'new_field_type', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You already added this field, please select another.') );
<a name="l815"><span class="linenum"> 815</span></a>                          }
<a name="l816"><span class="linenum"> 816</span></a>                      }
<a name="l817"><span class="linenum"> 817</span></a>  
<a name="l818"><span class="linenum"> 818</span></a>                      if( ! <a class="var it3903" onMouseOver="hilite(3903)" onMouseOut="lolite()" onClick="logVariable('new_field_type_exists')" href="../../../_variables/new_field_type_exists.html">$new_field_type_exists</a> )
<a name="l819"><span class="linenum"> 819</span></a>                      {    // Mark a new field to enter a value
<a name="l820"><span class="linenum"> 820</span></a>                          <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'uf_add['.<a class="var it3326" onMouseOver="hilite(3326)" onMouseOut="lolite()" onClick="logVariable('new_field_type')" href="../../../_variables/new_field_type.html">$new_field_type</a>.'][]', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter a value in this new field.') );
<a name="l821"><span class="linenum"> 821</span></a>                      }
<a name="l822"><span class="linenum"> 822</span></a>                  }
<a name="l823"><span class="linenum"> 823</span></a>              }
<a name="l824"><span class="linenum"> 824</span></a>  
<a name="l825"><span class="linenum"> 825</span></a>  <span class="comment">            // Save a New recommended &amp; require fields AND Adding fields</span>
<a name="l826"><span class="linenum"> 826</span></a>              if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it3325" onMouseOver="hilite(3325)" onMouseOut="lolite()" onClick="logVariable('uf_new_fields')" href="../../../_variables/uf_new_fields.html">$uf_new_fields</a> ) &gt; 0 || <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it3902" onMouseOver="hilite(3902)" onMouseOut="lolite()" onClick="logVariable('uf_add_fields')" href="../../../_variables/uf_add_fields.html">$uf_add_fields</a> ) &gt; 0 )
<a name="l827"><span class="linenum"> 827</span></a>              {
<a name="l828"><span class="linenum"> 828</span></a>                  <a class="var it3904" onMouseOver="hilite(3904)" onMouseOut="lolite()" onClick="logVariable('uf_fields')" href="../../../_variables/uf_fields.html">$uf_fields</a> = array(
<a name="l829"><span class="linenum"> 829</span></a>                      'new' =&gt; <a class="var it3325" onMouseOver="hilite(3325)" onMouseOut="lolite()" onClick="logVariable('uf_new_fields')" href="../../../_variables/uf_new_fields.html">$uf_new_fields</a>,
<a name="l830"><span class="linenum"> 830</span></a>                      'add' =&gt; <a class="var it3902" onMouseOver="hilite(3902)" onMouseOut="lolite()" onClick="logVariable('uf_add_fields')" href="../../../_variables/uf_add_fields.html">$uf_add_fields</a>
<a name="l831"><span class="linenum"> 831</span></a>                  );
<a name="l832"><span class="linenum"> 832</span></a>                  foreach( <a class="var it3904" onMouseOver="hilite(3904)" onMouseOut="lolite()" onClick="logVariable('uf_fields')" href="../../../_variables/uf_fields.html">$uf_fields</a> as <a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a> =&gt; <a class="var it3325" onMouseOver="hilite(3325)" onMouseOut="lolite()" onClick="logVariable('uf_new_fields')" href="../../../_variables/uf_new_fields.html">$uf_new_fields</a> )
<a name="l833"><span class="linenum"> 833</span></a>                  {
<a name="l834"><span class="linenum"> 834</span></a>                      if( <a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a> == 'add' )
<a name="l835"><span class="linenum"> 835</span></a>                      {    // Save an adding fields to display it again if errors will be exist
<a name="l836"><span class="linenum"> 836</span></a>                          global <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a>;
<a name="l837"><span class="linenum"> 837</span></a>                          if( ! isset( <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a> ) )
<a name="l838"><span class="linenum"> 838</span></a>                          {    // Don't rewrite already existing array
<a name="l839"><span class="linenum"> 839</span></a>                              <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a> = array();
<a name="l840"><span class="linenum"> 840</span></a>                          }
<a name="l841"><span class="linenum"> 841</span></a>                      }
<a name="l842"><span class="linenum"> 842</span></a>                      foreach( <a class="var it3325" onMouseOver="hilite(3325)" onMouseOut="lolite()" onClick="logVariable('uf_new_fields')" href="../../../_variables/uf_new_fields.html">$uf_new_fields</a> as <a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a> =&gt; <a class="var it3906" onMouseOver="hilite(3906)" onMouseOut="lolite()" onClick="logVariable('uf_new_vals')" href="../../../_variables/uf_new_vals.html">$uf_new_vals</a> )
<a name="l843"><span class="linenum"> 843</span></a>                      {
<a name="l844"><span class="linenum"> 844</span></a>                          foreach( <a class="var it3906" onMouseOver="hilite(3906)" onMouseOut="lolite()" onClick="logVariable('uf_new_vals')" href="../../../_variables/uf_new_vals.html">$uf_new_vals</a> as <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> )
<a name="l845"><span class="linenum"> 845</span></a>                          {
<a name="l846"><span class="linenum"> 846</span></a>                              if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>][0] == 'list' &amp;&amp; <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> == '---' )
<a name="l847"><span class="linenum"> 847</span></a>                              {    // Option list has a value '---' for empty value
<a name="l848"><span class="linenum"> 848</span></a>                                  <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> = '';
<a name="l849"><span class="linenum"> 849</span></a>                              }
<a name="l850"><span class="linenum"> 850</span></a>  
<a name="l851"><span class="linenum"> 851</span></a>                              <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="phpfunction" onClick="logFunction('strip_tags')" href="../../../_functions/strip_tags.html" onMouseOver="phpfuncPopup(event,'strip_tags')">strip_tags</a>( <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> ) );
<a name="l852"><span class="linenum"> 852</span></a>                              if( <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> != '' )
<a name="l853"><span class="linenum"> 853</span></a>                              {    // Insert a new field in DB if it is filled
<a name="l854"><span class="linenum"> 854</span></a>                                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>][0] == 'url' )
<a name="l855"><span class="linenum"> 855</span></a>                                  {    // Check url fields
<a name="l856"><span class="linenum"> 856</span></a>                                      <a class="function" onClick="logFunction('param_check_url')" href="../../../_functions/param_check_url.html" onMouseOver="funcPopup(event,'param_check_url')">param_check_url</a>( 'uf_'.<a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a>.'['.<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>.'][]', 'commenting' );
<a name="l857"><span class="linenum"> 857</span></a>                                  }
<a name="l858"><span class="linenum"> 858</span></a>                                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>][4] == 'list' )
<a name="l859"><span class="linenum"> 859</span></a>                                  {    // Option &quot;Multiple values&quot; == &quot;List style&quot;
<a name="l860"><span class="linenum"> 860</span></a>  <span class="comment">                                    // Split by comma and save each phrase as separate field</span>
<a name="l861"><span class="linenum"> 861</span></a>                                      <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( ',', <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> );
<a name="l862"><span class="linenum"> 862</span></a>                                      foreach( <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> as <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> )
<a name="l863"><span class="linenum"> 863</span></a>                                      {
<a name="l864"><span class="linenum"> 864</span></a>                                          <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> );
<a name="l865"><span class="linenum"> 865</span></a>                                          if( !empty( <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> ) )
<a name="l866"><span class="linenum"> 866</span></a>                                          {    // Exclude empty values(spaces)
<a name="l867"><span class="linenum"> 867</span></a>                                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_add')" href="../../../_functions/userfield_add.html" onMouseOver="funcPopup(event,'userfield_add')">userfield_add</a>( (int)<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>, <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> );
<a name="l868"><span class="linenum"> 868</span></a>                                          }
<a name="l869"><span class="linenum"> 869</span></a>                                      }
<a name="l870"><span class="linenum"> 870</span></a>                                  }
<a name="l871"><span class="linenum"> 871</span></a>                                  else
<a name="l872"><span class="linenum"> 872</span></a>                                  {    // Forbidden &amp; Allowed fields
<a name="l873"><span class="linenum"> 873</span></a>                                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_add')" href="../../../_functions/userfield_add.html" onMouseOver="funcPopup(event,'userfield_add')">userfield_add</a>( (int)<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>, <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> );
<a name="l874"><span class="linenum"> 874</span></a>                                  }
<a name="l875"><span class="linenum"> 875</span></a>                              }
<a name="l876"><span class="linenum"> 876</span></a>                              elseif( empty( <a class="var it3907" onMouseOver="hilite(3907)" onMouseOut="lolite()" onClick="logVariable('uf_new_val')" href="../../../_variables/uf_new_val.html">$uf_new_val</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>][2] == 'require' )
<a name="l877"><span class="linenum"> 877</span></a>                              {    // Display error for empty required field &amp; new adding field
<a name="l878"><span class="linenum"> 878</span></a>                                  if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) )
<a name="l879"><span class="linenum"> 879</span></a>                                  {    // Display a note message if user can edit all users
<a name="l880"><span class="linenum"> 880</span></a>                                      <a class="function" onClick="logFunction('param_add_message_to_Log')" href="../../../_functions/param_add_message_to_log.html" onMouseOver="funcPopup(event,'param_add_message_to_log')">param_add_message_to_Log</a>( 'uf_'.<a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a>.'['.<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>.'][]', sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter a value for the field &quot;%s&quot;.'), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>][1] ), 'note' );
<a name="l881"><span class="linenum"> 881</span></a>                                  }
<a name="l882"><span class="linenum"> 882</span></a>                                  else
<a name="l883"><span class="linenum"> 883</span></a>                                  {    // Display an error message
<a name="l884"><span class="linenum"> 884</span></a>                                      <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'uf_'.<a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a>.'['.<a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>.'][]', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter a value.') );
<a name="l885"><span class="linenum"> 885</span></a>                                  }
<a name="l886"><span class="linenum"> 886</span></a>                              }
<a name="l887"><span class="linenum"> 887</span></a>  
<a name="l888"><span class="linenum"> 888</span></a>                              if( <a class="var it3901" onMouseOver="hilite(3901)" onMouseOut="lolite()" onClick="logVariable('uf_type')" href="../../../_variables/uf_type.html">$uf_type</a> == 'add' )
<a name="l889"><span class="linenum"> 889</span></a>                              {    // Save new added field, it used on the _user_identity.form
<a name="l890"><span class="linenum"> 890</span></a>                                  <a class="var it2594" onMouseOver="hilite(2594)" onMouseOut="lolite()" onClick="logVariable('add_field_types')" href="../../../_variables/add_field_types.html">$add_field_types</a>[] = <a class="var it3905" onMouseOver="hilite(3905)" onMouseOut="lolite()" onClick="logVariable('uf_new_id')" href="../../../_variables/uf_new_id.html">$uf_new_id</a>;
<a name="l891"><span class="linenum"> 891</span></a>                              }
<a name="l892"><span class="linenum"> 892</span></a>                          }
<a name="l893"><span class="linenum"> 893</span></a>                      }
<a name="l894"><span class="linenum"> 894</span></a>                  }
<a name="l895"><span class="linenum"> 895</span></a>              }
<a name="l896"><span class="linenum"> 896</span></a>  <span class="comment">            // ---- Additional Fields / END ----</span>
<a name="l897"><span class="linenum"> 897</span></a>  
<a name="l898"><span class="linenum"> 898</span></a>  <span class="comment">            // update profileupdate_date, because a publicly visible user property was changed</span>
<a name="l899"><span class="linenum"> 899</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_profileupdate_date')" href="../../../_functions/set_profileupdate_date.html" onMouseOver="funcPopup(event,'set_profileupdate_date')">set_profileupdate_date</a>();
<a name="l900"><span class="linenum"> 900</span></a>          }
<a name="l901"><span class="linenum"> 901</span></a>  
<a name="l902"><span class="linenum"> 902</span></a>  <span class="comment">        // ******* Password form ******* //</span>
<a name="l903"><span class="linenum"> 903</span></a>  
<a name="l904"><span class="linenum"> 904</span></a>          <a class="var it3908" onMouseOver="hilite(3908)" onMouseOut="lolite()" onClick="logVariable('is_password_form')" href="../../../_variables/is_password_form.html">$is_password_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'password_form', 'boolean', false );
<a name="l905"><span class="linenum"> 905</span></a>          if( <a class="var it3908" onMouseOver="hilite(3908)" onMouseOut="lolite()" onClick="logVariable('is_password_form')" href="../../../_variables/is_password_form.html">$is_password_form</a> || <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> )
<a name="l906"><span class="linenum"> 906</span></a>          {
<a name="l907"><span class="linenum"> 907</span></a>              <a class="var it2724" onMouseOver="hilite(2724)" onMouseOut="lolite()" onClick="logVariable('reqID')" href="../../../_variables/reqID.html">$reqID</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'reqID', 'string', '' );
<a name="l908"><span class="linenum"> 908</span></a>  
<a name="l909"><span class="linenum"> 909</span></a>              global <a class="var it3909" onMouseOver="hilite(3909)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass1')" href="../../../_variables/edited_user_pass1.html">$edited_user_pass1</a>, <a class="var it3910" onMouseOver="hilite(3910)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass2')" href="../../../_variables/edited_user_pass2.html">$edited_user_pass2</a>;
<a name="l910"><span class="linenum"> 910</span></a>  
<a name="l911"><span class="linenum"> 911</span></a>              <a class="var it3909" onMouseOver="hilite(3909)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass1')" href="../../../_variables/edited_user_pass1.html">$edited_user_pass1</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_pass1', 'string', true );
<a name="l912"><span class="linenum"> 912</span></a>              <a class="var it3910" onMouseOver="hilite(3910)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass2')" href="../../../_variables/edited_user_pass2.html">$edited_user_pass2</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_pass2', 'string', true );
<a name="l913"><span class="linenum"> 913</span></a>  
<a name="l914"><span class="linenum"> 914</span></a>  <span class="comment">            // Remove the invalid chars from password vars</span>
<a name="l915"><span class="linenum"> 915</span></a>              <a class="var it3909" onMouseOver="hilite(3909)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass1')" href="../../../_variables/edited_user_pass1.html">$edited_user_pass1</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( '/[&lt;&gt;&amp;]/', '', <a class="var it3909" onMouseOver="hilite(3909)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass1')" href="../../../_variables/edited_user_pass1.html">$edited_user_pass1</a> );
<a name="l916"><span class="linenum"> 916</span></a>              <a class="var it3910" onMouseOver="hilite(3910)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass2')" href="../../../_variables/edited_user_pass2.html">$edited_user_pass2</a> = <a class="phpfunction" onClick="logFunction('preg_replace')" href="../../../_functions/preg_replace.html" onMouseOver="phpfuncPopup(event,'preg_replace')">preg_replace</a>( '/[&lt;&gt;&amp;]/', '', <a class="var it3910" onMouseOver="hilite(3910)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass2')" href="../../../_variables/edited_user_pass2.html">$edited_user_pass2</a> );
<a name="l917"><span class="linenum"> 917</span></a>  
<a name="l918"><span class="linenum"> 918</span></a>              if( <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> || ( !empty( <a class="var it2724" onMouseOver="hilite(2724)" onMouseOut="lolite()" onClick="logVariable('reqID')" href="../../../_variables/reqID.html">$reqID</a> ) &amp;&amp; <a class="var it2724" onMouseOver="hilite(2724)" onMouseOut="lolite()" onClick="logVariable('reqID')" href="../../../_variables/reqID.html">$reqID</a> == <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'core.changepwd.request_id' ) ) )
<a name="l919"><span class="linenum"> 919</span></a>              { // current password is not required:
<a name="l920"><span class="linenum"> 920</span></a>  <span class="comment">                //   - new user creating process</span>
<a name="l921"><span class="linenum"> 921</span></a>  <span class="comment">                //   - password change requested by email</span>
<a name="l922"><span class="linenum"> 922</span></a>  
<a name="l923"><span class="linenum"> 923</span></a>                  if( <a class="function" onClick="logFunction('param_check_passwords')" href="../../../_functions/param_check_passwords.html" onMouseOver="funcPopup(event,'param_check_passwords')">param_check_passwords</a>( 'edited_user_pass1', 'edited_user_pass2', true, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('user_minpwdlen') ) )
<a name="l924"><span class="linenum"> 924</span></a>                  { // We can set password
<a name="l925"><span class="linenum"> 925</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_password')" href="../../../_functions/set_password.html" onMouseOver="funcPopup(event,'set_password')">set_password</a>( <a class="var it3910" onMouseOver="hilite(3910)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass2')" href="../../../_variables/edited_user_pass2.html">$edited_user_pass2</a> );
<a name="l926"><span class="linenum"> 926</span></a>                  }
<a name="l927"><span class="linenum"> 927</span></a>              }
<a name="l928"><span class="linenum"> 928</span></a>              else
<a name="l929"><span class="linenum"> 929</span></a>              {
<a name="l930"><span class="linenum"> 930</span></a>  <span class="comment">                // ******* Password edit form ****** //</span>
<a name="l931"><span class="linenum"> 931</span></a>  
<a name="l932"><span class="linenum"> 932</span></a>                  <a class="var it3911" onMouseOver="hilite(3911)" onMouseOut="lolite()" onClick="logVariable('current_user_pass')" href="../../../_variables/current_user_pass.html">$current_user_pass</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'current_user_pass', 'string', true );
<a name="l933"><span class="linenum"> 933</span></a>  
<a name="l934"><span class="linenum"> 934</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l935"><span class="linenum"> 935</span></a>                  { // Set the messages when admin changes a password of other user
<a name="l936"><span class="linenum"> 936</span></a>                      <a class="var it3912" onMouseOver="hilite(3912)" onMouseOut="lolite()" onClick="logVariable('checkpwd_params')" href="../../../_variables/checkpwd_params.html">$checkpwd_params</a> = array(
<a name="l937"><span class="linenum"> 937</span></a>                              'msg_pass_new'   =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter new password.'),
<a name="l938"><span class="linenum"> 938</span></a>                              'msg_pass_twice' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter new password twice.'),
<a name="l939"><span class="linenum"> 939</span></a>                          );
<a name="l940"><span class="linenum"> 940</span></a>                  }
<a name="l941"><span class="linenum"> 941</span></a>                  else
<a name="l942"><span class="linenum"> 942</span></a>                  { // Use default messages
<a name="l943"><span class="linenum"> 943</span></a>                      <a class="var it3912" onMouseOver="hilite(3912)" onMouseOut="lolite()" onClick="logVariable('checkpwd_params')" href="../../../_variables/checkpwd_params.html">$checkpwd_params</a> = array();
<a name="l944"><span class="linenum"> 944</span></a>                  }
<a name="l945"><span class="linenum"> 945</span></a>  
<a name="l946"><span class="linenum"> 946</span></a>                  if( ! strlen( <a class="var it3911" onMouseOver="hilite(3911)" onMouseOut="lolite()" onClick="logVariable('current_user_pass')" href="../../../_variables/current_user_pass.html">$current_user_pass</a> ) )
<a name="l947"><span class="linenum"> 947</span></a>                  {
<a name="l948"><span class="linenum"> 948</span></a>                      <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>( 'current_user_pass' , <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your current password.') );
<a name="l949"><span class="linenum"> 949</span></a>                      <a class="function" onClick="logFunction('param_check_passwords')" href="../../../_functions/param_check_passwords.html" onMouseOver="funcPopup(event,'param_check_passwords')">param_check_passwords</a>( 'edited_user_pass1', 'edited_user_pass2', true, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('user_minpwdlen'), <a class="var it3912" onMouseOver="hilite(3912)" onMouseOut="lolite()" onClick="logVariable('checkpwd_params')" href="../../../_variables/checkpwd_params.html">$checkpwd_params</a> );
<a name="l950"><span class="linenum"> 950</span></a>                  }
<a name="l951"><span class="linenum"> 951</span></a>                  else
<a name="l952"><span class="linenum"> 952</span></a>                  {
<a name="l953"><span class="linenum"> 953</span></a>                      if( <a class="var it2549" onMouseOver="hilite(2549)" onMouseOut="lolite()" onClick="logVariable('has_full_access')" href="../../../_variables/has_full_access.html">$has_full_access</a> &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l954"><span class="linenum"> 954</span></a>                      { // Admin is changing a password of other user, Check a password of current admin
<a name="l955"><span class="linenum"> 955</span></a>                          <a class="var it3913" onMouseOver="hilite(3913)" onMouseOut="lolite()" onClick="logVariable('pass_to_check')" href="../../../_variables/pass_to_check.html">$pass_to_check</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('pass')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/pass.html">pass</a>;
<a name="l956"><span class="linenum"> 956</span></a>                          <a class="var it3914" onMouseOver="hilite(3914)" onMouseOut="lolite()" onClick="logVariable('current_user_salt')" href="../../../_variables/current_user_salt.html">$current_user_salt</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('salt')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/salt.html">salt</a>;
<a name="l957"><span class="linenum"> 957</span></a>                      }
<a name="l958"><span class="linenum"> 958</span></a>                      else
<a name="l959"><span class="linenum"> 959</span></a>                      { // User is changing own pasword
<a name="l960"><span class="linenum"> 960</span></a>                          <a class="var it3913" onMouseOver="hilite(3913)" onMouseOut="lolite()" onClick="logVariable('pass_to_check')" href="../../../_variables/pass_to_check.html">$pass_to_check</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pass')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/pass.html">pass</a>;
<a name="l961"><span class="linenum"> 961</span></a>                          <a class="var it3914" onMouseOver="hilite(3914)" onMouseOut="lolite()" onClick="logVariable('current_user_salt')" href="../../../_variables/current_user_salt.html">$current_user_salt</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('salt')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/salt.html">salt</a>;
<a name="l962"><span class="linenum"> 962</span></a>                      }
<a name="l963"><span class="linenum"> 963</span></a>                      if( <a class="var it3913" onMouseOver="hilite(3913)" onMouseOut="lolite()" onClick="logVariable('pass_to_check')" href="../../../_variables/pass_to_check.html">$pass_to_check</a> == md5( <a class="var it3914" onMouseOver="hilite(3914)" onMouseOut="lolite()" onClick="logVariable('current_user_salt')" href="../../../_variables/current_user_salt.html">$current_user_salt</a>.<a class="var it3911" onMouseOver="hilite(3911)" onMouseOut="lolite()" onClick="logVariable('current_user_pass')" href="../../../_variables/current_user_pass.html">$current_user_pass</a>, true ) )
<a name="l964"><span class="linenum"> 964</span></a>                      {
<a name="l965"><span class="linenum"> 965</span></a>                          if( <a class="function" onClick="logFunction('param_check_passwords')" href="../../../_functions/param_check_passwords.html" onMouseOver="funcPopup(event,'param_check_passwords')">param_check_passwords</a>( 'edited_user_pass1', 'edited_user_pass2', true, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('user_minpwdlen'), <a class="var it3912" onMouseOver="hilite(3912)" onMouseOut="lolite()" onClick="logVariable('checkpwd_params')" href="../../../_variables/checkpwd_params.html">$checkpwd_params</a> ) )
<a name="l966"><span class="linenum"> 966</span></a>                          { // We can set password
<a name="l967"><span class="linenum"> 967</span></a>                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_password')" href="../../../_functions/set_password.html" onMouseOver="funcPopup(event,'set_password')">set_password</a>( <a class="var it3910" onMouseOver="hilite(3910)" onMouseOut="lolite()" onClick="logVariable('edited_user_pass2')" href="../../../_variables/edited_user_pass2.html">$edited_user_pass2</a> );
<a name="l968"><span class="linenum"> 968</span></a>                          }
<a name="l969"><span class="linenum"> 969</span></a>                      }
<a name="l970"><span class="linenum"> 970</span></a>                      else
<a name="l971"><span class="linenum"> 971</span></a>                      {
<a name="l972"><span class="linenum"> 972</span></a>                          <a class="function" onClick="logFunction('param_error')" href="../../../_functions/param_error.html" onMouseOver="funcPopup(event,'param_error')">param_error</a>('current_user_pass' , <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Your current password is incorrect.') );
<a name="l973"><span class="linenum"> 973</span></a>                          <a class="function" onClick="logFunction('param_check_passwords')" href="../../../_functions/param_check_passwords.html" onMouseOver="funcPopup(event,'param_check_passwords')">param_check_passwords</a>( 'edited_user_pass1', 'edited_user_pass2', true, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('user_minpwdlen'), <a class="var it3912" onMouseOver="hilite(3912)" onMouseOut="lolite()" onClick="logVariable('checkpwd_params')" href="../../../_variables/checkpwd_params.html">$checkpwd_params</a> );
<a name="l974"><span class="linenum"> 974</span></a>                      }
<a name="l975"><span class="linenum"> 975</span></a>                  }
<a name="l976"><span class="linenum"> 976</span></a>  
<a name="l977"><span class="linenum"> 977</span></a>              }
<a name="l978"><span class="linenum"> 978</span></a>          }
<a name="l979"><span class="linenum"> 979</span></a>  
<a name="l980"><span class="linenum"> 980</span></a>  
<a name="l981"><span class="linenum"> 981</span></a>  <span class="comment">        // Used in Preferences &amp; Notifications forms</span>
<a name="l982"><span class="linenum"> 982</span></a>          <a class="var it3915" onMouseOver="hilite(3915)" onMouseOut="lolite()" onClick="logVariable('has_messaging_perm')" href="../../../_variables/has_messaging_perm.html">$has_messaging_perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'reply' );
<a name="l983"><span class="linenum"> 983</span></a>  
<a name="l984"><span class="linenum"> 984</span></a>  <span class="comment">        // ******* Preferences form ******* //</span>
<a name="l985"><span class="linenum"> 985</span></a>  
<a name="l986"><span class="linenum"> 986</span></a>          <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('is_preferences_form')" href="../../../_variables/is_preferences_form.html">$is_preferences_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'preferences_form', 'boolean', false );
<a name="l987"><span class="linenum"> 987</span></a>  
<a name="l988"><span class="linenum"> 988</span></a>          if( <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('is_preferences_form')" href="../../../_variables/is_preferences_form.html">$is_preferences_form</a> )
<a name="l989"><span class="linenum"> 989</span></a>          {
<a name="l990"><span class="linenum"> 990</span></a>  <span class="comment">            // Other preferences</span>
<a name="l991"><span class="linenum"> 991</span></a>              <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_locale', 'string', true );
<a name="l992"><span class="linenum"> 992</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_from_Request')" href="../../../_functions/set_from_request.html" onMouseOver="funcPopup(event,'set_from_request')">set_from_Request</a>('locale', 'edited_user_locale', true);
<a name="l993"><span class="linenum"> 993</span></a>  
<a name="l994"><span class="linenum"> 994</span></a>  <span class="comment">            // Session timeout</span>
<a name="l995"><span class="linenum"> 995</span></a>              <a class="var it3917" onMouseOver="hilite(3917)" onMouseOut="lolite()" onClick="logVariable('edited_user_timeout_sessions')" href="../../../_variables/edited_user_timeout_sessions.html">$edited_user_timeout_sessions</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_timeout_sessions', 'string', NULL );
<a name="l996"><span class="linenum"> 996</span></a>              if( isset( <a class="var it3917" onMouseOver="hilite(3917)" onMouseOut="lolite()" onClick="logVariable('edited_user_timeout_sessions')" href="../../../_variables/edited_user_timeout_sessions.html">$edited_user_timeout_sessions</a> ) &amp;&amp; ( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>  || <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) ) )
<a name="l997"><span class="linenum"> 997</span></a>              {
<a name="l998"><span class="linenum"> 998</span></a>                  switch( <a class="var it3917" onMouseOver="hilite(3917)" onMouseOut="lolite()" onClick="logVariable('edited_user_timeout_sessions')" href="../../../_variables/edited_user_timeout_sessions.html">$edited_user_timeout_sessions</a> )
<a name="l999"><span class="linenum"> 999</span></a>                  {
<a name="l1000"><span class="linenum">1000</span></a>                      case 'default':
<a name="l1001"><span class="linenum">1001</span></a>                          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'timeout_sessions', NULL, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1002"><span class="linenum">1002</span></a>                          break;
<a name="l1003"><span class="linenum">1003</span></a>                      case 'custom':
<a name="l1004"><span class="linenum">1004</span></a>                          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'timeout_sessions', <a class="function" onClick="logFunction('param_duration')" href="../../../_functions/param_duration.html" onMouseOver="funcPopup(event,'param_duration')">param_duration</a>( 'timeout_sessions' ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1005"><span class="linenum">1005</span></a>                          break;
<a name="l1006"><span class="linenum">1006</span></a>                  }
<a name="l1007"><span class="linenum">1007</span></a>              }
<a name="l1008"><span class="linenum">1008</span></a>  
<a name="l1009"><span class="linenum">1009</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'show_online', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_showonline', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1010"><span class="linenum">1010</span></a>          }
<a name="l1011"><span class="linenum">1011</span></a>  
<a name="l1012"><span class="linenum">1012</span></a>  <span class="comment">        // ******* Notifications form ******* //</span>
<a name="l1013"><span class="linenum">1013</span></a>          <a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('is_subscriptions_form')" href="../../../_variables/is_subscriptions_form.html">$is_subscriptions_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'subscriptions_form', 'boolean', false );
<a name="l1014"><span class="linenum">1014</span></a>  
<a name="l1015"><span class="linenum">1015</span></a>          if( <a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('is_subscriptions_form')" href="../../../_variables/is_subscriptions_form.html">$is_subscriptions_form</a> )
<a name="l1016"><span class="linenum">1016</span></a>          {
<a name="l1017"><span class="linenum">1017</span></a>              if( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a> == 'subscribe' )
<a name="l1018"><span class="linenum">1018</span></a>              { // Do only subscribe to <span class="keyword">new </span><a class="class" onClick="logClass('blog')" href="../../../_classes/blog.html" onMouseOver="classPopup(event,'blog')">blog</a> (Don't update the user's settings from the same form)
<a name="l1019"><span class="linenum">1019</span></a>  
<a name="l1020"><span class="linenum">1020</span></a>  <span class="comment">                // A selected blog to subscribe</span>
<a name="l1021"><span class="linenum">1021</span></a>                  <a class="var it3919" onMouseOver="hilite(3919)" onMouseOut="lolite()" onClick="logVariable('subscribe_blog_ID')" href="../../../_variables/subscribe_blog_ID.html">$subscribe_blog_ID</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'subscribe_blog', 'integer', 0 );
<a name="l1022"><span class="linenum">1022</span></a>  <span class="comment">                // Get checkbox values:</span>
<a name="l1023"><span class="linenum">1023</span></a>                  <a class="var it3920" onMouseOver="hilite(3920)" onMouseOut="lolite()" onClick="logVariable('sub_items')" href="../../../_variables/sub_items.html">$sub_items</a>    = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'sub_items_new',    'integer', 0 );
<a name="l1024"><span class="linenum">1024</span></a>                  <a class="var it3921" onMouseOver="hilite(3921)" onMouseOut="lolite()" onClick="logVariable('sub_comments')" href="../../../_variables/sub_comments.html">$sub_comments</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'sub_comments_new', 'integer', 0 );
<a name="l1025"><span class="linenum">1025</span></a>  
<a name="l1026"><span class="linenum">1026</span></a>  <span class="comment">                // Note: we do not check if subscriptions are allowed here, but we check at the time we're about to send something</span>
<a name="l1027"><span class="linenum">1027</span></a>                  if( <a class="var it3919" onMouseOver="hilite(3919)" onMouseOut="lolite()" onClick="logVariable('subscribe_blog_ID')" href="../../../_variables/subscribe_blog_ID.html">$subscribe_blog_ID</a> &amp;&amp; ( <a class="var it3920" onMouseOver="hilite(3920)" onMouseOut="lolite()" onClick="logVariable('sub_items')" href="../../../_variables/sub_items.html">$sub_items</a> || <a class="var it3921" onMouseOver="hilite(3921)" onMouseOut="lolite()" onClick="logVariable('sub_comments')" href="../../../_variables/sub_comments.html">$sub_comments</a> ) )
<a name="l1028"><span class="linenum">1028</span></a>                  { // We need to record values:
<a name="l1029"><span class="linenum">1029</span></a>                      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_subscriptions( sub_coll_ID, sub_user_ID, sub_items, sub_comments )
<a name="l1030"><span class="linenum">1030</span></a>                        VALUES ( '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3919" onMouseOver="hilite(3919)" onMouseOut="lolite()" onClick="logVariable('subscribe_blog_ID')" href="../../../_variables/subscribe_blog_ID.html">$subscribe_blog_ID</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3920" onMouseOver="hilite(3920)" onMouseOut="lolite()" onClick="logVariable('sub_items')" href="../../../_variables/sub_items.html">$sub_items</a> ).', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3921" onMouseOver="hilite(3921)" onMouseOut="lolite()" onClick="logVariable('sub_comments')" href="../../../_variables/sub_comments.html">$sub_comments</a> ).' )' );
<a name="l1031"><span class="linenum">1031</span></a>  
<a name="l1032"><span class="linenum">1032</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Subscriptions have been changed.'), 'success' );
<a name="l1033"><span class="linenum">1033</span></a>                  }
<a name="l1034"><span class="linenum">1034</span></a>                  else
<a name="l1035"><span class="linenum">1035</span></a>                  { // Display an error message to inform user about incorrect actions
<a name="l1036"><span class="linenum">1036</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please select at least one setting to subscribe on the selected blog.'), 'error' );
<a name="l1037"><span class="linenum">1037</span></a>                  }
<a name="l1038"><span class="linenum">1038</span></a>              }
<a name="l1039"><span class="linenum">1039</span></a>              else
<a name="l1040"><span class="linenum">1040</span></a>              { // Update user's settings
<a name="l1041"><span class="linenum">1041</span></a>  
<a name="l1042"><span class="linenum">1042</span></a>  <span class="comment">                // Email communication</span>
<a name="l1043"><span class="linenum">1043</span></a>                  <a class="var it3879" onMouseOver="hilite(3879)" onMouseOut="lolite()" onClick="logVariable('edited_user_email')" href="../../../_variables/edited_user_email.html">$edited_user_email</a> = <a class="function" onClick="logFunction('utf8_strtolower')" href="../../../_functions/utf8_strtolower.html" onMouseOver="funcPopup(event,'utf8_strtolower')">utf8_strtolower</a>( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_email', 'string', true ) );
<a name="l1044"><span class="linenum">1044</span></a>                  <a class="function" onClick="logFunction('param_check_not_empty')" href="../../../_functions/param_check_not_empty.html" onMouseOver="funcPopup(event,'param_check_not_empty')">param_check_not_empty</a>( 'edited_user_email', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please enter your e-mail address.') );
<a name="l1045"><span class="linenum">1045</span></a>                  <a class="function" onClick="logFunction('param_check_email')" href="../../../_functions/param_check_email.html" onMouseOver="funcPopup(event,'param_check_email')">param_check_email</a>( 'edited_user_email', true );
<a name="l1046"><span class="linenum">1046</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_email')" href="../../../_functions/set_email.html" onMouseOver="funcPopup(event,'set_email')">set_email</a>( <a class="var it3879" onMouseOver="hilite(3879)" onMouseOut="lolite()" onClick="logVariable('edited_user_email')" href="../../../_variables/edited_user_email.html">$edited_user_email</a> );
<a name="l1047"><span class="linenum">1047</span></a>  
<a name="l1048"><span class="linenum">1048</span></a>  <span class="comment">                // set messaging options</span>
<a name="l1049"><span class="linenum">1049</span></a>                  if( <a class="var it3915" onMouseOver="hilite(3915)" onMouseOut="lolite()" onClick="logVariable('has_messaging_perm')" href="../../../_variables/has_messaging_perm.html">$has_messaging_perm</a> )
<a name="l1050"><span class="linenum">1050</span></a>                  {
<a name="l1051"><span class="linenum">1051</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'enable_PM', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'PM', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1052"><span class="linenum">1052</span></a>                  }
<a name="l1053"><span class="linenum">1053</span></a>                  <a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('emails_msgform')" href="../../../_variables/emails_msgform.html">$emails_msgform</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'emails_msgform' );
<a name="l1054"><span class="linenum">1054</span></a>                  if( ( <a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('emails_msgform')" href="../../../_variables/emails_msgform.html">$emails_msgform</a> == 'userset' ) || ( ( <a class="var it3922" onMouseOver="hilite(3922)" onMouseOut="lolite()" onClick="logVariable('emails_msgform')" href="../../../_variables/emails_msgform.html">$emails_msgform</a> == 'adminset' ) &amp;&amp; ( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) ) ) )
<a name="l1055"><span class="linenum">1055</span></a>                  { // enable email option is displayed only if user can set or if admin can set and current User is an administrator
<a name="l1056"><span class="linenum">1056</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'enable_email', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'email', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1057"><span class="linenum">1057</span></a>                  }
<a name="l1058"><span class="linenum">1058</span></a>  
<a name="l1059"><span class="linenum">1059</span></a>  <span class="comment">                // Email format</span>
<a name="l1060"><span class="linenum">1060</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'email_format', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_email_format', 'string', 'auto' ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1061"><span class="linenum">1061</span></a>  
<a name="l1062"><span class="linenum">1062</span></a>  <span class="comment">                // set notification options</span>
<a name="l1063"><span class="linenum">1063</span></a>                  if( <a class="var it3915" onMouseOver="hilite(3915)" onMouseOut="lolite()" onClick="logVariable('has_messaging_perm')" href="../../../_variables/has_messaging_perm.html">$has_messaging_perm</a> )
<a name="l1064"><span class="linenum">1064</span></a>                  { // update 'notify messages' only if user has messaging rights and this option was displayed
<a name="l1065"><span class="linenum">1065</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_messages', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_messages', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1066"><span class="linenum">1066</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_unread_messages', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_unread_messages', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1067"><span class="linenum">1067</span></a>                  }
<a name="l1068"><span class="linenum">1068</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_role')" href="../../../_functions/check_role.html" onMouseOver="funcPopup(event,'check_role')">check_role</a>( 'post_owner' ) )
<a name="l1069"><span class="linenum">1069</span></a>                  { // update 'notify_published_comments' only if user has at least one post or user has right to create new post
<a name="l1070"><span class="linenum">1070</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_published_comments', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_publ_comments', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1071"><span class="linenum">1071</span></a>                  }
<a name="l1072"><span class="linenum">1072</span></a>                  <a class="var it3923" onMouseOver="hilite(3923)" onMouseOut="lolite()" onClick="logVariable('is_comment_moderator')" href="../../../_variables/is_comment_moderator.html">$is_comment_moderator</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_role')" href="../../../_functions/check_role.html" onMouseOver="funcPopup(event,'check_role')">check_role</a>( 'comment_moderator' );
<a name="l1073"><span class="linenum">1073</span></a>                  if( <a class="var it3923" onMouseOver="hilite(3923)" onMouseOut="lolite()" onClick="logVariable('is_comment_moderator')" href="../../../_variables/is_comment_moderator.html">$is_comment_moderator</a> || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_role')" href="../../../_functions/check_role.html" onMouseOver="funcPopup(event,'check_role')">check_role</a>( 'comment_editor' ) )
<a name="l1074"><span class="linenum">1074</span></a>                  { // update 'notify_comment_moderation' only if user is comment moderator/editor at least in one blog
<a name="l1075"><span class="linenum">1075</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_comment_moderation', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_cmt_moderation', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1076"><span class="linenum">1076</span></a>                  }
<a name="l1077"><span class="linenum">1077</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'admin', 'restricted', false ) )
<a name="l1078"><span class="linenum">1078</span></a>                  { // update 'notify_meta_comments' only if edited user has a permission to back-office
<a name="l1079"><span class="linenum">1079</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_meta_comments', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_meta_comments', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1080"><span class="linenum">1080</span></a>                  }
<a name="l1081"><span class="linenum">1081</span></a>                  if( <a class="var it3923" onMouseOver="hilite(3923)" onMouseOut="lolite()" onClick="logVariable('is_comment_moderator')" href="../../../_variables/is_comment_moderator.html">$is_comment_moderator</a> )
<a name="l1082"><span class="linenum">1082</span></a>                  { // update 'send_cmt_moderation_reminder' only if user is comment moderator at least in one blog
<a name="l1083"><span class="linenum">1083</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'send_cmt_moderation_reminder', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_send_cmt_moderation_reminder', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1084"><span class="linenum">1084</span></a>                  }
<a name="l1085"><span class="linenum">1085</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_role')" href="../../../_functions/check_role.html" onMouseOver="funcPopup(event,'check_role')">check_role</a>( 'post_moderator' ) )
<a name="l1086"><span class="linenum">1086</span></a>                  { // update 'notify_post_moderation' and 'send_cmt_moderation_reminder' only if user is post moderator at least in one blog
<a name="l1087"><span class="linenum">1087</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_post_moderation', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_post_moderation', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1088"><span class="linenum">1088</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'send_pst_moderation_reminder', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_send_pst_moderation_reminder', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1089"><span class="linenum">1089</span></a>                  }
<a name="l1090"><span class="linenum">1090</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/grp_ID.html">grp_ID</a> == 1 )
<a name="l1091"><span class="linenum">1091</span></a>                  {
<a name="l1092"><span class="linenum">1092</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'send_activation_reminder', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_send_activation_reminder', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1093"><span class="linenum">1093</span></a>                  }
<a name="l1094"><span class="linenum">1094</span></a>  
<a name="l1095"><span class="linenum">1095</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) )
<a name="l1096"><span class="linenum">1096</span></a>                  { // edited user has permission to edit all users, save notification preferences
<a name="l1097"><span class="linenum">1097</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_new_user_registration', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_new_user_registration', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1098"><span class="linenum">1098</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_activated_account', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_activated_account', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1099"><span class="linenum">1099</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_closed_account', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_closed_account', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1100"><span class="linenum">1100</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_reported_account', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_reported_account', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1101"><span class="linenum">1101</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_changed_account', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_changed_account', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1102"><span class="linenum">1102</span></a>                  }
<a name="l1103"><span class="linenum">1103</span></a>  
<a name="l1104"><span class="linenum">1104</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'options', 'edit' ) )
<a name="l1105"><span class="linenum">1105</span></a>                  { // edited user has permission to edit options, save notification preferences
<a name="l1106"><span class="linenum">1106</span></a>                      <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notify_cronjob_error', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notify_cronjob_error', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1107"><span class="linenum">1107</span></a>                  }
<a name="l1108"><span class="linenum">1108</span></a>  
<a name="l1109"><span class="linenum">1109</span></a>  <span class="comment">                // Newsletter</span>
<a name="l1110"><span class="linenum">1110</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'newsletter_news', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_newsletter_news', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1111"><span class="linenum">1111</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'newsletter_ads', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_newsletter_ads', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1112"><span class="linenum">1112</span></a>  
<a name="l1113"><span class="linenum">1113</span></a>  <span class="comment">                // Emails limit per day</span>
<a name="l1114"><span class="linenum">1114</span></a>                  <a class="function" onClick="logFunction('param_integer_range')" href="../../../_functions/param_integer_range.html" onMouseOver="funcPopup(event,'param_integer_range')">param_integer_range</a>( 'edited_user_notification_email_limit', 0, 999, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Notificaiton email limit must be between %d and %d.') );
<a name="l1115"><span class="linenum">1115</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notification_email_limit', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_notification_email_limit', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1116"><span class="linenum">1116</span></a>                  <a class="function" onClick="logFunction('param_integer_range')" href="../../../_functions/param_integer_range.html" onMouseOver="funcPopup(event,'param_integer_range')">param_integer_range</a>( 'edited_user_newsletter_limit', 0, 999, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Newsletter limit must be between %d and %d.') );
<a name="l1117"><span class="linenum">1117</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'newsletter_limit', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_newsletter_limit', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1118"><span class="linenum">1118</span></a>  
<a name="l1119"><span class="linenum">1119</span></a>                  <span class="comment">/**</span>
<a name="l1120"><span class="linenum">1120</span></a>  <span class="comment">                 * Update the subscriptions:</span>
<a name="l1121"><span class="linenum">1121</span></a>  <span class="comment">                 */</span>
<a name="l1122"><span class="linenum">1122</span></a>                  <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('subs_blog_IDs')" href="../../../_variables/subs_blog_IDs.html">$subs_blog_IDs</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'subs_blog_IDs', 'string', true );
<a name="l1123"><span class="linenum">1123</span></a>                  <a class="var it3925" onMouseOver="hilite(3925)" onMouseOut="lolite()" onClick="logVariable('subs_item_IDs')" href="../../../_variables/subs_item_IDs.html">$subs_item_IDs</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'subs_item_IDs', 'string', true );
<a name="l1124"><span class="linenum">1124</span></a>  
<a name="l1125"><span class="linenum">1125</span></a>  <span class="comment">                // Work the blogs:</span>
<a name="l1126"><span class="linenum">1126</span></a>                  <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('subscription_values')" href="../../../_variables/subscription_values.html">$subscription_values</a> = array();
<a name="l1127"><span class="linenum">1127</span></a>                  <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a> = array();
<a name="l1128"><span class="linenum">1128</span></a>                  <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('subs_blog_IDs')" href="../../../_variables/subs_blog_IDs.html">$subs_blog_IDs</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( ',', <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('subs_blog_IDs')" href="../../../_variables/subs_blog_IDs.html">$subs_blog_IDs</a> );
<a name="l1129"><span class="linenum">1129</span></a>                  foreach( <a class="var it3924" onMouseOver="hilite(3924)" onMouseOut="lolite()" onClick="logVariable('subs_blog_IDs')" href="../../../_variables/subs_blog_IDs.html">$subs_blog_IDs</a> as <a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a> )
<a name="l1130"><span class="linenum">1130</span></a>                  {
<a name="l1131"><span class="linenum">1131</span></a>  <span class="comment">                    // Make sure no dirty hack is coming in here:</span>
<a name="l1132"><span class="linenum">1132</span></a>                      <a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a> = <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a> );
<a name="l1133"><span class="linenum">1133</span></a>  
<a name="l1134"><span class="linenum">1134</span></a>  <span class="comment">                    // Get checkbox values:</span>
<a name="l1135"><span class="linenum">1135</span></a>                      <a class="var it3920" onMouseOver="hilite(3920)" onMouseOut="lolite()" onClick="logVariable('sub_items')" href="../../../_variables/sub_items.html">$sub_items</a>    = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'sub_items_'.<a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a>,    'integer', 0 );
<a name="l1136"><span class="linenum">1136</span></a>                      <a class="var it3921" onMouseOver="hilite(3921)" onMouseOut="lolite()" onClick="logVariable('sub_comments')" href="../../../_variables/sub_comments.html">$sub_comments</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'sub_comments_'.<a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a>, 'integer', 0 );
<a name="l1137"><span class="linenum">1137</span></a>  
<a name="l1138"><span class="linenum">1138</span></a>                      if( <a class="var it3920" onMouseOver="hilite(3920)" onMouseOut="lolite()" onClick="logVariable('sub_items')" href="../../../_variables/sub_items.html">$sub_items</a> || <a class="var it3921" onMouseOver="hilite(3921)" onMouseOut="lolite()" onClick="logVariable('sub_comments')" href="../../../_variables/sub_comments.html">$sub_comments</a> )
<a name="l1139"><span class="linenum">1139</span></a>                      {    // We have a subscription for this blog
<a name="l1140"><span class="linenum">1140</span></a>                          <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('subscription_values')" href="../../../_variables/subscription_values.html">$subscription_values</a>[] = &quot;( <a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, <a class="var it3920" onMouseOver="hilite(3920)" onMouseOut="lolite()" onClick="logVariable('sub_items')" href="../../../_variables/sub_items.html">$sub_items</a>, <a class="var it3921" onMouseOver="hilite(3921)" onMouseOut="lolite()" onClick="logVariable('sub_comments')" href="../../../_variables/sub_comments.html">$sub_comments</a> )&quot;;
<a name="l1141"><span class="linenum">1141</span></a>                      }
<a name="l1142"><span class="linenum">1142</span></a>                      else
<a name="l1143"><span class="linenum">1143</span></a>                      {    // No subscription here:
<a name="l1144"><span class="linenum">1144</span></a>                          <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a>[] = <a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a>;
<a name="l1145"><span class="linenum">1145</span></a>                      }
<a name="l1146"><span class="linenum">1146</span></a>                  }
<a name="l1147"><span class="linenum">1147</span></a>  
<a name="l1148"><span class="linenum">1148</span></a>  <span class="comment">                // Note: we do not check if subscriptions are allowed here, but we check at the time we're about to send something</span>
<a name="l1149"><span class="linenum">1149</span></a>                  if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('subscription_values')" href="../../../_variables/subscription_values.html">$subscription_values</a> ) )
<a name="l1150"><span class="linenum">1150</span></a>                  {    // We need to record values:
<a name="l1151"><span class="linenum">1151</span></a>                      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'REPLACE INTO T_subscriptions( sub_coll_ID, sub_user_ID, sub_items, sub_comments )
<a name="l1152"><span class="linenum">1152</span></a>                                                  VALUES '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it3926" onMouseOver="hilite(3926)" onMouseOut="lolite()" onClick="logVariable('subscription_values')" href="../../../_variables/subscription_values.html">$subscription_values</a> ) );
<a name="l1153"><span class="linenum">1153</span></a>                  }
<a name="l1154"><span class="linenum">1154</span></a>  
<a name="l1155"><span class="linenum">1155</span></a>                  if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a> ) )
<a name="l1156"><span class="linenum">1156</span></a>                  {    // We need to make sure some values are cleared:
<a name="l1157"><span class="linenum">1157</span></a>                      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_subscriptions
<a name="l1158"><span class="linenum">1158</span></a>                                                   WHERE sub_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l1159"><span class="linenum">1159</span></a>                                                       AND sub_coll_ID IN ('.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a> ).')' );
<a name="l1160"><span class="linenum">1160</span></a>                  }
<a name="l1161"><span class="linenum">1161</span></a>  
<a name="l1162"><span class="linenum">1162</span></a>  <span class="comment">                // Individual post subscriptions</span>
<a name="l1163"><span class="linenum">1163</span></a>                  if( !empty( <a class="var it3925" onMouseOver="hilite(3925)" onMouseOut="lolite()" onClick="logVariable('subs_item_IDs')" href="../../../_variables/subs_item_IDs.html">$subs_item_IDs</a> ) )
<a name="l1164"><span class="linenum">1164</span></a>                  { // user was subscribed to at least one post update notification
<a name="l1165"><span class="linenum">1165</span></a>                      <a class="var it3925" onMouseOver="hilite(3925)" onMouseOut="lolite()" onClick="logVariable('subs_item_IDs')" href="../../../_variables/subs_item_IDs.html">$subs_item_IDs</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( ',', <a class="var it3925" onMouseOver="hilite(3925)" onMouseOut="lolite()" onClick="logVariable('subs_item_IDs')" href="../../../_variables/subs_item_IDs.html">$subs_item_IDs</a> );
<a name="l1166"><span class="linenum">1166</span></a>                      <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a> = array();
<a name="l1167"><span class="linenum">1167</span></a>                      foreach( <a class="var it3925" onMouseOver="hilite(3925)" onMouseOut="lolite()" onClick="logVariable('subs_item_IDs')" href="../../../_variables/subs_item_IDs.html">$subs_item_IDs</a> as <a class="var it3929" onMouseOver="hilite(3929)" onMouseOut="lolite()" onClick="logVariable('loop_item_ID')" href="../../../_variables/loop_item_ID.html">$loop_item_ID</a> )
<a name="l1168"><span class="linenum">1168</span></a>                      {
<a name="l1169"><span class="linenum">1169</span></a>                          if( !<a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'item_sub_'.<a class="var it3929" onMouseOver="hilite(3929)" onMouseOut="lolite()" onClick="logVariable('loop_item_ID')" href="../../../_variables/loop_item_ID.html">$loop_item_ID</a>, 'integer', 0 ) )
<a name="l1170"><span class="linenum">1170</span></a>                          { // user wants to unsubscribe from this post notifications
<a name="l1171"><span class="linenum">1171</span></a>                              <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a>[] = <a class="var it3929" onMouseOver="hilite(3929)" onMouseOut="lolite()" onClick="logVariable('loop_item_ID')" href="../../../_variables/loop_item_ID.html">$loop_item_ID</a>;
<a name="l1172"><span class="linenum">1172</span></a>                          }
<a name="l1173"><span class="linenum">1173</span></a>                      }
<a name="l1174"><span class="linenum">1174</span></a>                      if( !empty( <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a> ) )
<a name="l1175"><span class="linenum">1175</span></a>                      { // unsubscribe list is not empty, delete not wanted subscriptions
<a name="l1176"><span class="linenum">1176</span></a>                          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_items__subscriptions
<a name="l1177"><span class="linenum">1177</span></a>                                                   WHERE isub_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l1178"><span class="linenum">1178</span></a>                                                       AND isub_item_ID IN ('.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it3927" onMouseOver="hilite(3927)" onMouseOut="lolite()" onClick="logVariable('unsubscribed')" href="../../../_variables/unsubscribed.html">$unsubscribed</a> ).')' );
<a name="l1179"><span class="linenum">1179</span></a>                      }
<a name="l1180"><span class="linenum">1180</span></a>                  }
<a name="l1181"><span class="linenum">1181</span></a>              }
<a name="l1182"><span class="linenum">1182</span></a>          }
<a name="l1183"><span class="linenum">1183</span></a>  
<a name="l1184"><span class="linenum">1184</span></a>  <span class="comment">        // ******* Advanced form ******* //</span>
<a name="l1185"><span class="linenum">1185</span></a>          <a class="var it3930" onMouseOver="hilite(3930)" onMouseOut="lolite()" onClick="logVariable('is_advanced_form')" href="../../../_variables/is_advanced_form.html">$is_advanced_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'advanced_form', 'boolean', false );
<a name="l1186"><span class="linenum">1186</span></a>  
<a name="l1187"><span class="linenum">1187</span></a>          if( <a class="var it3930" onMouseOver="hilite(3930)" onMouseOut="lolite()" onClick="logVariable('is_advanced_form')" href="../../../_variables/is_advanced_form.html">$is_advanced_form</a> )
<a name="l1188"><span class="linenum">1188</span></a>          {
<a name="l1189"><span class="linenum">1189</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'admin_skin', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_admin_skin', 'string' ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1190"><span class="linenum">1190</span></a>  
<a name="l1191"><span class="linenum">1191</span></a>  <span class="comment">            // Action icon params:</span>
<a name="l1192"><span class="linenum">1192</span></a>              <a class="function" onClick="logFunction('param_integer_range')" href="../../../_functions/param_integer_range.html" onMouseOver="funcPopup(event,'param_integer_range')">param_integer_range</a>( 'edited_user_action_icon_threshold', 1, 5, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The threshold must be between 1 and 5.') );
<a name="l1193"><span class="linenum">1193</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'action_icon_threshold', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_action_icon_threshold', 'integer', true ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1194"><span class="linenum">1194</span></a>  
<a name="l1195"><span class="linenum">1195</span></a>              <a class="function" onClick="logFunction('param_integer_range')" href="../../../_functions/param_integer_range.html" onMouseOver="funcPopup(event,'param_integer_range')">param_integer_range</a>( 'edited_user_action_word_threshold', 1, 5, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The threshold must be between 1 and 5.') );
<a name="l1196"><span class="linenum">1196</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'action_word_threshold', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_action_word_threshold', 'integer'), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1197"><span class="linenum">1197</span></a>  
<a name="l1198"><span class="linenum">1198</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'display_icon_legend', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_legend', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1199"><span class="linenum">1199</span></a>  
<a name="l1200"><span class="linenum">1200</span></a>  <span class="comment">            // Set bozo validador activation</span>
<a name="l1201"><span class="linenum">1201</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'control_form_abortions', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_bozo', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1202"><span class="linenum">1202</span></a>  
<a name="l1203"><span class="linenum">1203</span></a>  <span class="comment">            // Focus on first</span>
<a name="l1204"><span class="linenum">1204</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'focus_on_first_input', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_focusonfirst', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1205"><span class="linenum">1205</span></a>  
<a name="l1206"><span class="linenum">1206</span></a>  <span class="comment">            // Results per page</span>
<a name="l1207"><span class="linenum">1207</span></a>              <a class="var it3931" onMouseOver="hilite(3931)" onMouseOut="lolite()" onClick="logVariable('edited_user_results_page_size')" href="../../../_variables/edited_user_results_page_size.html">$edited_user_results_page_size</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_results_page_size', 'integer', NULL );
<a name="l1208"><span class="linenum">1208</span></a>              if( isset( <a class="var it3931" onMouseOver="hilite(3931)" onMouseOut="lolite()" onClick="logVariable('edited_user_results_page_size')" href="../../../_variables/edited_user_results_page_size.html">$edited_user_results_page_size</a> ) )
<a name="l1209"><span class="linenum">1209</span></a>              {
<a name="l1210"><span class="linenum">1210</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'results_per_page', <a class="var it3931" onMouseOver="hilite(3931)" onMouseOut="lolite()" onClick="logVariable('edited_user_results_page_size')" href="../../../_variables/edited_user_results_page_size.html">$edited_user_results_page_size</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1211"><span class="linenum">1211</span></a>              }
<a name="l1212"><span class="linenum">1212</span></a>          }
<a name="l1213"><span class="linenum">1213</span></a>  
<a name="l1214"><span class="linenum">1214</span></a>          if( <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('is_preferences_form')" href="../../../_variables/is_preferences_form.html">$is_preferences_form</a> || ( <a class="var it3875" onMouseOver="hilite(3875)" onMouseOut="lolite()" onClick="logVariable('is_identity_form')" href="../../../_variables/is_identity_form.html">$is_identity_form</a> &amp;&amp; <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> ) )
<a name="l1215"><span class="linenum">1215</span></a>          {    // Multiple session
<a name="l1216"><span class="linenum">1216</span></a>              <a class="var it2592" onMouseOver="hilite(2592)" onMouseOut="lolite()" onClick="logVariable('multiple_sessions')" href="../../../_variables/multiple_sessions.html">$multiple_sessions</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'multiple_sessions' );
<a name="l1217"><span class="linenum">1217</span></a>              if( ( <a class="var it2592" onMouseOver="hilite(2592)" onMouseOut="lolite()" onClick="logVariable('multiple_sessions')" href="../../../_variables/multiple_sessions.html">$multiple_sessions</a> != 'adminset_default_no' &amp;&amp; <a class="var it2592" onMouseOver="hilite(2592)" onMouseOut="lolite()" onClick="logVariable('multiple_sessions')" href="../../../_variables/multiple_sessions.html">$multiple_sessions</a> != 'adminset_default_yes' ) || <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) )
<a name="l1218"><span class="linenum">1218</span></a>              {
<a name="l1219"><span class="linenum">1219</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'login_multiple_sessions', <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_set_login_multiple_sessions', 'integer', 0 ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1220"><span class="linenum">1220</span></a>              }
<a name="l1221"><span class="linenum">1221</span></a>          }
<a name="l1222"><span class="linenum">1222</span></a>  
<a name="l1223"><span class="linenum">1223</span></a>          return ! <a class="function" onClick="logFunction('param_errors_detected')" href="../../../_functions/param_errors_detected.html" onMouseOver="funcPopup(event,'param_errors_detected')">param_errors_detected</a>();
<a name="l1224"><span class="linenum">1224</span></a>      }
<a name="l1225"><span class="linenum">1225</span></a>  
<a name="l1226"><span class="linenum">1226</span></a>  
<a name="l1227"><span class="linenum">1227</span></a>      <span class="comment">/**</span>
<a name="l1228"><span class="linenum">1228</span></a>  <span class="comment">     * Get a param</span>
<a name="l1229"><span class="linenum">1229</span></a>  <span class="comment">     *</span>
<a name="l1230"><span class="linenum">1230</span></a>  <span class="comment">     * @param string the parameter</span>
<a name="l1231"><span class="linenum">1231</span></a>  <span class="comment">     */</span>
<a name="l1232"><span class="linenum">1232</span></a>  	function <a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> )
<a name="l1233"><span class="linenum">1233</span></a>      {
<a name="l1234"><span class="linenum">1234</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_closed' ) &amp;&amp; ( !<a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() ) &amp;&amp; ( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> != 'login' ) &amp;&amp; ( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> != 'status' ) )
<a name="l1235"><span class="linenum">1235</span></a>          { // if this account is closed and we are not in backoffice, don't return other information then login or status
<a name="l1236"><span class="linenum">1236</span></a>              return NULL;
<a name="l1237"><span class="linenum">1237</span></a>          }
<a name="l1238"><span class="linenum">1238</span></a>  
<a name="l1239"><span class="linenum">1239</span></a>          switch( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> )
<a name="l1240"><span class="linenum">1240</span></a>          {
<a name="l1241"><span class="linenum">1241</span></a>              case 'fullname':
<a name="l1242"><span class="linenum">1242</span></a>                  return <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('firstname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/firstname.html">firstname</a>.' '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastname.html">lastname</a>);
<a name="l1243"><span class="linenum">1243</span></a>  
<a name="l1244"><span class="linenum">1244</span></a>              case 'preferredname':
<a name="l1245"><span class="linenum">1245</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_preferred_name')" href="../../../_functions/get_preferred_name.html" onMouseOver="funcPopup(event,'get_preferred_name')">get_preferred_name</a>();
<a name="l1246"><span class="linenum">1246</span></a>  
<a name="l1247"><span class="linenum">1247</span></a>              case 'num_posts':
<a name="l1248"><span class="linenum">1248</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_posts')" href="../../../_functions/get_num_posts.html" onMouseOver="funcPopup(event,'get_num_posts')">get_num_posts</a>();
<a name="l1249"><span class="linenum">1249</span></a>  
<a name="l1250"><span class="linenum">1250</span></a>              case 'num_comments':
<a name="l1251"><span class="linenum">1251</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_comments')" href="../../../_functions/get_num_comments.html" onMouseOver="funcPopup(event,'get_num_comments')">get_num_comments</a>();
<a name="l1252"><span class="linenum">1252</span></a>  
<a name="l1253"><span class="linenum">1253</span></a>              default:
<a name="l1254"><span class="linenum">1254</span></a>  <span class="comment">            // All other params:</span>
<a name="l1255"><span class="linenum">1255</span></a>                  return parent::<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> );
<a name="l1256"><span class="linenum">1256</span></a>          }
<a name="l1257"><span class="linenum">1257</span></a>      }
<a name="l1258"><span class="linenum">1258</span></a>  
<a name="l1259"><span class="linenum">1259</span></a>  
<a name="l1260"><span class="linenum">1260</span></a>      <span class="comment">/**</span>
<a name="l1261"><span class="linenum">1261</span></a>  <span class="comment">     * Get the name of the account with complete details for admin select lists</span>
<a name="l1262"><span class="linenum">1262</span></a>  <span class="comment">     *</span>
<a name="l1263"><span class="linenum">1263</span></a>  <span class="comment">     * @return string</span>
<a name="l1264"><span class="linenum">1264</span></a>  <span class="comment">     */</span>
<a name="l1265"><span class="linenum">1265</span></a>  	function <a class="function" onClick="logFunction('get_account_name')" href="../../../_functions/get_account_name.html" onMouseOver="funcPopup(event,'get_account_name')">get_account_name</a>()
<a name="l1266"><span class="linenum">1266</span></a>      {
<a name="l1267"><span class="linenum">1267</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_closed' ) &amp;&amp; ( !<a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() ) )
<a name="l1268"><span class="linenum">1268</span></a>          { // don't return closed accounts information except login name
<a name="l1269"><span class="linenum">1269</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l1270"><span class="linenum">1270</span></a>          }
<a name="l1271"><span class="linenum">1271</span></a>  
<a name="l1272"><span class="linenum">1272</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>.' - '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('firstname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/firstname.html">firstname</a>.' '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastname.html">lastname</a>.' ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('nickname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/nickname.html">nickname</a>.')';
<a name="l1273"><span class="linenum">1273</span></a>      }
<a name="l1274"><span class="linenum">1274</span></a>  
<a name="l1275"><span class="linenum">1275</span></a>  
<a name="l1276"><span class="linenum">1276</span></a>      <span class="comment">/**</span>
<a name="l1277"><span class="linenum">1277</span></a>  <span class="comment">     * Get link to User</span>
<a name="l1278"><span class="linenum">1278</span></a>  <span class="comment">     *</span>
<a name="l1279"><span class="linenum">1279</span></a>  <span class="comment">     * @return string</span>
<a name="l1280"><span class="linenum">1280</span></a>  <span class="comment">     */</span>
<a name="l1281"><span class="linenum">1281</span></a>  	function <a class="function" onClick="logFunction('get_link')" href="../../../_functions/get_link.html" onMouseOver="funcPopup(event,'get_link')">get_link</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l1282"><span class="linenum">1282</span></a>      {
<a name="l1283"><span class="linenum">1283</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l1284"><span class="linenum">1284</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l1285"><span class="linenum">1285</span></a>                  'format'       =&gt; 'htmlbody',
<a name="l1286"><span class="linenum">1286</span></a>                  'link_to'      =&gt; 'userpage', // userurl userpage 'userurl&gt;userpage'
<a name="l1287"><span class="linenum">1287</span></a>                  'link_text'    =&gt; 'preferredname', // avatar | preferredname
<a name="l1288"><span class="linenum">1288</span></a>                  'link_rel'     =&gt; '',
<a name="l1289"><span class="linenum">1289</span></a>                  'link_class'   =&gt; '',
<a name="l1290"><span class="linenum">1290</span></a>                  'thumb_size'   =&gt; 'crop-top-32x32',
<a name="l1291"><span class="linenum">1291</span></a>                  'thumb_class'  =&gt; '',
<a name="l1292"><span class="linenum">1292</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l1293"><span class="linenum">1293</span></a>  
<a name="l1294"><span class="linenum">1294</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_text'] == 'avatar' )
<a name="l1295"><span class="linenum">1295</span></a>          {
<a name="l1296"><span class="linenum">1296</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_avatar_imgtag')" href="../../../_functions/get_avatar_imgtag.html" onMouseOver="funcPopup(event,'get_avatar_imgtag')">get_avatar_imgtag</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['thumb_size'], <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['thumb_class'] );
<a name="l1297"><span class="linenum">1297</span></a>          }
<a name="l1298"><span class="linenum">1298</span></a>          else
<a name="l1299"><span class="linenum">1299</span></a>          {
<a name="l1300"><span class="linenum">1300</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dget')" href="../../../_functions/dget.html" onMouseOver="funcPopup(event,'dget')">dget</a>( 'preferredname', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['format'] );
<a name="l1301"><span class="linenum">1301</span></a>          }
<a name="l1302"><span class="linenum">1302</span></a>  
<a name="l1303"><span class="linenum">1303</span></a>          switch( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_to'] )
<a name="l1304"><span class="linenum">1304</span></a>          {
<a name="l1305"><span class="linenum">1305</span></a>              case 'userpage':
<a name="l1306"><span class="linenum">1306</span></a>              case 'userpage&gt;userurl':
<a name="l1307"><span class="linenum">1307</span></a>                  <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_userpage_url')" href="../../../_functions/get_userpage_url.html" onMouseOver="funcPopup(event,'get_userpage_url')">get_userpage_url</a>();
<a name="l1308"><span class="linenum">1308</span></a>                  break;
<a name="l1309"><span class="linenum">1309</span></a>  
<a name="l1310"><span class="linenum">1310</span></a>              case 'userurl':
<a name="l1311"><span class="linenum">1311</span></a>                  <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/url.html">url</a>;
<a name="l1312"><span class="linenum">1312</span></a>                  break;
<a name="l1313"><span class="linenum">1313</span></a>  
<a name="l1314"><span class="linenum">1314</span></a>              case 'userurl&gt;userpage':
<a name="l1315"><span class="linenum">1315</span></a>  <span class="comment">                // We give priority to user submitted url:</span>
<a name="l1316"><span class="linenum">1316</span></a>                  if( <a class="function" onClick="logFunction('utf8_strlen')" href="../../../_functions/utf8_strlen.html" onMouseOver="funcPopup(event,'utf8_strlen')">utf8_strlen</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/url.html">url</a>) &gt; 10 )
<a name="l1317"><span class="linenum">1317</span></a>                  {
<a name="l1318"><span class="linenum">1318</span></a>                      <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/url.html">url</a>;
<a name="l1319"><span class="linenum">1319</span></a>                  }
<a name="l1320"><span class="linenum">1320</span></a>                  else
<a name="l1321"><span class="linenum">1321</span></a>                  {
<a name="l1322"><span class="linenum">1322</span></a>                      <a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_userpage_url')" href="../../../_functions/get_userpage_url.html" onMouseOver="funcPopup(event,'get_userpage_url')">get_userpage_url</a>();
<a name="l1323"><span class="linenum">1323</span></a>                  }
<a name="l1324"><span class="linenum">1324</span></a>                  break;
<a name="l1325"><span class="linenum">1325</span></a>          }
<a name="l1326"><span class="linenum">1326</span></a>  
<a name="l1327"><span class="linenum">1327</span></a>          if( !empty(<a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a>) )
<a name="l1328"><span class="linenum">1328</span></a>          {
<a name="l1329"><span class="linenum">1329</span></a>              <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a> = '&lt;a href=&quot;'.<a class="var it208" onMouseOver="hilite(208)" onMouseOut="lolite()" onClick="logVariable('url')" href="../../../_variables/url.html">$url</a>.'&quot;';
<a name="l1330"><span class="linenum">1330</span></a>              if( !empty(<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_rel']) )
<a name="l1331"><span class="linenum">1331</span></a>              {
<a name="l1332"><span class="linenum">1332</span></a>                  <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a> .= ' rel=&quot;'.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_rel'].'&quot;';
<a name="l1333"><span class="linenum">1333</span></a>              }
<a name="l1334"><span class="linenum">1334</span></a>              if( !empty(<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_class']) )
<a name="l1335"><span class="linenum">1335</span></a>              {
<a name="l1336"><span class="linenum">1336</span></a>                  <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a> .= ' class=&quot;'.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_class'].'&quot;';
<a name="l1337"><span class="linenum">1337</span></a>              }
<a name="l1338"><span class="linenum">1338</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a>.'&gt;'.<a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>.'&lt;/a&gt;';
<a name="l1339"><span class="linenum">1339</span></a>          }
<a name="l1340"><span class="linenum">1340</span></a>  
<a name="l1341"><span class="linenum">1341</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l1342"><span class="linenum">1342</span></a>      }
<a name="l1343"><span class="linenum">1343</span></a>  
<a name="l1344"><span class="linenum">1344</span></a>  
<a name="l1345"><span class="linenum">1345</span></a>      <span class="comment">/**</span>
<a name="l1346"><span class="linenum">1346</span></a>  <span class="comment">     * Get preferred name of the user</span>
<a name="l1347"><span class="linenum">1347</span></a>  <span class="comment">     *</span>
<a name="l1348"><span class="linenum">1348</span></a>  <span class="comment">     * @return string</span>
<a name="l1349"><span class="linenum">1349</span></a>  <span class="comment">     */</span>
<a name="l1350"><span class="linenum">1350</span></a>  	function <a class="function" onClick="logFunction('get_preferred_name')" href="../../../_functions/get_preferred_name.html" onMouseOver="funcPopup(event,'get_preferred_name')">get_preferred_name</a>()
<a name="l1351"><span class="linenum">1351</span></a>      {
<a name="l1352"><span class="linenum">1352</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_closed' ) &amp;&amp; ( !<a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() ) )
<a name="l1353"><span class="linenum">1353</span></a>          { // don't return closed accounts information except login name
<a name="l1354"><span class="linenum">1354</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l1355"><span class="linenum">1355</span></a>          }
<a name="l1356"><span class="linenum">1356</span></a>  
<a name="l1357"><span class="linenum">1357</span></a>          if( !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('nickname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/nickname.html">nickname</a> ) )
<a name="l1358"><span class="linenum">1358</span></a>          {    // Nickname
<a name="l1359"><span class="linenum">1359</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'nickname' );
<a name="l1360"><span class="linenum">1360</span></a>          }
<a name="l1361"><span class="linenum">1361</span></a>          elseif( !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('firstname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/firstname.html">firstname</a> ) || !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastname.html">lastname</a> ) )
<a name="l1362"><span class="linenum">1362</span></a>          {    // First name
<a name="l1363"><span class="linenum">1363</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('fullname');
<a name="l1364"><span class="linenum">1364</span></a>          }
<a name="l1365"><span class="linenum">1365</span></a>          else
<a name="l1366"><span class="linenum">1366</span></a>          {    // Login
<a name="l1367"><span class="linenum">1367</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'login' );
<a name="l1368"><span class="linenum">1368</span></a>          }
<a name="l1369"><span class="linenum">1369</span></a>      }
<a name="l1370"><span class="linenum">1370</span></a>  
<a name="l1371"><span class="linenum">1371</span></a>  
<a name="l1372"><span class="linenum">1372</span></a>      <span class="comment">/**</span>
<a name="l1373"><span class="linenum">1373</span></a>  <span class="comment">     * Get user's login with gender color</span>
<a name="l1374"><span class="linenum">1374</span></a>  <span class="comment">     *</span>
<a name="l1375"><span class="linenum">1375</span></a>  <span class="comment">     * @param array Params</span>
<a name="l1376"><span class="linenum">1376</span></a>  <span class="comment">     * @return string User's preferred name with gender color if this available</span>
<a name="l1377"><span class="linenum">1377</span></a>  <span class="comment">     */</span>
<a name="l1378"><span class="linenum">1378</span></a>  	function <a class="function" onClick="logFunction('get_colored_login')" href="../../../_functions/get_colored_login.html" onMouseOver="funcPopup(event,'get_colored_login')">get_colored_login</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l1379"><span class="linenum">1379</span></a>      {
<a name="l1380"><span class="linenum">1380</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l1381"><span class="linenum">1381</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l1382"><span class="linenum">1382</span></a>                  'mask'         =&gt; '<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>$', // <a class="var it1352" onMouseOver="hilite(1352)" onMouseOut="lolite()" onClick="logVariable('avatar')" href="../../../_variables/avatar.html">$avatar</a>$ <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>$
<a name="l1383"><span class="linenum">1383</span></a>                  'login_format' =&gt; 'htmlbody',
<a name="l1384"><span class="linenum">1384</span></a>                  'avatar_size'  =&gt; 'crop-top-15x15',
<a name="l1385"><span class="linenum">1385</span></a>                  'login_text'   =&gt; 'login', // name | login
<a name="l1386"><span class="linenum">1386</span></a>                  'use_style'    =&gt; false, // true - to use attr &quot;style&quot;, e.g. on email templates
<a name="l1387"><span class="linenum">1387</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l1388"><span class="linenum">1388</span></a>  
<a name="l1389"><span class="linenum">1389</span></a>          <a class="var it1352" onMouseOver="hilite(1352)" onMouseOut="lolite()" onClick="logVariable('avatar')" href="../../../_variables/avatar.html">$avatar</a> = '';
<a name="l1390"><span class="linenum">1390</span></a>          <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a> = '';
<a name="l1391"><span class="linenum">1391</span></a>          <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> = '';
<a name="l1392"><span class="linenum">1392</span></a>  
<a name="l1393"><span class="linenum">1393</span></a>          if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['mask'], '<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>$' ) !== false )
<a name="l1394"><span class="linenum">1394</span></a>          { // Display login or preferred name
<a name="l1395"><span class="linenum">1395</span></a>              if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['login_text'] == 'name' )
<a name="l1396"><span class="linenum">1396</span></a>              { // Use nickname or fullname
<a name="l1397"><span class="linenum">1397</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_username')" href="../../../_functions/get_username.html" onMouseOver="funcPopup(event,'get_username')">get_username</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['login_format'] );
<a name="l1398"><span class="linenum">1398</span></a>              }
<a name="l1399"><span class="linenum">1399</span></a>              else
<a name="l1400"><span class="linenum">1400</span></a>              { // Use a login
<a name="l1401"><span class="linenum">1401</span></a>                  <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dget')" href="../../../_functions/dget.html" onMouseOver="funcPopup(event,'dget')">dget</a>( 'login', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['login_format'] );
<a name="l1402"><span class="linenum">1402</span></a>              }
<a name="l1403"><span class="linenum">1403</span></a>  <span class="comment">            // Add class &quot;login&quot; to detect logins by js plugins</span>
<a name="l1404"><span class="linenum">1404</span></a>              <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> = ( <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a> ? 'login ' : '' );
<a name="l1405"><span class="linenum">1405</span></a>          }
<a name="l1406"><span class="linenum">1406</span></a>  
<a name="l1407"><span class="linenum">1407</span></a>          if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['mask'], '<a class="var it1352" onMouseOver="hilite(1352)" onMouseOut="lolite()" onClick="logVariable('avatar')" href="../../../_variables/avatar.html">$avatar</a>$' ) !== false )
<a name="l1408"><span class="linenum">1408</span></a>          { // Display avatar
<a name="l1409"><span class="linenum">1409</span></a>              <a class="var it1352" onMouseOver="hilite(1352)" onMouseOut="lolite()" onClick="logVariable('avatar')" href="../../../_variables/avatar.html">$avatar</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_avatar_imgtag')" href="../../../_functions/get_avatar_imgtag.html" onMouseOver="funcPopup(event,'get_avatar_imgtag')">get_avatar_imgtag</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['avatar_size'], '' );
<a name="l1410"><span class="linenum">1410</span></a>          }
<a name="l1411"><span class="linenum">1411</span></a>  
<a name="l1412"><span class="linenum">1412</span></a>          <a class="var it1561" onMouseOver="hilite(1561)" onMouseOut="lolite()" onClick="logVariable('mask')" href="../../../_variables/mask.html">$mask</a> = array( '<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>$', '<a class="var it1352" onMouseOver="hilite(1352)" onMouseOut="lolite()" onClick="logVariable('avatar')" href="../../../_variables/avatar.html">$avatar</a>$' );
<a name="l1413"><span class="linenum">1413</span></a>          <a class="var it92" onMouseOver="hilite(92)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a> = array( <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>, <a class="var it1352" onMouseOver="hilite(1352)" onMouseOut="lolite()" onClick="logVariable('avatar')" href="../../../_variables/avatar.html">$avatar</a> );
<a name="l1414"><span class="linenum">1414</span></a>  
<a name="l1415"><span class="linenum">1415</span></a>          <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_gender_class')" href="../../../_functions/get_gender_class.html" onMouseOver="funcPopup(event,'get_gender_class')">get_gender_class</a>();
<a name="l1416"><span class="linenum">1416</span></a>          <a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a> = '';
<a name="l1417"><span class="linenum">1417</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['use_style'] )
<a name="l1418"><span class="linenum">1418</span></a>          { // Use &quot;style&quot;
<a name="l1419"><span class="linenum">1419</span></a>              <a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a> = <a class="function" onClick="logFunction('emailskin_style')" href="../../../_functions/emailskin_style.html" onMouseOver="funcPopup(event,'emailskin_style')">emailskin_style</a>( '.user+.'.<a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( ' ', '.', <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> ) );
<a name="l1420"><span class="linenum">1420</span></a>          }
<a name="l1421"><span class="linenum">1421</span></a>  
<a name="l1422"><span class="linenum">1422</span></a>          return '&lt;span class=&quot;'.<a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>.' '.<a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> ).'&quot;'.<a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a>.'&gt;'.<a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( <a class="var it1561" onMouseOver="hilite(1561)" onMouseOut="lolite()" onClick="logVariable('mask')" href="../../../_variables/mask.html">$mask</a>, <a class="var it92" onMouseOver="hilite(92)" onMouseOut="lolite()" onClick="logVariable('data')" href="../../../_variables/data.html">$data</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['mask'] ).'&lt;/span&gt;';
<a name="l1423"><span class="linenum">1423</span></a>      }
<a name="l1424"><span class="linenum">1424</span></a>  
<a name="l1425"><span class="linenum">1425</span></a>  
<a name="l1426"><span class="linenum">1426</span></a>      <span class="comment">/**</span>
<a name="l1427"><span class="linenum">1427</span></a>  <span class="comment">     * Get User identity link, which is a composite of user avatar and login, both point to the specific user profile tab.</span>
<a name="l1428"><span class="linenum">1428</span></a>  <span class="comment">     *</span>
<a name="l1429"><span class="linenum">1429</span></a>  <span class="comment">     * @return string User avatar and login if the identity link is not available, the identity link otherwise.</span>
<a name="l1430"><span class="linenum">1430</span></a>  <span class="comment">     */</span>
<a name="l1431"><span class="linenum">1431</span></a>  	function <a class="function" onClick="logFunction('get_identity_link')" href="../../../_functions/get_identity_link.html" onMouseOver="funcPopup(event,'get_identity_link')">get_identity_link</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l1432"><span class="linenum">1432</span></a>      {
<a name="l1433"><span class="linenum">1433</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l1434"><span class="linenum">1434</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l1435"><span class="linenum">1435</span></a>                  'link_text'      =&gt; 'avatar_name', // avatar_name | avatar_login | only_avatar | name | login | nickname | firstname | lastname | fullname | preferredname
<a name="l1436"><span class="linenum">1436</span></a>                  'thumb_size'     =&gt; 'crop-top-15x15',
<a name="l1437"><span class="linenum">1437</span></a>                  'thumb_class'    =&gt; 'avatar_before_login',
<a name="l1438"><span class="linenum">1438</span></a>                  'thumb_zoomable' =&gt; false,
<a name="l1439"><span class="linenum">1439</span></a>                  'login_mask'     =&gt; '', // example: 'text <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>$ text'
<a name="l1440"><span class="linenum">1440</span></a>                  'display_bubbletip' =&gt; true,
<a name="l1441"><span class="linenum">1441</span></a>                  'nowrap'         =&gt; true,
<a name="l1442"><span class="linenum">1442</span></a>                  'user_tab'       =&gt; 'profile',
<a name="l1443"><span class="linenum">1443</span></a>                  'use_style'      =&gt; false, // true - to use attr &quot;style&quot; instead of &quot;class&quot;, e.g. on email templates
<a name="l1444"><span class="linenum">1444</span></a>                  'blog_ID'        =&gt; NULL,
<a name="l1445"><span class="linenum">1445</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l1446"><span class="linenum">1446</span></a>  
<a name="l1447"><span class="linenum">1447</span></a>          <a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('identity_url')" href="../../../_variables/identity_url.html">$identity_url</a> = <a class="function" onClick="logFunction('get_user_identity_url')" href="../../../_functions/get_user_identity_url.html" onMouseOver="funcPopup(event,'get_user_identity_url')">get_user_identity_url</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_tab'], <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['blog_ID'] );
<a name="l1448"><span class="linenum">1448</span></a>  
<a name="l1449"><span class="linenum">1449</span></a>          <a class="var it3933" onMouseOver="hilite(3933)" onMouseOut="lolite()" onClick="logVariable('attr_bubbletip')" href="../../../_variables/attr_bubbletip.html">$attr_bubbletip</a> = '';
<a name="l1450"><span class="linenum">1450</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['display_bubbletip'] )
<a name="l1451"><span class="linenum">1451</span></a>          {    // Set attribute to initialize a bubbletip
<a name="l1452"><span class="linenum">1452</span></a>              <a class="var it3933" onMouseOver="hilite(3933)" onMouseOut="lolite()" onClick="logVariable('attr_bubbletip')" href="../../../_variables/attr_bubbletip.html">$attr_bubbletip</a> = ' rel=&quot;bubbletip_user_'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&quot;';
<a name="l1453"><span class="linenum">1453</span></a>          }
<a name="l1454"><span class="linenum">1454</span></a>  
<a name="l1455"><span class="linenum">1455</span></a>          <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('avatar_tag')" href="../../../_variables/avatar_tag.html">$avatar_tag</a> = '';
<a name="l1456"><span class="linenum">1456</span></a>          if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_text'], 'avatar' ) !== false )
<a name="l1457"><span class="linenum">1457</span></a>          { // Avatar must be displayed in this link
<a name="l1458"><span class="linenum">1458</span></a>              <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('avatar_tag')" href="../../../_variables/avatar_tag.html">$avatar_tag</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_avatar_imgtag')" href="../../../_functions/get_avatar_imgtag.html" onMouseOver="funcPopup(event,'get_avatar_imgtag')">get_avatar_imgtag</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['thumb_size'], <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['thumb_class'], '', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['thumb_zoomable'] );
<a name="l1459"><span class="linenum">1459</span></a>              if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['thumb_zoomable'] )
<a name="l1460"><span class="linenum">1460</span></a>              { // User avatar is zoomable
<a name="l1461"><span class="linenum">1461</span></a>  <span class="comment">                // Add tag param to init bubbletip</span>
<a name="l1462"><span class="linenum">1462</span></a>                  <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('avatar_tag')" href="../../../_variables/avatar_tag.html">$avatar_tag</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( '&lt;img ', '&lt;img rel=&quot;bubbletip_user_'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&quot;', <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('avatar_tag')" href="../../../_variables/avatar_tag.html">$avatar_tag</a> );
<a name="l1463"><span class="linenum">1463</span></a>                  return <a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('avatar_tag')" href="../../../_variables/avatar_tag.html">$avatar_tag</a>; <span class="comment">// We should exit here, to avoid the double adding of tag &lt;a&gt;</span>
<a name="l1464"><span class="linenum">1464</span></a>              }
<a name="l1465"><span class="linenum">1465</span></a>          }
<a name="l1466"><span class="linenum">1466</span></a>  
<a name="l1467"><span class="linenum">1467</span></a>          <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = '';
<a name="l1468"><span class="linenum">1468</span></a>          <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> = empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_class'] ) ? '' : <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_class'];
<a name="l1469"><span class="linenum">1469</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_text'] != 'only_avatar' )
<a name="l1470"><span class="linenum">1470</span></a>          { // Display a login, nickname, firstname, lastname, fullname or preferredname
<a name="l1471"><span class="linenum">1471</span></a>              switch( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['link_text'] )
<a name="l1472"><span class="linenum">1472</span></a>              {
<a name="l1473"><span class="linenum">1473</span></a>                  case 'login':
<a name="l1474"><span class="linenum">1474</span></a>                  case 'avatar_login':
<a name="l1475"><span class="linenum">1475</span></a>                      <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l1476"><span class="linenum">1476</span></a>                      break;
<a name="l1477"><span class="linenum">1477</span></a>                  case 'nickname':
<a name="l1478"><span class="linenum">1478</span></a>                      <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('nickname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/nickname.html">nickname</a>;
<a name="l1479"><span class="linenum">1479</span></a>                      break;
<a name="l1480"><span class="linenum">1480</span></a>                  case 'firstname':
<a name="l1481"><span class="linenum">1481</span></a>                      <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('firstname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/firstname.html">firstname</a>;
<a name="l1482"><span class="linenum">1482</span></a>                      break;
<a name="l1483"><span class="linenum">1483</span></a>                  case 'lastname':
<a name="l1484"><span class="linenum">1484</span></a>                      <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastname.html">lastname</a>;
<a name="l1485"><span class="linenum">1485</span></a>                      break;
<a name="l1486"><span class="linenum">1486</span></a>                  case 'fullname':
<a name="l1487"><span class="linenum">1487</span></a>                      <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('firstname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/firstname.html">firstname</a>.' '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastname')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastname.html">lastname</a>;
<a name="l1488"><span class="linenum">1488</span></a>                      break;
<a name="l1489"><span class="linenum">1489</span></a>                  case 'preferredname':
<a name="l1490"><span class="linenum">1490</span></a>                      <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_preferred_name')" href="../../../_functions/get_preferred_name.html" onMouseOver="funcPopup(event,'get_preferred_name')">get_preferred_name</a>();
<a name="l1491"><span class="linenum">1491</span></a>                      break;
<a name="l1492"><span class="linenum">1492</span></a>  <span class="comment">                // default: 'avatar_name' | 'avatar' | 'name'</span>
<a name="l1493"><span class="linenum">1493</span></a>              }
<a name="l1494"><span class="linenum">1494</span></a>              <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> );
<a name="l1495"><span class="linenum">1495</span></a>              if( empty( <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> ) )
<a name="l1496"><span class="linenum">1496</span></a>              { // Use a login or preferred name by default
<a name="l1497"><span class="linenum">1497</span></a>                  <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_username')" href="../../../_functions/get_username.html" onMouseOver="funcPopup(event,'get_username')">get_username</a>();
<a name="l1498"><span class="linenum">1498</span></a>              }
<a name="l1499"><span class="linenum">1499</span></a>  <span class="comment">            // Add class &quot;login&quot; to detect logins by js plugins</span>
<a name="l1500"><span class="linenum">1500</span></a>              <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> .= ( <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a> ? ' login' : '' );
<a name="l1501"><span class="linenum">1501</span></a>              if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['login_mask'] != '' )
<a name="l1502"><span class="linenum">1502</span></a>              { // Apply login mask
<a name="l1503"><span class="linenum">1503</span></a>                  <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( '<a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>$', <a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['login_mask'] );
<a name="l1504"><span class="linenum">1504</span></a>              }
<a name="l1505"><span class="linenum">1505</span></a>          }
<a name="l1506"><span class="linenum">1506</span></a>  
<a name="l1507"><span class="linenum">1507</span></a>          <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_gender_class')" href="../../../_functions/get_gender_class.html" onMouseOver="funcPopup(event,'get_gender_class')">get_gender_class</a>();
<a name="l1508"><span class="linenum">1508</span></a>          <a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a> = '';
<a name="l1509"><span class="linenum">1509</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['use_style'] )
<a name="l1510"><span class="linenum">1510</span></a>          { // Use &quot;style&quot;
<a name="l1511"><span class="linenum">1511</span></a>              <a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a> = <a class="function" onClick="logFunction('emailskin_style')" href="../../../_functions/emailskin_style.html" onMouseOver="funcPopup(event,'emailskin_style')">emailskin_style</a>( '.user+.'.<a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( ' ', '.', <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> ) );
<a name="l1512"><span class="linenum">1512</span></a>          }
<a name="l1513"><span class="linenum">1513</span></a>          <a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a> = ' class=&quot;'.<a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>.' '.<a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a>.( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['nowrap'] ? ' nowrap' : '' ) ).'&quot;'.<a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a>;
<a name="l1514"><span class="linenum">1514</span></a>  
<a name="l1515"><span class="linenum">1515</span></a>          if( empty( <a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('identity_url')" href="../../../_variables/identity_url.html">$identity_url</a> ) )
<a name="l1516"><span class="linenum">1516</span></a>          {
<a name="l1517"><span class="linenum">1517</span></a>              return '&lt;span'.<a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a>.<a class="var it3933" onMouseOver="hilite(3933)" onMouseOut="lolite()" onClick="logVariable('attr_bubbletip')" href="../../../_variables/attr_bubbletip.html">$attr_bubbletip</a>.'&gt;'.<a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('avatar_tag')" href="../../../_variables/avatar_tag.html">$avatar_tag</a>.<a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a>.'&lt;/span&gt;';
<a name="l1518"><span class="linenum">1518</span></a>          }
<a name="l1519"><span class="linenum">1519</span></a>  
<a name="l1520"><span class="linenum">1520</span></a>          <a class="var it1575" onMouseOver="hilite(1575)" onMouseOut="lolite()" onClick="logVariable('link_title')" href="../../../_variables/link_title.html">$link_title</a> = <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Show the user profile' );
<a name="l1521"><span class="linenum">1521</span></a>          return '&lt;a href=&quot;'.<a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('identity_url')" href="../../../_variables/identity_url.html">$identity_url</a>.'&quot; title=&quot;'.<a class="var it1575" onMouseOver="hilite(1575)" onMouseOut="lolite()" onClick="logVariable('link_title')" href="../../../_variables/link_title.html">$link_title</a>.'&quot;'.<a class="var it3932" onMouseOver="hilite(3932)" onMouseOut="lolite()" onClick="logVariable('attr_style')" href="../../../_variables/attr_style.html">$attr_style</a>.<a class="var it3933" onMouseOver="hilite(3933)" onMouseOut="lolite()" onClick="logVariable('attr_bubbletip')" href="../../../_variables/attr_bubbletip.html">$attr_bubbletip</a>.'&gt;'.<a class="var it175" onMouseOver="hilite(175)" onMouseOut="lolite()" onClick="logVariable('avatar_tag')" href="../../../_variables/avatar_tag.html">$avatar_tag</a>.<a class="var it3934" onMouseOver="hilite(3934)" onMouseOut="lolite()" onClick="logVariable('link_login')" href="../../../_variables/link_login.html">$link_login</a>.'&lt;/a&gt;';
<a name="l1522"><span class="linenum">1522</span></a>      }
<a name="l1523"><span class="linenum">1523</span></a>  
<a name="l1524"><span class="linenum">1524</span></a>  
<a name="l1525"><span class="linenum">1525</span></a>      <span class="comment">/**</span>
<a name="l1526"><span class="linenum">1526</span></a>  <span class="comment">     * Get Regional object</span>
<a name="l1527"><span class="linenum">1527</span></a>  <span class="comment">     *</span>
<a name="l1528"><span class="linenum">1528</span></a>  <span class="comment">     * @param string Object name (Country, Region, Subregion, City)</span>
<a name="l1529"><span class="linenum">1529</span></a>  <span class="comment">     * @param string ID name</span>
<a name="l1530"><span class="linenum">1530</span></a>  <span class="comment">     * @return object</span>
<a name="l1531"><span class="linenum">1531</span></a>  <span class="comment">     */</span>
<a name="l1532"><span class="linenum">1532</span></a>      function &amp; get_Regional( <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>, <a class="var it139" onMouseOver="hilite(139)" onMouseOut="lolite()" onClick="logVariable('ID')" href="../../../_variables/ID.html">$ID</a> )
<a name="l1533"><span class="linenum">1533</span></a>      {
<a name="l1534"><span class="linenum">1534</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_closed' ) &amp;&amp; ( !<a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() ) )
<a name="l1535"><span class="linenum">1535</span></a>          { // don't return closed accounts regional information to front office
<a name="l1536"><span class="linenum">1536</span></a>              return false;
<a name="l1537"><span class="linenum">1537</span></a>          }
<a name="l1538"><span class="linenum">1538</span></a>  
<a name="l1539"><span class="linenum">1539</span></a>          if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>) &amp;&amp; !empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="var it139" onMouseOver="hilite(139)" onMouseOut="lolite()" onClick="logVariable('ID')" href="../../../_variables/ID.html">$ID</a> ) )
<a name="l1540"><span class="linenum">1540</span></a>          {
<a name="l1541"><span class="linenum">1541</span></a>              <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('Cache')" href="../../../_variables/Cache.html">$Cache</a> = &amp; <a class="phpfunction" onClick="logFunction('call_user_func')" href="../../../_functions/call_user_func.html" onMouseOver="phpfuncPopup(event,'call_user_func')">call_user_func</a>( 'get_'.<a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>.'Cache' );
<a name="l1542"><span class="linenum">1542</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a> = <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('Cache')" href="../../../_variables/Cache.html">$Cache</a>-&gt;get_by_ID( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="var it139" onMouseOver="hilite(139)" onMouseOut="lolite()" onClick="logVariable('ID')" href="../../../_variables/ID.html">$ID</a>, false );
<a name="l1543"><span class="linenum">1543</span></a>          }
<a name="l1544"><span class="linenum">1544</span></a>  
<a name="l1545"><span class="linenum">1545</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>;
<a name="l1546"><span class="linenum">1546</span></a>      }
<a name="l1547"><span class="linenum">1547</span></a>  
<a name="l1548"><span class="linenum">1548</span></a>  
<a name="l1549"><span class="linenum">1549</span></a>      <span class="comment">/**</span>
<a name="l1550"><span class="linenum">1550</span></a>  <span class="comment">     * Get Regional name</span>
<a name="l1551"><span class="linenum">1551</span></a>  <span class="comment">     *</span>
<a name="l1552"><span class="linenum">1552</span></a>  <span class="comment">     * @param string Object name (Country, Region, Subregion, City)</span>
<a name="l1553"><span class="linenum">1553</span></a>  <span class="comment">     * @param string ID name</span>
<a name="l1554"><span class="linenum">1554</span></a>  <span class="comment">     * @return string Name of Country, Region, Subregion or City</span>
<a name="l1555"><span class="linenum">1555</span></a>  <span class="comment">     */</span>
<a name="l1556"><span class="linenum">1556</span></a>  	function <a class="function" onClick="logFunction('get_regional_name')" href="../../../_functions/get_regional_name.html" onMouseOver="funcPopup(event,'get_regional_name')">get_regional_name</a>( <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>, <a class="var it139" onMouseOver="hilite(139)" onMouseOut="lolite()" onClick="logVariable('ID')" href="../../../_variables/ID.html">$ID</a> )
<a name="l1557"><span class="linenum">1557</span></a>      {
<a name="l1558"><span class="linenum">1558</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Regional( <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>, <a class="var it139" onMouseOver="hilite(139)" onMouseOut="lolite()" onClick="logVariable('ID')" href="../../../_variables/ID.html">$ID</a> ) )
<a name="l1559"><span class="linenum">1559</span></a>          {    // We have an regional object:
<a name="l1560"><span class="linenum">1560</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>-&gt;<a onClick="logVariable('name')" class="var it10939" onMouseOver="hilite(10939)" onMouseOut="lolite()" href="../../../_variables/name.html">name</a>;
<a name="l1561"><span class="linenum">1561</span></a>          }
<a name="l1562"><span class="linenum">1562</span></a>  
<a name="l1563"><span class="linenum">1563</span></a>          return '';
<a name="l1564"><span class="linenum">1564</span></a>      }
<a name="l1565"><span class="linenum">1565</span></a>  
<a name="l1566"><span class="linenum">1566</span></a>  
<a name="l1567"><span class="linenum">1567</span></a>      <span class="comment">/**</span>
<a name="l1568"><span class="linenum">1568</span></a>  <span class="comment">     * Get Country object</span>
<a name="l1569"><span class="linenum">1569</span></a>  <span class="comment">     */</span>
<a name="l1570"><span class="linenum">1570</span></a>      function &amp; <a class="function" onClick="logFunction('get_Country')" href="../../../_functions/get_country.html" onMouseOver="funcPopup(event,'get_country')">get_Country</a>()
<a name="l1571"><span class="linenum">1571</span></a>      {
<a name="l1572"><span class="linenum">1572</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Regional( 'Country', 'ctry_ID' );
<a name="l1573"><span class="linenum">1573</span></a>      }
<a name="l1574"><span class="linenum">1574</span></a>  
<a name="l1575"><span class="linenum">1575</span></a>  
<a name="l1576"><span class="linenum">1576</span></a>      <span class="comment">/**</span>
<a name="l1577"><span class="linenum">1577</span></a>  <span class="comment">     * Get country name</span>
<a name="l1578"><span class="linenum">1578</span></a>  <span class="comment">     */</span>
<a name="l1579"><span class="linenum">1579</span></a>  	function <a class="function" onClick="logFunction('get_country_name')" href="../../../_functions/get_country_name.html" onMouseOver="funcPopup(event,'get_country_name')">get_country_name</a>()
<a name="l1580"><span class="linenum">1580</span></a>      {
<a name="l1581"><span class="linenum">1581</span></a>          if( empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> ) )
<a name="l1582"><span class="linenum">1582</span></a>          {
<a name="l1583"><span class="linenum">1583</span></a>              return;
<a name="l1584"><span class="linenum">1584</span></a>          }
<a name="l1585"><span class="linenum">1585</span></a>  
<a name="l1586"><span class="linenum">1586</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'regional/model/_country.class.php', 'Country' );
<a name="l1587"><span class="linenum">1587</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_regional_name')" href="../../../_functions/get_regional_name.html" onMouseOver="funcPopup(event,'get_regional_name')">get_regional_name</a>( 'Country', 'ctry_ID' );
<a name="l1588"><span class="linenum">1588</span></a>      }
<a name="l1589"><span class="linenum">1589</span></a>  
<a name="l1590"><span class="linenum">1590</span></a>      <span class="comment">/**</span>
<a name="l1591"><span class="linenum">1591</span></a>  <span class="comment">     * Get region name</span>
<a name="l1592"><span class="linenum">1592</span></a>  <span class="comment">     */</span>
<a name="l1593"><span class="linenum">1593</span></a>  	function <a class="function" onClick="logFunction('get_region_name')" href="../../../_functions/get_region_name.html" onMouseOver="funcPopup(event,'get_region_name')">get_region_name</a>()
<a name="l1594"><span class="linenum">1594</span></a>      {
<a name="l1595"><span class="linenum">1595</span></a>          if( empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('rgn_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/rgn_ID.html">rgn_ID</a> ) )
<a name="l1596"><span class="linenum">1596</span></a>          {
<a name="l1597"><span class="linenum">1597</span></a>              return;
<a name="l1598"><span class="linenum">1598</span></a>          }
<a name="l1599"><span class="linenum">1599</span></a>  
<a name="l1600"><span class="linenum">1600</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'regional/model/_region.class.php', 'Region' );
<a name="l1601"><span class="linenum">1601</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_regional_name')" href="../../../_functions/get_regional_name.html" onMouseOver="funcPopup(event,'get_regional_name')">get_regional_name</a>( 'Region', 'rgn_ID' );
<a name="l1602"><span class="linenum">1602</span></a>      }
<a name="l1603"><span class="linenum">1603</span></a>  
<a name="l1604"><span class="linenum">1604</span></a>      <span class="comment">/**</span>
<a name="l1605"><span class="linenum">1605</span></a>  <span class="comment">     * Get subregion name</span>
<a name="l1606"><span class="linenum">1606</span></a>  <span class="comment">     */</span>
<a name="l1607"><span class="linenum">1607</span></a>  	function <a class="function" onClick="logFunction('get_subregion_name')" href="../../../_functions/get_subregion_name.html" onMouseOver="funcPopup(event,'get_subregion_name')">get_subregion_name</a>()
<a name="l1608"><span class="linenum">1608</span></a>      {
<a name="l1609"><span class="linenum">1609</span></a>          if( empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('subrg_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/subrg_ID.html">subrg_ID</a> ) )
<a name="l1610"><span class="linenum">1610</span></a>          {
<a name="l1611"><span class="linenum">1611</span></a>              return;
<a name="l1612"><span class="linenum">1612</span></a>          }
<a name="l1613"><span class="linenum">1613</span></a>  
<a name="l1614"><span class="linenum">1614</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'regional/model/_subregion.class.php', 'Subregion' );
<a name="l1615"><span class="linenum">1615</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_regional_name')" href="../../../_functions/get_regional_name.html" onMouseOver="funcPopup(event,'get_regional_name')">get_regional_name</a>( 'Subregion', 'subrg_ID' );
<a name="l1616"><span class="linenum">1616</span></a>      }
<a name="l1617"><span class="linenum">1617</span></a>  
<a name="l1618"><span class="linenum">1618</span></a>      <span class="comment">/**</span>
<a name="l1619"><span class="linenum">1619</span></a>  <span class="comment">     * Get city name</span>
<a name="l1620"><span class="linenum">1620</span></a>  <span class="comment">     *</span>
<a name="l1621"><span class="linenum">1621</span></a>  <span class="comment">     * @param boolean TRUE - show postcode</span>
<a name="l1622"><span class="linenum">1622</span></a>  <span class="comment">     * @return string city name</span>
<a name="l1623"><span class="linenum">1623</span></a>  <span class="comment">     */</span>
<a name="l1624"><span class="linenum">1624</span></a>  	function <a class="function" onClick="logFunction('get_city_name')" href="../../../_functions/get_city_name.html" onMouseOver="funcPopup(event,'get_city_name')">get_city_name</a>( <a class="var it3936" onMouseOver="hilite(3936)" onMouseOut="lolite()" onClick="logVariable('show_postcode')" href="../../../_variables/show_postcode.html">$show_postcode</a> = true )
<a name="l1625"><span class="linenum">1625</span></a>      {
<a name="l1626"><span class="linenum">1626</span></a>          if( empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('city_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/city_ID.html">city_ID</a> ) )
<a name="l1627"><span class="linenum">1627</span></a>          {
<a name="l1628"><span class="linenum">1628</span></a>              return;
<a name="l1629"><span class="linenum">1629</span></a>          }
<a name="l1630"><span class="linenum">1630</span></a>  
<a name="l1631"><span class="linenum">1631</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'regional/model/_city.class.php', 'City' );
<a name="l1632"><span class="linenum">1632</span></a>          <a class="var it3937" onMouseOver="hilite(3937)" onMouseOut="lolite()" onClick="logVariable('city')" href="../../../_variables/city.html">$city</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_regional_name')" href="../../../_functions/get_regional_name.html" onMouseOver="funcPopup(event,'get_regional_name')">get_regional_name</a>( 'City', 'city_ID' );
<a name="l1633"><span class="linenum">1633</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('City')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/City.html">City</a> &amp;&amp; <a class="var it3936" onMouseOver="hilite(3936)" onMouseOut="lolite()" onClick="logVariable('show_postcode')" href="../../../_variables/show_postcode.html">$show_postcode</a> )
<a name="l1634"><span class="linenum">1634</span></a>          {    // Get postcode
<a name="l1635"><span class="linenum">1635</span></a>              <a class="var it3937" onMouseOver="hilite(3937)" onMouseOut="lolite()" onClick="logVariable('city')" href="../../../_variables/city.html">$city</a> .= ' ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('City')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/City.html">City</a>-&gt;postcode.')';
<a name="l1636"><span class="linenum">1636</span></a>          }
<a name="l1637"><span class="linenum">1637</span></a>          return <a class="var it3937" onMouseOver="hilite(3937)" onMouseOut="lolite()" onClick="logVariable('city')" href="../../../_variables/city.html">$city</a>;
<a name="l1638"><span class="linenum">1638</span></a>      }
<a name="l1639"><span class="linenum">1639</span></a>  
<a name="l1640"><span class="linenum">1640</span></a>  
<a name="l1641"><span class="linenum">1641</span></a>      <span class="comment">/**</span>
<a name="l1642"><span class="linenum">1642</span></a>  <span class="comment">     * Get the number of blogs owned by this user</span>
<a name="l1643"><span class="linenum">1643</span></a>  <span class="comment">     *</span>
<a name="l1644"><span class="linenum">1644</span></a>  <span class="comment">     * @return integer</span>
<a name="l1645"><span class="linenum">1645</span></a>  <span class="comment">     */</span>
<a name="l1646"><span class="linenum">1646</span></a>  	function <a class="function" onClick="logFunction('get_num_blogs')" href="../../../_functions/get_num_blogs.html" onMouseOver="funcPopup(event,'get_num_blogs')">get_num_blogs</a>()
<a name="l1647"><span class="linenum">1647</span></a>      {
<a name="l1648"><span class="linenum">1648</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1649"><span class="linenum">1649</span></a>  
<a name="l1650"><span class="linenum">1650</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>(*)
<a name="l1651"><span class="linenum">1651</span></a>                                  FROM T_blogs
<a name="l1652"><span class="linenum">1652</span></a>                                  WHERE blog_owner_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1653"><span class="linenum">1653</span></a>      }
<a name="l1654"><span class="linenum">1654</span></a>  
<a name="l1655"><span class="linenum">1655</span></a>  
<a name="l1656"><span class="linenum">1656</span></a>      <span class="comment">/**</span>
<a name="l1657"><span class="linenum">1657</span></a>  <span class="comment">     * Get the number of posts for the user.</span>
<a name="l1658"><span class="linenum">1658</span></a>  <span class="comment">     *</span>
<a name="l1659"><span class="linenum">1659</span></a>  <span class="comment">     * @param string Posts status</span>
<a name="l1660"><span class="linenum">1660</span></a>  <span class="comment">     * @return integer</span>
<a name="l1661"><span class="linenum">1661</span></a>  <span class="comment">     */</span>
<a name="l1662"><span class="linenum">1662</span></a>  	function <a class="function" onClick="logFunction('get_num_posts')" href="../../../_functions/get_num_posts.html" onMouseOver="funcPopup(event,'get_num_posts')">get_num_posts</a>( <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> = '' )
<a name="l1663"><span class="linenum">1663</span></a>      {
<a name="l1664"><span class="linenum">1664</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1665"><span class="linenum">1665</span></a>          global <a class="var it3422" onMouseOver="hilite(3422)" onMouseOut="lolite()" onClick="logVariable('collections_Module')" href="../../../_variables/collections_Module.html">$collections_Module</a>;
<a name="l1666"><span class="linenum">1666</span></a>  
<a name="l1667"><span class="linenum">1667</span></a>          if( isset( <a class="var it3422" onMouseOver="hilite(3422)" onMouseOut="lolite()" onClick="logVariable('collections_Module')" href="../../../_variables/collections_Module.html">$collections_Module</a> ) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_posts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_posts.html">_num_posts</a> ) )
<a name="l1668"><span class="linenum">1668</span></a>          {
<a name="l1669"><span class="linenum">1669</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>( 'Get the number of posts for the user' );
<a name="l1670"><span class="linenum">1670</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'post_status, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*)' );
<a name="l1671"><span class="linenum">1671</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_items__item' );
<a name="l1672"><span class="linenum">1672</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'post_creator_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1673"><span class="linenum">1673</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('GROUP_BY')" href="../../../_functions/group_by.html" onMouseOver="funcPopup(event,'group_by')">GROUP_BY</a>( 'post_status' );
<a name="l1674"><span class="linenum">1674</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_posts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_posts.html">_num_posts</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1675"><span class="linenum">1675</span></a>  
<a name="l1676"><span class="linenum">1676</span></a>  <span class="comment">            // Calc number of posts with all statuses</span>
<a name="l1677"><span class="linenum">1677</span></a>              <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> = 0;
<a name="l1678"><span class="linenum">1678</span></a>              foreach( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_posts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_posts.html">_num_posts</a> as <a class="var it3939" onMouseOver="hilite(3939)" onMouseOut="lolite()" onClick="logVariable('status_num_posts')" href="../../../_variables/status_num_posts.html">$status_num_posts</a> )
<a name="l1679"><span class="linenum">1679</span></a>              {
<a name="l1680"><span class="linenum">1680</span></a>                  <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> += <a class="var it3939" onMouseOver="hilite(3939)" onMouseOut="lolite()" onClick="logVariable('status_num_posts')" href="../../../_variables/status_num_posts.html">$status_num_posts</a>;
<a name="l1681"><span class="linenum">1681</span></a>              }
<a name="l1682"><span class="linenum">1682</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_posts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_posts.html">_num_posts</a>[''] = <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a>;
<a name="l1683"><span class="linenum">1683</span></a>          }
<a name="l1684"><span class="linenum">1684</span></a>  
<a name="l1685"><span class="linenum">1685</span></a>          return !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_posts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_posts.html">_num_posts</a>[ <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> ] ) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_posts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_posts.html">_num_posts</a>[ <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> ] : 0;
<a name="l1686"><span class="linenum">1686</span></a>      }
<a name="l1687"><span class="linenum">1687</span></a>  
<a name="l1688"><span class="linenum">1688</span></a>  
<a name="l1689"><span class="linenum">1689</span></a>      <span class="comment">/**</span>
<a name="l1690"><span class="linenum">1690</span></a>  <span class="comment">     * Get the number of comments for the user.</span>
<a name="l1691"><span class="linenum">1691</span></a>  <span class="comment">     *</span>
<a name="l1692"><span class="linenum">1692</span></a>  <span class="comment">     * @param string Comments status</span>
<a name="l1693"><span class="linenum">1693</span></a>  <span class="comment">     * @param boolean Count already recycled comments</span>
<a name="l1694"><span class="linenum">1694</span></a>  <span class="comment">     * @return integer</span>
<a name="l1695"><span class="linenum">1695</span></a>  <span class="comment">     */</span>
<a name="l1696"><span class="linenum">1696</span></a>  	function <a class="function" onClick="logFunction('get_num_comments')" href="../../../_functions/get_num_comments.html" onMouseOver="funcPopup(event,'get_num_comments')">get_num_comments</a>( <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> = '', <a class="var it3940" onMouseOver="hilite(3940)" onMouseOut="lolite()" onClick="logVariable('count_recycled')" href="../../../_variables/count_recycled.html">$count_recycled</a> = false )
<a name="l1697"><span class="linenum">1697</span></a>      {
<a name="l1698"><span class="linenum">1698</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1699"><span class="linenum">1699</span></a>          global <a class="var it3422" onMouseOver="hilite(3422)" onMouseOut="lolite()" onClick="logVariable('collections_Module')" href="../../../_variables/collections_Module.html">$collections_Module</a>;
<a name="l1700"><span class="linenum">1700</span></a>  
<a name="l1701"><span class="linenum">1701</span></a>          if( isset( <a class="var it3422" onMouseOver="hilite(3422)" onMouseOut="lolite()" onClick="logVariable('collections_Module')" href="../../../_variables/collections_Module.html">$collections_Module</a> ) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_comments')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_comments.html">_num_comments</a> ) )
<a name="l1702"><span class="linenum">1702</span></a>          {
<a name="l1703"><span class="linenum">1703</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>( 'Get the number of comments for the user' );
<a name="l1704"><span class="linenum">1704</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'comment_status, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*)' );
<a name="l1705"><span class="linenum">1705</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_comments' );
<a name="l1706"><span class="linenum">1706</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'comment_author_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1707"><span class="linenum">1707</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'comment_type IN ( &quot;comment&quot;, &quot;trackback&quot;, &quot;pingback&quot; )' );
<a name="l1708"><span class="linenum">1708</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('GROUP_BY')" href="../../../_functions/group_by.html" onMouseOver="funcPopup(event,'group_by')">GROUP_BY</a>( 'comment_status' );
<a name="l1709"><span class="linenum">1709</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_comments')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_comments.html">_num_comments</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1710"><span class="linenum">1710</span></a>  
<a name="l1711"><span class="linenum">1711</span></a>  <span class="comment">            // Calc number of comments with all statuses</span>
<a name="l1712"><span class="linenum">1712</span></a>              <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> = 0;
<a name="l1713"><span class="linenum">1713</span></a>              foreach( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_comments')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_comments.html">_num_comments</a> as <a class="var it3942" onMouseOver="hilite(3942)" onMouseOut="lolite()" onClick="logVariable('curr_status')" href="../../../_variables/curr_status.html">$curr_status</a> =&gt; <a class="var it3943" onMouseOver="hilite(3943)" onMouseOut="lolite()" onClick="logVariable('status_num_comments')" href="../../../_variables/status_num_comments.html">$status_num_comments</a> )
<a name="l1714"><span class="linenum">1714</span></a>              {
<a name="l1715"><span class="linenum">1715</span></a>                  if( <a class="var it3940" onMouseOver="hilite(3940)" onMouseOut="lolite()" onClick="logVariable('count_recycled')" href="../../../_variables/count_recycled.html">$count_recycled</a> || ( <a class="var it3942" onMouseOver="hilite(3942)" onMouseOut="lolite()" onClick="logVariable('curr_status')" href="../../../_variables/curr_status.html">$curr_status</a> != 'trash' ) )
<a name="l1716"><span class="linenum">1716</span></a>                  {
<a name="l1717"><span class="linenum">1717</span></a>                      <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> += <a class="var it3943" onMouseOver="hilite(3943)" onMouseOut="lolite()" onClick="logVariable('status_num_comments')" href="../../../_variables/status_num_comments.html">$status_num_comments</a>;
<a name="l1718"><span class="linenum">1718</span></a>                  }
<a name="l1719"><span class="linenum">1719</span></a>              }
<a name="l1720"><span class="linenum">1720</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_comments')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_comments.html">_num_comments</a>[''] = <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a>;
<a name="l1721"><span class="linenum">1721</span></a>          }
<a name="l1722"><span class="linenum">1722</span></a>  
<a name="l1723"><span class="linenum">1723</span></a>          return !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_comments')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_comments.html">_num_comments</a>[ <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> ] ) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_comments')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_comments.html">_num_comments</a>[ <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> ] : 0;
<a name="l1724"><span class="linenum">1724</span></a>      }
<a name="l1725"><span class="linenum">1725</span></a>  
<a name="l1726"><span class="linenum">1726</span></a>  
<a name="l1727"><span class="linenum">1727</span></a>      <span class="comment">/**</span>
<a name="l1728"><span class="linenum">1728</span></a>  <span class="comment">     * Get the number of files for the user.</span>
<a name="l1729"><span class="linenum">1729</span></a>  <span class="comment">     *</span>
<a name="l1730"><span class="linenum">1730</span></a>  <span class="comment">     * @param string File type: 'image', 'audio', 'other'</span>
<a name="l1731"><span class="linenum">1731</span></a>  <span class="comment">     * @return integer</span>
<a name="l1732"><span class="linenum">1732</span></a>  <span class="comment">     */</span>
<a name="l1733"><span class="linenum">1733</span></a>  	function <a class="function" onClick="logFunction('get_num_files')" href="../../../_functions/get_num_files.html" onMouseOver="funcPopup(event,'get_num_files')">get_num_files</a>( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> = NULL )
<a name="l1734"><span class="linenum">1734</span></a>      {
<a name="l1735"><span class="linenum">1735</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1736"><span class="linenum">1736</span></a>  
<a name="l1737"><span class="linenum">1737</span></a>          if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_files')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_files.html">_num_files</a> ) )
<a name="l1738"><span class="linenum">1738</span></a>          {
<a name="l1739"><span class="linenum">1739</span></a>              <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1740"><span class="linenum">1740</span></a>              <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'file_type, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( file_ID ) AS cnt' );
<a name="l1741"><span class="linenum">1741</span></a>              <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_links' );
<a name="l1742"><span class="linenum">1742</span></a>              <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_files ON file_ID = link_file_ID' );
<a name="l1743"><span class="linenum">1743</span></a>              <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'link_creator_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1744"><span class="linenum">1744</span></a>              <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('GROUP_BY')" href="../../../_functions/group_by.html" onMouseOver="funcPopup(event,'group_by')">GROUP_BY</a>( 'file_type' );
<a name="l1745"><span class="linenum">1745</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_files')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_files.html">_num_files</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1746"><span class="linenum">1746</span></a>          }
<a name="l1747"><span class="linenum">1747</span></a>  
<a name="l1748"><span class="linenum">1748</span></a>          return ! empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_files')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_files.html">_num_files</a>[ <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> ] ) ? <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_num_files')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_num_files.html">_num_files</a>[ <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> ] : 0;
<a name="l1749"><span class="linenum">1749</span></a>      }
<a name="l1750"><span class="linenum">1750</span></a>  
<a name="l1751"><span class="linenum">1751</span></a>  
<a name="l1752"><span class="linenum">1752</span></a>      <span class="comment">/**</span>
<a name="l1753"><span class="linenum">1753</span></a>  <span class="comment">     * Get the number of user sessions</span>
<a name="l1754"><span class="linenum">1754</span></a>  <span class="comment">     *</span>
<a name="l1755"><span class="linenum">1755</span></a>  <span class="comment">     * @param boolean set true to return the number of sessions as a link to the user sessions list</span>
<a name="l1756"><span class="linenum">1756</span></a>  <span class="comment">     * @return integer|string number of sessions or link to user sessions where the link text is the number of sessions</span>
<a name="l1757"><span class="linenum">1757</span></a>  <span class="comment">     */</span>
<a name="l1758"><span class="linenum">1758</span></a>  	function <a class="function" onClick="logFunction('get_num_sessions')" href="../../../_functions/get_num_sessions.html" onMouseOver="funcPopup(event,'get_num_sessions')">get_num_sessions</a>( <a class="var it3944" onMouseOver="hilite(3944)" onMouseOut="lolite()" onClick="logVariable('link_sessions')" href="../../../_variables/link_sessions.html">$link_sessions</a> = false )
<a name="l1759"><span class="linenum">1759</span></a>      {
<a name="l1760"><span class="linenum">1760</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1761"><span class="linenum">1761</span></a>  
<a name="l1762"><span class="linenum">1762</span></a>          <a class="var it3945" onMouseOver="hilite(3945)" onMouseOut="lolite()" onClick="logVariable('num_sessions')" href="../../../_variables/num_sessions.html">$num_sessions</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( sess_ID )
<a name="l1763"><span class="linenum">1763</span></a>                                              FROM T_sessions
<a name="l1764"><span class="linenum">1764</span></a>                                              WHERE sess_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1765"><span class="linenum">1765</span></a>  
<a name="l1766"><span class="linenum">1766</span></a>          if( <a class="var it3944" onMouseOver="hilite(3944)" onMouseOut="lolite()" onClick="logVariable('link_sessions')" href="../../../_variables/link_sessions.html">$link_sessions</a> &amp;&amp; ( <a class="var it3945" onMouseOver="hilite(3945)" onMouseOut="lolite()" onClick="logVariable('num_sessions')" href="../../../_variables/num_sessions.html">$num_sessions</a> &gt; 0 ) )
<a name="l1767"><span class="linenum">1767</span></a>          {
<a name="l1768"><span class="linenum">1768</span></a>              return <a class="var it3945" onMouseOver="hilite(3945)" onMouseOut="lolite()" onClick="logVariable('num_sessions')" href="../../../_variables/num_sessions.html">$num_sessions</a>.' - &lt;a href=&quot;?ctrl=user&amp;amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;amp;user_tab=sessions&quot; class=&quot;'.<a class="function" onClick="logFunction('button_class')" href="../../../_functions/button_class.html" onMouseOver="funcPopup(event,'button_class')">button_class</a>().' middle&quot; title=&quot;'.<a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Go to user activity'), 'htmlattr' ).'&quot;&gt;'.<a class="function" onClick="logFunction('get_icon')" href="../../../_functions/get_icon.html" onMouseOver="funcPopup(event,'get_icon')">get_icon</a>( 'magnifier', 'imgtag', array( 'title' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Go to user activity') ) ).'&lt;/a&gt;';
<a name="l1769"><span class="linenum">1769</span></a>          }
<a name="l1770"><span class="linenum">1770</span></a>  
<a name="l1771"><span class="linenum">1771</span></a>          return <a class="var it3945" onMouseOver="hilite(3945)" onMouseOut="lolite()" onClick="logVariable('num_sessions')" href="../../../_variables/num_sessions.html">$num_sessions</a>;
<a name="l1772"><span class="linenum">1772</span></a>      }
<a name="l1773"><span class="linenum">1773</span></a>  
<a name="l1774"><span class="linenum">1774</span></a>  
<a name="l1775"><span class="linenum">1775</span></a>      <span class="comment">/**</span>
<a name="l1776"><span class="linenum">1776</span></a>  <span class="comment">     * Get the number of user messages</span>
<a name="l1777"><span class="linenum">1777</span></a>  <span class="comment">     *</span>
<a name="l1778"><span class="linenum">1778</span></a>  <span class="comment">     * @param string Type ( sent | received )</span>
<a name="l1779"><span class="linenum">1779</span></a>  <span class="comment">     * @return integer the number of requested type of messages</span>
<a name="l1780"><span class="linenum">1780</span></a>  <span class="comment">     */</span>
<a name="l1781"><span class="linenum">1781</span></a>  	function <a class="function" onClick="logFunction('get_num_messages')" href="../../../_functions/get_num_messages.html" onMouseOver="funcPopup(event,'get_num_messages')">get_num_messages</a>( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> = 'sent' )
<a name="l1782"><span class="linenum">1782</span></a>      {
<a name="l1783"><span class="linenum">1783</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1784"><span class="linenum">1784</span></a>  
<a name="l1785"><span class="linenum">1785</span></a>          if( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> == 'received' )
<a name="l1786"><span class="linenum">1786</span></a>          {    // Get a count of messages received
<a name="l1787"><span class="linenum">1787</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1788"><span class="linenum">1788</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( msg_ID )' );
<a name="l1789"><span class="linenum">1789</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__threadstatus' );
<a name="l1790"><span class="linenum">1790</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'LEFT JOIN T_messaging__message ON tsta_thread_ID = msg_thread_ID' );
<a name="l1791"><span class="linenum">1791</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'tsta_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l1792"><span class="linenum">1792</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'msg_author_user_ID != '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l1793"><span class="linenum">1793</span></a>          }
<a name="l1794"><span class="linenum">1794</span></a>          else
<a name="l1795"><span class="linenum">1795</span></a>          {    // Get a count of messages sent
<a name="l1796"><span class="linenum">1796</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l1797"><span class="linenum">1797</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( msg_ID )' );
<a name="l1798"><span class="linenum">1798</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_messaging__message' );
<a name="l1799"><span class="linenum">1799</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'msg_author_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l1800"><span class="linenum">1800</span></a>          }
<a name="l1801"><span class="linenum">1801</span></a>  
<a name="l1802"><span class="linenum">1802</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l1803"><span class="linenum">1803</span></a>      }
<a name="l1804"><span class="linenum">1804</span></a>  
<a name="l1805"><span class="linenum">1805</span></a>  
<a name="l1806"><span class="linenum">1806</span></a>      <span class="comment">/**</span>
<a name="l1807"><span class="linenum">1807</span></a>  <span class="comment">     * Get the number of other users posts which were edited by this user</span>
<a name="l1808"><span class="linenum">1808</span></a>  <span class="comment">     *</span>
<a name="l1809"><span class="linenum">1809</span></a>  <span class="comment">     * @return integer the number of edited posts</span>
<a name="l1810"><span class="linenum">1810</span></a>  <span class="comment">     */</span>
<a name="l1811"><span class="linenum">1811</span></a>  	function <a class="function" onClick="logFunction('get_num_edited_posts')" href="../../../_functions/get_num_edited_posts.html" onMouseOver="funcPopup(event,'get_num_edited_posts')">get_num_edited_posts</a>()
<a name="l1812"><span class="linenum">1812</span></a>      {
<a name="l1813"><span class="linenum">1813</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l1814"><span class="linenum">1814</span></a>          global <a class="var it3422" onMouseOver="hilite(3422)" onMouseOut="lolite()" onClick="logVariable('collections_Module')" href="../../../_variables/collections_Module.html">$collections_Module</a>;
<a name="l1815"><span class="linenum">1815</span></a>  
<a name="l1816"><span class="linenum">1816</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( DISTINCT( post_ID ) )
<a name="l1817"><span class="linenum">1817</span></a>                                      FROM T_items__item
<a name="l1818"><span class="linenum">1818</span></a>                                      INNER JOIN T_items__version ON post_ID = iver_itm_ID
<a name="l1819"><span class="linenum">1819</span></a>                                      WHERE post_creator_user_ID &lt;&gt; '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.' AND
<a name="l1820"><span class="linenum">1820</span></a>                                          ( iver_edit_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.' OR post_lastedit_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.' )' );
<a name="l1821"><span class="linenum">1821</span></a>      }
<a name="l1822"><span class="linenum">1822</span></a>  
<a name="l1823"><span class="linenum">1823</span></a>  
<a name="l1824"><span class="linenum">1824</span></a>      <span class="comment">/**</span>
<a name="l1825"><span class="linenum">1825</span></a>  <span class="comment">     * Get the path to the media directory. If it does not exist, it will be created.</span>
<a name="l1826"><span class="linenum">1826</span></a>  <span class="comment">     *</span>
<a name="l1827"><span class="linenum">1827</span></a>  <span class="comment">     * If we're {@link is_admin_page() on an admin page}, it adds status messages.</span>
<a name="l1828"><span class="linenum">1828</span></a>  <span class="comment">     * @todo These status messages should rather go to a &quot;syslog&quot; and not be displayed to a normal user</span>
<a name="l1829"><span class="linenum">1829</span></a>  <span class="comment">     * @todo dh&gt; refactor this into e.g. create_media_dir() and use it for Blog::get_media_dir, too.</span>
<a name="l1830"><span class="linenum">1830</span></a>  <span class="comment">     *</span>
<a name="l1831"><span class="linenum">1831</span></a>  <span class="comment">     * @param boolean Create the directory, if it does not exist yet?</span>
<a name="l1832"><span class="linenum">1832</span></a>  <span class="comment">     * @return mixed the path as string on success, false if the dir could not be created</span>
<a name="l1833"><span class="linenum">1833</span></a>  <span class="comment">     */</span>
<a name="l1834"><span class="linenum">1834</span></a>  	function <a class="function" onClick="logFunction('get_media_dir')" href="../../../_functions/get_media_dir.html" onMouseOver="funcPopup(event,'get_media_dir')">get_media_dir</a>( <a class="var it3946" onMouseOver="hilite(3946)" onMouseOut="lolite()" onClick="logVariable('create')" href="../../../_variables/create.html">$create</a> = true )
<a name="l1835"><span class="linenum">1835</span></a>      {
<a name="l1836"><span class="linenum">1836</span></a>          global <a class="var it2840" onMouseOver="hilite(2840)" onMouseOut="lolite()" onClick="logVariable('media_path')" href="../../../_variables/media_path.html">$media_path</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l1837"><span class="linenum">1837</span></a>  
<a name="l1838"><span class="linenum">1838</span></a>          if( ! <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'fm_enable_roots_user' ) )
<a name="l1839"><span class="linenum">1839</span></a>          {    // User directories are disabled:
<a name="l1840"><span class="linenum">1840</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Attempt to access user media dir, but this feature is disabled', 'files' );
<a name="l1841"><span class="linenum">1841</span></a>              return false;
<a name="l1842"><span class="linenum">1842</span></a>          }
<a name="l1843"><span class="linenum">1843</span></a>  
<a name="l1844"><span class="linenum">1844</span></a>          <a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a> = <a class="function" onClick="logFunction('get_canonical_path')" href="../../../_functions/get_canonical_path.html" onMouseOver="funcPopup(event,'get_canonical_path')">get_canonical_path</a>( <a class="var it2840" onMouseOver="hilite(2840)" onMouseOut="lolite()" onClick="logVariable('media_path')" href="../../../_variables/media_path.html">$media_path</a>.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_media_subpath')" href="../../../_functions/get_media_subpath.html" onMouseOver="funcPopup(event,'get_media_subpath')">get_media_subpath</a>() );
<a name="l1845"><span class="linenum">1845</span></a>  
<a name="l1846"><span class="linenum">1846</span></a>          if( <a class="var it3946" onMouseOver="hilite(3946)" onMouseOut="lolite()" onClick="logVariable('create')" href="../../../_variables/create.html">$create</a> &amp;&amp; ! <a class="phpfunction" onClick="logFunction('is_dir')" href="../../../_functions/is_dir.html" onMouseOver="phpfuncPopup(event,'is_dir')">is_dir</a>( <a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a> ) )
<a name="l1847"><span class="linenum">1847</span></a>          {
<a name="l1848"><span class="linenum">1848</span></a>              if( ! <a class="phpfunction" onClick="logFunction('is_writable')" href="../../../_functions/is_writable.html" onMouseOver="phpfuncPopup(event,'is_writable')">is_writable</a>( <a class="phpfunction" onClick="logFunction('dirname')" href="../../../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(<a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a>) ) )
<a name="l1849"><span class="linenum">1849</span></a>              { // add error
<a name="l1850"><span class="linenum">1850</span></a>                  if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l1851"><span class="linenum">1851</span></a>                  {
<a name="l1852"><span class="linenum">1852</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>(&quot;The user's media directory &amp;laquo;%s&amp;raquo; could not be created, because the parent directory is not writable or does not exist.&quot;), <a class="function" onClick="logFunction('rel_path_to_base')" href="../../../_functions/rel_path_to_base.html" onMouseOver="funcPopup(event,'rel_path_to_base')">rel_path_to_base</a>(<a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a>) )
<a name="l1853"><span class="linenum">1853</span></a>                              .<a class="function" onClick="logFunction('get_manual_link')" href="../../../_functions/get_manual_link.html" onMouseOver="funcPopup(event,'get_manual_link')">get_manual_link</a>('directory_creation_error'), 'error' );
<a name="l1854"><span class="linenum">1854</span></a>                  }
<a name="l1855"><span class="linenum">1855</span></a>                  return false;
<a name="l1856"><span class="linenum">1856</span></a>              }
<a name="l1857"><span class="linenum">1857</span></a>              elseif( ! <a class="function" onClick="logFunction('evo_mkdir')" href="../../../_functions/evo_mkdir.html" onMouseOver="funcPopup(event,'evo_mkdir')">evo_mkdir</a>( <a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a> ) )
<a name="l1858"><span class="linenum">1858</span></a>              { // add error
<a name="l1859"><span class="linenum">1859</span></a>                  if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l1860"><span class="linenum">1860</span></a>                  {
<a name="l1861"><span class="linenum">1861</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>(&quot;The user's media directory &amp;laquo;%s&amp;raquo; could not be created.&quot;), <a class="function" onClick="logFunction('rel_path_to_base')" href="../../../_functions/rel_path_to_base.html" onMouseOver="funcPopup(event,'rel_path_to_base')">rel_path_to_base</a>(<a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a>) )
<a name="l1862"><span class="linenum">1862</span></a>                              .<a class="function" onClick="logFunction('get_manual_link')" href="../../../_functions/get_manual_link.html" onMouseOver="funcPopup(event,'get_manual_link')">get_manual_link</a>('directory_creation_error'), 'error' );
<a name="l1863"><span class="linenum">1863</span></a>                  }
<a name="l1864"><span class="linenum">1864</span></a>                  return false;
<a name="l1865"><span class="linenum">1865</span></a>              }
<a name="l1866"><span class="linenum">1866</span></a>              else
<a name="l1867"><span class="linenum">1867</span></a>              { // add note:
<a name="l1868"><span class="linenum">1868</span></a>                  if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l1869"><span class="linenum">1869</span></a>                  {
<a name="l1870"><span class="linenum">1870</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>(&quot;The user's directory &amp;laquo;%s&amp;raquo; has been created with permissions %s.&quot;), <a class="function" onClick="logFunction('rel_path_to_base')" href="../../../_functions/rel_path_to_base.html" onMouseOver="funcPopup(event,'rel_path_to_base')">rel_path_to_base</a>(<a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a>), <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( sprintf('%o', <a class="phpfunction" onClick="logFunction('fileperms')" href="../../../_functions/fileperms.html" onMouseOver="phpfuncPopup(event,'fileperms')">fileperms</a>(<a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a>)), -3 ) ), 'success' );
<a name="l1871"><span class="linenum">1871</span></a>                  }
<a name="l1872"><span class="linenum">1872</span></a>              }
<a name="l1873"><span class="linenum">1873</span></a>          }
<a name="l1874"><span class="linenum">1874</span></a>          return <a class="var it3947" onMouseOver="hilite(3947)" onMouseOut="lolite()" onClick="logVariable('userdir')" href="../../../_variables/userdir.html">$userdir</a>;
<a name="l1875"><span class="linenum">1875</span></a>      }
<a name="l1876"><span class="linenum">1876</span></a>  
<a name="l1877"><span class="linenum">1877</span></a>  
<a name="l1878"><span class="linenum">1878</span></a>      <span class="comment">/**</span>
<a name="l1879"><span class="linenum">1879</span></a>  <span class="comment">     * Get the URL to the media folder</span>
<a name="l1880"><span class="linenum">1880</span></a>  <span class="comment">     *</span>
<a name="l1881"><span class="linenum">1881</span></a>  <span class="comment">     * @return string the URL</span>
<a name="l1882"><span class="linenum">1882</span></a>  <span class="comment">     */</span>
<a name="l1883"><span class="linenum">1883</span></a>  	function <a class="function" onClick="logFunction('get_media_url')" href="../../../_functions/get_media_url.html" onMouseOver="funcPopup(event,'get_media_url')">get_media_url</a>()
<a name="l1884"><span class="linenum">1884</span></a>      {
<a name="l1885"><span class="linenum">1885</span></a>          global <a class="var it3258" onMouseOver="hilite(3258)" onMouseOut="lolite()" onClick="logVariable('media_url')" href="../../../_variables/media_url.html">$media_url</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l1886"><span class="linenum">1886</span></a>          global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l1887"><span class="linenum">1887</span></a>  
<a name="l1888"><span class="linenum">1888</span></a>          if( ! <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'fm_enable_roots_user' ) )
<a name="l1889"><span class="linenum">1889</span></a>          { // User directories are disabled:
<a name="l1890"><span class="linenum">1890</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Attempt to access user media URL, but this feature is disabled', 'files' );
<a name="l1891"><span class="linenum">1891</span></a>              return false;
<a name="l1892"><span class="linenum">1892</span></a>          }
<a name="l1893"><span class="linenum">1893</span></a>  
<a name="l1894"><span class="linenum">1894</span></a>          if( ! empty( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> ) )
<a name="l1895"><span class="linenum">1895</span></a>          { // We are currently looking at a blog. We are going to consider (for now) that we want the users and their files
<a name="l1896"><span class="linenum">1896</span></a>  <span class="comment">            // to appear as being part of that blog.</span>
<a name="l1897"><span class="linenum">1897</span></a>              return <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get_local_media_url')" href="../../../_functions/get_local_media_url.html" onMouseOver="funcPopup(event,'get_local_media_url')">get_local_media_url</a>().<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_media_subpath')" href="../../../_functions/get_media_subpath.html" onMouseOver="funcPopup(event,'get_media_subpath')">get_media_subpath</a>();
<a name="l1898"><span class="linenum">1898</span></a>          }
<a name="l1899"><span class="linenum">1899</span></a>  
<a name="l1900"><span class="linenum">1900</span></a>  <span class="comment">        // System media url:</span>
<a name="l1901"><span class="linenum">1901</span></a>          return <a class="var it3258" onMouseOver="hilite(3258)" onMouseOut="lolite()" onClick="logVariable('media_url')" href="../../../_variables/media_url.html">$media_url</a>.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_media_subpath')" href="../../../_functions/get_media_subpath.html" onMouseOver="funcPopup(event,'get_media_subpath')">get_media_subpath</a>();
<a name="l1902"><span class="linenum">1902</span></a>      }
<a name="l1903"><span class="linenum">1903</span></a>  
<a name="l1904"><span class="linenum">1904</span></a>  
<a name="l1905"><span class="linenum">1905</span></a>      <span class="comment">/**</span>
<a name="l1906"><span class="linenum">1906</span></a>  <span class="comment">     * Get user media directory subpath, e.g. users/{login}/ or users/usr_{user ID}/</span>
<a name="l1907"><span class="linenum">1907</span></a>  <span class="comment">     */</span>
<a name="l1908"><span class="linenum">1908</span></a>  	function <a class="function" onClick="logFunction('get_media_subpath')" href="../../../_functions/get_media_subpath.html" onMouseOver="funcPopup(event,'get_media_subpath')">get_media_subpath</a>()
<a name="l1909"><span class="linenum">1909</span></a>      {
<a name="l1910"><span class="linenum">1910</span></a>          if( <a class="function" onClick="logFunction('is_valid_login')" href="../../../_functions/is_valid_login.html" onMouseOver="funcPopup(event,'is_valid_login')">is_valid_login</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, true ) )
<a name="l1911"><span class="linenum">1911</span></a>          {    // Valid ASCII login, use it as is
<a name="l1912"><span class="linenum">1912</span></a>              return 'users/'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>.'/';
<a name="l1913"><span class="linenum">1913</span></a>          }
<a name="l1914"><span class="linenum">1914</span></a>          else
<a name="l1915"><span class="linenum">1915</span></a>          {    // Non-ASCII login
<a name="l1916"><span class="linenum">1916</span></a>              return 'users/usr_'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'/';
<a name="l1917"><span class="linenum">1917</span></a>          }
<a name="l1918"><span class="linenum">1918</span></a>      }
<a name="l1919"><span class="linenum">1919</span></a>  
<a name="l1920"><span class="linenum">1920</span></a>  
<a name="l1921"><span class="linenum">1921</span></a>      <span class="comment">/**</span>
<a name="l1922"><span class="linenum">1922</span></a>  <span class="comment">     * Get message form url</span>
<a name="l1923"><span class="linenum">1923</span></a>  <span class="comment">     */</span>
<a name="l1924"><span class="linenum">1924</span></a>  	function <a class="function" onClick="logFunction('get_msgform_url')" href="../../../_functions/get_msgform_url.html" onMouseOver="funcPopup(event,'get_msgform_url')">get_msgform_url</a>( <a class="var it3948" onMouseOver="hilite(3948)" onMouseOut="lolite()" onClick="logVariable('formurl')" href="../../../_variables/formurl.html">$formurl</a>, <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = NULL )
<a name="l1925"><span class="linenum">1925</span></a>      {
<a name="l1926"><span class="linenum">1926</span></a>          global <a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('ReqURI')" href="../../../_variables/ReqURI.html">$ReqURI</a>;
<a name="l1927"><span class="linenum">1927</span></a>  
<a name="l1928"><span class="linenum">1928</span></a>          if( ! <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_msgform_possibility')" href="../../../_functions/get_msgform_possibility.html" onMouseOver="funcPopup(event,'get_msgform_possibility')">get_msgform_possibility</a>() )
<a name="l1929"><span class="linenum">1929</span></a>          {
<a name="l1930"><span class="linenum">1930</span></a>              return NULL;
<a name="l1931"><span class="linenum">1931</span></a>          }
<a name="l1932"><span class="linenum">1932</span></a>  
<a name="l1933"><span class="linenum">1933</span></a>          if( <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> == NULL )
<a name="l1934"><span class="linenum">1934</span></a>          {
<a name="l1935"><span class="linenum">1935</span></a>              <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = <a class="var it477" onMouseOver="hilite(477)" onMouseOut="lolite()" onClick="logVariable('ReqURI')" href="../../../_variables/ReqURI.html">$ReqURI</a>;
<a name="l1936"><span class="linenum">1936</span></a>          }
<a name="l1937"><span class="linenum">1937</span></a>  
<a name="l1938"><span class="linenum">1938</span></a>          return <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it3948" onMouseOver="hilite(3948)" onMouseOut="lolite()" onClick="logVariable('formurl')" href="../../../_variables/formurl.html">$formurl</a>, 'recipient_id='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;amp;redirect_to='.<a class="phpfunction" onClick="logFunction('rawurlencode')" href="../../../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>( <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> ) );
<a name="l1939"><span class="linenum">1939</span></a>      }
<a name="l1940"><span class="linenum">1940</span></a>  
<a name="l1941"><span class="linenum">1941</span></a>  
<a name="l1942"><span class="linenum">1942</span></a>      <span class="comment">/**</span>
<a name="l1943"><span class="linenum">1943</span></a>  <span class="comment">     * Get user page url</span>
<a name="l1944"><span class="linenum">1944</span></a>  <span class="comment">     *</span>
<a name="l1945"><span class="linenum">1945</span></a>  <span class="comment">     * @param integer|NULL Blog ID or NULL to use current blog</span>
<a name="l1946"><span class="linenum">1946</span></a>  <span class="comment">     * @param boolean TRUE to force use URL even when current user in not logged in</span>
<a name="l1947"><span class="linenum">1947</span></a>  <span class="comment">     * @return string</span>
<a name="l1948"><span class="linenum">1948</span></a>  <span class="comment">     */</span>
<a name="l1949"><span class="linenum">1949</span></a>  	function <a class="function" onClick="logFunction('get_userpage_url')" href="../../../_functions/get_userpage_url.html" onMouseOver="funcPopup(event,'get_userpage_url')">get_userpage_url</a>( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> = NULL, <a class="var it3949" onMouseOver="hilite(3949)" onMouseOut="lolite()" onClick="logVariable('force_url')" href="../../../_variables/force_url.html">$force_url</a> = false )
<a name="l1950"><span class="linenum">1950</span></a>      {
<a name="l1951"><span class="linenum">1951</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l1952"><span class="linenum">1952</span></a>  
<a name="l1953"><span class="linenum">1953</span></a>          if( ! empty( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> ) )
<a name="l1954"><span class="linenum">1954</span></a>          { // Use blog from param by ID
<a name="l1955"><span class="linenum">1955</span></a>              <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a> = &amp; get_BlogCache();
<a name="l1956"><span class="linenum">1956</span></a>              <a class="var it3226" onMouseOver="hilite(3226)" onMouseOut="lolite()" onClick="logVariable('current_Blog')" href="../../../_variables/current_Blog.html">$current_Blog</a> = &amp; <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a>-&gt;get_by_ID( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, false, false );
<a name="l1957"><span class="linenum">1957</span></a>          }
<a name="l1958"><span class="linenum">1958</span></a>  
<a name="l1959"><span class="linenum">1959</span></a>          if( empty( <a class="var it3226" onMouseOver="hilite(3226)" onMouseOut="lolite()" onClick="logVariable('current_Blog')" href="../../../_variables/current_Blog.html">$current_Blog</a> ) )
<a name="l1960"><span class="linenum">1960</span></a>          { // Use current blog
<a name="l1961"><span class="linenum">1961</span></a>              global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l1962"><span class="linenum">1962</span></a>              <a class="var it3226" onMouseOver="hilite(3226)" onMouseOut="lolite()" onClick="logVariable('current_Blog')" href="../../../_variables/current_Blog.html">$current_Blog</a> = &amp; <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l1963"><span class="linenum">1963</span></a>          }
<a name="l1964"><span class="linenum">1964</span></a>  
<a name="l1965"><span class="linenum">1965</span></a>          if( empty( <a class="var it3226" onMouseOver="hilite(3226)" onMouseOut="lolite()" onClick="logVariable('current_Blog')" href="../../../_variables/current_Blog.html">$current_Blog</a> ) || empty( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a> ) )
<a name="l1966"><span class="linenum">1966</span></a>          { // Wrong request
<a name="l1967"><span class="linenum">1967</span></a>              return NULL;
<a name="l1968"><span class="linenum">1968</span></a>          }
<a name="l1969"><span class="linenum">1969</span></a>  
<a name="l1970"><span class="linenum">1970</span></a>          if( <a class="var it3949" onMouseOver="hilite(3949)" onMouseOut="lolite()" onClick="logVariable('force_url')" href="../../../_variables/force_url.html">$force_url</a> || <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l1971"><span class="linenum">1971</span></a>          { // If current User is logged in
<a name="l1972"><span class="linenum">1972</span></a>              if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'user_url_loggedin' ) == 'url' &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>( true ) != '' )
<a name="l1973"><span class="linenum">1973</span></a>              { // Use website url if it is defined and setting enables this
<a name="l1974"><span class="linenum">1974</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>( true );
<a name="l1975"><span class="linenum">1975</span></a>              }
<a name="l1976"><span class="linenum">1976</span></a>              else
<a name="l1977"><span class="linenum">1977</span></a>              { // Use an user page if url is not defined
<a name="l1978"><span class="linenum">1978</span></a>                  return <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it3226" onMouseOver="hilite(3226)" onMouseOut="lolite()" onClick="logVariable('current_Blog')" href="../../../_variables/current_Blog.html">$current_Blog</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'userurl' ), 'user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1979"><span class="linenum">1979</span></a>              }
<a name="l1980"><span class="linenum">1980</span></a>          }
<a name="l1981"><span class="linenum">1981</span></a>          else
<a name="l1982"><span class="linenum">1982</span></a>          { // For anonymous users
<a name="l1983"><span class="linenum">1983</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group();
<a name="l1984"><span class="linenum">1984</span></a>              if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;level &gt;= <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'allow_anonymous_user_level_min' ) &amp;&amp;
<a name="l1985"><span class="linenum">1985</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;level &lt;= <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'allow_anonymous_user_level_max' ) )
<a name="l1986"><span class="linenum">1986</span></a>              { // Check if anonymous users have an access to view this user
<a name="l1987"><span class="linenum">1987</span></a>                  if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'user_url_anonymous' ) == 'url' &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>( true ) != '' )
<a name="l1988"><span class="linenum">1988</span></a>                  { // Use website url if it is defined and setting enables this
<a name="l1989"><span class="linenum">1989</span></a>                      return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>( true );
<a name="l1990"><span class="linenum">1990</span></a>                  }
<a name="l1991"><span class="linenum">1991</span></a>                  elseif( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'allow_anonymous_user_profiles' ) )
<a name="l1992"><span class="linenum">1992</span></a>                  { // Use an user page if url is not defined and this is enabled by setting for anonymous users
<a name="l1993"><span class="linenum">1993</span></a>                      return <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it3226" onMouseOver="hilite(3226)" onMouseOut="lolite()" onClick="logVariable('current_Blog')" href="../../../_variables/current_Blog.html">$current_Blog</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'userurl' ), 'user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l1994"><span class="linenum">1994</span></a>                  }
<a name="l1995"><span class="linenum">1995</span></a>              }
<a name="l1996"><span class="linenum">1996</span></a>          }
<a name="l1997"><span class="linenum">1997</span></a>  
<a name="l1998"><span class="linenum">1998</span></a>  <span class="comment">        // return NULL if user page url is not allowed</span>
<a name="l1999"><span class="linenum">1999</span></a>          return NULL;
<a name="l2000"><span class="linenum">2000</span></a>      }
<a name="l2001"><span class="linenum">2001</span></a>  
<a name="l2002"><span class="linenum">2002</span></a>  
<a name="l2003"><span class="linenum">2003</span></a>      <span class="comment">/**</span>
<a name="l2004"><span class="linenum">2004</span></a>  <span class="comment">     * Get url from defined userfields</span>
<a name="l2005"><span class="linenum">2005</span></a>  <span class="comment">     *</span>
<a name="l2006"><span class="linenum">2006</span></a>  <span class="comment">     * @param boolean TRUE if we want get a value from url fields of the table T_users__fields, FALSE - get from $this-&gt;url</span>
<a name="l2007"><span class="linenum">2007</span></a>  <span class="comment">     * @return string Url</span>
<a name="l2008"><span class="linenum">2008</span></a>  <span class="comment">     */</span>
<a name="l2009"><span class="linenum">2009</span></a>  	function <a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>( <a class="var it3950" onMouseOver="hilite(3950)" onMouseOut="lolite()" onClick="logVariable('from_extra_fields')" href="../../../_variables/from_extra_fields.html">$from_extra_fields</a> = false )
<a name="l2010"><span class="linenum">2010</span></a>      {
<a name="l2011"><span class="linenum">2011</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l2012"><span class="linenum">2012</span></a>  
<a name="l2013"><span class="linenum">2013</span></a>          if( <a class="var it3950" onMouseOver="hilite(3950)" onMouseOut="lolite()" onClick="logVariable('from_extra_fields')" href="../../../_variables/from_extra_fields.html">$from_extra_fields</a> )
<a name="l2014"><span class="linenum">2014</span></a>          {    // Get value from DB or from cache
<a name="l2015"><span class="linenum">2015</span></a>              if( isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('field_url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/field_url.html">field_url</a> ) )
<a name="l2016"><span class="linenum">2016</span></a>              {    // Get url from variable already defined in first calling of this method
<a name="l2017"><span class="linenum">2017</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('field_url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/field_url.html">field_url</a>;
<a name="l2018"><span class="linenum">2018</span></a>              }
<a name="l2019"><span class="linenum">2019</span></a>              else
<a name="l2020"><span class="linenum">2020</span></a>              {    // Get value from DB
<a name="l2021"><span class="linenum">2021</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('field_url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/field_url.html">field_url</a> = (string)<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( '
<a name="l2022"><span class="linenum">2022</span></a>                      SELECT uf_varchar
<a name="l2023"><span class="linenum">2023</span></a>                          FROM T_users__fields
<a name="l2024"><span class="linenum">2024</span></a>                              LEFT JOIN T_users__fielddefs ON uf_ufdf_ID = ufdf_ID
<a name="l2025"><span class="linenum">2025</span></a>                              LEFT JOIN T_users__fieldgroups ON ufdf_ufgp_ID = ufgp_ID
<a name="l2026"><span class="linenum">2026</span></a>                      WHERE uf_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l2027"><span class="linenum">2027</span></a>                          AND ufdf_type = &quot;url&quot;
<a name="l2028"><span class="linenum">2028</span></a>                      ORDER BY ufgp_order, ufdf_order, uf_ID
<a name="l2029"><span class="linenum">2029</span></a>                      LIMIT 1' );
<a name="l2030"><span class="linenum">2030</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('field_url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/field_url.html">field_url</a>;
<a name="l2031"><span class="linenum">2031</span></a>              }
<a name="l2032"><span class="linenum">2032</span></a>          }
<a name="l2033"><span class="linenum">2033</span></a>          else
<a name="l2034"><span class="linenum">2034</span></a>          {    // Get value from <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/url.html">url</a> (T_users)
<a name="l2035"><span class="linenum">2035</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/url.html">url</a>;
<a name="l2036"><span class="linenum">2036</span></a>          }
<a name="l2037"><span class="linenum">2037</span></a>      }
<a name="l2038"><span class="linenum">2038</span></a>  
<a name="l2039"><span class="linenum">2039</span></a>  
<a name="l2040"><span class="linenum">2040</span></a>      <span class="comment">/**</span>
<a name="l2041"><span class="linenum">2041</span></a>  <span class="comment">     * Get link from defined userfields</span>
<a name="l2042"><span class="linenum">2042</span></a>  <span class="comment">     *</span>
<a name="l2043"><span class="linenum">2043</span></a>  <span class="comment">     * @param array Template params</span>
<a name="l2044"><span class="linenum">2044</span></a>  <span class="comment">     * @return string Link</span>
<a name="l2045"><span class="linenum">2045</span></a>  <span class="comment">     */</span>
<a name="l2046"><span class="linenum">2046</span></a>  	function <a class="function" onClick="logFunction('get_field_link')" href="../../../_functions/get_field_link.html" onMouseOver="funcPopup(event,'get_field_link')">get_field_link</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l2047"><span class="linenum">2047</span></a>      {
<a name="l2048"><span class="linenum">2048</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l2049"><span class="linenum">2049</span></a>                  'target' =&gt; '_blank',
<a name="l2050"><span class="linenum">2050</span></a>                  'rel'    =&gt; 'nofollow'
<a name="l2051"><span class="linenum">2051</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l2052"><span class="linenum">2052</span></a>  
<a name="l2053"><span class="linenum">2053</span></a>          <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a> = '&lt;a href=&quot;'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>().'&quot;'.<a class="function" onClick="logFunction('get_field_attribs_as_string')" href="../../../_functions/get_field_attribs_as_string.html" onMouseOver="funcPopup(event,'get_field_attribs_as_string')">get_field_attribs_as_string</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>, false ).'&gt;'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>().'&lt;/a&gt;';
<a name="l2054"><span class="linenum">2054</span></a>  
<a name="l2055"><span class="linenum">2055</span></a>          return <a class="var it177" onMouseOver="hilite(177)" onMouseOut="lolite()" onClick="logVariable('link')" href="../../../_variables/link.html">$link</a>;
<a name="l2056"><span class="linenum">2056</span></a>      }
<a name="l2057"><span class="linenum">2057</span></a>  
<a name="l2058"><span class="linenum">2058</span></a>  
<a name="l2059"><span class="linenum">2059</span></a>      <span class="comment">/**</span>
<a name="l2060"><span class="linenum">2060</span></a>  <span class="comment">     * Set param value</span>
<a name="l2061"><span class="linenum">2061</span></a>  <span class="comment">     *</span>
<a name="l2062"><span class="linenum">2062</span></a>  <span class="comment">     * @param string parameter name</span>
<a name="l2063"><span class="linenum">2063</span></a>  <span class="comment">     * @param mixed parameter value</span>
<a name="l2064"><span class="linenum">2064</span></a>  <span class="comment">     * @param boolean true to set to NULL if empty value</span>
<a name="l2065"><span class="linenum">2065</span></a>  <span class="comment">     * @return boolean true, if a value has been set; false if it has not changed</span>
<a name="l2066"><span class="linenum">2066</span></a>  <span class="comment">     */</span>
<a name="l2067"><span class="linenum">2067</span></a>  	function <a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a>, <a class="var it1649" onMouseOver="hilite(1649)" onMouseOut="lolite()" onClick="logVariable('parvalue')" href="../../../_variables/parvalue.html">$parvalue</a>, <a class="var it1650" onMouseOver="hilite(1650)" onMouseOut="lolite()" onClick="logVariable('make_null')" href="../../../_variables/make_null.html">$make_null</a> = false )
<a name="l2068"><span class="linenum">2068</span></a>      {
<a name="l2069"><span class="linenum">2069</span></a>          if( ( ! isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a>[ <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> ] ) ) &amp;&amp; ( ( <a class="var it3952" onMouseOver="hilite(3952)" onMouseOut="lolite()" onClick="logVariable('old_value')" href="../../../_variables/old_value.html">$old_value</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> ) ) != <a class="var it1649" onMouseOver="hilite(1649)" onMouseOut="lolite()" onClick="logVariable('parvalue')" href="../../../_variables/parvalue.html">$parvalue</a> )
<a name="l2070"><span class="linenum">2070</span></a>              &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a>, array( 'login', 'grp_ID', 'nickname', 'firstname', 'lastname', 'gender', 'ctry_ID', 'rgn_ID', 'subrg_ID', 'city_ID' ) ) )
<a name="l2071"><span class="linenum">2071</span></a>          { // Save previous value of significant changes for later use in send_account_changed_notifications()
<a name="l2072"><span class="linenum">2072</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a>[ <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> ] = <a class="var it3952" onMouseOver="hilite(3952)" onMouseOut="lolite()" onClick="logVariable('old_value')" href="../../../_variables/old_value.html">$old_value</a>;
<a name="l2073"><span class="linenum">2073</span></a>          }
<a name="l2074"><span class="linenum">2074</span></a>  
<a name="l2075"><span class="linenum">2075</span></a>          switch( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> )
<a name="l2076"><span class="linenum">2076</span></a>          {
<a name="l2077"><span class="linenum">2077</span></a>              case 'level':
<a name="l2078"><span class="linenum">2078</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a>, 'number', <a class="var it1649" onMouseOver="hilite(1649)" onMouseOut="lolite()" onClick="logVariable('parvalue')" href="../../../_variables/parvalue.html">$parvalue</a>, <a class="var it1650" onMouseOver="hilite(1650)" onMouseOut="lolite()" onClick="logVariable('make_null')" href="../../../_variables/make_null.html">$make_null</a> );
<a name="l2079"><span class="linenum">2079</span></a>  
<a name="l2080"><span class="linenum">2080</span></a>              case 'ctry_ID':
<a name="l2081"><span class="linenum">2081</span></a>              default:
<a name="l2082"><span class="linenum">2082</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a>, 'string', <a class="var it1649" onMouseOver="hilite(1649)" onMouseOut="lolite()" onClick="logVariable('parvalue')" href="../../../_variables/parvalue.html">$parvalue</a>, <a class="var it1650" onMouseOver="hilite(1650)" onMouseOut="lolite()" onClick="logVariable('make_null')" href="../../../_variables/make_null.html">$make_null</a> );
<a name="l2083"><span class="linenum">2083</span></a>          }
<a name="l2084"><span class="linenum">2084</span></a>      }
<a name="l2085"><span class="linenum">2085</span></a>  
<a name="l2086"><span class="linenum">2086</span></a>  
<a name="l2087"><span class="linenum">2087</span></a>      <span class="comment">/**</span>
<a name="l2088"><span class="linenum">2088</span></a>  <span class="comment">     * Set the encoded password and a new password salt from a raw password</span>
<a name="l2089"><span class="linenum">2089</span></a>  <span class="comment">     *</span>
<a name="l2090"><span class="linenum">2090</span></a>  <span class="comment">     * @param string the raw password</span>
<a name="l2091"><span class="linenum">2091</span></a>  <span class="comment">     */</span>
<a name="l2092"><span class="linenum">2092</span></a>  	function <a class="function" onClick="logFunction('set_password')" href="../../../_functions/set_password.html" onMouseOver="funcPopup(event,'set_password')">set_password</a>( <a class="var it3953" onMouseOver="hilite(3953)" onMouseOut="lolite()" onClick="logVariable('raw_password')" href="../../../_variables/raw_password.html">$raw_password</a> )
<a name="l2093"><span class="linenum">2093</span></a>      {
<a name="l2094"><span class="linenum">2094</span></a>  <span class="comment">        // Generate new salt to save a password</span>
<a name="l2095"><span class="linenum">2095</span></a>          <a class="var it3954" onMouseOver="hilite(3954)" onMouseOut="lolite()" onClick="logVariable('new_pass_salt')" href="../../../_variables/new_pass_salt.html">$new_pass_salt</a> = <a class="function" onClick="logFunction('generate_random_key')" href="../../../_functions/generate_random_key.html" onMouseOver="funcPopup(event,'generate_random_key')">generate_random_key</a>( 8 );
<a name="l2096"><span class="linenum">2096</span></a>  
<a name="l2097"><span class="linenum">2097</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'pass', md5( <a class="var it3954" onMouseOver="hilite(3954)" onMouseOut="lolite()" onClick="logVariable('new_pass_salt')" href="../../../_variables/new_pass_salt.html">$new_pass_salt</a>.<a class="var it3953" onMouseOver="hilite(3953)" onMouseOut="lolite()" onClick="logVariable('raw_password')" href="../../../_variables/raw_password.html">$raw_password</a>, true ) );
<a name="l2098"><span class="linenum">2098</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'salt', <a class="var it3954" onMouseOver="hilite(3954)" onMouseOut="lolite()" onClick="logVariable('new_pass_salt')" href="../../../_variables/new_pass_salt.html">$new_pass_salt</a> );
<a name="l2099"><span class="linenum">2099</span></a>      }
<a name="l2100"><span class="linenum">2100</span></a>  
<a name="l2101"><span class="linenum">2101</span></a>  
<a name="l2102"><span class="linenum">2102</span></a>      <span class="comment">/**</span>
<a name="l2103"><span class="linenum">2103</span></a>  <span class="comment">     * Set date created.</span>
<a name="l2104"><span class="linenum">2104</span></a>  <span class="comment">     *</span>
<a name="l2105"><span class="linenum">2105</span></a>  <span class="comment">     * @param integer seconds since Unix Epoch.</span>
<a name="l2106"><span class="linenum">2106</span></a>  <span class="comment">     */</span>
<a name="l2107"><span class="linenum">2107</span></a>  	function <a class="function" onClick="logFunction('set_datecreated')" href="../../../_functions/set_datecreated.html" onMouseOver="funcPopup(event,'set_datecreated')">set_datecreated</a>( <a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('datecreated')" href="../../../_variables/datecreated.html">$datecreated</a>, <a class="var it3955" onMouseOver="hilite(3955)" onMouseOut="lolite()" onClick="logVariable('isYMDhour')" href="../../../_variables/isYMDhour.html">$isYMDhour</a> = false )
<a name="l2108"><span class="linenum">2108</span></a>      {
<a name="l2109"><span class="linenum">2109</span></a>          if( !<a class="var it3955" onMouseOver="hilite(3955)" onMouseOut="lolite()" onClick="logVariable('isYMDhour')" href="../../../_variables/isYMDhour.html">$isYMDhour</a> )
<a name="l2110"><span class="linenum">2110</span></a>          {
<a name="l2111"><span class="linenum">2111</span></a>              <a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('datecreated')" href="../../../_variables/datecreated.html">$datecreated</a> = <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>('Y-m-d H:i:s', <a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('datecreated')" href="../../../_variables/datecreated.html">$datecreated</a> );
<a name="l2112"><span class="linenum">2112</span></a>          }
<a name="l2113"><span class="linenum">2113</span></a>  <span class="comment">        // Set value:</span>
<a name="l2114"><span class="linenum">2114</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('datecreated')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/datecreated.html">datecreated</a> = <a class="var it1205" onMouseOver="hilite(1205)" onMouseOut="lolite()" onClick="logVariable('datecreated')" href="../../../_variables/datecreated.html">$datecreated</a>;
<a name="l2115"><span class="linenum">2115</span></a>  <span class="comment">        // Remmeber change for later db update:</span>
<a name="l2116"><span class="linenum">2116</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbchange')" href="../../../_functions/dbchange.html" onMouseOver="funcPopup(event,'dbchange')">dbchange</a>( 'user_created_datetime', 'string', 'datecreated' );
<a name="l2117"><span class="linenum">2117</span></a>      }
<a name="l2118"><span class="linenum">2118</span></a>  
<a name="l2119"><span class="linenum">2119</span></a>  
<a name="l2120"><span class="linenum">2120</span></a>      <span class="comment">/**</span>
<a name="l2121"><span class="linenum">2121</span></a>  <span class="comment">     * Set email address of the user.</span>
<a name="l2122"><span class="linenum">2122</span></a>  <span class="comment">     *</span>
<a name="l2123"><span class="linenum">2123</span></a>  <span class="comment">     * If the email address has changed and we're configured to invalidate the user in this case,</span>
<a name="l2124"><span class="linenum">2124</span></a>  <span class="comment">     * the user's account gets not active 'emaichanged' status here.</span>
<a name="l2125"><span class="linenum">2125</span></a>  <span class="comment">     *</span>
<a name="l2126"><span class="linenum">2126</span></a>  <span class="comment">     * @param string email address to set for the User</span>
<a name="l2127"><span class="linenum">2127</span></a>  <span class="comment">     * @param boolean Set TRUE if changing of account status is required</span>
<a name="l2128"><span class="linenum">2128</span></a>  <span class="comment">     * @return boolean true, if set; false if not changed</span>
<a name="l2129"><span class="linenum">2129</span></a>  <span class="comment">     */</span>
<a name="l2130"><span class="linenum">2130</span></a>  	function <a class="function" onClick="logFunction('set_email')" href="../../../_functions/set_email.html" onMouseOver="funcPopup(event,'set_email')">set_email</a>( <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('email')" href="../../../_variables/email.html">$email</a>, <a class="var it3956" onMouseOver="hilite(3956)" onMouseOut="lolite()" onClick="logVariable('change_status')" href="../../../_variables/change_status.html">$change_status</a> = true )
<a name="l2131"><span class="linenum">2131</span></a>      {
<a name="l2132"><span class="linenum">2132</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l2133"><span class="linenum">2133</span></a>  
<a name="l2134"><span class="linenum">2134</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = parent::<a class="function" onClick="logFunction('set_param')" href="../../../_functions/set_param.html" onMouseOver="funcPopup(event,'set_param')">set_param</a>( 'email', 'string', <a class="function" onClick="logFunction('utf8_strtolower')" href="../../../_functions/utf8_strtolower.html" onMouseOver="funcPopup(event,'utf8_strtolower')">utf8_strtolower</a>( <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('email')" href="../../../_variables/email.html">$email</a> ) );
<a name="l2135"><span class="linenum">2135</span></a>  
<a name="l2136"><span class="linenum">2136</span></a>          if( <a class="var it3956" onMouseOver="hilite(3956)" onMouseOut="lolite()" onClick="logVariable('change_status')" href="../../../_variables/change_status.html">$change_status</a> )
<a name="l2137"><span class="linenum">2137</span></a>          { // Change user status to 'emailchanged' (if email has changed and Settings are available, which they are not during install):
<a name="l2138"><span class="linenum">2138</span></a>              if( <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> &amp;&amp; ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != 0 ) &amp;&amp; isset(<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>) &amp;&amp; <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('newusers_revalidate_emailchg') &amp;&amp; ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_validated' ) ) )
<a name="l2139"><span class="linenum">2139</span></a>              { // Deactivate the account, because the changed email has not been verified yet, but the user account is active:
<a name="l2140"><span class="linenum">2140</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', 'emailchanged' );
<a name="l2141"><span class="linenum">2141</span></a>              }
<a name="l2142"><span class="linenum">2142</span></a>          }
<a name="l2143"><span class="linenum">2143</span></a>  
<a name="l2144"><span class="linenum">2144</span></a>          if( <a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '#@(.+)#i', <a class="var it182" onMouseOver="hilite(182)" onMouseOut="lolite()" onClick="logVariable('email')" href="../../../_variables/email.html">$email</a>, <a class="var it3957" onMouseOver="hilite(3957)" onMouseOut="lolite()" onClick="logVariable('ematch')" href="../../../_variables/ematch.html">$ematch</a> ) )
<a name="l2145"><span class="linenum">2145</span></a>          {    // Set email domain ID
<a name="l2146"><span class="linenum">2146</span></a>              global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l2147"><span class="linenum">2147</span></a>  
<a name="l2148"><span class="linenum">2148</span></a>              <a class="var it3958" onMouseOver="hilite(3958)" onMouseOut="lolite()" onClick="logVariable('email_domain')" href="../../../_variables/email_domain.html">$email_domain</a> = <a class="var it3957" onMouseOver="hilite(3957)" onMouseOut="lolite()" onClick="logVariable('ematch')" href="../../../_variables/ematch.html">$ematch</a>[1];
<a name="l2149"><span class="linenum">2149</span></a>  
<a name="l2150"><span class="linenum">2150</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l2151"><span class="linenum">2151</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'dom_ID' );
<a name="l2152"><span class="linenum">2152</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_basedomains' );
<a name="l2153"><span class="linenum">2153</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'dom_type = \'email\'' );
<a name="l2154"><span class="linenum">2154</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'dom_name = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3958" onMouseOver="hilite(3958)" onMouseOut="lolite()" onClick="logVariable('email_domain')" href="../../../_variables/email_domain.html">$email_domain</a> ) );
<a name="l2155"><span class="linenum">2155</span></a>  
<a name="l2156"><span class="linenum">2156</span></a>              <a class="var it3535" onMouseOver="hilite(3535)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../../_variables/dom_ID.html">$dom_ID</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l2157"><span class="linenum">2157</span></a>              if( !<a class="var it3535" onMouseOver="hilite(3535)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../../_variables/dom_ID.html">$dom_ID</a> )
<a name="l2158"><span class="linenum">2158</span></a>              {    // The email domains doesn't exist yet, Insert new record
<a name="l2159"><span class="linenum">2159</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'INSERT INTO T_basedomains ( dom_type, dom_name )
<a name="l2160"><span class="linenum">2160</span></a>                      VALUES ( \'email\', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3958" onMouseOver="hilite(3958)" onMouseOut="lolite()" onClick="logVariable('email_domain')" href="../../../_variables/email_domain.html">$email_domain</a> ).' )' );
<a name="l2161"><span class="linenum">2161</span></a>                  <a class="var it3535" onMouseOver="hilite(3535)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../../_variables/dom_ID.html">$dom_ID</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('insert_id')" class="var it10754" onMouseOver="hilite(10754)" onMouseOut="lolite()" href="../../../_variables/insert_id.html">insert_id</a>;
<a name="l2162"><span class="linenum">2162</span></a>              }
<a name="l2163"><span class="linenum">2163</span></a>  
<a name="l2164"><span class="linenum">2164</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'email_dom_ID', (int) <a class="var it3535" onMouseOver="hilite(3535)" onMouseOut="lolite()" onClick="logVariable('dom_ID')" href="../../../_variables/dom_ID.html">$dom_ID</a> );
<a name="l2165"><span class="linenum">2165</span></a>          }
<a name="l2166"><span class="linenum">2166</span></a>  
<a name="l2167"><span class="linenum">2167</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l2168"><span class="linenum">2168</span></a>      }
<a name="l2169"><span class="linenum">2169</span></a>  
<a name="l2170"><span class="linenum">2170</span></a>  
<a name="l2171"><span class="linenum">2171</span></a>      <span class="comment">/**</span>
<a name="l2172"><span class="linenum">2172</span></a>  <span class="comment">     * Set new Group.</span>
<a name="l2173"><span class="linenum">2173</span></a>  <span class="comment">     *</span>
<a name="l2174"><span class="linenum">2174</span></a>  <span class="comment">     * @param Group the Group object to put the user into</span>
<a name="l2175"><span class="linenum">2175</span></a>  <span class="comment">     * @return boolean true if set, false if not changed</span>
<a name="l2176"><span class="linenum">2176</span></a>  <span class="comment">     */</span>
<a name="l2177"><span class="linenum">2177</span></a>  	function <a class="function" onClick="logFunction('set_Group')" href="../../../_functions/set_group.html" onMouseOver="funcPopup(event,'set_group')">set_Group</a>( &amp; <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a> )
<a name="l2178"><span class="linenum">2178</span></a>      {
<a name="l2179"><span class="linenum">2179</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/grp_ID.html">grp_ID</a> !== <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a>-&gt;<a onClick="logVariable('ID')" class="var it10802" onMouseOver="hilite(10802)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l2180"><span class="linenum">2180</span></a>          {
<a name="l2181"><span class="linenum">2181</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a> = &amp; <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a>;
<a name="l2182"><span class="linenum">2182</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'grp_ID', <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a>-&gt;<a onClick="logVariable('ID')" class="var it10802" onMouseOver="hilite(10802)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l2183"><span class="linenum">2183</span></a>              return true;
<a name="l2184"><span class="linenum">2184</span></a>          }
<a name="l2185"><span class="linenum">2185</span></a>  
<a name="l2186"><span class="linenum">2186</span></a>          return false;
<a name="l2187"><span class="linenum">2187</span></a>      }
<a name="l2188"><span class="linenum">2188</span></a>  
<a name="l2189"><span class="linenum">2189</span></a>      <span class="comment">/**</span>
<a name="l2190"><span class="linenum">2190</span></a>  <span class="comment">     * @deprecated by {@link User::set_Group()} since 1.9</span>
<a name="l2191"><span class="linenum">2191</span></a>  <span class="comment">     */</span>
<a name="l2192"><span class="linenum">2192</span></a>  	function <a class="function" onClick="logFunction('setGroup')" href="../../../_functions/setgroup.html" onMouseOver="funcPopup(event,'setgroup')">setGroup</a>( &amp; <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a> )
<a name="l2193"><span class="linenum">2193</span></a>      {
<a name="l2194"><span class="linenum">2194</span></a>          global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l2195"><span class="linenum">2195</span></a>          <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Call to deprecated method <a class="class" onClick="logClass('User')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">User</a>::<a class="function" onClick="logFunction('setGroup')" href="../../../_functions/setgroup.html" onMouseOver="funcPopup(event,'setgroup')">setGroup</a>(), use <a class="function" onClick="logFunction('set_Group')" href="../../../_functions/set_group.html" onMouseOver="funcPopup(event,'set_group')">set_Group</a>() instead.', 'deprecated' );
<a name="l2196"><span class="linenum">2196</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_Group')" href="../../../_functions/set_group.html" onMouseOver="funcPopup(event,'set_group')">set_Group</a>( <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a> );
<a name="l2197"><span class="linenum">2197</span></a>      }
<a name="l2198"><span class="linenum">2198</span></a>  
<a name="l2199"><span class="linenum">2199</span></a>  
<a name="l2200"><span class="linenum">2200</span></a>      <span class="comment">/**</span>
<a name="l2201"><span class="linenum">2201</span></a>  <span class="comment">     * Get the {@link Group} of the user.</span>
<a name="l2202"><span class="linenum">2202</span></a>  <span class="comment">     *</span>
<a name="l2203"><span class="linenum">2203</span></a>  <span class="comment">     * @return Group (by reference)</span>
<a name="l2204"><span class="linenum">2204</span></a>  <span class="comment">     */</span>
<a name="l2205"><span class="linenum">2205</span></a>      function &amp; get_Group()
<a name="l2206"><span class="linenum">2206</span></a>      {
<a name="l2207"><span class="linenum">2207</span></a>          if( ! isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>) )
<a name="l2208"><span class="linenum">2208</span></a>          {
<a name="l2209"><span class="linenum">2209</span></a>              <a class="var it422" onMouseOver="hilite(422)" onMouseOut="lolite()" onClick="logVariable('GroupCache')" href="../../../_variables/GroupCache.html">$GroupCache</a> = &amp; get_GroupCache();
<a name="l2210"><span class="linenum">2210</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a> = &amp; <a class="var it422" onMouseOver="hilite(422)" onMouseOut="lolite()" onClick="logVariable('GroupCache')" href="../../../_variables/GroupCache.html">$GroupCache</a>-&gt;get_by_ID(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/grp_ID.html">grp_ID</a>);
<a name="l2211"><span class="linenum">2211</span></a>          }
<a name="l2212"><span class="linenum">2212</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>;
<a name="l2213"><span class="linenum">2213</span></a>      }
<a name="l2214"><span class="linenum">2214</span></a>  
<a name="l2215"><span class="linenum">2215</span></a>  
<a name="l2216"><span class="linenum">2216</span></a>    <span class="comment">/**</span>
<a name="l2217"><span class="linenum">2217</span></a>  <span class="comment">     * Check password</span>
<a name="l2218"><span class="linenum">2218</span></a>  <span class="comment">     *</span>
<a name="l2219"><span class="linenum">2219</span></a>  <span class="comment">     * @param string password</span>
<a name="l2220"><span class="linenum">2220</span></a>  <span class="comment">     * @param boolean Is the password parameter already MD5()'ed?</span>
<a name="l2221"><span class="linenum">2221</span></a>  <span class="comment">     * @return boolean</span>
<a name="l2222"><span class="linenum">2222</span></a>  <span class="comment">     */</span>
<a name="l2223"><span class="linenum">2223</span></a>  	function <a class="function" onClick="logFunction('check_password')" href="../../../_functions/check_password.html" onMouseOver="funcPopup(event,'check_password')">check_password</a>( <a class="var it3208" onMouseOver="hilite(3208)" onMouseOut="lolite()" onClick="logVariable('pass')" href="../../../_variables/pass.html">$pass</a>, <a class="var it3209" onMouseOver="hilite(3209)" onMouseOut="lolite()" onClick="logVariable('pass_is_md5')" href="../../../_variables/pass_is_md5.html">$pass_is_md5</a> = false )
<a name="l2224"><span class="linenum">2224</span></a>      {
<a name="l2225"><span class="linenum">2225</span></a>          if( !<a class="var it3209" onMouseOver="hilite(3209)" onMouseOut="lolite()" onClick="logVariable('pass_is_md5')" href="../../../_variables/pass_is_md5.html">$pass_is_md5</a> )
<a name="l2226"><span class="linenum">2226</span></a>          {
<a name="l2227"><span class="linenum">2227</span></a>              <a class="var it3208" onMouseOver="hilite(3208)" onMouseOut="lolite()" onClick="logVariable('pass')" href="../../../_variables/pass.html">$pass</a> = md5( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('salt')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/salt.html">salt</a>.<a class="var it3208" onMouseOver="hilite(3208)" onMouseOut="lolite()" onClick="logVariable('pass')" href="../../../_variables/pass.html">$pass</a>, true );
<a name="l2228"><span class="linenum">2228</span></a>          }
<a name="l2229"><span class="linenum">2229</span></a>  
<a name="l2230"><span class="linenum">2230</span></a>          return ( <a class="var it3208" onMouseOver="hilite(3208)" onMouseOut="lolite()" onClick="logVariable('pass')" href="../../../_variables/pass.html">$pass</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('pass')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/pass.html">pass</a> );
<a name="l2231"><span class="linenum">2231</span></a>      }
<a name="l2232"><span class="linenum">2232</span></a>  
<a name="l2233"><span class="linenum">2233</span></a>  
<a name="l2234"><span class="linenum">2234</span></a>      <span class="comment">/**</span>
<a name="l2235"><span class="linenum">2235</span></a>  <span class="comment">     * Check permission for this user</span>
<a name="l2236"><span class="linenum">2236</span></a>  <span class="comment">     *</span>
<a name="l2237"><span class="linenum">2237</span></a>  <span class="comment">     * @param string Permission name, can be one of:</span>
<a name="l2238"><span class="linenum">2238</span></a>  <span class="comment">     *                - 'edit_timestamp'</span>
<a name="l2239"><span class="linenum">2239</span></a>  <span class="comment">     *                - 'cats_post_statuses', see {@link User::check_perm_catsusers()}</span>
<a name="l2240"><span class="linenum">2240</span></a>  <span class="comment">     *                - either group permission names, see {@link Group::check_perm()}</span>
<a name="l2241"><span class="linenum">2241</span></a>  <span class="comment">     *                - either blogusers permission names, see {@link User::check_perm_blogusers()}</span>
<a name="l2242"><span class="linenum">2242</span></a>  <span class="comment">     * @param string Permission level</span>
<a name="l2243"><span class="linenum">2243</span></a>  <span class="comment">     * @param boolean Execution will halt if this is !0 and permission is denied</span>
<a name="l2244"><span class="linenum">2244</span></a>  <span class="comment">     * @param mixed Permission target (blog ID, array of cat IDs, Item, Comment...)</span>
<a name="l2245"><span class="linenum">2245</span></a>  <span class="comment">     * @return boolean 0 if permission denied</span>
<a name="l2246"><span class="linenum">2246</span></a>  <span class="comment">     */</span>
<a name="l2247"><span class="linenum">2247</span></a>  	function <a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> = 'any', <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('assert')" href="../../../_variables/assert.html">$assert</a> = false, <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> = NULL )
<a name="l2248"><span class="linenum">2248</span></a>      {
<a name="l2249"><span class="linenum">2249</span></a>          global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l2250"><span class="linenum">2250</span></a>  
<a name="l2251"><span class="linenum">2251</span></a>          if( <a class="phpfunction" onClick="logFunction('is_object')" href="../../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>) &amp;&amp; isset(<a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>-&gt;<a onClick="logVariable('ID')" class="var it10935" onMouseOver="hilite(10935)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>) )
<a name="l2252"><span class="linenum">2252</span></a>          {
<a name="l2253"><span class="linenum">2253</span></a>              <a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a> = <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>-&gt;<a onClick="logVariable('ID')" class="var it10935" onMouseOver="hilite(10935)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l2254"><span class="linenum">2254</span></a>          }
<a name="l2255"><span class="linenum">2255</span></a>          elseif( !<a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>) )
<a name="l2256"><span class="linenum">2256</span></a>          {
<a name="l2257"><span class="linenum">2257</span></a>              <a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a> = <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2258"><span class="linenum">2258</span></a>          }
<a name="l2259"><span class="linenum">2259</span></a>  
<a name="l2260"><span class="linenum">2260</span></a>          if( isset(<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>)    // if it makes sense to check the cache
<a name="l2261"><span class="linenum">2261</span></a>              &amp;&amp; isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_perms')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/cache_perms.html">cache_perms</a>[<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>][<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>][<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>]) )
<a name="l2262"><span class="linenum">2262</span></a>          { // Permission in available in Cache:
<a name="l2263"><span class="linenum">2263</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( &quot;Got perm [<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>][<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>][<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>] from cache&quot;, 'perms' );
<a name="l2264"><span class="linenum">2264</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_perms')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/cache_perms.html">cache_perms</a>[<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>][<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>][<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>];
<a name="l2265"><span class="linenum">2265</span></a>          }
<a name="l2266"><span class="linenum">2266</span></a>  
<a name="l2267"><span class="linenum">2267</span></a>          <a class="var it3960" onMouseOver="hilite(3960)" onMouseOut="lolite()" onClick="logVariable('pluggable_perms')" href="../../../_variables/pluggable_perms.html">$pluggable_perms</a> = array( 'admin', 'spamblacklist', 'slugs', 'templates', 'options', 'files', 'users' );
<a name="l2268"><span class="linenum">2268</span></a>          if( <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it3960" onMouseOver="hilite(3960)" onMouseOut="lolite()" onClick="logVariable('pluggable_perms')" href="../../../_variables/pluggable_perms.html">$pluggable_perms</a> ) )
<a name="l2269"><span class="linenum">2269</span></a>          {
<a name="l2270"><span class="linenum">2270</span></a>              <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a> = 'perm_'.<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>;
<a name="l2271"><span class="linenum">2271</span></a>          }
<a name="l2272"><span class="linenum">2272</span></a>  <span class="comment">        //$Debuglog-&gt;add( &quot;Querying perm [$permname][$permlevel]&quot;.( isset( $perm_target_ID ) ? '['.$perm_target_ID.']' : '' ).']', 'perms' );</span>
<a name="l2273"><span class="linenum">2273</span></a>  <span class="comment">        //pre_dump( 'Perm target: '.var_export( $perm_target, true ) );</span>
<a name="l2274"><span class="linenum">2274</span></a>  
<a name="l2275"><span class="linenum">2275</span></a>          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = false;
<a name="l2276"><span class="linenum">2276</span></a>  
<a name="l2277"><span class="linenum">2277</span></a>          switch( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a> )
<a name="l2278"><span class="linenum">2278</span></a>          { // What permission do we want to check?
<a name="l2279"><span class="linenum">2279</span></a>              case 'cats_post_statuses':
<a name="l2280"><span class="linenum">2280</span></a>              case 'cats_post!published':
<a name="l2281"><span class="linenum">2281</span></a>              case 'cats_post!community':
<a name="l2282"><span class="linenum">2282</span></a>              case 'cats_post!protected':
<a name="l2283"><span class="linenum">2283</span></a>              case 'cats_post!private':
<a name="l2284"><span class="linenum">2284</span></a>              case 'cats_post!review':
<a name="l2285"><span class="linenum">2285</span></a>              case 'cats_post!draft':
<a name="l2286"><span class="linenum">2286</span></a>              case 'cats_post!deprecated':
<a name="l2287"><span class="linenum">2287</span></a>              case 'cats_post!redirected':
<a name="l2288"><span class="linenum">2288</span></a>              case 'cats_item_type_standard':
<a name="l2289"><span class="linenum">2289</span></a>              case 'cats_item_type_restricted':
<a name="l2290"><span class="linenum">2290</span></a>              case 'cats_item_type_admin':
<a name="l2291"><span class="linenum">2291</span></a>  <span class="comment">                // Category permissions...</span>
<a name="l2292"><span class="linenum">2292</span></a>                  if( ! <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>( <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> ) )
<a name="l2293"><span class="linenum">2293</span></a>                  {    // We need an array here:
<a name="l2294"><span class="linenum">2294</span></a>                      <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> = array( <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> );
<a name="l2295"><span class="linenum">2295</span></a>                  }
<a name="l2296"><span class="linenum">2296</span></a>  
<a name="l2297"><span class="linenum">2297</span></a>  <span class="comment">                // First we need to create an array of blogs, not cats</span>
<a name="l2298"><span class="linenum">2298</span></a>                  <a class="var it3961" onMouseOver="hilite(3961)" onMouseOut="lolite()" onClick="logVariable('perm_target_blogs')" href="../../../_variables/perm_target_blogs.html">$perm_target_blogs</a> = array();
<a name="l2299"><span class="linenum">2299</span></a>                  foreach( <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> as <a class="var it3962" onMouseOver="hilite(3962)" onMouseOut="lolite()" onClick="logVariable('loop_cat_ID')" href="../../../_variables/loop_cat_ID.html">$loop_cat_ID</a> )
<a name="l2300"><span class="linenum">2300</span></a>                  {
<a name="l2301"><span class="linenum">2301</span></a>                      <a class="var it3963" onMouseOver="hilite(3963)" onMouseOut="lolite()" onClick="logVariable('loop_cat_blog_ID')" href="../../../_variables/loop_cat_blog_ID.html">$loop_cat_blog_ID</a> = <a class="function" onClick="logFunction('get_catblog')" href="../../../_functions/get_catblog.html" onMouseOver="funcPopup(event,'get_catblog')">get_catblog</a>( <a class="var it3962" onMouseOver="hilite(3962)" onMouseOut="lolite()" onClick="logVariable('loop_cat_ID')" href="../../../_variables/loop_cat_ID.html">$loop_cat_ID</a> );
<a name="l2302"><span class="linenum">2302</span></a>  <span class="comment">                    // echo &quot;cat $loop_cat_ID -&gt; blog $loop_cat_blog_ID &lt;br /&gt;&quot;;</span>
<a name="l2303"><span class="linenum">2303</span></a>                      if( ! <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it3963" onMouseOver="hilite(3963)" onMouseOut="lolite()" onClick="logVariable('loop_cat_blog_ID')" href="../../../_variables/loop_cat_blog_ID.html">$loop_cat_blog_ID</a>, <a class="var it3961" onMouseOver="hilite(3961)" onMouseOut="lolite()" onClick="logVariable('perm_target_blogs')" href="../../../_variables/perm_target_blogs.html">$perm_target_blogs</a> ) )
<a name="l2304"><span class="linenum">2304</span></a>                      { // not already in list: add it:
<a name="l2305"><span class="linenum">2305</span></a>                          <a class="var it3961" onMouseOver="hilite(3961)" onMouseOut="lolite()" onClick="logVariable('perm_target_blogs')" href="../../../_variables/perm_target_blogs.html">$perm_target_blogs</a>[] = <a class="var it3963" onMouseOver="hilite(3963)" onMouseOut="lolite()" onClick="logVariable('loop_cat_blog_ID')" href="../../../_variables/loop_cat_blog_ID.html">$loop_cat_blog_ID</a>;
<a name="l2306"><span class="linenum">2306</span></a>                      }
<a name="l2307"><span class="linenum">2307</span></a>                  }
<a name="l2308"><span class="linenum">2308</span></a>  
<a name="l2309"><span class="linenum">2309</span></a>                  <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true; <span class="comment">// Permission granted if no blog denies it below</span>
<a name="l2310"><span class="linenum">2310</span></a>                  <a class="var it3964" onMouseOver="hilite(3964)" onMouseOut="lolite()" onClick="logVariable('blogperm')" href="../../../_variables/blogperm.html">$blogperm</a> = 'blog_'.<a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, 5 );
<a name="l2311"><span class="linenum">2311</span></a>  <span class="comment">                // Now we'll check permissions for each blog:</span>
<a name="l2312"><span class="linenum">2312</span></a>                  foreach( <a class="var it3961" onMouseOver="hilite(3961)" onMouseOut="lolite()" onClick="logVariable('perm_target_blogs')" href="../../../_variables/perm_target_blogs.html">$perm_target_blogs</a> as <a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a> )
<a name="l2313"><span class="linenum">2313</span></a>                  {
<a name="l2314"><span class="linenum">2314</span></a>                      if( ! <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( <a class="var it3964" onMouseOver="hilite(3964)" onMouseOut="lolite()" onClick="logVariable('blogperm')" href="../../../_variables/blogperm.html">$blogperm</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, false, <a class="var it3928" onMouseOver="hilite(3928)" onMouseOut="lolite()" onClick="logVariable('loop_blog_ID')" href="../../../_variables/loop_blog_ID.html">$loop_blog_ID</a> ) )
<a name="l2315"><span class="linenum">2315</span></a>                      { // If at least one blog denies the permission:
<a name="l2316"><span class="linenum">2316</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = false;
<a name="l2317"><span class="linenum">2317</span></a>                          break;
<a name="l2318"><span class="linenum">2318</span></a>                      }
<a name="l2319"><span class="linenum">2319</span></a>                  }
<a name="l2320"><span class="linenum">2320</span></a>                  break;
<a name="l2321"><span class="linenum">2321</span></a>  
<a name="l2322"><span class="linenum">2322</span></a>              case 'recycle_owncmts':
<a name="l2323"><span class="linenum">2323</span></a>  <span class="comment">                // Check permission to edit comments for own items</span>
<a name="l2324"><span class="linenum">2324</span></a>                  <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2325"><span class="linenum">2325</span></a>                  <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> = &amp; <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a class="function" onClick="logFunction('get_Item')" href="../../../_functions/get_item.html" onMouseOver="funcPopup(event,'get_item')">get_Item</a>();
<a name="l2326"><span class="linenum">2326</span></a>                  <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> = <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('get_blog_ID')" href="../../../_functions/get_blog_id.html" onMouseOver="funcPopup(event,'get_blog_id')">get_blog_ID</a>();
<a name="l2327"><span class="linenum">2327</span></a>                  if( <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a onClick="logVariable('creator_user_ID')" class="var it10688" onMouseOver="hilite(10688)" onMouseOut="lolite()" href="../../../_variables/creator_user_ID.html">creator_user_ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l2328"><span class="linenum">2328</span></a>                  { // Current user is owner of this item
<a name="l2329"><span class="linenum">2329</span></a>                      if( <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>() &amp;&amp; !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_cats', 'edit', false, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> ) )
<a name="l2330"><span class="linenum">2330</span></a>                      { // Comment item is locked and current user is not allowed to edit locked items comment
<a name="l2331"><span class="linenum">2331</span></a>                          break;
<a name="l2332"><span class="linenum">2332</span></a>                      }
<a name="l2333"><span class="linenum">2333</span></a>  
<a name="l2334"><span class="linenum">2334</span></a>                      <a class="var it3965" onMouseOver="hilite(3965)" onMouseOut="lolite()" onClick="logVariable('comment_author_User')" href="../../../_variables/comment_author_User.html">$comment_author_User</a> = &amp; <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;get_author_User();
<a name="l2335"><span class="linenum">2335</span></a>                      if( ( empty( <a class="var it3965" onMouseOver="hilite(3965)" onMouseOut="lolite()" onClick="logVariable('comment_author_User')" href="../../../_variables/comment_author_User.html">$comment_author_User</a> ) || ( <a class="var it3965" onMouseOver="hilite(3965)" onMouseOut="lolite()" onClick="logVariable('comment_author_User')" href="../../../_variables/comment_author_User.html">$comment_author_User</a>-&gt;<a onClick="logVariable('level')" class="var it10940" onMouseOver="hilite(10940)" onMouseOut="lolite()" href="../../../_variables/level.html">level</a> &lt;= <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('level')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/level.html">level</a> ) )
<a name="l2336"><span class="linenum">2336</span></a>                          &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a onClick="logVariable('status')" class="var it10680" onMouseOver="hilite(10680)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a>, array( 'published', 'community', 'protected' ) ) )
<a name="l2337"><span class="linenum">2337</span></a>                      { // Comment author is anonymous or his level is lower than current User level, and the Comment was published with some of the above statuses
<a name="l2338"><span class="linenum">2338</span></a>  <span class="comment">                        // Check blog user perms to see if user may recycle his own posts comments</span>
<a name="l2339"><span class="linenum">2339</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( 'blog_recycle_owncmts', <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2340"><span class="linenum">2340</span></a>                          if( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> )
<a name="l2341"><span class="linenum">2341</span></a>                          { // Check groups for permissions to this specific blog:
<a name="l2342"><span class="linenum">2342</span></a>                              <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm_bloggroups')" href="../../../_functions/check_perm_bloggroups.html" onMouseOver="funcPopup(event,'check_perm_bloggroups')">check_perm_bloggroups</a>( 'blog_recycle_owncmts', <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2343"><span class="linenum">2343</span></a>                          }
<a name="l2344"><span class="linenum">2344</span></a>                      }
<a name="l2345"><span class="linenum">2345</span></a>                  }
<a name="l2346"><span class="linenum">2346</span></a>                  break;
<a name="l2347"><span class="linenum">2347</span></a>  
<a name="l2348"><span class="linenum">2348</span></a>              case 'blog_ismember':
<a name="l2349"><span class="linenum">2349</span></a>              case 'blog_can_be_assignee':
<a name="l2350"><span class="linenum">2350</span></a>              case 'blog_post_statuses':
<a name="l2351"><span class="linenum">2351</span></a>              case 'blog_post!published':
<a name="l2352"><span class="linenum">2352</span></a>              case 'blog_post!community':
<a name="l2353"><span class="linenum">2353</span></a>              case 'blog_post!protected':
<a name="l2354"><span class="linenum">2354</span></a>              case 'blog_post!private':
<a name="l2355"><span class="linenum">2355</span></a>              case 'blog_post!review':
<a name="l2356"><span class="linenum">2356</span></a>              case 'blog_post!draft':
<a name="l2357"><span class="linenum">2357</span></a>              case 'blog_post!deprecated':
<a name="l2358"><span class="linenum">2358</span></a>              case 'blog_post!redirected':
<a name="l2359"><span class="linenum">2359</span></a>              case 'blog_del_post':
<a name="l2360"><span class="linenum">2360</span></a>              case 'blog_edit':
<a name="l2361"><span class="linenum">2361</span></a>              case 'blog_edit_cmt':
<a name="l2362"><span class="linenum">2362</span></a>              case 'blog_comments':
<a name="l2363"><span class="linenum">2363</span></a>              case 'blog_comment_statuses':
<a name="l2364"><span class="linenum">2364</span></a>              case 'blog_del_cmts':
<a name="l2365"><span class="linenum">2365</span></a>              case 'blog_vote_spam_comments':
<a name="l2366"><span class="linenum">2366</span></a>              case 'blog_comment!published':
<a name="l2367"><span class="linenum">2367</span></a>              case 'blog_comment!community':
<a name="l2368"><span class="linenum">2368</span></a>              case 'blog_comment!protected':
<a name="l2369"><span class="linenum">2369</span></a>              case 'blog_comment!private':
<a name="l2370"><span class="linenum">2370</span></a>              case 'blog_comment!deprecated':
<a name="l2371"><span class="linenum">2371</span></a>              case 'blog_comment!review':
<a name="l2372"><span class="linenum">2372</span></a>              case 'blog_comment!draft':
<a name="l2373"><span class="linenum">2373</span></a>              case 'blog_properties':
<a name="l2374"><span class="linenum">2374</span></a>              case 'blog_cats':
<a name="l2375"><span class="linenum">2375</span></a>              case 'blog_item_type_standard':
<a name="l2376"><span class="linenum">2376</span></a>              case 'blog_item_type_restricted':
<a name="l2377"><span class="linenum">2377</span></a>              case 'blog_item_type_admin':
<a name="l2378"><span class="linenum">2378</span></a>              case 'blog_edit_ts':
<a name="l2379"><span class="linenum">2379</span></a>  <span class="comment">                // Blog permission to edit its properties...</span>
<a name="l2380"><span class="linenum">2380</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogowner')" href="../../../_functions/check_perm_blogowner.html" onMouseOver="funcPopup(event,'check_perm_blogowner')">check_perm_blogowner</a>( <a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a> ) )
<a name="l2381"><span class="linenum">2381</span></a>                  {    // Owner can do *almost* anything:
<a name="l2382"><span class="linenum">2382</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2383"><span class="linenum">2383</span></a>                      break;
<a name="l2384"><span class="linenum">2384</span></a>                  }
<a name="l2385"><span class="linenum">2385</span></a>  <span class="comment">                /* continue */</span>
<a name="l2386"><span class="linenum">2386</span></a>              case 'blog_admin': // This is what the owner does not have access to!
<a name="l2387"><span class="linenum">2387</span></a>  
<a name="l2388"><span class="linenum">2388</span></a>  <span class="comment">                // Group may grant VIEW access, FULL access:</span>
<a name="l2389"><span class="linenum">2389</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group();
<a name="l2390"><span class="linenum">2390</span></a>                  <a class="var it3966" onMouseOver="hilite(3966)" onMouseOut="lolite()" onClick="logVariable('group_permlevel')" href="../../../_variables/group_permlevel.html">$group_permlevel</a> = ( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'view' ||  <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'any' ) ? <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> : 'editall';
<a name="l2391"><span class="linenum">2391</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blogs', <a class="var it3966" onMouseOver="hilite(3966)" onMouseOut="lolite()" onClick="logVariable('group_permlevel')" href="../../../_variables/group_permlevel.html">$group_permlevel</a> ) )
<a name="l2392"><span class="linenum">2392</span></a>                  { // If group grants a global permission:
<a name="l2393"><span class="linenum">2393</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2394"><span class="linenum">2394</span></a>                      break;
<a name="l2395"><span class="linenum">2395</span></a>                  }
<a name="l2396"><span class="linenum">2396</span></a>  
<a name="l2397"><span class="linenum">2397</span></a>                  if( <a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a> &gt; 0 )
<a name="l2398"><span class="linenum">2398</span></a>                  { // Check user perm for this blog:
<a name="l2399"><span class="linenum">2399</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a> );
<a name="l2400"><span class="linenum">2400</span></a>                      if( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> )
<a name="l2401"><span class="linenum">2401</span></a>                      { // Check groups for permissions to this specific blog:
<a name="l2402"><span class="linenum">2402</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm_bloggroups')" href="../../../_functions/check_perm_bloggroups.html" onMouseOver="funcPopup(event,'check_perm_bloggroups')">check_perm_bloggroups</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a> );
<a name="l2403"><span class="linenum">2403</span></a>                      }
<a name="l2404"><span class="linenum">2404</span></a>                  }
<a name="l2405"><span class="linenum">2405</span></a>  
<a name="l2406"><span class="linenum">2406</span></a>                  break;
<a name="l2407"><span class="linenum">2407</span></a>  
<a name="l2408"><span class="linenum">2408</span></a>              case 'comment!CURSTATUS':
<a name="l2409"><span class="linenum">2409</span></a>                  <span class="comment">/**</span>
<a name="l2410"><span class="linenum">2410</span></a>  <span class="comment">                 * @var Comment</span>
<a name="l2411"><span class="linenum">2411</span></a>  <span class="comment">                 */</span>
<a name="l2412"><span class="linenum">2412</span></a>                  <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2413"><span class="linenum">2413</span></a>  <span class="comment">                // Change the permname to one of the following:</span>
<a name="l2414"><span class="linenum">2414</span></a>                  <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a> = 'comment!'.<a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a onClick="logVariable('status')" class="var it10680" onMouseOver="hilite(10680)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a>;
<a name="l2415"><span class="linenum">2415</span></a>              case 'comment!published':
<a name="l2416"><span class="linenum">2416</span></a>              case 'comment!community':
<a name="l2417"><span class="linenum">2417</span></a>              case 'comment!protected':
<a name="l2418"><span class="linenum">2418</span></a>              case 'comment!private':
<a name="l2419"><span class="linenum">2419</span></a>              case 'comment!review':
<a name="l2420"><span class="linenum">2420</span></a>              case 'comment!draft':
<a name="l2421"><span class="linenum">2421</span></a>              case 'comment!deprecated':
<a name="l2422"><span class="linenum">2422</span></a>              case 'comment!trash':
<a name="l2423"><span class="linenum">2423</span></a>                  <span class="comment">/**</span>
<a name="l2424"><span class="linenum">2424</span></a>  <span class="comment">                 * @var Comment</span>
<a name="l2425"><span class="linenum">2425</span></a>  <span class="comment">                 */</span>
<a name="l2426"><span class="linenum">2426</span></a>                  <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2427"><span class="linenum">2427</span></a>                  <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> = &amp; <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a class="function" onClick="logFunction('get_Item')" href="../../../_functions/get_item.html" onMouseOver="funcPopup(event,'get_item')">get_Item</a>();
<a name="l2428"><span class="linenum">2428</span></a>                  <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> = <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('get_blog_ID')" href="../../../_functions/get_blog_id.html" onMouseOver="funcPopup(event,'get_blog_id')">get_blog_ID</a>();
<a name="l2429"><span class="linenum">2429</span></a>                  <a class="var it3967" onMouseOver="hilite(3967)" onMouseOut="lolite()" onClick="logVariable('check_status')" href="../../../_variables/check_status.html">$check_status</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, 8 );
<a name="l2430"><span class="linenum">2430</span></a>  
<a name="l2431"><span class="linenum">2431</span></a>                  if( <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a class="function" onClick="logFunction('is_meta')" href="../../../_functions/is_meta.html" onMouseOver="funcPopup(event,'is_meta')">is_meta</a>() &amp;&amp; <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, array( 'edit', 'moderate', 'delete' ) ) )
<a name="l2432"><span class="linenum">2432</span></a>                  { // Check the permissions for meta comment with special function
<a name="l2433"><span class="linenum">2433</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'meta_comment', <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, false, <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> );
<a name="l2434"><span class="linenum">2434</span></a>                      break;
<a name="l2435"><span class="linenum">2435</span></a>                  }
<a name="l2436"><span class="linenum">2436</span></a>  
<a name="l2437"><span class="linenum">2437</span></a>                  if( ( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> != 'view' ) &amp;&amp;  <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>() &amp;&amp; !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_cats', 'edit', false, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> ) )
<a name="l2438"><span class="linenum">2438</span></a>                  { // Comment item is locked and current user is not allowed to edit/moderate locked items comment
<a name="l2439"><span class="linenum">2439</span></a>                      break;
<a name="l2440"><span class="linenum">2440</span></a>                  }
<a name="l2441"><span class="linenum">2441</span></a>  
<a name="l2442"><span class="linenum">2442</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blog_global')" href="../../../_functions/check_perm_blog_global.html" onMouseOver="funcPopup(event,'check_perm_blog_global')">check_perm_blog_global</a>( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> ) )
<a name="l2443"><span class="linenum">2443</span></a>                  { // User has global permission on this blog:
<a name="l2444"><span class="linenum">2444</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2445"><span class="linenum">2445</span></a>                      break;
<a name="l2446"><span class="linenum">2446</span></a>                  }
<a name="l2447"><span class="linenum">2447</span></a>  
<a name="l2448"><span class="linenum">2448</span></a>                  if( <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a onClick="logVariable('status')" class="var it10680" onMouseOver="hilite(10680)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'trash' )
<a name="l2449"><span class="linenum">2449</span></a>                  { // only global group 'editall' perm can give rights to 'trash' status, but this is not the case
<a name="l2450"><span class="linenum">2450</span></a>                      break;
<a name="l2451"><span class="linenum">2451</span></a>                  }
<a name="l2452"><span class="linenum">2452</span></a>  
<a name="l2453"><span class="linenum">2453</span></a>                  if( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'delete' )
<a name="l2454"><span class="linenum">2454</span></a>                  { // permlevel is delete so we have to check the 'blog_del_cmts' permission
<a name="l2455"><span class="linenum">2455</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_del_cmts', 'edit', false, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> )
<a name="l2456"><span class="linenum">2456</span></a>                              || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'recycle_owncmts', <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, false, <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> );
<a name="l2457"><span class="linenum">2457</span></a>                      break;
<a name="l2458"><span class="linenum">2458</span></a>                  }
<a name="l2459"><span class="linenum">2459</span></a>  
<a name="l2460"><span class="linenum">2460</span></a>  <span class="comment">                // Check comment current status permissions at the blog level:</span>
<a name="l2461"><span class="linenum">2461</span></a>                  <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a> = 'blog_comment!'.<a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a onClick="logVariable('status')" class="var it10680" onMouseOver="hilite(10680)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a>;
<a name="l2462"><span class="linenum">2462</span></a>                  <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> );
<a name="l2463"><span class="linenum">2463</span></a>                  if( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> )
<a name="l2464"><span class="linenum">2464</span></a>                  { // Check groups for permissions to this specific blog:
<a name="l2465"><span class="linenum">2465</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm_bloggroups')" href="../../../_functions/check_perm_bloggroups.html" onMouseOver="funcPopup(event,'check_perm_bloggroups')">check_perm_bloggroups</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> );
<a name="l2466"><span class="linenum">2466</span></a>                  }
<a name="l2467"><span class="linenum">2467</span></a>                  if( <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> &amp;&amp; ( <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a onClick="logVariable('status')" class="var it10680" onMouseOver="hilite(10680)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> != <a class="var it3967" onMouseOver="hilite(3967)" onMouseOut="lolite()" onClick="logVariable('check_status')" href="../../../_variables/check_status.html">$check_status</a> ) )
<a name="l2468"><span class="linenum">2468</span></a>                  { // also check the requested status permissions at the blog level
<a name="l2469"><span class="linenum">2469</span></a>                      <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a> = 'blog_comment!'.<a class="var it3967" onMouseOver="hilite(3967)" onMouseOut="lolite()" onClick="logVariable('check_status')" href="../../../_variables/check_status.html">$check_status</a>;
<a name="l2470"><span class="linenum">2470</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, 'create', <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2471"><span class="linenum">2471</span></a>                      if( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> )
<a name="l2472"><span class="linenum">2472</span></a>                      { // Check groups for permissions to this specific blog:
<a name="l2473"><span class="linenum">2473</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm_bloggroups')" href="../../../_functions/check_perm_bloggroups.html" onMouseOver="funcPopup(event,'check_perm_bloggroups')">check_perm_bloggroups</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, 'create', <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2474"><span class="linenum">2474</span></a>                      }
<a name="l2475"><span class="linenum">2475</span></a>                  }
<a name="l2476"><span class="linenum">2476</span></a>                  break;
<a name="l2477"><span class="linenum">2477</span></a>  
<a name="l2478"><span class="linenum">2478</span></a>              case 'meta_comment':
<a name="l2479"><span class="linenum">2479</span></a>  <span class="comment">                // Check permission for meta comment:</span>
<a name="l2480"><span class="linenum">2480</span></a>  
<a name="l2481"><span class="linenum">2481</span></a>                  if( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'view' || <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'add' )
<a name="l2482"><span class="linenum">2482</span></a>                  { // Set Item from target object
<a name="l2483"><span class="linenum">2483</span></a>                      <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2484"><span class="linenum">2484</span></a>                  }
<a name="l2485"><span class="linenum">2485</span></a>                  elseif( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'edit' || <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'moderate' || <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'delete' )
<a name="l2486"><span class="linenum">2486</span></a>                  { // Set Comment from target object
<a name="l2487"><span class="linenum">2487</span></a>                      <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2488"><span class="linenum">2488</span></a>                      if( empty( <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a> ) || ! <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a class="function" onClick="logFunction('is_meta')" href="../../../_functions/is_meta.html" onMouseOver="funcPopup(event,'is_meta')">is_meta</a>() )
<a name="l2489"><span class="linenum">2489</span></a>                      { // Comment must be defined and meta to check these permissions
<a name="l2490"><span class="linenum">2490</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = false;
<a name="l2491"><span class="linenum">2491</span></a>                          break;
<a name="l2492"><span class="linenum">2492</span></a>                      }
<a name="l2493"><span class="linenum">2493</span></a>                      <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> = &amp; <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a class="function" onClick="logFunction('get_Item')" href="../../../_functions/get_item.html" onMouseOver="funcPopup(event,'get_item')">get_Item</a>();
<a name="l2494"><span class="linenum">2494</span></a>                  }
<a name="l2495"><span class="linenum">2495</span></a>                  else
<a name="l2496"><span class="linenum">2496</span></a>                  { // Invalid permission level
<a name="l2497"><span class="linenum">2497</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = false;
<a name="l2498"><span class="linenum">2498</span></a>                      break;
<a name="l2499"><span class="linenum">2499</span></a>                  }
<a name="l2500"><span class="linenum">2500</span></a>  
<a name="l2501"><span class="linenum">2501</span></a>                  if( empty( <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> ) )
<a name="l2502"><span class="linenum">2502</span></a>                  { // Item must be defined to check these permissions
<a name="l2503"><span class="linenum">2503</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = false;
<a name="l2504"><span class="linenum">2504</span></a>                      break;
<a name="l2505"><span class="linenum">2505</span></a>                  }
<a name="l2506"><span class="linenum">2506</span></a>  
<a name="l2507"><span class="linenum">2507</span></a>                  switch( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> )
<a name="l2508"><span class="linenum">2508</span></a>                  {
<a name="l2509"><span class="linenum">2509</span></a>                      case 'view':
<a name="l2510"><span class="linenum">2510</span></a>                      case 'add':
<a name="l2511"><span class="linenum">2511</span></a>  <span class="comment">                        // Check perms to View/Add meta comments:</span>
<a name="l2512"><span class="linenum">2512</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = // If User can edit or delete this Item
<a name="l2513"><span class="linenum">2513</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'item_post!CURSTATUS', 'edit', false, <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> )
<a name="l2514"><span class="linenum">2514</span></a>  <span class="comment">                                // OR If User can delete any Item of the Blog</span>
<a name="l2515"><span class="linenum">2515</span></a>                                  || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_del_post', '', false, <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('get_blog_ID')" href="../../../_functions/get_blog_id.html" onMouseOver="funcPopup(event,'get_blog_id')">get_blog_ID</a>() );
<a name="l2516"><span class="linenum">2516</span></a>                          break;
<a name="l2517"><span class="linenum">2517</span></a>  
<a name="l2518"><span class="linenum">2518</span></a>                      case 'edit':
<a name="l2519"><span class="linenum">2519</span></a>  <span class="comment">                        // Check perms to Edit meta comment</span>
<a name="l2520"><span class="linenum">2520</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = // User can edit only own meta comment
<a name="l2521"><span class="linenum">2521</span></a>                                  <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10680" onMouseOver="hilite(10680)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;ID
<a name="l2522"><span class="linenum">2522</span></a>  <span class="comment">                                // AND User must has a permission to view meta comments</span>
<a name="l2523"><span class="linenum">2523</span></a>                                  &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'meta_comment', 'view', false, <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> );
<a name="l2524"><span class="linenum">2524</span></a>                          break;
<a name="l2525"><span class="linenum">2525</span></a>  
<a name="l2526"><span class="linenum">2526</span></a>                      case 'moderate':
<a name="l2527"><span class="linenum">2527</span></a>  <span class="comment">                        // Moderation is not available for meta comment</span>
<a name="l2528"><span class="linenum">2528</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = false;
<a name="l2529"><span class="linenum">2529</span></a>                          break;
<a name="l2530"><span class="linenum">2530</span></a>  
<a name="l2531"><span class="linenum">2531</span></a>                      case 'delete':
<a name="l2532"><span class="linenum">2532</span></a>  <span class="comment">                        // Check perms to Delete meta comment:</span>
<a name="l2533"><span class="linenum">2533</span></a>                          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_del_post', '', false, <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('get_blog_ID')" href="../../../_functions/get_blog_id.html" onMouseOver="funcPopup(event,'get_blog_id')">get_blog_ID</a>() ) )
<a name="l2534"><span class="linenum">2534</span></a>                          { // If User can delete this Item
<a name="l2535"><span class="linenum">2535</span></a>                              <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2536"><span class="linenum">2536</span></a>                              break;
<a name="l2537"><span class="linenum">2537</span></a>                          }
<a name="l2538"><span class="linenum">2538</span></a>                          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'item_post!CURSTATUS', 'edit', false, <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> ) &amp;&amp;
<a name="l2539"><span class="linenum">2539</span></a>                              <a class="var it521" onMouseOver="hilite(521)" onMouseOut="lolite()" onClick="logVariable('Comment')" href="../../../_variables/Comment.html">$Comment</a>-&gt;<a onClick="logVariable('author_user_ID')" class="var it10680" onMouseOver="hilite(10680)" onMouseOut="lolite()" href="../../../_variables/author_user_ID.html">author_user_ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l2540"><span class="linenum">2540</span></a>                          { // If it is own meta comment of the User
<a name="l2541"><span class="linenum">2541</span></a>                              <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2542"><span class="linenum">2542</span></a>                              break;
<a name="l2543"><span class="linenum">2543</span></a>                          }
<a name="l2544"><span class="linenum">2544</span></a>                          break;
<a name="l2545"><span class="linenum">2545</span></a>                  }
<a name="l2546"><span class="linenum">2546</span></a>  
<a name="l2547"><span class="linenum">2547</span></a>                  break;
<a name="l2548"><span class="linenum">2548</span></a>  
<a name="l2549"><span class="linenum">2549</span></a>              case 'item_post!CURSTATUS':
<a name="l2550"><span class="linenum">2550</span></a>                  <span class="comment">/**</span>
<a name="l2551"><span class="linenum">2551</span></a>  <span class="comment">                 * @var Item</span>
<a name="l2552"><span class="linenum">2552</span></a>  <span class="comment">                 */</span>
<a name="l2553"><span class="linenum">2553</span></a>                  <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2554"><span class="linenum">2554</span></a>  <span class="comment">                // Change the permname to one of the following:</span>
<a name="l2555"><span class="linenum">2555</span></a>                  <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a> = 'item_post!'.<a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a onClick="logVariable('status')" class="var it10688" onMouseOver="hilite(10688)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a>;
<a name="l2556"><span class="linenum">2556</span></a>              case 'item_post!published':
<a name="l2557"><span class="linenum">2557</span></a>              case 'item_post!community':
<a name="l2558"><span class="linenum">2558</span></a>              case 'item_post!protected':
<a name="l2559"><span class="linenum">2559</span></a>              case 'item_post!private':
<a name="l2560"><span class="linenum">2560</span></a>              case 'item_post!review':
<a name="l2561"><span class="linenum">2561</span></a>              case 'item_post!draft':
<a name="l2562"><span class="linenum">2562</span></a>              case 'item_post!deprecated':
<a name="l2563"><span class="linenum">2563</span></a>              case 'item_post!redirected':
<a name="l2564"><span class="linenum">2564</span></a>  <span class="comment">                // Get the Blog ID</span>
<a name="l2565"><span class="linenum">2565</span></a>                  <span class="comment">/**</span>
<a name="l2566"><span class="linenum">2566</span></a>  <span class="comment">                 * @var Item</span>
<a name="l2567"><span class="linenum">2567</span></a>  <span class="comment">                 */</span>
<a name="l2568"><span class="linenum">2568</span></a>                  <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2569"><span class="linenum">2569</span></a>                  <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> = <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('get_blog_ID')" href="../../../_functions/get_blog_id.html" onMouseOver="funcPopup(event,'get_blog_id')">get_blog_ID</a>();
<a name="l2570"><span class="linenum">2570</span></a>                  <a class="var it3967" onMouseOver="hilite(3967)" onMouseOut="lolite()" onClick="logVariable('check_status')" href="../../../_variables/check_status.html">$check_status</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, 10 );
<a name="l2571"><span class="linenum">2571</span></a>  
<a name="l2572"><span class="linenum">2572</span></a>                  if( ( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> != 'view' ) &amp;&amp; <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a class="function" onClick="logFunction('is_locked')" href="../../../_functions/is_locked.html" onMouseOver="funcPopup(event,'is_locked')">is_locked</a>() &amp;&amp; !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_cats', 'edit', false, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> ) )
<a name="l2573"><span class="linenum">2573</span></a>                  { // Item is locked and current user is not allowed to edit locked items ( only view permission is allowed by default for locked items )
<a name="l2574"><span class="linenum">2574</span></a>                      break;
<a name="l2575"><span class="linenum">2575</span></a>                  }
<a name="l2576"><span class="linenum">2576</span></a>  
<a name="l2577"><span class="linenum">2577</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blog_global')" href="../../../_functions/check_perm_blog_global.html" onMouseOver="funcPopup(event,'check_perm_blog_global')">check_perm_blog_global</a>( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> ) )
<a name="l2578"><span class="linenum">2578</span></a>                  { // User has global permission on this blog:
<a name="l2579"><span class="linenum">2579</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2580"><span class="linenum">2580</span></a>                      break;
<a name="l2581"><span class="linenum">2581</span></a>                  }
<a name="l2582"><span class="linenum">2582</span></a>  
<a name="l2583"><span class="linenum">2583</span></a>                  if( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'delete' )
<a name="l2584"><span class="linenum">2584</span></a>                  { // permlevel is delete so we have to check the 'blog_del_post' permission
<a name="l2585"><span class="linenum">2585</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_del_post', 'edit', false, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2586"><span class="linenum">2586</span></a>                      break;
<a name="l2587"><span class="linenum">2587</span></a>                  }
<a name="l2588"><span class="linenum">2588</span></a>  
<a name="l2589"><span class="linenum">2589</span></a>  <span class="comment">                // Check permissions at the blog level:</span>
<a name="l2590"><span class="linenum">2590</span></a>                  <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a> = 'blog_post!'.<a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a onClick="logVariable('status')" class="var it10688" onMouseOver="hilite(10688)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a>;
<a name="l2591"><span class="linenum">2591</span></a>                  <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> );
<a name="l2592"><span class="linenum">2592</span></a>                  if( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> )
<a name="l2593"><span class="linenum">2593</span></a>                  { // Check groups for permissions to this specific blog:
<a name="l2594"><span class="linenum">2594</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm_bloggroups')" href="../../../_functions/check_perm_bloggroups.html" onMouseOver="funcPopup(event,'check_perm_bloggroups')">check_perm_bloggroups</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> );
<a name="l2595"><span class="linenum">2595</span></a>                  }
<a name="l2596"><span class="linenum">2596</span></a>                  if( <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> &amp;&amp; ( <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a onClick="logVariable('status')" class="var it10688" onMouseOver="hilite(10688)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> != <a class="var it3967" onMouseOver="hilite(3967)" onMouseOut="lolite()" onClick="logVariable('check_status')" href="../../../_variables/check_status.html">$check_status</a> ) )
<a name="l2597"><span class="linenum">2597</span></a>                  { // also check the requested status permissions at the blog level
<a name="l2598"><span class="linenum">2598</span></a>                      <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a> = 'blog_post!'.<a class="var it3967" onMouseOver="hilite(3967)" onMouseOut="lolite()" onClick="logVariable('check_status')" href="../../../_variables/check_status.html">$check_status</a>;
<a name="l2599"><span class="linenum">2599</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, 'create', <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2600"><span class="linenum">2600</span></a>                      if( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> )
<a name="l2601"><span class="linenum">2601</span></a>                      { // Check groups for permissions to this specific blog:
<a name="l2602"><span class="linenum">2602</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm_bloggroups')" href="../../../_functions/check_perm_bloggroups.html" onMouseOver="funcPopup(event,'check_perm_bloggroups')">check_perm_bloggroups</a>( <a class="var it3968" onMouseOver="hilite(3968)" onMouseOut="lolite()" onClick="logVariable('blog_permname')" href="../../../_variables/blog_permname.html">$blog_permname</a>, 'create', <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2603"><span class="linenum">2603</span></a>                      }
<a name="l2604"><span class="linenum">2604</span></a>                  }
<a name="l2605"><span class="linenum">2605</span></a>                  break;
<a name="l2606"><span class="linenum">2606</span></a>  
<a name="l2607"><span class="linenum">2607</span></a>              case 'stats':
<a name="l2608"><span class="linenum">2608</span></a>  <span class="comment">                // Blog permission to edit its properties...</span>
<a name="l2609"><span class="linenum">2609</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group();
<a name="l2610"><span class="linenum">2610</span></a>  
<a name="l2611"><span class="linenum">2611</span></a>  <span class="comment">                // Group may grant VIEW acces, FULL access:</span>
<a name="l2612"><span class="linenum">2612</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> ) )
<a name="l2613"><span class="linenum">2613</span></a>                  { // If group grants a global permission:
<a name="l2614"><span class="linenum">2614</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2615"><span class="linenum">2615</span></a>                      break;
<a name="l2616"><span class="linenum">2616</span></a>                  }
<a name="l2617"><span class="linenum">2617</span></a>  
<a name="l2618"><span class="linenum">2618</span></a>                  if( <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> &gt; 0 )
<a name="l2619"><span class="linenum">2619</span></a>                  { // Check user perm for this blog:
<a name="l2620"><span class="linenum">2620</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> );
<a name="l2621"><span class="linenum">2621</span></a>                      if ( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> )
<a name="l2622"><span class="linenum">2622</span></a>                      { // Check groups for permissions to this specific blog:
<a name="l2623"><span class="linenum">2623</span></a>                          <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm_bloggroups')" href="../../../_functions/check_perm_bloggroups.html" onMouseOver="funcPopup(event,'check_perm_bloggroups')">check_perm_bloggroups</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> );
<a name="l2624"><span class="linenum">2624</span></a>                      }
<a name="l2625"><span class="linenum">2625</span></a>                  }
<a name="l2626"><span class="linenum">2626</span></a>                  break;
<a name="l2627"><span class="linenum">2627</span></a>  
<a name="l2628"><span class="linenum">2628</span></a>              case 'user':
<a name="l2629"><span class="linenum">2629</span></a>  <span class="comment">                // Check if user can 'view'/'moderate'/'edit'/'delete' another user</span>
<a name="l2630"><span class="linenum">2630</span></a>                  <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a> = &amp; <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2631"><span class="linenum">2631</span></a>                  if( !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'can_view_user', <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('ID')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l2632"><span class="linenum">2632</span></a>                  { // User can't even view the edited User
<a name="l2633"><span class="linenum">2633</span></a>                      break;
<a name="l2634"><span class="linenum">2634</span></a>                  }
<a name="l2635"><span class="linenum">2635</span></a>  
<a name="l2636"><span class="linenum">2636</span></a>  <span class="comment">                // If user has global permission on all users then everything is allowed</span>
<a name="l2637"><span class="linenum">2637</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) )
<a name="l2638"><span class="linenum">2638</span></a>                  { // Check if user can edit/delete other users
<a name="l2639"><span class="linenum">2639</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2640"><span class="linenum">2640</span></a>                      break;
<a name="l2641"><span class="linenum">2641</span></a>                  }
<a name="l2642"><span class="linenum">2642</span></a>  
<a name="l2643"><span class="linenum">2643</span></a>                  if( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'delete' || <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'edit' )
<a name="l2644"><span class="linenum">2644</span></a>                  { // These permission levels are not allowed for this user
<a name="l2645"><span class="linenum">2645</span></a>                      break;
<a name="l2646"><span class="linenum">2646</span></a>                  }
<a name="l2647"><span class="linenum">2647</span></a>  
<a name="l2648"><span class="linenum">2648</span></a>                  if( ( ! <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('allow_anonymous_user_profiles') ) &amp;&amp; ( ! <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'cross_country_allow_profiles' ) ) &amp;&amp; ( empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> ) || ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> !== <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> ) ) )
<a name="l2649"><span class="linenum">2649</span></a>                  { // Users can view/browse other users only from the same country, but this user country is empty or not the same as the target user country
<a name="l2650"><span class="linenum">2650</span></a>  <span class="comment">                    // this User has no permission to even view the target user</span>
<a name="l2651"><span class="linenum">2651</span></a>                      <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;get_Group();
<a name="l2652"><span class="linenum">2652</span></a>                      if( <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('Group')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;level &lt; <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('allow_anonymous_user_level_min') ||
<a name="l2653"><span class="linenum">2653</span></a>                          <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('Group')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;level &gt; <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('allow_anonymous_user_level_max') )
<a name="l2654"><span class="linenum">2654</span></a>                      { // The anonymous users have no access to view this user
<a name="l2655"><span class="linenum">2655</span></a>                          break;
<a name="l2656"><span class="linenum">2656</span></a>                      }
<a name="l2657"><span class="linenum">2657</span></a>                  }
<a name="l2658"><span class="linenum">2658</span></a>  
<a name="l2659"><span class="linenum">2659</span></a>  <span class="comment">                // Note: With this implementation only admin users are allowed to view users from different countries when cross country browsing is restricted</span>
<a name="l2660"><span class="linenum">2660</span></a>  <span class="comment">                // check if user has permission to moderate another user</span>
<a name="l2661"><span class="linenum">2661</span></a>                  if( ( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'moderate' ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'moderate' ) )
<a name="l2662"><span class="linenum">2662</span></a>                  { // this user has moderator permission, check if the group level is higher then the target user group level
<a name="l2663"><span class="linenum">2663</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group();
<a name="l2664"><span class="linenum">2664</span></a>                      <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('get_Group')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/get_Group.html">get_Group</a>;
<a name="l2665"><span class="linenum">2665</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;level &gt; <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('Group')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;level );
<a name="l2666"><span class="linenum">2666</span></a>                      break;
<a name="l2667"><span class="linenum">2667</span></a>                  }
<a name="l2668"><span class="linenum">2668</span></a>  
<a name="l2669"><span class="linenum">2669</span></a>  <span class="comment">                // Only 'view' permlevel remained, and this user is allowed to view the target user</span>
<a name="l2670"><span class="linenum">2670</span></a>                  <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = true;
<a name="l2671"><span class="linenum">2671</span></a>                  break;
<a name="l2672"><span class="linenum">2672</span></a>  
<a name="l2673"><span class="linenum">2673</span></a>  <span class="comment">            // asimo&gt; edit_timestamp permission was converted to blog_edit_ts permission</span>
<a name="l2674"><span class="linenum">2674</span></a>  
<a name="l2675"><span class="linenum">2675</span></a>  
<a name="l2676"><span class="linenum">2676</span></a>  <span class="comment">            // asimo&gt; files permission was converted to pluggable permission</span>
<a name="l2677"><span class="linenum">2677</span></a>              <span class="comment">/*case 'files':</span>
<a name="l2678"><span class="linenum">2678</span></a>  <span class="comment">                $this-&gt;get_Group();</span>
<a name="l2679"><span class="linenum">2679</span></a>  <span class="comment">                $perm = $this-&gt;Group-&gt;check_perm( $permname, $permlevel );*/</span>
<a name="l2680"><span class="linenum">2680</span></a>  
<a name="l2681"><span class="linenum">2681</span></a>                  <span class="comment">/* Notes:</span>
<a name="l2682"><span class="linenum">2682</span></a>  <span class="comment">                 *  - $perm_target can be:</span>
<a name="l2683"><span class="linenum">2683</span></a>  <span class="comment">                 *    - NULL or 0: check global group permission only</span>
<a name="l2684"><span class="linenum">2684</span></a>  <span class="comment">                 *    - positive: check global group permission and</span>
<a name="l2685"><span class="linenum">2685</span></a>  <span class="comment">                 *      (if granted) if a specific blog denies it.</span>
<a name="l2686"><span class="linenum">2686</span></a>  <span class="comment">* fp&gt; This is BAD BAD BAD because it's inconsistent with the other permissions</span>
<a name="l2687"><span class="linenum">2687</span></a>  <span class="comment">* in b2evolution. There should NEVER be a denying. ony additional allowing.</span>
<a name="l2688"><span class="linenum">2688</span></a>  <span class="comment">* It's also inconsistent with most other permission systems.</span>
<a name="l2689"><span class="linenum">2689</span></a>  <span class="comment">* The lower file permission level for groups is now called &quot;No Access&quot;</span>
<a name="l2690"><span class="linenum">2690</span></a>  <span class="comment">* This should be renamed to &quot;Depending on each blog's permissions&quot;</span>
<a name="l2691"><span class="linenum">2691</span></a>  <span class="comment">* Whatever general permissions you have on files, blog can give you additional permissions</span>
<a name="l2692"><span class="linenum">2692</span></a>  <span class="comment">* but they can never take a global perm away.</span>
<a name="l2693"><span class="linenum">2693</span></a>  <span class="comment">* Tblue&gt; On the permissions page it says that the blog perms will be restricted</span>
<a name="l2694"><span class="linenum">2694</span></a>  <span class="comment">* by any global perms, which means to me that a blog cannot grant e. g.</span>
<a name="l2695"><span class="linenum">2695</span></a>  <span class="comment">* the files upload perm if this perm isn't granted globally... But apparently</span>
<a name="l2696"><span class="linenum">2696</span></a>  <span class="comment">* it shouldn't be like that?! I understand it should be like that then:</span>
<a name="l2697"><span class="linenum">2697</span></a>  <span class="comment">* if( ! $perm &amp;&amp; $perm_target &amp;&amp; in_array( $permlevel, array( 'add', 'view', 'edit' ) )</span>
<a name="l2698"><span class="linenum">2698</span></a>  <span class="comment">* {</span>
<a name="l2699"><span class="linenum">2699</span></a>  <span class="comment">*         // check if blog grants permission.</span>
<a name="l2700"><span class="linenum">2700</span></a>  <span class="comment">* }</span>
<a name="l2701"><span class="linenum">2701</span></a>  <span class="comment">* If this is correct, we should remove the note on the blog permissions</span>
<a name="l2702"><span class="linenum">2702</span></a>  <span class="comment">* pages and the group properties form.</span>
<a name="l2703"><span class="linenum">2703</span></a>  <span class="comment">* fp&gt; ok, I had forgotten we had that old message, but still it doesn't say it will, it says it *may* !</span>
<a name="l2704"><span class="linenum">2704</span></a>  <span class="comment">* To be exact the message should be &quot;</span>
<a name="l2705"><span class="linenum">2705</span></a>  <span class="comment">* Note: General group permissions may further restrict or extend any permissions defined here.&quot;</span>
<a name="l2706"><span class="linenum">2706</span></a>  <span class="comment">* Restriction should only happen when &quot;NO ACCESS&quot; is selected</span>
<a name="l2707"><span class="linenum">2707</span></a>  <span class="comment">* But when &quot;Depending on each blog's permissions&quot; is selected, THEN (and I guess ONLY then) the blog permissions should be used</span>
<a name="l2708"><span class="linenum">2708</span></a>  <span class="comment">* Note: This is quite messy actually. maybe it would make more sense to separate group permissions by &quot;root type&quot;:</span>
<a name="l2709"><span class="linenum">2709</span></a>  <span class="comment">* i-e nto use the same permission for blog roots vs user root vs shared root vs skins root</span>
<a name="l2710"><span class="linenum">2710</span></a>  <span class="comment">* what do you think?</span>
<a name="l2711"><span class="linenum">2711</span></a>  <span class="comment">* Tblue&gt; That sounds OK. So we would add another option to the global</span>
<a name="l2712"><span class="linenum">2712</span></a>  <span class="comment">* 'files' group perm setting (&quot;Depending on each blog's permissions&quot;), right?</span>
<a name="l2713"><span class="linenum">2713</span></a>  <span class="comment">* fp&gt; yes.</span>
<a name="l2714"><span class="linenum">2714</span></a>  <span class="comment">* tb&gt; Regarding separation: It could make sense. The blog-specific permissions would only</span>
<a name="l2715"><span class="linenum">2715</span></a>  <span class="comment">* affect blog roots (and if &quot;Depending on each blog's permissions&quot; is selected;</span>
<a name="l2716"><span class="linenum">2716</span></a>  <span class="comment">* for the other roots we would add separate (global) settings...</span>
<a name="l2717"><span class="linenum">2717</span></a>  <span class="comment">* fp&gt; yes.</span>
<a name="l2718"><span class="linenum">2718</span></a>  <span class="comment">                 *  - Only a $permlevel of 'add', 'view' or 'edit' can be</span>
<a name="l2719"><span class="linenum">2719</span></a>  <span class="comment">                 *    denied by blog permissions.</span>
<a name="l2720"><span class="linenum">2720</span></a>  <span class="comment">                 *  - If the group grants the 'all' permission, blogs cannot</span>
<a name="l2721"><span class="linenum">2721</span></a>  <span class="comment">                 *    deny it.</span>
<a name="l2722"><span class="linenum">2722</span></a>  <span class="comment">                 */</span>
<a name="l2723"><span class="linenum">2723</span></a>  <span class="comment">/*</span>
<a name="l2724"><span class="linenum">2724</span></a>  <span class="comment">                if( $perm &amp;&amp; $perm_target &amp;&amp; in_array( $permlevel, array( 'add', 'view', 'edit' ) )</span>
<a name="l2725"><span class="linenum">2725</span></a>  <span class="comment">                    &amp;&amp; $this-&gt;Group-&gt;get( 'perm_files' ) != 'all' )</span>
<a name="l2726"><span class="linenum">2726</span></a>  <span class="comment">                {    // Check specific blog perms:</span>
<a name="l2727"><span class="linenum">2727</span></a>  <span class="comment">                    $perm = $this-&gt;check_perm_blogusers( $permname, $permlevel, $perm_target );</span>
<a name="l2728"><span class="linenum">2728</span></a>  <span class="comment">                    if ( ! $perm )</span>
<a name="l2729"><span class="linenum">2729</span></a>  <span class="comment">                    { // Check groups for permissions for this specific blog:</span>
<a name="l2730"><span class="linenum">2730</span></a>  <span class="comment">                        $perm = $this-&gt;Group-&gt;check_perm_bloggroups( $permname, $permlevel, $perm_target );</span>
<a name="l2731"><span class="linenum">2731</span></a>  <span class="comment">                    }</span>
<a name="l2732"><span class="linenum">2732</span></a>  <span class="comment">                }</span>
<a name="l2733"><span class="linenum">2733</span></a>  <span class="comment">*/</span>
<a name="l2734"><span class="linenum">2734</span></a>  <span class="comment">                //break;</span>
<a name="l2735"><span class="linenum">2735</span></a>  
<a name="l2736"><span class="linenum">2736</span></a>              default:
<a name="l2737"><span class="linenum">2737</span></a>  <span class="comment">                // Check pluggable permissions using user permission check function</span>
<a name="l2738"><span class="linenum">2738</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group();
<a name="l2739"><span class="linenum">2739</span></a>                  <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="class" onClick="logClass('Module')" href="../../../_classes/module.html" onMouseOver="classPopup(event,'module')">Module</a>::<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>, 'user_func', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a> );
<a name="l2740"><span class="linenum">2740</span></a>                  if( <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> === true || <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> === NULL )
<a name="l2741"><span class="linenum">2741</span></a>                  { // If user_func or user perm not exists in the corresponding module then <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> value will be NULL and we have to check the group permission.
<a name="l2742"><span class="linenum">2742</span></a>  <span class="comment">                    // If user_func exists and returns true, then we have to check group permission to make sure it does not restrict the user perm.</span>
<a name="l2743"><span class="linenum">2743</span></a>  
<a name="l2744"><span class="linenum">2744</span></a>  <span class="comment">                    // Other global permissions (see if the group can handle them).</span>
<a name="l2745"><span class="linenum">2745</span></a>  <span class="comment">                    // Forward request to group:</span>
<a name="l2746"><span class="linenum">2746</span></a>                      <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> );
<a name="l2747"><span class="linenum">2747</span></a>                  }
<a name="l2748"><span class="linenum">2748</span></a>          }
<a name="l2749"><span class="linenum">2749</span></a>  
<a name="l2750"><span class="linenum">2750</span></a>          if( <a class="phpfunction" onClick="logFunction('is_object')" href="../../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>(<a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>) )
<a name="l2751"><span class="linenum">2751</span></a>          {    // Prevent catchable E_FATAL with PHP 5.2 (because there's no __tostring for e.g. Item)
<a name="l2752"><span class="linenum">2752</span></a>              <a class="var it3970" onMouseOver="hilite(3970)" onMouseOut="lolite()" onClick="logVariable('taget_name')" href="../../../_variables/taget_name.html">$taget_name</a> = <a class="phpfunction" onClick="logFunction('get_class')" href="../../../_functions/get_class.html" onMouseOver="phpfuncPopup(event,'get_class')">get_class</a>(<a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>).'('.<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>.')';
<a name="l2753"><span class="linenum">2753</span></a>          }
<a name="l2754"><span class="linenum">2754</span></a>          elseif( <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>) )
<a name="l2755"><span class="linenum">2755</span></a>          {    // Convert to ID list
<a name="l2756"><span class="linenum">2756</span></a>              <a class="var it3970" onMouseOver="hilite(3970)" onMouseOut="lolite()" onClick="logVariable('taget_name')" href="../../../_variables/taget_name.html">$taget_name</a> = '('.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>(',', <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>).')';
<a name="l2757"><span class="linenum">2757</span></a>          }
<a name="l2758"><span class="linenum">2758</span></a>          else
<a name="l2759"><span class="linenum">2759</span></a>          {
<a name="l2760"><span class="linenum">2760</span></a>              <a class="var it3970" onMouseOver="hilite(3970)" onMouseOut="lolite()" onClick="logVariable('taget_name')" href="../../../_variables/taget_name.html">$taget_name</a> = <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a>;
<a name="l2761"><span class="linenum">2761</span></a>          }
<a name="l2762"><span class="linenum">2762</span></a>  
<a name="l2763"><span class="linenum">2763</span></a>          <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'User perm '.<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>.':'.<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>.':'.<a class="var it3970" onMouseOver="hilite(3970)" onMouseOut="lolite()" onClick="logVariable('taget_name')" href="../../../_variables/taget_name.html">$taget_name</a>.' =&gt; '.(<a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> ? 'granted' : 'DENIED'), 'perms' );
<a name="l2764"><span class="linenum">2764</span></a>  
<a name="l2765"><span class="linenum">2765</span></a>          if( ! <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a> &amp;&amp; <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('assert')" href="../../../_variables/assert.html">$assert</a> )
<a name="l2766"><span class="linenum">2766</span></a>          { // We can't let this go on!
<a name="l2767"><span class="linenum">2767</span></a>              global <a class="var it1348" onMouseOver="hilite(1348)" onMouseOut="lolite()" onClick="logVariable('app_name')" href="../../../_variables/app_name.html">$app_name</a>;
<a name="l2768"><span class="linenum">2768</span></a>              <a class="function" onClick="logFunction('debug_die')" href="../../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( sprintf( <span class="comment">/* %s is the application name, usually &quot;b2evolution&quot; */</span> <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Group/user permission denied by %s!'), <a class="var it1348" onMouseOver="hilite(1348)" onMouseOut="lolite()" onClick="logVariable('app_name')" href="../../../_variables/app_name.html">$app_name</a> ).&quot; (<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>:<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>:&quot;.( <a class="phpfunction" onClick="logFunction('is_object')" href="../../../_functions/is_object.html" onMouseOver="phpfuncPopup(event,'is_object')">is_object</a>( <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> ) ? <a class="phpfunction" onClick="logFunction('get_class')" href="../../../_functions/get_class.html" onMouseOver="phpfuncPopup(event,'get_class')">get_class</a>( <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> ).'('.<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>.')' : ( <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>( <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> ) ? <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> ) : <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> ) ).&quot;)&quot; );
<a name="l2769"><span class="linenum">2769</span></a>          }
<a name="l2770"><span class="linenum">2770</span></a>  
<a name="l2771"><span class="linenum">2771</span></a>          if( isset(<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>) )
<a name="l2772"><span class="linenum">2772</span></a>          {
<a name="l2773"><span class="linenum">2773</span></a>  <span class="comment">            // echo &quot;cache_perms[$permname][$permlevel][$perm_target] = $perm;&quot;;</span>
<a name="l2774"><span class="linenum">2774</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('cache_perms')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/cache_perms.html">cache_perms</a>[<a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>][<a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>][<a class="var it3266" onMouseOver="hilite(3266)" onMouseOut="lolite()" onClick="logVariable('perm_target_ID')" href="../../../_variables/perm_target_ID.html">$perm_target_ID</a>] = <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a>;
<a name="l2775"><span class="linenum">2775</span></a>          }
<a name="l2776"><span class="linenum">2776</span></a>  
<a name="l2777"><span class="linenum">2777</span></a>          return <a class="var it459" onMouseOver="hilite(459)" onMouseOut="lolite()" onClick="logVariable('perm')" href="../../../_variables/perm.html">$perm</a>;
<a name="l2778"><span class="linenum">2778</span></a>      }
<a name="l2779"><span class="linenum">2779</span></a>  
<a name="l2780"><span class="linenum">2780</span></a>  
<a name="l2781"><span class="linenum">2781</span></a>      <span class="comment">/**</span>
<a name="l2782"><span class="linenum">2782</span></a>  <span class="comment">     * Check if the user is the owner of the designated blog (which gives him a lot of permissions)</span>
<a name="l2783"><span class="linenum">2783</span></a>  <span class="comment">     *</span>
<a name="l2784"><span class="linenum">2784</span></a>  <span class="comment">     * @param integer</span>
<a name="l2785"><span class="linenum">2785</span></a>  <span class="comment">     * @return boolean</span>
<a name="l2786"><span class="linenum">2786</span></a>  <span class="comment">     */</span>
<a name="l2787"><span class="linenum">2787</span></a>  	function <a class="function" onClick="logFunction('check_perm_blogowner')" href="../../../_functions/check_perm_blogowner.html" onMouseOver="funcPopup(event,'check_perm_blogowner')">check_perm_blogowner</a>( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> )
<a name="l2788"><span class="linenum">2788</span></a>      {
<a name="l2789"><span class="linenum">2789</span></a>          if( empty( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> ) )
<a name="l2790"><span class="linenum">2790</span></a>          {
<a name="l2791"><span class="linenum">2791</span></a>              return false;
<a name="l2792"><span class="linenum">2792</span></a>          }
<a name="l2793"><span class="linenum">2793</span></a>  
<a name="l2794"><span class="linenum">2794</span></a>          <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a> = &amp; get_BlogCache();
<a name="l2795"><span class="linenum">2795</span></a>          <span class="comment">/**</span>
<a name="l2796"><span class="linenum">2796</span></a>  <span class="comment">         * @var Blog</span>
<a name="l2797"><span class="linenum">2797</span></a>  <span class="comment">         */</span>
<a name="l2798"><span class="linenum">2798</span></a>          <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> = &amp; <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a>-&gt;get_by_ID( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> );
<a name="l2799"><span class="linenum">2799</span></a>  
<a name="l2800"><span class="linenum">2800</span></a>          return ( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a onClick="logVariable('owner_user_ID')" class="var it10696" onMouseOver="hilite(10696)" onMouseOut="lolite()" href="../../../_variables/owner_user_ID.html">owner_user_ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l2801"><span class="linenum">2801</span></a>      }
<a name="l2802"><span class="linenum">2802</span></a>  
<a name="l2803"><span class="linenum">2803</span></a>  
<a name="l2804"><span class="linenum">2804</span></a>      <span class="comment">/**</span>
<a name="l2805"><span class="linenum">2805</span></a>  <span class="comment">     * Check if the user is the owner of the designated item (which gives him a lot of permissions)</span>
<a name="l2806"><span class="linenum">2806</span></a>  <span class="comment">     *</span>
<a name="l2807"><span class="linenum">2807</span></a>  <span class="comment">     * @param integer</span>
<a name="l2808"><span class="linenum">2808</span></a>  <span class="comment">     * @return boolean</span>
<a name="l2809"><span class="linenum">2809</span></a>  <span class="comment">     */</span>
<a name="l2810"><span class="linenum">2810</span></a>  	function <a class="function" onClick="logFunction('check_perm_itemowner')" href="../../../_functions/check_perm_itemowner.html" onMouseOver="funcPopup(event,'check_perm_itemowner')">check_perm_itemowner</a>( <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('item_ID')" href="../../../_variables/item_ID.html">$item_ID</a> )
<a name="l2811"><span class="linenum">2811</span></a>      {
<a name="l2812"><span class="linenum">2812</span></a>          if( empty( <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('item_ID')" href="../../../_variables/item_ID.html">$item_ID</a> ) )
<a name="l2813"><span class="linenum">2813</span></a>          {
<a name="l2814"><span class="linenum">2814</span></a>              return false;
<a name="l2815"><span class="linenum">2815</span></a>          }
<a name="l2816"><span class="linenum">2816</span></a>  
<a name="l2817"><span class="linenum">2817</span></a>          <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a> = &amp; get_ItemCache();
<a name="l2818"><span class="linenum">2818</span></a>          <span class="comment">/**</span>
<a name="l2819"><span class="linenum">2819</span></a>  <span class="comment">         * @var Item</span>
<a name="l2820"><span class="linenum">2820</span></a>  <span class="comment">         */</span>
<a name="l2821"><span class="linenum">2821</span></a>          <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a> = &amp; <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a>-&gt;get_by_ID( <a class="var it154" onMouseOver="hilite(154)" onMouseOut="lolite()" onClick="logVariable('item_ID')" href="../../../_variables/item_ID.html">$item_ID</a> );
<a name="l2822"><span class="linenum">2822</span></a>  
<a name="l2823"><span class="linenum">2823</span></a>          return ( <a class="var it105" onMouseOver="hilite(105)" onMouseOut="lolite()" onClick="logVariable('Item')" href="../../../_variables/Item.html">$Item</a>-&gt;<a onClick="logVariable('creator_user_ID')" class="var it10688" onMouseOver="hilite(10688)" onMouseOut="lolite()" href="../../../_variables/creator_user_ID.html">creator_user_ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l2824"><span class="linenum">2824</span></a>      }
<a name="l2825"><span class="linenum">2825</span></a>  
<a name="l2826"><span class="linenum">2826</span></a>  
<a name="l2827"><span class="linenum">2827</span></a>      <span class="comment">/**</span>
<a name="l2828"><span class="linenum">2828</span></a>  <span class="comment">     * Check if user has global perms on this blog</span>
<a name="l2829"><span class="linenum">2829</span></a>  <span class="comment">     *</span>
<a name="l2830"><span class="linenum">2830</span></a>  <span class="comment">     * @param integer blog ID</span>
<a name="l2831"><span class="linenum">2831</span></a>  <span class="comment">     * @param string permlevel</span>
<a name="l2832"><span class="linenum">2832</span></a>  <span class="comment">     * @return boolean true if user is the owner, or user group has some permission on all blogs</span>
<a name="l2833"><span class="linenum">2833</span></a>  <span class="comment">     */</span>
<a name="l2834"><span class="linenum">2834</span></a>  	function <a class="function" onClick="logFunction('check_perm_blog_global')" href="../../../_functions/check_perm_blog_global.html" onMouseOver="funcPopup(event,'check_perm_blog_global')">check_perm_blog_global</a>( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> = 'edit' )
<a name="l2835"><span class="linenum">2835</span></a>      {
<a name="l2836"><span class="linenum">2836</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm_blogowner')" href="../../../_functions/check_perm_blogowner.html" onMouseOver="funcPopup(event,'check_perm_blogowner')">check_perm_blogowner</a>( <a class="var it141" onMouseOver="hilite(141)" onMouseOut="lolite()" onClick="logVariable('blog_ID')" href="../../../_variables/blog_ID.html">$blog_ID</a> ) )
<a name="l2837"><span class="linenum">2837</span></a>          { // user is the blog owner
<a name="l2838"><span class="linenum">2838</span></a>              return true;
<a name="l2839"><span class="linenum">2839</span></a>          }
<a name="l2840"><span class="linenum">2840</span></a>  
<a name="l2841"><span class="linenum">2841</span></a>  <span class="comment">        // Group may grant VIEW access, FULL access:</span>
<a name="l2842"><span class="linenum">2842</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group();
<a name="l2843"><span class="linenum">2843</span></a>          <a class="var it3966" onMouseOver="hilite(3966)" onMouseOut="lolite()" onClick="logVariable('group_permlevel')" href="../../../_variables/group_permlevel.html">$group_permlevel</a> = ( <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'view' &amp;&amp; <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a> == 'any' ) ? 'viewall' : 'editall';
<a name="l2844"><span class="linenum">2844</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('Group')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/Group.html">Group</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blogs', <a class="var it3966" onMouseOver="hilite(3966)" onMouseOut="lolite()" onClick="logVariable('group_permlevel')" href="../../../_variables/group_permlevel.html">$group_permlevel</a> ) )
<a name="l2845"><span class="linenum">2845</span></a>          { // If group grants a global permission:
<a name="l2846"><span class="linenum">2846</span></a>              return true;
<a name="l2847"><span class="linenum">2847</span></a>          }
<a name="l2848"><span class="linenum">2848</span></a>  
<a name="l2849"><span class="linenum">2849</span></a>          return false;
<a name="l2850"><span class="linenum">2850</span></a>      }
<a name="l2851"><span class="linenum">2851</span></a>  
<a name="l2852"><span class="linenum">2852</span></a>  
<a name="l2853"><span class="linenum">2853</span></a>      <span class="comment">/**</span>
<a name="l2854"><span class="linenum">2854</span></a>  <span class="comment">     * Check permission for this user on a specified blog</span>
<a name="l2855"><span class="linenum">2855</span></a>  <span class="comment">     *</span>
<a name="l2856"><span class="linenum">2856</span></a>  <span class="comment">     * This is not for direct use, please call {@link User::check_perm()} instead</span>
<a name="l2857"><span class="linenum">2857</span></a>  <span class="comment">     *</span>
<a name="l2858"><span class="linenum">2858</span></a>  <span class="comment">     * @see User::check_perm()</span>
<a name="l2859"><span class="linenum">2859</span></a>  <span class="comment">     * @param string Permission name, can be one of the following:</span>
<a name="l2860"><span class="linenum">2860</span></a>  <span class="comment">     *                  - blog_ismember</span>
<a name="l2861"><span class="linenum">2861</span></a>  <span class="comment">     *                  - blog_can_be_assignee</span>
<a name="l2862"><span class="linenum">2862</span></a>  <span class="comment">     *                  - blog_post_statuses</span>
<a name="l2863"><span class="linenum">2863</span></a>  <span class="comment">     *                  - blog_del_post</span>
<a name="l2864"><span class="linenum">2864</span></a>  <span class="comment">     *                  - blog_edit_ts</span>
<a name="l2865"><span class="linenum">2865</span></a>  <span class="comment">     *                  - blog_comments</span>
<a name="l2866"><span class="linenum">2866</span></a>  <span class="comment">     *                  - blog_cats</span>
<a name="l2867"><span class="linenum">2867</span></a>  <span class="comment">     *                  - blog_properties</span>
<a name="l2868"><span class="linenum">2868</span></a>  <span class="comment">     * @param string Permission level</span>
<a name="l2869"><span class="linenum">2869</span></a>  <span class="comment">     * @param integer Permission target blog ID</span>
<a name="l2870"><span class="linenum">2870</span></a>  <span class="comment">     * @param Item Item that we want to edit</span>
<a name="l2871"><span class="linenum">2871</span></a>  <span class="comment">     * @return boolean 0 if permission denied</span>
<a name="l2872"><span class="linenum">2872</span></a>  <span class="comment">     */</span>
<a name="l2873"><span class="linenum">2873</span></a>  	function <a class="function" onClick="logFunction('check_perm_blogusers')" href="../../../_functions/check_perm_blogusers.html" onMouseOver="funcPopup(event,'check_perm_blogusers')">check_perm_blogusers</a>( <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3265" onMouseOver="hilite(3265)" onMouseOut="lolite()" onClick="logVariable('perm_target_blog')" href="../../../_variables/perm_target_blog.html">$perm_target_blog</a>, <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> = NULL )
<a name="l2874"><span class="linenum">2874</span></a>      {
<a name="l2875"><span class="linenum">2875</span></a>  <span class="comment">        // Check if user blog advanced perms are loaded</span>
<a name="l2876"><span class="linenum">2876</span></a>          if( ! isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('blog_post_statuses')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/blog_post_statuses.html">blog_post_statuses</a>[<a class="var it3265" onMouseOver="hilite(3265)" onMouseOut="lolite()" onClick="logVariable('perm_target_blog')" href="../../../_variables/perm_target_blog.html">$perm_target_blog</a>] ) )
<a name="l2877"><span class="linenum">2877</span></a>          { // Blog post statuses have not been loaded yet:
<a name="l2878"><span class="linenum">2878</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('blog_post_statuses')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/blog_post_statuses.html">blog_post_statuses</a>[<a class="var it3265" onMouseOver="hilite(3265)" onMouseOut="lolite()" onClick="logVariable('perm_target_blog')" href="../../../_variables/perm_target_blog.html">$perm_target_blog</a>] = array();
<a name="l2879"><span class="linenum">2879</span></a>              if( ! <a class="function" onClick="logFunction('load_blog_advanced_perms')" href="../../../_functions/load_blog_advanced_perms.html" onMouseOver="funcPopup(event,'load_blog_advanced_perms')">load_blog_advanced_perms</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('blog_post_statuses')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/blog_post_statuses.html">blog_post_statuses</a>[<a class="var it3265" onMouseOver="hilite(3265)" onMouseOut="lolite()" onClick="logVariable('perm_target_blog')" href="../../../_variables/perm_target_blog.html">$perm_target_blog</a>], <a class="var it3265" onMouseOver="hilite(3265)" onMouseOut="lolite()" onClick="logVariable('perm_target_blog')" href="../../../_variables/perm_target_blog.html">$perm_target_blog</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, 'bloguser' ) )
<a name="l2880"><span class="linenum">2880</span></a>              { // Could not load blog advanced user perms
<a name="l2881"><span class="linenum">2881</span></a>                  return false;
<a name="l2882"><span class="linenum">2882</span></a>              }
<a name="l2883"><span class="linenum">2883</span></a>          }
<a name="l2884"><span class="linenum">2884</span></a>  
<a name="l2885"><span class="linenum">2885</span></a>  <span class="comment">        // Check permission and return the result</span>
<a name="l2886"><span class="linenum">2886</span></a>          return <a class="function" onClick="logFunction('check_blog_advanced_perm')" href="../../../_functions/check_blog_advanced_perm.html" onMouseOver="funcPopup(event,'check_blog_advanced_perm')">check_blog_advanced_perm</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('blog_post_statuses')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/blog_post_statuses.html">blog_post_statuses</a>[<a class="var it3265" onMouseOver="hilite(3265)" onMouseOut="lolite()" onClick="logVariable('perm_target_blog')" href="../../../_variables/perm_target_blog.html">$perm_target_blog</a>], <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, <a class="var it1077" onMouseOver="hilite(1077)" onMouseOut="lolite()" onClick="logVariable('permname')" href="../../../_variables/permname.html">$permname</a>, <a class="var it456" onMouseOver="hilite(456)" onMouseOut="lolite()" onClick="logVariable('permlevel')" href="../../../_variables/permlevel.html">$permlevel</a>, <a class="var it3268" onMouseOver="hilite(3268)" onMouseOut="lolite()" onClick="logVariable('perm_target')" href="../../../_variables/perm_target.html">$perm_target</a> );
<a name="l2887"><span class="linenum">2887</span></a>      }
<a name="l2888"><span class="linenum">2888</span></a>  
<a name="l2889"><span class="linenum">2889</span></a>  
<a name="l2890"><span class="linenum">2890</span></a>      <span class="comment">/**</span>
<a name="l2891"><span class="linenum">2891</span></a>  <span class="comment">     * Check if user status permits the requested action</span>
<a name="l2892"><span class="linenum">2892</span></a>  <span class="comment">     *</span>
<a name="l2893"><span class="linenum">2893</span></a>  <span class="comment">     * @param string requested action</span>
<a name="l2894"><span class="linenum">2894</span></a>  <span class="comment">     * @param integger target ID - can be a post ID, user ID</span>
<a name="l2895"><span class="linenum">2895</span></a>  <span class="comment">     * @return boolean true if the action is permitted, false otherwise</span>
<a name="l2896"><span class="linenum">2896</span></a>  <span class="comment">     */</span>
<a name="l2897"><span class="linenum">2897</span></a>  	function <a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a>, <a class="var it1169" onMouseOver="hilite(1169)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../../_variables/target.html">$target</a> = NULL )
<a name="l2898"><span class="linenum">2898</span></a>      {
<a name="l2899"><span class="linenum">2899</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l2900"><span class="linenum">2900</span></a>  
<a name="l2901"><span class="linenum">2901</span></a>          switch( <a class="var it125" onMouseOver="hilite(125)" onMouseOut="lolite()" onClick="logVariable('action')" href="../../../_variables/action.html">$action</a> )
<a name="l2902"><span class="linenum">2902</span></a>          {
<a name="l2903"><span class="linenum">2903</span></a>              case 'can_view_user':
<a name="l2904"><span class="linenum">2904</span></a>                  if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'allow_anonymous_user_profiles' ) || ( !empty( <a class="var it1169" onMouseOver="hilite(1169)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../../_variables/target.html">$target</a> ) &amp;&amp; ( <a class="var it1169" onMouseOver="hilite(1169)" onMouseOut="lolite()" onClick="logVariable('target')" href="../../../_variables/target.html">$target</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) ) )
<a name="l2905"><span class="linenum">2905</span></a>                  { // even anonymous users can see users profile, or user wants to check his own profile
<a name="l2906"><span class="linenum">2906</span></a>                      return true;
<a name="l2907"><span class="linenum">2907</span></a>                  }
<a name="l2908"><span class="linenum">2908</span></a>                  return ( ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'activated' ) || ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'autoactivated' ) );
<a name="l2909"><span class="linenum">2909</span></a>              case 'can_view_users':
<a name="l2910"><span class="linenum">2910</span></a>                  if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'allow_anonymous_user_list' ) )
<a name="l2911"><span class="linenum">2911</span></a>                  { // even anonymous users can see users list
<a name="l2912"><span class="linenum">2912</span></a>                      return true;
<a name="l2913"><span class="linenum">2913</span></a>                  }
<a name="l2914"><span class="linenum">2914</span></a>                  return ( ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'activated' ) || ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'autoactivated' ) );
<a name="l2915"><span class="linenum">2915</span></a>              case 'can_view_comments':
<a name="l2916"><span class="linenum">2916</span></a>              case 'can_view_contacts':
<a name="l2917"><span class="linenum">2917</span></a>              case 'can_view_messages':
<a name="l2918"><span class="linenum">2918</span></a>              case 'can_view_threads':
<a name="l2919"><span class="linenum">2919</span></a>              case 'is_validated':
<a name="l2920"><span class="linenum">2920</span></a>              case 'can_access_admin':
<a name="l2921"><span class="linenum">2921</span></a>              case 'can_edit_post':
<a name="l2922"><span class="linenum">2922</span></a>              case 'can_edit_comment':
<a name="l2923"><span class="linenum">2923</span></a>              case 'can_edit_contacts':
<a name="l2924"><span class="linenum">2924</span></a>              case 'can_report_user':
<a name="l2925"><span class="linenum">2925</span></a>                  return ( ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'activated' ) || ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'autoactivated' ) );
<a name="l2926"><span class="linenum">2926</span></a>              case 'can_be_validated':
<a name="l2927"><span class="linenum">2927</span></a>                  return ( ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'new' ) || ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'emailchanged' ) || ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'deactivated' ) || ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'failedactivation' ) );
<a name="l2928"><span class="linenum">2928</span></a>              case 'can_view_msgform':
<a name="l2929"><span class="linenum">2929</span></a>              case 'can_receive_any_message': // can this user receive emails or private messages
<a name="l2930"><span class="linenum">2930</span></a>              case 'can_receive_pm':
<a name="l2931"><span class="linenum">2931</span></a>              case 'can_display_avatar': // can display user's avatar for not admin users
<a name="l2932"><span class="linenum">2932</span></a>              case 'can_display_link': // can display user's profile link for not admin users
<a name="l2933"><span class="linenum">2933</span></a>                  return ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> != 'closed' );
<a name="l2934"><span class="linenum">2934</span></a>              case 'is_closed':
<a name="l2935"><span class="linenum">2935</span></a>                  return ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a> == 'closed' );
<a name="l2936"><span class="linenum">2936</span></a>              default:
<a name="l2937"><span class="linenum">2937</span></a>                  <a class="function" onClick="logFunction('debug_die')" href="../../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'This action is not handled during status check!' );
<a name="l2938"><span class="linenum">2938</span></a>          }
<a name="l2939"><span class="linenum">2939</span></a>      }
<a name="l2940"><span class="linenum">2940</span></a>  
<a name="l2941"><span class="linenum">2941</span></a>      <span class="comment">/**</span>
<a name="l2942"><span class="linenum">2942</span></a>  <span class="comment">     * Check if the user has the given role in any blog</span>
<a name="l2943"><span class="linenum">2943</span></a>  <span class="comment">     *</span>
<a name="l2944"><span class="linenum">2944</span></a>  <span class="comment">     * @param string role name, available values ( post_owner, moderator )</span>
<a name="l2945"><span class="linenum">2945</span></a>  <span class="comment">     * @return mixed NULL if the given roll name is not defined or there are no blogs, true if the user is super admin, 0 if the user doesn't have the given role, positive number otherwise</span>
<a name="l2946"><span class="linenum">2946</span></a>  <span class="comment">     */</span>
<a name="l2947"><span class="linenum">2947</span></a>  	function <a class="function" onClick="logFunction('check_role')" href="../../../_functions/check_role.html" onMouseOver="funcPopup(event,'check_role')">check_role</a>( <a class="var it3971" onMouseOver="hilite(3971)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a> )
<a name="l2948"><span class="linenum">2948</span></a>      {
<a name="l2949"><span class="linenum">2949</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l2950"><span class="linenum">2950</span></a>  
<a name="l2951"><span class="linenum">2951</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blogs', 'editall' ) )
<a name="l2952"><span class="linenum">2952</span></a>          { // if user has global editall blogs permission then it has any kind of role in all blogs
<a name="l2953"><span class="linenum">2953</span></a>              return true;
<a name="l2954"><span class="linenum">2954</span></a>          }
<a name="l2955"><span class="linenum">2955</span></a>  
<a name="l2956"><span class="linenum">2956</span></a>          switch( <a class="var it3971" onMouseOver="hilite(3971)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a> )
<a name="l2957"><span class="linenum">2957</span></a>          {
<a name="l2958"><span class="linenum">2958</span></a>              case 'post_owner':
<a name="l2959"><span class="linenum">2959</span></a>  <span class="comment">                // User is considerated as a post owner, if already has at least one post, or he has right to create posts</span>
<a name="l2960"><span class="linenum">2960</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_posts')" href="../../../_functions/get_num_posts.html" onMouseOver="funcPopup(event,'get_num_posts')">get_num_posts</a>() &gt; 0 )
<a name="l2961"><span class="linenum">2961</span></a>                  { // User already has at least one post
<a name="l2962"><span class="linenum">2962</span></a>                      return true;
<a name="l2963"><span class="linenum">2963</span></a>                  }
<a name="l2964"><span class="linenum">2964</span></a>                  <a class="var it3972" onMouseOver="hilite(3972)" onMouseOut="lolite()" onClick="logVariable('role_conditions')" href="../../../_variables/role_conditions.html">$role_conditions</a> = array( 'perm_poststatuses' =&gt; array( 'IS NOT NULL', '&lt;&gt; &quot;&quot;' ) );
<a name="l2965"><span class="linenum">2965</span></a>                  break;
<a name="l2966"><span class="linenum">2966</span></a>  
<a name="l2967"><span class="linenum">2967</span></a>              case 'member':
<a name="l2968"><span class="linenum">2968</span></a>  <span class="comment">                // User has member role if is member of at least one blog</span>
<a name="l2969"><span class="linenum">2969</span></a>                  <a class="var it3972" onMouseOver="hilite(3972)" onMouseOut="lolite()" onClick="logVariable('role_conditions')" href="../../../_variables/role_conditions.html">$role_conditions</a> = array( 'ismember' =&gt; array( 'IS NOT NULL', '&lt;&gt; 0' ) );
<a name="l2970"><span class="linenum">2970</span></a>                  break;
<a name="l2971"><span class="linenum">2971</span></a>  
<a name="l2972"><span class="linenum">2972</span></a>              case 'comment_editor':
<a name="l2973"><span class="linenum">2973</span></a>  <span class="comment">                // User has permission to edit some other users comments at least in one status</span>
<a name="l2974"><span class="linenum">2974</span></a>                  <a class="var it3972" onMouseOver="hilite(3972)" onMouseOut="lolite()" onClick="logVariable('role_conditions')" href="../../../_variables/role_conditions.html">$role_conditions</a> = array(
<a name="l2975"><span class="linenum">2975</span></a>                      'perm_edit_cmt' =&gt; array( 'IS NOT NULL', '&lt;&gt; &quot;no&quot;', '&lt;&gt; &quot;own&quot;' ),
<a name="l2976"><span class="linenum">2976</span></a>                      'perm_cmtstatuses' =&gt; array( 'IS NOT NULL', '&lt;&gt; 0' )
<a name="l2977"><span class="linenum">2977</span></a>                  );
<a name="l2978"><span class="linenum">2978</span></a>                  break;
<a name="l2979"><span class="linenum">2979</span></a>  
<a name="l2980"><span class="linenum">2980</span></a>              case 'comment_moderator':
<a name="l2981"><span class="linenum">2981</span></a>  <span class="comment">                // set comment moderator perm names</span>
<a name="l2982"><span class="linenum">2982</span></a>                  <a class="var it3973" onMouseOver="hilite(3973)" onMouseOut="lolite()" onClick="logVariable('edit_perm_name')" href="../../../_variables/edit_perm_name.html">$edit_perm_name</a> = 'perm_edit_cmt';
<a name="l2983"><span class="linenum">2983</span></a>                  <a class="var it3974" onMouseOver="hilite(3974)" onMouseOut="lolite()" onClick="logVariable('statuses_perm_name')" href="../../../_variables/statuses_perm_name.html">$statuses_perm_name</a> = 'perm_cmtstatuses';
<a name="l2984"><span class="linenum">2984</span></a>              case 'post_moderator':
<a name="l2985"><span class="linenum">2985</span></a>                  if( <a class="var it3971" onMouseOver="hilite(3971)" onMouseOut="lolite()" onClick="logVariable('rolename')" href="../../../_variables/rolename.html">$rolename</a> == 'post_moderator' )
<a name="l2986"><span class="linenum">2986</span></a>                  { // set post moderator perm names
<a name="l2987"><span class="linenum">2987</span></a>                      <a class="var it3973" onMouseOver="hilite(3973)" onMouseOut="lolite()" onClick="logVariable('edit_perm_name')" href="../../../_variables/edit_perm_name.html">$edit_perm_name</a> = 'perm_edit';
<a name="l2988"><span class="linenum">2988</span></a>                      <a class="var it3974" onMouseOver="hilite(3974)" onMouseOut="lolite()" onClick="logVariable('statuses_perm_name')" href="../../../_variables/statuses_perm_name.html">$statuses_perm_name</a> = 'perm_poststatuses';
<a name="l2989"><span class="linenum">2989</span></a>                  }
<a name="l2990"><span class="linenum">2990</span></a>  <span class="comment">                // User is a moderator if has moderator permission at least in one blog</span>
<a name="l2991"><span class="linenum">2991</span></a>  <span class="comment">                // A moderator must have permissions to create post/comment with at least two statuses from moderation statuses + published status</span>
<a name="l2992"><span class="linenum">2992</span></a>                  <a class="var it3975" onMouseOver="hilite(3975)" onMouseOut="lolite()" onClick="logVariable('check_statuses')" href="../../../_variables/check_statuses.html">$check_statuses</a> = <a class="function" onClick="logFunction('get_visibility_statuses')" href="../../../_functions/get_visibility_statuses.html" onMouseOver="funcPopup(event,'get_visibility_statuses')">get_visibility_statuses</a>( 'moderation' );
<a name="l2993"><span class="linenum">2993</span></a>  <span class="comment">                // Create addition of statuses perm values</span>
<a name="l2994"><span class="linenum">2994</span></a>                  <a class="var it3976" onMouseOver="hilite(3976)" onMouseOut="lolite()" onClick="logVariable('perms_value')" href="../../../_variables/perms_value.html">$perms_value</a> = <a class="function" onClick="logFunction('get_status_permvalue')" href="../../../_functions/get_status_permvalue.html" onMouseOver="funcPopup(event,'get_status_permvalue')">get_status_permvalue</a>( 'published' );
<a name="l2995"><span class="linenum">2995</span></a>                  foreach( <a class="var it3975" onMouseOver="hilite(3975)" onMouseOut="lolite()" onClick="logVariable('check_statuses')" href="../../../_variables/check_statuses.html">$check_statuses</a> as <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> )
<a name="l2996"><span class="linenum">2996</span></a>                  {
<a name="l2997"><span class="linenum">2997</span></a>                      <a class="var it3976" onMouseOver="hilite(3976)" onMouseOut="lolite()" onClick="logVariable('perms_value')" href="../../../_variables/perms_value.html">$perms_value</a> = <a class="var it3976" onMouseOver="hilite(3976)" onMouseOut="lolite()" onClick="logVariable('perms_value')" href="../../../_variables/perms_value.html">$perms_value</a> + <a class="function" onClick="logFunction('get_status_permvalue')" href="../../../_functions/get_status_permvalue.html" onMouseOver="funcPopup(event,'get_status_permvalue')">get_status_permvalue</a>( <a class="var it16" onMouseOver="hilite(16)" onMouseOut="lolite()" onClick="logVariable('status')" href="../../../_variables/status.html">$status</a> );
<a name="l2998"><span class="linenum">2998</span></a>                  }
<a name="l2999"><span class="linenum">2999</span></a>  
<a name="l3000"><span class="linenum">3000</span></a>  <span class="comment">                // Check if user has permission to edit other comments than his own and has create permission on at least two statuses defined above</span>
<a name="l3001"><span class="linenum">3001</span></a>                  <a class="var it3972" onMouseOver="hilite(3972)" onMouseOut="lolite()" onClick="logVariable('role_conditions')" href="../../../_variables/role_conditions.html">$role_conditions</a> = array(
<a name="l3002"><span class="linenum">3002</span></a>                      <a class="var it3973" onMouseOver="hilite(3973)" onMouseOut="lolite()" onClick="logVariable('edit_perm_name')" href="../../../_variables/edit_perm_name.html">$edit_perm_name</a> =&gt; array( 'IS NOT NULL', '&lt;&gt; &quot;no&quot;', '&lt;&gt; &quot;own&quot;' ),
<a name="l3003"><span class="linenum">3003</span></a>                      <a class="var it3974" onMouseOver="hilite(3974)" onMouseOut="lolite()" onClick="logVariable('statuses_perm_name')" href="../../../_variables/statuses_perm_name.html">$statuses_perm_name</a> =&gt; array( 'IS NOT NULL', 'BIT_COUNT( <a class="var it3977" onMouseOver="hilite(3977)" onMouseOut="lolite()" onClick="logVariable('perm_field')" href="../../../_variables/perm_field.html">$perm_field</a>$ &amp; '.<a class="var it3976" onMouseOver="hilite(3976)" onMouseOut="lolite()" onClick="logVariable('perms_value')" href="../../../_variables/perms_value.html">$perms_value</a>.' ) &gt; 1' )
<a name="l3004"><span class="linenum">3004</span></a>                  );
<a name="l3005"><span class="linenum">3005</span></a>                  break;
<a name="l3006"><span class="linenum">3006</span></a>  
<a name="l3007"><span class="linenum">3007</span></a>              default: // roll with the given roll name is not defined
<a name="l3008"><span class="linenum">3008</span></a>                  return NULL;
<a name="l3009"><span class="linenum">3009</span></a>          }
<a name="l3010"><span class="linenum">3010</span></a>  
<a name="l3011"><span class="linenum">3011</span></a>          <a class="var it3978" onMouseOver="hilite(3978)" onMouseOut="lolite()" onClick="logVariable('where_clause')" href="../../../_variables/where_clause.html">$where_clause</a> = '';
<a name="l3012"><span class="linenum">3012</span></a>          <a class="var it3979" onMouseOver="hilite(3979)" onMouseOut="lolite()" onClick="logVariable('perm_prefixes')" href="../../../_variables/perm_prefixes.html">$perm_prefixes</a> = array( 'bloguser_', 'bloggroup_' );
<a name="l3013"><span class="linenum">3013</span></a>          foreach( <a class="var it3979" onMouseOver="hilite(3979)" onMouseOut="lolite()" onClick="logVariable('perm_prefixes')" href="../../../_variables/perm_prefixes.html">$perm_prefixes</a> as <a class="var it710" onMouseOver="hilite(710)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a> )
<a name="l3014"><span class="linenum">3014</span></a>          { // Check requred perms on blogusers and bloggroups as well
<a name="l3015"><span class="linenum">3015</span></a>              <a class="var it3980" onMouseOver="hilite(3980)" onMouseOut="lolite()" onClick="logVariable('where_part')" href="../../../_variables/where_part.html">$where_part</a> = '';
<a name="l3016"><span class="linenum">3016</span></a>              foreach( <a class="var it3972" onMouseOver="hilite(3972)" onMouseOut="lolite()" onClick="logVariable('role_conditions')" href="../../../_variables/role_conditions.html">$role_conditions</a> as <a class="var it3219" onMouseOver="hilite(3219)" onMouseOut="lolite()" onClick="logVariable('perm_name')" href="../../../_variables/perm_name.html">$perm_name</a> =&gt; <a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../../_variables/conditions.html">$conditions</a> )
<a name="l3017"><span class="linenum">3017</span></a>              { // Go through each required permission
<a name="l3018"><span class="linenum">3018</span></a>                  <a class="var it3977" onMouseOver="hilite(3977)" onMouseOut="lolite()" onClick="logVariable('perm_field')" href="../../../_variables/perm_field.html">$perm_field</a> = <a class="var it710" onMouseOver="hilite(710)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a>.<a class="var it3219" onMouseOver="hilite(3219)" onMouseOut="lolite()" onClick="logVariable('perm_name')" href="../../../_variables/perm_name.html">$perm_name</a>;
<a name="l3019"><span class="linenum">3019</span></a>                  foreach( <a class="var it3981" onMouseOver="hilite(3981)" onMouseOut="lolite()" onClick="logVariable('conditions')" href="../../../_variables/conditions.html">$conditions</a> as <a class="var it2069" onMouseOver="hilite(2069)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../../_variables/condition.html">$condition</a> )
<a name="l3020"><span class="linenum">3020</span></a>                  { // Check all defined conditions and join with 'AND' operator
<a name="l3021"><span class="linenum">3021</span></a>                      if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it2069" onMouseOver="hilite(2069)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../../_variables/condition.html">$condition</a>, '<a class="var it3977" onMouseOver="hilite(3977)" onMouseOut="lolite()" onClick="logVariable('perm_field')" href="../../../_variables/perm_field.html">$perm_field</a>$' ) !== false )
<a name="l3022"><span class="linenum">3022</span></a>                      { // The <a class="var it3982" onMouseOver="hilite(3982)" onMouseOut="lolite()" onClick="logVariable('perm_filed')" href="../../../_variables/perm_filed.html">$perm_filed</a> must be replaced in the middle of the condition
<a name="l3023"><span class="linenum">3023</span></a>                          <a class="var it3980" onMouseOver="hilite(3980)" onMouseOut="lolite()" onClick="logVariable('where_part')" href="../../../_variables/where_part.html">$where_part</a> .= '( '.<a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( '<a class="var it3977" onMouseOver="hilite(3977)" onMouseOut="lolite()" onClick="logVariable('perm_field')" href="../../../_variables/perm_field.html">$perm_field</a>$', <a class="var it3977" onMouseOver="hilite(3977)" onMouseOut="lolite()" onClick="logVariable('perm_field')" href="../../../_variables/perm_field.html">$perm_field</a>, <a class="var it2069" onMouseOver="hilite(2069)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../../_variables/condition.html">$condition</a> ).' ) AND ';
<a name="l3024"><span class="linenum">3024</span></a>                      }
<a name="l3025"><span class="linenum">3025</span></a>                      else
<a name="l3026"><span class="linenum">3026</span></a>                      { // The <a class="var it3982" onMouseOver="hilite(3982)" onMouseOut="lolite()" onClick="logVariable('perm_filed')" href="../../../_variables/perm_filed.html">$perm_filed</a> must be added into the beginning of the condition
<a name="l3027"><span class="linenum">3027</span></a>                          <a class="var it3980" onMouseOver="hilite(3980)" onMouseOut="lolite()" onClick="logVariable('where_part')" href="../../../_variables/where_part.html">$where_part</a> .= '( '.<a class="var it3977" onMouseOver="hilite(3977)" onMouseOut="lolite()" onClick="logVariable('perm_field')" href="../../../_variables/perm_field.html">$perm_field</a>.' '.<a class="var it2069" onMouseOver="hilite(2069)" onMouseOut="lolite()" onClick="logVariable('condition')" href="../../../_variables/condition.html">$condition</a>.' ) AND ';
<a name="l3028"><span class="linenum">3028</span></a>                      }
<a name="l3029"><span class="linenum">3029</span></a>                  }
<a name="l3030"><span class="linenum">3030</span></a>              }
<a name="l3031"><span class="linenum">3031</span></a>  <span class="comment">            // Remove the last ' AND ' from the end of this where clause part</span>
<a name="l3032"><span class="linenum">3032</span></a>              <a class="var it3980" onMouseOver="hilite(3980)" onMouseOut="lolite()" onClick="logVariable('where_part')" href="../../../_variables/where_part.html">$where_part</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="var it3980" onMouseOver="hilite(3980)" onMouseOut="lolite()" onClick="logVariable('where_part')" href="../../../_variables/where_part.html">$where_part</a>, 0, strlen( <a class="var it3980" onMouseOver="hilite(3980)" onMouseOut="lolite()" onClick="logVariable('where_part')" href="../../../_variables/where_part.html">$where_part</a> ) - 5 );
<a name="l3033"><span class="linenum">3033</span></a>  <span class="comment">            // Add the created conditions to the final where clause</span>
<a name="l3034"><span class="linenum">3034</span></a>              <a class="var it3978" onMouseOver="hilite(3978)" onMouseOut="lolite()" onClick="logVariable('where_clause')" href="../../../_variables/where_clause.html">$where_clause</a> .= '( '.<a class="var it3980" onMouseOver="hilite(3980)" onMouseOut="lolite()" onClick="logVariable('where_part')" href="../../../_variables/where_part.html">$where_part</a>.' )';
<a name="l3035"><span class="linenum">3035</span></a>              if( <a class="var it710" onMouseOver="hilite(710)" onMouseOut="lolite()" onClick="logVariable('prefix')" href="../../../_variables/prefix.html">$prefix</a> != 'bloggroup_' )
<a name="l3036"><span class="linenum">3036</span></a>              { // 'bloggroup_' perm check is the last, but everywhere else we need an 'OR' operator
<a name="l3037"><span class="linenum">3037</span></a>                  <a class="var it3978" onMouseOver="hilite(3978)" onMouseOut="lolite()" onClick="logVariable('where_clause')" href="../../../_variables/where_clause.html">$where_clause</a> .= ' OR ';
<a name="l3038"><span class="linenum">3038</span></a>              }
<a name="l3039"><span class="linenum">3039</span></a>          }
<a name="l3040"><span class="linenum">3040</span></a>  
<a name="l3041"><span class="linenum">3041</span></a>  <span class="comment">        // Count blog ids where this user has the required permissions for the given role</span>
<a name="l3042"><span class="linenum">3042</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l3043"><span class="linenum">3043</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( blog_ID )' );
<a name="l3044"><span class="linenum">3044</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_blogs' );
<a name="l3045"><span class="linenum">3045</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'LEFT JOIN T_coll_user_perms <a class="function" onClick="logFunction('ON')" href="../../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (blog_advanced_perms &lt;&gt; 0 AND blog_ID = bloguser_blog_ID AND bloguser_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.' )' );
<a name="l3046"><span class="linenum">3046</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'LEFT JOIN T_coll_group_perms <a class="function" onClick="logFunction('ON')" href="../../../_functions/on.html" onMouseOver="funcPopup(event,'on')">ON</a> (blog_advanced_perms &lt;&gt; 0 AND blog_ID = bloggroup_blog_ID AND bloggroup_group_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('grp_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/grp_ID.html">grp_ID</a>.' )' );
<a name="l3047"><span class="linenum">3047</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'blog_owner_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3048"><span class="linenum">3048</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_or')" href="../../../_functions/where_or.html" onMouseOver="funcPopup(event,'where_or')">WHERE_or</a>( <a class="var it3978" onMouseOver="hilite(3978)" onMouseOut="lolite()" onClick="logVariable('where_clause')" href="../../../_variables/where_clause.html">$where_clause</a> );
<a name="l3049"><span class="linenum">3049</span></a>  
<a name="l3050"><span class="linenum">3050</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>(), 0, NULL, 'Check user role in all blogs' );
<a name="l3051"><span class="linenum">3051</span></a>      }
<a name="l3052"><span class="linenum">3052</span></a>  
<a name="l3053"><span class="linenum">3053</span></a>  
<a name="l3054"><span class="linenum">3054</span></a>      <span class="comment">/**</span>
<a name="l3055"><span class="linenum">3055</span></a>  <span class="comment">     * Check if this user and his group accept receiving private messages or not</span>
<a name="l3056"><span class="linenum">3056</span></a>  <span class="comment">     *</span>
<a name="l3057"><span class="linenum">3057</span></a>  <span class="comment">     * @return boolean</span>
<a name="l3058"><span class="linenum">3058</span></a>  <span class="comment">     */</span>
<a name="l3059"><span class="linenum">3059</span></a>  	function <a class="function" onClick="logFunction('accepts_pm')" href="../../../_functions/accepts_pm.html" onMouseOver="funcPopup(event,'accepts_pm')">accepts_pm</a>()
<a name="l3060"><span class="linenum">3060</span></a>      {
<a name="l3061"><span class="linenum">3061</span></a>          global <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>;
<a name="l3062"><span class="linenum">3062</span></a>          return ( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'enable_PM', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'reply' ) );
<a name="l3063"><span class="linenum">3063</span></a>      }
<a name="l3064"><span class="linenum">3064</span></a>  
<a name="l3065"><span class="linenum">3065</span></a>  
<a name="l3066"><span class="linenum">3066</span></a>      <span class="comment">/**</span>
<a name="l3067"><span class="linenum">3067</span></a>  <span class="comment">     * Check if this user accepts receiving emails and has an email address</span>
<a name="l3068"><span class="linenum">3068</span></a>  <span class="comment">     *</span>
<a name="l3069"><span class="linenum">3069</span></a>  <span class="comment">     * @return boolean</span>
<a name="l3070"><span class="linenum">3070</span></a>  <span class="comment">     */</span>
<a name="l3071"><span class="linenum">3071</span></a>  	function <a class="function" onClick="logFunction('accepts_email')" href="../../../_functions/accepts_email.html" onMouseOver="funcPopup(event,'accepts_email')">accepts_email</a>()
<a name="l3072"><span class="linenum">3072</span></a>      {
<a name="l3073"><span class="linenum">3073</span></a>          global <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l3074"><span class="linenum">3074</span></a>          return ( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'emails_msgform') != 'never' ) &amp;&amp; ( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'enable_email', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) ) &amp;&amp; ( ! empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a> ) );
<a name="l3075"><span class="linenum">3075</span></a>      }
<a name="l3076"><span class="linenum">3076</span></a>  
<a name="l3077"><span class="linenum">3077</span></a>  
<a name="l3078"><span class="linenum">3078</span></a>      <span class="comment">/**</span>
<a name="l3079"><span class="linenum">3079</span></a>  <span class="comment">     * Get messaging possibilities between current user and $this user</span>
<a name="l3080"><span class="linenum">3080</span></a>  <span class="comment">     *</span>
<a name="l3081"><span class="linenum">3081</span></a>  <span class="comment">     * @param object Current User (the one trying to send the PM)</span>
<a name="l3082"><span class="linenum">3082</span></a>  <span class="comment">     * @param string Type of contact method to check first: 'PM' &gt; 'email'  </span>
<a name="l3083"><span class="linenum">3083</span></a>  <span class="comment">     * @return NULL|string allowed messaging possibility: PM &gt; email &gt; login &gt; NULL</span>
<a name="l3084"><span class="linenum">3084</span></a>  <span class="comment">     */</span>
<a name="l3085"><span class="linenum">3085</span></a>  	function <a class="function" onClick="logFunction('get_msgform_possibility')" href="../../../_functions/get_msgform_possibility.html" onMouseOver="funcPopup(event,'get_msgform_possibility')">get_msgform_possibility</a>( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a> = NULL, <a class="var it3983" onMouseOver="hilite(3983)" onMouseOut="lolite()" onClick="logVariable('check_level')" href="../../../_variables/check_level.html">$check_level</a> = 'PM' )
<a name="l3086"><span class="linenum">3086</span></a>      {
<a name="l3087"><span class="linenum">3087</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l3088"><span class="linenum">3088</span></a>  
<a name="l3089"><span class="linenum">3089</span></a>          <a class="var it3984" onMouseOver="hilite(3984)" onMouseOut="lolite()" onClick="logVariable('check_owner_SQL')" href="../../../_variables/check_owner_SQL.html">$check_owner_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l3090"><span class="linenum">3090</span></a>          <a class="var it3984" onMouseOver="hilite(3984)" onMouseOut="lolite()" onClick="logVariable('check_owner_SQL')" href="../../../_variables/check_owner_SQL.html">$check_owner_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'blog_ID' );
<a name="l3091"><span class="linenum">3091</span></a>          <a class="var it3984" onMouseOver="hilite(3984)" onMouseOut="lolite()" onClick="logVariable('check_owner_SQL')" href="../../../_variables/check_owner_SQL.html">$check_owner_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_blogs' );
<a name="l3092"><span class="linenum">3092</span></a>          <a class="var it3984" onMouseOver="hilite(3984)" onMouseOut="lolite()" onClick="logVariable('check_owner_SQL')" href="../../../_variables/check_owner_SQL.html">$check_owner_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'blog_owner_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l3093"><span class="linenum">3093</span></a>          <a class="var it3984" onMouseOver="hilite(3984)" onMouseOut="lolite()" onClick="logVariable('check_owner_SQL')" href="../../../_variables/check_owner_SQL.html">$check_owner_SQL</a>-&gt;<a class="function" onClick="logFunction('LIMIT')" href="../../../_functions/limit.html" onMouseOver="funcPopup(event,'limit')">LIMIT</a>( '1' );
<a name="l3094"><span class="linenum">3094</span></a>  
<a name="l3095"><span class="linenum">3095</span></a>          if( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it3984" onMouseOver="hilite(3984)" onMouseOut="lolite()" onClick="logVariable('check_owner_SQL')" href="../../../_variables/check_owner_SQL.html">$check_owner_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() ) )
<a name="l3096"><span class="linenum">3096</span></a>          { // Always allow to contact this user because he is owner of at least one collection:
<a name="l3097"><span class="linenum">3097</span></a>              <a class="var it3985" onMouseOver="hilite(3985)" onMouseOut="lolite()" onClick="logVariable('is_collection_owner')" href="../../../_variables/is_collection_owner.html">$is_collection_owner</a> = true;
<a name="l3098"><span class="linenum">3098</span></a>          }
<a name="l3099"><span class="linenum">3099</span></a>          else
<a name="l3100"><span class="linenum">3100</span></a>          {
<a name="l3101"><span class="linenum">3101</span></a>              <a class="var it3985" onMouseOver="hilite(3985)" onMouseOut="lolite()" onClick="logVariable('is_collection_owner')" href="../../../_variables/is_collection_owner.html">$is_collection_owner</a> = false;
<a name="l3102"><span class="linenum">3102</span></a>          }
<a name="l3103"><span class="linenum">3103</span></a>  
<a name="l3104"><span class="linenum">3104</span></a>          if( ! <a class="var it3985" onMouseOver="hilite(3985)" onMouseOut="lolite()" onClick="logVariable('is_collection_owner')" href="../../../_variables/is_collection_owner.html">$is_collection_owner</a> &amp;&amp; ! <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'can_receive_any_message' ) )
<a name="l3105"><span class="linenum">3105</span></a>          { // In case of a closed account:
<a name="l3106"><span class="linenum">3106</span></a>              return NULL;
<a name="l3107"><span class="linenum">3107</span></a>          }
<a name="l3108"><span class="linenum">3108</span></a>  
<a name="l3109"><span class="linenum">3109</span></a>          if( <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l3110"><span class="linenum">3110</span></a>          { // current User is a registered user
<a name="l3111"><span class="linenum">3111</span></a>              if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a> == NULL )
<a name="l3112"><span class="linenum">3112</span></a>              {
<a name="l3113"><span class="linenum">3113</span></a>                  global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l3114"><span class="linenum">3114</span></a>              }
<a name="l3115"><span class="linenum">3115</span></a>  
<a name="l3116"><span class="linenum">3116</span></a>              if( ! <a class="var it3985" onMouseOver="hilite(3985)" onMouseOut="lolite()" onClick="logVariable('is_collection_owner')" href="../../../_variables/is_collection_owner.html">$is_collection_owner</a> &amp;&amp; <a class="function" onClick="logFunction('has_cross_country_restriction')" href="../../../_functions/has_cross_country_restriction.html" onMouseOver="funcPopup(event,'has_cross_country_restriction')">has_cross_country_restriction</a>( 'contact' ) &amp;&amp; ( empty( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> ) || ( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> !== <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> ) ) )
<a name="l3117"><span class="linenum">3117</span></a>              { // Contat to this user is not enabled
<a name="l3118"><span class="linenum">3118</span></a>                  return NULL;
<a name="l3119"><span class="linenum">3119</span></a>              }
<a name="l3120"><span class="linenum">3120</span></a>  
<a name="l3121"><span class="linenum">3121</span></a>              if( <a class="var it3983" onMouseOver="hilite(3983)" onMouseOut="lolite()" onClick="logVariable('check_level')" href="../../../_variables/check_level.html">$check_level</a> == 'PM' &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('accepts_pm')" href="../../../_functions/accepts_pm.html" onMouseOver="funcPopup(event,'accepts_pm')">accepts_pm</a>() &amp;&amp; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('accepts_pm')" href="../../../_functions/accepts_pm.html" onMouseOver="funcPopup(event,'accepts_pm')">accepts_pm</a>() &amp;&amp; ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l3122"><span class="linenum">3122</span></a>              { // both user has permission to send or receive private message and not the same user
<a name="l3123"><span class="linenum">3123</span></a>  <span class="comment">                // check if current_User is allowed to create a new conversation with this user.</span>
<a name="l3124"><span class="linenum">3124</span></a>                  <a class="var it3986" onMouseOver="hilite(3986)" onMouseOut="lolite()" onClick="logVariable('blocked_contact')" href="../../../_variables/blocked_contact.html">$blocked_contact</a> = <a class="function" onClick="logFunction('check_blocked_contacts')" href="../../../_functions/check_blocked_contacts.html" onMouseOver="funcPopup(event,'check_blocked_contacts')">check_blocked_contacts</a>( array( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l3125"><span class="linenum">3125</span></a>                  if( empty( <a class="var it3986" onMouseOver="hilite(3986)" onMouseOut="lolite()" onClick="logVariable('blocked_contact')" href="../../../_variables/blocked_contact.html">$blocked_contact</a> ) &amp;&amp; ! <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('must_accept_terms')" href="../../../_functions/must_accept_terms.html" onMouseOver="funcPopup(event,'must_accept_terms')">must_accept_terms</a>() )
<a name="l3126"><span class="linenum">3126</span></a>                  { // user is allowed to send pm to this user, and he didn't reached his <span class="keyword">new </span><a class="class" onClick="logClass('thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">thread</a> limit yet
<a name="l3127"><span class="linenum">3127</span></a>                      return 'PM';
<a name="l3128"><span class="linenum">3128</span></a>                  }
<a name="l3129"><span class="linenum">3129</span></a>              }
<a name="l3130"><span class="linenum">3130</span></a>  
<a name="l3131"><span class="linenum">3131</span></a>              if( <a class="var it3985" onMouseOver="hilite(3985)" onMouseOut="lolite()" onClick="logVariable('is_collection_owner')" href="../../../_variables/is_collection_owner.html">$is_collection_owner</a> || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('accepts_email')" href="../../../_functions/accepts_email.html" onMouseOver="funcPopup(event,'accepts_email')">accepts_email</a>() )
<a name="l3132"><span class="linenum">3132</span></a>              { // This User allows email =&gt; send email OR Force to allow to contact with this user because he is owner of the selected collection:
<a name="l3133"><span class="linenum">3133</span></a>                  return 'email';
<a name="l3134"><span class="linenum">3134</span></a>              }
<a name="l3135"><span class="linenum">3135</span></a>          }
<a name="l3136"><span class="linenum">3136</span></a>          else
<a name="l3137"><span class="linenum">3137</span></a>          { // current User is not logged in
<a name="l3138"><span class="linenum">3138</span></a>              if( <a class="var it3985" onMouseOver="hilite(3985)" onMouseOut="lolite()" onClick="logVariable('is_collection_owner')" href="../../../_variables/is_collection_owner.html">$is_collection_owner</a> || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('accepts_email')" href="../../../_functions/accepts_email.html" onMouseOver="funcPopup(event,'accepts_email')">accepts_email</a>() )
<a name="l3139"><span class="linenum">3139</span></a>              { // This User allows email =&gt; send email OR Force to allow to contact with this user because he is owner of the selected collection:
<a name="l3140"><span class="linenum">3140</span></a>                  return 'email';
<a name="l3141"><span class="linenum">3141</span></a>              }
<a name="l3142"><span class="linenum">3142</span></a>  
<a name="l3143"><span class="linenum">3143</span></a>              if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('accepts_pm')" href="../../../_functions/accepts_pm.html" onMouseOver="funcPopup(event,'accepts_pm')">accepts_pm</a>() )
<a name="l3144"><span class="linenum">3144</span></a>              { // no email option - try to log in and send private <a class="function" onClick="logFunction('message')" href="../../../_functions/message.html" onMouseOver="funcPopup(event,'message')">message</a> (only registered users can send PM)
<a name="l3145"><span class="linenum">3145</span></a>                  return 'login';
<a name="l3146"><span class="linenum">3146</span></a>              }
<a name="l3147"><span class="linenum">3147</span></a>          }
<a name="l3148"><span class="linenum">3148</span></a>  <span class="comment">        // no messaging option between current_User and this user</span>
<a name="l3149"><span class="linenum">3149</span></a>          return NULL;
<a name="l3150"><span class="linenum">3150</span></a>      }
<a name="l3151"><span class="linenum">3151</span></a>  
<a name="l3152"><span class="linenum">3152</span></a>  
<a name="l3153"><span class="linenum">3153</span></a>      <span class="comment">/**</span>
<a name="l3154"><span class="linenum">3154</span></a>  <span class="comment">     * Get the reason why current User is not able to make a contact with this User</span>
<a name="l3155"><span class="linenum">3155</span></a>  <span class="comment">     *</span>
<a name="l3156"><span class="linenum">3156</span></a>  <span class="comment">     * This is used when get_msgform_possibility returns NULL;</span>
<a name="l3157"><span class="linenum">3157</span></a>  <span class="comment">     *</span>
<a name="l3158"><span class="linenum">3158</span></a>  <span class="comment">     * @return string</span>
<a name="l3159"><span class="linenum">3159</span></a>  <span class="comment">     */</span>
<a name="l3160"><span class="linenum">3160</span></a>  	function <a class="function" onClick="logFunction('get_no_msgform_reason')" href="../../../_functions/get_no_msgform_reason.html" onMouseOver="funcPopup(event,'get_no_msgform_reason')">get_no_msgform_reason</a>()
<a name="l3161"><span class="linenum">3161</span></a>      {
<a name="l3162"><span class="linenum">3162</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l3163"><span class="linenum">3163</span></a>  
<a name="l3164"><span class="linenum">3164</span></a>          if( ( <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('accepts_pm')" href="../../../_functions/accepts_pm.html" onMouseOver="funcPopup(event,'accepts_pm')">accepts_pm</a>() )
<a name="l3165"><span class="linenum">3165</span></a>          {
<a name="l3166"><span class="linenum">3166</span></a>              if( <a class="function" onClick="logFunction('has_cross_country_restriction')" href="../../../_functions/has_cross_country_restriction.html" onMouseOver="funcPopup(event,'has_cross_country_restriction')">has_cross_country_restriction</a>( 'contact' ) &amp;&amp; ( empty( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> ) || ( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> !== <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ctry_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ctry_ID.html">ctry_ID</a> ) ) )
<a name="l3167"><span class="linenum">3167</span></a>              { // Contat to this user is not enabled
<a name="l3168"><span class="linenum">3168</span></a>                  return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'You are not allowed to contact with this user.' );
<a name="l3169"><span class="linenum">3169</span></a>              }
<a name="l3170"><span class="linenum">3170</span></a>              if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('accepts_pm')" href="../../../_functions/accepts_pm.html" onMouseOver="funcPopup(event,'accepts_pm')">accepts_pm</a>() )
<a name="l3171"><span class="linenum">3171</span></a>              { // current User accepts private messages
<a name="l3172"><span class="linenum">3172</span></a>                  if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l3173"><span class="linenum">3173</span></a>                  { // current User and recipient user are the same
<a name="l3174"><span class="linenum">3174</span></a>                      return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'You cannot send a private message to yourself.' );
<a name="l3175"><span class="linenum">3175</span></a>                  }
<a name="l3176"><span class="linenum">3176</span></a>  <span class="comment">                // current User is not able to contact with this User because User has blocked current User or current User is not in this users contact list</span>
<a name="l3177"><span class="linenum">3177</span></a>                  return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'This user can only be contacted through private messages, but you are not allowed to send private message to this user.' );
<a name="l3178"><span class="linenum">3178</span></a>              }
<a name="l3179"><span class="linenum">3179</span></a>  <span class="comment">            // current User has no messaging permission or has disabled private messages in user preferences</span>
<a name="l3180"><span class="linenum">3180</span></a>              return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'This user can only be contacted through private messages but you are not allowed to send any private messages.' );
<a name="l3181"><span class="linenum">3181</span></a>          }
<a name="l3182"><span class="linenum">3182</span></a>  <span class="comment">        // current User is not logged in or this User doesn't want to be contacted</span>
<a name="l3183"><span class="linenum">3183</span></a>          return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'This user does not wish to be contacted directly.' );
<a name="l3184"><span class="linenum">3184</span></a>      }
<a name="l3185"><span class="linenum">3185</span></a>  
<a name="l3186"><span class="linenum">3186</span></a>  
<a name="l3187"><span class="linenum">3187</span></a>      <span class="comment">/**</span>
<a name="l3188"><span class="linenum">3188</span></a>  <span class="comment">     * Insert object into DB based on previously recorded changes</span>
<a name="l3189"><span class="linenum">3189</span></a>  <span class="comment">     *</span>
<a name="l3190"><span class="linenum">3190</span></a>  <span class="comment">     * Triggers the plugin event AfterUserInsert.</span>
<a name="l3191"><span class="linenum">3191</span></a>  <span class="comment">     *</span>
<a name="l3192"><span class="linenum">3192</span></a>  <span class="comment">     * @param boolean TRUE to automatically create new blog if group has permission</span>
<a name="l3193"><span class="linenum">3193</span></a>  <span class="comment">     * @return boolean true on success</span>
<a name="l3194"><span class="linenum">3194</span></a>  <span class="comment">     */</span>
<a name="l3195"><span class="linenum">3195</span></a>  	function <a class="function" onClick="logFunction('dbinsert')" href="../../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>( <a class="var it3987" onMouseOver="hilite(3987)" onMouseOut="lolite()" onClick="logVariable('create_auto_blog')" href="../../../_variables/create_auto_blog.html">$create_auto_blog</a> = true )
<a name="l3196"><span class="linenum">3196</span></a>      {
<a name="l3197"><span class="linenum">3197</span></a>          global <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l3198"><span class="linenum">3198</span></a>  
<a name="l3199"><span class="linenum">3199</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l3200"><span class="linenum">3200</span></a>  
<a name="l3201"><span class="linenum">3201</span></a>          if( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = parent::<a class="function" onClick="logFunction('dbinsert')" href="../../../_functions/dbinsert.html" onMouseOver="funcPopup(event,'dbinsert')">dbinsert</a>() )
<a name="l3202"><span class="linenum">3202</span></a>          { // We could insert the user object..
<a name="l3203"><span class="linenum">3203</span></a>  
<a name="l3204"><span class="linenum">3204</span></a>  <span class="comment">            // Add new fields:</span>
<a name="l3205"><span class="linenum">3205</span></a>              if( !empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('new_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/new_fields.html">new_fields</a>) )
<a name="l3206"><span class="linenum">3206</span></a>              {
<a name="l3207"><span class="linenum">3207</span></a>                  <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_users__fields( uf_user_ID, uf_ufdf_ID, uf_varchar )
<a name="l3208"><span class="linenum">3208</span></a>                                  VALUES ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( '), ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', ', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('new_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/new_fields.html">new_fields</a> ).' )';
<a name="l3209"><span class="linenum">3209</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert new fields' );
<a name="l3210"><span class="linenum">3210</span></a>  <span class="comment">                // Reset new fields in object:</span>
<a name="l3211"><span class="linenum">3211</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('new_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/new_fields.html">new_fields</a> = array();
<a name="l3212"><span class="linenum">3212</span></a>              }
<a name="l3213"><span class="linenum">3213</span></a>  
<a name="l3214"><span class="linenum">3214</span></a>  <span class="comment">            // Notify plugins:</span>
<a name="l3215"><span class="linenum">3215</span></a>  <span class="comment">            // A user could be created also in another DB (to synchronize it with b2evo)</span>
<a name="l3216"><span class="linenum">3216</span></a>              <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('trigger_event')" href="../../../_functions/trigger_event.html" onMouseOver="funcPopup(event,'trigger_event')">trigger_event</a>( 'AfterUserInsert', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array( 'User' =&gt; &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> ) );
<a name="l3217"><span class="linenum">3217</span></a>  
<a name="l3218"><span class="linenum">3218</span></a>              <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a> = &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group();
<a name="l3219"><span class="linenum">3219</span></a>              if( <a class="var it3987" onMouseOver="hilite(3987)" onMouseOut="lolite()" onClick="logVariable('create_auto_blog')" href="../../../_variables/create_auto_blog.html">$create_auto_blog</a> &amp;&amp; <a class="var it961" onMouseOver="hilite(961)" onMouseOut="lolite()" onClick="logVariable('Group')" href="../../../_variables/Group.html">$Group</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_getblog', 'allowed' ) )
<a name="l3220"><span class="linenum">3220</span></a>              { // automatically create <span class="keyword">new </span><a class="class" onClick="logClass('blog')" href="../../../_classes/blog.html" onMouseOver="classPopup(event,'blog')">blog</a> for this user
<a name="l3221"><span class="linenum">3221</span></a>  <span class="comment">                // TODO: sam2kb&gt; Create a blog only when this user is validated!</span>
<a name="l3222"><span class="linenum">3222</span></a>                  <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Blog')" href="../../../_classes/blog.html" onMouseOver="classPopup(event,'blog')">Blog</a>( NULL );
<a name="l3223"><span class="linenum">3223</span></a>                  <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'login' );
<a name="l3224"><span class="linenum">3224</span></a>                  <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'owner_user_ID', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3225"><span class="linenum">3225</span></a>                  <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'shortname', <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a> );
<a name="l3226"><span class="linenum">3226</span></a>                  <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'name', <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a>.'\'s blog' );
<a name="l3227"><span class="linenum">3227</span></a>                  <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'locale', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'locale' ));
<a name="l3228"><span class="linenum">3228</span></a>                  <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'urlname', <a class="function" onClick="logFunction('urltitle_validate')" href="../../../_functions/urltitle_validate.html" onMouseOver="funcPopup(event,'urltitle_validate')">urltitle_validate</a>( <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a>, <a class="var it481" onMouseOver="hilite(481)" onMouseOut="lolite()" onClick="logVariable('shortname')" href="../../../_variables/shortname.html">$shortname</a>, <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>-&gt;<a onClick="logVariable('ID')" class="var it10941" onMouseOver="hilite(10941)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, false, 'blog_urlname', 'blog_ID', 'T_blogs', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'locale' ) ) );
<a name="l3229"><span class="linenum">3229</span></a>  
<a name="l3230"><span class="linenum">3230</span></a>  <span class="comment">                // Defines blog settings by its kind.</span>
<a name="l3231"><span class="linenum">3231</span></a>                  <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('trigger_event')" href="../../../_functions/trigger_event.html" onMouseOver="funcPopup(event,'trigger_event')">trigger_event</a>( 'InitCollectionKinds', array(
<a name="l3232"><span class="linenum">3232</span></a>                                  'Blog' =&gt; &amp; <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>,
<a name="l3233"><span class="linenum">3233</span></a>                                  'kind' =&gt; 'std',
<a name="l3234"><span class="linenum">3234</span></a>                              ) );
<a name="l3235"><span class="linenum">3235</span></a>  
<a name="l3236"><span class="linenum">3236</span></a>                  <a class="var it3988" onMouseOver="hilite(3988)" onMouseOut="lolite()" onClick="logVariable('new_Blog')" href="../../../_variables/new_Blog.html">$new_Blog</a>-&gt;<a class="function" onClick="logFunction('create')" href="../../../_functions/create.html" onMouseOver="funcPopup(event,'create')">create</a>();
<a name="l3237"><span class="linenum">3237</span></a>              }
<a name="l3238"><span class="linenum">3238</span></a>  
<a name="l3239"><span class="linenum">3239</span></a>  <span class="comment">            // Save IP Range and user counter</span>
<a name="l3240"><span class="linenum">3240</span></a>              <a class="function" onClick="logFunction('antispam_increase_counter')" href="../../../_functions/antispam_increase_counter.html" onMouseOver="funcPopup(event,'antispam_increase_counter')">antispam_increase_counter</a>( 'user' );
<a name="l3241"><span class="linenum">3241</span></a>          }
<a name="l3242"><span class="linenum">3242</span></a>  
<a name="l3243"><span class="linenum">3243</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l3244"><span class="linenum">3244</span></a>  
<a name="l3245"><span class="linenum">3245</span></a>          return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l3246"><span class="linenum">3246</span></a>      }
<a name="l3247"><span class="linenum">3247</span></a>  
<a name="l3248"><span class="linenum">3248</span></a>  
<a name="l3249"><span class="linenum">3249</span></a>      <span class="comment">/**</span>
<a name="l3250"><span class="linenum">3250</span></a>  <span class="comment">     * Update the DB based on previously recorded changes.</span>
<a name="l3251"><span class="linenum">3251</span></a>  <span class="comment">     *</span>
<a name="l3252"><span class="linenum">3252</span></a>  <span class="comment">     * Triggers the plugin event AfterUserUpdate.</span>
<a name="l3253"><span class="linenum">3253</span></a>  <span class="comment">     */</span>
<a name="l3254"><span class="linenum">3254</span></a>  	function <a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>()
<a name="l3255"><span class="linenum">3255</span></a>      {
<a name="l3256"><span class="linenum">3256</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l3257"><span class="linenum">3257</span></a>  
<a name="l3258"><span class="linenum">3258</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l3259"><span class="linenum">3259</span></a>  
<a name="l3260"><span class="linenum">3260</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = parent::<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l3261"><span class="linenum">3261</span></a>  
<a name="l3262"><span class="linenum">3262</span></a>  <span class="comment">        // Update existing fields:</span>
<a name="l3263"><span class="linenum">3263</span></a>          if( !empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('updated_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/updated_fields.html">updated_fields</a>) )
<a name="l3264"><span class="linenum">3264</span></a>          {
<a name="l3265"><span class="linenum">3265</span></a>              foreach( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('updated_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/updated_fields.html">updated_fields</a> as <a class="var it3329" onMouseOver="hilite(3329)" onMouseOut="lolite()" onClick="logVariable('uf_ID')" href="../../../_variables/uf_ID.html">$uf_ID</a> =&gt; <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> )
<a name="l3266"><span class="linenum">3266</span></a>              {
<a name="l3267"><span class="linenum">3267</span></a>  <span class="comment">                // Note the updated_fields key values must be integers, so don't need casting or DB-&gt;quote()</span>
<a name="l3268"><span class="linenum">3268</span></a>                  if( empty( <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> ) )
<a name="l3269"><span class="linenum">3269</span></a>                  {    // Delete field:
<a name="l3270"><span class="linenum">3270</span></a>                      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_users__fields
<a name="l3271"><span class="linenum">3271</span></a>                                                           WHERE uf_ID = '.<a class="var it3329" onMouseOver="hilite(3329)" onMouseOut="lolite()" onClick="logVariable('uf_ID')" href="../../../_variables/uf_ID.html">$uf_ID</a> );
<a name="l3272"><span class="linenum">3272</span></a>                  }
<a name="l3273"><span class="linenum">3273</span></a>                  else
<a name="l3274"><span class="linenum">3274</span></a>                  {    // Update field:
<a name="l3275"><span class="linenum">3275</span></a>                      <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_users__fields
<a name="l3276"><span class="linenum">3276</span></a>                                                      SET uf_varchar = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3328" onMouseOver="hilite(3328)" onMouseOut="lolite()" onClick="logVariable('uf_val')" href="../../../_variables/uf_val.html">$uf_val</a> ).'
<a name="l3277"><span class="linenum">3277</span></a>                                                  WHERE uf_ID = '.<a class="var it3329" onMouseOver="hilite(3329)" onMouseOut="lolite()" onClick="logVariable('uf_ID')" href="../../../_variables/uf_ID.html">$uf_ID</a> );
<a name="l3278"><span class="linenum">3278</span></a>                  }
<a name="l3279"><span class="linenum">3279</span></a>              }
<a name="l3280"><span class="linenum">3280</span></a>  <span class="comment">            // Reset updated fields in object:</span>
<a name="l3281"><span class="linenum">3281</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('updated_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/updated_fields.html">updated_fields</a> = array();
<a name="l3282"><span class="linenum">3282</span></a>          }
<a name="l3283"><span class="linenum">3283</span></a>  
<a name="l3284"><span class="linenum">3284</span></a>  <span class="comment">        // Add new fields:</span>
<a name="l3285"><span class="linenum">3285</span></a>          if( !empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('new_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/new_fields.html">new_fields</a>) )
<a name="l3286"><span class="linenum">3286</span></a>          {
<a name="l3287"><span class="linenum">3287</span></a>              <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = 'INSERT INTO T_users__fields( uf_user_ID, uf_ufdf_ID, uf_varchar )
<a name="l3288"><span class="linenum">3288</span></a>                              VALUES ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( '), ('.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', ', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('new_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/new_fields.html">new_fields</a> ).' )';
<a name="l3289"><span class="linenum">3289</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, 'Insert new fields' );
<a name="l3290"><span class="linenum">3290</span></a>  <span class="comment">            // Reset new fields in object:</span>
<a name="l3291"><span class="linenum">3291</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('new_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/new_fields.html">new_fields</a> = array();
<a name="l3292"><span class="linenum">3292</span></a>          }
<a name="l3293"><span class="linenum">3293</span></a>  
<a name="l3294"><span class="linenum">3294</span></a>  <span class="comment">        // Notify plugins:</span>
<a name="l3295"><span class="linenum">3295</span></a>  <span class="comment">        // Example: An authentication plugin could synchronize/update the password of the user.</span>
<a name="l3296"><span class="linenum">3296</span></a>          <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('trigger_event')" href="../../../_functions/trigger_event.html" onMouseOver="funcPopup(event,'trigger_event')">trigger_event</a>( 'AfterUserUpdate', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array( 'User' =&gt; &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> ) );
<a name="l3297"><span class="linenum">3297</span></a>  
<a name="l3298"><span class="linenum">3298</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l3299"><span class="linenum">3299</span></a>  
<a name="l3300"><span class="linenum">3300</span></a>  <span class="comment">        // BLOCK CACHE INVALIDATION:</span>
<a name="l3301"><span class="linenum">3301</span></a>  <span class="comment">        // This User has been modified, cached content depending on it should be invalidated:</span>
<a name="l3302"><span class="linenum">3302</span></a>          <a class="class" onClick="logClass('BlockCache')" href="../../../_classes/blockcache.html" onMouseOver="classPopup(event,'blockcache')">BlockCache</a>::<a class="function" onClick="logFunction('invalidate_key')" href="../../../_functions/invalidate_key.html" onMouseOver="funcPopup(event,'invalidate_key')">invalidate_key</a>( 'user_ID', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3303"><span class="linenum">3303</span></a>  
<a name="l3304"><span class="linenum">3304</span></a>          return true;
<a name="l3305"><span class="linenum">3305</span></a>      }
<a name="l3306"><span class="linenum">3306</span></a>  
<a name="l3307"><span class="linenum">3307</span></a>  
<a name="l3308"><span class="linenum">3308</span></a>      <span class="comment">/**</span>
<a name="l3309"><span class="linenum">3309</span></a>  <span class="comment">     * Delete those users from the database which corresponds to the given condition or to the given ids array</span>
<a name="l3310"><span class="linenum">3310</span></a>  <span class="comment">     * Note: the delete cascade arrays are handled!</span>
<a name="l3311"><span class="linenum">3311</span></a>  <span class="comment">     *</span>
<a name="l3312"><span class="linenum">3312</span></a>  <span class="comment">     * @param string the name of this class</span>
<a name="l3313"><span class="linenum">3313</span></a>  <span class="comment">     *   Note: This is required until min phpversion will be 5.3. Since PHP 5.3 we can use static::function_name to achieve late static bindings</span>
<a name="l3314"><span class="linenum">3314</span></a>  <span class="comment">     * @param string where condition</span>
<a name="l3315"><span class="linenum">3315</span></a>  <span class="comment">     * @param array object ids</span>
<a name="l3316"><span class="linenum">3316</span></a>  <span class="comment">     * @return mixed # of rows affected or false if error</span>
<a name="l3317"><span class="linenum">3317</span></a>  <span class="comment">     */</span>
<a name="l3318"><span class="linenum">3318</span></a>  	static function <a class="function" onClick="logFunction('db_delete_where')" href="../../../_functions/db_delete_where.html" onMouseOver="funcPopup(event,'db_delete_where')">db_delete_where</a>( <a class="var it2446" onMouseOver="hilite(2446)" onMouseOut="lolite()" onClick="logVariable('class_name')" href="../../../_variables/class_name.html">$class_name</a>, <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a>, <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> = NULL, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = NULL )
<a name="l3319"><span class="linenum">3319</span></a>      {
<a name="l3320"><span class="linenum">3320</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l3321"><span class="linenum">3321</span></a>  
<a name="l3322"><span class="linenum">3322</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l3323"><span class="linenum">3323</span></a>  
<a name="l3324"><span class="linenum">3324</span></a>          if( ! empty( <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a> ) )
<a name="l3325"><span class="linenum">3325</span></a>          {
<a name="l3326"><span class="linenum">3326</span></a>              <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( 'SELECT user_ID FROM T_users WHERE '.<a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a> );
<a name="l3327"><span class="linenum">3327</span></a>          }
<a name="l3328"><span class="linenum">3328</span></a>  
<a name="l3329"><span class="linenum">3329</span></a>          if( ! <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> )
<a name="l3330"><span class="linenum">3330</span></a>          { // There is no user to delete
<a name="l3331"><span class="linenum">3331</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l3332"><span class="linenum">3332</span></a>              return;
<a name="l3333"><span class="linenum">3333</span></a>          }
<a name="l3334"><span class="linenum">3334</span></a>  
<a name="l3335"><span class="linenum">3335</span></a>  <span class="comment">        // Delete orphan threads per users</span>
<a name="l3336"><span class="linenum">3336</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="function" onClick="logFunction('delete_orphan_threads')" href="../../../_functions/delete_orphan_threads.html" onMouseOver="funcPopup(event,'delete_orphan_threads')">delete_orphan_threads</a>( <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> );
<a name="l3337"><span class="linenum">3337</span></a>  
<a name="l3338"><span class="linenum">3338</span></a>  <span class="comment">        // Remove deleted user(s) from posts where it was as last edit user</span>
<a name="l3339"><span class="linenum">3339</span></a>          <a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ',', <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> );
<a name="l3340"><span class="linenum">3340</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> &amp;&amp; ( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__item
<a name="l3341"><span class="linenum">3341</span></a>                                      SET post_lastedit_user_ID = NULL
<a name="l3342"><span class="linenum">3342</span></a>                                    WHERE post_lastedit_user_ID IN ( '.<a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a>.' )' ) !== false );
<a name="l3343"><span class="linenum">3343</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> &amp;&amp; ( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_items__version
<a name="l3344"><span class="linenum">3344</span></a>                                      SET iver_edit_user_ID = NULL
<a name="l3345"><span class="linenum">3345</span></a>                                    WHERE iver_edit_user_ID IN ( '.<a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a>.' )' ) !== false );
<a name="l3346"><span class="linenum">3346</span></a>  
<a name="l3347"><span class="linenum">3347</span></a>  <span class="comment">        // Remove this user from links where it was as last edit user</span>
<a name="l3348"><span class="linenum">3348</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> &amp;&amp; ( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_links
<a name="l3349"><span class="linenum">3349</span></a>                                      SET link_lastedit_user_ID = NULL
<a name="l3350"><span class="linenum">3350</span></a>                                    WHERE link_lastedit_user_ID IN ( '.<a class="var it3293" onMouseOver="hilite(3293)" onMouseOut="lolite()" onClick="logVariable('user_ids')" href="../../../_variables/user_ids.html">$user_ids</a>.' )' ) !== false );
<a name="l3351"><span class="linenum">3351</span></a>  
<a name="l3352"><span class="linenum">3352</span></a>          if( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> )
<a name="l3353"><span class="linenum">3353</span></a>          { // Delete the <a class="function" onClick="logFunction('user')" href="../../../_functions/user.html" onMouseOver="funcPopup(event,'user')">user</a>(s) with all of the cascade objects
<a name="l3354"><span class="linenum">3354</span></a>              <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['use_transaction'] = false; <span class="comment">// no need to start a new transaction</span>
<a name="l3355"><span class="linenum">3355</span></a>              <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = parent::<a class="function" onClick="logFunction('db_delete_where')" href="../../../_functions/db_delete_where.html" onMouseOver="funcPopup(event,'db_delete_where')">db_delete_where</a>( <a class="var it2446" onMouseOver="hilite(2446)" onMouseOut="lolite()" onClick="logVariable('class_name')" href="../../../_variables/class_name.html">$class_name</a>, <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a>, <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l3356"><span class="linenum">3356</span></a>          }
<a name="l3357"><span class="linenum">3357</span></a>  
<a name="l3358"><span class="linenum">3358</span></a>          if( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> !== false )
<a name="l3359"><span class="linenum">3359</span></a>          { // delete the users' media folders recursively, for all deleted users
<a name="l3360"><span class="linenum">3360</span></a>              <a class="var it581" onMouseOver="hilite(581)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../../_variables/FileRootCache.html">$FileRootCache</a> = &amp; get_FileRootCache();
<a name="l3361"><span class="linenum">3361</span></a>              foreach( <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> as <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l3362"><span class="linenum">3362</span></a>              {
<a name="l3363"><span class="linenum">3363</span></a>                  if( <a class="var it3989" onMouseOver="hilite(3989)" onMouseOut="lolite()" onClick="logVariable('root_directory')" href="../../../_variables/root_directory.html">$root_directory</a> = <a class="var it581" onMouseOver="hilite(581)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../../_variables/FileRootCache.html">$FileRootCache</a>-&gt;<a class="function" onClick="logFunction('get_root_dir')" href="../../../_functions/get_root_dir.html" onMouseOver="funcPopup(event,'get_root_dir')">get_root_dir</a>( 'user', <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) )
<a name="l3364"><span class="linenum">3364</span></a>                  { // Delete the folder only when it is detected:
<a name="l3365"><span class="linenum">3365</span></a>                      <a class="function" onClick="logFunction('rmdir_r')" href="../../../_functions/rmdir_r.html" onMouseOver="funcPopup(event,'rmdir_r')">rmdir_r</a>( <a class="var it3989" onMouseOver="hilite(3989)" onMouseOut="lolite()" onClick="logVariable('root_directory')" href="../../../_variables/root_directory.html">$root_directory</a> );
<a name="l3366"><span class="linenum">3366</span></a>                  }
<a name="l3367"><span class="linenum">3367</span></a>              }
<a name="l3368"><span class="linenum">3368</span></a>          }
<a name="l3369"><span class="linenum">3369</span></a>  
<a name="l3370"><span class="linenum">3370</span></a>          ( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> !== false ) ? <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>() : <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l3371"><span class="linenum">3371</span></a>  
<a name="l3372"><span class="linenum">3372</span></a>          return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l3373"><span class="linenum">3373</span></a>      }
<a name="l3374"><span class="linenum">3374</span></a>  
<a name="l3375"><span class="linenum">3375</span></a>  
<a name="l3376"><span class="linenum">3376</span></a>      <span class="comment">/**</span>
<a name="l3377"><span class="linenum">3377</span></a>  <span class="comment">     * Delete user and dependencies from database</span>
<a name="l3378"><span class="linenum">3378</span></a>  <span class="comment">     *</span>
<a name="l3379"><span class="linenum">3379</span></a>  <span class="comment">     * Includes WAY TOO MANY requests because we try to be compatible with MySQL 3.23, bleh!</span>
<a name="l3380"><span class="linenum">3380</span></a>  <span class="comment">     *</span>
<a name="l3381"><span class="linenum">3381</span></a>  <span class="comment">     * @param Log Log object where output gets added (by reference).</span>
<a name="l3382"><span class="linenum">3382</span></a>  <span class="comment">     */</span>
<a name="l3383"><span class="linenum">3383</span></a>  	function <a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>( &amp; <a class="var it2839" onMouseOver="hilite(2839)" onMouseOut="lolite()" onClick="logVariable('Log')" href="../../../_variables/Log.html">$Log</a> )
<a name="l3384"><span class="linenum">3384</span></a>      {
<a name="l3385"><span class="linenum">3385</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>;
<a name="l3386"><span class="linenum">3386</span></a>  
<a name="l3387"><span class="linenum">3387</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == 0 ) <a class="function" onClick="logFunction('debug_die')" href="../../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( 'Non persistant object cannot be deleted!' );
<a name="l3388"><span class="linenum">3388</span></a>  
<a name="l3389"><span class="linenum">3389</span></a>          <a class="var it3990" onMouseOver="hilite(3990)" onMouseOut="lolite()" onClick="logVariable('deltype')" href="../../../_variables/deltype.html">$deltype</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'deltype', 'string', '' ); <span class="comment">// spammer</span>
<a name="l3390"><span class="linenum">3390</span></a>  
<a name="l3391"><span class="linenum">3391</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l3392"><span class="linenum">3392</span></a>  
<a name="l3393"><span class="linenum">3393</span></a>          if( <a class="var it3990" onMouseOver="hilite(3990)" onMouseOut="lolite()" onClick="logVariable('deltype')" href="../../../_variables/deltype.html">$deltype</a> == 'spammer' )
<a name="l3394"><span class="linenum">3394</span></a>          { // If we delete user as spammer we should delete private messaged of this user
<a name="l3395"><span class="linenum">3395</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('init_relations')" href="../../../_functions/init_relations.html" onMouseOver="funcPopup(event,'init_relations')">init_relations</a>( true );
<a name="l3396"><span class="linenum">3396</span></a>          }
<a name="l3397"><span class="linenum">3397</span></a>          else
<a name="l3398"><span class="linenum">3398</span></a>          { // If we delete user as not spammer we keep his comments as from anonymous user
<a name="l3399"><span class="linenum">3399</span></a>  <span class="comment">            // Transform registered user comments to unregistered:</span>
<a name="l3400"><span class="linenum">3400</span></a>              <a class="var it1033" onMouseOver="hilite(1033)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../../_variables/ret.html">$ret</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'UPDATE T_comments
<a name="l3401"><span class="linenum">3401</span></a>                                                      SET comment_author_user_ID = NULL,
<a name="l3402"><span class="linenum">3402</span></a>                                                              comment_author = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('preferredname') ).',
<a name="l3403"><span class="linenum">3403</span></a>                                                              comment_author_email = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('email') ).',
<a name="l3404"><span class="linenum">3404</span></a>                                                              comment_author_url = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('url') ).'
<a name="l3405"><span class="linenum">3405</span></a>                                                      WHERE comment_author_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3406"><span class="linenum">3406</span></a>              if( <a class="phpfunction" onClick="logFunction('is_a')" href="../../../_functions/is_a.html" onMouseOver="phpfuncPopup(event,'is_a')">is_a</a>( <a class="var it2839" onMouseOver="hilite(2839)" onMouseOut="lolite()" onClick="logVariable('Log')" href="../../../_variables/Log.html">$Log</a>, 'log' ) )
<a name="l3407"><span class="linenum">3407</span></a>              {
<a name="l3408"><span class="linenum">3408</span></a>                  <a class="var it2839" onMouseOver="hilite(2839)" onMouseOut="lolite()" onClick="logVariable('Log')" href="../../../_variables/Log.html">$Log</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Transforming user\'s comments to unregistered comments... '.sprintf( '(%d rows)', <a class="var it1033" onMouseOver="hilite(1033)" onMouseOut="lolite()" onClick="logVariable('ret')" href="../../../_variables/ret.html">$ret</a> ), 'note' );
<a name="l3409"><span class="linenum">3409</span></a>              }
<a name="l3410"><span class="linenum">3410</span></a>          }
<a name="l3411"><span class="linenum">3411</span></a>  
<a name="l3412"><span class="linenum">3412</span></a>  <span class="comment">        // remember ID, because parent method resets it to 0</span>
<a name="l3413"><span class="linenum">3413</span></a>          <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('old_ID')" href="../../../_variables/old_ID.html">$old_ID</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l3414"><span class="linenum">3414</span></a>          <a class="var it3991" onMouseOver="hilite(3991)" onMouseOut="lolite()" onClick="logVariable('old_email')" href="../../../_variables/old_email.html">$old_email</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'email' );
<a name="l3415"><span class="linenum">3415</span></a>  
<a name="l3416"><span class="linenum">3416</span></a>  <span class="comment">        // Delete main object:</span>
<a name="l3417"><span class="linenum">3417</span></a>          if( ! parent::<a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>() )
<a name="l3418"><span class="linenum">3418</span></a>          {
<a name="l3419"><span class="linenum">3419</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l3420"><span class="linenum">3420</span></a>  
<a name="l3421"><span class="linenum">3421</span></a>              <a class="var it2839" onMouseOver="hilite(2839)" onMouseOut="lolite()" onClick="logVariable('Log')" href="../../../_variables/Log.html">$Log</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'User has not been deleted.', 'error' );
<a name="l3422"><span class="linenum">3422</span></a>              return false;
<a name="l3423"><span class="linenum">3423</span></a>          }
<a name="l3424"><span class="linenum">3424</span></a>  
<a name="l3425"><span class="linenum">3425</span></a>          if( <a class="var it3990" onMouseOver="hilite(3990)" onMouseOut="lolite()" onClick="logVariable('deltype')" href="../../../_variables/deltype.html">$deltype</a> == 'spammer' )
<a name="l3426"><span class="linenum">3426</span></a>          { // User was deleted as spammer, we should mark email of this user as 'Spammer'
<a name="l3427"><span class="linenum">3427</span></a>              <a class="var it430" onMouseOver="hilite(430)" onMouseOut="lolite()" onClick="logVariable('EmailAddressCache')" href="../../../_variables/EmailAddressCache.html">$EmailAddressCache</a> = &amp; get_EmailAddressCache();
<a name="l3428"><span class="linenum">3428</span></a>              <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> = &amp; <a class="var it430" onMouseOver="hilite(430)" onMouseOut="lolite()" onClick="logVariable('EmailAddressCache')" href="../../../_variables/EmailAddressCache.html">$EmailAddressCache</a>-&gt;get_by_name( <a class="var it3991" onMouseOver="hilite(3991)" onMouseOut="lolite()" onClick="logVariable('old_email')" href="../../../_variables/old_email.html">$old_email</a>, false, false );
<a name="l3429"><span class="linenum">3429</span></a>              if( !<a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> )
<a name="l3430"><span class="linenum">3430</span></a>              {    // Create new record in the T_email_address table
<a name="l3431"><span class="linenum">3431</span></a>                  <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> = <span class="keyword">new </span><a class="class" onClick="logClass('EmailAddress')" href="../../../_classes/emailaddress.html" onMouseOver="classPopup(event,'emailaddress')">EmailAddress</a>();
<a name="l3432"><span class="linenum">3432</span></a>                  <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'address', <a class="var it3991" onMouseOver="hilite(3991)" onMouseOut="lolite()" onClick="logVariable('old_email')" href="../../../_variables/old_email.html">$old_email</a> );
<a name="l3433"><span class="linenum">3433</span></a>              }
<a name="l3434"><span class="linenum">3434</span></a>              if( !empty( <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> ) )
<a name="l3435"><span class="linenum">3435</span></a>              { // Save status of an email address
<a name="l3436"><span class="linenum">3436</span></a>                  <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', 'spammer' );
<a name="l3437"><span class="linenum">3437</span></a>                  <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>();
<a name="l3438"><span class="linenum">3438</span></a>              }
<a name="l3439"><span class="linenum">3439</span></a>          }
<a name="l3440"><span class="linenum">3440</span></a>  
<a name="l3441"><span class="linenum">3441</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l3442"><span class="linenum">3442</span></a>  
<a name="l3443"><span class="linenum">3443</span></a>          if( <a class="phpfunction" onClick="logFunction('is_a')" href="../../../_functions/is_a.html" onMouseOver="phpfuncPopup(event,'is_a')">is_a</a>( <a class="var it2839" onMouseOver="hilite(2839)" onMouseOut="lolite()" onClick="logVariable('Log')" href="../../../_variables/Log.html">$Log</a>, 'log' ) )
<a name="l3444"><span class="linenum">3444</span></a>          {
<a name="l3445"><span class="linenum">3445</span></a>              <a class="var it2839" onMouseOver="hilite(2839)" onMouseOut="lolite()" onClick="logVariable('Log')" href="../../../_variables/Log.html">$Log</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Deleted User.', 'note' );
<a name="l3446"><span class="linenum">3446</span></a>          }
<a name="l3447"><span class="linenum">3447</span></a>  
<a name="l3448"><span class="linenum">3448</span></a>  <span class="comment">        // Notify plugins:</span>
<a name="l3449"><span class="linenum">3449</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> = <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('old_ID')" href="../../../_variables/old_ID.html">$old_ID</a>;
<a name="l3450"><span class="linenum">3450</span></a>          <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('trigger_event')" href="../../../_functions/trigger_event.html" onMouseOver="funcPopup(event,'trigger_event')">trigger_event</a>( 'AfterUserDelete', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array( 'User' =&gt; &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> ) );
<a name="l3451"><span class="linenum">3451</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> = 0;
<a name="l3452"><span class="linenum">3452</span></a>  
<a name="l3453"><span class="linenum">3453</span></a>  <span class="comment">        // BLOCK CACHE INVALIDATION:</span>
<a name="l3454"><span class="linenum">3454</span></a>  <span class="comment">        // This User has been modified, cached content depending on it should be invalidated:</span>
<a name="l3455"><span class="linenum">3455</span></a>          <a class="class" onClick="logClass('BlockCache')" href="../../../_classes/blockcache.html" onMouseOver="classPopup(event,'blockcache')">BlockCache</a>::<a class="function" onClick="logFunction('invalidate_key')" href="../../../_functions/invalidate_key.html" onMouseOver="funcPopup(event,'invalidate_key')">invalidate_key</a>( 'user_ID', <a class="var it1677" onMouseOver="hilite(1677)" onMouseOut="lolite()" onClick="logVariable('old_ID')" href="../../../_variables/old_ID.html">$old_ID</a> );
<a name="l3456"><span class="linenum">3456</span></a>  
<a name="l3457"><span class="linenum">3457</span></a>          return true;
<a name="l3458"><span class="linenum">3458</span></a>      }
<a name="l3459"><span class="linenum">3459</span></a>  
<a name="l3460"><span class="linenum">3460</span></a>  
<a name="l3461"><span class="linenum">3461</span></a>      <span class="comment">/**</span>
<a name="l3462"><span class="linenum">3462</span></a>  <span class="comment">     * Send an email to the user with a link to validate/confirm his email address.</span>
<a name="l3463"><span class="linenum">3463</span></a>  <span class="comment">     *</span>
<a name="l3464"><span class="linenum">3464</span></a>  <span class="comment">     * If the email could get sent, it saves the used &quot;request_id&quot; into the user's Session.</span>
<a name="l3465"><span class="linenum">3465</span></a>  <span class="comment">     *</span>
<a name="l3466"><span class="linenum">3466</span></a>  <span class="comment">     * @param string URL, where to redirect the user after he clicked the validation link (gets saved in Session).</span>
<a name="l3467"><span class="linenum">3467</span></a>  <span class="comment">     * @return boolean True, if the email could get sent; false if not</span>
<a name="l3468"><span class="linenum">3468</span></a>  <span class="comment">     */</span>
<a name="l3469"><span class="linenum">3469</span></a>  	function <a class="function" onClick="logFunction('send_validate_email')" href="../../../_functions/send_validate_email.html" onMouseOver="funcPopup(event,'send_validate_email')">send_validate_email</a>( <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('redirect_to_after')" href="../../../_variables/redirect_to_after.html">$redirect_to_after</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('blog')" href="../../../_variables/blog.html">$blog</a> = NULL, <a class="var it3295" onMouseOver="hilite(3295)" onMouseOut="lolite()" onClick="logVariable('email_changed')" href="../../../_variables/email_changed.html">$email_changed</a> = false )
<a name="l3470"><span class="linenum">3470</span></a>      {
<a name="l3471"><span class="linenum">3471</span></a>          global <a class="var it1348" onMouseOver="hilite(1348)" onMouseOut="lolite()" onClick="logVariable('app_name')" href="../../../_variables/app_name.html">$app_name</a>, <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>, <a class="var it621" onMouseOver="hilite(621)" onMouseOut="lolite()" onClick="logVariable('secure_htsrv_url')" href="../../../_variables/secure_htsrv_url.html">$secure_htsrv_url</a>, <a class="var it461" onMouseOver="hilite(461)" onMouseOut="lolite()" onClick="logVariable('baseurl')" href="../../../_variables/baseurl.html">$baseurl</a>, <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l3472"><span class="linenum">3472</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>;
<a name="l3473"><span class="linenum">3473</span></a>  
<a name="l3474"><span class="linenum">3474</span></a>  <span class="comment">        // Display messages depending on user email status</span>
<a name="l3475"><span class="linenum">3475</span></a>          <a class="function" onClick="logFunction('display_user_email_status_message')" href="../../../_functions/display_user_email_status_message.html" onMouseOver="funcPopup(event,'display_user_email_status_message')">display_user_email_status_message</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3476"><span class="linenum">3476</span></a>  
<a name="l3477"><span class="linenum">3477</span></a>          if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'validation_process' ) == 'easy' )
<a name="l3478"><span class="linenum">3478</span></a>          { // validation process is set to easy, send and easy activation email
<a name="l3479"><span class="linenum">3479</span></a>              return <a class="function" onClick="logFunction('send_easy_validate_emails')" href="../../../_functions/send_easy_validate_emails.html" onMouseOver="funcPopup(event,'send_easy_validate_emails')">send_easy_validate_emails</a>( array( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ), false, <a class="var it3295" onMouseOver="hilite(3295)" onMouseOut="lolite()" onClick="logVariable('email_changed')" href="../../../_variables/email_changed.html">$email_changed</a> );
<a name="l3480"><span class="linenum">3480</span></a>          }
<a name="l3481"><span class="linenum">3481</span></a>  
<a name="l3482"><span class="linenum">3482</span></a>          if( <a class="function" onClick="logFunction('mail_is_blocked')" href="../../../_functions/mail_is_blocked.html" onMouseOver="funcPopup(event,'mail_is_blocked')">mail_is_blocked</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a> ) )
<a name="l3483"><span class="linenum">3483</span></a>          { // prevent trying to send an email to a blocked email address ( Note this is checked in the send_easy_validate_emails too )
<a name="l3484"><span class="linenum">3484</span></a>              return false;
<a name="l3485"><span class="linenum">3485</span></a>          }
<a name="l3486"><span class="linenum">3486</span></a>  
<a name="l3487"><span class="linenum">3487</span></a>          if( empty( <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('redirect_to_after')" href="../../../_variables/redirect_to_after.html">$redirect_to_after</a> ) )
<a name="l3488"><span class="linenum">3488</span></a>          { // redirect to was not set
<a name="l3489"><span class="linenum">3489</span></a>              <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('redirect_to_after')" href="../../../_variables/redirect_to_after.html">$redirect_to_after</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'redirect_to', 'url', '' );
<a name="l3490"><span class="linenum">3490</span></a>              if( empty( <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('redirect_to_after')" href="../../../_variables/redirect_to_after.html">$redirect_to_after</a> ) )
<a name="l3491"><span class="linenum">3491</span></a>              {
<a name="l3492"><span class="linenum">3492</span></a>                  if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l3493"><span class="linenum">3493</span></a>                  {
<a name="l3494"><span class="linenum">3494</span></a>                      <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('redirect_to_after')" href="../../../_variables/redirect_to_after.html">$redirect_to_after</a> = <a class="function" onClick="logFunction('regenerate_url')" href="../../../_functions/regenerate_url.html" onMouseOver="funcPopup(event,'regenerate_url')">regenerate_url</a>( 'action' );
<a name="l3495"><span class="linenum">3495</span></a>                  }
<a name="l3496"><span class="linenum">3496</span></a>                  else
<a name="l3497"><span class="linenum">3497</span></a>                  {
<a name="l3498"><span class="linenum">3498</span></a>                      <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('redirect_to_after')" href="../../../_variables/redirect_to_after.html">$redirect_to_after</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_userpage_url')" href="../../../_functions/get_userpage_url.html" onMouseOver="funcPopup(event,'get_userpage_url')">get_userpage_url</a>();
<a name="l3499"><span class="linenum">3499</span></a>                  }
<a name="l3500"><span class="linenum">3500</span></a>              }
<a name="l3501"><span class="linenum">3501</span></a>          }
<a name="l3502"><span class="linenum">3502</span></a>  
<a name="l3503"><span class="linenum">3503</span></a>          <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('request_id')" href="../../../_variables/request_id.html">$request_id</a> = <a class="function" onClick="logFunction('generate_random_key')" href="../../../_functions/generate_random_key.html" onMouseOver="funcPopup(event,'generate_random_key')">generate_random_key</a>(22);
<a name="l3504"><span class="linenum">3504</span></a>  
<a name="l3505"><span class="linenum">3505</span></a>          <a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('blog_param')" href="../../../_variables/blog_param.html">$blog_param</a> = ( empty( <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('blog')" href="../../../_variables/blog.html">$blog</a> ) ) ? '' : '&amp;inskin=1&amp;blog='.<a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('blog')" href="../../../_variables/blog.html">$blog</a>;
<a name="l3506"><span class="linenum">3506</span></a>  
<a name="l3507"><span class="linenum">3507</span></a>  <span class="comment">        // Change locale here to localize the email subject and content</span>
<a name="l3508"><span class="linenum">3508</span></a>          <a class="function" onClick="logFunction('locale_temp_switch')" href="../../../_functions/locale_temp_switch.html" onMouseOver="funcPopup(event,'locale_temp_switch')">locale_temp_switch</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'locale' ) );
<a name="l3509"><span class="linenum">3509</span></a>          <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> = array(
<a name="l3510"><span class="linenum">3510</span></a>                  'status'     =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('status')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/status.html">status</a>,
<a name="l3511"><span class="linenum">3511</span></a>                  'blog_param' =&gt; <a class="var it476" onMouseOver="hilite(476)" onMouseOut="lolite()" onClick="logVariable('blog_param')" href="../../../_variables/blog_param.html">$blog_param</a>,
<a name="l3512"><span class="linenum">3512</span></a>                  'request_id' =&gt; <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('request_id')" href="../../../_variables/request_id.html">$request_id</a>,
<a name="l3513"><span class="linenum">3513</span></a>              );
<a name="l3514"><span class="linenum">3514</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="function" onClick="logFunction('send_mail_to_User')" href="../../../_functions/send_mail_to_user.html" onMouseOver="funcPopup(event,'send_mail_to_user')">send_mail_to_User</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Activate your account: <a class="var it179" onMouseOver="hilite(179)" onMouseOut="lolite()" onClick="logVariable('login')" href="../../../_variables/login.html">$login</a>$'), 'account_activate', <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a>, true );
<a name="l3515"><span class="linenum">3515</span></a>          <a class="function" onClick="logFunction('locale_restore_previous')" href="../../../_functions/locale_restore_previous.html" onMouseOver="funcPopup(event,'locale_restore_previous')">locale_restore_previous</a>();
<a name="l3516"><span class="linenum">3516</span></a>  
<a name="l3517"><span class="linenum">3517</span></a>          if( <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> )
<a name="l3518"><span class="linenum">3518</span></a>          { // save request_id into Session
<a name="l3519"><span class="linenum">3519</span></a>              <a class="var it3994" onMouseOver="hilite(3994)" onMouseOut="lolite()" onClick="logVariable('request_ids')" href="../../../_variables/request_ids.html">$request_ids</a> = <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'core.validatemail.request_ids' );
<a name="l3520"><span class="linenum">3520</span></a>              if( ( ! <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it3994" onMouseOver="hilite(3994)" onMouseOut="lolite()" onClick="logVariable('request_ids')" href="../../../_variables/request_ids.html">$request_ids</a>) ) || <a class="var it3295" onMouseOver="hilite(3295)" onMouseOut="lolite()" onClick="logVariable('email_changed')" href="../../../_variables/email_changed.html">$email_changed</a> )
<a name="l3521"><span class="linenum">3521</span></a>              { // create new request ids array if it doesn't exist yet, or if user email changed ( this way the old request into the old email address won't be valid )
<a name="l3522"><span class="linenum">3522</span></a>                  <a class="var it3994" onMouseOver="hilite(3994)" onMouseOut="lolite()" onClick="logVariable('request_ids')" href="../../../_variables/request_ids.html">$request_ids</a> = array();
<a name="l3523"><span class="linenum">3523</span></a>              }
<a name="l3524"><span class="linenum">3524</span></a>              <a class="var it3994" onMouseOver="hilite(3994)" onMouseOut="lolite()" onClick="logVariable('request_ids')" href="../../../_variables/request_ids.html">$request_ids</a>[] = <a class="var it3993" onMouseOver="hilite(3993)" onMouseOut="lolite()" onClick="logVariable('request_id')" href="../../../_variables/request_id.html">$request_id</a>;
<a name="l3525"><span class="linenum">3525</span></a>              <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'core.validatemail.request_ids', <a class="var it3994" onMouseOver="hilite(3994)" onMouseOut="lolite()" onClick="logVariable('request_ids')" href="../../../_variables/request_ids.html">$request_ids</a>, 86400 * 2 ); <span class="comment">// expires in two days (or when clicked)</span>
<a name="l3526"><span class="linenum">3526</span></a>  <span class="comment">            // set a redirect_to session variable because this way after the account will be activated we will know where to redirect</span>
<a name="l3527"><span class="linenum">3527</span></a>              <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'core.validatemail.redirect_to', <a class="var it3992" onMouseOver="hilite(3992)" onMouseOut="lolite()" onClick="logVariable('redirect_to_after')" href="../../../_variables/redirect_to_after.html">$redirect_to_after</a>  );
<a name="l3528"><span class="linenum">3528</span></a>              <a class="var it478" onMouseOver="hilite(478)" onMouseOut="lolite()" onClick="logVariable('Session')" href="../../../_variables/Session.html">$Session</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>(); <span class="comment">// save immediately</span>
<a name="l3529"><span class="linenum">3529</span></a>  
<a name="l3530"><span class="linenum">3530</span></a>  <span class="comment">            // update last activation email timestamp</span>
<a name="l3531"><span class="linenum">3531</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'last_activation_email', <a class="function" onClick="logFunction('date2mysql')" href="../../../_functions/date2mysql.html" onMouseOver="funcPopup(event,'date2mysql')">date2mysql</a>( <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3532"><span class="linenum">3532</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l3533"><span class="linenum">3533</span></a>          }
<a name="l3534"><span class="linenum">3534</span></a>  
<a name="l3535"><span class="linenum">3535</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l3536"><span class="linenum">3536</span></a>      }
<a name="l3537"><span class="linenum">3537</span></a>  
<a name="l3538"><span class="linenum">3538</span></a>  
<a name="l3539"><span class="linenum">3539</span></a>      <span class="comment">/**</span>
<a name="l3540"><span class="linenum">3540</span></a>  <span class="comment">     * Activate user account after user clicks on activate link from email</span>
<a name="l3541"><span class="linenum">3541</span></a>  <span class="comment">     */</span>
<a name="l3542"><span class="linenum">3542</span></a>  	function <a class="function" onClick="logFunction('activate_from_Request')" href="../../../_functions/activate_from_request.html" onMouseOver="funcPopup(event,'activate_from_request')">activate_from_Request</a>()
<a name="l3543"><span class="linenum">3543</span></a>      {
<a name="l3544"><span class="linenum">3544</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>;
<a name="l3545"><span class="linenum">3545</span></a>  
<a name="l3546"><span class="linenum">3546</span></a>  <span class="comment">        // Activate current user account:</span>
<a name="l3547"><span class="linenum">3547</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', 'activated' );
<a name="l3548"><span class="linenum">3548</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l3549"><span class="linenum">3549</span></a>  
<a name="l3550"><span class="linenum">3550</span></a>  <span class="comment">        // clear last reminder key and last activation email date because the user was activated</span>
<a name="l3551"><span class="linenum">3551</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'last_activation_reminder_key', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3552"><span class="linenum">3552</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'last_activation_email', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3553"><span class="linenum">3553</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'activation_reminder_count', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3554"><span class="linenum">3554</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'send_activation_reminder', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l3555"><span class="linenum">3555</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l3556"><span class="linenum">3556</span></a>  
<a name="l3557"><span class="linenum">3557</span></a>          if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'newusers_findcomments' ) )
<a name="l3558"><span class="linenum">3558</span></a>          {    // We have to assign the all old comments from current user by email
<a name="l3559"><span class="linenum">3559</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l3560"><span class="linenum">3560</span></a>                  UPDATE T_comments
<a name="l3561"><span class="linenum">3561</span></a>                     SET comment_author_user_ID = &quot;'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&quot;
<a name="l3562"><span class="linenum">3562</span></a>                   WHERE comment_author_email = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a> ).'
<a name="l3563"><span class="linenum">3563</span></a>                     AND comment_author_user_ID IS NULL' );
<a name="l3564"><span class="linenum">3564</span></a>          }
<a name="l3565"><span class="linenum">3565</span></a>  
<a name="l3566"><span class="linenum">3566</span></a>  <span class="comment">        // Create a welcome private message when user's status was changed to Active</span>
<a name="l3567"><span class="linenum">3567</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_welcome_message')" href="../../../_functions/send_welcome_message.html" onMouseOver="funcPopup(event,'send_welcome_message')">send_welcome_message</a>();
<a name="l3568"><span class="linenum">3568</span></a>  
<a name="l3569"><span class="linenum">3569</span></a>  <span class="comment">        // Send notification email about activated account to users with edit users permission</span>
<a name="l3570"><span class="linenum">3570</span></a>          <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> = array(
<a name="l3571"><span class="linenum">3571</span></a>              'User' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>,
<a name="l3572"><span class="linenum">3572</span></a>              'login' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, // this is required in the send_admin_notification
<a name="l3573"><span class="linenum">3573</span></a>          );
<a name="l3574"><span class="linenum">3574</span></a>          <a class="function" onClick="logFunction('send_admin_notification')" href="../../../_functions/send_admin_notification.html" onMouseOver="funcPopup(event,'send_admin_notification')">send_admin_notification</a>( <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('<span class="keyword">New </span><a class="class" onClick="logClass('user')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a> account activated'), 'account_activated', <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> );
<a name="l3575"><span class="linenum">3575</span></a>      }
<a name="l3576"><span class="linenum">3576</span></a>  
<a name="l3577"><span class="linenum">3577</span></a>  
<a name="l3578"><span class="linenum">3578</span></a>  <span class="comment">    // Template functions {{{</span>
<a name="l3579"><span class="linenum">3579</span></a>  
<a name="l3580"><span class="linenum">3580</span></a>      <span class="comment">/**</span>
<a name="l3581"><span class="linenum">3581</span></a>  <span class="comment">     * Template function: display user's level</span>
<a name="l3582"><span class="linenum">3582</span></a>  <span class="comment">     */</span>
<a name="l3583"><span class="linenum">3583</span></a>  	function <a class="function" onClick="logFunction('level')" href="../../../_functions/level.html" onMouseOver="funcPopup(event,'level')">level</a>()
<a name="l3584"><span class="linenum">3584</span></a>      {
<a name="l3585"><span class="linenum">3585</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('disp')" href="../../../_functions/disp.html" onMouseOver="funcPopup(event,'disp')">disp</a>( 'level', 'raw' );
<a name="l3586"><span class="linenum">3586</span></a>      }
<a name="l3587"><span class="linenum">3587</span></a>  
<a name="l3588"><span class="linenum">3588</span></a>  
<a name="l3589"><span class="linenum">3589</span></a>      <span class="comment">/**</span>
<a name="l3590"><span class="linenum">3590</span></a>  <span class="comment">     * Template function: display user's login</span>
<a name="l3591"><span class="linenum">3591</span></a>  <span class="comment">     *</span>
<a name="l3592"><span class="linenum">3592</span></a>  <span class="comment">     * @param string Output format, see {@link format_to_output()}</span>
<a name="l3593"><span class="linenum">3593</span></a>  <span class="comment">     */</span>
<a name="l3594"><span class="linenum">3594</span></a>  	function <a class="function" onClick="logFunction('login')" href="../../../_functions/login.html" onMouseOver="funcPopup(event,'login')">login</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3595"><span class="linenum">3595</span></a>      {
<a name="l3596"><span class="linenum">3596</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('disp')" href="../../../_functions/disp.html" onMouseOver="funcPopup(event,'disp')">disp</a>( 'login', <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3597"><span class="linenum">3597</span></a>      }
<a name="l3598"><span class="linenum">3598</span></a>  
<a name="l3599"><span class="linenum">3599</span></a>  
<a name="l3600"><span class="linenum">3600</span></a>      <span class="comment">/**</span>
<a name="l3601"><span class="linenum">3601</span></a>  <span class="comment">     * Template helper function: Get a link to a message form for this user.</span>
<a name="l3602"><span class="linenum">3602</span></a>  <span class="comment">     *</span>
<a name="l3603"><span class="linenum">3603</span></a>  <span class="comment">     * @param string url of the message form</span>
<a name="l3604"><span class="linenum">3604</span></a>  <span class="comment">     * @param string to display before link</span>
<a name="l3605"><span class="linenum">3605</span></a>  <span class="comment">     * @param string to display after link</span>
<a name="l3606"><span class="linenum">3606</span></a>  <span class="comment">     * @param string link text</span>
<a name="l3607"><span class="linenum">3607</span></a>  <span class="comment">     * @param string link title</span>
<a name="l3608"><span class="linenum">3608</span></a>  <span class="comment">     * @param string class name</span>
<a name="l3609"><span class="linenum">3609</span></a>  <span class="comment">     */</span>
<a name="l3610"><span class="linenum">3610</span></a>  	function <a class="function" onClick="logFunction('get_msgform_link')" href="../../../_functions/get_msgform_link.html" onMouseOver="funcPopup(event,'get_msgform_link')">get_msgform_link</a>( <a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a> = NULL, <a class="var it375" onMouseOver="hilite(375)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../../_variables/before.html">$before</a> = ' ', <a class="var it376" onMouseOver="hilite(376)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../../_variables/after.html">$after</a> = ' ', <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = '#', <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a> = '#', <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> = '' )
<a name="l3611"><span class="linenum">3611</span></a>      {
<a name="l3612"><span class="linenum">3612</span></a>          if( empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>) )
<a name="l3613"><span class="linenum">3613</span></a>          { // We have no email for this User :(
<a name="l3614"><span class="linenum">3614</span></a>              return false;
<a name="l3615"><span class="linenum">3615</span></a>          }
<a name="l3616"><span class="linenum">3616</span></a>  
<a name="l3617"><span class="linenum">3617</span></a>          <a class="var it3995" onMouseOver="hilite(3995)" onMouseOut="lolite()" onClick="logVariable('available_msgform')" href="../../../_variables/available_msgform.html">$available_msgform</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_msgform_possibility')" href="../../../_functions/get_msgform_possibility.html" onMouseOver="funcPopup(event,'get_msgform_possibility')">get_msgform_possibility</a>();
<a name="l3618"><span class="linenum">3618</span></a>          if( ! <a class="var it3995" onMouseOver="hilite(3995)" onMouseOut="lolite()" onClick="logVariable('available_msgform')" href="../../../_variables/available_msgform.html">$available_msgform</a> )
<a name="l3619"><span class="linenum">3619</span></a>          {    // There is no way this user accepts receiving messages.
<a name="l3620"><span class="linenum">3620</span></a>              return false;
<a name="l3621"><span class="linenum">3621</span></a>          }
<a name="l3622"><span class="linenum">3622</span></a>  
<a name="l3623"><span class="linenum">3623</span></a>          if( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a>) )
<a name="l3624"><span class="linenum">3624</span></a>          {
<a name="l3625"><span class="linenum">3625</span></a>              global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l3626"><span class="linenum">3626</span></a>              <a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a> = isset(<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>) ? <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('msgformurl') : '';
<a name="l3627"><span class="linenum">3627</span></a>          }
<a name="l3628"><span class="linenum">3628</span></a>  
<a name="l3629"><span class="linenum">3629</span></a>          <a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a> = <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a>, 'recipient_id='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;amp;redirect_to='.<a class="phpfunction" onClick="logFunction('rawurlencode')" href="../../../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>(<a class="function" onClick="logFunction('url_rel_to_same_host')" href="../../../_functions/url_rel_to_same_host.html" onMouseOver="funcPopup(event,'url_rel_to_same_host')">url_rel_to_same_host</a>(<a class="function" onClick="logFunction('regenerate_url')" href="../../../_functions/regenerate_url.html" onMouseOver="funcPopup(event,'regenerate_url')">regenerate_url</a>('','','','&amp;'), <a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a>)) );
<a name="l3630"><span class="linenum">3630</span></a>  
<a name="l3631"><span class="linenum">3631</span></a>          if( <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a> == '#' )
<a name="l3632"><span class="linenum">3632</span></a>          {
<a name="l3633"><span class="linenum">3633</span></a>              switch( <a class="var it3995" onMouseOver="hilite(3995)" onMouseOut="lolite()" onClick="logVariable('available_msgform')" href="../../../_variables/available_msgform.html">$available_msgform</a> )
<a name="l3634"><span class="linenum">3634</span></a>              {
<a name="l3635"><span class="linenum">3635</span></a>                  case 'email':
<a name="l3636"><span class="linenum">3636</span></a>                      <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a> = <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Send email to user');
<a name="l3637"><span class="linenum">3637</span></a>                      break;
<a name="l3638"><span class="linenum">3638</span></a>                  case 'PM':
<a name="l3639"><span class="linenum">3639</span></a>                  case 'login':
<a name="l3640"><span class="linenum">3640</span></a>                  default:
<a name="l3641"><span class="linenum">3641</span></a>                      <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a> = <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Send message to user');
<a name="l3642"><span class="linenum">3642</span></a>                      break;
<a name="l3643"><span class="linenum">3643</span></a>              }
<a name="l3644"><span class="linenum">3644</span></a>          }
<a name="l3645"><span class="linenum">3645</span></a>          if( <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> == '#' ) <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = <a class="function" onClick="logFunction('get_icon')" href="../../../_functions/get_icon.html" onMouseOver="funcPopup(event,'get_icon')">get_icon</a>( 'email', 'imgtag', array( 'class' =&gt; 'middle', 'title' =&gt; <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a> ) );
<a name="l3646"><span class="linenum">3646</span></a>  
<a name="l3647"><span class="linenum">3647</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = '';
<a name="l3648"><span class="linenum">3648</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it375" onMouseOver="hilite(375)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../../_variables/before.html">$before</a>;
<a name="l3649"><span class="linenum">3649</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= '&lt;a href=&quot;'.<a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a>.'&quot; title=&quot;'.<a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a>.'&quot;';
<a name="l3650"><span class="linenum">3650</span></a>          if( !empty( <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> ) )
<a name="l3651"><span class="linenum">3651</span></a>          {
<a name="l3652"><span class="linenum">3652</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= ' class=&quot;'.<a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>.'&quot;';
<a name="l3653"><span class="linenum">3653</span></a>          }
<a name="l3654"><span class="linenum">3654</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= '&gt;'.<a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>.'&lt;/a&gt;';
<a name="l3655"><span class="linenum">3655</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it376" onMouseOver="hilite(376)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../../_variables/after.html">$after</a>;
<a name="l3656"><span class="linenum">3656</span></a>  
<a name="l3657"><span class="linenum">3657</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l3658"><span class="linenum">3658</span></a>      }
<a name="l3659"><span class="linenum">3659</span></a>  
<a name="l3660"><span class="linenum">3660</span></a>  
<a name="l3661"><span class="linenum">3661</span></a>      <span class="comment">/**</span>
<a name="l3662"><span class="linenum">3662</span></a>  <span class="comment">     * Template function: display a link to a message form for this user</span>
<a name="l3663"><span class="linenum">3663</span></a>  <span class="comment">     *</span>
<a name="l3664"><span class="linenum">3664</span></a>  <span class="comment">     * @param string url of the message form</span>
<a name="l3665"><span class="linenum">3665</span></a>  <span class="comment">     * @param string to display before link</span>
<a name="l3666"><span class="linenum">3666</span></a>  <span class="comment">     * @param string to display after link</span>
<a name="l3667"><span class="linenum">3667</span></a>  <span class="comment">     * @param string link text</span>
<a name="l3668"><span class="linenum">3668</span></a>  <span class="comment">     * @param string link title</span>
<a name="l3669"><span class="linenum">3669</span></a>  <span class="comment">     * @param string class name</span>
<a name="l3670"><span class="linenum">3670</span></a>  <span class="comment">     */</span>
<a name="l3671"><span class="linenum">3671</span></a>  	function <a class="function" onClick="logFunction('msgform_link')" href="../../../_functions/msgform_link.html" onMouseOver="funcPopup(event,'msgform_link')">msgform_link</a>( <a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a> = NULL, <a class="var it375" onMouseOver="hilite(375)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../../_variables/before.html">$before</a> = ' ', <a class="var it376" onMouseOver="hilite(376)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../../_variables/after.html">$after</a> = ' ', <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a> = '#', <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a> = '#', <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> = '' )
<a name="l3672"><span class="linenum">3672</span></a>      {
<a name="l3673"><span class="linenum">3673</span></a>          echo <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_msgform_link')" href="../../../_functions/get_msgform_link.html" onMouseOver="funcPopup(event,'get_msgform_link')">get_msgform_link</a>( <a class="var it1567" onMouseOver="hilite(1567)" onMouseOut="lolite()" onClick="logVariable('form_url')" href="../../../_variables/form_url.html">$form_url</a>, <a class="var it375" onMouseOver="hilite(375)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../../_variables/before.html">$before</a>, <a class="var it376" onMouseOver="hilite(376)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../../_variables/after.html">$after</a>, <a class="var it80" onMouseOver="hilite(80)" onMouseOut="lolite()" onClick="logVariable('text')" href="../../../_variables/text.html">$text</a>, <a class="var it112" onMouseOver="hilite(112)" onMouseOut="lolite()" onClick="logVariable('title')" href="../../../_variables/title.html">$title</a>, <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> );
<a name="l3674"><span class="linenum">3674</span></a>      }
<a name="l3675"><span class="linenum">3675</span></a>  
<a name="l3676"><span class="linenum">3676</span></a>  
<a name="l3677"><span class="linenum">3677</span></a>      <span class="comment">/**</span>
<a name="l3678"><span class="linenum">3678</span></a>  <span class="comment">     * Template function: display user's preferred name</span>
<a name="l3679"><span class="linenum">3679</span></a>  <span class="comment">     *</span>
<a name="l3680"><span class="linenum">3680</span></a>  <span class="comment">     * @param string Output format, see {@link format_to_output()}</span>
<a name="l3681"><span class="linenum">3681</span></a>  <span class="comment">     */</span>
<a name="l3682"><span class="linenum">3682</span></a>  	function <a class="function" onClick="logFunction('preferred_name')" href="../../../_functions/preferred_name.html" onMouseOver="funcPopup(event,'preferred_name')">preferred_name</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3683"><span class="linenum">3683</span></a>      {
<a name="l3684"><span class="linenum">3684</span></a>          echo <a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_preferred_name')" href="../../../_functions/get_preferred_name.html" onMouseOver="funcPopup(event,'get_preferred_name')">get_preferred_name</a>(), <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3685"><span class="linenum">3685</span></a>      }
<a name="l3686"><span class="linenum">3686</span></a>  
<a name="l3687"><span class="linenum">3687</span></a>  
<a name="l3688"><span class="linenum">3688</span></a>      <span class="comment">/**</span>
<a name="l3689"><span class="linenum">3689</span></a>  <span class="comment">     * Template function: display user's URL</span>
<a name="l3690"><span class="linenum">3690</span></a>  <span class="comment">     *</span>
<a name="l3691"><span class="linenum">3691</span></a>  <span class="comment">     * @param string string to display before the date (if changed)</span>
<a name="l3692"><span class="linenum">3692</span></a>  <span class="comment">     * @param string string to display after the date (if changed)</span>
<a name="l3693"><span class="linenum">3693</span></a>  <span class="comment">     * @param string Output format, see {@link format_to_output()}</span>
<a name="l3694"><span class="linenum">3694</span></a>  <span class="comment">     */</span>
<a name="l3695"><span class="linenum">3695</span></a>  	function <a class="function" onClick="logFunction('url')" href="../../../_functions/url.html" onMouseOver="funcPopup(event,'url')">url</a>( <a class="var it375" onMouseOver="hilite(375)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../../_variables/before.html">$before</a> = '', <a class="var it376" onMouseOver="hilite(376)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../../_variables/after.html">$after</a> = '', <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3696"><span class="linenum">3696</span></a>      {
<a name="l3697"><span class="linenum">3697</span></a>          if( !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('url')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/url.html">url</a> ) )
<a name="l3698"><span class="linenum">3698</span></a>          {
<a name="l3699"><span class="linenum">3699</span></a>              echo <a class="var it375" onMouseOver="hilite(375)" onMouseOut="lolite()" onClick="logVariable('before')" href="../../../_variables/before.html">$before</a>;
<a name="l3700"><span class="linenum">3700</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('disp')" href="../../../_functions/disp.html" onMouseOver="funcPopup(event,'disp')">disp</a>( 'url', <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3701"><span class="linenum">3701</span></a>              echo <a class="var it376" onMouseOver="hilite(376)" onMouseOut="lolite()" onClick="logVariable('after')" href="../../../_variables/after.html">$after</a>;
<a name="l3702"><span class="linenum">3702</span></a>          }
<a name="l3703"><span class="linenum">3703</span></a>      }
<a name="l3704"><span class="linenum">3704</span></a>  
<a name="l3705"><span class="linenum">3705</span></a>  
<a name="l3706"><span class="linenum">3706</span></a>      <span class="comment">/**</span>
<a name="l3707"><span class="linenum">3707</span></a>  <span class="comment">     * Template function: display number of user's posts</span>
<a name="l3708"><span class="linenum">3708</span></a>  <span class="comment">     */</span>
<a name="l3709"><span class="linenum">3709</span></a>  	function <a class="function" onClick="logFunction('num_posts')" href="../../../_functions/num_posts.html" onMouseOver="funcPopup(event,'num_posts')">num_posts</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3710"><span class="linenum">3710</span></a>      {
<a name="l3711"><span class="linenum">3711</span></a>          echo <a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_posts')" href="../../../_functions/get_num_posts.html" onMouseOver="funcPopup(event,'get_num_posts')">get_num_posts</a>(), <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3712"><span class="linenum">3712</span></a>      }
<a name="l3713"><span class="linenum">3713</span></a>  
<a name="l3714"><span class="linenum">3714</span></a>  
<a name="l3715"><span class="linenum">3715</span></a>      <span class="comment">/**</span>
<a name="l3716"><span class="linenum">3716</span></a>  <span class="comment">     * Template function: display first name of the user</span>
<a name="l3717"><span class="linenum">3717</span></a>  <span class="comment">     */</span>
<a name="l3718"><span class="linenum">3718</span></a>  	function <a class="function" onClick="logFunction('first_name')" href="../../../_functions/first_name.html" onMouseOver="funcPopup(event,'first_name')">first_name</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3719"><span class="linenum">3719</span></a>      {
<a name="l3720"><span class="linenum">3720</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('disp')" href="../../../_functions/disp.html" onMouseOver="funcPopup(event,'disp')">disp</a>( 'firstname', <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3721"><span class="linenum">3721</span></a>      }
<a name="l3722"><span class="linenum">3722</span></a>  
<a name="l3723"><span class="linenum">3723</span></a>  
<a name="l3724"><span class="linenum">3724</span></a>      <span class="comment">/**</span>
<a name="l3725"><span class="linenum">3725</span></a>  <span class="comment">     * Template function: display last name of the user</span>
<a name="l3726"><span class="linenum">3726</span></a>  <span class="comment">     */</span>
<a name="l3727"><span class="linenum">3727</span></a>  	function <a class="function" onClick="logFunction('last_name')" href="../../../_functions/last_name.html" onMouseOver="funcPopup(event,'last_name')">last_name</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3728"><span class="linenum">3728</span></a>      {
<a name="l3729"><span class="linenum">3729</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('disp')" href="../../../_functions/disp.html" onMouseOver="funcPopup(event,'disp')">disp</a>( 'lastname', <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3730"><span class="linenum">3730</span></a>      }
<a name="l3731"><span class="linenum">3731</span></a>  
<a name="l3732"><span class="linenum">3732</span></a>  
<a name="l3733"><span class="linenum">3733</span></a>      <span class="comment">/**</span>
<a name="l3734"><span class="linenum">3734</span></a>  <span class="comment">     * Template function: display nickname of the user</span>
<a name="l3735"><span class="linenum">3735</span></a>  <span class="comment">     */</span>
<a name="l3736"><span class="linenum">3736</span></a>  	function <a class="function" onClick="logFunction('nick_name')" href="../../../_functions/nick_name.html" onMouseOver="funcPopup(event,'nick_name')">nick_name</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3737"><span class="linenum">3737</span></a>      {
<a name="l3738"><span class="linenum">3738</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('disp')" href="../../../_functions/disp.html" onMouseOver="funcPopup(event,'disp')">disp</a>( 'nickname', <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3739"><span class="linenum">3739</span></a>      }
<a name="l3740"><span class="linenum">3740</span></a>  
<a name="l3741"><span class="linenum">3741</span></a>  
<a name="l3742"><span class="linenum">3742</span></a>      <span class="comment">/**</span>
<a name="l3743"><span class="linenum">3743</span></a>  <span class="comment">     * Return gender of the user</span>
<a name="l3744"><span class="linenum">3744</span></a>  <span class="comment">     */</span>
<a name="l3745"><span class="linenum">3745</span></a>  	function <a class="function" onClick="logFunction('get_gender')" href="../../../_functions/get_gender.html" onMouseOver="funcPopup(event,'get_gender')">get_gender</a>()
<a name="l3746"><span class="linenum">3746</span></a>      {
<a name="l3747"><span class="linenum">3747</span></a>          switch( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gender')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/gender.html">gender</a> )
<a name="l3748"><span class="linenum">3748</span></a>          {
<a name="l3749"><span class="linenum">3749</span></a>              case 'M':
<a name="l3750"><span class="linenum">3750</span></a>                  return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('A man');
<a name="l3751"><span class="linenum">3751</span></a>  
<a name="l3752"><span class="linenum">3752</span></a>              case 'F':
<a name="l3753"><span class="linenum">3753</span></a>                  return <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('A woman');
<a name="l3754"><span class="linenum">3754</span></a>          }
<a name="l3755"><span class="linenum">3755</span></a>  
<a name="l3756"><span class="linenum">3756</span></a>          return NULL;
<a name="l3757"><span class="linenum">3757</span></a>      }
<a name="l3758"><span class="linenum">3758</span></a>  
<a name="l3759"><span class="linenum">3759</span></a>  
<a name="l3760"><span class="linenum">3760</span></a>      <span class="comment">/**</span>
<a name="l3761"><span class="linenum">3761</span></a>  <span class="comment">     * Return attr class depending on gender of the user</span>
<a name="l3762"><span class="linenum">3762</span></a>  <span class="comment">     */</span>
<a name="l3763"><span class="linenum">3763</span></a>  	function <a class="function" onClick="logFunction('get_gender_class')" href="../../../_functions/get_gender_class.html" onMouseOver="funcPopup(event,'get_gender_class')">get_gender_class</a>()
<a name="l3764"><span class="linenum">3764</span></a>      {
<a name="l3765"><span class="linenum">3765</span></a>          <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> = 'user';
<a name="l3766"><span class="linenum">3766</span></a>  
<a name="l3767"><span class="linenum">3767</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_closed' ) )
<a name="l3768"><span class="linenum">3768</span></a>          { // Set different gender color if user is closed
<a name="l3769"><span class="linenum">3769</span></a>              return 'user closed';
<a name="l3770"><span class="linenum">3770</span></a>          }
<a name="l3771"><span class="linenum">3771</span></a>  
<a name="l3772"><span class="linenum">3772</span></a>          if( ! <a class="function" onClick="logFunction('check_setting')" href="../../../_functions/check_setting.html" onMouseOver="funcPopup(event,'check_setting')">check_setting</a>( 'gender_colored' ) )
<a name="l3773"><span class="linenum">3773</span></a>          { // Don't set gender color if setting is OFF
<a name="l3774"><span class="linenum">3774</span></a>              return <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a>;
<a name="l3775"><span class="linenum">3775</span></a>          }
<a name="l3776"><span class="linenum">3776</span></a>  
<a name="l3777"><span class="linenum">3777</span></a>          switch( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('gender')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/gender.html">gender</a> )
<a name="l3778"><span class="linenum">3778</span></a>          { // Set a class name for each gender type
<a name="l3779"><span class="linenum">3779</span></a>              case 'M':
<a name="l3780"><span class="linenum">3780</span></a>                  <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> .= ' man';
<a name="l3781"><span class="linenum">3781</span></a>                  break;
<a name="l3782"><span class="linenum">3782</span></a>              case 'F':
<a name="l3783"><span class="linenum">3783</span></a>                  <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> .= ' woman';
<a name="l3784"><span class="linenum">3784</span></a>                  break;
<a name="l3785"><span class="linenum">3785</span></a>              default:
<a name="l3786"><span class="linenum">3786</span></a>                  <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a> .= ' nogender';
<a name="l3787"><span class="linenum">3787</span></a>                  break;
<a name="l3788"><span class="linenum">3788</span></a>          }
<a name="l3789"><span class="linenum">3789</span></a>  
<a name="l3790"><span class="linenum">3790</span></a>          return <a class="var it1118" onMouseOver="hilite(1118)" onMouseOut="lolite()" onClick="logVariable('gender_class')" href="../../../_variables/gender_class.html">$gender_class</a>;
<a name="l3791"><span class="linenum">3791</span></a>      }
<a name="l3792"><span class="linenum">3792</span></a>  
<a name="l3793"><span class="linenum">3793</span></a>  
<a name="l3794"><span class="linenum">3794</span></a>      <span class="comment">/**</span>
<a name="l3795"><span class="linenum">3795</span></a>  <span class="comment">     * Template function: display email of the user</span>
<a name="l3796"><span class="linenum">3796</span></a>  <span class="comment">     */</span>
<a name="l3797"><span class="linenum">3797</span></a>  	function <a class="function" onClick="logFunction('email')" href="../../../_functions/email.html" onMouseOver="funcPopup(event,'email')">email</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3798"><span class="linenum">3798</span></a>      {
<a name="l3799"><span class="linenum">3799</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('disp')" href="../../../_functions/disp.html" onMouseOver="funcPopup(event,'disp')">disp</a>( 'email', <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l3800"><span class="linenum">3800</span></a>      }
<a name="l3801"><span class="linenum">3801</span></a>  
<a name="l3802"><span class="linenum">3802</span></a>  
<a name="l3803"><span class="linenum">3803</span></a>      <span class="comment">/**</span>
<a name="l3804"><span class="linenum">3804</span></a>  <span class="comment">     * Template function: display ICQ of the user</span>
<a name="l3805"><span class="linenum">3805</span></a>  <span class="comment">     * @deprecated</span>
<a name="l3806"><span class="linenum">3806</span></a>  <span class="comment">     */</span>
<a name="l3807"><span class="linenum">3807</span></a>  	function <a class="function" onClick="logFunction('icq')" href="../../../_functions/icq.html" onMouseOver="funcPopup(event,'icq')">icq</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3808"><span class="linenum">3808</span></a>      {
<a name="l3809"><span class="linenum">3809</span></a>      }
<a name="l3810"><span class="linenum">3810</span></a>  
<a name="l3811"><span class="linenum">3811</span></a>  
<a name="l3812"><span class="linenum">3812</span></a>      <span class="comment">/**</span>
<a name="l3813"><span class="linenum">3813</span></a>  <span class="comment">     * Template function: display AIM of the user.</span>
<a name="l3814"><span class="linenum">3814</span></a>  <span class="comment">     * @deprecated</span>
<a name="l3815"><span class="linenum">3815</span></a>  <span class="comment">     */</span>
<a name="l3816"><span class="linenum">3816</span></a>  	function <a class="function" onClick="logFunction('aim')" href="../../../_functions/aim.html" onMouseOver="funcPopup(event,'aim')">aim</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3817"><span class="linenum">3817</span></a>      {
<a name="l3818"><span class="linenum">3818</span></a>      }
<a name="l3819"><span class="linenum">3819</span></a>  
<a name="l3820"><span class="linenum">3820</span></a>  
<a name="l3821"><span class="linenum">3821</span></a>      <span class="comment">/**</span>
<a name="l3822"><span class="linenum">3822</span></a>  <span class="comment">     * Template function: display Yahoo IM of the user</span>
<a name="l3823"><span class="linenum">3823</span></a>  <span class="comment">     * @deprecated</span>
<a name="l3824"><span class="linenum">3824</span></a>  <span class="comment">     */</span>
<a name="l3825"><span class="linenum">3825</span></a>  	function <a class="function" onClick="logFunction('yim')" href="../../../_functions/yim.html" onMouseOver="funcPopup(event,'yim')">yim</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3826"><span class="linenum">3826</span></a>      {
<a name="l3827"><span class="linenum">3827</span></a>      }
<a name="l3828"><span class="linenum">3828</span></a>  
<a name="l3829"><span class="linenum">3829</span></a>  
<a name="l3830"><span class="linenum">3830</span></a>      <span class="comment">/**</span>
<a name="l3831"><span class="linenum">3831</span></a>  <span class="comment">     * Template function: display MSN of the user</span>
<a name="l3832"><span class="linenum">3832</span></a>  <span class="comment">     * @deprecated</span>
<a name="l3833"><span class="linenum">3833</span></a>  <span class="comment">     */</span>
<a name="l3834"><span class="linenum">3834</span></a>  	function <a class="function" onClick="logFunction('msn')" href="../../../_functions/msn.html" onMouseOver="funcPopup(event,'msn')">msn</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = 'htmlbody' )
<a name="l3835"><span class="linenum">3835</span></a>      {
<a name="l3836"><span class="linenum">3836</span></a>      }
<a name="l3837"><span class="linenum">3837</span></a>  
<a name="l3838"><span class="linenum">3838</span></a>  <span class="comment">    // }}}</span>
<a name="l3839"><span class="linenum">3839</span></a>  
<a name="l3840"><span class="linenum">3840</span></a>  
<a name="l3841"><span class="linenum">3841</span></a>  	function <a class="function" onClick="logFunction('has_avatar')" href="../../../_functions/has_avatar.html" onMouseOver="funcPopup(event,'has_avatar')">has_avatar</a>()
<a name="l3842"><span class="linenum">3842</span></a>      {
<a name="l3843"><span class="linenum">3843</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l3844"><span class="linenum">3844</span></a>  
<a name="l3845"><span class="linenum">3845</span></a>          return ( !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('avatar_file_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/avatar_file_ID.html">avatar_file_ID</a> ) &amp;&amp; <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('allow_avatars') );
<a name="l3846"><span class="linenum">3846</span></a>      }
<a name="l3847"><span class="linenum">3847</span></a>  
<a name="l3848"><span class="linenum">3848</span></a>  
<a name="l3849"><span class="linenum">3849</span></a>      <span class="comment">/**</span>
<a name="l3850"><span class="linenum">3850</span></a>  <span class="comment">     * Get {@link File} object of the user's avatar.</span>
<a name="l3851"><span class="linenum">3851</span></a>  <span class="comment">     *</span>
<a name="l3852"><span class="linenum">3852</span></a>  <span class="comment">     * @return File This may be NULL.</span>
<a name="l3853"><span class="linenum">3853</span></a>  <span class="comment">     */</span>
<a name="l3854"><span class="linenum">3854</span></a>      function &amp; get_avatar_File()
<a name="l3855"><span class="linenum">3855</span></a>      {
<a name="l3856"><span class="linenum">3856</span></a>          <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = NULL;
<a name="l3857"><span class="linenum">3857</span></a>  
<a name="l3858"><span class="linenum">3858</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('has_avatar')" href="../../../_functions/has_avatar.html" onMouseOver="funcPopup(event,'has_avatar')">has_avatar</a>() )
<a name="l3859"><span class="linenum">3859</span></a>          {
<a name="l3860"><span class="linenum">3860</span></a>              <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a> = &amp; get_FileCache();
<a name="l3861"><span class="linenum">3861</span></a>  
<a name="l3862"><span class="linenum">3862</span></a>  <span class="comment">            // Do not halt on error. A file can disappear without the profile being updated.</span>
<a name="l3863"><span class="linenum">3863</span></a>              <span class="comment">/**</span>
<a name="l3864"><span class="linenum">3864</span></a>  <span class="comment">             * @var File</span>
<a name="l3865"><span class="linenum">3865</span></a>  <span class="comment">             */</span>
<a name="l3866"><span class="linenum">3866</span></a>              <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = &amp; <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a>-&gt;get_by_ID( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('avatar_file_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/avatar_file_ID.html">avatar_file_ID</a>, false, false );
<a name="l3867"><span class="linenum">3867</span></a>          }
<a name="l3868"><span class="linenum">3868</span></a>  
<a name="l3869"><span class="linenum">3869</span></a>          return <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>;
<a name="l3870"><span class="linenum">3870</span></a>      }
<a name="l3871"><span class="linenum">3871</span></a>  
<a name="l3872"><span class="linenum">3872</span></a>  
<a name="l3873"><span class="linenum">3873</span></a>      <span class="comment">/**</span>
<a name="l3874"><span class="linenum">3874</span></a>  <span class="comment">     * Get {@link Link} object of the user's avatar.</span>
<a name="l3875"><span class="linenum">3875</span></a>  <span class="comment">     *</span>
<a name="l3876"><span class="linenum">3876</span></a>  <span class="comment">     * @return Link This may be NULL.</span>
<a name="l3877"><span class="linenum">3877</span></a>  <span class="comment">     */</span>
<a name="l3878"><span class="linenum">3878</span></a>      function &amp; get_avatar_Link()
<a name="l3879"><span class="linenum">3879</span></a>      {
<a name="l3880"><span class="linenum">3880</span></a>          <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a> = NULL;
<a name="l3881"><span class="linenum">3881</span></a>  
<a name="l3882"><span class="linenum">3882</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('has_avatar')" href="../../../_functions/has_avatar.html" onMouseOver="funcPopup(event,'has_avatar')">has_avatar</a>() )
<a name="l3883"><span class="linenum">3883</span></a>          {
<a name="l3884"><span class="linenum">3884</span></a>              <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a> = <span class="keyword">new </span><a class="class" onClick="logClass('LinkUser')" href="../../../_classes/linkuser.html" onMouseOver="classPopup(event,'linkuser')">LinkUser</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> );
<a name="l3885"><span class="linenum">3885</span></a>              <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a> = <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a>-&gt;get_link_by_file_ID( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('avatar_file_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/avatar_file_ID.html">avatar_file_ID</a> );
<a name="l3886"><span class="linenum">3886</span></a>          }
<a name="l3887"><span class="linenum">3887</span></a>  
<a name="l3888"><span class="linenum">3888</span></a>          return <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a>;
<a name="l3889"><span class="linenum">3889</span></a>      }
<a name="l3890"><span class="linenum">3890</span></a>  
<a name="l3891"><span class="linenum">3891</span></a>  
<a name="l3892"><span class="linenum">3892</span></a>      <span class="comment">/**</span>
<a name="l3893"><span class="linenum">3893</span></a>  <span class="comment">     * Get array of {@link Link} objects of the previously uploaded avatars.</span>
<a name="l3894"><span class="linenum">3894</span></a>  <span class="comment">     *</span>
<a name="l3895"><span class="linenum">3895</span></a>  <span class="comment">     * @param boolean TRUE - to exclude main picture from list</span>
<a name="l3896"><span class="linenum">3896</span></a>  <span class="comment">     * @param boolean TRUE - to ignore the settings and get the avatars anyway</span>
<a name="l3897"><span class="linenum">3897</span></a>  <span class="comment">     * @return array of Links</span>
<a name="l3898"><span class="linenum">3898</span></a>  <span class="comment">     */</span>
<a name="l3899"><span class="linenum">3899</span></a>  	function <a class="function" onClick="logFunction('get_avatar_Links')" href="../../../_functions/get_avatar_links.html" onMouseOver="funcPopup(event,'get_avatar_links')">get_avatar_Links</a>( <a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('exclude_main_picture')" href="../../../_variables/exclude_main_picture.html">$exclude_main_picture</a> = true, <a class="var it3997" onMouseOver="hilite(3997)" onMouseOut="lolite()" onClick="logVariable('ignore_settings')" href="../../../_variables/ignore_settings.html">$ignore_settings</a> = false )
<a name="l3900"><span class="linenum">3900</span></a>      {
<a name="l3901"><span class="linenum">3901</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l3902"><span class="linenum">3902</span></a>  
<a name="l3903"><span class="linenum">3903</span></a>          <a class="var it3998" onMouseOver="hilite(3998)" onMouseOut="lolite()" onClick="logVariable('avatar_Links')" href="../../../_variables/avatar_Links.html">$avatar_Links</a> = array();
<a name="l3904"><span class="linenum">3904</span></a>  
<a name="l3905"><span class="linenum">3905</span></a>          if( !<a class="var it3997" onMouseOver="hilite(3997)" onMouseOut="lolite()" onClick="logVariable('ignore_settings')" href="../../../_variables/ignore_settings.html">$ignore_settings</a> &amp;&amp; !( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('upload_enabled') &amp;&amp; <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'fm_enable_roots_user' ) ) )
<a name="l3906"><span class="linenum">3906</span></a>          { // Upload is not enabled and we have no permission to use it...
<a name="l3907"><span class="linenum">3907</span></a>              return <a class="var it3998" onMouseOver="hilite(3998)" onMouseOut="lolite()" onClick="logVariable('avatar_Links')" href="../../../_variables/avatar_Links.html">$avatar_Links</a>;
<a name="l3908"><span class="linenum">3908</span></a>          }
<a name="l3909"><span class="linenum">3909</span></a>  
<a name="l3910"><span class="linenum">3910</span></a>          <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a> = <span class="keyword">new </span><a class="class" onClick="logClass('LinkUser')" href="../../../_classes/linkuser.html" onMouseOver="classPopup(event,'linkuser')">LinkUser</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> );
<a name="l3911"><span class="linenum">3911</span></a>          foreach( <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a>-&gt;get_Links() as <a class="var it1106" onMouseOver="hilite(1106)" onMouseOut="lolite()" onClick="logVariable('user_Link')" href="../../../_variables/user_Link.html">$user_Link</a> )
<a name="l3912"><span class="linenum">3912</span></a>          {
<a name="l3913"><span class="linenum">3913</span></a>              <a class="var it2820" onMouseOver="hilite(2820)" onMouseOut="lolite()" onClick="logVariable('l_File')" href="../../../_variables/l_File.html">$l_File</a> = &amp; <a class="var it1106" onMouseOver="hilite(1106)" onMouseOut="lolite()" onClick="logVariable('user_Link')" href="../../../_variables/user_Link.html">$user_Link</a>-&gt;get_File();
<a name="l3914"><span class="linenum">3914</span></a>              if( ! empty( <a class="var it2820" onMouseOver="hilite(2820)" onMouseOut="lolite()" onClick="logVariable('l_File')" href="../../../_variables/l_File.html">$l_File</a> ) &amp;&amp; <a class="var it2820" onMouseOver="hilite(2820)" onMouseOut="lolite()" onClick="logVariable('l_File')" href="../../../_variables/l_File.html">$l_File</a>-&gt;<a class="function" onClick="logFunction('is_image')" href="../../../_functions/is_image.html" onMouseOver="funcPopup(event,'is_image')">is_image</a>() )
<a name="l3915"><span class="linenum">3915</span></a>              {
<a name="l3916"><span class="linenum">3916</span></a>                  if( <a class="var it3996" onMouseOver="hilite(3996)" onMouseOut="lolite()" onClick="logVariable('exclude_main_picture')" href="../../../_variables/exclude_main_picture.html">$exclude_main_picture</a> &amp;&amp; <a class="var it2820" onMouseOver="hilite(2820)" onMouseOut="lolite()" onClick="logVariable('l_File')" href="../../../_variables/l_File.html">$l_File</a>-&gt;<a onClick="logVariable('ID')" class="var it10850" onMouseOver="hilite(10850)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('avatar_file_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/avatar_file_ID.html">avatar_file_ID</a> )
<a name="l3917"><span class="linenum">3917</span></a>                  { // Exclude the main picture from list of other pictures
<a name="l3918"><span class="linenum">3918</span></a>                      continue;
<a name="l3919"><span class="linenum">3919</span></a>                  }
<a name="l3920"><span class="linenum">3920</span></a>                  <a class="var it3998" onMouseOver="hilite(3998)" onMouseOut="lolite()" onClick="logVariable('avatar_Links')" href="../../../_variables/avatar_Links.html">$avatar_Links</a>[] = <a class="var it1106" onMouseOver="hilite(1106)" onMouseOut="lolite()" onClick="logVariable('user_Link')" href="../../../_variables/user_Link.html">$user_Link</a>;
<a name="l3921"><span class="linenum">3921</span></a>              }
<a name="l3922"><span class="linenum">3922</span></a>          }
<a name="l3923"><span class="linenum">3923</span></a>  
<a name="l3924"><span class="linenum">3924</span></a>          return <a class="var it3998" onMouseOver="hilite(3998)" onMouseOut="lolite()" onClick="logVariable('avatar_Links')" href="../../../_variables/avatar_Links.html">$avatar_Links</a>;
<a name="l3925"><span class="linenum">3925</span></a>      }
<a name="l3926"><span class="linenum">3926</span></a>  
<a name="l3927"><span class="linenum">3927</span></a>  
<a name="l3928"><span class="linenum">3928</span></a>      <span class="comment">/**</span>
<a name="l3929"><span class="linenum">3929</span></a>  <span class="comment">     * Get avatar IMG tag.</span>
<a name="l3930"><span class="linenum">3930</span></a>  <span class="comment">     *</span>
<a name="l3931"><span class="linenum">3931</span></a>  <span class="comment">     * @param string size</span>
<a name="l3932"><span class="linenum">3932</span></a>  <span class="comment">     * @param string class</span>
<a name="l3933"><span class="linenum">3933</span></a>  <span class="comment">     * @param string align</span>
<a name="l3934"><span class="linenum">3934</span></a>  <span class="comment">     * @param boolean true if the avatar image should be zoomed on click, false otherwise</span>
<a name="l3935"><span class="linenum">3935</span></a>  <span class="comment">     * @param string avatar overlay text</span>
<a name="l3936"><span class="linenum">3936</span></a>  <span class="comment">     * @param string group name for lightbox plugin</span>
<a name="l3937"><span class="linenum">3937</span></a>  <span class="comment">     * @param string Change size of the attributes &quot;width&quot; &amp; &quot;height&quot;.</span>
<a name="l3938"><span class="linenum">3938</span></a>  <span class="comment">     *               Example: ( $tag_size = '160' ) =&gt; width=&quot;160&quot; height=&quot;160&quot;</span>
<a name="l3939"><span class="linenum">3939</span></a>  <span class="comment">     *                        ( $tag_size = '160x320' ) =&gt; width=&quot;160&quot; height=&quot;320&quot;</span>
<a name="l3940"><span class="linenum">3940</span></a>  <span class="comment">     *                        NULL - use real size</span>
<a name="l3941"><span class="linenum">3941</span></a>  <span class="comment">     * @return string</span>
<a name="l3942"><span class="linenum">3942</span></a>  <span class="comment">     */</span>
<a name="l3943"><span class="linenum">3943</span></a>  	function <a class="function" onClick="logFunction('get_avatar_imgtag')" href="../../../_functions/get_avatar_imgtag.html" onMouseOver="funcPopup(event,'get_avatar_imgtag')">get_avatar_imgtag</a>( <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../../_variables/size.html">$size</a> = 'crop-top-64x64', <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> = 'avatar', <a class="var it1991" onMouseOver="hilite(1991)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../../_variables/align.html">$align</a> = '', <a class="var it3999" onMouseOver="hilite(3999)" onMouseOut="lolite()" onClick="logVariable('zoomable')" href="../../../_variables/zoomable.html">$zoomable</a> = false, <a class="var it1121" onMouseOver="hilite(1121)" onMouseOut="lolite()" onClick="logVariable('avatar_overlay_text')" href="../../../_variables/avatar_overlay_text.html">$avatar_overlay_text</a> = '', <a class="var it4000" onMouseOver="hilite(4000)" onMouseOut="lolite()" onClick="logVariable('lightbox_group')" href="../../../_variables/lightbox_group.html">$lightbox_group</a> = '', <a class="var it3255" onMouseOver="hilite(3255)" onMouseOut="lolite()" onClick="logVariable('tag_size')" href="../../../_variables/tag_size.html">$tag_size</a> = NULL )
<a name="l3944"><span class="linenum">3944</span></a>      {
<a name="l3945"><span class="linenum">3945</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l3946"><span class="linenum">3946</span></a>  
<a name="l3947"><span class="linenum">3947</span></a>          <span class="comment">/**</span>
<a name="l3948"><span class="linenum">3948</span></a>  <span class="comment">         * @var Link</span>
<a name="l3949"><span class="linenum">3949</span></a>  <span class="comment">         */</span>
<a name="l3950"><span class="linenum">3950</span></a>          <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a> = &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_avatar_Link();
<a name="l3951"><span class="linenum">3951</span></a>  
<a name="l3952"><span class="linenum">3952</span></a>          <span class="comment">/**</span>
<a name="l3953"><span class="linenum">3953</span></a>  <span class="comment">         * @var File</span>
<a name="l3954"><span class="linenum">3954</span></a>  <span class="comment">         */</span>
<a name="l3955"><span class="linenum">3955</span></a>          if( ! <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a> || ! <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = &amp; <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a>-&gt;get_File() )
<a name="l3956"><span class="linenum">3956</span></a>          { // User doesn't have an avatar
<a name="l3957"><span class="linenum">3957</span></a>              return <a class="function" onClick="logFunction('get_avatar_imgtag_default')" href="../../../_functions/get_avatar_imgtag_default.html" onMouseOver="funcPopup(event,'get_avatar_imgtag_default')">get_avatar_imgtag_default</a>( <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../../_variables/size.html">$size</a>, <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>, <a class="var it1991" onMouseOver="hilite(1991)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../../_variables/align.html">$align</a>, array(
<a name="l3958"><span class="linenum">3958</span></a>                      'email'    =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'email' ),
<a name="l3959"><span class="linenum">3959</span></a>                      'gender'   =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'gender' ),
<a name="l3960"><span class="linenum">3960</span></a>                      'tag_size' =&gt; <a class="var it3255" onMouseOver="hilite(3255)" onMouseOut="lolite()" onClick="logVariable('tag_size')" href="../../../_variables/tag_size.html">$tag_size</a>,
<a name="l3961"><span class="linenum">3961</span></a>                  ) );
<a name="l3962"><span class="linenum">3962</span></a>          }
<a name="l3963"><span class="linenum">3963</span></a>  
<a name="l3964"><span class="linenum">3964</span></a>          if( ( !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'can_display_avatar' ) ) &amp;&amp; !( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() &amp;&amp; <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>( false ) &amp;&amp; ( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) ) ) )
<a name="l3965"><span class="linenum">3965</span></a>          { // if the user status doesn't allow to display avatar and current User is not an admin in admin interface, then show default avatar
<a name="l3966"><span class="linenum">3966</span></a>              return <a class="function" onClick="logFunction('get_avatar_imgtag_default')" href="../../../_functions/get_avatar_imgtag_default.html" onMouseOver="funcPopup(event,'get_avatar_imgtag_default')">get_avatar_imgtag_default</a>( <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../../_variables/size.html">$size</a>, <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>, <a class="var it1991" onMouseOver="hilite(1991)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../../_variables/align.html">$align</a>, array(
<a name="l3967"><span class="linenum">3967</span></a>                      'email'    =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'email' ),
<a name="l3968"><span class="linenum">3968</span></a>                      'gender'   =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'gender' ),
<a name="l3969"><span class="linenum">3969</span></a>                      'tag_size' =&gt; <a class="var it3255" onMouseOver="hilite(3255)" onMouseOut="lolite()" onClick="logVariable('tag_size')" href="../../../_variables/tag_size.html">$tag_size</a>,
<a name="l3970"><span class="linenum">3970</span></a>                  ) );
<a name="l3971"><span class="linenum">3971</span></a>          }
<a name="l3972"><span class="linenum">3972</span></a>  
<a name="l3973"><span class="linenum">3973</span></a>          if( <a class="var it3999" onMouseOver="hilite(3999)" onMouseOut="lolite()" onClick="logVariable('zoomable')" href="../../../_variables/zoomable.html">$zoomable</a> )
<a name="l3974"><span class="linenum">3974</span></a>          { // return clickable avatar tag, zoom on click
<a name="l3975"><span class="linenum">3975</span></a>              if( <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l3976"><span class="linenum">3976</span></a>              { // Only logged in users can see a big picture of the avatar
<a name="l3977"><span class="linenum">3977</span></a>  <span class="comment">                // set random value to link_rel, this way the pictures on the page won't be grouped</span>
<a name="l3978"><span class="linenum">3978</span></a>  <span class="comment">                // this is usefull because the same avatar picture may appear more times in the same page</span>
<a name="l3979"><span class="linenum">3979</span></a>                  if( empty( <a class="var it4000" onMouseOver="hilite(4000)" onMouseOut="lolite()" onClick="logVariable('lightbox_group')" href="../../../_variables/lightbox_group.html">$lightbox_group</a> ) )
<a name="l3980"><span class="linenum">3980</span></a>                  {
<a name="l3981"><span class="linenum">3981</span></a>                      <a class="var it1576" onMouseOver="hilite(1576)" onMouseOut="lolite()" onClick="logVariable('link_rel')" href="../../../_variables/link_rel.html">$link_rel</a> = 'lightbox[l'.<a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a>-&gt;<a onClick="logVariable('ID')" class="var it10745" onMouseOver="hilite(10745)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.<a class="phpfunction" onClick="logFunction('rand')" href="../../../_functions/rand.html" onMouseOver="phpfuncPopup(event,'rand')">rand</a>(0, 100000).']';
<a name="l3982"><span class="linenum">3982</span></a>                  }
<a name="l3983"><span class="linenum">3983</span></a>                  else
<a name="l3984"><span class="linenum">3984</span></a>                  {
<a name="l3985"><span class="linenum">3985</span></a>                      <a class="var it1576" onMouseOver="hilite(1576)" onMouseOut="lolite()" onClick="logVariable('link_rel')" href="../../../_variables/link_rel.html">$link_rel</a> = 'lightbox['.<a class="var it4000" onMouseOver="hilite(4000)" onMouseOut="lolite()" onClick="logVariable('lightbox_group')" href="../../../_variables/lightbox_group.html">$lightbox_group</a>.']';
<a name="l3986"><span class="linenum">3986</span></a>                  }
<a name="l3987"><span class="linenum">3987</span></a>                  <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a>-&gt;<a class="function" onClick="logFunction('get_tag')" href="../../../_functions/get_tag.html" onMouseOver="funcPopup(event,'get_tag')">get_tag</a>( array(
<a name="l3988"><span class="linenum">3988</span></a>                          'before_image'        =&gt; '',
<a name="l3989"><span class="linenum">3989</span></a>                          'before_image_legend' =&gt; '',
<a name="l3990"><span class="linenum">3990</span></a>                          'after_image_legend'  =&gt; '',
<a name="l3991"><span class="linenum">3991</span></a>                          'after_image'         =&gt; '',
<a name="l3992"><span class="linenum">3992</span></a>                          'image_size'          =&gt; <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../../_variables/size.html">$size</a>,
<a name="l3993"><span class="linenum">3993</span></a>                          'image_link_title'    =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>,
<a name="l3994"><span class="linenum">3994</span></a>                          'image_link_rel'      =&gt; <a class="var it1576" onMouseOver="hilite(1576)" onMouseOut="lolite()" onClick="logVariable('link_rel')" href="../../../_variables/link_rel.html">$link_rel</a>,
<a name="l3995"><span class="linenum">3995</span></a>                          'image_class'         =&gt; <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>,
<a name="l3996"><span class="linenum">3996</span></a>                          'image_align'         =&gt; <a class="var it1991" onMouseOver="hilite(1991)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../../_variables/align.html">$align</a>,
<a name="l3997"><span class="linenum">3997</span></a>                          'tag_size'            =&gt; <a class="var it3255" onMouseOver="hilite(3255)" onMouseOut="lolite()" onClick="logVariable('tag_size')" href="../../../_variables/tag_size.html">$tag_size</a>,
<a name="l3998"><span class="linenum">3998</span></a>                      ) );
<a name="l3999"><span class="linenum">3999</span></a>              }
<a name="l4000"><span class="linenum">4000</span></a>              else
<a name="l4001"><span class="linenum">4001</span></a>              { // Anonymous user get an avatar picture with link to login page
<a name="l4002"><span class="linenum">4002</span></a>                  global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l4003"><span class="linenum">4003</span></a>                  <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = '';
<a name="l4004"><span class="linenum">4004</span></a>                  if( isset( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> ) )
<a name="l4005"><span class="linenum">4005</span></a>                  { // Redirect user after login
<a name="l4006"><span class="linenum">4006</span></a>                      <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'userurl', array( 'glue' =&gt; '&amp;', 'url_suffix' =&gt; 'user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l4007"><span class="linenum">4007</span></a>                  }
<a name="l4008"><span class="linenum">4008</span></a>                  <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = '&lt;a href=&quot;'.<a class="function" onClick="logFunction('get_login_url')" href="../../../_functions/get_login_url.html" onMouseOver="funcPopup(event,'get_login_url')">get_login_url</a>( 'cannot see avatar', <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> ) .'&quot;&gt;'.<a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_thumb_imgtag')" href="../../../_functions/get_thumb_imgtag.html" onMouseOver="funcPopup(event,'get_thumb_imgtag')">get_thumb_imgtag</a>( <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../../_variables/size.html">$size</a>, <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>, <a class="var it1991" onMouseOver="hilite(1991)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../../_variables/align.html">$align</a>, '', <a class="var it3255" onMouseOver="hilite(3255)" onMouseOut="lolite()" onClick="logVariable('tag_size')" href="../../../_variables/tag_size.html">$tag_size</a> ).'&lt;/a&gt;';
<a name="l4009"><span class="linenum">4009</span></a>              }
<a name="l4010"><span class="linenum">4010</span></a>          }
<a name="l4011"><span class="linenum">4011</span></a>          else
<a name="l4012"><span class="linenum">4012</span></a>          {
<a name="l4013"><span class="linenum">4013</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_thumb_imgtag')" href="../../../_functions/get_thumb_imgtag.html" onMouseOver="funcPopup(event,'get_thumb_imgtag')">get_thumb_imgtag</a>( <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../../_variables/size.html">$size</a>, <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>, <a class="var it1991" onMouseOver="hilite(1991)" onMouseOut="lolite()" onClick="logVariable('align')" href="../../../_variables/align.html">$align</a>, '', <a class="var it3255" onMouseOver="hilite(3255)" onMouseOut="lolite()" onClick="logVariable('tag_size')" href="../../../_variables/tag_size.html">$tag_size</a> );
<a name="l4014"><span class="linenum">4014</span></a>          }
<a name="l4015"><span class="linenum">4015</span></a>  
<a name="l4016"><span class="linenum">4016</span></a>          if( <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> != '' &amp;&amp; <a class="var it1121" onMouseOver="hilite(1121)" onMouseOut="lolite()" onClick="logVariable('avatar_overlay_text')" href="../../../_variables/avatar_overlay_text.html">$avatar_overlay_text</a> != '' )
<a name="l4017"><span class="linenum">4017</span></a>          { // Add overlay text if it is enabled
<a name="l4018"><span class="linenum">4018</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_avatar_overlay_text')" href="../../../_functions/get_avatar_overlay_text.html" onMouseOver="funcPopup(event,'get_avatar_overlay_text')">get_avatar_overlay_text</a>( <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>, <a class="var it297" onMouseOver="hilite(297)" onMouseOut="lolite()" onClick="logVariable('size')" href="../../../_variables/size.html">$size</a>, <a class="var it1121" onMouseOver="hilite(1121)" onMouseOut="lolite()" onClick="logVariable('avatar_overlay_text')" href="../../../_variables/avatar_overlay_text.html">$avatar_overlay_text</a>, <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>, <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> );
<a name="l4019"><span class="linenum">4019</span></a>          }
<a name="l4020"><span class="linenum">4020</span></a>  
<a name="l4021"><span class="linenum">4021</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l4022"><span class="linenum">4022</span></a>      }
<a name="l4023"><span class="linenum">4023</span></a>  
<a name="l4024"><span class="linenum">4024</span></a>  
<a name="l4025"><span class="linenum">4025</span></a>      <span class="comment">/**</span>
<a name="l4026"><span class="linenum">4026</span></a>  <span class="comment">     * Get overlay text for avatar img tag</span>
<a name="l4027"><span class="linenum">4027</span></a>  <span class="comment">     *</span>
<a name="l4028"><span class="linenum">4028</span></a>  <span class="comment">     * @param string Tag &lt;img /&gt;</span>
<a name="l4029"><span class="linenum">4029</span></a>  <span class="comment">     * @param array Avatar size, keys: 'width' &amp; 'height'</span>
<a name="l4030"><span class="linenum">4030</span></a>  <span class="comment">     * @param string Avatar overlay text</span>
<a name="l4031"><span class="linenum">4031</span></a>  <span class="comment">     * @param string Class</span>
<a name="l4032"><span class="linenum">4032</span></a>  <span class="comment">     * @param object File</span>
<a name="l4033"><span class="linenum">4033</span></a>  <span class="comment">     * @return string Tag &lt;img /&gt; with overlay text</span>
<a name="l4034"><span class="linenum">4034</span></a>  <span class="comment">     */</span>
<a name="l4035"><span class="linenum">4035</span></a>  	function <a class="function" onClick="logFunction('get_avatar_overlay_text')" href="../../../_functions/get_avatar_overlay_text.html" onMouseOver="funcPopup(event,'get_avatar_overlay_text')">get_avatar_overlay_text</a>( <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a>, <a class="var it3430" onMouseOver="hilite(3430)" onMouseOut="lolite()" onClick="logVariable('thumb_size')" href="../../../_variables/thumb_size.html">$thumb_size</a>, <a class="var it1121" onMouseOver="hilite(1121)" onMouseOut="lolite()" onClick="logVariable('avatar_overlay_text')" href="../../../_variables/avatar_overlay_text.html">$avatar_overlay_text</a>, <a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a> = '', <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = NULL )
<a name="l4036"><span class="linenum">4036</span></a>      {
<a name="l4037"><span class="linenum">4037</span></a>          <a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '/ width=&quot;(\d+)&quot; height=&quot;(\d+)&quot; /i', <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a>, <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('img_sizes')" href="../../../_variables/img_sizes.html">$img_sizes</a> );
<a name="l4038"><span class="linenum">4038</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('img_sizes')" href="../../../_variables/img_sizes.html">$img_sizes</a> ) == 3 )
<a name="l4039"><span class="linenum">4039</span></a>          { // img tag has a defined width &amp; height
<a name="l4040"><span class="linenum">4040</span></a>              <a class="var it1123" onMouseOver="hilite(1123)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../../_variables/width.html">$width</a> = <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('img_sizes')" href="../../../_variables/img_sizes.html">$img_sizes</a>[1];
<a name="l4041"><span class="linenum">4041</span></a>              <a class="var it1124" onMouseOver="hilite(1124)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../../_variables/height.html">$height</a> = <a class="var it4001" onMouseOver="hilite(4001)" onMouseOut="lolite()" onClick="logVariable('img_sizes')" href="../../../_variables/img_sizes.html">$img_sizes</a>[2];
<a name="l4042"><span class="linenum">4042</span></a>          }
<a name="l4043"><span class="linenum">4043</span></a>          else
<a name="l4044"><span class="linenum">4044</span></a>          { // We try to get a sizes from config
<a name="l4045"><span class="linenum">4045</span></a>              global <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>;
<a name="l4046"><span class="linenum">4046</span></a>              if( isset( <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[ <a class="var it3430" onMouseOver="hilite(3430)" onMouseOut="lolite()" onClick="logVariable('thumb_size')" href="../../../_variables/thumb_size.html">$thumb_size</a> ] ) )
<a name="l4047"><span class="linenum">4047</span></a>              { // Set a sizes
<a name="l4048"><span class="linenum">4048</span></a>                  if( ! <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> ) &amp;&amp; <a class="var it4002" onMouseOver="hilite(4002)" onMouseOut="lolite()" onClick="logVariable('thumb_sizes')" href="../../../_variables/thumb_sizes.html">$thumb_sizes</a> = <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_thumb_size')" href="../../../_functions/get_thumb_size.html" onMouseOver="funcPopup(event,'get_thumb_size')">get_thumb_size</a>( <a class="var it3430" onMouseOver="hilite(3430)" onMouseOut="lolite()" onClick="logVariable('thumb_size')" href="../../../_variables/thumb_size.html">$thumb_size</a> ) )
<a name="l4049"><span class="linenum">4049</span></a>                  { // Get sizes that are used for thumbnail really
<a name="l4050"><span class="linenum">4050</span></a>                      <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it1123" onMouseOver="hilite(1123)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../../_variables/width.html">$width</a>, <a class="var it1124" onMouseOver="hilite(1124)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../../_variables/height.html">$height</a> ) = <a class="var it4002" onMouseOver="hilite(4002)" onMouseOut="lolite()" onClick="logVariable('thumb_sizes')" href="../../../_variables/thumb_sizes.html">$thumb_sizes</a>;
<a name="l4051"><span class="linenum">4051</span></a>                  }
<a name="l4052"><span class="linenum">4052</span></a>                  else
<a name="l4053"><span class="linenum">4053</span></a>                  { // Use the size of thumbnail config if File is not defined
<a name="l4054"><span class="linenum">4054</span></a>                      <a class="var it1123" onMouseOver="hilite(1123)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../../_variables/width.html">$width</a> = <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[ <a class="var it3430" onMouseOver="hilite(3430)" onMouseOut="lolite()" onClick="logVariable('thumb_size')" href="../../../_variables/thumb_size.html">$thumb_size</a> ][1];
<a name="l4055"><span class="linenum">4055</span></a>                      <a class="var it1124" onMouseOver="hilite(1124)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../../_variables/height.html">$height</a> = <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[ <a class="var it3430" onMouseOver="hilite(3430)" onMouseOut="lolite()" onClick="logVariable('thumb_size')" href="../../../_variables/thumb_size.html">$thumb_size</a> ][2];
<a name="l4056"><span class="linenum">4056</span></a>                  }
<a name="l4057"><span class="linenum">4057</span></a>              }
<a name="l4058"><span class="linenum">4058</span></a>          }
<a name="l4059"><span class="linenum">4059</span></a>  
<a name="l4060"><span class="linenum">4060</span></a>          if( empty( <a class="var it1123" onMouseOver="hilite(1123)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../../_variables/width.html">$width</a> ) || empty( <a class="var it1124" onMouseOver="hilite(1124)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../../_variables/height.html">$height</a> ) )
<a name="l4061"><span class="linenum">4061</span></a>          { // If sizes is not defined we cannot calculate a font-size for an overlay text
<a name="l4062"><span class="linenum">4062</span></a>              return <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a>;
<a name="l4063"><span class="linenum">4063</span></a>          }
<a name="l4064"><span class="linenum">4064</span></a>  
<a name="l4065"><span class="linenum">4065</span></a>          <a class="var it4003" onMouseOver="hilite(4003)" onMouseOut="lolite()" onClick="logVariable('overlay_lines')" href="../../../_variables/overlay_lines.html">$overlay_lines</a> = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( &quot;\n&quot;, <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( &quot;\r&quot;, '', <a class="var it1121" onMouseOver="hilite(1121)" onMouseOut="lolite()" onClick="logVariable('avatar_overlay_text')" href="../../../_variables/avatar_overlay_text.html">$avatar_overlay_text</a> ) );
<a name="l4066"><span class="linenum">4066</span></a>          <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('max_line_length')" href="../../../_variables/max_line_length.html">$max_line_length</a> = 0;
<a name="l4067"><span class="linenum">4067</span></a>          foreach( <a class="var it4003" onMouseOver="hilite(4003)" onMouseOut="lolite()" onClick="logVariable('overlay_lines')" href="../../../_variables/overlay_lines.html">$overlay_lines</a> as <a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../../_variables/line.html">$line</a> )
<a name="l4068"><span class="linenum">4068</span></a>          { // Find the most long line of the overlay text
<a name="l4069"><span class="linenum">4069</span></a>              if( <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('max_line_length')" href="../../../_variables/max_line_length.html">$max_line_length</a> &lt; strlen(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../../_variables/line.html">$line</a>) )
<a name="l4070"><span class="linenum">4070</span></a>              {    // Get max long line
<a name="l4071"><span class="linenum">4071</span></a>                  <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('max_line_length')" href="../../../_variables/max_line_length.html">$max_line_length</a> = strlen(<a class="var it20" onMouseOver="hilite(20)" onMouseOut="lolite()" onClick="logVariable('line')" href="../../../_variables/line.html">$line</a>);
<a name="l4072"><span class="linenum">4072</span></a>              }
<a name="l4073"><span class="linenum">4073</span></a>          }
<a name="l4074"><span class="linenum">4074</span></a>          if( <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('max_line_length')" href="../../../_variables/max_line_length.html">$max_line_length</a> &gt; 0 )
<a name="l4075"><span class="linenum">4075</span></a>          { // Display an overlay text if max length is defined
<a name="l4076"><span class="linenum">4076</span></a>  <span class="comment">            // Calculate approximate font size, 1.7 - is custom coefficient of the font</span>
<a name="l4077"><span class="linenum">4077</span></a>              <a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('font_size')" href="../../../_variables/font_size.html">$font_size</a> = <a class="phpfunction" onClick="logFunction('ceil')" href="../../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>( ( <a class="var it1123" onMouseOver="hilite(1123)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../../_variables/width.html">$width</a> / <a class="var it4004" onMouseOver="hilite(4004)" onMouseOut="lolite()" onClick="logVariable('max_line_length')" href="../../../_variables/max_line_length.html">$max_line_length</a> ) * 1.7 );
<a name="l4078"><span class="linenum">4078</span></a>  <span class="comment">            // Set line-height for centering text by vertical</span>
<a name="l4079"><span class="linenum">4079</span></a>              <a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('line_height')" href="../../../_variables/line_height.html">$line_height</a> = <a class="phpfunction" onClick="logFunction('ceil')" href="../../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>( ( <a class="var it1124" onMouseOver="hilite(1124)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../../_variables/height.html">$height</a> / <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4003" onMouseOver="hilite(4003)" onMouseOut="lolite()" onClick="logVariable('overlay_lines')" href="../../../_variables/overlay_lines.html">$overlay_lines</a> ) ) * 0.82 );
<a name="l4080"><span class="linenum">4080</span></a>  <span class="comment">            // Padding-top give us a vertical centering</span>
<a name="l4081"><span class="linenum">4081</span></a>              <a class="var it4005" onMouseOver="hilite(4005)" onMouseOut="lolite()" onClick="logVariable('padding_top')" href="../../../_variables/padding_top.html">$padding_top</a> = <a class="phpfunction" onClick="logFunction('ceil')" href="../../../_functions/ceil.html" onMouseOver="phpfuncPopup(event,'ceil')">ceil</a>( <a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('line_height')" href="../../../_variables/line_height.html">$line_height</a> * 0.32 );
<a name="l4082"><span class="linenum">4082</span></a>  
<a name="l4083"><span class="linenum">4083</span></a>              <a class="var it4006" onMouseOver="hilite(4006)" onMouseOut="lolite()" onClick="logVariable('tag_is_linked')" href="../../../_variables/tag_is_linked.html">$tag_is_linked</a> = false;
<a name="l4084"><span class="linenum">4084</span></a>              if( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a>, '&lt;/a&gt;' ) !== false )
<a name="l4085"><span class="linenum">4085</span></a>              { // img_tag is located inside tag &lt;a&gt;, we should to remove a end of the tag and then add
<a name="l4086"><span class="linenum">4086</span></a>                  <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../../../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( '&lt;/a&gt;', '', <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a> );
<a name="l4087"><span class="linenum">4087</span></a>                  <a class="var it4006" onMouseOver="hilite(4006)" onMouseOut="lolite()" onClick="logVariable('tag_is_linked')" href="../../../_variables/tag_is_linked.html">$tag_is_linked</a> = true;
<a name="l4088"><span class="linenum">4088</span></a>              }
<a name="l4089"><span class="linenum">4089</span></a>              <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a> = '&lt;div class=&quot;bubletip_overlay_text '.<a class="var it287" onMouseOver="hilite(287)" onMouseOut="lolite()" onClick="logVariable('class')" href="../../../_variables/class.html">$class</a>.'&quot;&gt;'.
<a name="l4090"><span class="linenum">4090</span></a>                      <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a>.
<a name="l4091"><span class="linenum">4091</span></a>                      '&lt;div style=&quot;font-size:'.<a class="var it2082" onMouseOver="hilite(2082)" onMouseOut="lolite()" onClick="logVariable('font_size')" href="../../../_variables/font_size.html">$font_size</a>.'px;line-height:'.<a class="var it602" onMouseOver="hilite(602)" onMouseOut="lolite()" onClick="logVariable('line_height')" href="../../../_variables/line_height.html">$line_height</a>.'px;padding-top:'.<a class="var it4005" onMouseOver="hilite(4005)" onMouseOut="lolite()" onClick="logVariable('padding_top')" href="../../../_variables/padding_top.html">$padding_top</a>.'px&quot;&gt;'.
<a name="l4092"><span class="linenum">4092</span></a>                          <a class="phpfunction" onClick="logFunction('nl2br')" href="../../../_functions/nl2br.html" onMouseOver="phpfuncPopup(event,'nl2br')">nl2br</a>(<a class="var it1121" onMouseOver="hilite(1121)" onMouseOut="lolite()" onClick="logVariable('avatar_overlay_text')" href="../../../_variables/avatar_overlay_text.html">$avatar_overlay_text</a>).
<a name="l4093"><span class="linenum">4093</span></a>                      '&lt;/div&gt;';
<a name="l4094"><span class="linenum">4094</span></a>              if( <a class="var it4006" onMouseOver="hilite(4006)" onMouseOut="lolite()" onClick="logVariable('tag_is_linked')" href="../../../_variables/tag_is_linked.html">$tag_is_linked</a> )
<a name="l4095"><span class="linenum">4095</span></a>              { // Add end of the tag which is removed above
<a name="l4096"><span class="linenum">4096</span></a>                  <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a> .= '&lt;/a&gt;';
<a name="l4097"><span class="linenum">4097</span></a>              }
<a name="l4098"><span class="linenum">4098</span></a>              <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a> .= '&lt;/div&gt;';
<a name="l4099"><span class="linenum">4099</span></a>          }
<a name="l4100"><span class="linenum">4100</span></a>  
<a name="l4101"><span class="linenum">4101</span></a>          return <a class="var it3242" onMouseOver="hilite(3242)" onMouseOut="lolite()" onClick="logVariable('img_tag')" href="../../../_variables/img_tag.html">$img_tag</a>;
<a name="l4102"><span class="linenum">4102</span></a>      }
<a name="l4103"><span class="linenum">4103</span></a>  
<a name="l4104"><span class="linenum">4104</span></a>  
<a name="l4105"><span class="linenum">4105</span></a>      <span class="comment">/**</span>
<a name="l4106"><span class="linenum">4106</span></a>  <span class="comment">     * Get styled avatar</span>
<a name="l4107"><span class="linenum">4107</span></a>  <span class="comment">     *</span>
<a name="l4108"><span class="linenum">4108</span></a>  <span class="comment">     * @param array params</span>
<a name="l4109"><span class="linenum">4109</span></a>  <span class="comment">     * @return string</span>
<a name="l4110"><span class="linenum">4110</span></a>  <span class="comment">     */</span>
<a name="l4111"><span class="linenum">4111</span></a>  	function <a class="function" onClick="logFunction('get_avatar_styled')" href="../../../_functions/get_avatar_styled.html" onMouseOver="funcPopup(event,'get_avatar_styled')">get_avatar_styled</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l4112"><span class="linenum">4112</span></a>      {
<a name="l4113"><span class="linenum">4113</span></a>          global <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>;
<a name="l4114"><span class="linenum">4114</span></a>  
<a name="l4115"><span class="linenum">4115</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l4116"><span class="linenum">4116</span></a>                  'block_class'  =&gt; 'avatar_rounded',
<a name="l4117"><span class="linenum">4117</span></a>                  'size'         =&gt; 'crop-top-64x64',
<a name="l4118"><span class="linenum">4118</span></a>                  'avatar_class' =&gt; 'avatar',
<a name="l4119"><span class="linenum">4119</span></a>                  'zoomable'     =&gt; false,
<a name="l4120"><span class="linenum">4120</span></a>                  'overlay_text' =&gt; '',
<a name="l4121"><span class="linenum">4121</span></a>                  'show_login'   =&gt; true,
<a name="l4122"><span class="linenum">4122</span></a>                  'bubbletip'    =&gt; true,
<a name="l4123"><span class="linenum">4123</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l4124"><span class="linenum">4124</span></a>  
<a name="l4125"><span class="linenum">4125</span></a>          <a class="var it3248" onMouseOver="hilite(3248)" onMouseOut="lolite()" onClick="logVariable('bubbletip_param')" href="../../../_variables/bubbletip_param.html">$bubbletip_param</a> = '';
<a name="l4126"><span class="linenum">4126</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['bubbletip'] )
<a name="l4127"><span class="linenum">4127</span></a>          {    // Init bubbletip param
<a name="l4128"><span class="linenum">4128</span></a>              <a class="var it3248" onMouseOver="hilite(3248)" onMouseOut="lolite()" onClick="logVariable('bubbletip_param')" href="../../../_variables/bubbletip_param.html">$bubbletip_param</a> = 'rel=&quot;bubbletip_user_'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&quot;';
<a name="l4129"><span class="linenum">4129</span></a>          }
<a name="l4130"><span class="linenum">4130</span></a>  
<a name="l4131"><span class="linenum">4131</span></a>          <a class="var it3249" onMouseOver="hilite(3249)" onMouseOut="lolite()" onClick="logVariable('style_width')" href="../../../_variables/style_width.html">$style_width</a> = '';
<a name="l4132"><span class="linenum">4132</span></a>          if( isset( <a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['size']] ) )
<a name="l4133"><span class="linenum">4133</span></a>          {
<a name="l4134"><span class="linenum">4134</span></a>              <a class="var it3249" onMouseOver="hilite(3249)" onMouseOut="lolite()" onClick="logVariable('style_width')" href="../../../_variables/style_width.html">$style_width</a> = ' style=&quot;width:'.<a class="var it586" onMouseOver="hilite(586)" onMouseOut="lolite()" onClick="logVariable('thumbnail_sizes')" href="../../../_variables/thumbnail_sizes.html">$thumbnail_sizes</a>[<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['size']][1].'px&quot;';
<a name="l4135"><span class="linenum">4135</span></a>          }
<a name="l4136"><span class="linenum">4136</span></a>  
<a name="l4137"><span class="linenum">4137</span></a>          <a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('identity_url')" href="../../../_variables/identity_url.html">$identity_url</a> = <a class="function" onClick="logFunction('get_user_identity_url')" href="../../../_functions/get_user_identity_url.html" onMouseOver="funcPopup(event,'get_user_identity_url')">get_user_identity_url</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4138"><span class="linenum">4138</span></a>  
<a name="l4139"><span class="linenum">4139</span></a>          if( !empty( <a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('identity_url')" href="../../../_variables/identity_url.html">$identity_url</a> ) )
<a name="l4140"><span class="linenum">4140</span></a>          {
<a name="l4141"><span class="linenum">4141</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = '&lt;a href=&quot;'.<a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('identity_url')" href="../../../_variables/identity_url.html">$identity_url</a>.'&quot; class=&quot;'.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['block_class'].'&quot;'.<a class="var it3248" onMouseOver="hilite(3248)" onMouseOut="lolite()" onClick="logVariable('bubbletip_param')" href="../../../_variables/bubbletip_param.html">$bubbletip_param</a>.<a class="var it3249" onMouseOver="hilite(3249)" onMouseOut="lolite()" onClick="logVariable('style_width')" href="../../../_variables/style_width.html">$style_width</a>.'&gt;';
<a name="l4142"><span class="linenum">4142</span></a>          }
<a name="l4143"><span class="linenum">4143</span></a>          else
<a name="l4144"><span class="linenum">4144</span></a>          {
<a name="l4145"><span class="linenum">4145</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = '&lt;div class=&quot;'.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['block_class'].'&quot;'.<a class="var it3248" onMouseOver="hilite(3248)" onMouseOut="lolite()" onClick="logVariable('bubbletip_param')" href="../../../_variables/bubbletip_param.html">$bubbletip_param</a>.<a class="var it3249" onMouseOver="hilite(3249)" onMouseOut="lolite()" onClick="logVariable('style_width')" href="../../../_variables/style_width.html">$style_width</a>.'&gt;';
<a name="l4146"><span class="linenum">4146</span></a>          }
<a name="l4147"><span class="linenum">4147</span></a>  
<a name="l4148"><span class="linenum">4148</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_avatar_imgtag')" href="../../../_functions/get_avatar_imgtag.html" onMouseOver="funcPopup(event,'get_avatar_imgtag')">get_avatar_imgtag</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['size'], <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['avatar_class'], '', <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['zoomable'], <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['overlay_text'] );
<a name="l4149"><span class="linenum">4149</span></a>  
<a name="l4150"><span class="linenum">4150</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['show_login'] )
<a name="l4151"><span class="linenum">4151</span></a>          {    // Display user name
<a name="l4152"><span class="linenum">4152</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_colored_login')" href="../../../_functions/get_colored_login.html" onMouseOver="funcPopup(event,'get_colored_login')">get_colored_login</a>( array( 'login_text' =&gt; 'name' ) );
<a name="l4153"><span class="linenum">4153</span></a>          }
<a name="l4154"><span class="linenum">4154</span></a>  
<a name="l4155"><span class="linenum">4155</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> .= !empty( <a class="var it176" onMouseOver="hilite(176)" onMouseOut="lolite()" onClick="logVariable('identity_url')" href="../../../_variables/identity_url.html">$identity_url</a> ) ? '&lt;/a&gt;' : '&lt;/div&gt;';
<a name="l4156"><span class="linenum">4156</span></a>  
<a name="l4157"><span class="linenum">4157</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l4158"><span class="linenum">4158</span></a>      }
<a name="l4159"><span class="linenum">4159</span></a>  
<a name="l4160"><span class="linenum">4160</span></a>  
<a name="l4161"><span class="linenum">4161</span></a>      <span class="comment">/**</span>
<a name="l4162"><span class="linenum">4162</span></a>  <span class="comment">     * Add a user field</span>
<a name="l4163"><span class="linenum">4163</span></a>  <span class="comment">     */</span>
<a name="l4164"><span class="linenum">4164</span></a>  	function <a class="function" onClick="logFunction('userfield_add')" href="../../../_functions/userfield_add.html" onMouseOver="funcPopup(event,'userfield_add')">userfield_add</a>( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>, <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> )
<a name="l4165"><span class="linenum">4165</span></a>      {
<a name="l4166"><span class="linenum">4166</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l4167"><span class="linenum">4167</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('new_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/new_fields.html">new_fields</a>[] = <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> );
<a name="l4168"><span class="linenum">4168</span></a>      }
<a name="l4169"><span class="linenum">4169</span></a>  
<a name="l4170"><span class="linenum">4170</span></a>  
<a name="l4171"><span class="linenum">4171</span></a>      <span class="comment">/**</span>
<a name="l4172"><span class="linenum">4172</span></a>  <span class="comment">     * Update an user field. Empty fields will be deleted on dbupdate.</span>
<a name="l4173"><span class="linenum">4173</span></a>  <span class="comment">     */</span>
<a name="l4174"><span class="linenum">4174</span></a>  	function <a class="function" onClick="logFunction('userfield_update')" href="../../../_functions/userfield_update.html" onMouseOver="funcPopup(event,'userfield_update')">userfield_update</a>( <a class="var it3329" onMouseOver="hilite(3329)" onMouseOut="lolite()" onClick="logVariable('uf_ID')" href="../../../_variables/uf_ID.html">$uf_ID</a>, <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a> )
<a name="l4175"><span class="linenum">4175</span></a>      {
<a name="l4176"><span class="linenum">4176</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l4177"><span class="linenum">4177</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('updated_fields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/updated_fields.html">updated_fields</a>[<a class="var it3329" onMouseOver="hilite(3329)" onMouseOut="lolite()" onClick="logVariable('uf_ID')" href="../../../_variables/uf_ID.html">$uf_ID</a>] = <a class="var it708" onMouseOver="hilite(708)" onMouseOut="lolite()" onClick="logVariable('val')" href="../../../_variables/val.html">$val</a>;
<a name="l4178"><span class="linenum">4178</span></a>  <span class="comment">        // pre_dump( $uf_ID, $val);</span>
<a name="l4179"><span class="linenum">4179</span></a>      }
<a name="l4180"><span class="linenum">4180</span></a>  
<a name="l4181"><span class="linenum">4181</span></a>  
<a name="l4182"><span class="linenum">4182</span></a>      <span class="comment">/**</span>
<a name="l4183"><span class="linenum">4183</span></a>  <span class="comment">     * Get all user extra fields with selected type</span>
<a name="l4184"><span class="linenum">4184</span></a>  <span class="comment">     *</span>
<a name="l4185"><span class="linenum">4185</span></a>  <span class="comment">     * @param string Field type: 'email', 'word', 'number', 'phone', 'text'</span>
<a name="l4186"><span class="linenum">4186</span></a>  <span class="comment">     * @param boolean TRUE to get only the fields with icon</span>
<a name="l4187"><span class="linenum">4187</span></a>  <span class="comment">     * @return array Fields</span>
<a name="l4188"><span class="linenum">4188</span></a>  <span class="comment">     */</span>
<a name="l4189"><span class="linenum">4189</span></a>  	function <a class="function" onClick="logFunction('userfields_by_type')" href="../../../_functions/userfields_by_type.html" onMouseOver="funcPopup(event,'userfields_by_type')">userfields_by_type</a>( <a class="var it3899" onMouseOver="hilite(3899)" onMouseOut="lolite()" onClick="logVariable('field_type')" href="../../../_variables/field_type.html">$field_type</a>, <a class="var it4007" onMouseOver="hilite(4007)" onMouseOut="lolite()" onClick="logVariable('only_with_icon')" href="../../../_variables/only_with_icon.html">$only_with_icon</a> = true )
<a name="l4190"><span class="linenum">4190</span></a>      {
<a name="l4191"><span class="linenum">4191</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l4192"><span class="linenum">4192</span></a>  
<a name="l4193"><span class="linenum">4193</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l4194"><span class="linenum">4194</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'uf_varchar, ufdf_ID, ufdf_icon_name, ufdf_code' );
<a name="l4195"><span class="linenum">4195</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users__fields' );
<a name="l4196"><span class="linenum">4196</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_users__fielddefs ON uf_ufdf_ID = ufdf_ID' );
<a name="l4197"><span class="linenum">4197</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'uf_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4198"><span class="linenum">4198</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'ufdf_type = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3899" onMouseOver="hilite(3899)" onMouseOut="lolite()" onClick="logVariable('field_type')" href="../../../_variables/field_type.html">$field_type</a> ) );
<a name="l4199"><span class="linenum">4199</span></a>          if( <a class="var it4007" onMouseOver="hilite(4007)" onMouseOut="lolite()" onClick="logVariable('only_with_icon')" href="../../../_variables/only_with_icon.html">$only_with_icon</a> )
<a name="l4200"><span class="linenum">4200</span></a>          {
<a name="l4201"><span class="linenum">4201</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'ufdf_icon_name IS NOT NULL' );
<a name="l4202"><span class="linenum">4202</span></a>          }
<a name="l4203"><span class="linenum">4203</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'ufdf_order' );
<a name="l4204"><span class="linenum">4204</span></a>  
<a name="l4205"><span class="linenum">4205</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l4206"><span class="linenum">4206</span></a>      }
<a name="l4207"><span class="linenum">4207</span></a>  
<a name="l4208"><span class="linenum">4208</span></a>  
<a name="l4209"><span class="linenum">4209</span></a>      <span class="comment">/**</span>
<a name="l4210"><span class="linenum">4210</span></a>  <span class="comment">     * Get user field value by ID</span>
<a name="l4211"><span class="linenum">4211</span></a>  <span class="comment">     *</span>
<a name="l4212"><span class="linenum">4212</span></a>  <span class="comment">     * @param integer Field ID</span>
<a name="l4213"><span class="linenum">4213</span></a>  <span class="comment">     * @return string Field value</span>
<a name="l4214"><span class="linenum">4214</span></a>  <span class="comment">     */</span>
<a name="l4215"><span class="linenum">4215</span></a>  	function <a class="function" onClick="logFunction('userfield_value_by_ID')" href="../../../_functions/userfield_value_by_id.html" onMouseOver="funcPopup(event,'userfield_value_by_id')">userfield_value_by_ID</a>( <a class="var it1146" onMouseOver="hilite(1146)" onMouseOut="lolite()" onClick="logVariable('field_ID')" href="../../../_variables/field_ID.html">$field_ID</a> )
<a name="l4216"><span class="linenum">4216</span></a>      {
<a name="l4217"><span class="linenum">4217</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l4218"><span class="linenum">4218</span></a>  
<a name="l4219"><span class="linenum">4219</span></a>  <span class="comment">        // Load all user fields once</span>
<a name="l4220"><span class="linenum">4220</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfields_load')" href="../../../_functions/userfields_load.html" onMouseOver="funcPopup(event,'userfields_load')">userfields_load</a>();
<a name="l4221"><span class="linenum">4221</span></a>  
<a name="l4222"><span class="linenum">4222</span></a>          if( isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_type')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_type.html">userfields_by_type</a>[ <a class="var it1146" onMouseOver="hilite(1146)" onMouseOut="lolite()" onClick="logVariable('field_ID')" href="../../../_variables/field_ID.html">$field_ID</a> ], <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields.html">userfields</a>[ <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_type')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_type.html">userfields_by_type</a>[ <a class="var it1146" onMouseOver="hilite(1146)" onMouseOut="lolite()" onClick="logVariable('field_ID')" href="../../../_variables/field_ID.html">$field_ID</a> ][0] ] ) )
<a name="l4223"><span class="linenum">4223</span></a>          { // Get value from cache
<a name="l4224"><span class="linenum">4224</span></a>              return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields.html">userfields</a>[ <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_type')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_type.html">userfields_by_type</a>[ <a class="var it1146" onMouseOver="hilite(1146)" onMouseOut="lolite()" onClick="logVariable('field_ID')" href="../../../_variables/field_ID.html">$field_ID</a> ][0] ]-&gt;uf_varchar;
<a name="l4225"><span class="linenum">4225</span></a>          }
<a name="l4226"><span class="linenum">4226</span></a>  
<a name="l4227"><span class="linenum">4227</span></a>  <span class="comment">        // No field value</span>
<a name="l4228"><span class="linenum">4228</span></a>          return '';
<a name="l4229"><span class="linenum">4229</span></a>      }
<a name="l4230"><span class="linenum">4230</span></a>  
<a name="l4231"><span class="linenum">4231</span></a>  
<a name="l4232"><span class="linenum">4232</span></a>      <span class="comment">/**</span>
<a name="l4233"><span class="linenum">4233</span></a>  <span class="comment">     * Get user field values by code</span>
<a name="l4234"><span class="linenum">4234</span></a>  <span class="comment">     *</span>
<a name="l4235"><span class="linenum">4235</span></a>  <span class="comment">     * @param integer Field code</span>
<a name="l4236"><span class="linenum">4236</span></a>  <span class="comment">     * @return array Field values</span>
<a name="l4237"><span class="linenum">4237</span></a>  <span class="comment">     */</span>
<a name="l4238"><span class="linenum">4238</span></a>  	function <a class="function" onClick="logFunction('userfield_values_by_code')" href="../../../_functions/userfield_values_by_code.html" onMouseOver="funcPopup(event,'userfield_values_by_code')">userfield_values_by_code</a>( <a class="var it4008" onMouseOver="hilite(4008)" onMouseOut="lolite()" onClick="logVariable('field_code')" href="../../../_variables/field_code.html">$field_code</a> )
<a name="l4239"><span class="linenum">4239</span></a>      {
<a name="l4240"><span class="linenum">4240</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l4241"><span class="linenum">4241</span></a>  
<a name="l4242"><span class="linenum">4242</span></a>  <span class="comment">        // Load all user fields once</span>
<a name="l4243"><span class="linenum">4243</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfields_load')" href="../../../_functions/userfields_load.html" onMouseOver="funcPopup(event,'userfields_load')">userfields_load</a>();
<a name="l4244"><span class="linenum">4244</span></a>  
<a name="l4245"><span class="linenum">4245</span></a>          <a class="var it4009" onMouseOver="hilite(4009)" onMouseOut="lolite()" onClick="logVariable('field_values')" href="../../../_variables/field_values.html">$field_values</a> = array();
<a name="l4246"><span class="linenum">4246</span></a>          if( ! empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_code')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_code.html">userfields_by_code</a>[ <a class="var it4008" onMouseOver="hilite(4008)" onMouseOut="lolite()" onClick="logVariable('field_code')" href="../../../_variables/field_code.html">$field_code</a> ] ) )
<a name="l4247"><span class="linenum">4247</span></a>          { // Get value from cache
<a name="l4248"><span class="linenum">4248</span></a>              foreach( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_code')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_code.html">userfields_by_code</a>[ <a class="var it4008" onMouseOver="hilite(4008)" onMouseOut="lolite()" onClick="logVariable('field_code')" href="../../../_variables/field_code.html">$field_code</a> ] as <a class="var it3900" onMouseOver="hilite(3900)" onMouseOut="lolite()" onClick="logVariable('userfield_ID')" href="../../../_variables/userfield_ID.html">$userfield_ID</a> )
<a name="l4249"><span class="linenum">4249</span></a>              {
<a name="l4250"><span class="linenum">4250</span></a>                  <a class="var it4009" onMouseOver="hilite(4009)" onMouseOut="lolite()" onClick="logVariable('field_values')" href="../../../_variables/field_values.html">$field_values</a>[] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields.html">userfields</a>[ <a class="var it3900" onMouseOver="hilite(3900)" onMouseOut="lolite()" onClick="logVariable('userfield_ID')" href="../../../_variables/userfield_ID.html">$userfield_ID</a> ]-&gt;uf_varchar;
<a name="l4251"><span class="linenum">4251</span></a>              }
<a name="l4252"><span class="linenum">4252</span></a>          }
<a name="l4253"><span class="linenum">4253</span></a>  
<a name="l4254"><span class="linenum">4254</span></a>          return <a class="var it4009" onMouseOver="hilite(4009)" onMouseOut="lolite()" onClick="logVariable('field_values')" href="../../../_variables/field_values.html">$field_values</a>;
<a name="l4255"><span class="linenum">4255</span></a>      }
<a name="l4256"><span class="linenum">4256</span></a>  
<a name="l4257"><span class="linenum">4257</span></a>  
<a name="l4258"><span class="linenum">4258</span></a>      <span class="comment">/**</span>
<a name="l4259"><span class="linenum">4259</span></a>  <span class="comment">     * Load userfields</span>
<a name="l4260"><span class="linenum">4260</span></a>  <span class="comment">     */</span>
<a name="l4261"><span class="linenum">4261</span></a>  	function <a class="function" onClick="logFunction('userfields_load')" href="../../../_functions/userfields_load.html" onMouseOver="funcPopup(event,'userfields_load')">userfields_load</a>()
<a name="l4262"><span class="linenum">4262</span></a>      {
<a name="l4263"><span class="linenum">4263</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l4264"><span class="linenum">4264</span></a>  
<a name="l4265"><span class="linenum">4265</span></a>          <a class="var it1147" onMouseOver="hilite(1147)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../../_variables/userfields.html">$userfields</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( '
<a name="l4266"><span class="linenum">4266</span></a>              SELECT uf_ID, ufdf_ID, uf_varchar, ufdf_duplicated, ufdf_type, ufdf_name, ufdf_icon_name, ufdf_code, ufgp_ID, ufgp_name
<a name="l4267"><span class="linenum">4267</span></a>                  FROM T_users__fields
<a name="l4268"><span class="linenum">4268</span></a>                      INNER JOIN T_users__fielddefs ON uf_ufdf_ID = ufdf_ID
<a name="l4269"><span class="linenum">4269</span></a>                      INNER JOIN T_users__fieldgroups ON ufdf_ufgp_ID = ufgp_ID
<a name="l4270"><span class="linenum">4270</span></a>              WHERE uf_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l4271"><span class="linenum">4271</span></a>                  AND ufdf_required != &quot;hidden&quot;
<a name="l4272"><span class="linenum">4272</span></a>              ORDER BY ufgp_order, ufdf_order, uf_ID' );
<a name="l4273"><span class="linenum">4273</span></a>  
<a name="l4274"><span class="linenum">4274</span></a>          <a class="var it4010" onMouseOver="hilite(4010)" onMouseOut="lolite()" onClick="logVariable('userfield_lists')" href="../../../_variables/userfield_lists.html">$userfield_lists</a> = array();
<a name="l4275"><span class="linenum">4275</span></a>          foreach( <a class="var it1147" onMouseOver="hilite(1147)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../../_variables/userfields.html">$userfields</a> as <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a> )
<a name="l4276"><span class="linenum">4276</span></a>          {
<a name="l4277"><span class="linenum">4277</span></a>              if( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_duplicated')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_duplicated.html">ufdf_duplicated</a> == 'list' )
<a name="l4278"><span class="linenum">4278</span></a>              { // Prepare a values of list into one array
<a name="l4279"><span class="linenum">4279</span></a>                  if( !isset( <a class="var it4010" onMouseOver="hilite(4010)" onMouseOut="lolite()" onClick="logVariable('userfield_lists')" href="../../../_variables/userfield_lists.html">$userfield_lists</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>] ) )
<a name="l4280"><span class="linenum">4280</span></a>                  {    // Init array
<a name="l4281"><span class="linenum">4281</span></a>                      <a class="var it4010" onMouseOver="hilite(4010)" onMouseOut="lolite()" onClick="logVariable('userfield_lists')" href="../../../_variables/userfield_lists.html">$userfield_lists</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>] = array();
<a name="l4282"><span class="linenum">4282</span></a>                  }
<a name="l4283"><span class="linenum">4283</span></a>                  <a class="function" onClick="logFunction('userfield_prepare')" href="../../../_functions/userfield_prepare.html" onMouseOver="funcPopup(event,'userfield_prepare')">userfield_prepare</a>( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a> );
<a name="l4284"><span class="linenum">4284</span></a>                  <a class="var it4010" onMouseOver="hilite(4010)" onMouseOut="lolite()" onClick="logVariable('userfield_lists')" href="../../../_variables/userfield_lists.html">$userfield_lists</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>][] = <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_varchar')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_varchar.html">uf_varchar</a>;
<a name="l4285"><span class="linenum">4285</span></a>              }
<a name="l4286"><span class="linenum">4286</span></a>          }
<a name="l4287"><span class="linenum">4287</span></a>  
<a name="l4288"><span class="linenum">4288</span></a>          foreach( <a class="var it1147" onMouseOver="hilite(1147)" onMouseOut="lolite()" onClick="logVariable('userfields')" href="../../../_variables/userfields.html">$userfields</a> as <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a> )
<a name="l4289"><span class="linenum">4289</span></a>          {
<a name="l4290"><span class="linenum">4290</span></a>              if( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_duplicated')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_duplicated.html">ufdf_duplicated</a> == 'list' )
<a name="l4291"><span class="linenum">4291</span></a>              { // List style
<a name="l4292"><span class="linenum">4292</span></a>                  if( isset( <a class="var it4010" onMouseOver="hilite(4010)" onMouseOut="lolite()" onClick="logVariable('userfield_lists')" href="../../../_variables/userfield_lists.html">$userfield_lists</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>] ) )
<a name="l4293"><span class="linenum">4293</span></a>                  { // Save all data for this field:
<a name="l4294"><span class="linenum">4294</span></a>                      <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_varchar')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_varchar.html">uf_varchar</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it4010" onMouseOver="hilite(4010)" onMouseOut="lolite()" onClick="logVariable('userfield_lists')" href="../../../_variables/userfield_lists.html">$userfield_lists</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>] );
<a name="l4295"><span class="linenum">4295</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields.html">userfields</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>] = <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>;
<a name="l4296"><span class="linenum">4296</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_code')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_code.html">userfields_by_code</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_code')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_code.html">ufdf_code</a>][] = <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>;
<a name="l4297"><span class="linenum">4297</span></a>  <span class="comment">                    // Unset array to avoid a duplicates</span>
<a name="l4298"><span class="linenum">4298</span></a>                      unset( <a class="var it4010" onMouseOver="hilite(4010)" onMouseOut="lolite()" onClick="logVariable('userfield_lists')" href="../../../_variables/userfield_lists.html">$userfield_lists</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>] );
<a name="l4299"><span class="linenum">4299</span></a>                  }
<a name="l4300"><span class="linenum">4300</span></a>              }
<a name="l4301"><span class="linenum">4301</span></a>              else
<a name="l4302"><span class="linenum">4302</span></a>              { // Save all data for this field:
<a name="l4303"><span class="linenum">4303</span></a>                  <a class="function" onClick="logFunction('userfield_prepare')" href="../../../_functions/userfield_prepare.html" onMouseOver="funcPopup(event,'userfield_prepare')">userfield_prepare</a>( <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a> );
<a name="l4304"><span class="linenum">4304</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields.html">userfields</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>] = <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>;
<a name="l4305"><span class="linenum">4305</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_code')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_code.html">userfields_by_code</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_code')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_code.html">ufdf_code</a>][] = <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>;
<a name="l4306"><span class="linenum">4306</span></a>              }
<a name="l4307"><span class="linenum">4307</span></a>  <span class="comment">            // Save index</span>
<a name="l4308"><span class="linenum">4308</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_type')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_type.html">userfields_by_type</a>[<a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>][] = <a class="var it3327" onMouseOver="hilite(3327)" onMouseOut="lolite()" onClick="logVariable('userfield')" href="../../../_variables/userfield.html">$userfield</a>-&gt;<a onClick="logVariable('uf_ID')" class="var it10719" onMouseOver="hilite(10719)" onMouseOut="lolite()" href="../../../_variables/uf_ID.html">uf_ID</a>;
<a name="l4309"><span class="linenum">4309</span></a>          }
<a name="l4310"><span class="linenum">4310</span></a>  
<a name="l4311"><span class="linenum">4311</span></a>  <span class="comment">        // Also make sure the definitions are loaded</span>
<a name="l4312"><span class="linenum">4312</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('userfield_defs_load')" href="../../../_functions/userfield_defs_load.html" onMouseOver="funcPopup(event,'userfield_defs_load')">userfield_defs_load</a>();
<a name="l4313"><span class="linenum">4313</span></a>      }
<a name="l4314"><span class="linenum">4314</span></a>  
<a name="l4315"><span class="linenum">4315</span></a>  
<a name="l4316"><span class="linenum">4316</span></a>      <span class="comment">/**</span>
<a name="l4317"><span class="linenum">4317</span></a>  <span class="comment">     * Load userfields defs</span>
<a name="l4318"><span class="linenum">4318</span></a>  <span class="comment">     */</span>
<a name="l4319"><span class="linenum">4319</span></a>  	function <a class="function" onClick="logFunction('userfield_defs_load')" href="../../../_functions/userfield_defs_load.html" onMouseOver="funcPopup(event,'userfield_defs_load')">userfield_defs_load</a>()
<a name="l4320"><span class="linenum">4320</span></a>      {
<a name="l4321"><span class="linenum">4321</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l4322"><span class="linenum">4322</span></a>  
<a name="l4323"><span class="linenum">4323</span></a>          if( !isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>) )
<a name="l4324"><span class="linenum">4324</span></a>          {
<a name="l4325"><span class="linenum">4325</span></a>              <a class="var it3851" onMouseOver="hilite(3851)" onMouseOut="lolite()" onClick="logVariable('userfield_defs')" href="../../../_variables/userfield_defs.html">$userfield_defs</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( '
<a name="l4326"><span class="linenum">4326</span></a>                  SELECT ufdf_ID, ufdf_type, ufdf_name, ufdf_required, ufdf_options, ufdf_duplicated
<a name="l4327"><span class="linenum">4327</span></a>                      FROM T_users__fielddefs' );
<a name="l4328"><span class="linenum">4328</span></a>  
<a name="l4329"><span class="linenum">4329</span></a>              foreach( <a class="var it3851" onMouseOver="hilite(3851)" onMouseOut="lolite()" onClick="logVariable('userfield_defs')" href="../../../_variables/userfield_defs.html">$userfield_defs</a> as <a class="var it4011" onMouseOver="hilite(4011)" onMouseOut="lolite()" onClick="logVariable('userfield_def')" href="../../../_variables/userfield_def.html">$userfield_def</a> )
<a name="l4330"><span class="linenum">4330</span></a>              {
<a name="l4331"><span class="linenum">4331</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfield_defs')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfield_defs.html">userfield_defs</a>[<a class="var it4011" onMouseOver="hilite(4011)" onMouseOut="lolite()" onClick="logVariable('userfield_def')" href="../../../_variables/userfield_def.html">$userfield_def</a>-&gt;<a onClick="logVariable('ufdf_ID')" class="var it10942" onMouseOver="hilite(10942)" onMouseOut="lolite()" href="../../../_variables/ufdf_ID.html">ufdf_ID</a>] = array(
<a name="l4332"><span class="linenum">4332</span></a>                      <a class="var it4011" onMouseOver="hilite(4011)" onMouseOut="lolite()" onClick="logVariable('userfield_def')" href="../../../_variables/userfield_def.html">$userfield_def</a>-&gt;<a onClick="logVariable('ufdf_type')" class="var it10942" onMouseOver="hilite(10942)" onMouseOut="lolite()" href="../../../_variables/ufdf_type.html">ufdf_type</a>,
<a name="l4333"><span class="linenum">4333</span></a>                      <a class="var it4011" onMouseOver="hilite(4011)" onMouseOut="lolite()" onClick="logVariable('userfield_def')" href="../../../_variables/userfield_def.html">$userfield_def</a>-&gt;<a onClick="logVariable('ufdf_name')" class="var it10942" onMouseOver="hilite(10942)" onMouseOut="lolite()" href="../../../_variables/ufdf_name.html">ufdf_name</a>,
<a name="l4334"><span class="linenum">4334</span></a>                      <a class="var it4011" onMouseOver="hilite(4011)" onMouseOut="lolite()" onClick="logVariable('userfield_def')" href="../../../_variables/userfield_def.html">$userfield_def</a>-&gt;<a onClick="logVariable('ufdf_required')" class="var it10942" onMouseOver="hilite(10942)" onMouseOut="lolite()" href="../../../_variables/ufdf_required.html">ufdf_required</a>,
<a name="l4335"><span class="linenum">4335</span></a>                      <a class="var it4011" onMouseOver="hilite(4011)" onMouseOut="lolite()" onClick="logVariable('userfield_def')" href="../../../_variables/userfield_def.html">$userfield_def</a>-&gt;<a onClick="logVariable('ufdf_options')" class="var it10942" onMouseOver="hilite(10942)" onMouseOut="lolite()" href="../../../_variables/ufdf_options.html">ufdf_options</a>,
<a name="l4336"><span class="linenum">4336</span></a>                      <a class="var it4011" onMouseOver="hilite(4011)" onMouseOut="lolite()" onClick="logVariable('userfield_def')" href="../../../_variables/userfield_def.html">$userfield_def</a>-&gt;ufdf_duplicated
<a name="l4337"><span class="linenum">4337</span></a>                  ); <span class="comment">//jamesz</span>
<a name="l4338"><span class="linenum">4338</span></a>              }
<a name="l4339"><span class="linenum">4339</span></a>          }
<a name="l4340"><span class="linenum">4340</span></a>      }
<a name="l4341"><span class="linenum">4341</span></a>  
<a name="l4342"><span class="linenum">4342</span></a>  
<a name="l4343"><span class="linenum">4343</span></a>      <span class="comment">/**</span>
<a name="l4344"><span class="linenum">4344</span></a>  <span class="comment">    * Get first field for a specific type</span>
<a name="l4345"><span class="linenum">4345</span></a>  <span class="comment">    *</span>
<a name="l4346"><span class="linenum">4346</span></a>  <span class="comment">    * @return string or NULL</span>
<a name="l4347"><span class="linenum">4347</span></a>  <span class="comment">    */</span>
<a name="l4348"><span class="linenum">4348</span></a>  	function <a class="function" onClick="logFunction('userfieldget_first_for_type')" href="../../../_functions/userfieldget_first_for_type.html" onMouseOver="funcPopup(event,'userfieldget_first_for_type')">userfieldget_first_for_type</a>( <a class="var it4012" onMouseOver="hilite(4012)" onMouseOut="lolite()" onClick="logVariable('type_ID')" href="../../../_variables/type_ID.html">$type_ID</a> )
<a name="l4349"><span class="linenum">4349</span></a>      {
<a name="l4350"><span class="linenum">4350</span></a>          if( !isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_type')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_type.html">userfields_by_type</a>[<a class="var it4012" onMouseOver="hilite(4012)" onMouseOut="lolite()" onClick="logVariable('type_ID')" href="../../../_variables/type_ID.html">$type_ID</a>]) )
<a name="l4351"><span class="linenum">4351</span></a>          {
<a name="l4352"><span class="linenum">4352</span></a>              return NULL;
<a name="l4353"><span class="linenum">4353</span></a>          }
<a name="l4354"><span class="linenum">4354</span></a>  
<a name="l4355"><span class="linenum">4355</span></a>          <a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields_by_type')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields_by_type.html">userfields_by_type</a>[<a class="var it4012" onMouseOver="hilite(4012)" onMouseOut="lolite()" onClick="logVariable('type_ID')" href="../../../_variables/type_ID.html">$type_ID</a>][0];
<a name="l4356"><span class="linenum">4356</span></a>  
<a name="l4357"><span class="linenum">4357</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('userfields')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/userfields.html">userfields</a>[<a class="var it261" onMouseOver="hilite(261)" onMouseOut="lolite()" onClick="logVariable('idx')" href="../../../_variables/idx.html">$idx</a>][1];
<a name="l4358"><span class="linenum">4358</span></a>      }
<a name="l4359"><span class="linenum">4359</span></a>  
<a name="l4360"><span class="linenum">4360</span></a>  
<a name="l4361"><span class="linenum">4361</span></a>      <span class="comment">/**</span>
<a name="l4362"><span class="linenum">4362</span></a>  <span class="comment">     * Update user data from Request form fields.</span>
<a name="l4363"><span class="linenum">4363</span></a>  <span class="comment">     *</span>
<a name="l4364"><span class="linenum">4364</span></a>  <span class="comment">     * @param boolean is new user</span>
<a name="l4365"><span class="linenum">4365</span></a>  <span class="comment">     * @return mixed true on success, allowed action otherwise</span>
<a name="l4366"><span class="linenum">4366</span></a>  <span class="comment">     */</span>
<a name="l4367"><span class="linenum">4367</span></a>  	function <a class="function" onClick="logFunction('update_from_request')" href="../../../_functions/update_from_request.html" onMouseOver="funcPopup(event,'update_from_request')">update_from_request</a>( <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> = false )
<a name="l4368"><span class="linenum">4368</span></a>      {
<a name="l4369"><span class="linenum">4369</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('blog')" href="../../../_variables/blog.html">$blog</a>, <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>;
<a name="l4370"><span class="linenum">4370</span></a>  
<a name="l4371"><span class="linenum">4371</span></a>          if( ! <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l4372"><span class="linenum">4372</span></a>          { // user is only allowed to update him/herself
<a name="l4373"><span class="linenum">4373</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You are only allowed to update your own profile!') );
<a name="l4374"><span class="linenum">4374</span></a>              return 'view';
<a name="l4375"><span class="linenum">4375</span></a>          }
<a name="l4376"><span class="linenum">4376</span></a>  
<a name="l4377"><span class="linenum">4377</span></a>  <span class="comment">        // check if is admin form</span>
<a name="l4378"><span class="linenum">4378</span></a>          <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('is_admin_form')" href="../../../_variables/is_admin_form.html">$is_admin_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'admin_form', 'boolean', false );
<a name="l4379"><span class="linenum">4379</span></a>  
<a name="l4380"><span class="linenum">4380</span></a>  <span class="comment">        // memorize user status ( activated or not )</span>
<a name="l4381"><span class="linenum">4381</span></a>          <a class="var it4013" onMouseOver="hilite(4013)" onMouseOut="lolite()" onClick="logVariable('user_was_activated')" href="../../../_variables/user_was_activated.html">$user_was_activated</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_validated' );
<a name="l4382"><span class="linenum">4382</span></a>          <a class="var it4014" onMouseOver="hilite(4014)" onMouseOut="lolite()" onClick="logVariable('user_old_email')" href="../../../_variables/user_old_email.html">$user_old_email</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>;
<a name="l4383"><span class="linenum">4383</span></a>  
<a name="l4384"><span class="linenum">4384</span></a>  <span class="comment">        // memorize user old login, status and root path, before update</span>
<a name="l4385"><span class="linenum">4385</span></a>          <a class="var it4015" onMouseOver="hilite(4015)" onMouseOut="lolite()" onClick="logVariable('user_old_login')" href="../../../_variables/user_old_login.html">$user_old_login</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>;
<a name="l4386"><span class="linenum">4386</span></a>          <a class="var it4016" onMouseOver="hilite(4016)" onMouseOut="lolite()" onClick="logVariable('user_root_path')" href="../../../_variables/user_root_path.html">$user_root_path</a> = NULL;
<a name="l4387"><span class="linenum">4387</span></a>          <a class="var it581" onMouseOver="hilite(581)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../../_variables/FileRootCache.html">$FileRootCache</a> = &amp; get_FileRootCache();
<a name="l4388"><span class="linenum">4388</span></a>          if( !<a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> )
<a name="l4389"><span class="linenum">4389</span></a>          {
<a name="l4390"><span class="linenum">4390</span></a>              <a class="var it2895" onMouseOver="hilite(2895)" onMouseOut="lolite()" onClick="logVariable('user_FileRoot')" href="../../../_variables/user_FileRoot.html">$user_FileRoot</a> = &amp; <a class="var it581" onMouseOver="hilite(581)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../../_variables/FileRootCache.html">$FileRootCache</a>-&gt;get_by_type_and_ID( 'user', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4391"><span class="linenum">4391</span></a>              if( <a class="var it2895" onMouseOver="hilite(2895)" onMouseOut="lolite()" onClick="logVariable('user_FileRoot')" href="../../../_variables/user_FileRoot.html">$user_FileRoot</a> &amp;&amp; <a class="phpfunction" onClick="logFunction('file_exists')" href="../../../_functions/file_exists.html" onMouseOver="phpfuncPopup(event,'file_exists')">file_exists</a>( <a class="var it2895" onMouseOver="hilite(2895)" onMouseOut="lolite()" onClick="logVariable('user_FileRoot')" href="../../../_variables/user_FileRoot.html">$user_FileRoot</a>-&gt;<a onClick="logVariable('ads_path')" class="var it10817" onMouseOver="hilite(10817)" onMouseOut="lolite()" href="../../../_variables/ads_path.html">ads_path</a> ) )
<a name="l4392"><span class="linenum">4392</span></a>              {
<a name="l4393"><span class="linenum">4393</span></a>                  <a class="var it4016" onMouseOver="hilite(4016)" onMouseOut="lolite()" onClick="logVariable('user_root_path')" href="../../../_variables/user_root_path.html">$user_root_path</a> = <a class="var it2895" onMouseOver="hilite(2895)" onMouseOut="lolite()" onClick="logVariable('user_FileRoot')" href="../../../_variables/user_FileRoot.html">$user_FileRoot</a>-&gt;<a onClick="logVariable('ads_path')" class="var it10817" onMouseOver="hilite(10817)" onMouseOut="lolite()" href="../../../_variables/ads_path.html">ads_path</a>;
<a name="l4394"><span class="linenum">4394</span></a>              }
<a name="l4395"><span class="linenum">4395</span></a>          }
<a name="l4396"><span class="linenum">4396</span></a>  
<a name="l4397"><span class="linenum">4397</span></a>  <span class="comment">        // load data from request</span>
<a name="l4398"><span class="linenum">4398</span></a>          if( !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('load_from_Request')" href="../../../_functions/load_from_request.html" onMouseOver="funcPopup(event,'load_from_request')">load_from_Request</a>() )
<a name="l4399"><span class="linenum">4399</span></a>          {    // We have found validation errors:
<a name="l4400"><span class="linenum">4400</span></a>              if( <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> || ( <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('is_admin_form')" href="../../../_variables/is_admin_form.html">$is_admin_form</a> &amp;&amp; ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != 1 ) ) )
<a name="l4401"><span class="linenum">4401</span></a>              { // update user status settings but not save
<a name="l4402"><span class="linenum">4402</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_status_from_Request')" href="../../../_functions/update_status_from_request.html" onMouseOver="funcPopup(event,'update_status_from_request')">update_status_from_Request</a>( false );
<a name="l4403"><span class="linenum">4403</span></a>              }
<a name="l4404"><span class="linenum">4404</span></a>              return 'edit';
<a name="l4405"><span class="linenum">4405</span></a>          }
<a name="l4406"><span class="linenum">4406</span></a>  
<a name="l4407"><span class="linenum">4407</span></a>  <span class="comment">        // Update user</span>
<a name="l4408"><span class="linenum">4408</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l4409"><span class="linenum">4409</span></a>  
<a name="l4410"><span class="linenum">4410</span></a>          <a class="var it3908" onMouseOver="hilite(3908)" onMouseOut="lolite()" onClick="logVariable('is_password_form')" href="../../../_variables/is_password_form.html">$is_password_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'password_form', 'boolean', false );
<a name="l4411"><span class="linenum">4411</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>() )
<a name="l4412"><span class="linenum">4412</span></a>          {
<a name="l4413"><span class="linenum">4413</span></a>              <a class="var it4017" onMouseOver="hilite(4017)" onMouseOut="lolite()" onClick="logVariable('update_success')" href="../../../_variables/update_success.html">$update_success</a> = true;
<a name="l4414"><span class="linenum">4414</span></a>              if( <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> )
<a name="l4415"><span class="linenum">4415</span></a>              {
<a name="l4416"><span class="linenum">4416</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('<span class="keyword">New </span><a class="class" onClick="logClass('user')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a> has been created.'), 'success' );
<a name="l4417"><span class="linenum">4417</span></a>              }
<a name="l4418"><span class="linenum">4418</span></a>              elseif( <a class="var it3908" onMouseOver="hilite(3908)" onMouseOut="lolite()" onClick="logVariable('is_password_form')" href="../../../_variables/is_password_form.html">$is_password_form</a> )
<a name="l4419"><span class="linenum">4419</span></a>              {
<a name="l4420"><span class="linenum">4420</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Password has been changed.'), 'success' );
<a name="l4421"><span class="linenum">4421</span></a>              }
<a name="l4422"><span class="linenum">4422</span></a>              else
<a name="l4423"><span class="linenum">4423</span></a>              {
<a name="l4424"><span class="linenum">4424</span></a>                  if( <a class="var it4015" onMouseOver="hilite(4015)" onMouseOut="lolite()" onClick="logVariable('user_old_login')" href="../../../_variables/user_old_login.html">$user_old_login</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a> &amp;&amp; <a class="var it4016" onMouseOver="hilite(4016)" onMouseOut="lolite()" onClick="logVariable('user_root_path')" href="../../../_variables/user_root_path.html">$user_root_path</a> != NULL )
<a name="l4425"><span class="linenum">4425</span></a>                  { // user login changed and user has a root directory (another way <a class="var it4016" onMouseOver="hilite(4016)" onMouseOut="lolite()" onClick="logVariable('user_root_path')" href="../../../_variables/user_root_path.html">$user_root_path</a> value would be NULL)
<a name="l4426"><span class="linenum">4426</span></a>                      <a class="var it581" onMouseOver="hilite(581)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../../_variables/FileRootCache.html">$FileRootCache</a>-&gt;<a class="function" onClick="logFunction('clear')" href="../../../_functions/clear.html" onMouseOver="funcPopup(event,'clear')">clear</a>();
<a name="l4427"><span class="linenum">4427</span></a>                      <a class="var it2895" onMouseOver="hilite(2895)" onMouseOut="lolite()" onClick="logVariable('user_FileRoot')" href="../../../_variables/user_FileRoot.html">$user_FileRoot</a> = &amp; <a class="var it581" onMouseOver="hilite(581)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../../_variables/FileRootCache.html">$FileRootCache</a>-&gt;get_by_type_and_ID( 'user', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4428"><span class="linenum">4428</span></a>                      if( <a class="var it2895" onMouseOver="hilite(2895)" onMouseOut="lolite()" onClick="logVariable('user_FileRoot')" href="../../../_variables/user_FileRoot.html">$user_FileRoot</a> )
<a name="l4429"><span class="linenum">4429</span></a>                      { // user FilerRooot exists, rename user root folder
<a name="l4430"><span class="linenum">4430</span></a>                          if( ! @<a class="phpfunction" onClick="logFunction('rename')" href="../../../_functions/rename.html" onMouseOver="phpfuncPopup(event,'rename')">rename</a>( <a class="var it4016" onMouseOver="hilite(4016)" onMouseOut="lolite()" onClick="logVariable('user_root_path')" href="../../../_variables/user_root_path.html">$user_root_path</a>, <a class="var it2895" onMouseOver="hilite(2895)" onMouseOut="lolite()" onClick="logVariable('user_FileRoot')" href="../../../_variables/user_FileRoot.html">$user_FileRoot</a>-&gt;<a onClick="logVariable('ads_path')" class="var it10817" onMouseOver="hilite(10817)" onMouseOut="lolite()" href="../../../_variables/ads_path.html">ads_path</a> ) )
<a name="l4431"><span class="linenum">4431</span></a>                          { // unsuccessful folder rename
<a name="l4432"><span class="linenum">4432</span></a>                              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You cannot choose the new login &quot;%s&quot; (cannot rename user fileroot)'), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>), 'error' );
<a name="l4433"><span class="linenum">4433</span></a>                              <a class="var it4017" onMouseOver="hilite(4017)" onMouseOut="lolite()" onClick="logVariable('update_success')" href="../../../_variables/update_success.html">$update_success</a> = false;
<a name="l4434"><span class="linenum">4434</span></a>                          }
<a name="l4435"><span class="linenum">4435</span></a>                      }
<a name="l4436"><span class="linenum">4436</span></a>                  }
<a name="l4437"><span class="linenum">4437</span></a>                  if( <a class="var it4017" onMouseOver="hilite(4017)" onMouseOut="lolite()" onClick="logVariable('update_success')" href="../../../_variables/update_success.html">$update_success</a> )
<a name="l4438"><span class="linenum">4438</span></a>                  {
<a name="l4439"><span class="linenum">4439</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile has been updated.'), 'success' );
<a name="l4440"><span class="linenum">4440</span></a>                  }
<a name="l4441"><span class="linenum">4441</span></a>              }
<a name="l4442"><span class="linenum">4442</span></a>  
<a name="l4443"><span class="linenum">4443</span></a>              if( <a class="var it4017" onMouseOver="hilite(4017)" onMouseOut="lolite()" onClick="logVariable('update_success')" href="../../../_variables/update_success.html">$update_success</a> )
<a name="l4444"><span class="linenum">4444</span></a>              {
<a name="l4445"><span class="linenum">4445</span></a>                  <a class="var it4018" onMouseOver="hilite(4018)" onMouseOut="lolite()" onClick="logVariable('user_field_url')" href="../../../_variables/user_field_url.html">$user_field_url</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_field_url')" href="../../../_functions/get_field_url.html" onMouseOver="funcPopup(event,'get_field_url')">get_field_url</a>( true );
<a name="l4446"><span class="linenum">4446</span></a>                  if( <a class="var it4018" onMouseOver="hilite(4018)" onMouseOut="lolite()" onClick="logVariable('user_field_url')" href="../../../_variables/user_field_url.html">$user_field_url</a> != '' )
<a name="l4447"><span class="linenum">4447</span></a>                  { // Update url from extra user fields
<a name="l4448"><span class="linenum">4448</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'url', <a class="var it4018" onMouseOver="hilite(4018)" onMouseOut="lolite()" onClick="logVariable('user_field_url')" href="../../../_variables/user_field_url.html">$user_field_url</a> );
<a name="l4449"><span class="linenum">4449</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>();
<a name="l4450"><span class="linenum">4450</span></a>                  }
<a name="l4451"><span class="linenum">4451</span></a>  
<a name="l4452"><span class="linenum">4452</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l4453"><span class="linenum">4453</span></a>              }
<a name="l4454"><span class="linenum">4454</span></a>              else
<a name="l4455"><span class="linenum">4455</span></a>              {
<a name="l4456"><span class="linenum">4456</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l4457"><span class="linenum">4457</span></a>              }
<a name="l4458"><span class="linenum">4458</span></a>  
<a name="l4459"><span class="linenum">4459</span></a>              if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a> ) &gt; 0 )
<a name="l4460"><span class="linenum">4460</span></a>              { // Send notification email about the changes of user account
<a name="l4461"><span class="linenum">4461</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_account_changed_notification')" href="../../../_functions/send_account_changed_notification.html" onMouseOver="funcPopup(event,'send_account_changed_notification')">send_account_changed_notification</a>();
<a name="l4462"><span class="linenum">4462</span></a>              }
<a name="l4463"><span class="linenum">4463</span></a>          }
<a name="l4464"><span class="linenum">4464</span></a>          else
<a name="l4465"><span class="linenum">4465</span></a>          {
<a name="l4466"><span class="linenum">4466</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l4467"><span class="linenum">4467</span></a>              <a class="var it4017" onMouseOver="hilite(4017)" onMouseOut="lolite()" onClick="logVariable('update_success')" href="../../../_variables/update_success.html">$update_success</a> = false;
<a name="l4468"><span class="linenum">4468</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( '<span class="keyword">New </span><a class="class" onClick="logClass('user')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a> creation error', 'error' );
<a name="l4469"><span class="linenum">4469</span></a>          }
<a name="l4470"><span class="linenum">4470</span></a>  
<a name="l4471"><span class="linenum">4471</span></a>  <span class="comment">        // Update user status settings</span>
<a name="l4472"><span class="linenum">4472</span></a>          if( ( <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> || ( <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('is_admin_form')" href="../../../_variables/is_admin_form.html">$is_admin_form</a> &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != 1 ) ) &amp;&amp; ( ! <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('update_status_from_Request')" href="../../../_functions/update_status_from_request.html" onMouseOver="funcPopup(event,'update_status_from_request')">update_status_from_Request</a>( true ) ) )
<a name="l4473"><span class="linenum">4473</span></a>          {
<a name="l4474"><span class="linenum">4474</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'User status couldn\'t be updated!' ), 'error' );
<a name="l4475"><span class="linenum">4475</span></a>          }
<a name="l4476"><span class="linenum">4476</span></a>  
<a name="l4477"><span class="linenum">4477</span></a>          <a class="var it4019" onMouseOver="hilite(4019)" onMouseOut="lolite()" onClick="logVariable('try_to_send_validate_email')" href="../../../_variables/try_to_send_validate_email.html">$try_to_send_validate_email</a> = ( <a class="var it3871" onMouseOver="hilite(3871)" onMouseOut="lolite()" onClick="logVariable('is_new_user')" href="../../../_variables/is_new_user.html">$is_new_user</a> || <a class="var it4013" onMouseOver="hilite(4013)" onMouseOut="lolite()" onClick="logVariable('user_was_activated')" href="../../../_variables/user_was_activated.html">$user_was_activated</a> || ( <a class="var it4014" onMouseOver="hilite(4014)" onMouseOut="lolite()" onClick="logVariable('user_old_email')" href="../../../_variables/user_old_email.html">$user_old_email</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a> ) );
<a name="l4478"><span class="linenum">4478</span></a>          if( <a class="var it4017" onMouseOver="hilite(4017)" onMouseOut="lolite()" onClick="logVariable('update_success')" href="../../../_variables/update_success.html">$update_success</a> &amp;&amp; <a class="var it4019" onMouseOver="hilite(4019)" onMouseOut="lolite()" onClick="logVariable('try_to_send_validate_email')" href="../../../_variables/try_to_send_validate_email.html">$try_to_send_validate_email</a> &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'can_be_validated' ) )
<a name="l4479"><span class="linenum">4479</span></a>          { // user was deactivated somehow ( or it was just created right now ), check if we need to send validation email
<a name="l4480"><span class="linenum">4480</span></a>              if( ( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'validation_process' ) != 'easy' ) &amp;&amp; ( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l4481"><span class="linenum">4481</span></a>              { // validation process is set to secure, we may send activation email only if this user is the current_User
<a name="l4482"><span class="linenum">4482</span></a>                  <a class="var it4020" onMouseOver="hilite(4020)" onMouseOut="lolite()" onClick="logVariable('reg_settings_url')" href="../../../_variables/reg_settings_url.html">$reg_settings_url</a> = 'href=&quot;'.<a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>, 'ctrl=registration' ).'#fieldset_wrapper_account_activation&quot;';
<a name="l4483"><span class="linenum">4483</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Because the Account Activation Process is set to &lt;a %s&gt;Secure&lt;/a&gt;, the user will have to request a new activation email next time he tries to log in.' ), <a class="var it4020" onMouseOver="hilite(4020)" onMouseOut="lolite()" onClick="logVariable('reg_settings_url')" href="../../../_variables/reg_settings_url.html">$reg_settings_url</a> ), 'note' );
<a name="l4484"><span class="linenum">4484</span></a>              }
<a name="l4485"><span class="linenum">4485</span></a>              else
<a name="l4486"><span class="linenum">4486</span></a>              { // validation process is easy, send email with permanent activation link
<a name="l4487"><span class="linenum">4487</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_validate_email')" href="../../../_functions/send_validate_email.html" onMouseOver="funcPopup(event,'send_validate_email')">send_validate_email</a>( NULL, <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('blog')" href="../../../_variables/blog.html">$blog</a>, ( <a class="var it4014" onMouseOver="hilite(4014)" onMouseOut="lolite()" onClick="logVariable('user_old_email')" href="../../../_variables/user_old_email.html">$user_old_email</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a> ) ) )
<a name="l4488"><span class="linenum">4488</span></a>                  {
<a name="l4489"><span class="linenum">4489</span></a>                      if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l4490"><span class="linenum">4490</span></a>                      {
<a name="l4491"><span class="linenum">4491</span></a>                          <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = NULL;
<a name="l4492"><span class="linenum">4492</span></a>                          if( ( !<a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() ) &amp;&amp; ( !empty( <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('blog')" href="../../../_variables/blog.html">$blog</a> ) ) )
<a name="l4493"><span class="linenum">4493</span></a>                          { // set where to redirect in front office, another way it would go to profile_update.php
<a name="l4494"><span class="linenum">4494</span></a>                              <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a> = &amp; get_BlogCache();
<a name="l4495"><span class="linenum">4495</span></a>                              <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> = <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a>-&gt;get_by_ID( <a class="var it143" onMouseOver="hilite(143)" onMouseOut="lolite()" onClick="logVariable('blog')" href="../../../_variables/blog.html">$blog</a>, false );
<a name="l4496"><span class="linenum">4496</span></a>                              <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a> = <a class="phpfunction" onClick="logFunction('rawurlencode')" href="../../../_functions/rawurlencode.html" onMouseOver="phpfuncPopup(event,'rawurlencode')">rawurlencode</a>( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'userprefsurl' ) );
<a name="l4497"><span class="linenum">4497</span></a>                          }
<a name="l4498"><span class="linenum">4498</span></a>                          <a class="var it4021" onMouseOver="hilite(4021)" onMouseOut="lolite()" onClick="logVariable('activate_info_link')" href="../../../_variables/activate_info_link.html">$activate_info_link</a> = 'href=&quot;'.<a class="function" onClick="logFunction('get_activate_info_url')" href="../../../_functions/get_activate_info_url.html" onMouseOver="funcPopup(event,'get_activate_info_url')">get_activate_info_url</a>( <a class="var it413" onMouseOver="hilite(413)" onMouseOut="lolite()" onClick="logVariable('redirect_to')" href="../../../_variables/redirect_to.html">$redirect_to</a>, '&amp;amp;' ).'&quot;';
<a name="l4499"><span class="linenum">4499</span></a>                          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('An email has been sent to your email address (%s). Please click on the link therein to activate your account. &lt;a %s&gt;More info &amp;raquo;&lt;/a&gt;' ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dget')" href="../../../_functions/dget.html" onMouseOver="funcPopup(event,'dget')">dget</a>('email'), <a class="var it4021" onMouseOver="hilite(4021)" onMouseOut="lolite()" onClick="logVariable('activate_info_link')" href="../../../_variables/activate_info_link.html">$activate_info_link</a> ), 'success' );
<a name="l4500"><span class="linenum">4500</span></a>                      }
<a name="l4501"><span class="linenum">4501</span></a>                      else
<a name="l4502"><span class="linenum">4502</span></a>                      {
<a name="l4503"><span class="linenum">4503</span></a>                          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('An account activation email has been sent to %s' ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a> ), 'success' );
<a name="l4504"><span class="linenum">4504</span></a>                      }
<a name="l4505"><span class="linenum">4505</span></a>                  }
<a name="l4506"><span class="linenum">4506</span></a>                  elseif( isset( <a class="var it4022" onMouseOver="hilite(4022)" onMouseOut="lolite()" onClick="logVariable('demo_mode')" href="../../../_variables/demo_mode.html">$demo_mode</a> ) &amp;&amp; <a class="var it4022" onMouseOver="hilite(4022)" onMouseOut="lolite()" onClick="logVariable('demo_mode')" href="../../../_variables/demo_mode.html">$demo_mode</a> )
<a name="l4507"><span class="linenum">4507</span></a>                  {
<a name="l4508"><span class="linenum">4508</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Could not send activation email. Sending emails is disabled in demo mode.', 'note' );
<a name="l4509"><span class="linenum">4509</span></a>                  }
<a name="l4510"><span class="linenum">4510</span></a>              }
<a name="l4511"><span class="linenum">4511</span></a>          }
<a name="l4512"><span class="linenum">4512</span></a>  
<a name="l4513"><span class="linenum">4513</span></a>  <span class="comment">        // Update user settings:</span>
<a name="l4514"><span class="linenum">4514</span></a>          <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('is_preferences_form')" href="../../../_variables/is_preferences_form.html">$is_preferences_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'preferences_form', 'boolean', false );
<a name="l4515"><span class="linenum">4515</span></a>          <a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('is_subscriptions_form')" href="../../../_variables/is_subscriptions_form.html">$is_subscriptions_form</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'subscriptions_form', 'boolean', false );
<a name="l4516"><span class="linenum">4516</span></a>          if( <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('is_preferences_form')" href="../../../_variables/is_preferences_form.html">$is_preferences_form</a> || <a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('is_subscriptions_form')" href="../../../_variables/is_subscriptions_form.html">$is_subscriptions_form</a> || <a class="var it3876" onMouseOver="hilite(3876)" onMouseOut="lolite()" onClick="logVariable('is_admin_form')" href="../../../_variables/is_admin_form.html">$is_admin_form</a> )
<a name="l4517"><span class="linenum">4517</span></a>          { // Update UserSettings
<a name="l4518"><span class="linenum">4518</span></a>              if( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>() &amp;&amp; ( <a class="var it3916" onMouseOver="hilite(3916)" onMouseOut="lolite()" onClick="logVariable('is_preferences_form')" href="../../../_variables/is_preferences_form.html">$is_preferences_form</a> || <a class="var it3918" onMouseOver="hilite(3918)" onMouseOut="lolite()" onClick="logVariable('is_subscriptions_form')" href="../../../_variables/is_subscriptions_form.html">$is_subscriptions_form</a> ) )
<a name="l4519"><span class="linenum">4519</span></a>              { // Show feature settings update successful message on user preferences form
<a name="l4520"><span class="linenum">4520</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('User feature settings have been changed.'), 'success');
<a name="l4521"><span class="linenum">4521</span></a>              }
<a name="l4522"><span class="linenum">4522</span></a>          }
<a name="l4523"><span class="linenum">4523</span></a>  
<a name="l4524"><span class="linenum">4524</span></a>          return true;
<a name="l4525"><span class="linenum">4525</span></a>      }
<a name="l4526"><span class="linenum">4526</span></a>  
<a name="l4527"><span class="linenum">4527</span></a>  
<a name="l4528"><span class="linenum">4528</span></a>      <span class="comment">/**</span>
<a name="l4529"><span class="linenum">4529</span></a>  <span class="comment">     * Handle close user account request and update account close reason</span>
<a name="l4530"><span class="linenum">4530</span></a>  <span class="comment">     *</span>
<a name="l4531"><span class="linenum">4531</span></a>  <span class="comment">     * @param boolean save modifications or not. User false only in case when User and UserSettings object will be saved later.</span>
<a name="l4532"><span class="linenum">4532</span></a>  <span class="comment">     * @return boolean true on success, false otherwise</span>
<a name="l4533"><span class="linenum">4533</span></a>  <span class="comment">     */</span>
<a name="l4534"><span class="linenum">4534</span></a>  	function <a class="function" onClick="logFunction('update_status_from_Request')" href="../../../_functions/update_status_from_request.html" onMouseOver="funcPopup(event,'update_status_from_request')">update_status_from_Request</a>( <a class="var it4023" onMouseOver="hilite(4023)" onMouseOut="lolite()" onClick="logVariable('dbsave')" href="../../../_variables/dbsave.html">$dbsave</a>, <a class="var it2179" onMouseOver="hilite(2179)" onMouseOut="lolite()" onClick="logVariable('new_status')" href="../../../_variables/new_status.html">$new_status</a> = NULL )
<a name="l4535"><span class="linenum">4535</span></a>      {
<a name="l4536"><span class="linenum">4536</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>;
<a name="l4537"><span class="linenum">4537</span></a>  
<a name="l4538"><span class="linenum">4538</span></a>          if( <a class="var it4023" onMouseOver="hilite(4023)" onMouseOut="lolite()" onClick="logVariable('dbsave')" href="../../../_variables/dbsave.html">$dbsave</a> )
<a name="l4539"><span class="linenum">4539</span></a>          { // save required
<a name="l4540"><span class="linenum">4540</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l4541"><span class="linenum">4541</span></a>          }
<a name="l4542"><span class="linenum">4542</span></a>  
<a name="l4543"><span class="linenum">4543</span></a>          if( empty( <a class="var it2179" onMouseOver="hilite(2179)" onMouseOut="lolite()" onClick="logVariable('new_status')" href="../../../_variables/new_status.html">$new_status</a> ) )
<a name="l4544"><span class="linenum">4544</span></a>          {
<a name="l4545"><span class="linenum">4545</span></a>              <a class="var it2179" onMouseOver="hilite(2179)" onMouseOut="lolite()" onClick="logVariable('new_status')" href="../../../_variables/new_status.html">$new_status</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'edited_user_status', 'string', true );
<a name="l4546"><span class="linenum">4546</span></a>          }
<a name="l4547"><span class="linenum">4547</span></a>  
<a name="l4548"><span class="linenum">4548</span></a>  <span class="comment">        // a close reason type thst is selected from list</span>
<a name="l4549"><span class="linenum">4549</span></a>          <a class="var it4024" onMouseOver="hilite(4024)" onMouseOut="lolite()" onClick="logVariable('account_close_type')" href="../../../_variables/account_close_type.html">$account_close_type</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'account_close_type', 'string', '' );
<a name="l4550"><span class="linenum">4550</span></a>  <span class="comment">        // a close reason text - max 255 characters</span>
<a name="l4551"><span class="linenum">4551</span></a>          <a class="var it4025" onMouseOver="hilite(4025)" onMouseOut="lolite()" onClick="logVariable('account_close_reason')" href="../../../_variables/account_close_reason.html">$account_close_reason</a> = <a class="phpfunction" onClick="logFunction('substr')" href="../../../_functions/substr.html" onMouseOver="phpfuncPopup(event,'substr')">substr</a>( <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'account_close_reason', 'text', '' ), 0, 255 );
<a name="l4552"><span class="linenum">4552</span></a>          if( ( !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_closed' ) ) &amp;&amp; ( <a class="var it2179" onMouseOver="hilite(2179)" onMouseOut="lolite()" onClick="logVariable('new_status')" href="../../../_variables/new_status.html">$new_status</a> == 'closed' ) )
<a name="l4553"><span class="linenum">4553</span></a>          { // account was not closed yet
<a name="l4554"><span class="linenum">4554</span></a>              if( empty( <a class="var it4025" onMouseOver="hilite(4025)" onMouseOut="lolite()" onClick="logVariable('account_close_reason')" href="../../../_variables/account_close_reason.html">$account_close_reason</a> ) &amp;&amp; empty( <a class="var it4024" onMouseOver="hilite(4024)" onMouseOut="lolite()" onClick="logVariable('account_close_type')" href="../../../_variables/account_close_type.html">$account_close_type</a> ) )
<a name="l4555"><span class="linenum">4555</span></a>              { // Default value of reason
<a name="l4556"><span class="linenum">4556</span></a>                  <a class="var it4025" onMouseOver="hilite(4025)" onMouseOut="lolite()" onClick="logVariable('account_close_reason')" href="../../../_variables/account_close_reason.html">$account_close_reason</a> = <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'Other' );
<a name="l4557"><span class="linenum">4557</span></a>              }
<a name="l4558"><span class="linenum">4558</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', 'closed' );
<a name="l4559"><span class="linenum">4559</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'account_close_ts', <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4560"><span class="linenum">4560</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'account_close_reason', <a class="phpfunction" onClick="logFunction('trim')" href="../../../_functions/trim.html" onMouseOver="phpfuncPopup(event,'trim')">trim</a>( <a class="var it4024" onMouseOver="hilite(4024)" onMouseOut="lolite()" onClick="logVariable('account_close_type')" href="../../../_variables/account_close_type.html">$account_close_type</a>.' '.<a class="var it4025" onMouseOver="hilite(4025)" onMouseOut="lolite()" onClick="logVariable('account_close_reason')" href="../../../_variables/account_close_reason.html">$account_close_reason</a> ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4561"><span class="linenum">4561</span></a>  <span class="comment">            // delete last activation email data, this user must not be allowed to reactivate the account ( only admin users may change the status again )</span>
<a name="l4562"><span class="linenum">4562</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'last_activation_reminder_key', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4563"><span class="linenum">4563</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'last_activation_email', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4564"><span class="linenum">4564</span></a>  <span class="comment">            // create query to clear all session's of the user</span>
<a name="l4565"><span class="linenum">4565</span></a>              <a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('clear_sessions_query')" href="../../../_variables/clear_sessions_query.html">$clear_sessions_query</a> = 'UPDATE T_sessions
<a name="l4566"><span class="linenum">4566</span></a>                                  SET sess_key = NULL
<a name="l4567"><span class="linenum">4567</span></a>                                  WHERE sess_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4568"><span class="linenum">4568</span></a>              if( <a class="var it4023" onMouseOver="hilite(4023)" onMouseOut="lolite()" onClick="logVariable('dbsave')" href="../../../_variables/dbsave.html">$dbsave</a> &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>() &amp;&amp; <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>() &amp;&amp; ( <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it4026" onMouseOver="hilite(4026)" onMouseOut="lolite()" onClick="logVariable('clear_sessions_query')" href="../../../_variables/clear_sessions_query.html">$clear_sessions_query</a> ) !== false ) )
<a name="l4569"><span class="linenum">4569</span></a>              { // all db modification was successful
<a name="l4570"><span class="linenum">4570</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l4571"><span class="linenum">4571</span></a>                  if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l4572"><span class="linenum">4572</span></a>                  {    // If admin closed some user account
<a name="l4573"><span class="linenum">4573</span></a>  <span class="comment">                    // Send notification email about closed account to users with edit users permission</span>
<a name="l4574"><span class="linenum">4574</span></a>                      <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> = array(
<a name="l4575"><span class="linenum">4575</span></a>                              'login'           =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>,
<a name="l4576"><span class="linenum">4576</span></a>                              'email'           =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('email')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/email.html">email</a>,
<a name="l4577"><span class="linenum">4577</span></a>                              'reason'          =&gt; <a class="var it4025" onMouseOver="hilite(4025)" onMouseOut="lolite()" onClick="logVariable('account_close_reason')" href="../../../_variables/account_close_reason.html">$account_close_reason</a>,
<a name="l4578"><span class="linenum">4578</span></a>                              'user_ID'         =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>,
<a name="l4579"><span class="linenum">4579</span></a>                              'closed_by_admin' =&gt; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('login')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>,
<a name="l4580"><span class="linenum">4580</span></a>                              'days_count'      =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_days_count_close')" href="../../../_functions/get_days_count_close.html" onMouseOver="funcPopup(event,'get_days_count_close')">get_days_count_close</a>()
<a name="l4581"><span class="linenum">4581</span></a>                          );
<a name="l4582"><span class="linenum">4582</span></a>                      <a class="function" onClick="logFunction('send_admin_notification')" href="../../../_functions/send_admin_notification.html" onMouseOver="funcPopup(event,'send_admin_notification')">send_admin_notification</a>( <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('User account closed'), 'account_closed', <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> );
<a name="l4583"><span class="linenum">4583</span></a>                  }
<a name="l4584"><span class="linenum">4584</span></a>                  return true;
<a name="l4585"><span class="linenum">4585</span></a>              }
<a name="l4586"><span class="linenum">4586</span></a>          }
<a name="l4587"><span class="linenum">4587</span></a>          else
<a name="l4588"><span class="linenum">4588</span></a>          {
<a name="l4589"><span class="linenum">4589</span></a>              <a class="var it4027" onMouseOver="hilite(4027)" onMouseOut="lolite()" onClick="logVariable('new_status_is_active')" href="../../../_variables/new_status_is_active.html">$new_status_is_active</a> = ( <a class="var it2179" onMouseOver="hilite(2179)" onMouseOut="lolite()" onClick="logVariable('new_status')" href="../../../_variables/new_status.html">$new_status</a> == 'activated' || <a class="var it2179" onMouseOver="hilite(2179)" onMouseOut="lolite()" onClick="logVariable('new_status')" href="../../../_variables/new_status.html">$new_status</a> == 'autoactivated' );
<a name="l4590"><span class="linenum">4590</span></a>              <a class="var it4028" onMouseOver="hilite(4028)" onMouseOut="lolite()" onClick="logVariable('old_status_is_not_active')" href="../../../_variables/old_status_is_not_active.html">$old_status_is_not_active</a> = false;
<a name="l4591"><span class="linenum">4591</span></a>              if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'can_be_validated' ) &amp;&amp; <a class="var it4027" onMouseOver="hilite(4027)" onMouseOut="lolite()" onClick="logVariable('new_status_is_active')" href="../../../_variables/new_status_is_active.html">$new_status_is_active</a> )
<a name="l4592"><span class="linenum">4592</span></a>              { // User was activated
<a name="l4593"><span class="linenum">4593</span></a>                  <a class="var it4028" onMouseOver="hilite(4028)" onMouseOut="lolite()" onClick="logVariable('old_status_is_not_active')" href="../../../_variables/old_status_is_not_active.html">$old_status_is_not_active</a> = true;
<a name="l4594"><span class="linenum">4594</span></a>  <span class="comment">                // clear activation specific settings</span>
<a name="l4595"><span class="linenum">4595</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'last_activation_reminder_key', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4596"><span class="linenum">4596</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'last_activation_email', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4597"><span class="linenum">4597</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'activation_reminder_count', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4598"><span class="linenum">4598</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'send_activation_reminder', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4599"><span class="linenum">4599</span></a>              }
<a name="l4600"><span class="linenum">4600</span></a>              <a class="var it4028" onMouseOver="hilite(4028)" onMouseOut="lolite()" onClick="logVariable('old_status_is_not_active')" href="../../../_variables/old_status_is_not_active.html">$old_status_is_not_active</a> = ( <a class="var it4028" onMouseOver="hilite(4028)" onMouseOut="lolite()" onClick="logVariable('old_status_is_not_active')" href="../../../_variables/old_status_is_not_active.html">$old_status_is_not_active</a> || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_status')" href="../../../_functions/check_status.html" onMouseOver="funcPopup(event,'check_status')">check_status</a>( 'is_closed' ) );
<a name="l4601"><span class="linenum">4601</span></a>  
<a name="l4602"><span class="linenum">4602</span></a>  <span class="comment">            // set status</span>
<a name="l4603"><span class="linenum">4603</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'status', <a class="var it2179" onMouseOver="hilite(2179)" onMouseOut="lolite()" onClick="logVariable('new_status')" href="../../../_variables/new_status.html">$new_status</a> );
<a name="l4604"><span class="linenum">4604</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'account_close_reason', <a class="var it4025" onMouseOver="hilite(4025)" onMouseOut="lolite()" onClick="logVariable('account_close_reason')" href="../../../_variables/account_close_reason.html">$account_close_reason</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4605"><span class="linenum">4605</span></a>              if( <a class="var it4023" onMouseOver="hilite(4023)" onMouseOut="lolite()" onClick="logVariable('dbsave')" href="../../../_variables/dbsave.html">$dbsave</a> &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>() )
<a name="l4606"><span class="linenum">4606</span></a>              { // db update
<a name="l4607"><span class="linenum">4607</span></a>                  <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l4608"><span class="linenum">4608</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l4609"><span class="linenum">4609</span></a>                  if( <a class="var it4028" onMouseOver="hilite(4028)" onMouseOut="lolite()" onClick="logVariable('old_status_is_not_active')" href="../../../_variables/old_status_is_not_active.html">$old_status_is_not_active</a> &amp;&amp; <a class="var it4027" onMouseOver="hilite(4027)" onMouseOut="lolite()" onClick="logVariable('new_status_is_active')" href="../../../_variables/new_status_is_active.html">$new_status_is_active</a> )
<a name="l4610"><span class="linenum">4610</span></a>                  { // User was activated, create a welcome private message
<a name="l4611"><span class="linenum">4611</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_welcome_message')" href="../../../_functions/send_welcome_message.html" onMouseOver="funcPopup(event,'send_welcome_message')">send_welcome_message</a>();
<a name="l4612"><span class="linenum">4612</span></a>  
<a name="l4613"><span class="linenum">4613</span></a>                      if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l4614"><span class="linenum">4614</span></a>                      {    // If admin activated some user account
<a name="l4615"><span class="linenum">4615</span></a>  <span class="comment">                        // Send notification email about activated account to users with edit users permission</span>
<a name="l4616"><span class="linenum">4616</span></a>                          <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> = array(
<a name="l4617"><span class="linenum">4617</span></a>                              'User' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>,
<a name="l4618"><span class="linenum">4618</span></a>                              'login' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, // this is required in the send_admin_notification
<a name="l4619"><span class="linenum">4619</span></a>                              'activated_by_admin' =&gt; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('login')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>,
<a name="l4620"><span class="linenum">4620</span></a>                          );
<a name="l4621"><span class="linenum">4621</span></a>                          <a class="function" onClick="logFunction('send_admin_notification')" href="../../../_functions/send_admin_notification.html" onMouseOver="funcPopup(event,'send_admin_notification')">send_admin_notification</a>( <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('<span class="keyword">New </span><a class="class" onClick="logClass('user')" href="../../../_classes/user.html" onMouseOver="classPopup(event,'user')">user</a> account activated'), 'account_activated', <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> );
<a name="l4622"><span class="linenum">4622</span></a>                      }
<a name="l4623"><span class="linenum">4623</span></a>                  }
<a name="l4624"><span class="linenum">4624</span></a>                  return true;
<a name="l4625"><span class="linenum">4625</span></a>              }
<a name="l4626"><span class="linenum">4626</span></a>          }
<a name="l4627"><span class="linenum">4627</span></a>  
<a name="l4628"><span class="linenum">4628</span></a>          if( <a class="var it4023" onMouseOver="hilite(4023)" onMouseOut="lolite()" onClick="logVariable('dbsave')" href="../../../_variables/dbsave.html">$dbsave</a> )
<a name="l4629"><span class="linenum">4629</span></a>          { // save was required, but wasn't successful
<a name="l4630"><span class="linenum">4630</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l4631"><span class="linenum">4631</span></a>              return false;
<a name="l4632"><span class="linenum">4632</span></a>          }
<a name="l4633"><span class="linenum">4633</span></a>  
<a name="l4634"><span class="linenum">4634</span></a>          return true;
<a name="l4635"><span class="linenum">4635</span></a>      }
<a name="l4636"><span class="linenum">4636</span></a>  
<a name="l4637"><span class="linenum">4637</span></a>  
<a name="l4638"><span class="linenum">4638</span></a>      <span class="comment">/**</span>
<a name="l4639"><span class="linenum">4639</span></a>  <span class="comment">     * Update profileupdate date. Call after a publicly visible user property was updated.</span>
<a name="l4640"><span class="linenum">4640</span></a>  <span class="comment">     */</span>
<a name="l4641"><span class="linenum">4641</span></a>  	function <a class="function" onClick="logFunction('set_profileupdate_date')" href="../../../_functions/set_profileupdate_date.html" onMouseOver="funcPopup(event,'set_profileupdate_date')">set_profileupdate_date</a>()
<a name="l4642"><span class="linenum">4642</span></a>      {
<a name="l4643"><span class="linenum">4643</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l4644"><span class="linenum">4644</span></a>          if( ( !empty( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a> ) ) &amp;&amp; ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l4645"><span class="linenum">4645</span></a>          {
<a name="l4646"><span class="linenum">4646</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'profileupdate_date', <a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> ) );
<a name="l4647"><span class="linenum">4647</span></a>          }
<a name="l4648"><span class="linenum">4648</span></a>      }
<a name="l4649"><span class="linenum">4649</span></a>  
<a name="l4650"><span class="linenum">4650</span></a>  
<a name="l4651"><span class="linenum">4651</span></a>      <span class="comment">/**</span>
<a name="l4652"><span class="linenum">4652</span></a>  <span class="comment">     * Update user avatar file</span>
<a name="l4653"><span class="linenum">4653</span></a>  <span class="comment">     *</span>
<a name="l4654"><span class="linenum">4654</span></a>  <span class="comment">     * @param integer the new avatar file ID</span>
<a name="l4655"><span class="linenum">4655</span></a>  <span class="comment">     * @param boolean TRUE to restore this file</span>
<a name="l4656"><span class="linenum">4656</span></a>  <span class="comment">     * @return mixed true on success, allowed action otherwise</span>
<a name="l4657"><span class="linenum">4657</span></a>  <span class="comment">     */</span>
<a name="l4658"><span class="linenum">4658</span></a>  	function <a class="function" onClick="logFunction('update_avatar')" href="../../../_functions/update_avatar.html" onMouseOver="funcPopup(event,'update_avatar')">update_avatar</a>( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, <a class="var it3463" onMouseOver="hilite(3463)" onMouseOut="lolite()" onClick="logVariable('restore')" href="../../../_variables/restore.html">$restore</a> = false )
<a name="l4659"><span class="linenum">4659</span></a>      {
<a name="l4660"><span class="linenum">4660</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l4661"><span class="linenum">4661</span></a>  
<a name="l4662"><span class="linenum">4662</span></a>          <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4663"><span class="linenum">4663</span></a>          if( ! <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> &amp;&amp; ( <a class="var it3463" onMouseOver="hilite(3463)" onMouseOut="lolite()" onClick="logVariable('restore')" href="../../../_variables/restore.html">$restore</a> || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l4664"><span class="linenum">4664</span></a>          { // user is only allowed to update him/herself
<a name="l4665"><span class="linenum">4665</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You are not allowed to update this profile!'), 'error' );
<a name="l4666"><span class="linenum">4666</span></a>              return 'view';
<a name="l4667"><span class="linenum">4667</span></a>          }
<a name="l4668"><span class="linenum">4668</span></a>  
<a name="l4669"><span class="linenum">4669</span></a>          if( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> == NULL )
<a name="l4670"><span class="linenum">4670</span></a>          {
<a name="l4671"><span class="linenum">4671</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture could not be changed!'), 'error' );
<a name="l4672"><span class="linenum">4672</span></a>              return 'edit';
<a name="l4673"><span class="linenum">4673</span></a>          }
<a name="l4674"><span class="linenum">4674</span></a>  
<a name="l4675"><span class="linenum">4675</span></a>          <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a> = &amp; get_FileCache();
<a name="l4676"><span class="linenum">4676</span></a>          <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a>-&gt;get_by_ID( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> );
<a name="l4677"><span class="linenum">4677</span></a>  
<a name="l4678"><span class="linenum">4678</span></a>          if( ! <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'can_be_main_profile' ) &amp;&amp; ! <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> )
<a name="l4679"><span class="linenum">4679</span></a>          { // Deny to restore picture if current user has no perm
<a name="l4680"><span class="linenum">4680</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture could not be changed!'), 'error' );
<a name="l4681"><span class="linenum">4681</span></a>              return 'edit';
<a name="l4682"><span class="linenum">4682</span></a>          }
<a name="l4683"><span class="linenum">4683</span></a>  
<a name="l4684"><span class="linenum">4684</span></a>          if( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('_FileRoot')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/_FileRoot.html">_FileRoot</a>-&gt;type == 'user' &amp;&amp; <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('_FileRoot')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/_FileRoot.html">_FileRoot</a>-&gt;in_type_ID != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l4685"><span class="linenum">4685</span></a>          { // don't allow to use pictures from other users
<a name="l4686"><span class="linenum">4686</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture could not be changed!'), 'error' );
<a name="l4687"><span class="linenum">4687</span></a>              return 'edit';
<a name="l4688"><span class="linenum">4688</span></a>          }
<a name="l4689"><span class="linenum">4689</span></a>  
<a name="l4690"><span class="linenum">4690</span></a>          <a class="var it4031" onMouseOver="hilite(4031)" onMouseOut="lolite()" onClick="logVariable('restored_success')" href="../../../_variables/restored_success.html">$restored_success</a> = false;
<a name="l4691"><span class="linenum">4691</span></a>          if( <a class="var it3463" onMouseOver="hilite(3463)" onMouseOut="lolite()" onClick="logVariable('restore')" href="../../../_variables/restore.html">$restore</a> &amp;&amp; <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> )
<a name="l4692"><span class="linenum">4692</span></a>          { // Restore profile picture
<a name="l4693"><span class="linenum">4693</span></a>              <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'can_be_main_profile', '1' );
<a name="l4694"><span class="linenum">4694</span></a>              <a class="var it4031" onMouseOver="hilite(4031)" onMouseOut="lolite()" onClick="logVariable('restored_success')" href="../../../_variables/restored_success.html">$restored_success</a> = <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l4695"><span class="linenum">4695</span></a>          }
<a name="l4696"><span class="linenum">4696</span></a>  
<a name="l4697"><span class="linenum">4697</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'avatar_file_ID', <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, true );
<a name="l4698"><span class="linenum">4698</span></a>  <span class="comment">        // update profileupdate_date, because a publicly visible user property was changed</span>
<a name="l4699"><span class="linenum">4699</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_profileupdate_date')" href="../../../_functions/set_profileupdate_date.html" onMouseOver="funcPopup(event,'set_profileupdate_date')">set_profileupdate_date</a>();
<a name="l4700"><span class="linenum">4700</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l4701"><span class="linenum">4701</span></a>  
<a name="l4702"><span class="linenum">4702</span></a>          if( <a class="var it4031" onMouseOver="hilite(4031)" onMouseOut="lolite()" onClick="logVariable('restored_success')" href="../../../_variables/restored_success.html">$restored_success</a> )
<a name="l4703"><span class="linenum">4703</span></a>          {
<a name="l4704"><span class="linenum">4704</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been restored.'), 'success' );
<a name="l4705"><span class="linenum">4705</span></a>          }
<a name="l4706"><span class="linenum">4706</span></a>          else
<a name="l4707"><span class="linenum">4707</span></a>          {
<a name="l4708"><span class="linenum">4708</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been changed.'), 'success' );
<a name="l4709"><span class="linenum">4709</span></a>          }
<a name="l4710"><span class="linenum">4710</span></a>  
<a name="l4711"><span class="linenum">4711</span></a>  <span class="comment">        // Send notification email about the changes of user account</span>
<a name="l4712"><span class="linenum">4712</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_account_changed_notification')" href="../../../_functions/send_account_changed_notification.html" onMouseOver="funcPopup(event,'send_account_changed_notification')">send_account_changed_notification</a>( true );
<a name="l4713"><span class="linenum">4713</span></a>  
<a name="l4714"><span class="linenum">4714</span></a>          return true;
<a name="l4715"><span class="linenum">4715</span></a>      }
<a name="l4716"><span class="linenum">4716</span></a>  
<a name="l4717"><span class="linenum">4717</span></a>  
<a name="l4718"><span class="linenum">4718</span></a>      <span class="comment">/**</span>
<a name="l4719"><span class="linenum">4719</span></a>  <span class="comment">     * Get the rotate avatar icons</span>
<a name="l4720"><span class="linenum">4720</span></a>  <span class="comment">     *</span>
<a name="l4721"><span class="linenum">4721</span></a>  <span class="comment">     * @param integer File ID</span>
<a name="l4722"><span class="linenum">4722</span></a>  <span class="comment">     * @param array Params</span>
<a name="l4723"><span class="linenum">4723</span></a>  <span class="comment">     * @return string HTML text with 3 icons to rotate avatar</span>
<a name="l4724"><span class="linenum">4724</span></a>  <span class="comment">     */</span>
<a name="l4725"><span class="linenum">4725</span></a>  	function <a class="function" onClick="logFunction('get_rotate_avatar_icons')" href="../../../_functions/get_rotate_avatar_icons.html" onMouseOver="funcPopup(event,'get_rotate_avatar_icons')">get_rotate_avatar_icons</a>( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l4726"><span class="linenum">4726</span></a>      {
<a name="l4727"><span class="linenum">4727</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l4728"><span class="linenum">4728</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l4729"><span class="linenum">4729</span></a>                  'before'   =&gt; '&lt;br /&gt;',
<a name="l4730"><span class="linenum">4730</span></a>                  'after'    =&gt; '',
<a name="l4731"><span class="linenum">4731</span></a>                  'text'     =&gt; '',
<a name="l4732"><span class="linenum">4732</span></a>                  'user_tab' =&gt; 'avatar',
<a name="l4733"><span class="linenum">4733</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l4734"><span class="linenum">4734</span></a>  
<a name="l4735"><span class="linenum">4735</span></a>  <span class="comment">        // Init links to rotate avatar</span>
<a name="l4736"><span class="linenum">4736</span></a>          if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l4737"><span class="linenum">4737</span></a>          { // Back-office
<a name="l4738"><span class="linenum">4738</span></a>              <a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('url_rotate_90_left')" href="../../../_variables/url_rotate_90_left.html">$url_rotate_90_left</a> = <a class="function" onClick="logFunction('regenerate_url')" href="../../../_functions/regenerate_url.html" onMouseOver="funcPopup(event,'regenerate_url')">regenerate_url</a>( '', 'user_tab='.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_tab'].'&amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;action=rotate_avatar_90_left&amp;file_ID='.<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'user' ), '', '&amp;' );
<a name="l4739"><span class="linenum">4739</span></a>              <a class="var it1222" onMouseOver="hilite(1222)" onMouseOut="lolite()" onClick="logVariable('url_rotate_180')" href="../../../_variables/url_rotate_180.html">$url_rotate_180</a> = <a class="function" onClick="logFunction('regenerate_url')" href="../../../_functions/regenerate_url.html" onMouseOver="funcPopup(event,'regenerate_url')">regenerate_url</a>( '', 'user_tab='.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_tab'].'&amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;action=rotate_avatar_180&amp;file_ID='.<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'user' ), '', '&amp;') ;
<a name="l4740"><span class="linenum">4740</span></a>              <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('url_rotate_90_right')" href="../../../_variables/url_rotate_90_right.html">$url_rotate_90_right</a> = <a class="function" onClick="logFunction('regenerate_url')" href="../../../_functions/regenerate_url.html" onMouseOver="funcPopup(event,'regenerate_url')">regenerate_url</a>( '', 'user_tab='.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_tab'].'&amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;action=rotate_avatar_90_right&amp;file_ID='.<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'user' ), '', '&amp;' );
<a name="l4741"><span class="linenum">4741</span></a>          }
<a name="l4742"><span class="linenum">4742</span></a>          else
<a name="l4743"><span class="linenum">4743</span></a>          { // Front-office
<a name="l4744"><span class="linenum">4744</span></a>              global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l4745"><span class="linenum">4745</span></a>              <a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('url_rotate_90_left')" href="../../../_variables/url_rotate_90_left.html">$url_rotate_90_left</a> = <a class="function" onClick="logFunction('get_secure_htsrv_url')" href="../../../_functions/get_secure_htsrv_url.html" onMouseOver="funcPopup(event,'get_secure_htsrv_url')">get_secure_htsrv_url</a>().'profile_update.php?user_tab='.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_tab'].'&amp;blog='.<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a onClick="logVariable('ID')" class="var it10696" onMouseOver="hilite(10696)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;action=rotate_avatar_90_left&amp;file_ID='.<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'user' );
<a name="l4746"><span class="linenum">4746</span></a>              <a class="var it1222" onMouseOver="hilite(1222)" onMouseOut="lolite()" onClick="logVariable('url_rotate_180')" href="../../../_variables/url_rotate_180.html">$url_rotate_180</a> = <a class="function" onClick="logFunction('get_secure_htsrv_url')" href="../../../_functions/get_secure_htsrv_url.html" onMouseOver="funcPopup(event,'get_secure_htsrv_url')">get_secure_htsrv_url</a>().'profile_update.php?user_tab='.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_tab'].'&amp;blog='.<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a onClick="logVariable('ID')" class="var it10696" onMouseOver="hilite(10696)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;action=rotate_avatar_180&amp;file_ID='.<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'user' );
<a name="l4747"><span class="linenum">4747</span></a>              <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('url_rotate_90_right')" href="../../../_variables/url_rotate_90_right.html">$url_rotate_90_right</a> = <a class="function" onClick="logFunction('get_secure_htsrv_url')" href="../../../_functions/get_secure_htsrv_url.html" onMouseOver="funcPopup(event,'get_secure_htsrv_url')">get_secure_htsrv_url</a>().'profile_update.php?user_tab='.<a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['user_tab'].'&amp;blog='.<a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a onClick="logVariable('ID')" class="var it10696" onMouseOver="hilite(10696)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'&amp;action=rotate_avatar_90_right&amp;file_ID='.<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>.'&amp;'.<a class="function" onClick="logFunction('url_crumb')" href="../../../_functions/url_crumb.html" onMouseOver="funcPopup(event,'url_crumb')">url_crumb</a>( 'user' );
<a name="l4748"><span class="linenum">4748</span></a>          }
<a name="l4749"><span class="linenum">4749</span></a>  
<a name="l4750"><span class="linenum">4750</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['before'];
<a name="l4751"><span class="linenum">4751</span></a>  
<a name="l4752"><span class="linenum">4752</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> .= <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Rotate this picture 90&amp;deg; to the left'), 'rotate_left', <a class="var it1221" onMouseOver="hilite(1221)" onMouseOut="lolite()" onClick="logVariable('url_rotate_90_left')" href="../../../_variables/url_rotate_90_left.html">$url_rotate_90_left</a>, '', 0, 0, array( 'style' =&gt; 'margin-right:4px' ) );
<a name="l4753"><span class="linenum">4753</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> .= <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Rotate this picture 180&amp;deg;'), 'rotate_180', <a class="var it1222" onMouseOver="hilite(1222)" onMouseOut="lolite()" onClick="logVariable('url_rotate_180')" href="../../../_variables/url_rotate_180.html">$url_rotate_180</a>, '', 0, 0, array( 'style' =&gt; 'margin-right:4px' ) );
<a name="l4754"><span class="linenum">4754</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> .= <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Rotate this picture 90&amp;deg; to the right'), 'rotate_right', <a class="var it1223" onMouseOver="hilite(1223)" onMouseOut="lolite()" onClick="logVariable('url_rotate_90_right')" href="../../../_variables/url_rotate_90_right.html">$url_rotate_90_right</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'], empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'] ) ? 0: 3, empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'] ) ? 0: 4 );
<a name="l4755"><span class="linenum">4755</span></a>  
<a name="l4756"><span class="linenum">4756</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['after'];
<a name="l4757"><span class="linenum">4757</span></a>  
<a name="l4758"><span class="linenum">4758</span></a>          return <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a>;
<a name="l4759"><span class="linenum">4759</span></a>      }
<a name="l4760"><span class="linenum">4760</span></a>  
<a name="l4761"><span class="linenum">4761</span></a>  
<a name="l4762"><span class="linenum">4762</span></a>      <span class="comment">/**</span>
<a name="l4763"><span class="linenum">4763</span></a>  <span class="comment">     * Get file object by ID of this user</span>
<a name="l4764"><span class="linenum">4764</span></a>  <span class="comment">     *</span>
<a name="l4765"><span class="linenum">4765</span></a>  <span class="comment">     * @param integer Avatar file ID</span>
<a name="l4766"><span class="linenum">4766</span></a>  <span class="comment">     * @param string Error code on denied action, It is updated by reference:</span>
<a name="l4767"><span class="linenum">4767</span></a>  <span class="comment">     *        'only_own_profile' - User can update only own profile</span>
<a name="l4768"><span class="linenum">4768</span></a>  <span class="comment">     *        'wrong_file'       - Request with wrong file ID</span>
<a name="l4769"><span class="linenum">4769</span></a>  <span class="comment">     *        'other_user'       - Restricted to edit files from other users</span>
<a name="l4770"><span class="linenum">4770</span></a>  <span class="comment">     * @return object|boolean File object on success, FALSE on failed</span>
<a name="l4771"><span class="linenum">4771</span></a>  <span class="comment">     */</span>
<a name="l4772"><span class="linenum">4772</span></a>      function &amp; get_File_by_ID( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, &amp; <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> )
<a name="l4773"><span class="linenum">4773</span></a>      {
<a name="l4774"><span class="linenum">4774</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l4775"><span class="linenum">4775</span></a>  
<a name="l4776"><span class="linenum">4776</span></a>          <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> = false;
<a name="l4777"><span class="linenum">4777</span></a>  
<a name="l4778"><span class="linenum">4778</span></a>          <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4779"><span class="linenum">4779</span></a>          if( ! <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l4780"><span class="linenum">4780</span></a>          { // user is only allowed to update him/herself
<a name="l4781"><span class="linenum">4781</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You are only allowed to update your own profile!'), 'error' );
<a name="l4782"><span class="linenum">4782</span></a>              <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> = 'only_own_profile';
<a name="l4783"><span class="linenum">4783</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = false;
<a name="l4784"><span class="linenum">4784</span></a>              return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l4785"><span class="linenum">4785</span></a>          }
<a name="l4786"><span class="linenum">4786</span></a>  
<a name="l4787"><span class="linenum">4787</span></a>          if( empty( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> ) )
<a name="l4788"><span class="linenum">4788</span></a>          { // File ID is empty
<a name="l4789"><span class="linenum">4789</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You did not specify a file.'), 'error' );
<a name="l4790"><span class="linenum">4790</span></a>              <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> = 'wrong_file';
<a name="l4791"><span class="linenum">4791</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = false;
<a name="l4792"><span class="linenum">4792</span></a>              return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l4793"><span class="linenum">4793</span></a>          }
<a name="l4794"><span class="linenum">4794</span></a>  
<a name="l4795"><span class="linenum">4795</span></a>          <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a> = &amp; get_FileCache();
<a name="l4796"><span class="linenum">4796</span></a>          <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = &amp; <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a>-&gt;get_by_ID( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, false, false );
<a name="l4797"><span class="linenum">4797</span></a>          if( empty( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> ) )
<a name="l4798"><span class="linenum">4798</span></a>          { // File does't exist
<a name="l4799"><span class="linenum">4799</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The requested file does not exist!'), 'error' );
<a name="l4800"><span class="linenum">4800</span></a>              <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> = 'wrong_file';
<a name="l4801"><span class="linenum">4801</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = false;
<a name="l4802"><span class="linenum">4802</span></a>              return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l4803"><span class="linenum">4803</span></a>          }
<a name="l4804"><span class="linenum">4804</span></a>  
<a name="l4805"><span class="linenum">4805</span></a>          if( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('_FileRoot')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/_FileRoot.html">_FileRoot</a>-&gt;type != 'user' || ( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('_FileRoot')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/_FileRoot.html">_FileRoot</a>-&gt;in_type_ID != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> &amp;&amp; ! <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> ) )
<a name="l4806"><span class="linenum">4806</span></a>          { // don't allow use the pictures from other users
<a name="l4807"><span class="linenum">4807</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('The requested file doesn\'t belong to this user.'), 'error' );
<a name="l4808"><span class="linenum">4808</span></a>              <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> = 'other_user';
<a name="l4809"><span class="linenum">4809</span></a>              <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = false;
<a name="l4810"><span class="linenum">4810</span></a>              return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l4811"><span class="linenum">4811</span></a>          }
<a name="l4812"><span class="linenum">4812</span></a>  
<a name="l4813"><span class="linenum">4813</span></a>          return <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>;
<a name="l4814"><span class="linenum">4814</span></a>      }
<a name="l4815"><span class="linenum">4815</span></a>  
<a name="l4816"><span class="linenum">4816</span></a>  
<a name="l4817"><span class="linenum">4817</span></a>      <span class="comment">/**</span>
<a name="l4818"><span class="linenum">4818</span></a>  <span class="comment">     * Rotate user avatar file</span>
<a name="l4819"><span class="linenum">4819</span></a>  <span class="comment">     *</span>
<a name="l4820"><span class="linenum">4820</span></a>  <span class="comment">     * @param integer the new avatar file ID</span>
<a name="l4821"><span class="linenum">4821</span></a>  <span class="comment">     * @param integer Degrees to rotate</span>
<a name="l4822"><span class="linenum">4822</span></a>  <span class="comment">     * @return object|string File object on success;</span>
<a name="l4823"><span class="linenum">4823</span></a>  <span class="comment">     *         Error code on denied action:</span>
<a name="l4824"><span class="linenum">4824</span></a>  <span class="comment">     *          'only_own_profile' - User can update only own profile</span>
<a name="l4825"><span class="linenum">4825</span></a>  <span class="comment">     *          'wrong_file'       - Request with wrong file ID</span>
<a name="l4826"><span class="linenum">4826</span></a>  <span class="comment">     *          'other_user'       - Restricted to edit files from other users</span>
<a name="l4827"><span class="linenum">4827</span></a>  <span class="comment">     *          'rotate_error'     - Some errors in rotate function</span>
<a name="l4828"><span class="linenum">4828</span></a>  <span class="comment">     */</span>
<a name="l4829"><span class="linenum">4829</span></a>  	function <a class="function" onClick="logFunction('rotate_avatar')" href="../../../_functions/rotate_avatar.html" onMouseOver="funcPopup(event,'rotate_avatar')">rotate_avatar</a>( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('degrees')" href="../../../_variables/degrees.html">$degrees</a> )
<a name="l4830"><span class="linenum">4830</span></a>      {
<a name="l4831"><span class="linenum">4831</span></a>          <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_File_by_ID( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> );
<a name="l4832"><span class="linenum">4832</span></a>          if( ! <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> )
<a name="l4833"><span class="linenum">4833</span></a>          { // The file cannot be used for this user, return error code
<a name="l4834"><span class="linenum">4834</span></a>              return <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a>;
<a name="l4835"><span class="linenum">4835</span></a>          }
<a name="l4836"><span class="linenum">4836</span></a>  
<a name="l4837"><span class="linenum">4837</span></a>          global <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l4838"><span class="linenum">4838</span></a>          <a class="function" onClick="logFunction('load_funcs')" href="../../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( 'files/model/_image.funcs.php' );
<a name="l4839"><span class="linenum">4839</span></a>  
<a name="l4840"><span class="linenum">4840</span></a>          if( !<a class="function" onClick="logFunction('rotate_image')" href="../../../_functions/rotate_image.html" onMouseOver="funcPopup(event,'rotate_image')">rotate_image</a>( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>, <a class="var it1217" onMouseOver="hilite(1217)" onMouseOut="lolite()" onClick="logVariable('degrees')" href="../../../_variables/degrees.html">$degrees</a> ) )
<a name="l4841"><span class="linenum">4841</span></a>          { // Some errors were during rotate the avatar
<a name="l4842"><span class="linenum">4842</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture could not be rotated!'), 'error' );
<a name="l4843"><span class="linenum">4843</span></a>              return 'rotate_error';
<a name="l4844"><span class="linenum">4844</span></a>          }
<a name="l4845"><span class="linenum">4845</span></a>  
<a name="l4846"><span class="linenum">4846</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been rotated.'), 'success' );
<a name="l4847"><span class="linenum">4847</span></a>          return true;
<a name="l4848"><span class="linenum">4848</span></a>      }
<a name="l4849"><span class="linenum">4849</span></a>  
<a name="l4850"><span class="linenum">4850</span></a>  
<a name="l4851"><span class="linenum">4851</span></a>      <span class="comment">/**</span>
<a name="l4852"><span class="linenum">4852</span></a>  <span class="comment">     * Rotate user avatar file</span>
<a name="l4853"><span class="linenum">4853</span></a>  <span class="comment">     *</span>
<a name="l4854"><span class="linenum">4854</span></a>  <span class="comment">     * @param integer the new avatar file ID</span>
<a name="l4855"><span class="linenum">4855</span></a>  <span class="comment">     * @param integer X coordinate (in percents)</span>
<a name="l4856"><span class="linenum">4856</span></a>  <span class="comment">     * @param integer Y coordinate (in percents)</span>
<a name="l4857"><span class="linenum">4857</span></a>  <span class="comment">     * @param integer Width (in percents)</span>
<a name="l4858"><span class="linenum">4858</span></a>  <span class="comment">     * @param integer Height (in percents)</span>
<a name="l4859"><span class="linenum">4859</span></a>  <span class="comment">     * @return object|string File object on success;</span>
<a name="l4860"><span class="linenum">4860</span></a>  <span class="comment">     *         Error code on denied action:</span>
<a name="l4861"><span class="linenum">4861</span></a>  <span class="comment">     *          'only_own_profile' - User can update only own profile</span>
<a name="l4862"><span class="linenum">4862</span></a>  <span class="comment">     *          'wrong_file'       - Request with wrong file ID</span>
<a name="l4863"><span class="linenum">4863</span></a>  <span class="comment">     *          'other_user'       - Restricted to edit files from other users</span>
<a name="l4864"><span class="linenum">4864</span></a>  <span class="comment">     *          'crop_error'       - Some errors in crop function</span>
<a name="l4865"><span class="linenum">4865</span></a>  <span class="comment">     */</span>
<a name="l4866"><span class="linenum">4866</span></a>  	function <a class="function" onClick="logFunction('crop_avatar')" href="../../../_functions/crop_avatar.html" onMouseOver="funcPopup(event,'crop_avatar')">crop_avatar</a>( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('x')" href="../../../_variables/x.html">$x</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('y')" href="../../../_variables/y.html">$y</a>, <a class="var it1123" onMouseOver="hilite(1123)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../../_variables/width.html">$width</a>, <a class="var it1124" onMouseOver="hilite(1124)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../../_variables/height.html">$height</a> )
<a name="l4867"><span class="linenum">4867</span></a>      {
<a name="l4868"><span class="linenum">4868</span></a>          <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = &amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_File_by_ID( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a> );
<a name="l4869"><span class="linenum">4869</span></a>          if( ! <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> )
<a name="l4870"><span class="linenum">4870</span></a>          { // The file cannot be used for this user, return error code
<a name="l4871"><span class="linenum">4871</span></a>              return <a class="var it823" onMouseOver="hilite(823)" onMouseOut="lolite()" onClick="logVariable('error_code')" href="../../../_variables/error_code.html">$error_code</a>;
<a name="l4872"><span class="linenum">4872</span></a>          }
<a name="l4873"><span class="linenum">4873</span></a>  
<a name="l4874"><span class="linenum">4874</span></a>          global <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l4875"><span class="linenum">4875</span></a>          <a class="function" onClick="logFunction('load_funcs')" href="../../../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( 'files/model/_image.funcs.php' );
<a name="l4876"><span class="linenum">4876</span></a>  
<a name="l4877"><span class="linenum">4877</span></a>          if( ! <a class="function" onClick="logFunction('crop_image')" href="../../../_functions/crop_image.html" onMouseOver="funcPopup(event,'crop_image')">crop_image</a>( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>, <a class="var it669" onMouseOver="hilite(669)" onMouseOut="lolite()" onClick="logVariable('x')" href="../../../_variables/x.html">$x</a>, <a class="var it607" onMouseOver="hilite(607)" onMouseOut="lolite()" onClick="logVariable('y')" href="../../../_variables/y.html">$y</a>, <a class="var it1123" onMouseOver="hilite(1123)" onMouseOut="lolite()" onClick="logVariable('width')" href="../../../_variables/width.html">$width</a>, <a class="var it1124" onMouseOver="hilite(1124)" onMouseOut="lolite()" onClick="logVariable('height')" href="../../../_variables/height.html">$height</a>, <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'min_picture_size' ) ), 1024 ) )
<a name="l4878"><span class="linenum">4878</span></a>          { // Some errors were during rotate the avatar
<a name="l4879"><span class="linenum">4879</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture could not be cropped!'), 'error' );
<a name="l4880"><span class="linenum">4880</span></a>              return 'crop_error';
<a name="l4881"><span class="linenum">4881</span></a>          }
<a name="l4882"><span class="linenum">4882</span></a>  
<a name="l4883"><span class="linenum">4883</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been cropped.'), 'success' );
<a name="l4884"><span class="linenum">4884</span></a>          return true;
<a name="l4885"><span class="linenum">4885</span></a>      }
<a name="l4886"><span class="linenum">4886</span></a>  
<a name="l4887"><span class="linenum">4887</span></a>  
<a name="l4888"><span class="linenum">4888</span></a>      <span class="comment">/**</span>
<a name="l4889"><span class="linenum">4889</span></a>  <span class="comment">     * Get the crop avatar icon</span>
<a name="l4890"><span class="linenum">4890</span></a>  <span class="comment">     *</span>
<a name="l4891"><span class="linenum">4891</span></a>  <span class="comment">     * @param integer File ID</span>
<a name="l4892"><span class="linenum">4892</span></a>  <span class="comment">     * @param array Params</span>
<a name="l4893"><span class="linenum">4893</span></a>  <span class="comment">     * @return string HTML text with icon to crop avatar</span>
<a name="l4894"><span class="linenum">4894</span></a>  <span class="comment">     */</span>
<a name="l4895"><span class="linenum">4895</span></a>  	function <a class="function" onClick="logFunction('get_crop_avatar_icon')" href="../../../_functions/get_crop_avatar_icon.html" onMouseOver="funcPopup(event,'get_crop_avatar_icon')">get_crop_avatar_icon</a>( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l4896"><span class="linenum">4896</span></a>      {
<a name="l4897"><span class="linenum">4897</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l4898"><span class="linenum">4898</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l4899"><span class="linenum">4899</span></a>                  'before'   =&gt; '',
<a name="l4900"><span class="linenum">4900</span></a>                  'after'    =&gt; '',
<a name="l4901"><span class="linenum">4901</span></a>                  'text'     =&gt; '',
<a name="l4902"><span class="linenum">4902</span></a>                  'user_tab' =&gt; 'avatar',
<a name="l4903"><span class="linenum">4903</span></a>                  'onclick'  =&gt; '',
<a name="l4904"><span class="linenum">4904</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l4905"><span class="linenum">4905</span></a>  
<a name="l4906"><span class="linenum">4906</span></a>  <span class="comment">        // Init links to rotate avatar</span>
<a name="l4907"><span class="linenum">4907</span></a>          if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() )
<a name="l4908"><span class="linenum">4908</span></a>          { // Back-office
<a name="l4909"><span class="linenum">4909</span></a>  <span class="comment">            //$url_crop = regenerate_url( 'user_tab', 'user_tab=crop&amp;user_ID='.$this-&gt;ID.'&amp;file_ID='.$file_ID.'&amp;'.url_crumb( 'user' ), '', '&amp;' );</span>
<a name="l4910"><span class="linenum">4910</span></a>              <a class="var it4032" onMouseOver="hilite(4032)" onMouseOut="lolite()" onClick="logVariable('url_crop')" href="../../../_variables/url_crop.html">$url_crop</a> = '#';
<a name="l4911"><span class="linenum">4911</span></a>          }
<a name="l4912"><span class="linenum">4912</span></a>          else
<a name="l4913"><span class="linenum">4913</span></a>          { // Front-office
<a name="l4914"><span class="linenum">4914</span></a>              global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l4915"><span class="linenum">4915</span></a>              <a class="var it4032" onMouseOver="hilite(4032)" onMouseOut="lolite()" onClick="logVariable('url_crop')" href="../../../_variables/url_crop.html">$url_crop</a> = <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('gen_blogurl')" href="../../../_functions/gen_blogurl.html" onMouseOver="funcPopup(event,'gen_blogurl')">gen_blogurl</a>(), 'disp=avatar&amp;action=crop&amp;file_ID='.<a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> );
<a name="l4916"><span class="linenum">4916</span></a>          }
<a name="l4917"><span class="linenum">4917</span></a>  
<a name="l4918"><span class="linenum">4918</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['before'];
<a name="l4919"><span class="linenum">4919</span></a>  
<a name="l4920"><span class="linenum">4920</span></a>          <a class="var it4033" onMouseOver="hilite(4033)" onMouseOut="lolite()" onClick="logVariable('link_params')" href="../../../_variables/link_params.html">$link_params</a> = array();
<a name="l4921"><span class="linenum">4921</span></a>          if( ! empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['onclick'] ) )
<a name="l4922"><span class="linenum">4922</span></a>          {
<a name="l4923"><span class="linenum">4923</span></a>              <a class="var it4033" onMouseOver="hilite(4033)" onMouseOut="lolite()" onClick="logVariable('link_params')" href="../../../_variables/link_params.html">$link_params</a>['onclick'] = <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['onclick'];
<a name="l4924"><span class="linenum">4924</span></a>          }
<a name="l4925"><span class="linenum">4925</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> .= <a class="function" onClick="logFunction('action_icon')" href="../../../_functions/action_icon.html" onMouseOver="funcPopup(event,'action_icon')">action_icon</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Crop this picture'), 'crop', <a class="var it4032" onMouseOver="hilite(4032)" onMouseOut="lolite()" onClick="logVariable('url_crop')" href="../../../_variables/url_crop.html">$url_crop</a>, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'], ( empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'] ) ? 0: 3 ), ( empty( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'] ) ? 0: 4 ), <a class="var it4033" onMouseOver="hilite(4033)" onMouseOut="lolite()" onClick="logVariable('link_params')" href="../../../_variables/link_params.html">$link_params</a> );
<a name="l4926"><span class="linenum">4926</span></a>  
<a name="l4927"><span class="linenum">4927</span></a>          <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a> .= <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['after'];
<a name="l4928"><span class="linenum">4928</span></a>  
<a name="l4929"><span class="linenum">4929</span></a>          return <a class="var it1560" onMouseOver="hilite(1560)" onMouseOut="lolite()" onClick="logVariable('html')" href="../../../_variables/html.html">$html</a>;
<a name="l4930"><span class="linenum">4930</span></a>      }
<a name="l4931"><span class="linenum">4931</span></a>  
<a name="l4932"><span class="linenum">4932</span></a>  
<a name="l4933"><span class="linenum">4933</span></a>      <span class="comment">/**</span>
<a name="l4934"><span class="linenum">4934</span></a>  <span class="comment">     * Remove user avatar</span>
<a name="l4935"><span class="linenum">4935</span></a>  <span class="comment">     *</span>
<a name="l4936"><span class="linenum">4936</span></a>  <span class="comment">     * @return mixed true on success, false otherwise</span>
<a name="l4937"><span class="linenum">4937</span></a>  <span class="comment">     */</span>
<a name="l4938"><span class="linenum">4938</span></a>  	function <a class="function" onClick="logFunction('remove_avatar')" href="../../../_functions/remove_avatar.html" onMouseOver="funcPopup(event,'remove_avatar')">remove_avatar</a>( <a class="var it4034" onMouseOver="hilite(4034)" onMouseOut="lolite()" onClick="logVariable('forbid')" href="../../../_variables/forbid.html">$forbid</a> = false )
<a name="l4939"><span class="linenum">4939</span></a>      {
<a name="l4940"><span class="linenum">4940</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l4941"><span class="linenum">4941</span></a>  
<a name="l4942"><span class="linenum">4942</span></a>          <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l4943"><span class="linenum">4943</span></a>          if( ! <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> &amp;&amp; ( <a class="var it4034" onMouseOver="hilite(4034)" onMouseOut="lolite()" onClick="logVariable('forbid')" href="../../../_variables/forbid.html">$forbid</a> || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l4944"><span class="linenum">4944</span></a>          { // user is only allowed to update him/herself
<a name="l4945"><span class="linenum">4945</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You are not allowed to update this profile!'), 'error' );
<a name="l4946"><span class="linenum">4946</span></a>              return false;
<a name="l4947"><span class="linenum">4947</span></a>          }
<a name="l4948"><span class="linenum">4948</span></a>  
<a name="l4949"><span class="linenum">4949</span></a>          <a class="var it4035" onMouseOver="hilite(4035)" onMouseOut="lolite()" onClick="logVariable('forbidden_success')" href="../../../_variables/forbidden_success.html">$forbidden_success</a> = false;
<a name="l4950"><span class="linenum">4950</span></a>          if( <a class="var it4034" onMouseOver="hilite(4034)" onMouseOut="lolite()" onClick="logVariable('forbid')" href="../../../_variables/forbid.html">$forbid</a> &amp;&amp; <a class="var it4029" onMouseOver="hilite(4029)" onMouseOut="lolite()" onClick="logVariable('can_moderate_user')" href="../../../_variables/can_moderate_user.html">$can_moderate_user</a> )
<a name="l4951"><span class="linenum">4951</span></a>          { // Forbid profile picture
<a name="l4952"><span class="linenum">4952</span></a>              <a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('forbidden_file_ID')" href="../../../_variables/forbidden_file_ID.html">$forbidden_file_ID</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'avatar_file_ID' );
<a name="l4953"><span class="linenum">4953</span></a>              <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a> = &amp; get_FileCache();
<a name="l4954"><span class="linenum">4954</span></a>              if( ! ( <a class="var it4037" onMouseOver="hilite(4037)" onMouseOut="lolite()" onClick="logVariable('forbidden_File')" href="../../../_variables/forbidden_File.html">$forbidden_File</a> = &amp; <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a>-&gt;get_by_ID( <a class="var it4036" onMouseOver="hilite(4036)" onMouseOut="lolite()" onClick="logVariable('forbidden_file_ID')" href="../../../_variables/forbidden_file_ID.html">$forbidden_file_ID</a>, false, false ) ) )
<a name="l4955"><span class="linenum">4955</span></a>              { // Broken avatar file
<a name="l4956"><span class="linenum">4956</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture is not found!'), 'error' );
<a name="l4957"><span class="linenum">4957</span></a>                  return false;
<a name="l4958"><span class="linenum">4958</span></a>              }
<a name="l4959"><span class="linenum">4959</span></a>  
<a name="l4960"><span class="linenum">4960</span></a>              <a class="var it4037" onMouseOver="hilite(4037)" onMouseOut="lolite()" onClick="logVariable('forbidden_File')" href="../../../_variables/forbidden_File.html">$forbidden_File</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'can_be_main_profile', '0' );
<a name="l4961"><span class="linenum">4961</span></a>              <a class="var it4035" onMouseOver="hilite(4035)" onMouseOut="lolite()" onClick="logVariable('forbidden_success')" href="../../../_variables/forbidden_success.html">$forbidden_success</a> = <a class="var it4037" onMouseOver="hilite(4037)" onMouseOut="lolite()" onClick="logVariable('forbidden_File')" href="../../../_variables/forbidden_File.html">$forbidden_File</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l4962"><span class="linenum">4962</span></a>          }
<a name="l4963"><span class="linenum">4963</span></a>  
<a name="l4964"><span class="linenum">4964</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'avatar_file_ID', NULL, true );
<a name="l4965"><span class="linenum">4965</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l4966"><span class="linenum">4966</span></a>  
<a name="l4967"><span class="linenum">4967</span></a>          if( <a class="var it4035" onMouseOver="hilite(4035)" onMouseOut="lolite()" onClick="logVariable('forbidden_success')" href="../../../_variables/forbidden_success.html">$forbidden_success</a> )
<a name="l4968"><span class="linenum">4968</span></a>          {
<a name="l4969"><span class="linenum">4969</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been forbidden.'), 'success' );
<a name="l4970"><span class="linenum">4970</span></a>          }
<a name="l4971"><span class="linenum">4971</span></a>          else
<a name="l4972"><span class="linenum">4972</span></a>          {
<a name="l4973"><span class="linenum">4973</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been removed.'), 'success' );
<a name="l4974"><span class="linenum">4974</span></a>          }
<a name="l4975"><span class="linenum">4975</span></a>  
<a name="l4976"><span class="linenum">4976</span></a>          return true;
<a name="l4977"><span class="linenum">4977</span></a>      }
<a name="l4978"><span class="linenum">4978</span></a>  
<a name="l4979"><span class="linenum">4979</span></a>  
<a name="l4980"><span class="linenum">4980</span></a>      <span class="comment">/**</span>
<a name="l4981"><span class="linenum">4981</span></a>  <span class="comment">     * Delete user avatar file</span>
<a name="l4982"><span class="linenum">4982</span></a>  <span class="comment">     *</span>
<a name="l4983"><span class="linenum">4983</span></a>  <span class="comment">     * @param integer the avatar file ID</span>
<a name="l4984"><span class="linenum">4984</span></a>  <span class="comment">     * @return mixed true on success, allowed action otherwise</span>
<a name="l4985"><span class="linenum">4985</span></a>  <span class="comment">     */</span>
<a name="l4986"><span class="linenum">4986</span></a>  	function <a class="function" onClick="logFunction('delete_avatar')" href="../../../_functions/delete_avatar.html" onMouseOver="funcPopup(event,'delete_avatar')">delete_avatar</a>( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> )
<a name="l4987"><span class="linenum">4987</span></a>      {
<a name="l4988"><span class="linenum">4988</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>;
<a name="l4989"><span class="linenum">4989</span></a>  
<a name="l4990"><span class="linenum">4990</span></a>          if( ! <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l4991"><span class="linenum">4991</span></a>          { // user is only allowed to update him/herself
<a name="l4992"><span class="linenum">4992</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You are only allowed to update your own profile!'), 'error' );
<a name="l4993"><span class="linenum">4993</span></a>              return 'view';
<a name="l4994"><span class="linenum">4994</span></a>          }
<a name="l4995"><span class="linenum">4995</span></a>  
<a name="l4996"><span class="linenum">4996</span></a>          if( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> == NULL )
<a name="l4997"><span class="linenum">4997</span></a>          {
<a name="l4998"><span class="linenum">4998</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture could not be changed!'), 'error' );
<a name="l4999"><span class="linenum">4999</span></a>              return 'edit';
<a name="l5000"><span class="linenum">5000</span></a>          }
<a name="l5001"><span class="linenum">5001</span></a>  
<a name="l5002"><span class="linenum">5002</span></a>          <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a> = <span class="keyword">new </span><a class="class" onClick="logClass('LinkUser')" href="../../../_classes/linkuser.html" onMouseOver="classPopup(event,'linkuser')">LinkUser</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> );
<a name="l5003"><span class="linenum">5003</span></a>          <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a> = &amp; <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a>-&gt;get_link_by_file_ID( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> );
<a name="l5004"><span class="linenum">5004</span></a>          if( <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a> )
<a name="l5005"><span class="linenum">5005</span></a>          {
<a name="l5006"><span class="linenum">5006</span></a>              <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a>-&gt;get_File();
<a name="l5007"><span class="linenum">5007</span></a>              <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a>-&gt;<a class="function" onClick="logFunction('remove_link')" href="../../../_functions/remove_link.html" onMouseOver="funcPopup(event,'remove_link')">remove_link</a>( <a class="var it564" onMouseOver="hilite(564)" onMouseOut="lolite()" onClick="logVariable('Link')" href="../../../_variables/Link.html">$Link</a> );
<a name="l5008"><span class="linenum">5008</span></a>          }
<a name="l5009"><span class="linenum">5009</span></a>          else
<a name="l5010"><span class="linenum">5010</span></a>          {
<a name="l5011"><span class="linenum">5011</span></a>              <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a> = &amp; get_FileCache();
<a name="l5012"><span class="linenum">5012</span></a>              <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = <a class="var it1102" onMouseOver="hilite(1102)" onMouseOut="lolite()" onClick="logVariable('FileCache')" href="../../../_variables/FileCache.html">$FileCache</a>-&gt;get_by_ID( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> );
<a name="l5013"><span class="linenum">5013</span></a>          }
<a name="l5014"><span class="linenum">5014</span></a>  
<a name="l5015"><span class="linenum">5015</span></a>          if( <a class="var it1193" onMouseOver="hilite(1193)" onMouseOut="lolite()" onClick="logVariable('file_ID')" href="../../../_variables/file_ID.html">$file_ID</a> == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('avatar_file_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/avatar_file_ID.html">avatar_file_ID</a> )
<a name="l5016"><span class="linenum">5016</span></a>          {    // Unset this picture from user avatar if it is used as main picture
<a name="l5017"><span class="linenum">5017</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'avatar_file_ID', NULL, true );
<a name="l5018"><span class="linenum">5018</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l5019"><span class="linenum">5019</span></a>          }
<a name="l5020"><span class="linenum">5020</span></a>  
<a name="l5021"><span class="linenum">5021</span></a>          if( ( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('_FileRoot')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/_FileRoot.html">_FileRoot</a>-&gt;type == 'user' ) &amp;&amp; ( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('_FileRoot')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/_FileRoot.html">_FileRoot</a>-&gt;in_type_ID == <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l5022"><span class="linenum">5022</span></a>              &amp;&amp; ( <a class="phpfunction" onClick="logFunction('strpos')" href="../../../_functions/strpos.html" onMouseOver="phpfuncPopup(event,'strpos')">strpos</a>( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_rdfp_rel_path')" href="../../../_functions/get_rdfp_rel_path.html" onMouseOver="funcPopup(event,'get_rdfp_rel_path')">get_rdfp_rel_path</a>(), 'profile_pictures' ) === 0 ) )
<a name="l5023"><span class="linenum">5023</span></a>          { // Delete the file if it is in the current User profile_pictures folder
<a name="l5024"><span class="linenum">5024</span></a>              <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="phpfunction" onClick="logFunction('unlink')" href="../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>();
<a name="l5025"><span class="linenum">5025</span></a>          }
<a name="l5026"><span class="linenum">5026</span></a>  
<a name="l5027"><span class="linenum">5027</span></a>          <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been deleted.'), 'success' );
<a name="l5028"><span class="linenum">5028</span></a>          return true;
<a name="l5029"><span class="linenum">5029</span></a>      }
<a name="l5030"><span class="linenum">5030</span></a>  
<a name="l5031"><span class="linenum">5031</span></a>  
<a name="l5032"><span class="linenum">5032</span></a>      <span class="comment">/**</span>
<a name="l5033"><span class="linenum">5033</span></a>  <span class="comment">     * Update user avatar file to the currently uploaded file</span>
<a name="l5034"><span class="linenum">5034</span></a>  <span class="comment">     *</span>
<a name="l5035"><span class="linenum">5035</span></a>  <span class="comment">     * @return mixed true on success, allowed action otherwise.</span>
<a name="l5036"><span class="linenum">5036</span></a>  <span class="comment">     */</span>
<a name="l5037"><span class="linenum">5037</span></a>  	function <a class="function" onClick="logFunction('update_avatar_from_upload')" href="../../../_functions/update_avatar_from_upload.html" onMouseOver="funcPopup(event,'update_avatar_from_upload')">update_avatar_from_upload</a>()
<a name="l5038"><span class="linenum">5038</span></a>      {
<a name="l5039"><span class="linenum">5039</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l5040"><span class="linenum">5040</span></a>  
<a name="l5041"><span class="linenum">5041</span></a>          if( ! <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) &amp;&amp; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> != <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l5042"><span class="linenum">5042</span></a>          { // user is only allowed to update him/herself
<a name="l5043"><span class="linenum">5043</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('You are only allowed to update your own profile!'), 'error' );
<a name="l5044"><span class="linenum">5044</span></a>              return 'view';
<a name="l5045"><span class="linenum">5045</span></a>          }
<a name="l5046"><span class="linenum">5046</span></a>  
<a name="l5047"><span class="linenum">5047</span></a>  <span class="comment">        // process upload</span>
<a name="l5048"><span class="linenum">5048</span></a>          <a class="var it581" onMouseOver="hilite(581)" onMouseOut="lolite()" onClick="logVariable('FileRootCache')" href="../../../_variables/FileRootCache.html">$FileRootCache</a> = &amp; get_FileRootCache();
<a name="l5049"><span class="linenum">5049</span></a>          <a class="var it577" onMouseOver="hilite(577)" onMouseOut="lolite()" onClick="logVariable('root')" href="../../../_variables/root.html">$root</a> = <a class="class" onClick="logClass('FileRoot')" href="../../../_classes/fileroot.html" onMouseOver="classPopup(event,'fileroot')">FileRoot</a>::<a class="function" onClick="logFunction('gen_ID')" href="../../../_functions/gen_id.html" onMouseOver="funcPopup(event,'gen_id')">gen_ID</a>( 'user', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5050"><span class="linenum">5050</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="function" onClick="logFunction('process_upload')" href="../../../_functions/process_upload.html" onMouseOver="funcPopup(event,'process_upload')">process_upload</a>( <a class="var it577" onMouseOver="hilite(577)" onMouseOut="lolite()" onClick="logVariable('root')" href="../../../_variables/root.html">$root</a>, 'profile_pictures', true, false, true, false, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'min_picture_size' ) );
<a name="l5051"><span class="linenum">5051</span></a>          if( empty( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> ) )
<a name="l5052"><span class="linenum">5052</span></a>          {
<a name="l5053"><span class="linenum">5053</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'You don\'t have permission to selected user file root.' ), 'error' );
<a name="l5054"><span class="linenum">5054</span></a>              return 'view';
<a name="l5055"><span class="linenum">5055</span></a>          }
<a name="l5056"><span class="linenum">5056</span></a>  
<a name="l5057"><span class="linenum">5057</span></a>          <a class="var it2856" onMouseOver="hilite(2856)" onMouseOut="lolite()" onClick="logVariable('uploadedFiles')" href="../../../_variables/uploadedFiles.html">$uploadedFiles</a> = <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>['uploadedFiles'];
<a name="l5058"><span class="linenum">5058</span></a>          if( !empty( <a class="var it2856" onMouseOver="hilite(2856)" onMouseOut="lolite()" onClick="logVariable('uploadedFiles')" href="../../../_variables/uploadedFiles.html">$uploadedFiles</a> ) )
<a name="l5059"><span class="linenum">5059</span></a>          { // upload was successful
<a name="l5060"><span class="linenum">5060</span></a>              <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a> = <a class="var it2856" onMouseOver="hilite(2856)" onMouseOut="lolite()" onClick="logVariable('uploadedFiles')" href="../../../_variables/uploadedFiles.html">$uploadedFiles</a>[0];
<a name="l5061"><span class="linenum">5061</span></a>              <a class="var it4038" onMouseOver="hilite(4038)" onMouseOut="lolite()" onClick="logVariable('duplicated_files')" href="../../../_variables/duplicated_files.html">$duplicated_files</a> = <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('get_duplicated_files')" href="../../../_functions/get_duplicated_files.html" onMouseOver="funcPopup(event,'get_duplicated_files')">get_duplicated_files</a>( array( 'root_ID' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5062"><span class="linenum">5062</span></a>              if( ! empty( <a class="var it4038" onMouseOver="hilite(4038)" onMouseOut="lolite()" onClick="logVariable('duplicated_files')" href="../../../_variables/duplicated_files.html">$duplicated_files</a> ) )
<a name="l5063"><span class="linenum">5063</span></a>              { // The file is the duplicate of other profile picture, we should delete it
<a name="l5064"><span class="linenum">5064</span></a>                  <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>();
<a name="l5065"><span class="linenum">5065</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'It seems you are trying to upload the same profile picture twice.' ), 'error' );
<a name="l5066"><span class="linenum">5066</span></a>                  return 'edit';
<a name="l5067"><span class="linenum">5067</span></a>              }
<a name="l5068"><span class="linenum">5068</span></a>              elseif( <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('is_image')" href="../../../_functions/is_image.html" onMouseOver="funcPopup(event,'is_image')">is_image</a>() )
<a name="l5069"><span class="linenum">5069</span></a>              { // uploaded file is an image
<a name="l5070"><span class="linenum">5070</span></a>                  <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a> = <span class="keyword">new </span><a class="class" onClick="logClass('LinkUser')" href="../../../_classes/linkuser.html" onMouseOver="classPopup(event,'linkuser')">LinkUser</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a> );
<a name="l5071"><span class="linenum">5071</span></a>                  <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="function" onClick="logFunction('link_to_Object')" href="../../../_functions/link_to_object.html" onMouseOver="funcPopup(event,'link_to_object')">link_to_Object</a>( <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a> );
<a name="l5072"><span class="linenum">5072</span></a>                  <a class="var it4039" onMouseOver="hilite(4039)" onMouseOut="lolite()" onClick="logVariable('avatar_changed')" href="../../../_variables/avatar_changed.html">$avatar_changed</a> = false;
<a name="l5073"><span class="linenum">5073</span></a>                  if( empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('avatar_file_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/avatar_file_ID.html">avatar_file_ID</a> ) )
<a name="l5074"><span class="linenum">5074</span></a>                  { // set uploaded image as avatar
<a name="l5075"><span class="linenum">5075</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'avatar_file_ID', <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('ID')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, true );
<a name="l5076"><span class="linenum">5076</span></a>  <span class="comment">                    // update profileupdate_date, because a publicly visible user property was changed</span>
<a name="l5077"><span class="linenum">5077</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_profileupdate_date')" href="../../../_functions/set_profileupdate_date.html" onMouseOver="funcPopup(event,'set_profileupdate_date')">set_profileupdate_date</a>();
<a name="l5078"><span class="linenum">5078</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l5079"><span class="linenum">5079</span></a>                      <a class="var it4039" onMouseOver="hilite(4039)" onMouseOut="lolite()" onClick="logVariable('avatar_changed')" href="../../../_variables/avatar_changed.html">$avatar_changed</a> = true;
<a name="l5080"><span class="linenum">5080</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Profile picture has been changed.'), 'success' );
<a name="l5081"><span class="linenum">5081</span></a>                  }
<a name="l5082"><span class="linenum">5082</span></a>                  else
<a name="l5083"><span class="linenum">5083</span></a>                  { // User already has the avatar
<a name="l5084"><span class="linenum">5084</span></a>                      <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('New picture has been uploaded.'), 'success' );
<a name="l5085"><span class="linenum">5085</span></a>                  }
<a name="l5086"><span class="linenum">5086</span></a>  <span class="comment">                // Clear previous Links to load new uploaded file</span>
<a name="l5087"><span class="linenum">5087</span></a>                  <a class="var it570" onMouseOver="hilite(570)" onMouseOut="lolite()" onClick="logVariable('LinkOwner')" href="../../../_variables/LinkOwner.html">$LinkOwner</a>-&gt;<a class="function" onClick="logFunction('clear_Links')" href="../../../_functions/clear_links.html" onMouseOver="funcPopup(event,'clear_links')">clear_Links</a>();
<a name="l5088"><span class="linenum">5088</span></a>  <span class="comment">                // Send notification email about the changes of user account</span>
<a name="l5089"><span class="linenum">5089</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('send_account_changed_notification')" href="../../../_functions/send_account_changed_notification.html" onMouseOver="funcPopup(event,'send_account_changed_notification')">send_account_changed_notification</a>( <a class="var it4039" onMouseOver="hilite(4039)" onMouseOut="lolite()" onClick="logVariable('avatar_changed')" href="../../../_variables/avatar_changed.html">$avatar_changed</a>, <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a onClick="logVariable('ID')" class="var it10679" onMouseOver="hilite(10679)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5090"><span class="linenum">5090</span></a>                  return true;
<a name="l5091"><span class="linenum">5091</span></a>              }
<a name="l5092"><span class="linenum">5092</span></a>              else
<a name="l5093"><span class="linenum">5093</span></a>              { // uploaded file is not an image, delete the file
<a name="l5094"><span class="linenum">5094</span></a>                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( 'The file you uploaded does not seem to be an image.' ) );
<a name="l5095"><span class="linenum">5095</span></a>                  <a class="var it565" onMouseOver="hilite(565)" onMouseOut="lolite()" onClick="logVariable('File')" href="../../../_variables/File.html">$File</a>-&gt;<a class="phpfunction" onClick="logFunction('unlink')" href="../../../_functions/unlink.html" onMouseOver="phpfuncPopup(event,'unlink')">unlink</a>();
<a name="l5096"><span class="linenum">5096</span></a>              }
<a name="l5097"><span class="linenum">5097</span></a>          }
<a name="l5098"><span class="linenum">5098</span></a>  
<a name="l5099"><span class="linenum">5099</span></a>          <a class="var it2855" onMouseOver="hilite(2855)" onMouseOut="lolite()" onClick="logVariable('failedFiles')" href="../../../_variables/failedFiles.html">$failedFiles</a> = <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>['failedFiles'];
<a name="l5100"><span class="linenum">5100</span></a>          if( !empty( <a class="var it2855" onMouseOver="hilite(2855)" onMouseOut="lolite()" onClick="logVariable('failedFiles')" href="../../../_variables/failedFiles.html">$failedFiles</a> ) )
<a name="l5101"><span class="linenum">5101</span></a>          {
<a name="l5102"><span class="linenum">5102</span></a>              <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( <a class="var it2855" onMouseOver="hilite(2855)" onMouseOut="lolite()" onClick="logVariable('failedFiles')" href="../../../_variables/failedFiles.html">$failedFiles</a>[0] );
<a name="l5103"><span class="linenum">5103</span></a>          }
<a name="l5104"><span class="linenum">5104</span></a>  
<a name="l5105"><span class="linenum">5105</span></a>          return 'edit';
<a name="l5106"><span class="linenum">5106</span></a>      }
<a name="l5107"><span class="linenum">5107</span></a>  
<a name="l5108"><span class="linenum">5108</span></a>  
<a name="l5109"><span class="linenum">5109</span></a>      <span class="comment">/**</span>
<a name="l5110"><span class="linenum">5110</span></a>  <span class="comment">     * Get session param from the user last session</span>
<a name="l5111"><span class="linenum">5111</span></a>  <span class="comment">     *</span>
<a name="l5112"><span class="linenum">5112</span></a>  <span class="comment">     * @param string param name</span>
<a name="l5113"><span class="linenum">5113</span></a>  <span class="comment">     * @return mixed param value</span>
<a name="l5114"><span class="linenum">5114</span></a>  <span class="comment">     */</span>
<a name="l5115"><span class="linenum">5115</span></a>  	function <a class="function" onClick="logFunction('get_last_session_param')" href="../../../_functions/get_last_session_param.html" onMouseOver="funcPopup(event,'get_last_session_param')">get_last_session_param</a>( <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> )
<a name="l5116"><span class="linenum">5116</span></a>      {
<a name="l5117"><span class="linenum">5117</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l5118"><span class="linenum">5118</span></a>  
<a name="l5119"><span class="linenum">5119</span></a>          <a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> = 'sess_'.<a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a>;
<a name="l5120"><span class="linenum">5120</span></a>          <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> = 'SELECT sess_ID, '.<a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a>.'
<a name="l5121"><span class="linenum">5121</span></a>                      FROM T_sessions
<a name="l5122"><span class="linenum">5122</span></a>                      WHERE sess_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l5123"><span class="linenum">5123</span></a>                      ORDER BY sess_ID DESC
<a name="l5124"><span class="linenum">5124</span></a>                      LIMIT 1';
<a name="l5125"><span class="linenum">5125</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> );
<a name="l5126"><span class="linenum">5126</span></a>          if( !empty( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> ) )
<a name="l5127"><span class="linenum">5127</span></a>          {
<a name="l5128"><span class="linenum">5128</span></a>              return <a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>-&gt;<a class="var it1648" onMouseOver="hilite(1648)" onMouseOut="lolite()" onClick="logVariable('parname')" href="../../../_variables/parname.html">$parname</a> );
<a name="l5129"><span class="linenum">5129</span></a>          }
<a name="l5130"><span class="linenum">5130</span></a>  
<a name="l5131"><span class="linenum">5131</span></a>          return NULL;
<a name="l5132"><span class="linenum">5132</span></a>      }
<a name="l5133"><span class="linenum">5133</span></a>  
<a name="l5134"><span class="linenum">5134</span></a>      <span class="comment">/**</span>
<a name="l5135"><span class="linenum">5135</span></a>  <span class="comment">     * Get session param from the user first session, hit</span>
<a name="l5136"><span class="linenum">5136</span></a>  <span class="comment">     * @param integer Session Id</span>
<a name="l5137"><span class="linenum">5137</span></a>  <span class="comment">     * @return object of params</span>
<a name="l5138"><span class="linenum">5138</span></a>  <span class="comment">     */</span>
<a name="l5139"><span class="linenum">5139</span></a>  	function <a class="function" onClick="logFunction('get_first_session_hit_params')" href="../../../_functions/get_first_session_hit_params.html" onMouseOver="funcPopup(event,'get_first_session_hit_params')">get_first_session_hit_params</a>( <a class="var it4040" onMouseOver="hilite(4040)" onMouseOut="lolite()" onClick="logVariable('sess_id')" href="../../../_variables/sess_id.html">$sess_id</a> )
<a name="l5140"><span class="linenum">5140</span></a>      {
<a name="l5141"><span class="linenum">5141</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l5142"><span class="linenum">5142</span></a>  
<a name="l5143"><span class="linenum">5143</span></a>          <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> = 'SELECT *
<a name="l5144"><span class="linenum">5144</span></a>                      FROM T_hitlog
<a name="l5145"><span class="linenum">5145</span></a>                      WHERE hit_sess_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4040" onMouseOver="hilite(4040)" onMouseOut="lolite()" onClick="logVariable('sess_id')" href="../../../_variables/sess_id.html">$sess_id</a> ).'
<a name="l5146"><span class="linenum">5146</span></a>                      ORDER BY hit_ID ASC
<a name="l5147"><span class="linenum">5147</span></a>                      LIMIT 1';
<a name="l5148"><span class="linenum">5148</span></a>  
<a name="l5149"><span class="linenum">5149</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( <a class="var it1657" onMouseOver="hilite(1657)" onMouseOut="lolite()" onClick="logVariable('query')" href="../../../_variables/query.html">$query</a> );
<a name="l5150"><span class="linenum">5150</span></a>  
<a name="l5151"><span class="linenum">5151</span></a>          if( !empty( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> ) )
<a name="l5152"><span class="linenum">5152</span></a>          {
<a name="l5153"><span class="linenum">5153</span></a>              return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l5154"><span class="linenum">5154</span></a>          }
<a name="l5155"><span class="linenum">5155</span></a>  
<a name="l5156"><span class="linenum">5156</span></a>          return NULL;
<a name="l5157"><span class="linenum">5157</span></a>      }
<a name="l5158"><span class="linenum">5158</span></a>  
<a name="l5159"><span class="linenum">5159</span></a>      <span class="comment">/**</span>
<a name="l5160"><span class="linenum">5160</span></a>  <span class="comment">     * Send a welcome private message</span>
<a name="l5161"><span class="linenum">5161</span></a>  <span class="comment">     */</span>
<a name="l5162"><span class="linenum">5162</span></a>  	function <a class="function" onClick="logFunction('send_welcome_message')" href="../../../_functions/send_welcome_message.html" onMouseOver="funcPopup(event,'send_welcome_message')">send_welcome_message</a>()
<a name="l5163"><span class="linenum">5163</span></a>      {
<a name="l5164"><span class="linenum">5164</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>;
<a name="l5165"><span class="linenum">5165</span></a>  
<a name="l5166"><span class="linenum">5166</span></a>          if( !<a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'welcomepm_enabled' ) )
<a name="l5167"><span class="linenum">5167</span></a>          { // Sending of welcome PM is disabled
<a name="l5168"><span class="linenum">5168</span></a>              return false;
<a name="l5169"><span class="linenum">5169</span></a>          }
<a name="l5170"><span class="linenum">5170</span></a>  
<a name="l5171"><span class="linenum">5171</span></a>          if( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'welcome_message_sent', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l5172"><span class="linenum">5172</span></a>          { // User already received the welcome message
<a name="l5173"><span class="linenum">5173</span></a>              return false;
<a name="l5174"><span class="linenum">5174</span></a>          }
<a name="l5175"><span class="linenum">5175</span></a>  
<a name="l5176"><span class="linenum">5176</span></a>          if( !<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('accepts_pm')" href="../../../_functions/accepts_pm.html" onMouseOver="funcPopup(event,'accepts_pm')">accepts_pm</a>() )
<a name="l5177"><span class="linenum">5177</span></a>          { // user can't read private messages, or doesn't want to receive private messages
<a name="l5178"><span class="linenum">5178</span></a>              return false;
<a name="l5179"><span class="linenum">5179</span></a>          }
<a name="l5180"><span class="linenum">5180</span></a>  
<a name="l5181"><span class="linenum">5181</span></a>  <span class="comment">        // Check sender user login for existing</span>
<a name="l5182"><span class="linenum">5182</span></a>          <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l5183"><span class="linenum">5183</span></a>          <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a> = <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_login( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'welcomepm_from' ) );
<a name="l5184"><span class="linenum">5184</span></a>          if( !<a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a> )
<a name="l5185"><span class="linenum">5185</span></a>          { // Don't send an welcome email if sender login is incorrect
<a name="l5186"><span class="linenum">5186</span></a>              return false;
<a name="l5187"><span class="linenum">5187</span></a>          }
<a name="l5188"><span class="linenum">5188</span></a>  
<a name="l5189"><span class="linenum">5189</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'messaging/model/_thread.class.php', 'Thread' );
<a name="l5190"><span class="linenum">5190</span></a>          <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'messaging/model/_message.class.php', 'Message' );
<a name="l5191"><span class="linenum">5191</span></a>  
<a name="l5192"><span class="linenum">5192</span></a>  <span class="comment">        // Insert new thread:</span>
<a name="l5193"><span class="linenum">5193</span></a>          <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Thread')" href="../../../_classes/thread.html" onMouseOver="classPopup(event,'thread')">Thread</a>();
<a name="l5194"><span class="linenum">5194</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Message')" href="../../../_classes/message.html" onMouseOver="classPopup(event,'message')">Message</a>();
<a name="l5195"><span class="linenum">5195</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a onClick="logVariable('Thread')" class="var it10740" onMouseOver="hilite(10740)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a> = &amp; <a class="var it121" onMouseOver="hilite(121)" onMouseOut="lolite()" onClick="logVariable('edited_Thread')" href="../../../_variables/edited_Thread.html">$edited_Thread</a>;
<a name="l5196"><span class="linenum">5196</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a onClick="logVariable('Thread')" class="var it10740" onMouseOver="hilite(10740)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'title', <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'welcomepm_title' ) );
<a name="l5197"><span class="linenum">5197</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a onClick="logVariable('Thread')" class="var it10740" onMouseOver="hilite(10740)" onMouseOut="lolite()" href="../../../_variables/Thread.html">Thread</a>-&gt;recipients_list = array( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5198"><span class="linenum">5198</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'author_user_ID', <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('ID')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5199"><span class="linenum">5199</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a onClick="logVariable('creator_user_ID')" class="var it10740" onMouseOver="hilite(10740)" onMouseOut="lolite()" href="../../../_variables/creator_user_ID.html">creator_user_ID</a> = <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('ID')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l5200"><span class="linenum">5200</span></a>          <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'text', <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'welcomepm_message' ) );
<a name="l5201"><span class="linenum">5201</span></a>          if( <a class="var it122" onMouseOver="hilite(122)" onMouseOut="lolite()" onClick="logVariable('edited_Message')" href="../../../_variables/edited_Message.html">$edited_Message</a>-&gt;<a class="function" onClick="logFunction('dbinsert_individual')" href="../../../_functions/dbinsert_individual.html" onMouseOver="funcPopup(event,'dbinsert_individual')">dbinsert_individual</a>( <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a> ) )
<a name="l5202"><span class="linenum">5202</span></a>          { // The welcome message was sent/created successfully
<a name="l5203"><span class="linenum">5203</span></a>  <span class="comment">            // Change user setting to TRUE in order to don't send it twice</span>
<a name="l5204"><span class="linenum">5204</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'welcome_message_sent', 1, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5205"><span class="linenum">5205</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l5206"><span class="linenum">5206</span></a>          }
<a name="l5207"><span class="linenum">5207</span></a>      }
<a name="l5208"><span class="linenum">5208</span></a>  
<a name="l5209"><span class="linenum">5209</span></a>  
<a name="l5210"><span class="linenum">5210</span></a>      <span class="comment">/**</span>
<a name="l5211"><span class="linenum">5211</span></a>  <span class="comment">     * Update notification sender's info from General settings</span>
<a name="l5212"><span class="linenum">5212</span></a>  <span class="comment">     *</span>
<a name="l5213"><span class="linenum">5213</span></a>  <span class="comment">     * @param boolean TRUE - to force an updating of the fields</span>
<a name="l5214"><span class="linenum">5214</span></a>  <span class="comment">     */</span>
<a name="l5215"><span class="linenum">5215</span></a>  	function <a class="function" onClick="logFunction('update_sender')" href="../../../_functions/update_sender.html" onMouseOver="funcPopup(event,'update_sender')">update_sender</a>( <a class="var it4041" onMouseOver="hilite(4041)" onMouseOut="lolite()" onClick="logVariable('force_update')" href="../../../_variables/force_update.html">$force_update</a> = false )
<a name="l5216"><span class="linenum">5216</span></a>      {
<a name="l5217"><span class="linenum">5217</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>;
<a name="l5218"><span class="linenum">5218</span></a>  
<a name="l5219"><span class="linenum">5219</span></a>          if( <a class="var it4041" onMouseOver="hilite(4041)" onMouseOut="lolite()" onClick="logVariable('force_update')" href="../../../_variables/force_update.html">$force_update</a> || <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notification_sender_email', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) == '' )
<a name="l5220"><span class="linenum">5220</span></a>          { // Update sender's email
<a name="l5221"><span class="linenum">5221</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notification_sender_email', <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notification_sender_email' ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5222"><span class="linenum">5222</span></a>          }
<a name="l5223"><span class="linenum">5223</span></a>          if( <a class="var it4041" onMouseOver="hilite(4041)" onMouseOut="lolite()" onClick="logVariable('force_update')" href="../../../_variables/force_update.html">$force_update</a> || ( ( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notification_sender_name', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) == '' ) &amp;&amp; ( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notification_sender_name' ) != 'b2evo mailer' ) ) )
<a name="l5224"><span class="linenum">5224</span></a>          { // Update sender's name if it was not set and the general settings has different value then the default
<a name="l5225"><span class="linenum">5225</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'notification_sender_name', <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'notification_sender_name' ), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5226"><span class="linenum">5226</span></a>          }
<a name="l5227"><span class="linenum">5227</span></a>  
<a name="l5228"><span class="linenum">5228</span></a>          <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l5229"><span class="linenum">5229</span></a>      }
<a name="l5230"><span class="linenum">5230</span></a>  
<a name="l5231"><span class="linenum">5231</span></a>  
<a name="l5232"><span class="linenum">5232</span></a>      <span class="comment">/**</span>
<a name="l5233"><span class="linenum">5233</span></a>  <span class="comment">     * Get all own blogs of this user which current user can delete</span>
<a name="l5234"><span class="linenum">5234</span></a>  <span class="comment">     *</span>
<a name="l5235"><span class="linenum">5235</span></a>  <span class="comment">     * @return array Blogs</span>
<a name="l5236"><span class="linenum">5236</span></a>  <span class="comment">     */</span>
<a name="l5237"><span class="linenum">5237</span></a>  	function <a class="function" onClick="logFunction('get_deleted_blogs')" href="../../../_functions/get_deleted_blogs.html" onMouseOver="funcPopup(event,'get_deleted_blogs')">get_deleted_blogs</a>()
<a name="l5238"><span class="linenum">5238</span></a>      {
<a name="l5239"><span class="linenum">5239</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5240"><span class="linenum">5240</span></a>  
<a name="l5241"><span class="linenum">5241</span></a>  <span class="comment">        // Get all own blogs of the edited user</span>
<a name="l5242"><span class="linenum">5242</span></a>          <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a> = &amp; get_BlogCache();
<a name="l5243"><span class="linenum">5243</span></a>          <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a>-&gt;<a onClick="logVariable('ID_array')" class="var it10874" onMouseOver="hilite(10874)" onMouseOut="lolite()" href="../../../_variables/ID_array.html">ID_array</a> = array();
<a name="l5244"><span class="linenum">5244</span></a>          <a class="var it4043" onMouseOver="hilite(4043)" onMouseOut="lolite()" onClick="logVariable('user_Blogs')" href="../../../_variables/user_Blogs.html">$user_Blogs</a> = <a class="var it318" onMouseOver="hilite(318)" onMouseOut="lolite()" onClick="logVariable('BlogCache')" href="../../../_variables/BlogCache.html">$BlogCache</a>-&gt;<a class="function" onClick="logFunction('load_where')" href="../../../_functions/load_where.html" onMouseOver="funcPopup(event,'load_where')">load_where</a>( 'blog_owner_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5245"><span class="linenum">5245</span></a>  
<a name="l5246"><span class="linenum">5246</span></a>          <a class="var it4044" onMouseOver="hilite(4044)" onMouseOut="lolite()" onClick="logVariable('deleted_Blogs')" href="../../../_variables/deleted_Blogs.html">$deleted_Blogs</a> = array();
<a name="l5247"><span class="linenum">5247</span></a>          foreach( <a class="var it4043" onMouseOver="hilite(4043)" onMouseOut="lolite()" onClick="logVariable('user_Blogs')" href="../../../_variables/user_Blogs.html">$user_Blogs</a> as <a class="var it4045" onMouseOver="hilite(4045)" onMouseOut="lolite()" onClick="logVariable('user_Blog')" href="../../../_variables/user_Blog.html">$user_Blog</a> )
<a name="l5248"><span class="linenum">5248</span></a>          {
<a name="l5249"><span class="linenum">5249</span></a>              if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'blog_properties', 'edit', false, <a class="var it4045" onMouseOver="hilite(4045)" onMouseOut="lolite()" onClick="logVariable('user_Blog')" href="../../../_variables/user_Blog.html">$user_Blog</a>-&gt;<a onClick="logVariable('ID')" class="var it10943" onMouseOver="hilite(10943)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l5250"><span class="linenum">5250</span></a>              {    // Current user has a permission to delete this blog
<a name="l5251"><span class="linenum">5251</span></a>                  <a class="var it4044" onMouseOver="hilite(4044)" onMouseOut="lolite()" onClick="logVariable('deleted_Blogs')" href="../../../_variables/deleted_Blogs.html">$deleted_Blogs</a>[] = <a class="var it4045" onMouseOver="hilite(4045)" onMouseOut="lolite()" onClick="logVariable('user_Blog')" href="../../../_variables/user_Blog.html">$user_Blog</a>;
<a name="l5252"><span class="linenum">5252</span></a>              }
<a name="l5253"><span class="linenum">5253</span></a>          }
<a name="l5254"><span class="linenum">5254</span></a>  
<a name="l5255"><span class="linenum">5255</span></a>          return <a class="var it4044" onMouseOver="hilite(4044)" onMouseOut="lolite()" onClick="logVariable('deleted_Blogs')" href="../../../_variables/deleted_Blogs.html">$deleted_Blogs</a>;
<a name="l5256"><span class="linenum">5256</span></a>      }
<a name="l5257"><span class="linenum">5257</span></a>  
<a name="l5258"><span class="linenum">5258</span></a>  
<a name="l5259"><span class="linenum">5259</span></a>      <span class="comment">/**</span>
<a name="l5260"><span class="linenum">5260</span></a>  <span class="comment">     * Delete all blogs of the user recursively</span>
<a name="l5261"><span class="linenum">5261</span></a>  <span class="comment">     *</span>
<a name="l5262"><span class="linenum">5262</span></a>  <span class="comment">     * @return boolean True on success</span>
<a name="l5263"><span class="linenum">5263</span></a>  <span class="comment">     */</span>
<a name="l5264"><span class="linenum">5264</span></a>  	function <a class="function" onClick="logFunction('delete_blogs')" href="../../../_functions/delete_blogs.html" onMouseOver="funcPopup(event,'delete_blogs')">delete_blogs</a>()
<a name="l5265"><span class="linenum">5265</span></a>      {
<a name="l5266"><span class="linenum">5266</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5267"><span class="linenum">5267</span></a>  
<a name="l5268"><span class="linenum">5268</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l5269"><span class="linenum">5269</span></a>  
<a name="l5270"><span class="linenum">5270</span></a>  <span class="comment">        // Get all own blogs of this user which current user can delete</span>
<a name="l5271"><span class="linenum">5271</span></a>          <a class="var it4044" onMouseOver="hilite(4044)" onMouseOut="lolite()" onClick="logVariable('deleted_Blogs')" href="../../../_variables/deleted_Blogs.html">$deleted_Blogs</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_deleted_blogs')" href="../../../_functions/get_deleted_blogs.html" onMouseOver="funcPopup(event,'get_deleted_blogs')">get_deleted_blogs</a>();
<a name="l5272"><span class="linenum">5272</span></a>  
<a name="l5273"><span class="linenum">5273</span></a>          foreach( <a class="var it4044" onMouseOver="hilite(4044)" onMouseOut="lolite()" onClick="logVariable('deleted_Blogs')" href="../../../_variables/deleted_Blogs.html">$deleted_Blogs</a> as <a class="var it4046" onMouseOver="hilite(4046)" onMouseOut="lolite()" onClick="logVariable('deleted_Blog')" href="../../../_variables/deleted_Blog.html">$deleted_Blog</a> )
<a name="l5274"><span class="linenum">5274</span></a>          {
<a name="l5275"><span class="linenum">5275</span></a>  <span class="comment">            // Delete from DB:</span>
<a name="l5276"><span class="linenum">5276</span></a>              <a class="var it4046" onMouseOver="hilite(4046)" onMouseOut="lolite()" onClick="logVariable('deleted_Blog')" href="../../../_variables/deleted_Blog.html">$deleted_Blog</a>-&gt;<a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>();
<a name="l5277"><span class="linenum">5277</span></a>  
<a name="l5278"><span class="linenum">5278</span></a>              <a class="function" onClick="logFunction('set_working_blog')" href="../../../_functions/set_working_blog.html" onMouseOver="funcPopup(event,'set_working_blog')">set_working_blog</a>( 0 );
<a name="l5279"><span class="linenum">5279</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'selected_blog' );    <span class="comment">// Needed or subsequent pages may try to access the delete blog</span>
<a name="l5280"><span class="linenum">5280</span></a>              <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('dbupdate')" href="../../../_functions/dbupdate.html" onMouseOver="funcPopup(event,'dbupdate')">dbupdate</a>();
<a name="l5281"><span class="linenum">5281</span></a>          }
<a name="l5282"><span class="linenum">5282</span></a>  
<a name="l5283"><span class="linenum">5283</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l5284"><span class="linenum">5284</span></a>  
<a name="l5285"><span class="linenum">5285</span></a>          return true;
<a name="l5286"><span class="linenum">5286</span></a>      }
<a name="l5287"><span class="linenum">5287</span></a>  
<a name="l5288"><span class="linenum">5288</span></a>  
<a name="l5289"><span class="linenum">5289</span></a>      <span class="comment">/**</span>
<a name="l5290"><span class="linenum">5290</span></a>  <span class="comment">     * Get the posts of this user which current user can delete</span>
<a name="l5291"><span class="linenum">5291</span></a>  <span class="comment">     *</span>
<a name="l5292"><span class="linenum">5292</span></a>  <span class="comment">     * @param string Type of the deleted posts</span>
<a name="l5293"><span class="linenum">5293</span></a>  <span class="comment">     *               'created'        - the posts created by this user</span>
<a name="l5294"><span class="linenum">5294</span></a>  <span class="comment">     *               'edited'         - the posts edited by this user</span>
<a name="l5295"><span class="linenum">5295</span></a>  <span class="comment">     *               'created|edited' - the posts created OR edited by this user</span>
<a name="l5296"><span class="linenum">5296</span></a>  <span class="comment">     * @return array Items</span>
<a name="l5297"><span class="linenum">5297</span></a>  <span class="comment">     */</span>
<a name="l5298"><span class="linenum">5298</span></a>  	function <a class="function" onClick="logFunction('get_deleted_posts')" href="../../../_functions/get_deleted_posts.html" onMouseOver="funcPopup(event,'get_deleted_posts')">get_deleted_posts</a>( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>, <a class="var it4047" onMouseOver="hilite(4047)" onMouseOut="lolite()" onClick="logVariable('check_perm')" href="../../../_variables/check_perm.html">$check_perm</a> = true )
<a name="l5299"><span class="linenum">5299</span></a>      {
<a name="l5300"><span class="linenum">5300</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5301"><span class="linenum">5301</span></a>  
<a name="l5302"><span class="linenum">5302</span></a>          <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a> = &amp; get_ItemCache();
<a name="l5303"><span class="linenum">5303</span></a>          <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a>-&gt;<a onClick="logVariable('ID_array')" class="var it10695" onMouseOver="hilite(10695)" onMouseOut="lolite()" href="../../../_variables/ID_array.html">ID_array</a> = array();
<a name="l5304"><span class="linenum">5304</span></a>          switch( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> )
<a name="l5305"><span class="linenum">5305</span></a>          {
<a name="l5306"><span class="linenum">5306</span></a>              case 'created':
<a name="l5307"><span class="linenum">5307</span></a>                  <a class="var it4048" onMouseOver="hilite(4048)" onMouseOut="lolite()" onClick="logVariable('user_Items')" href="../../../_variables/user_Items.html">$user_Items</a> = <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a>-&gt;<a class="function" onClick="logFunction('load_where')" href="../../../_functions/load_where.html" onMouseOver="funcPopup(event,'load_where')">load_where</a>( 'post_creator_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5308"><span class="linenum">5308</span></a>                  break;
<a name="l5309"><span class="linenum">5309</span></a>  
<a name="l5310"><span class="linenum">5310</span></a>              case 'edited':
<a name="l5311"><span class="linenum">5311</span></a>                  <a class="var it4048" onMouseOver="hilite(4048)" onMouseOut="lolite()" onClick="logVariable('user_Items')" href="../../../_variables/user_Items.html">$user_Items</a> = <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a>-&gt;<a class="function" onClick="logFunction('load_where')" href="../../../_functions/load_where.html" onMouseOver="funcPopup(event,'load_where')">load_where</a>( 'post_lastedit_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5312"><span class="linenum">5312</span></a>                  break;
<a name="l5313"><span class="linenum">5313</span></a>  
<a name="l5314"><span class="linenum">5314</span></a>              case 'created|edited':
<a name="l5315"><span class="linenum">5315</span></a>                  <a class="var it4048" onMouseOver="hilite(4048)" onMouseOut="lolite()" onClick="logVariable('user_Items')" href="../../../_variables/user_Items.html">$user_Items</a> = <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a>-&gt;<a class="function" onClick="logFunction('load_where')" href="../../../_functions/load_where.html" onMouseOver="funcPopup(event,'load_where')">load_where</a>( 'post_lastedit_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ).' OR post_creator_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5316"><span class="linenum">5316</span></a>                  break;
<a name="l5317"><span class="linenum">5317</span></a>          }
<a name="l5318"><span class="linenum">5318</span></a>  
<a name="l5319"><span class="linenum">5319</span></a>          <a class="var it4049" onMouseOver="hilite(4049)" onMouseOut="lolite()" onClick="logVariable('deleted_Items')" href="../../../_variables/deleted_Items.html">$deleted_Items</a> = array();
<a name="l5320"><span class="linenum">5320</span></a>          foreach( <a class="var it4048" onMouseOver="hilite(4048)" onMouseOut="lolite()" onClick="logVariable('user_Items')" href="../../../_variables/user_Items.html">$user_Items</a> as <a class="var it4050" onMouseOver="hilite(4050)" onMouseOut="lolite()" onClick="logVariable('user_Item')" href="../../../_variables/user_Item.html">$user_Item</a> )
<a name="l5321"><span class="linenum">5321</span></a>          {
<a name="l5322"><span class="linenum">5322</span></a>              if( ( ! <a class="var it4047" onMouseOver="hilite(4047)" onMouseOut="lolite()" onClick="logVariable('check_perm')" href="../../../_variables/check_perm.html">$check_perm</a> ) || <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'item_post!CURSTATUS', 'delete', false, <a class="var it4050" onMouseOver="hilite(4050)" onMouseOut="lolite()" onClick="logVariable('user_Item')" href="../../../_variables/user_Item.html">$user_Item</a> ) )
<a name="l5323"><span class="linenum">5323</span></a>              {    // Current user has a permission to delete this item
<a name="l5324"><span class="linenum">5324</span></a>                  <a class="var it4049" onMouseOver="hilite(4049)" onMouseOut="lolite()" onClick="logVariable('deleted_Items')" href="../../../_variables/deleted_Items.html">$deleted_Items</a>[] = <a class="var it4050" onMouseOver="hilite(4050)" onMouseOut="lolite()" onClick="logVariable('user_Item')" href="../../../_variables/user_Item.html">$user_Item</a>;
<a name="l5325"><span class="linenum">5325</span></a>              }
<a name="l5326"><span class="linenum">5326</span></a>          }
<a name="l5327"><span class="linenum">5327</span></a>  
<a name="l5328"><span class="linenum">5328</span></a>          return <a class="var it4049" onMouseOver="hilite(4049)" onMouseOut="lolite()" onClick="logVariable('deleted_Items')" href="../../../_variables/deleted_Items.html">$deleted_Items</a>;
<a name="l5329"><span class="linenum">5329</span></a>      }
<a name="l5330"><span class="linenum">5330</span></a>  
<a name="l5331"><span class="linenum">5331</span></a>  
<a name="l5332"><span class="linenum">5332</span></a>      <span class="comment">/**</span>
<a name="l5333"><span class="linenum">5333</span></a>  <span class="comment">     * Delete posts of the user</span>
<a name="l5334"><span class="linenum">5334</span></a>  <span class="comment">     *</span>
<a name="l5335"><span class="linenum">5335</span></a>  <span class="comment">     * @param string Type of the deleted posts</span>
<a name="l5336"><span class="linenum">5336</span></a>  <span class="comment">     *               'created'        - the posts created by this user</span>
<a name="l5337"><span class="linenum">5337</span></a>  <span class="comment">     *               'edited'         - the posts edited by this user</span>
<a name="l5338"><span class="linenum">5338</span></a>  <span class="comment">     *               'created|edited' - the posts created OR edited by this user</span>
<a name="l5339"><span class="linenum">5339</span></a>  <span class="comment">     * @return boolean True on success</span>
<a name="l5340"><span class="linenum">5340</span></a>  <span class="comment">     */</span>
<a name="l5341"><span class="linenum">5341</span></a>  	function <a class="function" onClick="logFunction('delete_posts')" href="../../../_functions/delete_posts.html" onMouseOver="funcPopup(event,'delete_posts')">delete_posts</a>( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> )
<a name="l5342"><span class="linenum">5342</span></a>      {
<a name="l5343"><span class="linenum">5343</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5344"><span class="linenum">5344</span></a>  
<a name="l5345"><span class="linenum">5345</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l5346"><span class="linenum">5346</span></a>  
<a name="l5347"><span class="linenum">5347</span></a>  <span class="comment">        // Get the posts of this user which current user can delete.</span>
<a name="l5348"><span class="linenum">5348</span></a>  <span class="comment">        // Note: If current user can moderate this user then it is allowed to delete all user data even if it wouldn't be allowed otherwise.</span>
<a name="l5349"><span class="linenum">5349</span></a>          <a class="var it4047" onMouseOver="hilite(4047)" onMouseOut="lolite()" onClick="logVariable('check_perm')" href="../../../_variables/check_perm.html">$check_perm</a> = ( ( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a> != 'created' ) || ( ! <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) ) );
<a name="l5350"><span class="linenum">5350</span></a>          <a class="var it4049" onMouseOver="hilite(4049)" onMouseOut="lolite()" onClick="logVariable('deleted_Items')" href="../../../_variables/deleted_Items.html">$deleted_Items</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_deleted_posts')" href="../../../_functions/get_deleted_posts.html" onMouseOver="funcPopup(event,'get_deleted_posts')">get_deleted_posts</a>( <a class="var it558" onMouseOver="hilite(558)" onMouseOut="lolite()" onClick="logVariable('type')" href="../../../_variables/type.html">$type</a>, <a class="var it4047" onMouseOver="hilite(4047)" onMouseOut="lolite()" onClick="logVariable('check_perm')" href="../../../_variables/check_perm.html">$check_perm</a> );
<a name="l5351"><span class="linenum">5351</span></a>  
<a name="l5352"><span class="linenum">5352</span></a>          foreach( <a class="var it4049" onMouseOver="hilite(4049)" onMouseOut="lolite()" onClick="logVariable('deleted_Items')" href="../../../_variables/deleted_Items.html">$deleted_Items</a> as <a class="var it4051" onMouseOver="hilite(4051)" onMouseOut="lolite()" onClick="logVariable('deleted_Item')" href="../../../_variables/deleted_Item.html">$deleted_Item</a> )
<a name="l5353"><span class="linenum">5353</span></a>          {
<a name="l5354"><span class="linenum">5354</span></a>              <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>-&gt;<a class="function" onClick="logFunction('trigger_event')" href="../../../_functions/trigger_event.html" onMouseOver="funcPopup(event,'trigger_event')">trigger_event</a>( 'AdminBeforeItemEditDelete', array( 'Item' =&gt; &amp; <a class="var it4051" onMouseOver="hilite(4051)" onMouseOut="lolite()" onClick="logVariable('deleted_Item')" href="../../../_variables/deleted_Item.html">$deleted_Item</a> ) );
<a name="l5355"><span class="linenum">5355</span></a>  
<a name="l5356"><span class="linenum">5356</span></a>  <span class="comment">            // Delete from DB:</span>
<a name="l5357"><span class="linenum">5357</span></a>              <a class="var it4051" onMouseOver="hilite(4051)" onMouseOut="lolite()" onClick="logVariable('deleted_Item')" href="../../../_variables/deleted_Item.html">$deleted_Item</a>-&gt;<a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>();
<a name="l5358"><span class="linenum">5358</span></a>          }
<a name="l5359"><span class="linenum">5359</span></a>  
<a name="l5360"><span class="linenum">5360</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l5361"><span class="linenum">5361</span></a>  
<a name="l5362"><span class="linenum">5362</span></a>          return true;
<a name="l5363"><span class="linenum">5363</span></a>      }
<a name="l5364"><span class="linenum">5364</span></a>  
<a name="l5365"><span class="linenum">5365</span></a>  
<a name="l5366"><span class="linenum">5366</span></a>      <span class="comment">/**</span>
<a name="l5367"><span class="linenum">5367</span></a>  <span class="comment">     * Get the comments IDs that were created by this user</span>
<a name="l5368"><span class="linenum">5368</span></a>  <span class="comment">     *</span>
<a name="l5369"><span class="linenum">5369</span></a>  <span class="comment">     * @return array IDs of the own comments</span>
<a name="l5370"><span class="linenum">5370</span></a>  <span class="comment">     */</span>
<a name="l5371"><span class="linenum">5371</span></a>  	function <a class="function" onClick="logFunction('get_own_comments_IDs')" href="../../../_functions/get_own_comments_ids.html" onMouseOver="funcPopup(event,'get_own_comments_ids')">get_own_comments_IDs</a>()
<a name="l5372"><span class="linenum">5372</span></a>      {
<a name="l5373"><span class="linenum">5373</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l5374"><span class="linenum">5374</span></a>  
<a name="l5375"><span class="linenum">5375</span></a>  <span class="comment">        // Get the comments of the user</span>
<a name="l5376"><span class="linenum">5376</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l5377"><span class="linenum">5377</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'comment_ID' );
<a name="l5378"><span class="linenum">5378</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_comments' );
<a name="l5379"><span class="linenum">5379</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'comment_author_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5380"><span class="linenum">5380</span></a>  
<a name="l5381"><span class="linenum">5381</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l5382"><span class="linenum">5382</span></a>      }
<a name="l5383"><span class="linenum">5383</span></a>  
<a name="l5384"><span class="linenum">5384</span></a>  
<a name="l5385"><span class="linenum">5385</span></a>      <span class="comment">/**</span>
<a name="l5386"><span class="linenum">5386</span></a>  <span class="comment">     * Check if current has at least one own comment to delete</span>
<a name="l5387"><span class="linenum">5387</span></a>  <span class="comment">     *</span>
<a name="l5388"><span class="linenum">5388</span></a>  <span class="comment">     * @return array Comments IDs</span>
<a name="l5389"><span class="linenum">5389</span></a>  <span class="comment">     */</span>
<a name="l5390"><span class="linenum">5390</span></a>  	function <a class="function" onClick="logFunction('has_comment_to_delete')" href="../../../_functions/has_comment_to_delete.html" onMouseOver="funcPopup(event,'has_comment_to_delete')">has_comment_to_delete</a>()
<a name="l5391"><span class="linenum">5391</span></a>      {
<a name="l5392"><span class="linenum">5392</span></a>          global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5393"><span class="linenum">5393</span></a>  
<a name="l5394"><span class="linenum">5394</span></a>          <a class="var it4052" onMouseOver="hilite(4052)" onMouseOut="lolite()" onClick="logVariable('comments_IDs')" href="../../../_variables/comments_IDs.html">$comments_IDs</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_own_comments_IDs')" href="../../../_functions/get_own_comments_ids.html" onMouseOver="funcPopup(event,'get_own_comments_ids')">get_own_comments_IDs</a>();
<a name="l5395"><span class="linenum">5395</span></a>  
<a name="l5396"><span class="linenum">5396</span></a>          if( ! <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4052" onMouseOver="hilite(4052)" onMouseOut="lolite()" onClick="logVariable('comments_IDs')" href="../../../_variables/comments_IDs.html">$comments_IDs</a> ) )
<a name="l5397"><span class="linenum">5397</span></a>          { // User has no comments
<a name="l5398"><span class="linenum">5398</span></a>              return false;
<a name="l5399"><span class="linenum">5399</span></a>          }
<a name="l5400"><span class="linenum">5400</span></a>  
<a name="l5401"><span class="linenum">5401</span></a>          if( <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l5402"><span class="linenum">5402</span></a>          { // If current user can moderate this user then it is allowed to delete all user data even if it wouldn't be allowed otherwise.
<a name="l5403"><span class="linenum">5403</span></a>              return true;
<a name="l5404"><span class="linenum">5404</span></a>          }
<a name="l5405"><span class="linenum">5405</span></a>  
<a name="l5406"><span class="linenum">5406</span></a>          <a class="var it1134" onMouseOver="hilite(1134)" onMouseOut="lolite()" onClick="logVariable('CommentCache')" href="../../../_variables/CommentCache.html">$CommentCache</a> = &amp; get_CommentCache();
<a name="l5407"><span class="linenum">5407</span></a>  
<a name="l5408"><span class="linenum">5408</span></a>          foreach( <a class="var it4052" onMouseOver="hilite(4052)" onMouseOut="lolite()" onClick="logVariable('comments_IDs')" href="../../../_variables/comments_IDs.html">$comments_IDs</a> as <a class="var it1119" onMouseOver="hilite(1119)" onMouseOut="lolite()" onClick="logVariable('comment_ID')" href="../../../_variables/comment_ID.html">$comment_ID</a> )
<a name="l5409"><span class="linenum">5409</span></a>          {
<a name="l5410"><span class="linenum">5410</span></a>              if( ( <a class="var it4053" onMouseOver="hilite(4053)" onMouseOut="lolite()" onClick="logVariable('user_Comment')" href="../../../_variables/user_Comment.html">$user_Comment</a> = &amp; <a class="var it1134" onMouseOver="hilite(1134)" onMouseOut="lolite()" onClick="logVariable('CommentCache')" href="../../../_variables/CommentCache.html">$CommentCache</a>-&gt;get_by_ID( <a class="var it1119" onMouseOver="hilite(1119)" onMouseOut="lolite()" onClick="logVariable('comment_ID')" href="../../../_variables/comment_ID.html">$comment_ID</a>, false, false ) ) &amp;&amp;
<a name="l5411"><span class="linenum">5411</span></a>                    <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'comment!CURSTATUS', 'delete', false, <a class="var it4053" onMouseOver="hilite(4053)" onMouseOut="lolite()" onClick="logVariable('user_Comment')" href="../../../_variables/user_Comment.html">$user_Comment</a> ) )
<a name="l5412"><span class="linenum">5412</span></a>              { // Current user has a permission to delete this comment
<a name="l5413"><span class="linenum">5413</span></a>                  return true;
<a name="l5414"><span class="linenum">5414</span></a>              }
<a name="l5415"><span class="linenum">5415</span></a>  <span class="comment">            // Clear a cache to avoid a memory allocation error</span>
<a name="l5416"><span class="linenum">5416</span></a>              <a class="var it1134" onMouseOver="hilite(1134)" onMouseOut="lolite()" onClick="logVariable('CommentCache')" href="../../../_variables/CommentCache.html">$CommentCache</a>-&gt;<a class="function" onClick="logFunction('clear')" href="../../../_functions/clear.html" onMouseOver="funcPopup(event,'clear')">clear</a>();
<a name="l5417"><span class="linenum">5417</span></a>          }
<a name="l5418"><span class="linenum">5418</span></a>  
<a name="l5419"><span class="linenum">5419</span></a>          return false;
<a name="l5420"><span class="linenum">5420</span></a>      }
<a name="l5421"><span class="linenum">5421</span></a>  
<a name="l5422"><span class="linenum">5422</span></a>  
<a name="l5423"><span class="linenum">5423</span></a>      <span class="comment">/**</span>
<a name="l5424"><span class="linenum">5424</span></a>  <span class="comment">     * Delete comments of the user</span>
<a name="l5425"><span class="linenum">5425</span></a>  <span class="comment">     *</span>
<a name="l5426"><span class="linenum">5426</span></a>  <span class="comment">     * @return boolean True on success</span>
<a name="l5427"><span class="linenum">5427</span></a>  <span class="comment">     */</span>
<a name="l5428"><span class="linenum">5428</span></a>  	function <a class="function" onClick="logFunction('delete_comments')" href="../../../_functions/delete_comments.html" onMouseOver="funcPopup(event,'delete_comments')">delete_comments</a>()
<a name="l5429"><span class="linenum">5429</span></a>      {
<a name="l5430"><span class="linenum">5430</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5431"><span class="linenum">5431</span></a>  
<a name="l5432"><span class="linenum">5432</span></a>  <span class="comment">        // If user has a huge amount of the comments it will takes many time to delete all comments</span>
<a name="l5433"><span class="linenum">5433</span></a>          <a class="function" onClick="logFunction('set_max_execution_time')" href="../../../_functions/set_max_execution_time.html" onMouseOver="funcPopup(event,'set_max_execution_time')">set_max_execution_time</a>( 900 );
<a name="l5434"><span class="linenum">5434</span></a>  
<a name="l5435"><span class="linenum">5435</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l5436"><span class="linenum">5436</span></a>  
<a name="l5437"><span class="linenum">5437</span></a>  <span class="comment">        // Get the comments of this user which current user can delete</span>
<a name="l5438"><span class="linenum">5438</span></a>          <a class="var it4052" onMouseOver="hilite(4052)" onMouseOut="lolite()" onClick="logVariable('comments_IDs')" href="../../../_variables/comments_IDs.html">$comments_IDs</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_own_comments_IDs')" href="../../../_functions/get_own_comments_ids.html" onMouseOver="funcPopup(event,'get_own_comments_ids')">get_own_comments_IDs</a>();
<a name="l5439"><span class="linenum">5439</span></a>  
<a name="l5440"><span class="linenum">5440</span></a>          if( ! <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4052" onMouseOver="hilite(4052)" onMouseOut="lolite()" onClick="logVariable('comments_IDs')" href="../../../_variables/comments_IDs.html">$comments_IDs</a> ) )
<a name="l5441"><span class="linenum">5441</span></a>          { // User has no comments
<a name="l5442"><span class="linenum">5442</span></a>              return false;
<a name="l5443"><span class="linenum">5443</span></a>          }
<a name="l5444"><span class="linenum">5444</span></a>  
<a name="l5445"><span class="linenum">5445</span></a>          <a class="var it1134" onMouseOver="hilite(1134)" onMouseOut="lolite()" onClick="logVariable('CommentCache')" href="../../../_variables/CommentCache.html">$CommentCache</a> = &amp; get_CommentCache();
<a name="l5446"><span class="linenum">5446</span></a>          <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a> = &amp; get_ItemCache();
<a name="l5447"><span class="linenum">5447</span></a>  
<a name="l5448"><span class="linenum">5448</span></a>  <span class="comment">        // If current user can moderate this user then it is allowed to delete all user data even if it wouldn't be allowed otherwise.</span>
<a name="l5449"><span class="linenum">5449</span></a>          <a class="var it4054" onMouseOver="hilite(4054)" onMouseOut="lolite()" onClick="logVariable('current_user_can_moderate')" href="../../../_variables/current_user_can_moderate.html">$current_user_can_moderate</a> = <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5450"><span class="linenum">5450</span></a>  
<a name="l5451"><span class="linenum">5451</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = false;
<a name="l5452"><span class="linenum">5452</span></a>          foreach( <a class="var it4052" onMouseOver="hilite(4052)" onMouseOut="lolite()" onClick="logVariable('comments_IDs')" href="../../../_variables/comments_IDs.html">$comments_IDs</a> as <a class="var it1119" onMouseOver="hilite(1119)" onMouseOut="lolite()" onClick="logVariable('comment_ID')" href="../../../_variables/comment_ID.html">$comment_ID</a> )
<a name="l5453"><span class="linenum">5453</span></a>          {
<a name="l5454"><span class="linenum">5454</span></a>              <a class="var it4055" onMouseOver="hilite(4055)" onMouseOut="lolite()" onClick="logVariable('deleted_Comment')" href="../../../_variables/deleted_Comment.html">$deleted_Comment</a> = &amp; <a class="var it1134" onMouseOver="hilite(1134)" onMouseOut="lolite()" onClick="logVariable('CommentCache')" href="../../../_variables/CommentCache.html">$CommentCache</a>-&gt;get_by_ID( <a class="var it1119" onMouseOver="hilite(1119)" onMouseOut="lolite()" onClick="logVariable('comment_ID')" href="../../../_variables/comment_ID.html">$comment_ID</a>, false, false );
<a name="l5455"><span class="linenum">5455</span></a>              if( <a class="var it4055" onMouseOver="hilite(4055)" onMouseOut="lolite()" onClick="logVariable('deleted_Comment')" href="../../../_variables/deleted_Comment.html">$deleted_Comment</a> &amp;&amp;
<a name="l5456"><span class="linenum">5456</span></a>                  ( <a class="var it4054" onMouseOver="hilite(4054)" onMouseOut="lolite()" onClick="logVariable('current_user_can_moderate')" href="../../../_variables/current_user_can_moderate.html">$current_user_can_moderate</a> ||
<a name="l5457"><span class="linenum">5457</span></a>                    <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'comment!CURSTATUS', 'delete', false, <a class="var it4055" onMouseOver="hilite(4055)" onMouseOut="lolite()" onClick="logVariable('deleted_Comment')" href="../../../_variables/deleted_Comment.html">$deleted_Comment</a> ) ) )
<a name="l5458"><span class="linenum">5458</span></a>              { // Current user has a permission to delete this comment
<a name="l5459"><span class="linenum">5459</span></a>  <span class="comment">                // Delete from DB</span>
<a name="l5460"><span class="linenum">5460</span></a>                  <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it4055" onMouseOver="hilite(4055)" onMouseOut="lolite()" onClick="logVariable('deleted_Comment')" href="../../../_variables/deleted_Comment.html">$deleted_Comment</a>-&gt;<a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>( true, false );
<a name="l5461"><span class="linenum">5461</span></a>                  if( ! <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> )
<a name="l5462"><span class="linenum">5462</span></a>                  {
<a name="l5463"><span class="linenum">5463</span></a>                      break;
<a name="l5464"><span class="linenum">5464</span></a>                  }
<a name="l5465"><span class="linenum">5465</span></a>              }
<a name="l5466"><span class="linenum">5466</span></a>  <span class="comment">            // Clear a cache to avoid a memory allocation error</span>
<a name="l5467"><span class="linenum">5467</span></a>              <a class="var it1134" onMouseOver="hilite(1134)" onMouseOut="lolite()" onClick="logVariable('CommentCache')" href="../../../_variables/CommentCache.html">$CommentCache</a>-&gt;<a class="function" onClick="logFunction('clear')" href="../../../_functions/clear.html" onMouseOver="funcPopup(event,'clear')">clear</a>();
<a name="l5468"><span class="linenum">5468</span></a>              <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a>-&gt;<a class="function" onClick="logFunction('clear')" href="../../../_functions/clear.html" onMouseOver="funcPopup(event,'clear')">clear</a>();
<a name="l5469"><span class="linenum">5469</span></a>          }
<a name="l5470"><span class="linenum">5470</span></a>  
<a name="l5471"><span class="linenum">5471</span></a>          if( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> )
<a name="l5472"><span class="linenum">5472</span></a>          {
<a name="l5473"><span class="linenum">5473</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l5474"><span class="linenum">5474</span></a>          }
<a name="l5475"><span class="linenum">5475</span></a>          else
<a name="l5476"><span class="linenum">5476</span></a>          {
<a name="l5477"><span class="linenum">5477</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l5478"><span class="linenum">5478</span></a>          }
<a name="l5479"><span class="linenum">5479</span></a>  
<a name="l5480"><span class="linenum">5480</span></a>          return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l5481"><span class="linenum">5481</span></a>      }
<a name="l5482"><span class="linenum">5482</span></a>  
<a name="l5483"><span class="linenum">5483</span></a>  
<a name="l5484"><span class="linenum">5484</span></a>      <span class="comment">/**</span>
<a name="l5485"><span class="linenum">5485</span></a>  <span class="comment">     * Delete private messaged of the user</span>
<a name="l5486"><span class="linenum">5486</span></a>  <span class="comment">     *</span>
<a name="l5487"><span class="linenum">5487</span></a>  <span class="comment">     * @return boolean True on success</span>
<a name="l5488"><span class="linenum">5488</span></a>  <span class="comment">     */</span>
<a name="l5489"><span class="linenum">5489</span></a>  	function <a class="function" onClick="logFunction('delete_messages')" href="../../../_functions/delete_messages.html" onMouseOver="funcPopup(event,'delete_messages')">delete_messages</a>()
<a name="l5490"><span class="linenum">5490</span></a>      {
<a name="l5491"><span class="linenum">5491</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it319" onMouseOver="hilite(319)" onMouseOut="lolite()" onClick="logVariable('Plugins')" href="../../../_variables/Plugins.html">$Plugins</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5492"><span class="linenum">5492</span></a>  
<a name="l5493"><span class="linenum">5493</span></a>  <span class="comment">        // Check permissions</span>
<a name="l5494"><span class="linenum">5494</span></a>  <span class="comment">        // Note: If current user can moderate this user then it is allowed to delete all user data even if it wouldn't be allowed otherwise</span>
<a name="l5495"><span class="linenum">5495</span></a>          if( ! <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l5496"><span class="linenum">5496</span></a>          { // Note: if users have delete messaging perms then they can delete any user <a class="function" onClick="logFunction('messages')" href="../../../_functions/messages.html" onMouseOver="funcPopup(event,'messages')">messages</a> ( Of course only if the delete action is available/displayed for them )
<a name="l5497"><span class="linenum">5497</span></a>              <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'perm_messaging', 'delete', true );
<a name="l5498"><span class="linenum">5498</span></a>          }
<a name="l5499"><span class="linenum">5499</span></a>  
<a name="l5500"><span class="linenum">5500</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l5501"><span class="linenum">5501</span></a>  
<a name="l5502"><span class="linenum">5502</span></a>          <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('MessageCache')" href="../../../_variables/MessageCache.html">$MessageCache</a> = &amp; get_MessageCache();
<a name="l5503"><span class="linenum">5503</span></a>          <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('MessageCache')" href="../../../_variables/MessageCache.html">$MessageCache</a>-&gt;<a class="function" onClick="logFunction('clear')" href="../../../_functions/clear.html" onMouseOver="funcPopup(event,'clear')">clear</a>();
<a name="l5504"><span class="linenum">5504</span></a>          <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('MessageCache')" href="../../../_variables/MessageCache.html">$MessageCache</a>-&gt;<a class="function" onClick="logFunction('load_where')" href="../../../_functions/load_where.html" onMouseOver="funcPopup(event,'load_where')">load_where</a>( 'msg_author_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5505"><span class="linenum">5505</span></a>          <a class="var it4056" onMouseOver="hilite(4056)" onMouseOut="lolite()" onClick="logVariable('message_was_deleted')" href="../../../_variables/message_was_deleted.html">$message_was_deleted</a> = false;
<a name="l5506"><span class="linenum">5506</span></a>  
<a name="l5507"><span class="linenum">5507</span></a>          while( ( <a class="var it4057" onMouseOver="hilite(4057)" onMouseOut="lolite()" onClick="logVariable('iterator_Message')" href="../../../_variables/iterator_Message.html">$iterator_Message</a> = &amp; <a class="var it1070" onMouseOver="hilite(1070)" onMouseOut="lolite()" onClick="logVariable('MessageCache')" href="../../../_variables/MessageCache.html">$MessageCache</a>-&gt;get_next() ) != NULL )
<a name="l5508"><span class="linenum">5508</span></a>          { // Iterate through MessageCache
<a name="l5509"><span class="linenum">5509</span></a>  <span class="comment">            // Delete a message from DB:</span>
<a name="l5510"><span class="linenum">5510</span></a>              <a class="var it4057" onMouseOver="hilite(4057)" onMouseOut="lolite()" onClick="logVariable('iterator_Message')" href="../../../_variables/iterator_Message.html">$iterator_Message</a>-&gt;<a class="function" onClick="logFunction('dbdelete')" href="../../../_functions/dbdelete.html" onMouseOver="funcPopup(event,'dbdelete')">dbdelete</a>();
<a name="l5511"><span class="linenum">5511</span></a>              <a class="var it4056" onMouseOver="hilite(4056)" onMouseOut="lolite()" onClick="logVariable('message_was_deleted')" href="../../../_variables/message_was_deleted.html">$message_was_deleted</a> = true;
<a name="l5512"><span class="linenum">5512</span></a>          }
<a name="l5513"><span class="linenum">5513</span></a>  
<a name="l5514"><span class="linenum">5514</span></a>          if( <a class="var it4056" onMouseOver="hilite(4056)" onMouseOut="lolite()" onClick="logVariable('message_was_deleted')" href="../../../_variables/message_was_deleted.html">$message_was_deleted</a> )
<a name="l5515"><span class="linenum">5515</span></a>          { // at least one message was deleted
<a name="l5516"><span class="linenum">5516</span></a>  <span class="comment">            // Delete statuses</span>
<a name="l5517"><span class="linenum">5517</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_messaging__threadstatus
<a name="l5518"><span class="linenum">5518</span></a>                              WHERE tsta_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5519"><span class="linenum">5519</span></a>          }
<a name="l5520"><span class="linenum">5520</span></a>  
<a name="l5521"><span class="linenum">5521</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l5522"><span class="linenum">5522</span></a>  
<a name="l5523"><span class="linenum">5523</span></a>          return true;
<a name="l5524"><span class="linenum">5524</span></a>      }
<a name="l5525"><span class="linenum">5525</span></a>  
<a name="l5526"><span class="linenum">5526</span></a>  
<a name="l5527"><span class="linenum">5527</span></a>      <span class="comment">/**</span>
<a name="l5528"><span class="linenum">5528</span></a>  <span class="comment">     * Get number of posts and percent of published posts by this user</span>
<a name="l5529"><span class="linenum">5529</span></a>  <span class="comment">     *</span>
<a name="l5530"><span class="linenum">5530</span></a>  <span class="comment">     * @param array Params</span>
<a name="l5531"><span class="linenum">5531</span></a>  <span class="comment">     * @return string Result</span>
<a name="l5532"><span class="linenum">5532</span></a>  <span class="comment">     */</span>
<a name="l5533"><span class="linenum">5533</span></a>  	function <a class="function" onClick="logFunction('get_reputation_posts')" href="../../../_functions/get_reputation_posts.html" onMouseOver="funcPopup(event,'get_reputation_posts')">get_reputation_posts</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l5534"><span class="linenum">5534</span></a>      {
<a name="l5535"><span class="linenum">5535</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l5536"><span class="linenum">5536</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l5537"><span class="linenum">5537</span></a>                  'text' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s (%s%% are public)' ),
<a name="l5538"><span class="linenum">5538</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l5539"><span class="linenum">5539</span></a>  
<a name="l5540"><span class="linenum">5540</span></a>          <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_posts')" href="../../../_functions/get_num_posts.html" onMouseOver="funcPopup(event,'get_num_posts')">get_num_posts</a>();
<a name="l5541"><span class="linenum">5541</span></a>          <a class="var it4058" onMouseOver="hilite(4058)" onMouseOut="lolite()" onClick="logVariable('public_num_posts')" href="../../../_variables/public_num_posts.html">$public_num_posts</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_posts')" href="../../../_functions/get_num_posts.html" onMouseOver="funcPopup(event,'get_num_posts')">get_num_posts</a>( 'published' );
<a name="l5542"><span class="linenum">5542</span></a>          if( <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> &gt; 0 )
<a name="l5543"><span class="linenum">5543</span></a>          { // Calc percent of published posts
<a name="l5544"><span class="linenum">5544</span></a>              <a class="var it4059" onMouseOver="hilite(4059)" onMouseOut="lolite()" onClick="logVariable('public_percent')" href="../../../_variables/public_percent.html">$public_percent</a> = <a class="phpfunction" onClick="logFunction('floor')" href="../../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>( <a class="var it4058" onMouseOver="hilite(4058)" onMouseOut="lolite()" onClick="logVariable('public_num_posts')" href="../../../_variables/public_num_posts.html">$public_num_posts</a> / <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> * 100 );
<a name="l5545"><span class="linenum">5545</span></a>          }
<a name="l5546"><span class="linenum">5546</span></a>          else
<a name="l5547"><span class="linenum">5547</span></a>          { // To avoid devision by zero
<a name="l5548"><span class="linenum">5548</span></a>              <a class="var it4059" onMouseOver="hilite(4059)" onMouseOut="lolite()" onClick="logVariable('public_percent')" href="../../../_variables/public_percent.html">$public_percent</a> = 0;
<a name="l5549"><span class="linenum">5549</span></a>          }
<a name="l5550"><span class="linenum">5550</span></a>  
<a name="l5551"><span class="linenum">5551</span></a>          if( <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> &gt; 0 )
<a name="l5552"><span class="linenum">5552</span></a>          {    // Make a link to page with user's posts:
<a name="l5553"><span class="linenum">5553</span></a>              global <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l5554"><span class="linenum">5554</span></a>              if( <a class="function" onClick="logFunction('is_admin_page')" href="../../../_functions/is_admin_page.html" onMouseOver="funcPopup(event,'is_admin_page')">is_admin_page</a>() &amp;&amp; <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() &amp;&amp;
<a name="l5555"><span class="linenum">5555</span></a>                  ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a onClick="logVariable('ID')" class="var it10675" onMouseOver="hilite(10675)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> || <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'view' ) ) )
<a name="l5556"><span class="linenum">5556</span></a>              {    // For back-office
<a name="l5557"><span class="linenum">5557</span></a>                  global <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>;
<a name="l5558"><span class="linenum">5558</span></a>                  <a class="var it4060" onMouseOver="hilite(4060)" onMouseOut="lolite()" onClick="logVariable('total_num_posts_url')" href="../../../_variables/total_num_posts_url.html">$total_num_posts_url</a> = <a class="var it136" onMouseOver="hilite(136)" onMouseOut="lolite()" onClick="logVariable('admin_url')" href="../../../_variables/admin_url.html">$admin_url</a>.'?ctrl=user&amp;amp;user_tab=activity&amp;amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l5559"><span class="linenum">5559</span></a>              }
<a name="l5560"><span class="linenum">5560</span></a>              else
<a name="l5561"><span class="linenum">5561</span></a>              {    // For front-office
<a name="l5562"><span class="linenum">5562</span></a>                  global <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>;
<a name="l5563"><span class="linenum">5563</span></a>                  if( ! empty( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a> ) )
<a name="l5564"><span class="linenum">5564</span></a>                  {    // Only if blog is defined
<a name="l5565"><span class="linenum">5565</span></a>                      <a class="var it4060" onMouseOver="hilite(4060)" onMouseOut="lolite()" onClick="logVariable('total_num_posts_url')" href="../../../_variables/total_num_posts_url.html">$total_num_posts_url</a> = <a class="function" onClick="logFunction('url_add_param')" href="../../../_functions/url_add_param.html" onMouseOver="funcPopup(event,'url_add_param')">url_add_param</a>( <a class="var it46" onMouseOver="hilite(46)" onMouseOut="lolite()" onClick="logVariable('Blog')" href="../../../_variables/Blog.html">$Blog</a>-&gt;<a class="function" onClick="logFunction('gen_blogurl')" href="../../../_functions/gen_blogurl.html" onMouseOver="funcPopup(event,'gen_blogurl')">gen_blogurl</a>(), 'disp=useritems&amp;amp;user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5566"><span class="linenum">5566</span></a>                  }
<a name="l5567"><span class="linenum">5567</span></a>              }
<a name="l5568"><span class="linenum">5568</span></a>          }
<a name="l5569"><span class="linenum">5569</span></a>  
<a name="l5570"><span class="linenum">5570</span></a>          if( empty( <a class="var it4060" onMouseOver="hilite(4060)" onMouseOut="lolite()" onClick="logVariable('total_num_posts_url')" href="../../../_variables/total_num_posts_url.html">$total_num_posts_url</a> ) )
<a name="l5571"><span class="linenum">5571</span></a>          {    // No link to view posts
<a name="l5572"><span class="linenum">5572</span></a>              <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> = '&lt;b&gt;'.<a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a>.'&lt;/b&gt;';
<a name="l5573"><span class="linenum">5573</span></a>          }
<a name="l5574"><span class="linenum">5574</span></a>          else
<a name="l5575"><span class="linenum">5575</span></a>          {    // Set a posts number as link if it is allowed:
<a name="l5576"><span class="linenum">5576</span></a>              <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a> = '&lt;a href=&quot;'.<a class="var it4060" onMouseOver="hilite(4060)" onMouseOut="lolite()" onClick="logVariable('total_num_posts_url')" href="../../../_variables/total_num_posts_url.html">$total_num_posts_url</a>.'&quot;&gt;&lt;b&gt;'.<a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a>.'&lt;/b&gt;&lt;/a&gt;';
<a name="l5577"><span class="linenum">5577</span></a>          }
<a name="l5578"><span class="linenum">5578</span></a>  
<a name="l5579"><span class="linenum">5579</span></a>          return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'], <a class="var it3938" onMouseOver="hilite(3938)" onMouseOut="lolite()" onClick="logVariable('total_num_posts')" href="../../../_variables/total_num_posts.html">$total_num_posts</a>, <a class="var it4059" onMouseOver="hilite(4059)" onMouseOut="lolite()" onClick="logVariable('public_percent')" href="../../../_variables/public_percent.html">$public_percent</a> );
<a name="l5580"><span class="linenum">5580</span></a>      }
<a name="l5581"><span class="linenum">5581</span></a>  
<a name="l5582"><span class="linenum">5582</span></a>  
<a name="l5583"><span class="linenum">5583</span></a>      <span class="comment">/**</span>
<a name="l5584"><span class="linenum">5584</span></a>  <span class="comment">     * Get number of comments and percent of published comments and number of helpful votes on comments by this user</span>
<a name="l5585"><span class="linenum">5585</span></a>  <span class="comment">     *</span>
<a name="l5586"><span class="linenum">5586</span></a>  <span class="comment">     * @param array Params</span>
<a name="l5587"><span class="linenum">5587</span></a>  <span class="comment">     * @return string Result</span>
<a name="l5588"><span class="linenum">5588</span></a>  <span class="comment">     */</span>
<a name="l5589"><span class="linenum">5589</span></a>  	function <a class="function" onClick="logFunction('get_reputation_comments')" href="../../../_functions/get_reputation_comments.html" onMouseOver="funcPopup(event,'get_reputation_comments')">get_reputation_comments</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l5590"><span class="linenum">5590</span></a>      {
<a name="l5591"><span class="linenum">5591</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l5592"><span class="linenum">5592</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l5593"><span class="linenum">5593</span></a>                  'view_type'     =&gt; 'simple', // 'simple', 'extended'
<a name="l5594"><span class="linenum">5594</span></a>                  'text_simple'   =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s has posted %s comments (%s%% of which are public). %s of these comments have been found useful by %s different users.' ),
<a name="l5595"><span class="linenum">5595</span></a>                  'text_extended' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s has posted %s comments (%s%% of which are public).&lt;br /&gt;%s voted useful by %s different users.&lt;br /&gt;%s voted NOT useful by %s different users.&lt;br /&gt;%s considered OK by %s different users.&lt;br /&gt;%s considered SPAM by %s different users.' ),
<a name="l5596"><span class="linenum">5596</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l5597"><span class="linenum">5597</span></a>  
<a name="l5598"><span class="linenum">5598</span></a>          <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_comments')" href="../../../_functions/get_num_comments.html" onMouseOver="funcPopup(event,'get_num_comments')">get_num_comments</a>();
<a name="l5599"><span class="linenum">5599</span></a>          <a class="var it4061" onMouseOver="hilite(4061)" onMouseOut="lolite()" onClick="logVariable('public_num_comments')" href="../../../_variables/public_num_comments.html">$public_num_comments</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_comments')" href="../../../_functions/get_num_comments.html" onMouseOver="funcPopup(event,'get_num_comments')">get_num_comments</a>( 'published' );
<a name="l5600"><span class="linenum">5600</span></a>          if( <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> &gt; 0 )
<a name="l5601"><span class="linenum">5601</span></a>          { // Calc percent of published comments
<a name="l5602"><span class="linenum">5602</span></a>              <a class="var it4059" onMouseOver="hilite(4059)" onMouseOut="lolite()" onClick="logVariable('public_percent')" href="../../../_variables/public_percent.html">$public_percent</a> = <a class="phpfunction" onClick="logFunction('floor')" href="../../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>( <a class="var it4061" onMouseOver="hilite(4061)" onMouseOut="lolite()" onClick="logVariable('public_num_comments')" href="../../../_variables/public_num_comments.html">$public_num_comments</a> / <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> * 100 );
<a name="l5603"><span class="linenum">5603</span></a>          }
<a name="l5604"><span class="linenum">5604</span></a>          else
<a name="l5605"><span class="linenum">5605</span></a>          { // To avoid devision by zero
<a name="l5606"><span class="linenum">5606</span></a>              <a class="var it4059" onMouseOver="hilite(4059)" onMouseOut="lolite()" onClick="logVariable('public_percent')" href="../../../_variables/public_percent.html">$public_percent</a> = 0;
<a name="l5607"><span class="linenum">5607</span></a>          }
<a name="l5608"><span class="linenum">5608</span></a>  
<a name="l5609"><span class="linenum">5609</span></a>          if( <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> &gt; 0 )
<a name="l5610"><span class="linenum">5610</span></a>          { // Make a link to page with user's comments
<a name="l5611"><span class="linenum">5611</span></a>              <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> = '&lt;a href=&quot;'.<a class="function" onClick="logFunction('get_dispctrl_url')" href="../../../_functions/get_dispctrl_url.html" onMouseOver="funcPopup(event,'get_dispctrl_url')">get_dispctrl_url</a>( 'usercomments', 'user_ID='.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ).'&quot;&gt;&lt;b&gt;'.<a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a>.'&lt;/b&gt;&lt;/a&gt;';
<a name="l5612"><span class="linenum">5612</span></a>          }
<a name="l5613"><span class="linenum">5613</span></a>          else
<a name="l5614"><span class="linenum">5614</span></a>          {
<a name="l5615"><span class="linenum">5615</span></a>              <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a> = '&lt;b&gt;'.<a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a>.'&lt;/b&gt;';
<a name="l5616"><span class="linenum">5616</span></a>          }
<a name="l5617"><span class="linenum">5617</span></a>  
<a name="l5618"><span class="linenum">5618</span></a>  <span class="comment">        // Get number of helpful votes on comments for this user</span>
<a name="l5619"><span class="linenum">5619</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l5620"><span class="linenum">5620</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l5621"><span class="linenum">5621</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['view_type'] == 'simple' )
<a name="l5622"><span class="linenum">5622</span></a>          { // Simple view
<a name="l5623"><span class="linenum">5623</span></a>              <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cmvt_user_ID AS user_ID, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) AS cnt' );
<a name="l5624"><span class="linenum">5624</span></a>          }
<a name="l5625"><span class="linenum">5625</span></a>          else
<a name="l5626"><span class="linenum">5626</span></a>          { // Extended view
<a name="l5627"><span class="linenum">5627</span></a>              <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'cmvt_user_ID AS user_ID, cmvt_helpful, cmvt_spam' );
<a name="l5628"><span class="linenum">5628</span></a>          }
<a name="l5629"><span class="linenum">5629</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_comments' );
<a name="l5630"><span class="linenum">5630</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_comments__votes ON comment_ID = cmvt_cmt_ID' );
<a name="l5631"><span class="linenum">5631</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'comment_author_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5632"><span class="linenum">5632</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'comment_status IN ( &quot;published&quot;, &quot;community&quot;, &quot;protected&quot;, &quot;review&quot; )' );
<a name="l5633"><span class="linenum">5633</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['view_type'] == 'simple' )
<a name="l5634"><span class="linenum">5634</span></a>          { // Simple view
<a name="l5635"><span class="linenum">5635</span></a>              <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cmvt_helpful = 1' );
<a name="l5636"><span class="linenum">5636</span></a>              <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('GROUP_BY')" href="../../../_functions/group_by.html" onMouseOver="funcPopup(event,'group_by')">GROUP_BY</a>( 'user_ID' );
<a name="l5637"><span class="linenum">5637</span></a>          }
<a name="l5638"><span class="linenum">5638</span></a>  
<a name="l5639"><span class="linenum">5639</span></a>          if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['view_type'] == 'simple' )
<a name="l5640"><span class="linenum">5640</span></a>          { // Simple view
<a name="l5641"><span class="linenum">5641</span></a>              <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l5642"><span class="linenum">5642</span></a>  
<a name="l5643"><span class="linenum">5643</span></a>  <span class="comment">            // Calculate total votes from all users</span>
<a name="l5644"><span class="linenum">5644</span></a>              <a class="var it4064" onMouseOver="hilite(4064)" onMouseOut="lolite()" onClick="logVariable('users_count_useful')" href="../../../_variables/users_count_useful.html">$users_count_useful</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> );
<a name="l5645"><span class="linenum">5645</span></a>              <a class="var it4065" onMouseOver="hilite(4065)" onMouseOut="lolite()" onClick="logVariable('votes_count_useful')" href="../../../_variables/votes_count_useful.html">$votes_count_useful</a> = 0;
<a name="l5646"><span class="linenum">5646</span></a>              foreach( <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> as <a class="var it4066" onMouseOver="hilite(4066)" onMouseOut="lolite()" onClick="logVariable('user_votes')" href="../../../_variables/user_votes.html">$user_votes</a> )
<a name="l5647"><span class="linenum">5647</span></a>              {
<a name="l5648"><span class="linenum">5648</span></a>                  <a class="var it4065" onMouseOver="hilite(4065)" onMouseOut="lolite()" onClick="logVariable('votes_count_useful')" href="../../../_variables/votes_count_useful.html">$votes_count_useful</a> += <a class="var it4066" onMouseOver="hilite(4066)" onMouseOut="lolite()" onClick="logVariable('user_votes')" href="../../../_variables/user_votes.html">$user_votes</a>;
<a name="l5649"><span class="linenum">5649</span></a>              }
<a name="l5650"><span class="linenum">5650</span></a>  
<a name="l5651"><span class="linenum">5651</span></a>              return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text_simple'],
<a name="l5652"><span class="linenum">5652</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a>, <a class="var it4059" onMouseOver="hilite(4059)" onMouseOut="lolite()" onClick="logVariable('public_percent')" href="../../../_variables/public_percent.html">$public_percent</a>,
<a name="l5653"><span class="linenum">5653</span></a>                  '&lt;b class=&quot;green&quot;&gt;'.<a class="var it4065" onMouseOver="hilite(4065)" onMouseOut="lolite()" onClick="logVariable('votes_count_useful')" href="../../../_variables/votes_count_useful.html">$votes_count_useful</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="var it4064" onMouseOver="hilite(4064)" onMouseOut="lolite()" onClick="logVariable('users_count_useful')" href="../../../_variables/users_count_useful.html">$users_count_useful</a>.'&lt;/b&gt;' );
<a name="l5654"><span class="linenum">5654</span></a>          }
<a name="l5655"><span class="linenum">5655</span></a>          else
<a name="l5656"><span class="linenum">5656</span></a>          { // Extended view
<a name="l5657"><span class="linenum">5657</span></a>              <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l5658"><span class="linenum">5658</span></a>  
<a name="l5659"><span class="linenum">5659</span></a>              <a class="var it4065" onMouseOver="hilite(4065)" onMouseOut="lolite()" onClick="logVariable('votes_count_useful')" href="../../../_variables/votes_count_useful.html">$votes_count_useful</a> = 0;
<a name="l5660"><span class="linenum">5660</span></a>              <a class="var it4064" onMouseOver="hilite(4064)" onMouseOut="lolite()" onClick="logVariable('users_count_useful')" href="../../../_variables/users_count_useful.html">$users_count_useful</a> = array();
<a name="l5661"><span class="linenum">5661</span></a>              <a class="var it4067" onMouseOver="hilite(4067)" onMouseOut="lolite()" onClick="logVariable('votes_count_not')" href="../../../_variables/votes_count_not.html">$votes_count_not</a> = 0;
<a name="l5662"><span class="linenum">5662</span></a>              <a class="var it4068" onMouseOver="hilite(4068)" onMouseOut="lolite()" onClick="logVariable('users_count_not')" href="../../../_variables/users_count_not.html">$users_count_not</a> = array();
<a name="l5663"><span class="linenum">5663</span></a>              <a class="var it4069" onMouseOver="hilite(4069)" onMouseOut="lolite()" onClick="logVariable('votes_count_ok')" href="../../../_variables/votes_count_ok.html">$votes_count_ok</a> = 0;
<a name="l5664"><span class="linenum">5664</span></a>              <a class="var it4070" onMouseOver="hilite(4070)" onMouseOut="lolite()" onClick="logVariable('users_count_ok')" href="../../../_variables/users_count_ok.html">$users_count_ok</a> = array();
<a name="l5665"><span class="linenum">5665</span></a>              <a class="var it4071" onMouseOver="hilite(4071)" onMouseOut="lolite()" onClick="logVariable('votes_count_spam')" href="../../../_variables/votes_count_spam.html">$votes_count_spam</a> = 0;
<a name="l5666"><span class="linenum">5666</span></a>              <a class="var it4072" onMouseOver="hilite(4072)" onMouseOut="lolite()" onClick="logVariable('users_count_spam')" href="../../../_variables/users_count_spam.html">$users_count_spam</a> = array();
<a name="l5667"><span class="linenum">5667</span></a>              foreach( <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> as <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a> )
<a name="l5668"><span class="linenum">5668</span></a>              {
<a name="l5669"><span class="linenum">5669</span></a>                  if( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('cmvt_helpful')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/cmvt_helpful.html">cmvt_helpful</a> === '1' )
<a name="l5670"><span class="linenum">5670</span></a>                  { // Useful votes
<a name="l5671"><span class="linenum">5671</span></a>                      <a class="var it4065" onMouseOver="hilite(4065)" onMouseOut="lolite()" onClick="logVariable('votes_count_useful')" href="../../../_variables/votes_count_useful.html">$votes_count_useful</a>++;
<a name="l5672"><span class="linenum">5672</span></a>                      <a class="var it4064" onMouseOver="hilite(4064)" onMouseOut="lolite()" onClick="logVariable('users_count_useful')" href="../../../_variables/users_count_useful.html">$users_count_useful</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5673"><span class="linenum">5673</span></a>                  }
<a name="l5674"><span class="linenum">5674</span></a>                  elseif( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('cmvt_helpful')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/cmvt_helpful.html">cmvt_helpful</a> === '-1' )
<a name="l5675"><span class="linenum">5675</span></a>                  { // Not useful votes
<a name="l5676"><span class="linenum">5676</span></a>                      <a class="var it4067" onMouseOver="hilite(4067)" onMouseOut="lolite()" onClick="logVariable('votes_count_not')" href="../../../_variables/votes_count_not.html">$votes_count_not</a>++;
<a name="l5677"><span class="linenum">5677</span></a>                      <a class="var it4068" onMouseOver="hilite(4068)" onMouseOut="lolite()" onClick="logVariable('users_count_not')" href="../../../_variables/users_count_not.html">$users_count_not</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5678"><span class="linenum">5678</span></a>                  }
<a name="l5679"><span class="linenum">5679</span></a>                  if( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('cmvt_spam')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/cmvt_spam.html">cmvt_spam</a> === '-1' )
<a name="l5680"><span class="linenum">5680</span></a>                  { // Ok votes
<a name="l5681"><span class="linenum">5681</span></a>                      <a class="var it4069" onMouseOver="hilite(4069)" onMouseOut="lolite()" onClick="logVariable('votes_count_ok')" href="../../../_variables/votes_count_ok.html">$votes_count_ok</a>++;
<a name="l5682"><span class="linenum">5682</span></a>                      <a class="var it4070" onMouseOver="hilite(4070)" onMouseOut="lolite()" onClick="logVariable('users_count_ok')" href="../../../_variables/users_count_ok.html">$users_count_ok</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5683"><span class="linenum">5683</span></a>                  }
<a name="l5684"><span class="linenum">5684</span></a>                  elseif( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('cmvt_spam')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/cmvt_spam.html">cmvt_spam</a> === '1' )
<a name="l5685"><span class="linenum">5685</span></a>                  { // Spam votes
<a name="l5686"><span class="linenum">5686</span></a>                      <a class="var it4071" onMouseOver="hilite(4071)" onMouseOut="lolite()" onClick="logVariable('votes_count_spam')" href="../../../_variables/votes_count_spam.html">$votes_count_spam</a>++;
<a name="l5687"><span class="linenum">5687</span></a>                      <a class="var it4072" onMouseOver="hilite(4072)" onMouseOut="lolite()" onClick="logVariable('users_count_spam')" href="../../../_variables/users_count_spam.html">$users_count_spam</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5688"><span class="linenum">5688</span></a>                  }
<a name="l5689"><span class="linenum">5689</span></a>              }
<a name="l5690"><span class="linenum">5690</span></a>  
<a name="l5691"><span class="linenum">5691</span></a>              return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text_extended'],
<a name="l5692"><span class="linenum">5692</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, <a class="var it3941" onMouseOver="hilite(3941)" onMouseOut="lolite()" onClick="logVariable('total_num_comments')" href="../../../_variables/total_num_comments.html">$total_num_comments</a>, <a class="var it4059" onMouseOver="hilite(4059)" onMouseOut="lolite()" onClick="logVariable('public_percent')" href="../../../_variables/public_percent.html">$public_percent</a>,
<a name="l5693"><span class="linenum">5693</span></a>                  '&lt;b class=&quot;green&quot;&gt;'.<a class="var it4065" onMouseOver="hilite(4065)" onMouseOut="lolite()" onClick="logVariable('votes_count_useful')" href="../../../_variables/votes_count_useful.html">$votes_count_useful</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4064" onMouseOver="hilite(4064)" onMouseOut="lolite()" onClick="logVariable('users_count_useful')" href="../../../_variables/users_count_useful.html">$users_count_useful</a> ).'&lt;/b&gt;',
<a name="l5694"><span class="linenum">5694</span></a>                  '&lt;b class=&quot;red&quot;&gt;'.<a class="var it4067" onMouseOver="hilite(4067)" onMouseOut="lolite()" onClick="logVariable('votes_count_not')" href="../../../_variables/votes_count_not.html">$votes_count_not</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4068" onMouseOver="hilite(4068)" onMouseOut="lolite()" onClick="logVariable('users_count_not')" href="../../../_variables/users_count_not.html">$users_count_not</a> ).'&lt;/b&gt;',
<a name="l5695"><span class="linenum">5695</span></a>                  '&lt;b class=&quot;green&quot;&gt;'.<a class="var it4069" onMouseOver="hilite(4069)" onMouseOut="lolite()" onClick="logVariable('votes_count_ok')" href="../../../_variables/votes_count_ok.html">$votes_count_ok</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4070" onMouseOver="hilite(4070)" onMouseOut="lolite()" onClick="logVariable('users_count_ok')" href="../../../_variables/users_count_ok.html">$users_count_ok</a> ).'&lt;/b&gt;',
<a name="l5696"><span class="linenum">5696</span></a>                  '&lt;b class=&quot;red&quot;&gt;'.<a class="var it4071" onMouseOver="hilite(4071)" onMouseOut="lolite()" onClick="logVariable('votes_count_spam')" href="../../../_variables/votes_count_spam.html">$votes_count_spam</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4072" onMouseOver="hilite(4072)" onMouseOut="lolite()" onClick="logVariable('users_count_spam')" href="../../../_variables/users_count_spam.html">$users_count_spam</a> ).'&lt;/b&gt;' );
<a name="l5697"><span class="linenum">5697</span></a>          }
<a name="l5698"><span class="linenum">5698</span></a>      }
<a name="l5699"><span class="linenum">5699</span></a>  
<a name="l5700"><span class="linenum">5700</span></a>  
<a name="l5701"><span class="linenum">5701</span></a>      <span class="comment">/**</span>
<a name="l5702"><span class="linenum">5702</span></a>  <span class="comment">     * Get number of files (and number of helpful votes on photos only) by this user</span>
<a name="l5703"><span class="linenum">5703</span></a>  <span class="comment">     *</span>
<a name="l5704"><span class="linenum">5704</span></a>  <span class="comment">     * @param array Params</span>
<a name="l5705"><span class="linenum">5705</span></a>  <span class="comment">     * @return string Result</span>
<a name="l5706"><span class="linenum">5706</span></a>  <span class="comment">     */</span>
<a name="l5707"><span class="linenum">5707</span></a>  	function <a class="function" onClick="logFunction('get_reputation_files')" href="../../../_functions/get_reputation_files.html" onMouseOver="funcPopup(event,'get_reputation_files')">get_reputation_files</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l5708"><span class="linenum">5708</span></a>      {
<a name="l5709"><span class="linenum">5709</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l5710"><span class="linenum">5710</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l5711"><span class="linenum">5711</span></a>                  'view_type'           =&gt; 'simple', // 'simple', 'extended'
<a name="l5712"><span class="linenum">5712</span></a>                  'file_type'           =&gt; 'image', // 'image', 'audio', 'other'
<a name="l5713"><span class="linenum">5713</span></a>                  'text_image_simple'   =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s has posted %s photos. %s of these photos have been liked by %s different users.' ),
<a name="l5714"><span class="linenum">5714</span></a>                  'text_image_extended' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s has posted %s photos.&lt;br /&gt;%s voted up (liked) by %s different users.&lt;br /&gt;%s voted down by %s different users.&lt;br /&gt;%s considered INAPPROPRIATE by %s different users.&lt;br /&gt;%s considered SPAM by %s different users.' ),
<a name="l5715"><span class="linenum">5715</span></a>                  'text_audio'          =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s has uploaded %s audio files.' ),
<a name="l5716"><span class="linenum">5716</span></a>                  'text_other'          =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s has uploaded %s other files.' ),
<a name="l5717"><span class="linenum">5717</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l5718"><span class="linenum">5718</span></a>  
<a name="l5719"><span class="linenum">5719</span></a>          switch( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['file_type'] )
<a name="l5720"><span class="linenum">5720</span></a>          {
<a name="l5721"><span class="linenum">5721</span></a>              case 'image':
<a name="l5722"><span class="linenum">5722</span></a>  <span class="comment">                // Number of photos</span>
<a name="l5723"><span class="linenum">5723</span></a>                  global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l5724"><span class="linenum">5724</span></a>  <span class="comment">                // Get number of helpful votes on links for this user</span>
<a name="l5725"><span class="linenum">5725</span></a>                  <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l5726"><span class="linenum">5726</span></a>                  if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['view_type'] == 'simple' )
<a name="l5727"><span class="linenum">5727</span></a>                  { // Simple view
<a name="l5728"><span class="linenum">5728</span></a>                      <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'lvot_user_ID AS user_ID, <a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) AS cnt' );
<a name="l5729"><span class="linenum">5729</span></a>                  }
<a name="l5730"><span class="linenum">5730</span></a>                  else
<a name="l5731"><span class="linenum">5731</span></a>                  { // Extended view
<a name="l5732"><span class="linenum">5732</span></a>                      <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'lvot_user_ID AS user_ID, lvot_like, lvot_inappropriate, lvot_spam' );
<a name="l5733"><span class="linenum">5733</span></a>                  }
<a name="l5734"><span class="linenum">5734</span></a>                  <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_links' );
<a name="l5735"><span class="linenum">5735</span></a>                  <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_files ON file_ID = link_file_ID' );
<a name="l5736"><span class="linenum">5736</span></a>                  <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_links__vote ON link_ID = lvot_link_ID' );
<a name="l5737"><span class="linenum">5737</span></a>                  <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'link_creator_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5738"><span class="linenum">5738</span></a>                  <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'file_type = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['file_type'] ) );
<a name="l5739"><span class="linenum">5739</span></a>                  if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['view_type'] == 'simple' )
<a name="l5740"><span class="linenum">5740</span></a>                  { // Simple view
<a name="l5741"><span class="linenum">5741</span></a>                      <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'lvot_like = 1' );
<a name="l5742"><span class="linenum">5742</span></a>                      <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('GROUP_BY')" href="../../../_functions/group_by.html" onMouseOver="funcPopup(event,'group_by')">GROUP_BY</a>( 'user_ID' );
<a name="l5743"><span class="linenum">5743</span></a>                  }
<a name="l5744"><span class="linenum">5744</span></a>  
<a name="l5745"><span class="linenum">5745</span></a>  
<a name="l5746"><span class="linenum">5746</span></a>                  if( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['view_type'] == 'simple' )
<a name="l5747"><span class="linenum">5747</span></a>                  { // Simple view
<a name="l5748"><span class="linenum">5748</span></a>                      <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_assoc')" href="../../../_functions/get_assoc.html" onMouseOver="funcPopup(event,'get_assoc')">get_assoc</a>( <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l5749"><span class="linenum">5749</span></a>  
<a name="l5750"><span class="linenum">5750</span></a>  <span class="comment">                    // Calculate total votes from all users</span>
<a name="l5751"><span class="linenum">5751</span></a>                      <a class="var it4075" onMouseOver="hilite(4075)" onMouseOut="lolite()" onClick="logVariable('users_count_up')" href="../../../_variables/users_count_up.html">$users_count_up</a> = <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> );
<a name="l5752"><span class="linenum">5752</span></a>                      <a class="var it4076" onMouseOver="hilite(4076)" onMouseOut="lolite()" onClick="logVariable('votes_count_up')" href="../../../_variables/votes_count_up.html">$votes_count_up</a> = 0;
<a name="l5753"><span class="linenum">5753</span></a>                      foreach( <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> as <a class="var it4066" onMouseOver="hilite(4066)" onMouseOut="lolite()" onClick="logVariable('user_votes')" href="../../../_variables/user_votes.html">$user_votes</a> )
<a name="l5754"><span class="linenum">5754</span></a>                      {
<a name="l5755"><span class="linenum">5755</span></a>                          <a class="var it4076" onMouseOver="hilite(4076)" onMouseOut="lolite()" onClick="logVariable('votes_count_up')" href="../../../_variables/votes_count_up.html">$votes_count_up</a> += <a class="var it4066" onMouseOver="hilite(4066)" onMouseOut="lolite()" onClick="logVariable('user_votes')" href="../../../_variables/user_votes.html">$user_votes</a>;
<a name="l5756"><span class="linenum">5756</span></a>                      }
<a name="l5757"><span class="linenum">5757</span></a>                      return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text_image_simple'],
<a name="l5758"><span class="linenum">5758</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, '&lt;b&gt;'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_files')" href="../../../_functions/get_num_files.html" onMouseOver="funcPopup(event,'get_num_files')">get_num_files</a>( 'image' ).'&lt;/b&gt;',
<a name="l5759"><span class="linenum">5759</span></a>                          '&lt;b class=&quot;green&quot;&gt;'.<a class="var it4076" onMouseOver="hilite(4076)" onMouseOut="lolite()" onClick="logVariable('votes_count_up')" href="../../../_variables/votes_count_up.html">$votes_count_up</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="var it4075" onMouseOver="hilite(4075)" onMouseOut="lolite()" onClick="logVariable('users_count_up')" href="../../../_variables/users_count_up.html">$users_count_up</a>.'&lt;/b&gt;' );
<a name="l5760"><span class="linenum">5760</span></a>                  }
<a name="l5761"><span class="linenum">5761</span></a>                  else
<a name="l5762"><span class="linenum">5762</span></a>                  { // Extended view
<a name="l5763"><span class="linenum">5763</span></a>                      <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l5764"><span class="linenum">5764</span></a>  
<a name="l5765"><span class="linenum">5765</span></a>                      <a class="var it4076" onMouseOver="hilite(4076)" onMouseOut="lolite()" onClick="logVariable('votes_count_up')" href="../../../_variables/votes_count_up.html">$votes_count_up</a> = 0;
<a name="l5766"><span class="linenum">5766</span></a>                      <a class="var it4075" onMouseOver="hilite(4075)" onMouseOut="lolite()" onClick="logVariable('users_count_up')" href="../../../_variables/users_count_up.html">$users_count_up</a> = array();
<a name="l5767"><span class="linenum">5767</span></a>                      <a class="var it4077" onMouseOver="hilite(4077)" onMouseOut="lolite()" onClick="logVariable('votes_count_down')" href="../../../_variables/votes_count_down.html">$votes_count_down</a> = 0;
<a name="l5768"><span class="linenum">5768</span></a>                      <a class="var it4078" onMouseOver="hilite(4078)" onMouseOut="lolite()" onClick="logVariable('users_count_down')" href="../../../_variables/users_count_down.html">$users_count_down</a> = array();
<a name="l5769"><span class="linenum">5769</span></a>                      <a class="var it4079" onMouseOver="hilite(4079)" onMouseOut="lolite()" onClick="logVariable('votes_count_inappropriate')" href="../../../_variables/votes_count_inappropriate.html">$votes_count_inappropriate</a> = 0;
<a name="l5770"><span class="linenum">5770</span></a>                      <a class="var it4080" onMouseOver="hilite(4080)" onMouseOut="lolite()" onClick="logVariable('users_count_inappropriate')" href="../../../_variables/users_count_inappropriate.html">$users_count_inappropriate</a> = array();
<a name="l5771"><span class="linenum">5771</span></a>                      <a class="var it4071" onMouseOver="hilite(4071)" onMouseOut="lolite()" onClick="logVariable('votes_count_spam')" href="../../../_variables/votes_count_spam.html">$votes_count_spam</a> = 0;
<a name="l5772"><span class="linenum">5772</span></a>                      <a class="var it4072" onMouseOver="hilite(4072)" onMouseOut="lolite()" onClick="logVariable('users_count_spam')" href="../../../_variables/users_count_spam.html">$users_count_spam</a> = array();
<a name="l5773"><span class="linenum">5773</span></a>                      foreach( <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> as <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a> )
<a name="l5774"><span class="linenum">5774</span></a>                      {
<a name="l5775"><span class="linenum">5775</span></a>                          if( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('lvot_like')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/lvot_like.html">lvot_like</a> === '1' )
<a name="l5776"><span class="linenum">5776</span></a>                          { // Up votes
<a name="l5777"><span class="linenum">5777</span></a>                              <a class="var it4076" onMouseOver="hilite(4076)" onMouseOut="lolite()" onClick="logVariable('votes_count_up')" href="../../../_variables/votes_count_up.html">$votes_count_up</a>++;
<a name="l5778"><span class="linenum">5778</span></a>                              <a class="var it4075" onMouseOver="hilite(4075)" onMouseOut="lolite()" onClick="logVariable('users_count_up')" href="../../../_variables/users_count_up.html">$users_count_up</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5779"><span class="linenum">5779</span></a>                          }
<a name="l5780"><span class="linenum">5780</span></a>                          elseif( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('lvot_like')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/lvot_like.html">lvot_like</a> === '-1' )
<a name="l5781"><span class="linenum">5781</span></a>                          { // Down votes
<a name="l5782"><span class="linenum">5782</span></a>                              <a class="var it4077" onMouseOver="hilite(4077)" onMouseOut="lolite()" onClick="logVariable('votes_count_down')" href="../../../_variables/votes_count_down.html">$votes_count_down</a>++;
<a name="l5783"><span class="linenum">5783</span></a>                              <a class="var it4078" onMouseOver="hilite(4078)" onMouseOut="lolite()" onClick="logVariable('users_count_down')" href="../../../_variables/users_count_down.html">$users_count_down</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5784"><span class="linenum">5784</span></a>                          }
<a name="l5785"><span class="linenum">5785</span></a>                          if( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('lvot_inappropriate')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/lvot_inappropriate.html">lvot_inappropriate</a> === '1' )
<a name="l5786"><span class="linenum">5786</span></a>                          { // Inappropriate votes
<a name="l5787"><span class="linenum">5787</span></a>                              <a class="var it4079" onMouseOver="hilite(4079)" onMouseOut="lolite()" onClick="logVariable('votes_count_inappropriate')" href="../../../_variables/votes_count_inappropriate.html">$votes_count_inappropriate</a>++;
<a name="l5788"><span class="linenum">5788</span></a>                              <a class="var it4080" onMouseOver="hilite(4080)" onMouseOut="lolite()" onClick="logVariable('users_count_inappropriate')" href="../../../_variables/users_count_inappropriate.html">$users_count_inappropriate</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5789"><span class="linenum">5789</span></a>                          }
<a name="l5790"><span class="linenum">5790</span></a>                          if( <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('lvot_spam')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/lvot_spam.html">lvot_spam</a> === '1' )
<a name="l5791"><span class="linenum">5791</span></a>                          { // Spam votes
<a name="l5792"><span class="linenum">5792</span></a>                              <a class="var it4071" onMouseOver="hilite(4071)" onMouseOut="lolite()" onClick="logVariable('votes_count_spam')" href="../../../_variables/votes_count_spam.html">$votes_count_spam</a>++;
<a name="l5793"><span class="linenum">5793</span></a>                              <a class="var it4072" onMouseOver="hilite(4072)" onMouseOut="lolite()" onClick="logVariable('users_count_spam')" href="../../../_variables/users_count_spam.html">$users_count_spam</a>[ <a class="var it2109" onMouseOver="hilite(2109)" onMouseOut="lolite()" onClick="logVariable('vote')" href="../../../_variables/vote.html">$vote</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10812" onMouseOver="hilite(10812)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> ] = NULL;
<a name="l5794"><span class="linenum">5794</span></a>                          }
<a name="l5795"><span class="linenum">5795</span></a>                      }
<a name="l5796"><span class="linenum">5796</span></a>  
<a name="l5797"><span class="linenum">5797</span></a>                      return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text_image_extended'],
<a name="l5798"><span class="linenum">5798</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, '&lt;b&gt;'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_files')" href="../../../_functions/get_num_files.html" onMouseOver="funcPopup(event,'get_num_files')">get_num_files</a>( 'image' ).'&lt;/b&gt;',
<a name="l5799"><span class="linenum">5799</span></a>                          '&lt;b class=&quot;green&quot;&gt;'.<a class="var it4076" onMouseOver="hilite(4076)" onMouseOut="lolite()" onClick="logVariable('votes_count_up')" href="../../../_variables/votes_count_up.html">$votes_count_up</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4075" onMouseOver="hilite(4075)" onMouseOut="lolite()" onClick="logVariable('users_count_up')" href="../../../_variables/users_count_up.html">$users_count_up</a> ).'&lt;/b&gt;',
<a name="l5800"><span class="linenum">5800</span></a>                          '&lt;b class=&quot;red&quot;&gt;'.<a class="var it4077" onMouseOver="hilite(4077)" onMouseOut="lolite()" onClick="logVariable('votes_count_down')" href="../../../_variables/votes_count_down.html">$votes_count_down</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4078" onMouseOver="hilite(4078)" onMouseOut="lolite()" onClick="logVariable('users_count_down')" href="../../../_variables/users_count_down.html">$users_count_down</a> ).'&lt;/b&gt;',
<a name="l5801"><span class="linenum">5801</span></a>                          '&lt;b class=&quot;red&quot;&gt;'.<a class="var it4079" onMouseOver="hilite(4079)" onMouseOut="lolite()" onClick="logVariable('votes_count_inappropriate')" href="../../../_variables/votes_count_inappropriate.html">$votes_count_inappropriate</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4080" onMouseOver="hilite(4080)" onMouseOut="lolite()" onClick="logVariable('users_count_inappropriate')" href="../../../_variables/users_count_inappropriate.html">$users_count_inappropriate</a> ).'&lt;/b&gt;',
<a name="l5802"><span class="linenum">5802</span></a>                          '&lt;b class=&quot;red&quot;&gt;'.<a class="var it4071" onMouseOver="hilite(4071)" onMouseOut="lolite()" onClick="logVariable('votes_count_spam')" href="../../../_variables/votes_count_spam.html">$votes_count_spam</a>.'&lt;/b&gt;', '&lt;b&gt;'.<a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4072" onMouseOver="hilite(4072)" onMouseOut="lolite()" onClick="logVariable('users_count_spam')" href="../../../_variables/users_count_spam.html">$users_count_spam</a> ).'&lt;/b&gt;' );
<a name="l5803"><span class="linenum">5803</span></a>                  }
<a name="l5804"><span class="linenum">5804</span></a>                  break;
<a name="l5805"><span class="linenum">5805</span></a>  
<a name="l5806"><span class="linenum">5806</span></a>              case 'audio':
<a name="l5807"><span class="linenum">5807</span></a>  <span class="comment">                // Number of audio files</span>
<a name="l5808"><span class="linenum">5808</span></a>                  return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text_audio'], <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, '&lt;b&gt;'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_files')" href="../../../_functions/get_num_files.html" onMouseOver="funcPopup(event,'get_num_files')">get_num_files</a>( 'audio' ).'&lt;/b&gt;' );
<a name="l5809"><span class="linenum">5809</span></a>  
<a name="l5810"><span class="linenum">5810</span></a>              case 'other':
<a name="l5811"><span class="linenum">5811</span></a>  <span class="comment">                // Number of other files</span>
<a name="l5812"><span class="linenum">5812</span></a>                  return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text_other'], <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, '&lt;b&gt;'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_num_files')" href="../../../_functions/get_num_files.html" onMouseOver="funcPopup(event,'get_num_files')">get_num_files</a>( 'other' ).'&lt;/b&gt;' );
<a name="l5813"><span class="linenum">5813</span></a>          }
<a name="l5814"><span class="linenum">5814</span></a>      }
<a name="l5815"><span class="linenum">5815</span></a>  
<a name="l5816"><span class="linenum">5816</span></a>  
<a name="l5817"><span class="linenum">5817</span></a>      <span class="comment">/**</span>
<a name="l5818"><span class="linenum">5818</span></a>  <span class="comment">     * Get number of spam votes which were made by this user</span>
<a name="l5819"><span class="linenum">5819</span></a>  <span class="comment">     *</span>
<a name="l5820"><span class="linenum">5820</span></a>  <span class="comment">     * @param array Params</span>
<a name="l5821"><span class="linenum">5821</span></a>  <span class="comment">     * @return string Result</span>
<a name="l5822"><span class="linenum">5822</span></a>  <span class="comment">     */</span>
<a name="l5823"><span class="linenum">5823</span></a>  	function <a class="function" onClick="logFunction('get_reputation_spam')" href="../../../_functions/get_reputation_spam.html" onMouseOver="funcPopup(event,'get_reputation_spam')">get_reputation_spam</a>( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = array() )
<a name="l5824"><span class="linenum">5824</span></a>      {
<a name="l5825"><span class="linenum">5825</span></a>  <span class="comment">        // Make sure we are not missing any param:</span>
<a name="l5826"><span class="linenum">5826</span></a>          <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = <a class="phpfunction" onClick="logFunction('array_merge')" href="../../../_functions/array_merge.html" onMouseOver="phpfuncPopup(event,'array_merge')">array_merge</a>( array(
<a name="l5827"><span class="linenum">5827</span></a>                  'text' =&gt; <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>( '%s successfully reported %s spams and/or spammers!' ),
<a name="l5828"><span class="linenum">5828</span></a>              ), <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> );
<a name="l5829"><span class="linenum">5829</span></a>  
<a name="l5830"><span class="linenum">5830</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>;
<a name="l5831"><span class="linenum">5831</span></a>  
<a name="l5832"><span class="linenum">5832</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>( 'Get number of spam votes on comments by this user' );
<a name="l5833"><span class="linenum">5833</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) AS cnt' );
<a name="l5834"><span class="linenum">5834</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_comments__votes' );
<a name="l5835"><span class="linenum">5835</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'cmvt_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5836"><span class="linenum">5836</span></a>          <a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'cmvt_spam = 1' );
<a name="l5837"><span class="linenum">5837</span></a>  
<a name="l5838"><span class="linenum">5838</span></a>          <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>( 'Get number of spam votes on links by this user' );
<a name="l5839"><span class="linenum">5839</span></a>          <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>(*) AS cnt' );
<a name="l5840"><span class="linenum">5840</span></a>          <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_links__vote' );
<a name="l5841"><span class="linenum">5841</span></a>          <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'lvot_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l5842"><span class="linenum">5842</span></a>          <a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'lvot_spam = 1' );
<a name="l5843"><span class="linenum">5843</span></a>  
<a name="l5844"><span class="linenum">5844</span></a>          <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( 'SELECT SUM( cnt )
<a name="l5845"><span class="linenum">5845</span></a>              <a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a> ('.<a class="var it4062" onMouseOver="hilite(4062)" onMouseOut="lolite()" onClick="logVariable('comments_SQL')" href="../../../_variables/comments_SQL.html">$comments_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>().' UNION ALL '.<a class="var it1534" onMouseOver="hilite(1534)" onMouseOut="lolite()" onClick="logVariable('links_SQL')" href="../../../_variables/links_SQL.html">$links_SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>().') AS tbl' );
<a name="l5846"><span class="linenum">5846</span></a>  
<a name="l5847"><span class="linenum">5847</span></a>  <span class="comment">        // Get spam fighter score for the users that were reported and deleted</span>
<a name="l5848"><span class="linenum">5848</span></a>          <a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a> += <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'spam_fighter_score', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l5849"><span class="linenum">5849</span></a>  
<a name="l5850"><span class="linenum">5850</span></a>          return sprintf( <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a>['text'], <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>, '&lt;b&gt;'.<a class="var it4063" onMouseOver="hilite(4063)" onMouseOut="lolite()" onClick="logVariable('votes')" href="../../../_variables/votes.html">$votes</a>.'&lt;/b&gt;' );
<a name="l5851"><span class="linenum">5851</span></a>      }
<a name="l5852"><span class="linenum">5852</span></a>  
<a name="l5853"><span class="linenum">5853</span></a>  
<a name="l5854"><span class="linenum">5854</span></a>      <span class="comment">/**</span>
<a name="l5855"><span class="linenum">5855</span></a>  <span class="comment">     * Get status of user email</span>
<a name="l5856"><span class="linenum">5856</span></a>  <span class="comment">     *</span>
<a name="l5857"><span class="linenum">5857</span></a>  <span class="comment">     * @return string Status: 'unknown', 'warning', 'suspicious1', 'suspicious2', 'suspicious3', 'prmerror', 'spammer', 'redemption'</span>
<a name="l5858"><span class="linenum">5858</span></a>  <span class="comment">     */</span>
<a name="l5859"><span class="linenum">5859</span></a>  	function <a class="function" onClick="logFunction('get_email_status')" href="../../../_functions/get_email_status.html" onMouseOver="funcPopup(event,'get_email_status')">get_email_status</a>()
<a name="l5860"><span class="linenum">5860</span></a>      {
<a name="l5861"><span class="linenum">5861</span></a>          <a class="var it3383" onMouseOver="hilite(3383)" onMouseOut="lolite()" onClick="logVariable('user_email')" href="../../../_variables/user_email.html">$user_email</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'email' );
<a name="l5862"><span class="linenum">5862</span></a>  
<a name="l5863"><span class="linenum">5863</span></a>          <a class="var it430" onMouseOver="hilite(430)" onMouseOut="lolite()" onClick="logVariable('EmailAddressCache')" href="../../../_variables/EmailAddressCache.html">$EmailAddressCache</a> = &amp; get_EmailAddressCache();
<a name="l5864"><span class="linenum">5864</span></a>          if( !empty( <a class="var it3383" onMouseOver="hilite(3383)" onMouseOut="lolite()" onClick="logVariable('user_email')" href="../../../_variables/user_email.html">$user_email</a> ) &amp;&amp; <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a> = &amp; <a class="var it430" onMouseOver="hilite(430)" onMouseOut="lolite()" onClick="logVariable('EmailAddressCache')" href="../../../_variables/EmailAddressCache.html">$EmailAddressCache</a>-&gt;get_by_name( <a class="var it3383" onMouseOver="hilite(3383)" onMouseOut="lolite()" onClick="logVariable('user_email')" href="../../../_variables/user_email.html">$user_email</a>, false, false ) )
<a name="l5865"><span class="linenum">5865</span></a>          { // The email of this user is located in the DB table
<a name="l5866"><span class="linenum">5866</span></a>              return <a class="var it3390" onMouseOver="hilite(3390)" onMouseOut="lolite()" onClick="logVariable('EmailAddress')" href="../../../_variables/EmailAddress.html">$EmailAddress</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'status' );
<a name="l5867"><span class="linenum">5867</span></a>          }
<a name="l5868"><span class="linenum">5868</span></a>          else
<a name="l5869"><span class="linenum">5869</span></a>          { // There is no email address in the DB table
<a name="l5870"><span class="linenum">5870</span></a>              return 'unknown';
<a name="l5871"><span class="linenum">5871</span></a>          }
<a name="l5872"><span class="linenum">5872</span></a>      }
<a name="l5873"><span class="linenum">5873</span></a>  
<a name="l5874"><span class="linenum">5874</span></a>  
<a name="l5875"><span class="linenum">5875</span></a>      <span class="comment">/**</span>
<a name="l5876"><span class="linenum">5876</span></a>  <span class="comment">     * Check if user has a permission to moderate the user</span>
<a name="l5877"><span class="linenum">5877</span></a>  <span class="comment">     *</span>
<a name="l5878"><span class="linenum">5878</span></a>  <span class="comment">     * @param integer User ID</span>
<a name="l5879"><span class="linenum">5879</span></a>  <span class="comment">     * @return boolean TRUE on success</span>
<a name="l5880"><span class="linenum">5880</span></a>  <span class="comment">     */</span>
<a name="l5881"><span class="linenum">5881</span></a>  	function <a class="function" onClick="logFunction('can_moderate_user')" href="../../../_functions/can_moderate_user.html" onMouseOver="funcPopup(event,'can_moderate_user')">can_moderate_user</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('assert')" href="../../../_variables/assert.html">$assert</a> = false )
<a name="l5882"><span class="linenum">5882</span></a>      {
<a name="l5883"><span class="linenum">5883</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> == <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l5884"><span class="linenum">5884</span></a>          {    // User can edit own profile
<a name="l5885"><span class="linenum">5885</span></a>              return true;
<a name="l5886"><span class="linenum">5886</span></a>          }
<a name="l5887"><span class="linenum">5887</span></a>  
<a name="l5888"><span class="linenum">5888</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) )
<a name="l5889"><span class="linenum">5889</span></a>          { // User can edit all users
<a name="l5890"><span class="linenum">5890</span></a>              return true;
<a name="l5891"><span class="linenum">5891</span></a>          }
<a name="l5892"><span class="linenum">5892</span></a>  
<a name="l5893"><span class="linenum">5893</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'moderate', <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('assert')" href="../../../_variables/assert.html">$assert</a> ) )
<a name="l5894"><span class="linenum">5894</span></a>          { // User can moderate other user but we should to compare levels of users groups
<a name="l5895"><span class="linenum">5895</span></a>              <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l5896"><span class="linenum">5896</span></a>              if( <a class="var it4084" onMouseOver="hilite(4084)" onMouseOut="lolite()" onClick="logVariable('target_User')" href="../../../_variables/target_User.html">$target_User</a> = <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_ID( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>, false, false ) )
<a name="l5897"><span class="linenum">5897</span></a>              {
<a name="l5898"><span class="linenum">5898</span></a>                  if( <a class="var it4084" onMouseOver="hilite(4084)" onMouseOut="lolite()" onClick="logVariable('target_User')" href="../../../_variables/target_User.html">$target_User</a>-&gt;get_Group()-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'level' ) &lt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;get_Group()-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'level' ) )
<a name="l5899"><span class="linenum">5899</span></a>                  { // User can moderate only users with level lower than own level
<a name="l5900"><span class="linenum">5900</span></a>                      return true;
<a name="l5901"><span class="linenum">5901</span></a>                  }
<a name="l5902"><span class="linenum">5902</span></a>              }
<a name="l5903"><span class="linenum">5903</span></a>          }
<a name="l5904"><span class="linenum">5904</span></a>  
<a name="l5905"><span class="linenum">5905</span></a>          if( <a class="var it3959" onMouseOver="hilite(3959)" onMouseOut="lolite()" onClick="logVariable('assert')" href="../../../_variables/assert.html">$assert</a> )
<a name="l5906"><span class="linenum">5906</span></a>          { // We can't let this go on!
<a name="l5907"><span class="linenum">5907</span></a>              <a class="function" onClick="logFunction('debug_die')" href="../../../_functions/debug_die.html" onMouseOver="funcPopup(event,'debug_die')">debug_die</a>( sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('User #%s has no permission to edit user #%s!'), <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> ) );
<a name="l5908"><span class="linenum">5908</span></a>          }
<a name="l5909"><span class="linenum">5909</span></a>  
<a name="l5910"><span class="linenum">5910</span></a>          return false;
<a name="l5911"><span class="linenum">5911</span></a>      }
<a name="l5912"><span class="linenum">5912</span></a>  
<a name="l5913"><span class="linenum">5913</span></a>  
<a name="l5914"><span class="linenum">5914</span></a>      <span class="comment">/**</span>
<a name="l5915"><span class="linenum">5915</span></a>  <span class="comment">     * Send an email notification when user account has been changed</span>
<a name="l5916"><span class="linenum">5916</span></a>  <span class="comment">     *</span>
<a name="l5917"><span class="linenum">5917</span></a>  <span class="comment">     * @param boolean true if the main profile picture was changed, false otherwise</span>
<a name="l5918"><span class="linenum">5918</span></a>  <span class="comment">     * @param mixed false if there was no new profile picture upload, the newly uploaded file ID otherwise</span>
<a name="l5919"><span class="linenum">5919</span></a>  <span class="comment">     */</span>
<a name="l5920"><span class="linenum">5920</span></a>  	function <a class="function" onClick="logFunction('send_account_changed_notification')" href="../../../_functions/send_account_changed_notification.html" onMouseOver="funcPopup(event,'send_account_changed_notification')">send_account_changed_notification</a>( <a class="var it4039" onMouseOver="hilite(4039)" onMouseOut="lolite()" onClick="logVariable('avatar_changed')" href="../../../_variables/avatar_changed.html">$avatar_changed</a> = false, <a class="var it4085" onMouseOver="hilite(4085)" onMouseOut="lolite()" onClick="logVariable('new_avatar_upload')" href="../../../_variables/new_avatar_upload.html">$new_avatar_upload</a> = false )
<a name="l5921"><span class="linenum">5921</span></a>      {
<a name="l5922"><span class="linenum">5922</span></a>          if( ! <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() )
<a name="l5923"><span class="linenum">5923</span></a>          { // User must be logged in for this action
<a name="l5924"><span class="linenum">5924</span></a>              return;
<a name="l5925"><span class="linenum">5925</span></a>          }
<a name="l5926"><span class="linenum">5926</span></a>  
<a name="l5927"><span class="linenum">5927</span></a>          if( empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a> ) &amp;&amp; ( ! <a class="var it4039" onMouseOver="hilite(4039)" onMouseOut="lolite()" onClick="logVariable('avatar_changed')" href="../../../_variables/avatar_changed.html">$avatar_changed</a> ) &amp;&amp; ( ! <a class="var it4085" onMouseOver="hilite(4085)" onMouseOut="lolite()" onClick="logVariable('new_avatar_upload')" href="../../../_variables/new_avatar_upload.html">$new_avatar_upload</a> ) )
<a name="l5928"><span class="linenum">5928</span></a>          { // Nothing important was changed, so no need to send changed notification
<a name="l5929"><span class="linenum">5929</span></a>              return;
<a name="l5930"><span class="linenum">5930</span></a>          }
<a name="l5931"><span class="linenum">5931</span></a>  
<a name="l5932"><span class="linenum">5932</span></a>          <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> = array(
<a name="l5933"><span class="linenum">5933</span></a>                  'user_ID' =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>,
<a name="l5934"><span class="linenum">5934</span></a>                  'login'   =&gt; <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('login')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/login.html">login</a>,
<a name="l5935"><span class="linenum">5935</span></a>                  'fields'  =&gt; array(
<a name="l5936"><span class="linenum">5936</span></a>                      'login'     =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Login') ),
<a name="l5937"><span class="linenum">5937</span></a>                      'grp_ID'  =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Group'), 'className' =&gt; 'Group' ),
<a name="l5938"><span class="linenum">5938</span></a>                      'nickname'  =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Nickname') ),
<a name="l5939"><span class="linenum">5939</span></a>                      'firstname' =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('First name') ),
<a name="l5940"><span class="linenum">5940</span></a>                      'lastname'  =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Last name') ),
<a name="l5941"><span class="linenum">5941</span></a>                      'gender'    =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Gender') ),
<a name="l5942"><span class="linenum">5942</span></a>                      'ctry_ID'   =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Country'), 'className' =&gt; 'Country' ),
<a name="l5943"><span class="linenum">5943</span></a>                      'rgn_ID'    =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Region'), 'className' =&gt; 'Region' ),
<a name="l5944"><span class="linenum">5944</span></a>                      'subrg_ID'  =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('Sub-region'), 'className' =&gt; 'Subregion' ),
<a name="l5945"><span class="linenum">5945</span></a>                      'city_ID'   =&gt; array( 'title' =&gt; <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('City'), 'className' =&gt; 'City' ),
<a name="l5946"><span class="linenum">5946</span></a>                  ),
<a name="l5947"><span class="linenum">5947</span></a>                  'avatar_changed'    =&gt; <a class="var it4039" onMouseOver="hilite(4039)" onMouseOut="lolite()" onClick="logVariable('avatar_changed')" href="../../../_variables/avatar_changed.html">$avatar_changed</a>,
<a name="l5948"><span class="linenum">5948</span></a>                  'new_avatar_upload' =&gt; <a class="var it4085" onMouseOver="hilite(4085)" onMouseOut="lolite()" onClick="logVariable('new_avatar_upload')" href="../../../_variables/new_avatar_upload.html">$new_avatar_upload</a>,
<a name="l5949"><span class="linenum">5949</span></a>              );
<a name="l5950"><span class="linenum">5950</span></a>  
<a name="l5951"><span class="linenum">5951</span></a>          foreach( <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a>['fields'] as <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> =&gt; <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a> )
<a name="l5952"><span class="linenum">5952</span></a>          { // Set new and previous values for email template
<a name="l5953"><span class="linenum">5953</span></a>              <a class="var it4088" onMouseOver="hilite(4088)" onMouseOut="lolite()" onClick="logVariable('field_was_changed')" href="../../../_variables/field_was_changed.html">$field_was_changed</a> = ( isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a>[ <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> ] ) &amp;&amp; ( ! empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a>[ <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> ] ) ) );
<a name="l5954"><span class="linenum">5954</span></a>              if( isset( <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['className'] ) )
<a name="l5955"><span class="linenum">5955</span></a>              { // The field value is an object ID, get the object name
<a name="l5956"><span class="linenum">5956</span></a>                  <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('Cache')" href="../../../_variables/Cache.html">$Cache</a> = &amp; <a class="phpfunction" onClick="logFunction('call_user_func')" href="../../../_functions/call_user_func.html" onMouseOver="phpfuncPopup(event,'call_user_func')">call_user_func</a>( 'get_'.<a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['className'].'Cache' );
<a name="l5957"><span class="linenum">5957</span></a>                  <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a> = &amp; <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('Cache')" href="../../../_variables/Cache.html">$Cache</a>-&gt;get_by_ID( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> ), false, false );
<a name="l5958"><span class="linenum">5958</span></a>                  <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['new'] = empty( <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a> ) ? NULL : <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l5959"><span class="linenum">5959</span></a>                  if( <a class="var it4088" onMouseOver="hilite(4088)" onMouseOut="lolite()" onClick="logVariable('field_was_changed')" href="../../../_variables/field_was_changed.html">$field_was_changed</a> )
<a name="l5960"><span class="linenum">5960</span></a>                  { // Get the old display value of the field
<a name="l5961"><span class="linenum">5961</span></a>                      <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a> = &amp; <a class="var it111" onMouseOver="hilite(111)" onMouseOut="lolite()" onClick="logVariable('Cache')" href="../../../_variables/Cache.html">$Cache</a>-&gt;get_by_ID( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a>[ <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> ] );
<a name="l5962"><span class="linenum">5962</span></a>                      <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['old'] = <a class="var it3935" onMouseOver="hilite(3935)" onMouseOut="lolite()" onClick="logVariable('Object')" href="../../../_variables/Object.html">$Object</a>-&gt;<a class="function" onClick="logFunction('get_name')" href="../../../_functions/get_name.html" onMouseOver="funcPopup(event,'get_name')">get_name</a>();
<a name="l5963"><span class="linenum">5963</span></a>                  }
<a name="l5964"><span class="linenum">5964</span></a>              }
<a name="l5965"><span class="linenum">5965</span></a>              elseif( <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> == 'gender' )
<a name="l5966"><span class="linenum">5966</span></a>              { // This is the gender field, get the display name of the gender
<a name="l5967"><span class="linenum">5967</span></a>                  <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['new'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_gender')" href="../../../_functions/get_gender.html" onMouseOver="funcPopup(event,'get_gender')">get_gender</a>();
<a name="l5968"><span class="linenum">5968</span></a>                  if( <a class="var it4088" onMouseOver="hilite(4088)" onMouseOut="lolite()" onClick="logVariable('field_was_changed')" href="../../../_variables/field_was_changed.html">$field_was_changed</a> )
<a name="l5969"><span class="linenum">5969</span></a>                  {
<a name="l5970"><span class="linenum">5970</span></a>                      <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['old'] = ( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a>[ <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> ] == 'M' ) ? <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('A man') : <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('A woman');
<a name="l5971"><span class="linenum">5971</span></a>                  }
<a name="l5972"><span class="linenum">5972</span></a>              }
<a name="l5973"><span class="linenum">5973</span></a>              else
<a name="l5974"><span class="linenum">5974</span></a>              { // Get the field value
<a name="l5975"><span class="linenum">5975</span></a>                  <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['new'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> );
<a name="l5976"><span class="linenum">5976</span></a>                  if( <a class="var it4088" onMouseOver="hilite(4088)" onMouseOut="lolite()" onClick="logVariable('field_was_changed')" href="../../../_variables/field_was_changed.html">$field_was_changed</a> )
<a name="l5977"><span class="linenum">5977</span></a>                  { // The field was changed
<a name="l5978"><span class="linenum">5978</span></a>                      <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['old'] = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a>[ <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> ];
<a name="l5979"><span class="linenum">5979</span></a>                  }
<a name="l5980"><span class="linenum">5980</span></a>              }
<a name="l5981"><span class="linenum">5981</span></a>  
<a name="l5982"><span class="linenum">5982</span></a>              if( !isset( <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['old'] ) )
<a name="l5983"><span class="linenum">5983</span></a>              { // The field was not changed or the old value was empty
<a name="l5984"><span class="linenum">5984</span></a>                  <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['old'] = <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a> ) ? NULL : <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>['new'];
<a name="l5985"><span class="linenum">5985</span></a>              }
<a name="l5986"><span class="linenum">5986</span></a>  
<a name="l5987"><span class="linenum">5987</span></a>              <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a>['fields'][ <a class="var it4086" onMouseOver="hilite(4086)" onMouseOut="lolite()" onClick="logVariable('user_field_name')" href="../../../_variables/user_field_name.html">$user_field_name</a> ] = <a class="var it4087" onMouseOver="hilite(4087)" onMouseOut="lolite()" onClick="logVariable('user_field_data')" href="../../../_variables/user_field_data.html">$user_field_data</a>;
<a name="l5988"><span class="linenum">5988</span></a>          }
<a name="l5989"><span class="linenum">5989</span></a>  
<a name="l5990"><span class="linenum">5990</span></a>          <a class="function" onClick="logFunction('send_admin_notification')" href="../../../_functions/send_admin_notification.html" onMouseOver="funcPopup(event,'send_admin_notification')">send_admin_notification</a>( <a class="function" onClick="logFunction('NT_')" href="../../../_functions/nt_.html" onMouseOver="funcPopup(event,'nt_')">NT_</a>('User profile changed'), 'account_changed', <a class="var it1697" onMouseOver="hilite(1697)" onMouseOut="lolite()" onClick="logVariable('email_template_params')" href="../../../_variables/email_template_params.html">$email_template_params</a> );
<a name="l5991"><span class="linenum">5991</span></a>  <span class="comment">        // Clear changed values</span>
<a name="l5992"><span class="linenum">5992</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('significant_changed_values')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/significant_changed_values.html">significant_changed_values</a> = array();
<a name="l5993"><span class="linenum">5993</span></a>      }
<a name="l5994"><span class="linenum">5994</span></a>  
<a name="l5995"><span class="linenum">5995</span></a>  
<a name="l5996"><span class="linenum">5996</span></a>      <span class="comment">/**</span>
<a name="l5997"><span class="linenum">5997</span></a>  <span class="comment">     * Get organizations that user has selected</span>
<a name="l5998"><span class="linenum">5998</span></a>  <span class="comment">     *</span>
<a name="l5999"><span class="linenum">5999</span></a>  <span class="comment">     * @return array Organizations( key =&gt; org_ID, value =&gt; array( 'name', 'accepted', 'role' )</span>
<a name="l6000"><span class="linenum">6000</span></a>  <span class="comment">     */</span>
<a name="l6001"><span class="linenum">6001</span></a>  	function <a class="function" onClick="logFunction('get_organizations_data')" href="../../../_functions/get_organizations_data.html" onMouseOver="funcPopup(event,'get_organizations_data')">get_organizations_data</a>()
<a name="l6002"><span class="linenum">6002</span></a>      {
<a name="l6003"><span class="linenum">6003</span></a>          if( ! isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('organizations')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/organizations.html">organizations</a> ) )
<a name="l6004"><span class="linenum">6004</span></a>          { // Get the organizations from DB
<a name="l6005"><span class="linenum">6005</span></a>              global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l6006"><span class="linenum">6006</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l6007"><span class="linenum">6007</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'org_ID, org_name, uorg_accepted, uorg_role' );
<a name="l6008"><span class="linenum">6008</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users__user_org' );
<a name="l6009"><span class="linenum">6009</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_users__organization ON org_ID = uorg_org_ID' );
<a name="l6010"><span class="linenum">6010</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'uorg_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l6011"><span class="linenum">6011</span></a>              <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'uorg_accepted DESC, uorg_org_ID' );
<a name="l6012"><span class="linenum">6012</span></a>              <a class="var it3895" onMouseOver="hilite(3895)" onMouseOut="lolite()" onClick="logVariable('organizations')" href="../../../_variables/organizations.html">$organizations</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l6013"><span class="linenum">6013</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('organizations')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/organizations.html">organizations</a> = array();
<a name="l6014"><span class="linenum">6014</span></a>              foreach( <a class="var it3895" onMouseOver="hilite(3895)" onMouseOut="lolite()" onClick="logVariable('organizations')" href="../../../_variables/organizations.html">$organizations</a> as <a class="var it4089" onMouseOver="hilite(4089)" onMouseOut="lolite()" onClick="logVariable('organization')" href="../../../_variables/organization.html">$organization</a> )
<a name="l6015"><span class="linenum">6015</span></a>              {
<a name="l6016"><span class="linenum">6016</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('organizations')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/organizations.html">organizations</a>[ <a class="var it4089" onMouseOver="hilite(4089)" onMouseOut="lolite()" onClick="logVariable('organization')" href="../../../_variables/organization.html">$organization</a>-&gt;<a onClick="logVariable('org_ID')" class="var it10944" onMouseOver="hilite(10944)" onMouseOut="lolite()" href="../../../_variables/org_ID.html">org_ID</a> ] = array(
<a name="l6017"><span class="linenum">6017</span></a>                          'name'     =&gt; <a class="var it4089" onMouseOver="hilite(4089)" onMouseOut="lolite()" onClick="logVariable('organization')" href="../../../_variables/organization.html">$organization</a>-&gt;<a onClick="logVariable('org_name')" class="var it10944" onMouseOver="hilite(10944)" onMouseOut="lolite()" href="../../../_variables/org_name.html">org_name</a>,
<a name="l6018"><span class="linenum">6018</span></a>                          'accepted' =&gt; <a class="var it4089" onMouseOver="hilite(4089)" onMouseOut="lolite()" onClick="logVariable('organization')" href="../../../_variables/organization.html">$organization</a>-&gt;<a onClick="logVariable('uorg_accepted')" class="var it10944" onMouseOver="hilite(10944)" onMouseOut="lolite()" href="../../../_variables/uorg_accepted.html">uorg_accepted</a>,
<a name="l6019"><span class="linenum">6019</span></a>                          'role'     =&gt; <a class="var it4089" onMouseOver="hilite(4089)" onMouseOut="lolite()" onClick="logVariable('organization')" href="../../../_variables/organization.html">$organization</a>-&gt;<a onClick="logVariable('uorg_role')" class="var it10944" onMouseOver="hilite(10944)" onMouseOut="lolite()" href="../../../_variables/uorg_role.html">uorg_role</a>,
<a name="l6020"><span class="linenum">6020</span></a>                      );
<a name="l6021"><span class="linenum">6021</span></a>              }
<a name="l6022"><span class="linenum">6022</span></a>          }
<a name="l6023"><span class="linenum">6023</span></a>  
<a name="l6024"><span class="linenum">6024</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('organizations')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/organizations.html">organizations</a>;
<a name="l6025"><span class="linenum">6025</span></a>      }
<a name="l6026"><span class="linenum">6026</span></a>  
<a name="l6027"><span class="linenum">6027</span></a>  
<a name="l6028"><span class="linenum">6028</span></a>      <span class="comment">/**</span>
<a name="l6029"><span class="linenum">6029</span></a>  <span class="comment">     * Get organizations that are accepted for this user</span>
<a name="l6030"><span class="linenum">6030</span></a>  <span class="comment">     *</span>
<a name="l6031"><span class="linenum">6031</span></a>  <span class="comment">     * @return array Organizations: array( 'name', 'url' )</span>
<a name="l6032"><span class="linenum">6032</span></a>  <span class="comment">     */</span>
<a name="l6033"><span class="linenum">6033</span></a>  	function <a class="function" onClick="logFunction('get_organizations')" href="../../../_functions/get_organizations.html" onMouseOver="funcPopup(event,'get_organizations')">get_organizations</a>()
<a name="l6034"><span class="linenum">6034</span></a>      {
<a name="l6035"><span class="linenum">6035</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l6036"><span class="linenum">6036</span></a>  
<a name="l6037"><span class="linenum">6037</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l6038"><span class="linenum">6038</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( 'org_name AS name, org_url AS url' );
<a name="l6039"><span class="linenum">6039</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_users__user_org' );
<a name="l6040"><span class="linenum">6040</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM_add')" href="../../../_functions/from_add.html" onMouseOver="funcPopup(event,'from_add')">FROM_add</a>( 'INNER JOIN T_users__organization ON org_ID = uorg_org_ID' );
<a name="l6041"><span class="linenum">6041</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'uorg_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l6042"><span class="linenum">6042</span></a>  <span class="comment">        // Organization must be accepted by Admin</span>
<a name="l6043"><span class="linenum">6043</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE_and')" href="../../../_functions/where_and.html" onMouseOver="funcPopup(event,'where_and')">WHERE_and</a>( 'uorg_accepted = 1' );
<a name="l6044"><span class="linenum">6044</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('ORDER_BY')" href="../../../_functions/order_by.html" onMouseOver="funcPopup(event,'order_by')">ORDER_BY</a>( 'org_name' );
<a name="l6045"><span class="linenum">6045</span></a>  
<a name="l6046"><span class="linenum">6046</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_results')" href="../../../_functions/get_results.html" onMouseOver="funcPopup(event,'get_results')">get_results</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l6047"><span class="linenum">6047</span></a>      }
<a name="l6048"><span class="linenum">6048</span></a>  
<a name="l6049"><span class="linenum">6049</span></a>  
<a name="l6050"><span class="linenum">6050</span></a>      <span class="comment">/**</span>
<a name="l6051"><span class="linenum">6051</span></a>  <span class="comment">     * Update user's organizations in DB</span>
<a name="l6052"><span class="linenum">6052</span></a>  <span class="comment">     *</span>
<a name="l6053"><span class="linenum">6053</span></a>  <span class="comment">     * @param array Organization IDs</span>
<a name="l6054"><span class="linenum">6054</span></a>  <span class="comment">     * @param array Organization roles</span>
<a name="l6055"><span class="linenum">6055</span></a>  <span class="comment">     * @param boolean TRUE to auto accept user to organization (Used on install demo users)</span>
<a name="l6056"><span class="linenum">6056</span></a>  <span class="comment">     */</span>
<a name="l6057"><span class="linenum">6057</span></a>  	function <a class="function" onClick="logFunction('update_organizations')" href="../../../_functions/update_organizations.html" onMouseOver="funcPopup(event,'update_organizations')">update_organizations</a>( <a class="var it4093" onMouseOver="hilite(4093)" onMouseOut="lolite()" onClick="logVariable('organization_IDs')" href="../../../_variables/organization_IDs.html">$organization_IDs</a>, <a class="var it4094" onMouseOver="hilite(4094)" onMouseOut="lolite()" onClick="logVariable('organization_roles')" href="../../../_variables/organization_roles.html">$organization_roles</a> = array(), <a class="var it4095" onMouseOver="hilite(4095)" onMouseOut="lolite()" onClick="logVariable('force_accept')" href="../../../_variables/force_accept.html">$force_accept</a> = false )
<a name="l6058"><span class="linenum">6058</span></a>      {
<a name="l6059"><span class="linenum">6059</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>;
<a name="l6060"><span class="linenum">6060</span></a>  
<a name="l6061"><span class="linenum">6061</span></a>          <a class="var it2580" onMouseOver="hilite(2580)" onMouseOut="lolite()" onClick="logVariable('perm_edit_users')" href="../../../_variables/perm_edit_users.html">$perm_edit_users</a> = ( <a class="function" onClick="logFunction('is_logged_in')" href="../../../_functions/is_logged_in.html" onMouseOver="funcPopup(event,'is_logged_in')">is_logged_in</a>() &amp;&amp; <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>-&gt;<a class="function" onClick="logFunction('check_perm')" href="../../../_functions/check_perm.html" onMouseOver="funcPopup(event,'check_perm')">check_perm</a>( 'users', 'edit' ) );
<a name="l6062"><span class="linenum">6062</span></a>  
<a name="l6063"><span class="linenum">6063</span></a>          <a class="var it4096" onMouseOver="hilite(4096)" onMouseOut="lolite()" onClick="logVariable('curr_orgs')" href="../../../_variables/curr_orgs.html">$curr_orgs</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_organizations_data')" href="../../../_functions/get_organizations_data.html" onMouseOver="funcPopup(event,'get_organizations_data')">get_organizations_data</a>();
<a name="l6064"><span class="linenum">6064</span></a>          <a class="var it4097" onMouseOver="hilite(4097)" onMouseOut="lolite()" onClick="logVariable('curr_org_IDs')" href="../../../_variables/curr_org_IDs.html">$curr_org_IDs</a> = <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it4096" onMouseOver="hilite(4096)" onMouseOut="lolite()" onClick="logVariable('curr_orgs')" href="../../../_variables/curr_orgs.html">$curr_orgs</a> );
<a name="l6065"><span class="linenum">6065</span></a>          <a class="var it4098" onMouseOver="hilite(4098)" onMouseOut="lolite()" onClick="logVariable('insert_orgs')" href="../../../_variables/insert_orgs.html">$insert_orgs</a> = array();
<a name="l6066"><span class="linenum">6066</span></a>          <a class="var it674" onMouseOver="hilite(674)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a> = 0;
<a name="l6067"><span class="linenum">6067</span></a>          foreach( <a class="var it4093" onMouseOver="hilite(4093)" onMouseOut="lolite()" onClick="logVariable('organization_IDs')" href="../../../_variables/organization_IDs.html">$organization_IDs</a> as <a class="var it1201" onMouseOver="hilite(1201)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../../_variables/o.html">$o</a> =&gt; <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> )
<a name="l6068"><span class="linenum">6068</span></a>          {
<a name="l6069"><span class="linenum">6069</span></a>              <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> = <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> );
<a name="l6070"><span class="linenum">6070</span></a>              if( empty( <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> ) )
<a name="l6071"><span class="linenum">6071</span></a>              { // Organization is not selected, Skip it
<a name="l6072"><span class="linenum">6072</span></a>                  continue;
<a name="l6073"><span class="linenum">6073</span></a>              }
<a name="l6074"><span class="linenum">6074</span></a>              if( <a class="phpfunction" onClick="logFunction('in_array')" href="../../../_functions/in_array.html" onMouseOver="phpfuncPopup(event,'in_array')">in_array</a>( <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a>, <a class="var it4097" onMouseOver="hilite(4097)" onMouseOut="lolite()" onClick="logVariable('curr_org_IDs')" href="../../../_variables/curr_org_IDs.html">$curr_org_IDs</a> ) )
<a name="l6075"><span class="linenum">6075</span></a>              { // User is already in this organization
<a name="l6076"><span class="linenum">6076</span></a>                  if( <a class="var it2580" onMouseOver="hilite(2580)" onMouseOut="lolite()" onClick="logVariable('perm_edit_users')" href="../../../_variables/perm_edit_users.html">$perm_edit_users</a> || ! <a class="var it4096" onMouseOver="hilite(4096)" onMouseOut="lolite()" onClick="logVariable('curr_orgs')" href="../../../_variables/curr_orgs.html">$curr_orgs</a>[ <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> ]['accepted'] )
<a name="l6077"><span class="linenum">6077</span></a>                  { // Update if current user has permission or it is not accepted yet by admin
<a name="l6078"><span class="linenum">6078</span></a>                      <a class="var it4098" onMouseOver="hilite(4098)" onMouseOut="lolite()" onClick="logVariable('insert_orgs')" href="../../../_variables/insert_orgs.html">$insert_orgs</a>[ <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> ] = ( empty( <a class="var it4094" onMouseOver="hilite(4094)" onMouseOut="lolite()" onClick="logVariable('organization_roles')" href="../../../_variables/organization_roles.html">$organization_roles</a>[ <a class="var it674" onMouseOver="hilite(674)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a> ] ) ? NULL : <a class="var it4094" onMouseOver="hilite(4094)" onMouseOut="lolite()" onClick="logVariable('organization_roles')" href="../../../_variables/organization_roles.html">$organization_roles</a>[ <a class="var it674" onMouseOver="hilite(674)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a> ] );
<a name="l6079"><span class="linenum">6079</span></a>                      <a class="var it674" onMouseOver="hilite(674)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a>++;
<a name="l6080"><span class="linenum">6080</span></a>                  }
<a name="l6081"><span class="linenum">6081</span></a>                  else
<a name="l6082"><span class="linenum">6082</span></a>                  { // Don't updated by current user
<a name="l6083"><span class="linenum">6083</span></a>                      <a class="var it4098" onMouseOver="hilite(4098)" onMouseOut="lolite()" onClick="logVariable('insert_orgs')" href="../../../_variables/insert_orgs.html">$insert_orgs</a>[ <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> ] = <a class="var it4096" onMouseOver="hilite(4096)" onMouseOut="lolite()" onClick="logVariable('curr_orgs')" href="../../../_variables/curr_orgs.html">$curr_orgs</a>[ <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> ]['role'];
<a name="l6084"><span class="linenum">6084</span></a>                  }
<a name="l6085"><span class="linenum">6085</span></a>              }
<a name="l6086"><span class="linenum">6086</span></a>              else
<a name="l6087"><span class="linenum">6087</span></a>              { // Insert user in <span class="keyword">new </span><a class="class" onClick="logClass('organization')" href="../../../_classes/organization.html" onMouseOver="classPopup(event,'organization')">organization</a>
<a name="l6088"><span class="linenum">6088</span></a>                  <a class="var it4098" onMouseOver="hilite(4098)" onMouseOut="lolite()" onClick="logVariable('insert_orgs')" href="../../../_variables/insert_orgs.html">$insert_orgs</a>[ <a class="var it4099" onMouseOver="hilite(4099)" onMouseOut="lolite()" onClick="logVariable('organization_ID')" href="../../../_variables/organization_ID.html">$organization_ID</a> ] = ( empty( <a class="var it4094" onMouseOver="hilite(4094)" onMouseOut="lolite()" onClick="logVariable('organization_roles')" href="../../../_variables/organization_roles.html">$organization_roles</a>[ <a class="var it674" onMouseOver="hilite(674)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a> ] ) ? NULL : <a class="var it4094" onMouseOver="hilite(4094)" onMouseOut="lolite()" onClick="logVariable('organization_roles')" href="../../../_variables/organization_roles.html">$organization_roles</a>[ <a class="var it674" onMouseOver="hilite(674)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a> ] );
<a name="l6089"><span class="linenum">6089</span></a>                  <a class="var it674" onMouseOver="hilite(674)" onMouseOut="lolite()" onClick="logVariable('n')" href="../../../_variables/n.html">$n</a>++;
<a name="l6090"><span class="linenum">6090</span></a>              }
<a name="l6091"><span class="linenum">6091</span></a>          }
<a name="l6092"><span class="linenum">6092</span></a>  
<a name="l6093"><span class="linenum">6093</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4098" onMouseOver="hilite(4098)" onMouseOut="lolite()" onClick="logVariable('insert_orgs')" href="../../../_variables/insert_orgs.html">$insert_orgs</a> ) &gt; 0 )
<a name="l6094"><span class="linenum">6094</span></a>          { // Insert new records with user-org relations
<a name="l6095"><span class="linenum">6095</span></a>              <a class="var it4100" onMouseOver="hilite(4100)" onMouseOut="lolite()" onClick="logVariable('insert_org_SQL')" href="../../../_variables/insert_org_SQL.html">$insert_org_SQL</a> = 'REPLACE INTO T_users__user_org ( uorg_user_ID, uorg_org_ID, uorg_accepted, uorg_role ) VALUES ';
<a name="l6096"><span class="linenum">6096</span></a>              <a class="var it1201" onMouseOver="hilite(1201)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../../_variables/o.html">$o</a> = 0;
<a name="l6097"><span class="linenum">6097</span></a>              foreach( <a class="var it4098" onMouseOver="hilite(4098)" onMouseOut="lolite()" onClick="logVariable('insert_orgs')" href="../../../_variables/insert_orgs.html">$insert_orgs</a> as <a class="var it4101" onMouseOver="hilite(4101)" onMouseOut="lolite()" onClick="logVariable('insert_org_ID')" href="../../../_variables/insert_org_ID.html">$insert_org_ID</a> =&gt; <a class="var it4102" onMouseOver="hilite(4102)" onMouseOut="lolite()" onClick="logVariable('insert_org_role')" href="../../../_variables/insert_org_role.html">$insert_org_role</a> )
<a name="l6098"><span class="linenum">6098</span></a>              {
<a name="l6099"><span class="linenum">6099</span></a>                  if( isset( <a class="var it4096" onMouseOver="hilite(4096)" onMouseOut="lolite()" onClick="logVariable('curr_orgs')" href="../../../_variables/curr_orgs.html">$curr_orgs</a>[ <a class="var it4101" onMouseOver="hilite(4101)" onMouseOut="lolite()" onClick="logVariable('insert_org_ID')" href="../../../_variables/insert_org_ID.html">$insert_org_ID</a> ] ) )
<a name="l6100"><span class="linenum">6100</span></a>                  { // If we are updating - Don't change the accept status
<a name="l6101"><span class="linenum">6101</span></a>                      <a class="var it4103" onMouseOver="hilite(4103)" onMouseOut="lolite()" onClick="logVariable('insert_orgs_accepted')" href="../../../_variables/insert_orgs_accepted.html">$insert_orgs_accepted</a> = <a class="var it4096" onMouseOver="hilite(4096)" onMouseOut="lolite()" onClick="logVariable('curr_orgs')" href="../../../_variables/curr_orgs.html">$curr_orgs</a>[ <a class="var it4101" onMouseOver="hilite(4101)" onMouseOut="lolite()" onClick="logVariable('insert_org_ID')" href="../../../_variables/insert_org_ID.html">$insert_org_ID</a> ]['accepted'];
<a name="l6102"><span class="linenum">6102</span></a>                  }
<a name="l6103"><span class="linenum">6103</span></a>                  else
<a name="l6104"><span class="linenum">6104</span></a>                  { // If we are inserting - Set the accept status depends on user perms or func params
<a name="l6105"><span class="linenum">6105</span></a>                      <a class="var it4103" onMouseOver="hilite(4103)" onMouseOut="lolite()" onClick="logVariable('insert_orgs_accepted')" href="../../../_variables/insert_orgs_accepted.html">$insert_orgs_accepted</a> = '0';
<a name="l6106"><span class="linenum">6106</span></a>                      if( <a class="var it4095" onMouseOver="hilite(4095)" onMouseOut="lolite()" onClick="logVariable('force_accept')" href="../../../_variables/force_accept.html">$force_accept</a> || <a class="var it2580" onMouseOver="hilite(2580)" onMouseOut="lolite()" onClick="logVariable('perm_edit_users')" href="../../../_variables/perm_edit_users.html">$perm_edit_users</a> )
<a name="l6107"><span class="linenum">6107</span></a>                      { // If admin adds <span class="keyword">new </span><a class="class" onClick="logClass('organization')" href="../../../_classes/organization.html" onMouseOver="classPopup(event,'organization')">organization</a> for other users and for himself, it must be autoaccepted
<a name="l6108"><span class="linenum">6108</span></a>                          <a class="var it4103" onMouseOver="hilite(4103)" onMouseOut="lolite()" onClick="logVariable('insert_orgs_accepted')" href="../../../_variables/insert_orgs_accepted.html">$insert_orgs_accepted</a> = '1';
<a name="l6109"><span class="linenum">6109</span></a>                      }
<a name="l6110"><span class="linenum">6110</span></a>                  }
<a name="l6111"><span class="linenum">6111</span></a>                  if( <a class="var it1201" onMouseOver="hilite(1201)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../../_variables/o.html">$o</a> &gt; 0 )
<a name="l6112"><span class="linenum">6112</span></a>                  { // separator
<a name="l6113"><span class="linenum">6113</span></a>                      <a class="var it4100" onMouseOver="hilite(4100)" onMouseOut="lolite()" onClick="logVariable('insert_org_SQL')" href="../../../_variables/insert_org_SQL.html">$insert_org_SQL</a> .= ', ';
<a name="l6114"><span class="linenum">6114</span></a>                  }
<a name="l6115"><span class="linenum">6115</span></a>                  <a class="var it4100" onMouseOver="hilite(4100)" onMouseOut="lolite()" onClick="logVariable('insert_org_SQL')" href="../../../_variables/insert_org_SQL.html">$insert_org_SQL</a> .= '( '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4101" onMouseOver="hilite(4101)" onMouseOut="lolite()" onClick="logVariable('insert_org_ID')" href="../../../_variables/insert_org_ID.html">$insert_org_ID</a> ).', '.<a class="var it4103" onMouseOver="hilite(4103)" onMouseOut="lolite()" onClick="logVariable('insert_orgs_accepted')" href="../../../_variables/insert_orgs_accepted.html">$insert_orgs_accepted</a>.', '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it4102" onMouseOver="hilite(4102)" onMouseOut="lolite()" onClick="logVariable('insert_org_role')" href="../../../_variables/insert_org_role.html">$insert_org_role</a> ).' )';
<a name="l6116"><span class="linenum">6116</span></a>                  <a class="var it1201" onMouseOver="hilite(1201)" onMouseOut="lolite()" onClick="logVariable('o')" href="../../../_variables/o.html">$o</a>++;
<a name="l6117"><span class="linenum">6117</span></a>              }
<a name="l6118"><span class="linenum">6118</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it4100" onMouseOver="hilite(4100)" onMouseOut="lolite()" onClick="logVariable('insert_org_SQL')" href="../../../_variables/insert_org_SQL.html">$insert_org_SQL</a> );
<a name="l6119"><span class="linenum">6119</span></a>          }
<a name="l6120"><span class="linenum">6120</span></a>  
<a name="l6121"><span class="linenum">6121</span></a>          <a class="var it4104" onMouseOver="hilite(4104)" onMouseOut="lolite()" onClick="logVariable('delete_org_IDs')" href="../../../_variables/delete_org_IDs.html">$delete_org_IDs</a> = <a class="phpfunction" onClick="logFunction('array_diff')" href="../../../_functions/array_diff.html" onMouseOver="phpfuncPopup(event,'array_diff')">array_diff</a>( <a class="var it4097" onMouseOver="hilite(4097)" onMouseOut="lolite()" onClick="logVariable('curr_org_IDs')" href="../../../_variables/curr_org_IDs.html">$curr_org_IDs</a>, <a class="phpfunction" onClick="logFunction('array_keys')" href="../../../_functions/array_keys.html" onMouseOver="phpfuncPopup(event,'array_keys')">array_keys</a>( <a class="var it4098" onMouseOver="hilite(4098)" onMouseOut="lolite()" onClick="logVariable('insert_orgs')" href="../../../_variables/insert_orgs.html">$insert_orgs</a> ) );
<a name="l6122"><span class="linenum">6122</span></a>          if( <a class="phpfunction" onClick="logFunction('count')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">count</a>( <a class="var it4104" onMouseOver="hilite(4104)" onMouseOut="lolite()" onClick="logVariable('delete_org_IDs')" href="../../../_variables/delete_org_IDs.html">$delete_org_IDs</a> ) &gt; 0 )
<a name="l6123"><span class="linenum">6123</span></a>          { // Delete old records that were replaced with new
<a name="l6124"><span class="linenum">6124</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_users__user_org
<a name="l6125"><span class="linenum">6125</span></a>                  WHERE uorg_user_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'
<a name="l6126"><span class="linenum">6126</span></a>                      AND uorg_org_ID IN ( '.<a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it4104" onMouseOver="hilite(4104)" onMouseOut="lolite()" onClick="logVariable('delete_org_IDs')" href="../../../_variables/delete_org_IDs.html">$delete_org_IDs</a> ).' )' );
<a name="l6127"><span class="linenum">6127</span></a>          }
<a name="l6128"><span class="linenum">6128</span></a>      }
<a name="l6129"><span class="linenum">6129</span></a>  
<a name="l6130"><span class="linenum">6130</span></a>  
<a name="l6131"><span class="linenum">6131</span></a>      <span class="comment">/**</span>
<a name="l6132"><span class="linenum">6132</span></a>  <span class="comment">     * Get user name depending on general setting 'username_display'</span>
<a name="l6133"><span class="linenum">6133</span></a>  <span class="comment">     *</span>
<a name="l6134"><span class="linenum">6134</span></a>  <span class="comment">     * @param string Output format, see {@link format_to_output()}</span>
<a name="l6135"><span class="linenum">6135</span></a>  <span class="comment">     * @return string Login or preferred name</span>
<a name="l6136"><span class="linenum">6136</span></a>  <span class="comment">     */</span>
<a name="l6137"><span class="linenum">6137</span></a>  	function <a class="function" onClick="logFunction('get_username')" href="../../../_functions/get_username.html" onMouseOver="funcPopup(event,'get_username')">get_username</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> = NULL )
<a name="l6138"><span class="linenum">6138</span></a>      {
<a name="l6139"><span class="linenum">6139</span></a>          global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l6140"><span class="linenum">6140</span></a>  
<a name="l6141"><span class="linenum">6141</span></a>          if( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'username_display' ) == 'name' )
<a name="l6142"><span class="linenum">6142</span></a>          { // Get nickname or fullname
<a name="l6143"><span class="linenum">6143</span></a>              <a class="var it4105" onMouseOver="hilite(4105)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../../_variables/username.html">$username</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get_preferred_name')" href="../../../_functions/get_preferred_name.html" onMouseOver="funcPopup(event,'get_preferred_name')">get_preferred_name</a>();
<a name="l6144"><span class="linenum">6144</span></a>          }
<a name="l6145"><span class="linenum">6145</span></a>          else
<a name="l6146"><span class="linenum">6146</span></a>          { // Get login
<a name="l6147"><span class="linenum">6147</span></a>              <a class="var it4105" onMouseOver="hilite(4105)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../../_variables/username.html">$username</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'login' );
<a name="l6148"><span class="linenum">6148</span></a>          }
<a name="l6149"><span class="linenum">6149</span></a>  
<a name="l6150"><span class="linenum">6150</span></a>          if( ! <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> ) )
<a name="l6151"><span class="linenum">6151</span></a>          { // Format output string
<a name="l6152"><span class="linenum">6152</span></a>              <a class="var it4105" onMouseOver="hilite(4105)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../../_variables/username.html">$username</a> = <a class="function" onClick="logFunction('format_to_output')" href="../../../_functions/format_to_output.html" onMouseOver="funcPopup(event,'format_to_output')">format_to_output</a>( <a class="var it4105" onMouseOver="hilite(4105)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../../_variables/username.html">$username</a>, <a class="var it1437" onMouseOver="hilite(1437)" onMouseOut="lolite()" onClick="logVariable('format')" href="../../../_variables/format.html">$format</a> );
<a name="l6153"><span class="linenum">6153</span></a>          }
<a name="l6154"><span class="linenum">6154</span></a>  
<a name="l6155"><span class="linenum">6155</span></a>          return <a class="var it4105" onMouseOver="hilite(4105)" onMouseOut="lolite()" onClick="logVariable('username')" href="../../../_variables/username.html">$username</a>;
<a name="l6156"><span class="linenum">6156</span></a>      }
<a name="l6157"><span class="linenum">6157</span></a>  
<a name="l6158"><span class="linenum">6158</span></a>  
<a name="l6159"><span class="linenum">6159</span></a>      <span class="comment">/**</span>
<a name="l6160"><span class="linenum">6160</span></a>  <span class="comment">     * Calculate how much days user has after registration</span>
<a name="l6161"><span class="linenum">6161</span></a>  <span class="comment">     *</span>
<a name="l6162"><span class="linenum">6162</span></a>  <span class="comment">     * @return float</span>
<a name="l6163"><span class="linenum">6163</span></a>  <span class="comment">     */</span>
<a name="l6164"><span class="linenum">6164</span></a>  	function <a class="function" onClick="logFunction('get_days_count_close')" href="../../../_functions/get_days_count_close.html" onMouseOver="funcPopup(event,'get_days_count_close')">get_days_count_close</a>()
<a name="l6165"><span class="linenum">6165</span></a>      {
<a name="l6166"><span class="linenum">6166</span></a>          <a class="var it4106" onMouseOver="hilite(4106)" onMouseOut="lolite()" onClick="logVariable('date_start')" href="../../../_variables/date_start.html">$date_start</a> = <a class="phpfunction" onClick="logFunction('strtotime')" href="../../../_functions/strtotime.html" onMouseOver="phpfuncPopup(event,'strtotime')">strtotime</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('datecreated')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/datecreated.html">datecreated</a> );
<a name="l6167"><span class="linenum">6167</span></a>          <a class="var it4107" onMouseOver="hilite(4107)" onMouseOut="lolite()" onClick="logVariable('date_end')" href="../../../_variables/date_end.html">$date_end</a> = <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>();
<a name="l6168"><span class="linenum">6168</span></a>          <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('days')" href="../../../_variables/days.html">$days</a> = ( <a class="var it4107" onMouseOver="hilite(4107)" onMouseOut="lolite()" onClick="logVariable('date_end')" href="../../../_variables/date_end.html">$date_end</a> - <a class="var it4106" onMouseOver="hilite(4106)" onMouseOut="lolite()" onClick="logVariable('date_start')" href="../../../_variables/date_start.html">$date_start</a> ) / 86400;
<a name="l6169"><span class="linenum">6169</span></a>  
<a name="l6170"><span class="linenum">6170</span></a>          return <a class="phpfunction" onClick="logFunction('number_format')" href="../../../_functions/number_format.html" onMouseOver="phpfuncPopup(event,'number_format')">number_format</a>( <a class="var it528" onMouseOver="hilite(528)" onMouseOut="lolite()" onClick="logVariable('days')" href="../../../_variables/days.html">$days</a>, 1, '.', '' );
<a name="l6171"><span class="linenum">6171</span></a>      }
<a name="l6172"><span class="linenum">6172</span></a>  
<a name="l6173"><span class="linenum">6173</span></a>  
<a name="l6174"><span class="linenum">6174</span></a>      <span class="comment">/**</span>
<a name="l6175"><span class="linenum">6175</span></a>  <span class="comment">     * Get count of own blogs of the user</span>
<a name="l6176"><span class="linenum">6176</span></a>  <span class="comment">     *</span>
<a name="l6177"><span class="linenum">6177</span></a>  <span class="comment">     * @return integer</span>
<a name="l6178"><span class="linenum">6178</span></a>  <span class="comment">     */</span>
<a name="l6179"><span class="linenum">6179</span></a>  	function <a class="function" onClick="logFunction('get_own_blogs_count')" href="../../../_functions/get_own_blogs_count.html" onMouseOver="funcPopup(event,'get_own_blogs_count')">get_own_blogs_count</a>()
<a name="l6180"><span class="linenum">6180</span></a>      {
<a name="l6181"><span class="linenum">6181</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l6182"><span class="linenum">6182</span></a>  
<a name="l6183"><span class="linenum">6183</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a> = <span class="keyword">new </span><a class="class" onClick="logClass('SQL')" href="../../../_classes/sql.html" onMouseOver="classPopup(event,'sql')">SQL</a>();
<a name="l6184"><span class="linenum">6184</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('SELECT')" href="../../../_functions/select.html" onMouseOver="funcPopup(event,'select')">SELECT</a>( '<a class="phpfunction" onClick="logFunction('COUNT')" href="../../../_functions/count.html" onMouseOver="phpfuncPopup(event,'count')">COUNT</a>( blog_ID )' );
<a name="l6185"><span class="linenum">6185</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('FROM')" href="../../../_functions/from.html" onMouseOver="funcPopup(event,'from')">FROM</a>( 'T_blogs' );
<a name="l6186"><span class="linenum">6186</span></a>          <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('WHERE')" href="../../../_functions/where.html" onMouseOver="funcPopup(event,'where')">WHERE</a>( 'blog_owner_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) );
<a name="l6187"><span class="linenum">6187</span></a>  
<a name="l6188"><span class="linenum">6188</span></a>          return <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( <a class="var it108" onMouseOver="hilite(108)" onMouseOut="lolite()" onClick="logVariable('SQL')" href="../../../_variables/SQL.html">$SQL</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>() );
<a name="l6189"><span class="linenum">6189</span></a>      }
<a name="l6190"><span class="linenum">6190</span></a>  
<a name="l6191"><span class="linenum">6191</span></a>  
<a name="l6192"><span class="linenum">6192</span></a>      <span class="comment">/**</span>
<a name="l6193"><span class="linenum">6193</span></a>  <span class="comment">     * Check if user must accept terms &amp; conditions</span>
<a name="l6194"><span class="linenum">6194</span></a>  <span class="comment">     *</span>
<a name="l6195"><span class="linenum">6195</span></a>  <span class="comment">     * @return boolean</span>
<a name="l6196"><span class="linenum">6196</span></a>  <span class="comment">     */</span>
<a name="l6197"><span class="linenum">6197</span></a>  	function <a class="function" onClick="logFunction('must_accept_terms')" href="../../../_functions/must_accept_terms.html" onMouseOver="funcPopup(event,'must_accept_terms')">must_accept_terms</a>()
<a name="l6198"><span class="linenum">6198</span></a>      {
<a name="l6199"><span class="linenum">6199</span></a>          global <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>;
<a name="l6200"><span class="linenum">6200</span></a>  
<a name="l6201"><span class="linenum">6201</span></a>          if( <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'terms_accepted', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> ) )
<a name="l6202"><span class="linenum">6202</span></a>          {    // This user already accepted the terms:
<a name="l6203"><span class="linenum">6203</span></a>              return false;
<a name="l6204"><span class="linenum">6204</span></a>          }
<a name="l6205"><span class="linenum">6205</span></a>  
<a name="l6206"><span class="linenum">6206</span></a>  <span class="comment">        // Get ID of page with terms &amp; conditions from global settings:</span>
<a name="l6207"><span class="linenum">6207</span></a>          <a class="var it4108" onMouseOver="hilite(4108)" onMouseOut="lolite()" onClick="logVariable('terms_page_ID')" href="../../../_variables/terms_page_ID.html">$terms_page_ID</a> = <a class="phpfunction" onClick="logFunction('intval')" href="../../../_functions/intval.html" onMouseOver="phpfuncPopup(event,'intval')">intval</a>( <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'site_terms' ) );
<a name="l6208"><span class="linenum">6208</span></a>  
<a name="l6209"><span class="linenum">6209</span></a>          <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a> = &amp; get_ItemCache();
<a name="l6210"><span class="linenum">6210</span></a>          if( <a class="var it4108" onMouseOver="hilite(4108)" onMouseOut="lolite()" onClick="logVariable('terms_page_ID')" href="../../../_variables/terms_page_ID.html">$terms_page_ID</a> &amp;&amp; <a class="var it4109" onMouseOver="hilite(4109)" onMouseOut="lolite()" onClick="logVariable('terms_Item')" href="../../../_variables/terms_Item.html">$terms_Item</a> = &amp; <a class="var it389" onMouseOver="hilite(389)" onMouseOut="lolite()" onClick="logVariable('ItemCache')" href="../../../_variables/ItemCache.html">$ItemCache</a>-&gt;get_by_ID( <a class="var it4108" onMouseOver="hilite(4108)" onMouseOut="lolite()" onClick="logVariable('terms_page_ID')" href="../../../_variables/terms_page_ID.html">$terms_page_ID</a>, false, false ) )
<a name="l6211"><span class="linenum">6211</span></a>          {    // The post for terms is defined and user still must accept it:
<a name="l6212"><span class="linenum">6212</span></a>              return true;
<a name="l6213"><span class="linenum">6213</span></a>          }
<a name="l6214"><span class="linenum">6214</span></a>          else
<a name="l6215"><span class="linenum">6215</span></a>          {    // No terms for this site:
<a name="l6216"><span class="linenum">6216</span></a>              return false;
<a name="l6217"><span class="linenum">6217</span></a>          }
<a name="l6218"><span class="linenum">6218</span></a>      }
<a name="l6219"><span class="linenum">6219</span></a>  }
<a name="l6220"><span class="linenum">6220</span></a>  
<a name="l6221"><span class="linenum">6221</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'param_check_interval': ['param_check_interval', 'Check for interval params ', [['inc/_core','_param.funcs.php',594]], 2],
'limit': ['limit', '', [['inc/_core/model/db','_sql.class.php',343]], 30],
'display_user_email_status_message': ['display_user_email_status_message', 'Display message depending on user email status ', [['inc/users/model','_user.funcs.php',4045]], 7],
'get_media_url': ['get_media_url', 'Get the URL to the media folder ', [['inc/users/model','_user.class.php',1878],['inc/collections/model','_blog.class.php',1712]], 8],
'get_deleted_posts': ['get_deleted_posts', 'Get the posts of this user which current user can delete ', [['inc/users/model','_user.class.php',5289]], 5],
'send_easy_validate_emails': ['send_easy_validate_emails', 'Send account validation email with a permanent validation link ', [['inc/users/model','_user.funcs.php',2597]], 2],
'get_user_identity_url': ['get_user_identity_url', 'Get the available user display url ', [['inc/users/model','_user.funcs.php',1067]], 8],
'userfield_update': ['userfield_update', 'Update an user field. Empty fields will be deleted on dbupdate. ', [['inc/users/model','_user.class.php',4171]], 3],
'delete_messages': ['delete_messages', 'Delete private messaged of the user ', [['inc/users/model','_user.class.php',5484]], 3],
'setgroup': ['setgroup', '', [['inc/users/model','_user.class.php',2192]], 1],
'db_delete_where': ['db_delete_where', 'Delete the given class objects from the database which corresponds to the given condition or to the given ids array This function must be overriden on those classes where the db delete requires some updates on other table content or some files/folders delete. Note: the delete cascade arrays are handled! Delete cascades are handled recursively only if the cascade arrays from the reffering class contains the class and class_path params ( e.g. see User class )! ', [['inc/_core/model/dataobjects','_dataobject.class.php',175],['inc/users/model','_user.class.php',3308],['inc/messaging/model','_message.class.php',503],['inc/sessions/model','_session.class.php',281],['inc/comments/model','_comment.class.php',290]], 11],
'dataobject': ['dataobject', 'Constructor ', [['inc/_core/model/dataobjects','_dataobject.class.php',65]], 35],
'url': ['url', 'Template function: display user\'s URL ', [['inc/users/model','_user.class.php',3688]], 604],
'icq': ['icq', 'Template function: display ICQ of the user ', [['inc/users/model','_user.class.php',3803]], 0],
'where_and': ['where_and', 'Extends the WHERE clause with AND ', [['inc/_core/model/db','_sql.class.php',247]], 369],
'evo_mkdir': ['evo_mkdir', 'Create a directory ', [['inc/files/model','_file.funcs.php',978]], 14],
'get_row': ['get_row', 'Get one row from the DB. ', [['inc/_core/model/db','_db.class.php',987]], 60],
'is_image': ['is_image', 'Is the File an image? ', [['inc/files/model','_file.class.php',460]], 28],
'delete_posts': ['delete_posts', 'Delete posts of the user ', [['inc/users/model','_user.class.php',5332]], 4],
'set': ['set', 'Set param value ', [['inc/items/model','_item.class.php',4909],['inc/tools/model','_emailaddress.class.php',76],['inc/_core/model/dataobjects','_dataobject.class.php',874],['inc/plugins/model','_pluginusersettings.class.php',64],['inc/regional/model','_country.class.php',94],['inc/users/model','_user.class.php',2059],['inc/settings/model','_abstractsettings.class.php',427],['inc/messaging/model','_thread.class.php',211],['inc/regional/model','_subregion.class.php',107],['inc/users/model','_usersettings.class.php',184],['plugins','_calendar.plugin.php',613],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',81],['inc/files/model','_filetype.class.php',128],['inc/sessions/model','_session.class.php',451],['inc/collections/model','_blog.class.php',1104],['inc/comments/model','_comment.class.php',400],['inc/cron/model','_cronjob.class.php',64],['inc/plugins/model','_pluginsettings.class.php',52],['inc/users/model','_userfield.class.php',257],['inc/regional/model','_city.class.php',98],['inc/slugs/model','_slug.class.php',80],['inc/users/model','_group.class.php',212],['inc/regional/model','_currency.class.php',84],['inc/widgets/model','_widget.class.php',369],['inc/regional/model','_region.class.php',90],['inc/users/model','_groupsettings.class.php',140],['inc/chapters/model','_chapter.class.php',809],['inc/antispam/model','_iprange.class.php',72],['inc/items/model','_itemtag.class.php',61],['inc/sessions/model','_goal.class.php',201],['inc/items/model','_itemlight.class.php',1328],['inc/users/model','_userfieldgroup.class.php',83],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',148]], 1238],
'userfield_prepare': ['userfield_prepare', 'Prepare some data for Userfield ', [['inc/users/model','_user.funcs.php',2999]], 2],
'get_region_name': ['get_region_name', 'Get region name ', [['inc/users/model','_user.class.php',1590]], 5],
'button_class': ['button_class', 'Get a button class name depending on template ', [['inc/_core','_misc.funcs.php',6821]], 79],
'first_name': ['first_name', 'Template function: display first name of the user ', [['inc/users/model','_user.class.php',3715]], 1],
'check_status': ['check_status', 'Check if user status permits the requested action ', [['inc/users/model','_user.class.php',2890]], 83],
'userfields_by_type': ['userfields_by_type', 'Get all user extra fields with selected type ', [['inc/users/model','_user.class.php',4182]], 2],
'dbdelete': ['dbdelete', 'Trigger event AfterItemDelete after calling parent method. ', [['inc/items/model','_item.class.php',5506],['inc/_core/model/dataobjects','_dataobject.class.php',591],['inc/users/model','_user.class.php',3376],['inc/messaging/model','_message.class.php',582],['inc/messaging/model','_thread.class.php',444],['inc/items/model','_itemtype.class.php',451],['inc/files/model','_filetype.class.php',271],['inc/collections/model','_blog.class.php',2664],['inc/comments/model','_comment.class.php',3872],['inc/users/model','_group.class.php',497]], 62],
'userfield_defs_load': ['userfield_defs_load', 'Load userfields defs ', [['inc/users/model','_user.class.php',4316]], 2],
'process_upload': ['process_upload', 'Process file uploads (this can process multiple file uploads at once) ', [['inc/files/model','_file.funcs.php',1308]], 3],
'user_country_visible': ['user_country_visible', 'Country is visible for defining ', [['inc/users/model','_user.funcs.php',3239]], 5],
'get_media_subpath': ['get_media_subpath', 'Get user media directory subpath, e.g. users/{login}/ or users/usr_{user ID}/ ', [['inc/users/model','_user.class.php',1905]], 3],
'get_tag': ['get_tag', 'Get a complete tag (IMG or A HREF) pointing to the file of this link. ', [['inc/links/model','_link.class.php',173],['inc/files/model','_file.class.php',1054]], 23],
'get_last_session_param': ['get_last_session_param', 'Get session param from the user last session ', [['inc/users/model','_user.class.php',5109]], 1],
'where': ['where', '', [['inc/_core/model/db','_sql.class.php',242]], 288],
'get_icon': ['get_icon', 'Return the img html code of the icon ', [['inc/files/model','_filetype.class.php',153],['inc/files/model','_file.class.php',978],['inc/_core','_misc.funcs.php',4122]], 428],
'rotate_avatar': ['rotate_avatar', '', [['inc/users/model','_user.class.php',4829]], 4],
'get_avatar_imgtag': ['get_avatar_imgtag', 'Get avatar <img> tag by user login ', [['inc/users/model','_user.funcs.php',1557],['inc/users/model','_user.class.php',3928]], 20],
'messages': ['messages', 'Constructor. ', [['inc/_core/model','_messages.class.php',77],['inc/_core','_template.funcs.php',1808]], 86],
'gen_id': ['gen_id', 'Generate ID for File Root ', [['inc/files/model','_fileroot.class.php',213]], 7],
'link_to_object': ['link_to_object', 'Link file to object ', [['inc/files/model','_file.class.php',2599]], 31],
'get_email_status': ['get_email_status', 'Get status of user email ', [['inc/users/model','_user.class.php',5854]], 2],
'get_reputation_spam': ['get_reputation_spam', 'Get number of spam votes which were made by this user ', [['inc/users/model','_user.class.php',5817]], 3],
'param_error': ['param_error', 'Add an error for a variable, either to the Form\'s field and/or the global {@link $Messages} object. ', [['inc/_core','_param.funcs.php',1524]], 148],
'dbchange': ['dbchange', 'Records a change that will need to be updated in the db ', [['inc/_core/model/dataobjects','_dataobject.class.php',370]], 2],
'get_catblog': ['get_catblog', 'Get blog ID for a given cat. This halts on error. ', [['inc/collections/model','_category.funcs.php',107]], 6],
'commit': ['commit', 'For any bytes that are currently buffered inside the stream, force them off the buffer. ', [['inc/_ext/swift/classes/Swift/ByteStream','AbstractFilterableInputStream.php',97],['inc/_ext/swift/classes/Swift/Signers','DKIMSigner.php',223],['inc/_ext/swift/classes/Swift/ByteStream','ArrayByteStream.php',116],['inc/_ext/swift/classes/Swift/Plugins','BandwidthMonitorPlugin.php',90],['inc/_ext/swift/classes/Swift','InputByteStream.php',41],['inc/_ext/swift/classes/Swift/Signers','DomainKeySigner.php',178],['inc/_ext/swift/classes/Swift/KeyCache','SimpleKeyCacheInputStream.php',71],['inc/_core/model/db','_db.class.php',1589]], 135],
'get_item': ['get_item', 'Getting next item in archive list ', [['plugins','_archives.plugin.php',594]], 102],
'where_or': ['where_or', 'Extends the WHERE clause with OR ', [['inc/_core/model/db','_sql.class.php',267]], 4],
'get_account_name': ['get_account_name', 'Get the name of the account with complete details for admin select lists ', [['inc/users/model','_user.class.php',1260]], 0],
'get_status_permvalue': ['get_status_permvalue', 'Get the integer value of a status permission The status permissions are stored as a set, and each status has an integer value also ', [['inc/users/model','_user.funcs.php',1929]], 30],
'accepts_email': ['accepts_email', 'Check if this user accepts receiving emails and has an email address ', [['inc/users/model','_user.class.php',3066]], 3],
'get_identity_link': ['get_identity_link', 'Get User identity link, which is a composite of user avatar and login, both point to the specific user profile tab. ', [['inc/users/model','_user.class.php',1426]], 34],
'check_perm_bloggroups': ['check_perm_bloggroups', 'Check permission for this group on a specified blog ', [['inc/users/model','_group.class.php',382]], 8],
'nick_name': ['nick_name', 'Template function: display nickname of the user ', [['inc/users/model','_user.class.php',3733]], 1],
'get_own_blogs_count': ['get_own_blogs_count', 'Get count of own blogs of the user ', [['inc/users/model','_user.class.php',6174]], 1],
'must_accept_terms': ['must_accept_terms', 'Check if user must accept terms & conditions ', [['inc/users/model','_user.class.php',6192]], 2],
'get_var': ['get_var', 'Get one variable from the DB - see docs for more detail ', [['inc/_core/model/db','_db.class.php',952]], 166],
'disp': ['disp', 'Display a member param by its name ', [['inc/_core/model/dataobjects','_dataobject.class.php',861],['inc/_core/model','_messages.class.php',152],['inc/_core/model','_log.class.php',241],['inc/_core/model','_log.class.php',597]], 66],
'dget': ['dget', 'Get a ready-to-display member param by its name ', [['inc/_core/model/dataobjects','_dataobject.class.php',846]], 252],
'get_col': ['get_col', 'Function to get 1 column from the cached result set based on X index see docs for usage and info ', [['inc/_core/model/db','_db.class.php',1032]], 117],
'get_organizations_data': ['get_organizations_data', 'Get organizations that user has selected ', [['inc/users/model','_user.class.php',5996]], 2],
'regenerate_url': ['regenerate_url', 'Regenerate current URL from parameters This may clean it up But it is also useful when generating static pages: you cannot rely on $_REQUEST[] ', [['inc/_core','_param.funcs.php',1748]], 503],
'get_blog_id': ['get_blog_id', '', [['inc/items/model','_itemlight.class.php',789]], 38],
'url_crumb': ['url_crumb', 'Create a crumb param to be passed in action urls... ', [['inc/_core','_url.funcs.php',597]], 281],
'set_from_request': ['set_from_request', 'Set a parameter from a Request form value. ', [['inc/_core/model/dataobjects','_dataobject.class.php',982]], 128],
'dbsave': ['dbsave', 'Inserts or Updates depending on object state. ', [['inc/_core/model/dataobjects','_dataobject.class.php',569],['inc/sessions/model','_session.class.php',503]], 51],
'check_setting': ['check_setting', 'Check a settings from user for Back office and from skin for Front office ', [['inc/users/model','_user.funcs.php',531]], 6],
'countries_exist': ['countries_exist', 'Check the existing countries in DB ', [['inc/regional/model','_regional.funcs.php',547]], 2],
'get_avatar_styled': ['get_avatar_styled', 'Get styled avatar ', [['inc/users/model','_user.class.php',4105]], 1],
'msn': ['msn', 'Template function: display MSN of the user ', [['inc/users/model','_user.class.php',3830]], 0],
'nt_': ['nt_', 'No Translation. Does nothing. ', [['conf','_locales.php',15]], 356],
'rotate_image': ['rotate_image', 'Rotate image ', [['inc/files/model','_image.funcs.php',480]], 2],
'set_password': ['set_password', 'Set the encoded password and a new password salt from a raw password ', [['inc/users/model','_user.class.php',2087]], 5],
'check_perm_blogowner': ['check_perm_blogowner', 'Check if the user is the owner of the designated blog (which gives him a lot of permissions) ', [['inc/users/model','_user.class.php',2781]], 2],
'delete': ['delete', '', [['inc/_ext/pclzip','pclzip.lib.php',1007],['inc/plugins/model','_pluginusersettings.class.php',89],['inc/settings/model','_abstractsettings.class.php',504],['inc/users/model','_usersettings.class.php',209],['inc/sessions/model','_session.class.php',483],['inc/plugins/model','_pluginsettings.class.php',65],['plugins/twitter_plugin/twitteroauth','twitteroauth.php',168],['inc/users/model','_groupsettings.class.php',181]], 99],
'set_profileupdate_date': ['set_profileupdate_date', 'Update profileupdate date. Call after a publicly visible user property was updated. ', [['inc/users/model','_user.class.php',4638]], 4],
'ip2int': ['ip2int', 'Convert IP address to integer (get only 32bits of IPv6 address) ', [['inc/_core','_misc.funcs.php',6327]], 47],
'preferred_name': ['preferred_name', 'Template function: display user\'s preferred name ', [['inc/users/model','_user.class.php',3677]], 1],
'param_check_url': ['param_check_url', 'Check that a given param is a valid URL ', [['inc/_core','_param.funcs.php',804]], 13],
'trigger_event': ['trigger_event', 'Call all plugins for a given event. ', [['inc/plugins/model','_plugins.class.php',817]], 130],
'check_role': ['check_role', 'Check if the user has the given role in any blog ', [['inc/users/model','_user.class.php',2941]], 8],
'param_check_number': ['param_check_number', 'Checks if the param is an integer (no float, e.g. 3.14). ', [['inc/_core','_param.funcs.php',581]], 31],
'delete_avatar': ['delete_avatar', 'Delete user avatar file ', [['inc/users/model','_user.class.php',4980]], 2],
'action_icon': ['action_icon', 'Generate requested action icon depending on perm ', [['inc/_core/model/dataobjects','_dataobject.class.php',1071],['inc/_core','_misc.funcs.php',3977]], 289],
'from_add': ['from_add', 'Extends the FROM clause. ', [['inc/_core/model/db','_sql.class.php',226]], 200],
'create': ['create', '', [['inc/_ext/pclzip','pclzip.lib.php',272],['inc/collections/model','_blog.class.php',2343],['inc/files/model','_file.class.php',355]], 74],
'get_country': ['get_country', 'Get country of current Item ', [['inc/items/model','_item.class.php',6744]], 1],
'url_add_param': ['url_add_param', 'Add param(s) at the end of an URL, using either "?" or "&amp;" depending on existing url ', [['inc/_core','_url.funcs.php',525]], 256],
'get_local_media_url': ['get_local_media_url', 'Get the URL of the media folder, on the current blog\'s domain (which is NOT always the same as the $baseurl domain!). ', [['inc/collections/model','_blog.class.php',1283]], 4],
'antispam_increase_counter': ['antispam_increase_counter', 'Increase a counter in DB antispam ip range table ', [['inc/antispam/model','_antispam.funcs.php',970]], 2],
'get_msgform_possibility': ['get_msgform_possibility', 'Get messaging possibilities between current user and $this user ', [['inc/users/model','_user.class.php',3078]], 13],
'get_userpage_url': ['get_userpage_url', 'Get user page url ', [['inc/users/model','_user.class.php',1942]], 6],
'email': ['email', 'Template function: display email of the user ', [['inc/users/model','_user.class.php',3794],['inc/_ext/swift/classes/Swift','Validate.php',24]], 14],
'get_duplicated_files': ['get_duplicated_files', 'Get the duplicated files of this file ', [['inc/files/model','_file.class.php',2849]], 2],
'urltitle_validate': ['urltitle_validate', '', [['inc/items/model','_item.funcs.php',326]], 9],
'login': ['login', 'Template function: display user\'s login ', [['inc/users/model','_user.class.php',3589]], 29],
'get': ['get', 'Get a member param by its name ', [['inc/items/model','_item.class.php',6187],['inc/_core/model/db','_sql.class.php',50],['inc/_core/model/dataobjects','_dataobject.class.php',834],['inc/plugins/model','_pluginusersettings.class.php',40],['inc/users/model','_user.class.php',1227],['rsc/js/tiny_mce/plugins/spellchecker/includes','Engine.php',145],['inc/settings/model','_abstractsettings.class.php',252],['inc/settings/model','_generalsettings.class.php',379],['inc/users/model','_usersettings.class.php',148],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',95],['inc/links/model','_linkcomment.class.php',150],['inc/links/model','_linkitem.class.php',205],['inc/sessions/model','_session.class.php',428],['inc/collections/model','_blog.class.php',1842],['inc/comments/model','_comment.class.php',386],['inc/cron/model','_cronjob.class.php',89],['inc/plugins/model','_pluginsettings.class.php',40],['inc/links/model','_linkowner.class.php',218],['plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['inc/slugs/model','_slug.class.php',68],['inc/users/model','_groupsettings.class.php',124],['inc/chapters/model','_chapter.class.php',600],['inc/antispam/model','_iprange.class.php',60],['inc/files/model','_file.class.php',555],['inc/links/model','_linkuser.class.php',154],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',165]], 2630],
'get_subregion_name': ['get_subregion_name', 'Get subregion name ', [['inc/users/model','_user.class.php',1604]], 5],
'get_num_edited_posts': ['get_num_edited_posts', 'Get the number of other users posts which were edited by this user ', [['inc/users/model','_user.class.php',1806]], 1],
'userfieldget_first_for_type': ['userfieldget_first_for_type', 'Get first field for a specific type ', [['inc/users/model','_user.class.php',4343]], 0],
'clear_links': ['clear_links', 'Clear all links of owner User ', [['inc/links/model','_linkuser.class.php',81]], 1],
'get_avatar_imgtag_default': ['get_avatar_imgtag_default', 'Get avatar <img> tag with default picture ', [['inc/users/model','_user.funcs.php',1731]], 6],
'format_to_output': ['format_to_output', 'Format a string/content for being output ', [['inc/_core','_misc.funcs.php',264]], 318],
'rel_path_to_base': ['rel_path_to_base', 'Return the path without the leading {@link $basepath}, or if not below {@link $basepath}, just the basename of it. ', [['inc/files/model','_file.funcs.php',758]], 25],
'get_msgform_url': ['get_msgform_url', 'Get message form url ', [['inc/users/model','_user.class.php',1921]], 3],
'get_regional_name': ['get_regional_name', '', [['inc/users/model','_user.class.php',1556]], 4],
'get_reputation_comments': ['get_reputation_comments', 'Get number of comments and percent of published comments and number of helpful votes on comments by this user ', [['inc/users/model','_user.class.php',5583]], 3],
'get_avatar_overlay_text': ['get_avatar_overlay_text', 'Get overlay text for avatar img tag ', [['inc/users/model','_user.class.php',4025]], 1],
'set_email': ['set_email', 'Set email address of the user. ', [['inc/users/model','_user.class.php',2120]], 5],
'user_region_visible': ['user_region_visible', 'Region is visible for defining ', [['inc/users/model','_user.funcs.php',3311]], 8],
'get_results': ['get_results', 'Return the the query as a result set - see docs for more details ', [['inc/_core/model/db','_db.class.php',1083]], 152],
'get_no_msgform_reason': ['get_no_msgform_reason', 'Get the reason why current User is not able to make a contact with this User ', [['inc/users/model','_user.class.php',3153]], 0],
'get_city_name': ['get_city_name', 'Get city name ', [['inc/users/model','_user.class.php',1618]], 4],
'get_secure_htsrv_url': ['get_secure_htsrv_url', 'Get secure htsrv url on the same domain as the http request came from It is important on login and register calls _init_hit.inc.php should be called before this call, because ReqHost and ReqPath must be initialized ', [['inc/_core','_misc.funcs.php',5920]], 49],
'get_reputation_posts': ['get_reputation_posts', 'Get number of posts and percent of published posts by this user ', [['inc/users/model','_user.class.php',5527]], 3],
'get_first_session_hit_params': ['get_first_session_hit_params', 'Get session param from the user first session, hit ', [['inc/users/model','_user.class.php',5134]], 1],
'rollback': ['rollback', 'Rollback current transaction ', [['inc/_core/model/db','_db.class.php',1625]], 48],
'get_media_dir': ['get_media_dir', 'Get the path to the media directory. If it does not exist, it will be created. ', [['inc/users/model','_user.class.php',1824],['inc/collections/model','_blog.class.php',1634]], 13],
'set_param': ['set_param', 'Set the value of a param (by force! :P) ', [['inc/_core','_param.funcs.php',1678],['inc/_core/model/dataobjects','_dataobject.class.php',890]], 127],
'locale_temp_switch': ['locale_temp_switch', 'Template function: Temporarily switch to this post\'s locale or to current blog\'s locale depending on setting ', [['inc/items/model','_itemlight.class.php',919],['inc/locales','_locale.funcs.php',250]], 62],
'get_days_count_close': ['get_days_count_close', 'Calculate how much days user has after registration ', [['inc/users/model','_user.class.php',6159]], 2],
'userfield_value_by_id': ['userfield_value_by_id', 'Get user field value by ID ', [['inc/users/model','_user.class.php',4209]], 0],
'send_welcome_message': ['send_welcome_message', 'Send a welcome private message ', [['inc/users/model','_user.class.php',5159]], 2],
'get_gender': ['get_gender', 'Return gender of the user ', [['inc/users/model','_user.class.php',3742]], 4],
'get_field_attribs_as_string': ['get_field_attribs_as_string', 'Build a string out of $field_attribs, with each attribute prefixed by a space character. ', [['inc/_core','_misc.funcs.php',4981]], 30],
'get_num_blogs': ['get_num_blogs', 'Get the number of blogs owned by this user ', [['inc/users/model','_user.class.php',1641]], 1],
'on': ['on', '', [['rsc/js/bootstrap','typeahead.bundle.js',739]], 619],
'param_has_error': ['param_has_error', 'Tell if there is an error on given field. ', [['inc/_core','_param.funcs.php',1495]], 14],
'get_num_comments': ['get_num_comments', 'Get the number of comments for the user. ', [['inc/users/model','_user.class.php',1689]], 7],
'set_max_execution_time': ['set_max_execution_time', 'Set max execution time ', [['inc/_core','_misc.funcs.php',5931]], 20],
'mail_is_blocked': ['mail_is_blocked', 'Check if the email address is blocked ', [['inc/tools/model','_email.funcs.php',355]], 4],
'get_num_sessions': ['get_num_sessions', 'Get the number of user sessions ', [['inc/users/model','_user.class.php',1752]], 1],
'get_user_settings_url': ['get_user_settings_url', 'Get URL to a specific user settings tab (profile, avatar, pwdchange, userprefs) ', [['inc/users/model','_user.funcs.php',1128]], 10],
'url_rel_to_same_host': ['url_rel_to_same_host', 'Try to make $url relative to $target_url, if scheme, host, user and pass matches. ', [['inc/_core','_url.funcs.php',622]], 29],
'has_avatar': ['has_avatar', '', [['inc/users/model','_user.class.php',3841]], 10],
'locale_restore_previous': ['locale_restore_previous', 'Restore the locale in use before the switch ', [['inc/locales','_locale.funcs.php',281]], 61],
'send_account_changed_notification': ['send_account_changed_notification', 'Send an email notification when user account has been changed ', [['inc/users/model','_user.class.php',5914]], 3],
'get_gender_class': ['get_gender_class', 'Return attr class depending on gender of the user ', [['inc/users/model','_user.class.php',3760]], 5],
'userfield_add': ['userfield_add', 'Add a user field ', [['inc/users/model','_user.class.php',4161]], 4],
'send_validate_email': ['send_validate_email', 'Send an email to the user with a link to validate/confirm his email address. ', [['inc/users/model','_user.class.php',3461]], 3],
'get_thumb_imgtag': ['get_thumb_imgtag', 'Generate the IMG THUMBNAIL tag with all the alt & title if available. ', [['inc/files/model','_file.class.php',2144]], 5],
'load_where': ['load_where', 'Load a set of objects into the cache. ', [['inc/_core/model/dataobjects','_dataobjectcache.class.php',236]], 19],
'dbupdate': ['dbupdate', 'Update the DB based on previously recorded changes ', [['inc/items/model','_item.class.php',5287],['inc/_core/model/dataobjects','_dataobject.class.php',386],['inc/users/model','_user.class.php',3249],['inc/skins/model','_skin.class.php',416],['inc/settings/model','_abstractsettings.class.php',575],['inc/items/model','_itemtype.class.php',433],['inc/files/model','_filetype.class.php',242],['inc/collections/model','_blog.class.php',2630],['inc/comments/model','_comment.class.php',3747],['inc/cron/model','_cronjob.class.php',188],['inc/slugs/model','_slug.class.php',265],['inc/users/model','_group.class.php',478],['inc/widgets/model','_widget.class.php',861],['inc/users/model','_groupsettings.class.php',159],['inc/chapters/model','_chapter.class.php',564],['inc/files/model','_file.class.php',1825]], 289],
'check_perm_blogusers': ['check_perm_blogusers', 'Check permission for this user on a specified blog ', [['inc/users/model','_user.class.php',2853]], 8],
'accepts_pm': ['accepts_pm', 'Check if this user and his group accept receiving private messages or not ', [['inc/users/model','_user.class.php',3054]], 7],
'check_blog_advanced_perm': ['check_blog_advanced_perm', 'Check blog advanced user/group permission ', [['inc/users/model','_user.funcs.php',2126]], 2],
'date2mysql': ['date2mysql', 'Convert timestamp to MySQL/ISO format. ', [['inc/_core','_misc.funcs.php',1226]], 63],
'get_canonical_path': ['get_canonical_path', 'Returns canonicalized pathname of a directory + ending slash ', [['inc/files/model','_file.funcs.php',406]], 14],
'load_class': ['load_class', 'In PHP4, this really loads the class. In PHP5, it\'s smarter than that: It only registers the class & file name so that __autoload() can later load the class IF and ONLY IF the class is actually needed during execution. ', [['inc/_core','_class5.funcs.php',64],['inc/_core','_class4.funcs.php',19]], 435],
'get_num_messages': ['get_num_messages', 'Get the number of user messages ', [['inc/users/model','_user.class.php',1775]], 6],
'userfields_load': ['userfields_load', 'Load userfields ', [['inc/users/model','_user.class.php',4258]], 4],
'rmdir_r': ['rmdir_r', 'Deletes a dir recursively, wiping out all subdirectories!! ', [['inc/files/model','_file.funcs.php',243]], 34],
'get_username': ['get_username', 'Get user name depending on general setting \'username_display\' ', [['inc/users/model','_user.class.php',6131]], 3],
'check_perm': ['check_perm', 'Check module permission ', [['inc/_core/model','_module.class.php',234],['inc/users/model','_user.class.php',2234],['inc/messaging/model','_message.class.php',595],['inc/messaging/model','_thread.class.php',482],['inc/links/model','_linkcomment.class.php',49],['inc/links/model','_linkitem.class.php',50],['inc/users/model','_group.class.php',265],['inc/sessions/model','_goal.class.php',94],['inc/links/model','_linkuser.class.php',47]], 1082],
'utf8_strlen': ['utf8_strlen', 'utf8_strlen( ) ', [['inc/_ext','_portable_utf8.php',173]], 41],
'activate_from_request': ['activate_from_request', 'Activate user account after user clicks on activate link from email ', [['inc/users/model','_user.class.php',3539]], 2],
'get_msgform_link': ['get_msgform_link', 'Template helper function: Get a link to a message form for this user. ', [['inc/users/model','_user.class.php',3600]], 2],
'quote': ['quote', 'Quote a msgid/msgstr, preferrable with single quotes. ', [['inc/locales','_pofile.class.php',261],['inc/_core/model/db','_db.class.php',491]], 1085],
'has_cross_country_restriction': ['has_cross_country_restriction', 'Check if browse users from different countries is restricted for the current User ', [['inc/users/model','_user.funcs.php',3252]], 14],
'user': ['user', 'Constructor ', [['inc/users/model','_user.class.php',144]], 37],
'delete_comments': ['delete_comments', 'Delete comments of the user ', [['inc/users/model','_user.class.php',5423]], 3],
'get_root_dir': ['get_root_dir', '', [['inc/files/model','_filerootcache.class.php',159]], 2],
'get_country_name': ['get_country_name', '', [['inc/users/model','_user.class.php',1579]], 8],
'set_group': ['set_group', 'Set new Group. ', [['inc/users/model','_user.class.php',2171]], 10],
'userfield_values_by_code': ['userfield_values_by_code', 'Get user field values by code ', [['inc/users/model','_user.class.php',4232]], 1],
'get_num_files': ['get_num_files', 'Get the number of files for the user. ', [['inc/users/model','_user.class.php',1727]], 4],
'update_organizations': ['update_organizations', 'Update user\'s organizations in DB ', [['inc/users/model','_user.class.php',6050]], 2],
'check_perm_blog_global': ['check_perm_blog_global', 'Check if user has global perms on this blog ', [['inc/users/model','_user.class.php',2827]], 3],
'is_logged_in': ['is_logged_in', 'is_logged_in(-) ', [['inc/users/model','_user.funcs.php',38]], 274],
'param_check_passwords': ['param_check_passwords', '', [['inc/_core','_param.funcs.php',1412]], 5],
'remove_link': ['remove_link', '', [['inc/links/model','_linkowner.class.php',105]], 1],
'num_posts': ['num_posts', 'Template function: display number of user\'s posts ', [['inc/users/model','_user.class.php',3706]], 0],
'can_moderate_user': ['can_moderate_user', 'Check if user has a permission to moderate the user ', [['inc/users/model','_user.class.php',5875]], 27],
'set_working_blog': ['set_working_blog', 'Set working blog to a new value and memorize it in user settings if needed. ', [['inc/collections/model','_blog.funcs.php',339]], 21],
'update_from_request': ['update_from_request', 'Update user data from Request form fields. ', [['inc/users/model','_user.class.php',4361]], 3],
'level': ['level', 'Template function: display user\'s level ', [['inc/users/model','_user.class.php',3580]], 0],
'order_by': ['order_by', '', [['inc/_core/model/db','_sql.class.php',321]], 85],
'get_dispctrl_url': ['get_dispctrl_url', 'Get disp urls for Frontoffice part OR ctrl urls for Backoffice ', [['inc/_core','_url.funcs.php',876]], 31],
'param_check_not_empty': ['param_check_not_empty', '', [['inc/_core','_param.funcs.php',564]], 53],
'get_rotate_avatar_icons': ['get_rotate_avatar_icons', 'Get the rotate avatar icons ', [['inc/users/model','_user.class.php',4718]], 3],
'check_perm_itemowner': ['check_perm_itemowner', 'Check if the user is the owner of the designated item (which gives him a lot of permissions) ', [['inc/users/model','_user.class.php',2804]], 0],
'is_meta': ['is_meta', 'Check if this comment is meta ', [['inc/comments/model','_comment.class.php',4108]], 31],
'generate_random_key': ['generate_random_key', 'Generate a valid key of size $length. ', [['inc/_core','_misc.funcs.php',4759]], 24],
'select': ['select', 'Set SELECT clause ', [['inc/_core/model/db','_sql.class.php',196],['inc/_core/ui/forms','_form.class.php',2189],['inc/_core/model/db','_db.class.php',454]], 475],
'get_field_link': ['get_field_link', 'Get link from defined userfields ', [['inc/users/model','_user.class.php',2040]], 1],
'list': ['list', '', [['rsc/js/bootstrap','typeahead.bundle.js',156]], 105],
'get_manual_link': ['get_manual_link', 'Generate a link to a online help resource. testing the concept of online help (aka webhelp). this function should be relocated somewhere better if it is taken onboard by the project ', [['inc/_core','_misc.funcs.php',4935]], 284],
'get_class_db_config': ['get_class_db_config', 'Get this class db table config params ', [['inc/_core/model/dataobjects','_dataobject.class.php',104],['inc/users/model','_user.class.php',231],['inc/messaging/model','_message.class.php',87],['inc/messaging/model','_thread.class.php',147],['inc/sessions/model','_session.class.php',259],['inc/comments/model','_comment.class.php',250],['inc/links/model','_link.class.php',84],['inc/chapters/model','_chapter.class.php',120],['inc/files/model','_file.class.php',250],['inc/items/model','_itemlight.class.php',199]], 7],
'param_duration': ['param_duration', 'Get total seconds from the following fields: months, days, hours, minutes, seconds ', [['inc/_core','_param.funcs.php',515]], 9],
'group_by': ['group_by', '', [['inc/_core/model/db','_sql.class.php',290]], 60],
'init_relations': ['init_relations', 'Initialize relations for restrict and cascade deletion. ', [['inc/_core/model/dataobjects','_dataobject.class.php',89],['inc/users/model','_user.class.php',313]], 6],
'debug_die': ['debug_die', 'Outputs Unexpected Error message. When in debug mode it also prints a backtrace. ', [['inc/_core','_misc.funcs.php',2523]], 225],
'param_integer_range': ['param_integer_range', 'Gets a param and makes sure it\'s a decimal number (no float, e.g. 3.14) in a given range. ', [['inc/_core','_param.funcs.php',674]], 21],
'query': ['query', 'Run Query: GET DATA ROWS *** HEAVY *** ', [['inc/items/model','_itemlist.class.php',249],['inc/items/model','_itemlistlight.class.php',742],['inc/comments/model','_commentlist.class.php',507],['inc/users/model','_userlist.class.php',511],['inc/_core/ui/results','_results.class.php',468],['inc/_core/model/db','_db.class.php',749]], 1144],
'yim': ['yim', 'Template function: display Yahoo IM of the user ', [['inc/users/model','_user.class.php',3821]], 0],
'subregions_exist': ['subregions_exist', 'Check the existing subregions for selected region ', [['inc/regional/model','_regional.funcs.php',596]], 3],
'get_field_url': ['get_field_url', 'Get url from defined userfields ', [['inc/users/model','_user.class.php',2003]], 8],
'update_sender': ['update_sender', 'Update notification sender\'s info from General settings ', [['inc/users/model','_user.class.php',5210]], 2],
'get_visibility_statuses': ['get_visibility_statuses', 'Get available post statuses ', [['inc/collections/model','_blog.funcs.php',953]], 87],
'last_name': ['last_name', 'Template function: display last name of the user ', [['inc/users/model','_user.class.php',3724]], 1],
'aim': ['aim', 'Template function: display AIM of the user. ', [['inc/users/model','_user.class.php',3812]], 0],
'get_name': ['get_name', 'Get name of widget ', [['inc/widgets/widgets','_coll_tag_cloud.widget.php',63],['plugins/twitter_plugin/twitteroauth','oauth.php',102],['plugins/twitter_plugin/twitteroauth','oauth.php',128],['plugins/twitter_plugin/twitteroauth','oauth.php',155],['inc/widgets/widgets','_coll_page_list.widget.php',77],['inc/items/model','_itemstatus.class.php',77],['inc/widgets/widgets','_coll_logo.widget.php',48],['inc/widgets/widgets','_mobile_skin_switcher.widget.php',48],['inc/widgets/widgets','_online_users.widget.php',48],['inc/regional/model','_country.class.php',119],['inc/widgets/widgets','_user_login.widget.php',49],['inc/skins/model','_skin.class.php',137],['inc/widgets/widgets','_linkblog.widget.php',76],['inc/widgets/widgets','_coll_related_post_list.widget.php',76],['inc/widgets/widgets','_coll_item_list.widget.php',247],['inc/items/model','_itemtype.class.php',379],['inc/widgets/widgets','_user_links.widget.php',48],['inc/widgets/widgets','_coll_featured_intro.widget.php',128],['inc/regional/model','_subregion.class.php',131],['inc/widgets/widgets','_coll_search_form.widget.php',48],['inc/widgets/widgets','_coll_longdesc.widget.php',48],['inc/widgets/widgets','_content_hierarchy.widget.php',93],['inc/widgets/widgets','_coll_tagline.widget.php',48],['inc/widgets/widgets','_coll_current_filters.widget.php',49],['inc/widgets/widgets','_coll_category_list.widget.php',49],['inc/widgets/widgets','_org_members.widget.php',48],['inc/collections/model','_blog.class.php',2802],['inc/widgets/widgets','_coll_comment_list.widget.php',102],['inc/widgets/widgets','_member_count.widget.php',48],['inc/users/model','_userfield.class.php',279],['inc/widgets/widgets','_coll_link_list.widget.php',76],['inc/widgets/widgets','_menu_link.widget.php',84],['inc/widgets/widgets','_free_html.widget.php',48],['inc/widgets/widgets','_breadcrumb_path.widget.php',76],['inc/regional/model','_city.class.php',121],['inc/widgets/widgets','_image.widget.php',48],['inc/users/model','_group.class.php',448],['inc/regional/model','_currency.class.php',120],['inc/widgets/widgets','_profile_menu_link.widget.php',48],['inc/widgets/widgets','_coll_media_index.widget.php',156],['inc/widgets/model','_widget.class.php',157],['inc/widgets/widgets','_colls_list_owner.widget.php',48],['inc/widgets/widgets','_user_tools.widget.php',225],['inc/widgets/widgets','_coll_common_links.widget.php',52],['inc/widgets/widgets','_msg_menu_link.widget.php',54],['inc/widgets/widgets','_user_avatars.widget.php',150],['inc/widgets/widgets','_coll_xml_feeds.widget.php',48],['inc/regional/model','_region.class.php',114],['inc/chapters/model','_chapter.class.php',618],['inc/antispam/model','_iprange.class.php',128],['inc/sessions/model','_goalcat.class.php',78],['inc/widgets/widgets','_coll_avatar.widget.php',49],['inc/widgets/widgets','_coll_post_list.widget.php',76],['inc/files/model','_file.class.php',574],['inc/sessions/model','_goal.class.php',195],['inc/widgets/widgets','_user_register.widget.php',49],['inc/widgets/widgets','_colls_list_public.widget.php',48],['inc/users/model','_userfieldgroup.class.php',97],['inc/users/model','_organization.class.php',88],['inc/widgets/widgets','_coll_title.widget.php',69]], 114],
'is_locked': ['is_locked', 'Check if item is locked ', [['inc/items/model','_item.class.php',6926]], 10],
'message': ['message', 'Constructor ', [['inc/messaging/model','_message.class.php',61]], 22],
'add': ['add', '', [['inc/_ext/pclzip','pclzip.lib.php',455],['rsc/js/tiny_mce/plugins/spellchecker/includes','Engine.php',141],['inc/skins/model','_skincache.class.php',50],['inc/_core/model','_messages.class.php',114],['inc/_ext/swift/classes/Swift/Plugins','LoggerPlugin.php',33],['inc/_ext/swift/classes/Swift/Plugins','Logger.php',20],['inc/files/model','_filetypecache.class.php',38],['inc/_core/model/dataobjects','_dataobjectcache.class.php',339],['inc/_ext/swift/classes/Swift/Plugins/Loggers','EchoLogger.php',33],['inc/_core/model','_log.class.php',109],['inc/_core/model','_log.class.php',577],['inc/users/model','_usercache.class.php',239],['inc/_ext/swift/classes/Swift/Plugins/Loggers','ArrayLogger.php',44],['inc/links/model','_linkcache.class.php',86],['inc/users/model','_groupsettings.class.php',103],['inc/chapters/model','_chaptercache.class.php',98],['inc/files/model','_filelist.class.php',373],['inc/collections/model','_blogcache.class.php',50]], 1695],
'get_assoc': ['get_assoc', 'Function to get the second column from the cached result indexed by the first column ', [['inc/_core/model/db','_db.class.php',1057]], 60],
'from': ['from', '', [['inc/_core/model/db','_sql.class.php',221]], 513],
'invalidate_key': ['invalidate_key', 'Invalidate a special key ', [['inc/_core/model','_blockcache.class.php',69]], 14],
'int2ip': ['int2ip', 'Convert integer to IP address ', [['inc/_core','_misc.funcs.php',6262]], 24],
'delete_orphan_threads': ['delete_orphan_threads', 'Delete orphan threads ', [['inc/messaging/model','_messaging.funcs.php',1678]], 1],
'regions_exist': ['regions_exist', 'Check the existing regions for selected country ', [['inc/regional/model','_regional.funcs.php',566]], 3],
'get_reputation_files': ['get_reputation_files', 'Get number of files (and number of helpful votes on photos only) by this user ', [['inc/users/model','_user.class.php',5701]], 9],
't_': ['t_', 'Provide translation in the context of this module: ', [['inc/_core/model','_module.class.php',67],['rsc/js','blog_widgets.js',467],['inc/skins/model','_skin.class.php',1131],['inc/plugins','_plugin.class.php',2799],['inc/locales','_locale.funcs.php',29],['inc/locales','_locale.funcs.php',226]], 12118],
'delete_blogs': ['delete_blogs', 'Delete all blogs of the user recursively ', [['inc/users/model','_user.class.php',5259]], 2],
'crop_image': ['crop_image', 'Crop image ', [['inc/files/model','_image.funcs.php',518]], 1],
'get_rdfp_rel_path': ['get_rdfp_rel_path', 'Get the file posix path relative to it\'s root (no trailing /) ', [['inc/files/model','_file.class.php',616]], 34],
'dbinsert': ['dbinsert', 'Insert object into DB based on previously recorded changes ', [['inc/items/model','_item.class.php',5108],['inc/_core/model/dataobjects','_dataobject.class.php',470],['inc/users/model','_user.class.php',3187],['inc/skins/model','_skin.class.php',438],['inc/items/model','_itemtype.class.php',405],['inc/files/model','_filetype.class.php',213],['inc/tools/model','_syslog.class.php',58],['inc/collections/model','_blog.class.php',2272],['inc/comments/model','_comment.class.php',3815],['inc/users/model','_group.class.php',459],['inc/widgets/model','_widget.class.php',829],['inc/chapters/model','_chapter.class.php',532],['inc/files/model','_file.class.php',1784]], 99],
'get_crop_avatar_icon': ['get_crop_avatar_icon', 'Get the crop avatar icon ', [['inc/users/model','_user.class.php',4888]], 3],
'param_errors_detected': ['param_errors_detected', 'Check if there have been validation errors ', [['inc/_core','_param.funcs.php',1480]], 61],
'cities_exist': ['cities_exist', 'Check the existing cities for selected country, region & subregion ', [['inc/regional/model','_regional.funcs.php',622]], 3],
'get_num_posts': ['get_num_posts', 'Get the number of posts for the user. ', [['inc/users/model','_user.class.php',1656]], 8],
'get_login_url': ['get_login_url', 'Get url to login ', [['inc/users/model','_user.funcs.php',178]], 23],
'load_from_request': ['load_from_request', 'Init filter params from Request params ', [['inc/items/model','_itemlistlight.class.php',324],['inc/items/model','_item.class.php',570],['inc/widgets/widgets','_coll_tag_cloud.widget.php',37],['inc/tools/model','_emailaddress.class.php',90],['inc/email_campaigns/model','_emailcampaign.class.php',186],['inc/maintenance/model','_backup.class.php',159],['inc/items/model','_itemstatus.class.php',63],['inc/sessions/model','_domain.class.php',54],['inc/regional/model','_country.class.php',70],['inc/users/model','_user.class.php',341],['inc/skins/model','_skin.class.php',158],['inc/comments/model','_commentlist.class.php',253],['inc/messaging/model','_message.class.php',124],['inc/users/model','_userlist.class.php',260],['inc/messaging/model','_thread.class.php',186],['inc/items/model','_itemtype.class.php',148],['inc/regional/model','_subregion.class.php',78],['inc/files/model','_filetype.class.php',61],['inc/collections/model','_blog.class.php',375],['inc/cron/model','_cronjob.class.php',107],['inc/users/model','_userfield.class.php',172],['inc/regional/model','_city.class.php',68],['inc/slugs/model','_slug.class.php',94],['inc/users/model','_group.class.php',122],['inc/users/model','_invitation.class.php',69],['inc/regional/model','_currency.class.php',62],['inc/widgets/model','_widget.class.php',138],['inc/regional/model','_region.class.php',66],['inc/chapters/model','_chapter.class.php',286],['inc/antispam/model','_iprange.class.php',86],['inc/sessions/model','_goalcat.class.php',59],['inc/items/model','_itemtag.class.php',75],['inc/sessions/model','_goal.class.php',112],['inc/users/model','_userfieldgroup.class.php',64],['inc/users/model','_organization.class.php',67]], 82],
'get_avatar_links': ['get_avatar_links', '', [['inc/users/model','_user.class.php',3899]], 12],
'user_city_visible': ['user_city_visible', 'City is visible for defining ', [['inc/users/model','_user.funcs.php',3337]], 6],
'clear': ['clear', 'Empty the message list ', [['inc/_ext/swift/classes/Swift/Plugins','MessageLogger.php',50],['inc/_ext/swift/classes/Swift/Plugins/Reporters','HitReporter.php',54],['inc/_core/model','_messages.class.php',102],['inc/_ext/swift/classes/Swift/Plugins','LoggerPlugin.php',43],['inc/_ext/swift/classes/Swift/Plugins','Logger.php',27],['inc/_core/model/dataobjects','_dataobjectcache.class.php',437],['inc/_ext/swift/classes/Swift/Plugins/Loggers','EchoLogger.php',47],['inc/_core/model','_log.class.php',84],['inc/_core/model','_log.class.php',587],['inc/users/model','_usercache.class.php',376],['inc/files/model','_filerootcache.class.php',172],['inc/_ext/swift/classes/Swift/Plugins/Loggers','ArrayLogger.php',57],['inc/links/model','_linkcache.class.php',517],['inc/chapters/model','_chaptercache.class.php',81]], 99],
'get_thumb_size': ['get_thumb_size', 'Calculate what sizes are used for thumbnail really ', [['inc/files/model','_file.class.php',2187]], 2],
'update_avatar_from_upload': ['update_avatar_from_upload', 'Update user avatar file to the currently uploaded file ', [['inc/users/model','_user.class.php',5032]], 2],
'get_delete_cascades': ['get_delete_cascades', 'Get delete cascade settings ', [['inc/email_campaigns/model','_emailcampaign.class.php',71],['inc/_core/model/dataobjects','_dataobject.class.php',152],['inc/users/model','_user.class.php',278],['inc/skins/model','_skin.class.php',95],['inc/messaging/model','_message.class.php',111],['inc/messaging/model','_thread.class.php',171],['inc/items/model','_itemtype.class.php',134],['inc/collections/model','_blog.class.php',190],['inc/comments/model','_comment.class.php',274],['inc/users/model','_userfield.class.php',74],['inc/links/model','_link.class.php',108],['inc/items/model','_itemtag.class.php',48],['inc/sessions/model','_goal.class.php',62],['inc/items/model','_itemlight.class.php',175]], 1],
'load_blog_advanced_perms': ['load_blog_advanced_perms', 'Load blog advanced User/Group permission ', [['inc/users/model','_user.funcs.php',2018]], 2],
'get_activate_info_url': ['get_activate_info_url', 'Get url to show user activate info screen ', [['inc/users/model','_user.funcs.php',286]], 21],
'check_blocked_contacts': ['check_blocked_contacts', 'Check blocked contacts in recipients list. Note: If current User has only reply permission then users who didn\'t have the current User in their contact list will be considerated as blocked contacts! ', [['inc/messaging/model','_messaging.funcs.php',49]], 2],
'param': ['param', 'Sets a parameter with values from the request or to provided default, except if param is already set! ', [['inc/_core','_param.funcs.php',35]], 2141],
'check_password': ['check_password', '', [['inc/users/model','_user.class.php',2223]], 3],
'param_check_email': ['param_check_email', '', [['inc/_core','_param.funcs.php',720]], 10],
'emailskin_style': ['emailskin_style', 'Get attribute "style" by class name for element in email templates ', [['inc/_core','_misc.funcs.php',3884]], 208],
'msgform_link': ['msgform_link', 'Template function: Provide link to message form for this Item\'s author. ', [['inc/items/model','_item.class.php',2387],['inc/users/model','_user.class.php',3661],['inc/comments/model','_comment.class.php',2310]], 7],
'gen_blogurl': ['gen_blogurl', 'Generate blog URL. That is the URL of the main page/home page of the blog. This will nto necessarily be a folder. For example, it can end in index.php?blog=4 ', [['inc/collections/model','_blog.class.php',1128]], 94],
'crop_avatar': ['crop_avatar', 'Rotate user avatar file ', [['inc/users/model','_user.class.php',4851]], 2],
'has_comment_to_delete': ['has_comment_to_delete', 'Check if current has at least one own comment to delete ', [['inc/users/model','_user.class.php',5385]], 2],
'user_subregion_visible': ['user_subregion_visible', 'Subregion is visible for defining ', [['inc/users/model','_user.funcs.php',3324]], 6],
'update_status_from_request': ['update_status_from_request', 'Handle close user account request and update account close reason ', [['inc/users/model','_user.class.php',4528]], 3],
'send_mail_to_user': ['send_mail_to_user', 'Sends an email to User ', [['inc/_core','_misc.funcs.php',3584]], 14],
'get_own_comments_ids': ['get_own_comments_ids', 'Get the comments IDs that were created by this user ', [['inc/users/model','_user.class.php',5366]], 2],
'get_deleted_blogs': ['get_deleted_blogs', 'Get all own blogs of this user which current user can delete ', [['inc/users/model','_user.class.php',5232]], 3],
'is_admin_page': ['is_admin_page', 'Is the current page an admin/backoffice page? ', [['inc/_core','_misc.funcs.php',5028]], 118],
'load_funcs': ['load_funcs', '', [['inc/_core','_misc.funcs.php',158]], 242],
'send_admin_notification': ['send_admin_notification', 'Send notification to users with edit users permission ', [['inc/users/model','_user.funcs.php',399]], 8],
'get_preferred_name': ['get_preferred_name', 'Get preferred name of the user ', [['inc/users/model','_user.class.php',1345]], 13],
'param_check_gender': ['param_check_gender', '', [['inc/_core','_param.funcs.php',2127]], 1],
'param_add_message_to_log': ['param_add_message_to_log', 'This function is used by {@link param_error()} and {@link param_error_multiple()}. ', [['inc/_core','_param.funcs.php',1582]], 12],
'dbinsert_individual': ['dbinsert_individual', 'Insert new thread for each recipient ', [['inc/messaging/model','_message.class.php',261]], 3],
'begin': ['begin', 'BEGIN A TRANSCATION ', [['inc/_core/model/db','_db.class.php',1537]], 114],
'get_delete_restrictions': ['get_delete_restrictions', 'Get delete restriction settings ', [['inc/_core/model/dataobjects','_dataobject.class.php',129],['inc/items/model','_itemstatus.class.php',50],['inc/regional/model','_country.class.php',55],['inc/users/model','_user.class.php',255],['inc/skins/model','_skin.class.php',79],['inc/items/model','_itemtype.class.php',121],['inc/regional/model','_subregion.class.php',64],['inc/regional/model','_city.class.php',55],['inc/slugs/model','_slug.class.php',54],['inc/users/model','_group.class.php',108],['inc/regional/model','_currency.class.php',49],['inc/regional/model','_region.class.php',51],['inc/chapters/model','_chapter.class.php',144],['inc/sessions/model','_goalcat.class.php',46],['inc/files/model','_file.class.php',274],['inc/items/model','_itemlight.class.php',161],['inc/users/model','_userfieldgroup.class.php',51],['inc/users/model','_organization.class.php',54]], 1],
'update_avatar': ['update_avatar', 'Update user avatar file ', [['inc/users/model','_user.class.php',4651]], 2],
'get_link': ['get_link', 'Get link to User ', [['inc/users/model','_user.class.php',1276]], 1],
'is_valid_login': ['is_valid_login', 'Check if the login is valid (in terms of allowed chars) ', [['inc/_core','_misc.funcs.php',1896]], 3],
'get_organizations': ['get_organizations', 'Get organizations that are accepted for this user ', [['inc/users/model','_user.class.php',6028]], 2],
'remove_avatar': ['remove_avatar', 'Remove user avatar ', [['inc/users/model','_user.class.php',4933]], 2],
'param_check_valid_login': ['param_check_valid_login', 'Check if the value is a valid login (in terms of allowed chars) ', [['inc/_core','_param.funcs.php',741]], 5],
'set_datecreated': ['set_datecreated', 'Set date created. ', [['inc/users/model','_user.class.php',2102]], 6],
'get_colored_login': ['get_colored_login', 'Get user\'s login with gender color ', [['inc/users/model','_user.class.php',1372]], 21],
'url_part': ['url_part', 'Get part of url, Based on function parse_url() ', [['inc/_core','_url.funcs.php',954]], 4],
'utf8_strtolower': ['utf8_strtolower', 'utf8_strtolower( ) ', [['inc/_ext','_portable_utf8.php',1433]], 74],
'strip_tags': ['strip_tags', '', [], 53],
'is_null': ['is_null', '', [], 299],
'defined': ['defined', '', [], 962],
'is_writable': ['is_writable', '', [], 13],
'array_key_exists': ['array_key_exists', '', [], 62],
'count': ['count', '', [], 928],
'strtotime': ['strtotime', '', [], 46],
'explode': ['explode', '', [], 263],
'preg_match': ['preg_match', '', [], 423],
'floor': ['floor', '', [], 116],
'preg_replace': ['preg_replace', '', [], 325],
'rand': ['rand', '', [], 21],
'is_object': ['is_object', '', [], 70],
'rawurlencode': ['rawurlencode', '', [], 137],
'get_class': ['get_class', '', [], 30],
'rename': ['rename', '', [], 26],
'array_keys': ['array_keys', '', [], 94],
'strpos': ['strpos', '', [], 347],
'ceil': ['ceil', '', [], 96],
'call_user_func': ['call_user_func', '', [], 17],
'in_array': ['in_array', '', [], 417],
'is_dir': ['is_dir', '', [], 92],
'file_exists': ['file_exists', '', [], 142],
'fileperms': ['fileperms', '', [], 4],
'array_merge': ['array_merge', '', [], 702],
'dirname': ['dirname', '', [], 182],
'time': ['time', '', [], 76],
'trim': ['trim', '', [], 398],
'intval': ['intval', '', [], 221],
'is_array': ['is_array', '', [], 311],
'date': ['date', '', [], 446],
'nl2br': ['nl2br', '', [], 21],
'implode': ['implode', '', [], 571],
'number_format': ['number_format', '', [], 21],
'is_a': ['is_a', '', [], 39],
'array_diff': ['array_diff', '', [], 31],
'str_replace': ['str_replace', '', [], 531],
'unlink': ['unlink', '', [], 61],
'substr': ['substr', '', [], 745]};
CLASS_DATA={
'domain': ['domain', 'Slug Class ', [['inc/sessions/model','_domain.class.php',21]], 23],
'blockcache': ['blockcache', 'Block Cache. ', [['inc/_core/model','_blockcache.class.php',19]], 16],
'user': ['user', 'User Class ', [['inc/users/model','_user.class.php',24]], 175],
'blog': ['blog', 'Blog ', [['inc/collections/model','_blog.class.php',20]], 76],
'module': ['module', 'Module class (only useful if derived) ', [['inc/_core/model','_module.class.php',14]], 3],
'thread': ['thread', 'Thread Class ', [['inc/messaging/model','_thread.class.php',19]], 35],
'sql': ['sql', 'SQL class: help constructing queries ', [['inc/_core/model/db','_sql.class.php',17]], 334],
'emailaddress': ['emailaddress', 'Email Address Class ', [['inc/tools/model','_emailaddress.class.php',22]], 5],
'fileroot': ['fileroot', 'This class provides info about a File Root. ', [['inc/files/model','_fileroot.class.php',17]], 7],
'dataobject': ['dataobject', 'Data Object Base Class ', [['inc/_core/model/dataobjects','_dataobject.class.php',18]], 37],
'organization': ['organization', 'User Invitation Code ', [['inc/users/model','_organization.class.php',18]], 28],
'linkuser': ['linkuser', 'LinkUser Class ', [['inc/links/model','_linkuser.class.php',16]], 8],
'iprange': ['iprange', 'Slug Class ', [['inc/antispam/model','_iprange.class.php',21]], 4],
'message': ['message', 'Message Class ', [['inc/messaging/model','_message.class.php',19]], 42]};
CONST_DATA={
'EVO_MAIN_INIT': ['EVO_MAIN_INIT', '', [['install','index.php',26],['inc','_main.inc.php',36],['install','debug.php',22]], 912]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Nov 21 22:13:19 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
