<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /inc/sessions/model/_session.class.php source</title>
    <link rel="stylesheet" href="../../../sample.css" type="text/css">
    <link rel="stylesheet" href="../../../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../../../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Nov 21 22:13:19 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../../../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../../../';
subdir='inc/sessions/model';
filename='_session.class.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../../../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../../../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../../../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../../../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/inc/sessions/model/</a> -> <a href="_session.class.php.html">_session.class.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="_session.class.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="_session.class.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This file implements the Session class and holds the</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> * {@link session_unserialize_callback()} function used by it.</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> *</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> * A session can be bound to a user and provides functions to store data in its</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * context.</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> * All Hitlogs are also bound to a Session.</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> *</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> * This file is part of the evoCore framework - {@link http://evocore.net/}</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * See also {@link https://github.com/b2evolution/b2evolution}.</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> *</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * @license GNU GPL v2 - {@link http://b2evolution.net/about/gnu-gpl-license}</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> *</span>
<a name="l15"><span class="linenum">  15</span></a>  <span class="comment"> * @copyright (c)2003-2015 by Francois Planque - {@link http://fplanque.com/}</span>
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment"> * Parts of this file are copyright (c)2004-2006 by Daniel HAHLER - {@link http://thequod.de/contact}.</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> *</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> * @package evocore</span>
<a name="l19"><span class="linenum">  19</span></a>  <span class="comment"> */</span>
<a name="l20"><span class="linenum">  20</span></a>  if( !<a class="phpfunction" onClick="logFunction('defined')" href="../../../_functions/defined.html" onMouseOver="phpfuncPopup(event,'defined')">defined</a>('<a class="constant" onClick="logConstant('EVO_MAIN_INIT')" href="../../../_constants/EVO_MAIN_INIT.html" onMouseOver="constPopup(event,'EVO_MAIN_INIT')">EVO_MAIN_INIT</a>') ) die( 'Please, do not access this page directly.' );
<a name="l21"><span class="linenum">  21</span></a>  
<a name="l22"><span class="linenum">  22</span></a>  
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment">/**</span>
<a name="l24"><span class="linenum">  24</span></a>  <span class="comment"> * A session tracks a given user (not necessarily logged in) while he's navigating the site.</span>
<a name="l25"><span class="linenum">  25</span></a>  <span class="comment"> * A session also stores data for the length of the session.</span>
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment"> *</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * Sessions are tracked with a cookie containing the session ID.</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> * The cookie also contains a random key to prevent sessions hacking.</span>
<a name="l29"><span class="linenum">  29</span></a>  <span class="comment"> *</span>
<a name="l30"><span class="linenum">  30</span></a>  <span class="comment"> * @package evocore</span>
<a name="l31"><span class="linenum">  31</span></a>  <span class="comment"> */</span>
<a name="l32"><span class="linenum">  32</span></a>  <span class="keyword">class </span><a class="class" onClick="logClass('Session')" href="../../../_classes/session.html" onMouseOver="classPopup(event,'session')">Session</a>
<a name="l33"><span class="linenum">  33</span></a>  {
<a name="l34"><span class="linenum">  34</span></a>      <span class="comment">/**</span>
<a name="l35"><span class="linenum">  35</span></a>  <span class="comment">     * The ID of the session.</span>
<a name="l36"><span class="linenum">  36</span></a>  <span class="comment">     * @var integer</span>
<a name="l37"><span class="linenum">  37</span></a>  <span class="comment">     */</span>
<a name="l38"><span class="linenum">  38</span></a>      var <a class="var it139" onMouseOver="hilite(139)" onMouseOut="lolite()" onClick="logVariable('ID')" href="../../../_variables/ID.html">$ID</a>;
<a name="l39"><span class="linenum">  39</span></a>  
<a name="l40"><span class="linenum">  40</span></a>      <span class="comment">/**</span>
<a name="l41"><span class="linenum">  41</span></a>  <span class="comment">     * The session key (to be used in URLs).</span>
<a name="l42"><span class="linenum">  42</span></a>  <span class="comment">     * @var string</span>
<a name="l43"><span class="linenum">  43</span></a>  <span class="comment">     */</span>
<a name="l44"><span class="linenum">  44</span></a>      var <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('key')" href="../../../_variables/key.html">$key</a>;
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>      <span class="comment">/**</span>
<a name="l47"><span class="linenum">  47</span></a>  <span class="comment">     * The user ID for the user of the session (NULL for anonymous (not logged in) user).</span>
<a name="l48"><span class="linenum">  48</span></a>  <span class="comment">     *</span>
<a name="l49"><span class="linenum">  49</span></a>  <span class="comment">     * @var integer</span>
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">     */</span>
<a name="l51"><span class="linenum">  51</span></a>      var <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>;
<a name="l52"><span class="linenum">  52</span></a>  
<a name="l53"><span class="linenum">  53</span></a>      <span class="comment">/**</span>
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">     * Is the session validated?</span>
<a name="l55"><span class="linenum">  55</span></a>  <span class="comment">     * This means that it was created from a received cookie.</span>
<a name="l56"><span class="linenum">  56</span></a>  <span class="comment">     * @var boolean</span>
<a name="l57"><span class="linenum">  57</span></a>  <span class="comment">     */</span>
<a name="l58"><span class="linenum">  58</span></a>      var <a class="var it6669" onMouseOver="hilite(6669)" onMouseOut="lolite()" onClick="logVariable('is_validated')" href="../../../_variables/is_validated.html">$is_validated</a> = false;
<a name="l59"><span class="linenum">  59</span></a>  
<a name="l60"><span class="linenum">  60</span></a>      <span class="comment">/**</span>
<a name="l61"><span class="linenum">  61</span></a>  <span class="comment">     * Session start timestamp</span>
<a name="l62"><span class="linenum">  62</span></a>  <span class="comment">     * @var string</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">     */</span>
<a name="l64"><span class="linenum">  64</span></a>      var <a class="var it6670" onMouseOver="hilite(6670)" onMouseOut="lolite()" onClick="logVariable('start_ts')" href="../../../_variables/start_ts.html">$start_ts</a>;
<a name="l65"><span class="linenum">  65</span></a>  
<a name="l66"><span class="linenum">  66</span></a>      <span class="comment">/**</span>
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">     * Session last seen timestamp which was logged</span>
<a name="l68"><span class="linenum">  68</span></a>  <span class="comment">     * Value may be off by up to 60 seconds</span>
<a name="l69"><span class="linenum">  69</span></a>  <span class="comment">     * @var string</span>
<a name="l70"><span class="linenum">  70</span></a>  <span class="comment">     */</span>
<a name="l71"><span class="linenum">  71</span></a>      var <a class="var it630" onMouseOver="hilite(630)" onMouseOut="lolite()" onClick="logVariable('lastseen_ts')" href="../../../_variables/lastseen_ts.html">$lastseen_ts</a>;
<a name="l72"><span class="linenum">  72</span></a>  
<a name="l73"><span class="linenum">  73</span></a>      <span class="comment">/**</span>
<a name="l74"><span class="linenum">  74</span></a>  <span class="comment">     * Data stored for the session.</span>
<a name="l75"><span class="linenum">  75</span></a>  <span class="comment">     *</span>
<a name="l76"><span class="linenum">  76</span></a>  <span class="comment">     * This holds an array( expire, value ) for each data item key.</span>
<a name="l77"><span class="linenum">  77</span></a>  <span class="comment">     *</span>
<a name="l78"><span class="linenum">  78</span></a>  <span class="comment">     * @access protected</span>
<a name="l79"><span class="linenum">  79</span></a>  <span class="comment">     * @var array</span>
<a name="l80"><span class="linenum">  80</span></a>  <span class="comment">     */</span>
<a name="l81"><span class="linenum">  81</span></a>      var <a class="var it6671" onMouseOver="hilite(6671)" onMouseOut="lolite()" onClick="logVariable('_data')" href="../../../_variables/_data.html">$_data</a>;
<a name="l82"><span class="linenum">  82</span></a>  
<a name="l83"><span class="linenum">  83</span></a>      var <a class="var it6672" onMouseOver="hilite(6672)" onMouseOut="lolite()" onClick="logVariable('_session_needs_save')" href="../../../_variables/_session_needs_save.html">$_session_needs_save</a> = false;
<a name="l84"><span class="linenum">  84</span></a>  
<a name="l85"><span class="linenum">  85</span></a>      <span class="comment">/**</span>
<a name="l86"><span class="linenum">  86</span></a>  <span class="comment">     * The user device from where this session was created</span>
<a name="l87"><span class="linenum">  87</span></a>  <span class="comment">     *</span>
<a name="l88"><span class="linenum">  88</span></a>  <span class="comment">     * @var string</span>
<a name="l89"><span class="linenum">  89</span></a>  <span class="comment">     */</span>
<a name="l90"><span class="linenum">  90</span></a>      var <a class="var it6673" onMouseOver="hilite(6673)" onMouseOut="lolite()" onClick="logVariable('sess_device')" href="../../../_variables/sess_device.html">$sess_device</a>;
<a name="l91"><span class="linenum">  91</span></a>  
<a name="l92"><span class="linenum">  92</span></a>      <span class="comment">/**</span>
<a name="l93"><span class="linenum">  93</span></a>  <span class="comment">     * Constructor</span>
<a name="l94"><span class="linenum">  94</span></a>  <span class="comment">     *</span>
<a name="l95"><span class="linenum">  95</span></a>  <span class="comment">     * If valid session cookie received: pull session from DB</span>
<a name="l96"><span class="linenum">  96</span></a>  <span class="comment">     * Otherwise, INSERT a session into DB</span>
<a name="l97"><span class="linenum">  97</span></a>  <span class="comment">     */</span>
<a name="l98"><span class="linenum">  98</span></a>  	function <a class="function" onClick="logFunction('Session')" href="../../../_functions/session.html" onMouseOver="funcPopup(event,'session')">Session</a>()
<a name="l99"><span class="linenum">  99</span></a>      {
<a name="l100"><span class="linenum"> 100</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>, <a class="var it113" onMouseOver="hilite(113)" onMouseOut="lolite()" onClick="logVariable('current_User')" href="../../../_variables/current_User.html">$current_User</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>, <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>, <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>;
<a name="l101"><span class="linenum"> 101</span></a>          global <a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('Hit')" href="../../../_variables/Hit.html">$Hit</a>;
<a name="l102"><span class="linenum"> 102</span></a>          global <a class="var it4326" onMouseOver="hilite(4326)" onMouseOut="lolite()" onClick="logVariable('cookie_session')" href="../../../_variables/cookie_session.html">$cookie_session</a>, <a class="var it4327" onMouseOver="hilite(4327)" onMouseOut="lolite()" onClick="logVariable('cookie_expires')" href="../../../_variables/cookie_expires.html">$cookie_expires</a>, <a class="var it4182" onMouseOver="hilite(4182)" onMouseOut="lolite()" onClick="logVariable('cookie_path')" href="../../../_variables/cookie_path.html">$cookie_path</a>, <a class="var it887" onMouseOver="hilite(887)" onMouseOut="lolite()" onClick="logVariable('cookie_domain')" href="../../../_variables/cookie_domain.html">$cookie_domain</a>;
<a name="l103"><span class="linenum"> 103</span></a>  
<a name="l104"><span class="linenum"> 104</span></a>          <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: cookie_domain='.<a class="var it887" onMouseOver="hilite(887)" onMouseOut="lolite()" onClick="logVariable('cookie_domain')" href="../../../_variables/cookie_domain.html">$cookie_domain</a>, 'request' );
<a name="l105"><span class="linenum"> 105</span></a>          <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: cookie_path='.<a class="var it4182" onMouseOver="hilite(4182)" onMouseOut="lolite()" onClick="logVariable('cookie_path')" href="../../../_variables/cookie_path.html">$cookie_path</a>, 'request' );
<a name="l106"><span class="linenum"> 106</span></a>  
<a name="l107"><span class="linenum"> 107</span></a>          <a class="var it6674" onMouseOver="hilite(6674)" onMouseOut="lolite()" onClick="logVariable('session_cookie')" href="../../../_variables/session_cookie.html">$session_cookie</a> = <a class="function" onClick="logFunction('param_cookie')" href="../../../_functions/param_cookie.html" onMouseOver="funcPopup(event,'param_cookie')">param_cookie</a>( <a class="var it4326" onMouseOver="hilite(4326)" onMouseOut="lolite()" onClick="logVariable('cookie_session')" href="../../../_variables/cookie_session.html">$cookie_session</a>, 'string', '' );
<a name="l108"><span class="linenum"> 108</span></a>          if( empty( <a class="var it6674" onMouseOver="hilite(6674)" onMouseOut="lolite()" onClick="logVariable('session_cookie')" href="../../../_variables/session_cookie.html">$session_cookie</a> ) )
<a name="l109"><span class="linenum"> 109</span></a>          {
<a name="l110"><span class="linenum"> 110</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: No session cookie received.', 'request' );
<a name="l111"><span class="linenum"> 111</span></a>          }
<a name="l112"><span class="linenum"> 112</span></a>          else
<a name="l113"><span class="linenum"> 113</span></a>          { // session ID sent by cookie
<a name="l114"><span class="linenum"> 114</span></a>              if( ! <a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '~^(\d+)_(\w+)$~', <a class="var it6674" onMouseOver="hilite(6674)" onMouseOut="lolite()" onClick="logVariable('session_cookie')" href="../../../_variables/session_cookie.html">$session_cookie</a>, <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a> ) )
<a name="l115"><span class="linenum"> 115</span></a>              {
<a name="l116"><span class="linenum"> 116</span></a>                  <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Invalid session cookie format!', 'request' );
<a name="l117"><span class="linenum"> 117</span></a>              }
<a name="l118"><span class="linenum"> 118</span></a>              else
<a name="l119"><span class="linenum"> 119</span></a>              {    // We have a valid session cookie:
<a name="l120"><span class="linenum"> 120</span></a>                  <a class="var it6675" onMouseOver="hilite(6675)" onMouseOut="lolite()" onClick="logVariable('session_id_by_cookie')" href="../../../_variables/session_id_by_cookie.html">$session_id_by_cookie</a> = <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>[1];
<a name="l121"><span class="linenum"> 121</span></a>                  <a class="var it6676" onMouseOver="hilite(6676)" onMouseOut="lolite()" onClick="logVariable('session_key_by_cookie')" href="../../../_variables/session_key_by_cookie.html">$session_key_by_cookie</a> = <a class="var it32" onMouseOver="hilite(32)" onMouseOut="lolite()" onClick="logVariable('match')" href="../../../_variables/match.html">$match</a>[2];
<a name="l122"><span class="linenum"> 122</span></a>  
<a name="l123"><span class="linenum"> 123</span></a>                  <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session ID received from cookie: '.<a class="var it6675" onMouseOver="hilite(6675)" onMouseOut="lolite()" onClick="logVariable('session_id_by_cookie')" href="../../../_variables/session_id_by_cookie.html">$session_id_by_cookie</a>, 'request' );
<a name="l124"><span class="linenum"> 124</span></a>  
<a name="l125"><span class="linenum"> 125</span></a>                  <a class="var it6677" onMouseOver="hilite(6677)" onMouseOut="lolite()" onClick="logVariable('timeout_sessions')" href="../../../_variables/timeout_sessions.html">$timeout_sessions</a> = NULL;
<a name="l126"><span class="linenum"> 126</span></a>                  if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> != NULL )
<a name="l127"><span class="linenum"> 127</span></a>                  {    // User is not anonymous, get custom session timeout (may return NULL):
<a name="l128"><span class="linenum"> 128</span></a>                      <a class="var it6677" onMouseOver="hilite(6677)" onMouseOut="lolite()" onClick="logVariable('timeout_sessions')" href="../../../_variables/timeout_sessions.html">$timeout_sessions</a> = <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'timeout_sessions', <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> );
<a name="l129"><span class="linenum"> 129</span></a>                  }
<a name="l130"><span class="linenum"> 130</span></a>  
<a name="l131"><span class="linenum"> 131</span></a>                  if( empty( <a class="var it6677" onMouseOver="hilite(6677)" onMouseOut="lolite()" onClick="logVariable('timeout_sessions')" href="../../../_variables/timeout_sessions.html">$timeout_sessions</a> ) )
<a name="l132"><span class="linenum"> 132</span></a>                  {    // User is anonymous or has no custom session timeout. So, we use default session timeout:
<a name="l133"><span class="linenum"> 133</span></a>                      <a class="var it6677" onMouseOver="hilite(6677)" onMouseOut="lolite()" onClick="logVariable('timeout_sessions')" href="../../../_variables/timeout_sessions.html">$timeout_sessions</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('timeout_sessions');
<a name="l134"><span class="linenum"> 134</span></a>                  }
<a name="l135"><span class="linenum"> 135</span></a>  
<a name="l136"><span class="linenum"> 136</span></a>                  <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_row')" href="../../../_functions/get_row.html" onMouseOver="funcPopup(event,'get_row')">get_row</a>( '
<a name="l137"><span class="linenum"> 137</span></a>                      SELECT sess_ID, sess_key, sess_data, sess_user_ID, sess_start_ts, sess_lastseen_ts, sess_device
<a name="l138"><span class="linenum"> 138</span></a>                        FROM T_sessions
<a name="l139"><span class="linenum"> 139</span></a>                       WHERE sess_ID  = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it6675" onMouseOver="hilite(6675)" onMouseOut="lolite()" onClick="logVariable('session_id_by_cookie')" href="../../../_variables/session_id_by_cookie.html">$session_id_by_cookie</a>).'
<a name="l140"><span class="linenum"> 140</span></a>                         AND sess_key = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it6676" onMouseOver="hilite(6676)" onMouseOut="lolite()" onClick="logVariable('session_key_by_cookie')" href="../../../_variables/session_key_by_cookie.html">$session_key_by_cookie</a>).'
<a name="l141"><span class="linenum"> 141</span></a>                         AND UNIX_TIMESTAMP(sess_lastseen_ts) &gt; '.( <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> - <a class="var it6677" onMouseOver="hilite(6677)" onMouseOut="lolite()" onClick="logVariable('timeout_sessions')" href="../../../_variables/timeout_sessions.html">$timeout_sessions</a> ) );
<a name="l142"><span class="linenum"> 142</span></a>                  if( empty( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a> ) )
<a name="l143"><span class="linenum"> 143</span></a>                  {
<a name="l144"><span class="linenum"> 144</span></a>                      <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session ID/key combination is invalid!', 'request' );
<a name="l145"><span class="linenum"> 145</span></a>                  }
<a name="l146"><span class="linenum"> 146</span></a>                  else
<a name="l147"><span class="linenum"> 147</span></a>                  { // ID + key are valid: load data
<a name="l148"><span class="linenum"> 148</span></a>                      <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session ID is valid.', 'request' );
<a name="l149"><span class="linenum"> 149</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_ID.html">sess_ID</a>;
<a name="l150"><span class="linenum"> 150</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('key')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/key.html">key</a> = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_key')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_key.html">sess_key</a>;
<a name="l151"><span class="linenum"> 151</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_user_ID')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_user_ID.html">sess_user_ID</a>;
<a name="l152"><span class="linenum"> 152</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('start_ts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/start_ts.html">start_ts</a> = <a class="function" onClick="logFunction('mysql2timestamp')" href="../../../_functions/mysql2timestamp.html" onMouseOver="funcPopup(event,'mysql2timestamp')">mysql2timestamp</a>( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_start_ts')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_start_ts.html">sess_start_ts</a> );
<a name="l153"><span class="linenum"> 153</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastseen_ts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastseen_ts.html">lastseen_ts</a> = <a class="function" onClick="logFunction('mysql2timestamp')" href="../../../_functions/mysql2timestamp.html" onMouseOver="funcPopup(event,'mysql2timestamp')">mysql2timestamp</a>( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_lastseen_ts')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_lastseen_ts.html">sess_lastseen_ts</a> );
<a name="l154"><span class="linenum"> 154</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('is_validated')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/is_validated.html">is_validated</a> = true;
<a name="l155"><span class="linenum"> 155</span></a>                      <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a> = <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a>;
<a name="l156"><span class="linenum"> 156</span></a>  
<a name="l157"><span class="linenum"> 157</span></a>                      <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session user_ID: '.<a class="phpfunction" onClick="logFunction('var_export')" href="../../../_functions/var_export.html" onMouseOver="phpfuncPopup(event,'var_export')">var_export</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a>, true), 'request' );
<a name="l158"><span class="linenum"> 158</span></a>  
<a name="l159"><span class="linenum"> 159</span></a>                      if( empty( <a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_data')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_data.html">sess_data</a> ) )
<a name="l160"><span class="linenum"> 160</span></a>                      {
<a name="l161"><span class="linenum"> 161</span></a>                          <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: No session data available.', 'request' );
<a name="l162"><span class="linenum"> 162</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a> = array();
<a name="l163"><span class="linenum"> 163</span></a>                      }
<a name="l164"><span class="linenum"> 164</span></a>                      else
<a name="l165"><span class="linenum"> 165</span></a>                      { // Some session data has been previsouly stored:
<a name="l166"><span class="linenum"> 166</span></a>  
<a name="l167"><span class="linenum"> 167</span></a>  <span class="comment">                        // Unserialize session data (using an own callback that should provide class definitions):</span>
<a name="l168"><span class="linenum"> 168</span></a>                          <a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('old_callback')" href="../../../_variables/old_callback.html">$old_callback</a> = <a class="phpfunction" onClick="logFunction('ini_set')" href="../../../_functions/ini_set.html" onMouseOver="phpfuncPopup(event,'ini_set')">ini_set</a>( 'unserialize_callback_func', 'session_unserialize_callback' );
<a name="l169"><span class="linenum"> 169</span></a>                          if( <a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('old_callback')" href="../../../_variables/old_callback.html">$old_callback</a> === false || <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('old_callback')" href="../../../_variables/old_callback.html">$old_callback</a>) <span class="comment">/* disabled, reported with PHP 5.2.5 */</span> )
<a name="l170"><span class="linenum"> 170</span></a>                          {    // NULL if ini_set has been disabled for security reasons
<a name="l171"><span class="linenum"> 171</span></a>  <span class="comment">                            // Brutally load all classes that we might need:</span>
<a name="l172"><span class="linenum"> 172</span></a>                               <a class="function" onClick="logFunction('session_unserialize_load_all_classes')" href="../../../_functions/session_unserialize_load_all_classes.html" onMouseOver="funcPopup(event,'session_unserialize_load_all_classes')">session_unserialize_load_all_classes</a>();
<a name="l173"><span class="linenum"> 173</span></a>                          }
<a name="l174"><span class="linenum"> 174</span></a>  <span class="comment">                        // TODO: dh&gt; This can fail, if there are special chars in sess_data:</span>
<a name="l175"><span class="linenum"> 175</span></a>  <span class="comment">                        //       It will be encoded in $evo_charset _after_ mysqli::set_charset but</span>
<a name="l176"><span class="linenum"> 176</span></a>  <span class="comment">                        //       get retrieved here, _before_ any mysqli::set_charset (if $db_config['connection_charset'] is not set (default))!</span>
<a name="l177"><span class="linenum"> 177</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a> = @<a class="phpfunction" onClick="logFunction('unserialize')" href="../../../_functions/unserialize.html" onMouseOver="phpfuncPopup(event,'unserialize')">unserialize</a>(<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_data')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_data.html">sess_data</a>);
<a name="l178"><span class="linenum"> 178</span></a>  
<a name="l179"><span class="linenum"> 179</span></a>                          if( <a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('old_callback')" href="../../../_variables/old_callback.html">$old_callback</a> !== false )
<a name="l180"><span class="linenum"> 180</span></a>                          {    // Restore the old callback if we changed it:
<a name="l181"><span class="linenum"> 181</span></a>                              <a class="phpfunction" onClick="logFunction('ini_set')" href="../../../_functions/ini_set.html" onMouseOver="phpfuncPopup(event,'ini_set')">ini_set</a>( 'unserialize_callback_func', <a class="var it6683" onMouseOver="hilite(6683)" onMouseOut="lolite()" onClick="logVariable('old_callback')" href="../../../_variables/old_callback.html">$old_callback</a> );
<a name="l182"><span class="linenum"> 182</span></a>                          }
<a name="l183"><span class="linenum"> 183</span></a>  
<a name="l184"><span class="linenum"> 184</span></a>                          if( ! <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>) )
<a name="l185"><span class="linenum"> 185</span></a>                          {
<a name="l186"><span class="linenum"> 186</span></a>                              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session data corrupted!&lt;br /&gt;
<a name="l187"><span class="linenum"> 187</span></a>                                  connection_charset: '.<a class="phpfunction" onClick="logFunction('var_export')" href="../../../_functions/var_export.html" onMouseOver="phpfuncPopup(event,'var_export')">var_export</a>(<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('connection_charset')" class="var it10754" onMouseOver="hilite(10754)" onMouseOut="lolite()" href="../../../_variables/connection_charset.html">connection_charset</a>, true).'&lt;br /&gt;
<a name="l188"><span class="linenum"> 188</span></a>                                  Serialized data was: --['.<a class="phpfunction" onClick="logFunction('var_export')" href="../../../_functions/var_export.html" onMouseOver="phpfuncPopup(event,'var_export')">var_export</a>(<a class="var it516" onMouseOver="hilite(516)" onMouseOut="lolite()" onClick="logVariable('row')" href="../../../_variables/row.html">$row</a>-&gt;<a onClick="logVariable('sess_data')" class="var it10731" onMouseOver="hilite(10731)" onMouseOut="lolite()" href="../../../_variables/sess_data.html">sess_data</a>, true).']--', array('session','error') );
<a name="l189"><span class="linenum"> 189</span></a>                              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a> = array();
<a name="l190"><span class="linenum"> 190</span></a>                          }
<a name="l191"><span class="linenum"> 191</span></a>                          else
<a name="l192"><span class="linenum"> 192</span></a>                          {
<a name="l193"><span class="linenum"> 193</span></a>                              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session data loaded.', 'request' );
<a name="l194"><span class="linenum"> 194</span></a>  
<a name="l195"><span class="linenum"> 195</span></a>  <span class="comment">                            // Load a Messages object from session data, if available:</span>
<a name="l196"><span class="linenum"> 196</span></a>                              if( (<a class="var it6684" onMouseOver="hilite(6684)" onMouseOut="lolite()" onClick="logVariable('sess_Messages')" href="../../../_variables/sess_Messages.html">$sess_Messages</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('Messages')) &amp;&amp; <a class="phpfunction" onClick="logFunction('is_a')" href="../../../_functions/is_a.html" onMouseOver="phpfuncPopup(event,'is_a')">is_a</a>( <a class="var it6684" onMouseOver="hilite(6684)" onMouseOut="lolite()" onClick="logVariable('sess_Messages')" href="../../../_variables/sess_Messages.html">$sess_Messages</a>, 'Messages' ) )
<a name="l197"><span class="linenum"> 197</span></a>                              {
<a name="l198"><span class="linenum"> 198</span></a>  <span class="comment">                                // dh&gt; TODO: &quot;old&quot; messages should rather get prepended to any existing ones from the current request, rather than appended</span>
<a name="l199"><span class="linenum"> 199</span></a>                                  <a class="var it26" onMouseOver="hilite(26)" onMouseOut="lolite()" onClick="logVariable('Messages')" href="../../../_variables/Messages.html">$Messages</a>-&gt;<a class="function" onClick="logFunction('add_messages')" href="../../../_functions/add_messages.html" onMouseOver="funcPopup(event,'add_messages')">add_messages</a>( <a class="var it6684" onMouseOver="hilite(6684)" onMouseOut="lolite()" onClick="logVariable('sess_Messages')" href="../../../_variables/sess_Messages.html">$sess_Messages</a> );
<a name="l200"><span class="linenum"> 200</span></a>                                  <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Added Messages from session data.', 'request' );
<a name="l201"><span class="linenum"> 201</span></a>                                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( 'Messages' );
<a name="l202"><span class="linenum"> 202</span></a>                              }
<a name="l203"><span class="linenum"> 203</span></a>                          }
<a name="l204"><span class="linenum"> 204</span></a>                      }
<a name="l205"><span class="linenum"> 205</span></a>                  }
<a name="l206"><span class="linenum"> 206</span></a>              }
<a name="l207"><span class="linenum"> 207</span></a>          }
<a name="l208"><span class="linenum"> 208</span></a>  
<a name="l209"><span class="linenum"> 209</span></a>  
<a name="l210"><span class="linenum"> 210</span></a>          if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> )
<a name="l211"><span class="linenum"> 211</span></a>          { // there was a valid session before
<a name="l212"><span class="linenum"> 212</span></a>              if( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('lastseen_ts')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/lastseen_ts.html">lastseen_ts</a> &lt; <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> - 60 )
<a name="l213"><span class="linenum"> 213</span></a>              { // lastseen timestamp is older then a minute, it needs to be updated at page exit
<a name="l214"><span class="linenum"> 214</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( true );
<a name="l215"><span class="linenum"> 215</span></a>              }
<a name="l216"><span class="linenum"> 216</span></a>          }
<a name="l217"><span class="linenum"> 217</span></a>          else
<a name="l218"><span class="linenum"> 218</span></a>          { // create a <span class="keyword">new </span><a class="class" onClick="logClass('session')" href="../../../_classes/session.html" onMouseOver="classPopup(event,'session')">session</a>! :
<a name="l219"><span class="linenum"> 219</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('key')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/key.html">key</a> = <a class="function" onClick="logFunction('generate_random_key')" href="../../../_functions/generate_random_key.html" onMouseOver="funcPopup(event,'generate_random_key')">generate_random_key</a>(32);
<a name="l220"><span class="linenum"> 220</span></a>  
<a name="l221"><span class="linenum"> 221</span></a>  <span class="comment">            // Detect user device</span>
<a name="l222"><span class="linenum"> 222</span></a>              global <a class="var it4764" onMouseOver="hilite(4764)" onMouseOut="lolite()" onClick="logVariable('user_devices')" href="../../../_variables/user_devices.html">$user_devices</a>;
<a name="l223"><span class="linenum"> 223</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a> = '';
<a name="l224"><span class="linenum"> 224</span></a>  
<a name="l225"><span class="linenum"> 225</span></a>              if( !empty(<a class="var it142" onMouseOver="hilite(142)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../../_variables/_SERVER.html">$_SERVER</a>['HTTP_USER_AGENT']) )
<a name="l226"><span class="linenum"> 226</span></a>              {
<a name="l227"><span class="linenum"> 227</span></a>                  foreach( <a class="var it4764" onMouseOver="hilite(4764)" onMouseOut="lolite()" onClick="logVariable('user_devices')" href="../../../_variables/user_devices.html">$user_devices</a> as <a class="var it6685" onMouseOver="hilite(6685)" onMouseOut="lolite()" onClick="logVariable('device_name')" href="../../../_variables/device_name.html">$device_name</a> =&gt; <a class="var it6686" onMouseOver="hilite(6686)" onMouseOut="lolite()" onClick="logVariable('device_regexp')" href="../../../_variables/device_regexp.html">$device_regexp</a> )
<a name="l228"><span class="linenum"> 228</span></a>                  {
<a name="l229"><span class="linenum"> 229</span></a>                      if( <a class="phpfunction" onClick="logFunction('preg_match')" href="../../../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '~'.<a class="var it6686" onMouseOver="hilite(6686)" onMouseOut="lolite()" onClick="logVariable('device_regexp')" href="../../../_variables/device_regexp.html">$device_regexp</a>.'~i', <a class="var it142" onMouseOver="hilite(142)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../../_variables/_SERVER.html">$_SERVER</a>['HTTP_USER_AGENT'] ) )
<a name="l230"><span class="linenum"> 230</span></a>                      {
<a name="l231"><span class="linenum"> 231</span></a>                          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a> = <a class="var it6685" onMouseOver="hilite(6685)" onMouseOut="lolite()" onClick="logVariable('device_name')" href="../../../_variables/device_name.html">$device_name</a>;
<a name="l232"><span class="linenum"> 232</span></a>                          break;
<a name="l233"><span class="linenum"> 233</span></a>                      }
<a name="l234"><span class="linenum"> 234</span></a>                  }
<a name="l235"><span class="linenum"> 235</span></a>              }
<a name="l236"><span class="linenum"> 236</span></a>  
<a name="l237"><span class="linenum"> 237</span></a>  <span class="comment">            // We need to INSERT now because we need an ID now! (for the cookie)</span>
<a name="l238"><span class="linenum"> 238</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( &quot;
<a name="l239"><span class="linenum"> 239</span></a>                  INSERT INTO T_sessions( sess_key, sess_start_ts, sess_lastseen_ts, sess_ipaddress, sess_device )
<a name="l240"><span class="linenum"> 240</span></a>                  VALUES (
<a name="l241"><span class="linenum"> 241</span></a>                      '&quot;.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('key')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/key.html">key</a>.&quot;',
<a name="l242"><span class="linenum"> 242</span></a>                      '&quot;.<a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> ).&quot;',
<a name="l243"><span class="linenum"> 243</span></a>                      '&quot;.<a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> ).&quot;',
<a name="l244"><span class="linenum"> 244</span></a>                      &quot;.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('Hit')" href="../../../_variables/Hit.html">$Hit</a>-&gt;<a onClick="logVariable('IP')" class="var it10691" onMouseOver="hilite(10691)" onMouseOut="lolite()" href="../../../_variables/IP.html">IP</a> ).&quot;,
<a name="l245"><span class="linenum"> 245</span></a>                      &quot;.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a> ).&quot;
<a name="l246"><span class="linenum"> 246</span></a>                  )&quot; );
<a name="l247"><span class="linenum"> 247</span></a>  
<a name="l248"><span class="linenum"> 248</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a onClick="logVariable('insert_id')" class="var it10754" onMouseOver="hilite(10754)" onMouseOut="lolite()" href="../../../_variables/insert_id.html">insert_id</a>;
<a name="l249"><span class="linenum"> 249</span></a>  
<a name="l250"><span class="linenum"> 250</span></a>  <span class="comment">            // Set a cookie valid for ~ 10 years:</span>
<a name="l251"><span class="linenum"> 251</span></a>              <a class="function" onClick="logFunction('evo_setcookie')" href="../../../_functions/evo_setcookie.html" onMouseOver="funcPopup(event,'evo_setcookie')">evo_setcookie</a>( <a class="var it4326" onMouseOver="hilite(4326)" onMouseOut="lolite()" onClick="logVariable('cookie_session')" href="../../../_variables/cookie_session.html">$cookie_session</a>, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>.'_'.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('key')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/key.html">key</a>, <a class="phpfunction" onClick="logFunction('time')" href="../../../_functions/time.html" onMouseOver="phpfuncPopup(event,'time')">time</a>()+315360000, <a class="var it4182" onMouseOver="hilite(4182)" onMouseOut="lolite()" onClick="logVariable('cookie_path')" href="../../../_variables/cookie_path.html">$cookie_path</a>, <a class="var it887" onMouseOver="hilite(887)" onMouseOut="lolite()" onClick="logVariable('cookie_domain')" href="../../../_variables/cookie_domain.html">$cookie_domain</a>, false, true );
<a name="l252"><span class="linenum"> 252</span></a>  
<a name="l253"><span class="linenum"> 253</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: <a class="function" onClick="logFunction('ID')" href="../../../_functions/id.html" onMouseOver="funcPopup(event,'id')">ID</a> (generated): '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>, 'request' );
<a name="l254"><span class="linenum"> 254</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Cookie sent.', 'request' );
<a name="l255"><span class="linenum"> 255</span></a>          }
<a name="l256"><span class="linenum"> 256</span></a>      }
<a name="l257"><span class="linenum"> 257</span></a>  
<a name="l258"><span class="linenum"> 258</span></a>  
<a name="l259"><span class="linenum"> 259</span></a>      <span class="comment">/**</span>
<a name="l260"><span class="linenum"> 260</span></a>  <span class="comment">     * Get this class db table config params</span>
<a name="l261"><span class="linenum"> 261</span></a>  <span class="comment">     *</span>
<a name="l262"><span class="linenum"> 262</span></a>  <span class="comment">     * @return array</span>
<a name="l263"><span class="linenum"> 263</span></a>  <span class="comment">     */</span>
<a name="l264"><span class="linenum"> 264</span></a>  	static function <a class="function" onClick="logFunction('get_class_db_config')" href="../../../_functions/get_class_db_config.html" onMouseOver="funcPopup(event,'get_class_db_config')">get_class_db_config</a>()
<a name="l265"><span class="linenum"> 265</span></a>      {
<a name="l266"><span class="linenum"> 266</span></a>          static <a class="var it6687" onMouseOver="hilite(6687)" onMouseOut="lolite()" onClick="logVariable('session_db_config')" href="../../../_variables/session_db_config.html">$session_db_config</a>;
<a name="l267"><span class="linenum"> 267</span></a>  
<a name="l268"><span class="linenum"> 268</span></a>          if( !isset( <a class="var it6687" onMouseOver="hilite(6687)" onMouseOut="lolite()" onClick="logVariable('session_db_config')" href="../../../_variables/session_db_config.html">$session_db_config</a> ) )
<a name="l269"><span class="linenum"> 269</span></a>          {
<a name="l270"><span class="linenum"> 270</span></a>              <a class="var it6687" onMouseOver="hilite(6687)" onMouseOut="lolite()" onClick="logVariable('session_db_config')" href="../../../_variables/session_db_config.html">$session_db_config</a> = array(
<a name="l271"><span class="linenum"> 271</span></a>                  'dbtablename'        =&gt; 'T_sessions',
<a name="l272"><span class="linenum"> 272</span></a>                  'dbprefix'           =&gt; 'sess_',
<a name="l273"><span class="linenum"> 273</span></a>                  'dbIDname'           =&gt; 'sess_ID',
<a name="l274"><span class="linenum"> 274</span></a>              );
<a name="l275"><span class="linenum"> 275</span></a>          }
<a name="l276"><span class="linenum"> 276</span></a>  
<a name="l277"><span class="linenum"> 277</span></a>          return <a class="var it6687" onMouseOver="hilite(6687)" onMouseOut="lolite()" onClick="logVariable('session_db_config')" href="../../../_variables/session_db_config.html">$session_db_config</a>;
<a name="l278"><span class="linenum"> 278</span></a>      }
<a name="l279"><span class="linenum"> 279</span></a>  
<a name="l280"><span class="linenum"> 280</span></a>  
<a name="l281"><span class="linenum"> 281</span></a>      <span class="comment">/**</span>
<a name="l282"><span class="linenum"> 282</span></a>  <span class="comment">     * Delete sessions from database based on where condition or by object ids</span>
<a name="l283"><span class="linenum"> 283</span></a>  <span class="comment">     *</span>
<a name="l284"><span class="linenum"> 284</span></a>  <span class="comment">     * @return array</span>
<a name="l285"><span class="linenum"> 285</span></a>  <span class="comment">     */</span>
<a name="l286"><span class="linenum"> 286</span></a>  	static function <a class="function" onClick="logFunction('db_delete_where')" href="../../../_functions/db_delete_where.html" onMouseOver="funcPopup(event,'db_delete_where')">db_delete_where</a>( <a class="var it2446" onMouseOver="hilite(2446)" onMouseOut="lolite()" onClick="logVariable('class_name')" href="../../../_variables/class_name.html">$class_name</a>, <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a>, <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> = NULL, <a class="var it106" onMouseOver="hilite(106)" onMouseOut="lolite()" onClick="logVariable('params')" href="../../../_variables/params.html">$params</a> = NULL )
<a name="l287"><span class="linenum"> 287</span></a>      {
<a name="l288"><span class="linenum"> 288</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l289"><span class="linenum"> 289</span></a>  
<a name="l290"><span class="linenum"> 290</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('begin')" href="../../../_functions/begin.html" onMouseOver="funcPopup(event,'begin')">begin</a>();
<a name="l291"><span class="linenum"> 291</span></a>  
<a name="l292"><span class="linenum"> 292</span></a>          if( ! empty( <a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a> ) )
<a name="l293"><span class="linenum"> 293</span></a>          {
<a name="l294"><span class="linenum"> 294</span></a>              <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_col')" href="../../../_functions/get_col.html" onMouseOver="funcPopup(event,'get_col')">get_col</a>( 'SELECT sess_ID FROM T_sessions WHERE '.<a class="var it2447" onMouseOver="hilite(2447)" onMouseOut="lolite()" onClick="logVariable('sql_where')" href="../../../_variables/sql_where.html">$sql_where</a> );
<a name="l295"><span class="linenum"> 295</span></a>          }
<a name="l296"><span class="linenum"> 296</span></a>  
<a name="l297"><span class="linenum"> 297</span></a>          if( ! <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> )
<a name="l298"><span class="linenum"> 298</span></a>          { // There is no session to delete
<a name="l299"><span class="linenum"> 299</span></a>              <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>();
<a name="l300"><span class="linenum"> 300</span></a>              return;
<a name="l301"><span class="linenum"> 301</span></a>          }
<a name="l302"><span class="linenum"> 302</span></a>  
<a name="l303"><span class="linenum"> 303</span></a>          <a class="var it6688" onMouseOver="hilite(6688)" onMouseOut="lolite()" onClick="logVariable('session_ids_to_delete')" href="../../../_variables/session_ids_to_delete.html">$session_ids_to_delete</a> = <a class="phpfunction" onClick="logFunction('implode')" href="../../../_functions/implode.html" onMouseOver="phpfuncPopup(event,'implode')">implode</a>( ', ', <a class="var it2448" onMouseOver="hilite(2448)" onMouseOut="lolite()" onClick="logVariable('object_ids')" href="../../../_variables/object_ids.html">$object_ids</a> );
<a name="l304"><span class="linenum"> 304</span></a>  
<a name="l305"><span class="linenum"> 305</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_hitlog WHERE hit_sess_ID IN ( '.<a class="var it6688" onMouseOver="hilite(6688)" onMouseOut="lolite()" onClick="logVariable('session_ids_to_delete')" href="../../../_variables/session_ids_to_delete.html">$session_ids_to_delete</a>.' )' );
<a name="l306"><span class="linenum"> 306</span></a>  
<a name="l307"><span class="linenum"> 307</span></a>          <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> = ( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> !== false ) ? <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( 'DELETE FROM T_sessions WHERE sess_ID IN ( '.<a class="var it6688" onMouseOver="hilite(6688)" onMouseOut="lolite()" onClick="logVariable('session_ids_to_delete')" href="../../../_variables/session_ids_to_delete.html">$session_ids_to_delete</a>.')' ) : <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l308"><span class="linenum"> 308</span></a>  
<a name="l309"><span class="linenum"> 309</span></a>          ( <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a> !== false ) ? <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('commit')" href="../../../_functions/commit.html" onMouseOver="funcPopup(event,'commit')">commit</a>() : <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('rollback')" href="../../../_functions/rollback.html" onMouseOver="funcPopup(event,'rollback')">rollback</a>();
<a name="l310"><span class="linenum"> 310</span></a>  
<a name="l311"><span class="linenum"> 311</span></a>          return <a class="var it95" onMouseOver="hilite(95)" onMouseOut="lolite()" onClick="logVariable('result')" href="../../../_variables/result.html">$result</a>;
<a name="l312"><span class="linenum"> 312</span></a>      }
<a name="l313"><span class="linenum"> 313</span></a>  
<a name="l314"><span class="linenum"> 314</span></a>  
<a name="l315"><span class="linenum"> 315</span></a>  	function <a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( <a class="var it6689" onMouseOver="hilite(6689)" onMouseOut="lolite()" onClick="logVariable('session_needs_save')" href="../../../_variables/session_needs_save.html">$session_needs_save</a> )
<a name="l316"><span class="linenum"> 316</span></a>      {
<a name="l317"><span class="linenum"> 317</span></a>  <span class="comment">        // pre_dump( 'SETTING session needs save to', $session_needs_save );</span>
<a name="l318"><span class="linenum"> 318</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_session_needs_save')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_session_needs_save.html">_session_needs_save</a> = <a class="var it6689" onMouseOver="hilite(6689)" onMouseOut="lolite()" onClick="logVariable('session_needs_save')" href="../../../_variables/session_needs_save.html">$session_needs_save</a>;
<a name="l319"><span class="linenum"> 319</span></a>      }
<a name="l320"><span class="linenum"> 320</span></a>  
<a name="l321"><span class="linenum"> 321</span></a>      <span class="comment">/**</span>
<a name="l322"><span class="linenum"> 322</span></a>  <span class="comment">     * Attach a User object to the session.</span>
<a name="l323"><span class="linenum"> 323</span></a>  <span class="comment">     *</span>
<a name="l324"><span class="linenum"> 324</span></a>  <span class="comment">     * @param User The user to attach</span>
<a name="l325"><span class="linenum"> 325</span></a>  <span class="comment">     */</span>
<a name="l326"><span class="linenum"> 326</span></a>  	function <a class="function" onClick="logFunction('set_User')" href="../../../_functions/set_user.html" onMouseOver="funcPopup(event,'set_user')">set_User</a>( <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a> )
<a name="l327"><span class="linenum"> 327</span></a>      {
<a name="l328"><span class="linenum"> 328</span></a>          return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set_user_ID')" href="../../../_functions/set_user_id.html" onMouseOver="funcPopup(event,'set_user_id')">set_user_ID</a>( <a class="var it173" onMouseOver="hilite(173)" onMouseOut="lolite()" onClick="logVariable('User')" href="../../../_variables/User.html">$User</a>-&gt;<a onClick="logVariable('ID')" class="var it10677" onMouseOver="hilite(10677)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l329"><span class="linenum"> 329</span></a>      }
<a name="l330"><span class="linenum"> 330</span></a>  
<a name="l331"><span class="linenum"> 331</span></a>  
<a name="l332"><span class="linenum"> 332</span></a>      <span class="comment">/**</span>
<a name="l333"><span class="linenum"> 333</span></a>  <span class="comment">     * Attach a user ID to the session.</span>
<a name="l334"><span class="linenum"> 334</span></a>  <span class="comment">     *</span>
<a name="l335"><span class="linenum"> 335</span></a>  <span class="comment">     * NOTE: ID gets saved to DB on shutdown. This may be a &quot;problem&quot; when querying T_sessions for sess_user_ID.</span>
<a name="l336"><span class="linenum"> 336</span></a>  <span class="comment">     *</span>
<a name="l337"><span class="linenum"> 337</span></a>  <span class="comment">     * @param integer The ID of the user to attach</span>
<a name="l338"><span class="linenum"> 338</span></a>  <span class="comment">     */</span>
<a name="l339"><span class="linenum"> 339</span></a>  	function <a class="function" onClick="logFunction('set_user_ID')" href="../../../_functions/set_user_id.html" onMouseOver="funcPopup(event,'set_user_id')">set_user_ID</a>( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> )
<a name="l340"><span class="linenum"> 340</span></a>      {
<a name="l341"><span class="linenum"> 341</span></a>          if( <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a> != <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> )
<a name="l342"><span class="linenum"> 342</span></a>          {
<a name="l343"><span class="linenum"> 343</span></a>              global <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>, <a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l344"><span class="linenum"> 344</span></a>  
<a name="l345"><span class="linenum"> 345</span></a>              <a class="var it2592" onMouseOver="hilite(2592)" onMouseOut="lolite()" onClick="logVariable('multiple_sessions')" href="../../../_variables/multiple_sessions.html">$multiple_sessions</a> = <a class="var it148" onMouseOver="hilite(148)" onMouseOut="lolite()" onClick="logVariable('Settings')" href="../../../_variables/Settings.html">$Settings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'multiple_sessions' );
<a name="l346"><span class="linenum"> 346</span></a>  
<a name="l347"><span class="linenum"> 347</span></a>              if( <a class="var it2592" onMouseOver="hilite(2592)" onMouseOut="lolite()" onClick="logVariable('multiple_sessions')" href="../../../_variables/multiple_sessions.html">$multiple_sessions</a> != 'always' &amp;&amp; ( <a class="var it2592" onMouseOver="hilite(2592)" onMouseOut="lolite()" onClick="logVariable('multiple_sessions')" href="../../../_variables/multiple_sessions.html">$multiple_sessions</a> == 'never' || !<a class="var it1135" onMouseOver="hilite(1135)" onMouseOut="lolite()" onClick="logVariable('UserSettings')" href="../../../_variables/UserSettings.html">$UserSettings</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>('login_multiple_sessions', <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>) ) )
<a name="l348"><span class="linenum"> 348</span></a>              { // The user does not want/is not allowed to have multiple sessions open at the same time:
<a name="l349"><span class="linenum"> 349</span></a>  <span class="comment">                // Invalidate previous sessions:</span>
<a name="l350"><span class="linenum"> 350</span></a>                  global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l351"><span class="linenum"> 351</span></a>                  <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Invalidating all previous user sessions, because login_multiple_sessions=0', 'request' );
<a name="l352"><span class="linenum"> 352</span></a>                  <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( '
<a name="l353"><span class="linenum"> 353</span></a>                      UPDATE T_sessions
<a name="l354"><span class="linenum"> 354</span></a>                         SET sess_key = NULL
<a name="l355"><span class="linenum"> 355</span></a>                       WHERE sess_user_ID = '.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>(<a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>).'
<a name="l356"><span class="linenum"> 356</span></a>                         AND sess_ID != '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l357"><span class="linenum"> 357</span></a>              }
<a name="l358"><span class="linenum"> 358</span></a>  
<a name="l359"><span class="linenum"> 359</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> = <a class="var it167" onMouseOver="hilite(167)" onMouseOut="lolite()" onClick="logVariable('user_ID')" href="../../../_variables/user_ID.html">$user_ID</a>;
<a name="l360"><span class="linenum"> 360</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( true );
<a name="l361"><span class="linenum"> 361</span></a>          }
<a name="l362"><span class="linenum"> 362</span></a>      }
<a name="l363"><span class="linenum"> 363</span></a>  
<a name="l364"><span class="linenum"> 364</span></a>  
<a name="l365"><span class="linenum"> 365</span></a>      <span class="comment">/**</span>
<a name="l366"><span class="linenum"> 366</span></a>  <span class="comment">     * Logout the user, by invalidating the session key and unsetting {@link $user_ID}.</span>
<a name="l367"><span class="linenum"> 367</span></a>  <span class="comment">     *</span>
<a name="l368"><span class="linenum"> 368</span></a>  <span class="comment">     * We want to keep the user in the session log, but we're unsetting {@link $user_ID}, which refers</span>
<a name="l369"><span class="linenum"> 369</span></a>  <span class="comment">     * to the current session.</span>
<a name="l370"><span class="linenum"> 370</span></a>  <span class="comment">     *</span>
<a name="l371"><span class="linenum"> 371</span></a>  <span class="comment">     * Because the session key is invalid/broken, on the next request a new session will be started.</span>
<a name="l372"><span class="linenum"> 372</span></a>  <span class="comment">     *</span>
<a name="l373"><span class="linenum"> 373</span></a>  <span class="comment">     * NOTE: we MIGHT want to link subsequent sessions together if we want to keep track...</span>
<a name="l374"><span class="linenum"> 374</span></a>  <span class="comment">     */</span>
<a name="l375"><span class="linenum"> 375</span></a>  	function <a class="function" onClick="logFunction('logout')" href="../../../_functions/logout.html" onMouseOver="funcPopup(event,'logout')">logout</a>()
<a name="l376"><span class="linenum"> 376</span></a>      {
<a name="l377"><span class="linenum"> 377</span></a>          global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>, <a class="var it4326" onMouseOver="hilite(4326)" onMouseOut="lolite()" onClick="logVariable('cookie_session')" href="../../../_variables/cookie_session.html">$cookie_session</a>, <a class="var it4182" onMouseOver="hilite(4182)" onMouseOut="lolite()" onClick="logVariable('cookie_path')" href="../../../_variables/cookie_path.html">$cookie_path</a>, <a class="var it887" onMouseOver="hilite(887)" onMouseOut="lolite()" onClick="logVariable('cookie_domain')" href="../../../_variables/cookie_domain.html">$cookie_domain</a>;
<a name="l378"><span class="linenum"> 378</span></a>  
<a name="l379"><span class="linenum"> 379</span></a>  <span class="comment">        // Invalidate the session key (no one will be able to use this session again)</span>
<a name="l380"><span class="linenum"> 380</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('key')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/key.html">key</a> = NULL;
<a name="l381"><span class="linenum"> 381</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a> = array(); <span class="comment">// We don't need to keep old data</span>
<a name="l382"><span class="linenum"> 382</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( true );
<a name="l383"><span class="linenum"> 383</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>();
<a name="l384"><span class="linenum"> 384</span></a>  
<a name="l385"><span class="linenum"> 385</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> = NULL; <span class="comment">// Unset user_ID after invalidating/saving the session above, to keep the user info attached to the old session.</span>
<a name="l386"><span class="linenum"> 386</span></a>  
<a name="l387"><span class="linenum"> 387</span></a>  <span class="comment">        // clean up the session cookie:</span>
<a name="l388"><span class="linenum"> 388</span></a>          <a class="function" onClick="logFunction('evo_setcookie')" href="../../../_functions/evo_setcookie.html" onMouseOver="funcPopup(event,'evo_setcookie')">evo_setcookie</a>( <a class="var it4326" onMouseOver="hilite(4326)" onMouseOut="lolite()" onClick="logVariable('cookie_session')" href="../../../_variables/cookie_session.html">$cookie_session</a>, '', 200000000, <a class="var it4182" onMouseOver="hilite(4182)" onMouseOut="lolite()" onClick="logVariable('cookie_path')" href="../../../_variables/cookie_path.html">$cookie_path</a>, <a class="var it887" onMouseOver="hilite(887)" onMouseOut="lolite()" onClick="logVariable('cookie_domain')" href="../../../_variables/cookie_domain.html">$cookie_domain</a>, false, true );
<a name="l389"><span class="linenum"> 389</span></a>      }
<a name="l390"><span class="linenum"> 390</span></a>  
<a name="l391"><span class="linenum"> 391</span></a>  
<a name="l392"><span class="linenum"> 392</span></a>      <span class="comment">/**</span>
<a name="l393"><span class="linenum"> 393</span></a>  <span class="comment">     * Check if session has a user attached.</span>
<a name="l394"><span class="linenum"> 394</span></a>  <span class="comment">     *</span>
<a name="l395"><span class="linenum"> 395</span></a>  <span class="comment">     * @return boolean</span>
<a name="l396"><span class="linenum"> 396</span></a>  <span class="comment">     */</span>
<a name="l397"><span class="linenum"> 397</span></a>  	function <a class="function" onClick="logFunction('has_User')" href="../../../_functions/has_user.html" onMouseOver="funcPopup(event,'has_user')">has_User</a>()
<a name="l398"><span class="linenum"> 398</span></a>      {
<a name="l399"><span class="linenum"> 399</span></a>          return !empty( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> );
<a name="l400"><span class="linenum"> 400</span></a>      }
<a name="l401"><span class="linenum"> 401</span></a>  
<a name="l402"><span class="linenum"> 402</span></a>  
<a name="l403"><span class="linenum"> 403</span></a>      <span class="comment">/**</span>
<a name="l404"><span class="linenum"> 404</span></a>  <span class="comment">     * Get the attached User.</span>
<a name="l405"><span class="linenum"> 405</span></a>  <span class="comment">     *</span>
<a name="l406"><span class="linenum"> 406</span></a>  <span class="comment">     * @return false|User</span>
<a name="l407"><span class="linenum"> 407</span></a>  <span class="comment">     */</span>
<a name="l408"><span class="linenum"> 408</span></a>      function &amp; get_User()
<a name="l409"><span class="linenum"> 409</span></a>      {
<a name="l410"><span class="linenum"> 410</span></a>          if( !empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a>) )
<a name="l411"><span class="linenum"> 411</span></a>          {
<a name="l412"><span class="linenum"> 412</span></a>              <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a> = &amp; get_UserCache();
<a name="l413"><span class="linenum"> 413</span></a>              return <a class="var it172" onMouseOver="hilite(172)" onMouseOut="lolite()" onClick="logVariable('UserCache')" href="../../../_variables/UserCache.html">$UserCache</a>-&gt;get_by_ID( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a> );
<a name="l414"><span class="linenum"> 414</span></a>          }
<a name="l415"><span class="linenum"> 415</span></a>  
<a name="l416"><span class="linenum"> 416</span></a>          <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a> = false;
<a name="l417"><span class="linenum"> 417</span></a>          return <a class="var it86" onMouseOver="hilite(86)" onMouseOut="lolite()" onClick="logVariable('r')" href="../../../_variables/r.html">$r</a>;
<a name="l418"><span class="linenum"> 418</span></a>      }
<a name="l419"><span class="linenum"> 419</span></a>  
<a name="l420"><span class="linenum"> 420</span></a>  
<a name="l421"><span class="linenum"> 421</span></a>      <span class="comment">/**</span>
<a name="l422"><span class="linenum"> 422</span></a>  <span class="comment">     * Get a data value for the session. This checks for the data to be expired and unsets it then.</span>
<a name="l423"><span class="linenum"> 423</span></a>  <span class="comment">     *</span>
<a name="l424"><span class="linenum"> 424</span></a>  <span class="comment">     * @param string Name of the data's key.</span>
<a name="l425"><span class="linenum"> 425</span></a>  <span class="comment">     * @param mixed Default value to use if key is not set or has expired. (since 1.10.0)</span>
<a name="l426"><span class="linenum"> 426</span></a>  <span class="comment">     * @return mixed The value, if set; otherwise $default</span>
<a name="l427"><span class="linenum"> 427</span></a>  <span class="comment">     */</span>
<a name="l428"><span class="linenum"> 428</span></a>  	function <a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>, <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../../_variables/default.html">$default</a> = NULL )
<a name="l429"><span class="linenum"> 429</span></a>      {
<a name="l430"><span class="linenum"> 430</span></a>          global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l431"><span class="linenum"> 431</span></a>  
<a name="l432"><span class="linenum"> 432</span></a>          if( isset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>] ) )
<a name="l433"><span class="linenum"> 433</span></a>          {
<a name="l434"><span class="linenum"> 434</span></a>              if( <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>(1, <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>]) // can be NULL!
<a name="l435"><span class="linenum"> 435</span></a>                &amp;&amp; ( <a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>][0] ) || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>][0] &gt; <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> ) ) // check for expired data
<a name="l436"><span class="linenum"> 436</span></a>              {
<a name="l437"><span class="linenum"> 437</span></a>                  return <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>][1];
<a name="l438"><span class="linenum"> 438</span></a>              }
<a name="l439"><span class="linenum"> 439</span></a>              else
<a name="l440"><span class="linenum"> 440</span></a>              { // expired or old <a class="function" onClick="logFunction('format')" href="../../../_functions/format.html" onMouseOver="funcPopup(event,'format')">format</a> (without 'value' key)
<a name="l441"><span class="linenum"> 441</span></a>                  unset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>] );
<a name="l442"><span class="linenum"> 442</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( true );
<a name="l443"><span class="linenum"> 443</span></a>                  <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session data['.<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>.'] expired.', 'request' );
<a name="l444"><span class="linenum"> 444</span></a>              }
<a name="l445"><span class="linenum"> 445</span></a>          }
<a name="l446"><span class="linenum"> 446</span></a>  
<a name="l447"><span class="linenum"> 447</span></a>          return <a class="var it921" onMouseOver="hilite(921)" onMouseOut="lolite()" onClick="logVariable('default')" href="../../../_variables/default.html">$default</a>;
<a name="l448"><span class="linenum"> 448</span></a>      }
<a name="l449"><span class="linenum"> 449</span></a>  
<a name="l450"><span class="linenum"> 450</span></a>  
<a name="l451"><span class="linenum"> 451</span></a>      <span class="comment">/**</span>
<a name="l452"><span class="linenum"> 452</span></a>  <span class="comment">     * Set a data value for the session.</span>
<a name="l453"><span class="linenum"> 453</span></a>  <span class="comment">     *</span>
<a name="l454"><span class="linenum"> 454</span></a>  <span class="comment">     * Updated values get saved to the DB automatically on shutdown, in {@link shutdown()}.</span>
<a name="l455"><span class="linenum"> 455</span></a>  <span class="comment">     *</span>
<a name="l456"><span class="linenum"> 456</span></a>  <span class="comment">     * @param string Name of the data's key.</span>
<a name="l457"><span class="linenum"> 457</span></a>  <span class="comment">     * @param mixed The value</span>
<a name="l458"><span class="linenum"> 458</span></a>  <span class="comment">     * @param integer Time in seconds for data to expire (0 to disable).</span>
<a name="l459"><span class="linenum"> 459</span></a>  <span class="comment">     */</span>
<a name="l460"><span class="linenum"> 460</span></a>  	function <a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>, <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../../_variables/value.html">$value</a>, <a class="var it6690" onMouseOver="hilite(6690)" onMouseOut="lolite()" onClick="logVariable('expire')" href="../../../_variables/expire.html">$expire</a> = 0 )
<a name="l461"><span class="linenum"> 461</span></a>      {
<a name="l462"><span class="linenum"> 462</span></a>          global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l463"><span class="linenum"> 463</span></a>  
<a name="l464"><span class="linenum"> 464</span></a>          if( ! isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>])
<a name="l465"><span class="linenum"> 465</span></a>           || ! <a class="phpfunction" onClick="logFunction('is_array')" href="../../../_functions/is_array.html" onMouseOver="phpfuncPopup(event,'is_array')">is_array</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>]) // deprecated: check to transform 1.6 session data to 1.7
<a name="l466"><span class="linenum"> 466</span></a>           || <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>][1] != <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../../_variables/value.html">$value</a>
<a name="l467"><span class="linenum"> 467</span></a>           || <a class="var it6690" onMouseOver="hilite(6690)" onMouseOut="lolite()" onClick="logVariable('expire')" href="../../../_variables/expire.html">$expire</a> != 0 )
<a name="l468"><span class="linenum"> 468</span></a>          {    // There is something to update:
<a name="l469"><span class="linenum"> 469</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>] = array( ( <a class="var it6690" onMouseOver="hilite(6690)" onMouseOut="lolite()" onClick="logVariable('expire')" href="../../../_variables/expire.html">$expire</a> ? (<a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> + <a class="var it6690" onMouseOver="hilite(6690)" onMouseOut="lolite()" onClick="logVariable('expire')" href="../../../_variables/expire.html">$expire</a>) : NULL ), <a class="var it54" onMouseOver="hilite(54)" onMouseOut="lolite()" onClick="logVariable('value')" href="../../../_variables/value.html">$value</a> );
<a name="l470"><span class="linenum"> 470</span></a>  
<a name="l471"><span class="linenum"> 471</span></a>              if( <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a> == 'Messages' )
<a name="l472"><span class="linenum"> 472</span></a>              { // also set boolean to not call CachePageContent plugin event on next request:
<a name="l473"><span class="linenum"> 473</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'core.no_CachePageContent', 1 );
<a name="l474"><span class="linenum"> 474</span></a>              }
<a name="l475"><span class="linenum"> 475</span></a>  
<a name="l476"><span class="linenum"> 476</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session data['.<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>.'] updated. Expire in: '.( <a class="var it6690" onMouseOver="hilite(6690)" onMouseOut="lolite()" onClick="logVariable('expire')" href="../../../_variables/expire.html">$expire</a> ? <a class="var it6690" onMouseOver="hilite(6690)" onMouseOut="lolite()" onClick="logVariable('expire')" href="../../../_variables/expire.html">$expire</a>.'s' : '-' ).'.', 'request' );
<a name="l477"><span class="linenum"> 477</span></a>  
<a name="l478"><span class="linenum"> 478</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( true );
<a name="l479"><span class="linenum"> 479</span></a>          }
<a name="l480"><span class="linenum"> 480</span></a>      }
<a name="l481"><span class="linenum"> 481</span></a>  
<a name="l482"><span class="linenum"> 482</span></a>  
<a name="l483"><span class="linenum"> 483</span></a>      <span class="comment">/**</span>
<a name="l484"><span class="linenum"> 484</span></a>  <span class="comment">     * Delete a value from the session data.</span>
<a name="l485"><span class="linenum"> 485</span></a>  <span class="comment">     *</span>
<a name="l486"><span class="linenum"> 486</span></a>  <span class="comment">     * @param string Name of the data's key.</span>
<a name="l487"><span class="linenum"> 487</span></a>  <span class="comment">     */</span>
<a name="l488"><span class="linenum"> 488</span></a>  	function <a class="function" onClick="logFunction('delete')" href="../../../_functions/delete.html" onMouseOver="funcPopup(event,'delete')">delete</a>( <a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a> )
<a name="l489"><span class="linenum"> 489</span></a>      {
<a name="l490"><span class="linenum"> 490</span></a>          global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>;
<a name="l491"><span class="linenum"> 491</span></a>  
<a name="l492"><span class="linenum"> 492</span></a>          if( isset(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>]) )
<a name="l493"><span class="linenum"> 493</span></a>          {
<a name="l494"><span class="linenum"> 494</span></a>              unset( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>[<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>] );
<a name="l495"><span class="linenum"> 495</span></a>  
<a name="l496"><span class="linenum"> 496</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session data['.<a class="var it307" onMouseOver="hilite(307)" onMouseOut="lolite()" onClick="logVariable('param')" href="../../../_variables/param.html">$param</a>.'] deleted!', 'request' );
<a name="l497"><span class="linenum"> 497</span></a>  
<a name="l498"><span class="linenum"> 498</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( true );
<a name="l499"><span class="linenum"> 499</span></a>          }
<a name="l500"><span class="linenum"> 500</span></a>      }
<a name="l501"><span class="linenum"> 501</span></a>  
<a name="l502"><span class="linenum"> 502</span></a>  
<a name="l503"><span class="linenum"> 503</span></a>      <span class="comment">/**</span>
<a name="l504"><span class="linenum"> 504</span></a>  <span class="comment">     * Updates session data in database.</span>
<a name="l505"><span class="linenum"> 505</span></a>  <span class="comment">     *</span>
<a name="l506"><span class="linenum"> 506</span></a>  <span class="comment">     * NOTE: Debuglog additions will may not be displayed since the debuglog may alreayd have been displayed (shutdown function)</span>
<a name="l507"><span class="linenum"> 507</span></a>  <span class="comment">     */</span>
<a name="l508"><span class="linenum"> 508</span></a>  	function <a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>()
<a name="l509"><span class="linenum"> 509</span></a>      {
<a name="l510"><span class="linenum"> 510</span></a>          global <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>, <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>, <a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('Hit')" href="../../../_variables/Hit.html">$Hit</a>, <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a>;
<a name="l511"><span class="linenum"> 511</span></a>  
<a name="l512"><span class="linenum"> 512</span></a>          if( ! <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_session_needs_save')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_session_needs_save.html">_session_needs_save</a> )
<a name="l513"><span class="linenum"> 513</span></a>          {    // There have been no changes since the last save.
<a name="l514"><span class="linenum"> 514</span></a>              <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session is up to date and does not need to be saved.', 'request' );
<a name="l515"><span class="linenum"> 515</span></a>              return false;
<a name="l516"><span class="linenum"> 516</span></a>          }
<a name="l517"><span class="linenum"> 517</span></a>  
<a name="l518"><span class="linenum"> 518</span></a>          <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('sess_data')" href="../../../_variables/sess_data.html">$sess_data</a> = empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>) ? NULL : <a class="phpfunction" onClick="logFunction('serialize')" href="../../../_functions/serialize.html" onMouseOver="phpfuncPopup(event,'serialize')">serialize</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a>);
<a name="l519"><span class="linenum"> 519</span></a>  
<a name="l520"><span class="linenum"> 520</span></a>  <span class="comment">         // Note: The key actually only needs to be updated on a logout.</span>
<a name="l521"><span class="linenum"> 521</span></a>  <span class="comment">         // Note: we increase the hitcoutn every time. That assumes that there will be no 2 calls for a single hit.</span>
<a name="l522"><span class="linenum"> 522</span></a>  <span class="comment">         //       Anyway it is not a big problem if this number is approximate.</span>
<a name="l523"><span class="linenum"> 523</span></a>          <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> = &quot;UPDATE T_sessions SET
<a name="l524"><span class="linenum"> 524</span></a>                  sess_lastseen_ts = '&quot;.<a class="phpfunction" onClick="logFunction('date')" href="../../../_functions/date.html" onMouseOver="phpfuncPopup(event,'date')">date</a>( 'Y-m-d H:i:s', <a class="var it317" onMouseOver="hilite(317)" onMouseOut="lolite()" onClick="logVariable('localtimenow')" href="../../../_variables/localtimenow.html">$localtimenow</a> ).&quot;',
<a name="l525"><span class="linenum"> 525</span></a>                  sess_data = &quot;.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('sess_data')" href="../../../_variables/sess_data.html">$sess_data</a> ).&quot;,
<a name="l526"><span class="linenum"> 526</span></a>                  sess_ipaddress = '&quot;.<a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('Hit')" href="../../../_variables/Hit.html">$Hit</a>-&gt;<a onClick="logVariable('IP')" class="var it10691" onMouseOver="hilite(10691)" onMouseOut="lolite()" href="../../../_variables/IP.html">IP</a>.&quot;',
<a name="l527"><span class="linenum"> 527</span></a>                  sess_key = &quot;.<a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('quote')" href="../../../_functions/quote.html" onMouseOver="funcPopup(event,'quote')">quote</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('key')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/key.html">key</a> );
<a name="l528"><span class="linenum"> 528</span></a>          if( !<a class="phpfunction" onClick="logFunction('is_null')" href="../../../_functions/is_null.html" onMouseOver="phpfuncPopup(event,'is_null')">is_null</a>(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a>) )
<a name="l529"><span class="linenum"> 529</span></a>          {    // We do NOT erase existing IDs at logout. We only want to set IDs at login:
<a name="l530"><span class="linenum"> 530</span></a>                  <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> .= &quot;, sess_user_ID = &quot;.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('user_ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/user_ID.html">user_ID</a>;
<a name="l531"><span class="linenum"> 531</span></a>          }
<a name="l532"><span class="linenum"> 532</span></a>          <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a> .= &quot;    WHERE sess_ID = &quot;.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>;
<a name="l533"><span class="linenum"> 533</span></a>  
<a name="l534"><span class="linenum"> 534</span></a>          <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('query')" href="../../../_functions/query.html" onMouseOver="funcPopup(event,'query')">query</a>( <a class="var it344" onMouseOver="hilite(344)" onMouseOut="lolite()" onClick="logVariable('sql')" href="../../../_variables/sql.html">$sql</a>, '<a class="class" onClick="logClass('Session')" href="../../../_classes/session.html" onMouseOver="classPopup(event,'session')">Session</a>::<a class="function" onClick="logFunction('dbsave')" href="../../../_functions/dbsave.html" onMouseOver="funcPopup(event,'dbsave')">dbsave</a>()' );
<a name="l535"><span class="linenum"> 535</span></a>  
<a name="l536"><span class="linenum"> 536</span></a>          <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Session data saved!', 'request' );
<a name="l537"><span class="linenum"> 537</span></a>  
<a name="l538"><span class="linenum"> 538</span></a>          <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('session_needs_save')" href="../../../_functions/session_needs_save.html" onMouseOver="funcPopup(event,'session_needs_save')">session_needs_save</a>( false );
<a name="l539"><span class="linenum"> 539</span></a>      }
<a name="l540"><span class="linenum"> 540</span></a>  
<a name="l541"><span class="linenum"> 541</span></a>  
<a name="l542"><span class="linenum"> 542</span></a>      <span class="comment">/**</span>
<a name="l543"><span class="linenum"> 543</span></a>  <span class="comment">     * Reload session data.</span>
<a name="l544"><span class="linenum"> 544</span></a>  <span class="comment">     *</span>
<a name="l545"><span class="linenum"> 545</span></a>  <span class="comment">     * This is needed if the running process waits for a child process to write data</span>
<a name="l546"><span class="linenum"> 546</span></a>  <span class="comment">     * into the Session, e.g. the captcha plugin in test mode waiting for the Debuglog</span>
<a name="l547"><span class="linenum"> 547</span></a>  <span class="comment">     * output from the process that created the image (included through an IMG tag).</span>
<a name="l548"><span class="linenum"> 548</span></a>  <span class="comment">     */</span>
<a name="l549"><span class="linenum"> 549</span></a>  	function <a class="function" onClick="logFunction('reload_data')" href="../../../_functions/reload_data.html" onMouseOver="funcPopup(event,'reload_data')">reload_data</a>()
<a name="l550"><span class="linenum"> 550</span></a>      {
<a name="l551"><span class="linenum"> 551</span></a>          global <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>, <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>;
<a name="l552"><span class="linenum"> 552</span></a>  
<a name="l553"><span class="linenum"> 553</span></a>          if( empty(<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a>) )
<a name="l554"><span class="linenum"> 554</span></a>          {
<a name="l555"><span class="linenum"> 555</span></a>              return false;
<a name="l556"><span class="linenum"> 556</span></a>          }
<a name="l557"><span class="linenum"> 557</span></a>  
<a name="l558"><span class="linenum"> 558</span></a>          <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('sess_data')" href="../../../_variables/sess_data.html">$sess_data</a> = <a class="var it150" onMouseOver="hilite(150)" onMouseOut="lolite()" onClick="logVariable('DB')" href="../../../_variables/DB.html">$DB</a>-&gt;<a class="function" onClick="logFunction('get_var')" href="../../../_functions/get_var.html" onMouseOver="funcPopup(event,'get_var')">get_var</a>( '
<a name="l559"><span class="linenum"> 559</span></a>              SELECT SQL_NO_CACHE sess_data FROM T_sessions
<a name="l560"><span class="linenum"> 560</span></a>               WHERE sess_ID = '.<a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('ID')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/ID.html">ID</a> );
<a name="l561"><span class="linenum"> 561</span></a>  
<a name="l562"><span class="linenum"> 562</span></a>          <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('sess_data')" href="../../../_variables/sess_data.html">$sess_data</a> = @<a class="phpfunction" onClick="logFunction('unserialize')" href="../../../_functions/unserialize.html" onMouseOver="phpfuncPopup(event,'unserialize')">unserialize</a>( <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('sess_data')" href="../../../_variables/sess_data.html">$sess_data</a> );
<a name="l563"><span class="linenum"> 563</span></a>          if( <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('sess_data')" href="../../../_variables/sess_data.html">$sess_data</a> === false )
<a name="l564"><span class="linenum"> 564</span></a>          {
<a name="l565"><span class="linenum"> 565</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a> = array();
<a name="l566"><span class="linenum"> 566</span></a>          }
<a name="l567"><span class="linenum"> 567</span></a>          else
<a name="l568"><span class="linenum"> 568</span></a>          {
<a name="l569"><span class="linenum"> 569</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('_data')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/_data.html">_data</a> = <a class="var it6682" onMouseOver="hilite(6682)" onMouseOut="lolite()" onClick="logVariable('sess_data')" href="../../../_variables/sess_data.html">$sess_data</a>;
<a name="l570"><span class="linenum"> 570</span></a>          }
<a name="l571"><span class="linenum"> 571</span></a>  
<a name="l572"><span class="linenum"> 572</span></a>          <a class="var it509" onMouseOver="hilite(509)" onMouseOut="lolite()" onClick="logVariable('Debuglog')" href="../../../_variables/Debuglog.html">$Debuglog</a>-&gt;<a class="function" onClick="logFunction('add')" href="../../../_functions/add.html" onMouseOver="funcPopup(event,'add')">add</a>( 'Session: Reloaded session data.' );
<a name="l573"><span class="linenum"> 573</span></a>      }
<a name="l574"><span class="linenum"> 574</span></a>  
<a name="l575"><span class="linenum"> 575</span></a>  
<a name="l576"><span class="linenum"> 576</span></a>      <span class="comment">/**</span>
<a name="l577"><span class="linenum"> 577</span></a>  <span class="comment">     * Create a crumb that will be saved into the Session and returned to the caller for inclusion in Form or action url.</span>
<a name="l578"><span class="linenum"> 578</span></a>  <span class="comment">     *</span>
<a name="l579"><span class="linenum"> 579</span></a>  <span class="comment">     * For any action, a new crumb is generated every hour and the previous one is saved. (2 hours are valid)</span>
<a name="l580"><span class="linenum"> 580</span></a>  <span class="comment">     *</span>
<a name="l581"><span class="linenum"> 581</span></a>  <span class="comment">     * @param string crumb name</span>
<a name="l582"><span class="linenum"> 582</span></a>  <span class="comment">     * @return string crumb value</span>
<a name="l583"><span class="linenum"> 583</span></a>  <span class="comment">     */</span>
<a name="l584"><span class="linenum"> 584</span></a>  	function <a class="function" onClick="logFunction('create_crumb')" href="../../../_functions/create_crumb.html" onMouseOver="funcPopup(event,'create_crumb')">create_crumb</a>( <a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a> )
<a name="l585"><span class="linenum"> 585</span></a>      {
<a name="l586"><span class="linenum"> 586</span></a>          global <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>, <a class="var it4329" onMouseOver="hilite(4329)" onMouseOut="lolite()" onClick="logVariable('crumb_expires')" href="../../../_variables/crumb_expires.html">$crumb_expires</a>;
<a name="l587"><span class="linenum"> 587</span></a>  
<a name="l588"><span class="linenum"> 588</span></a>  <span class="comment">        // Retrieve latest saved crumb:</span>
<a name="l589"><span class="linenum"> 589</span></a>          <a class="var it6691" onMouseOver="hilite(6691)" onMouseOut="lolite()" onClick="logVariable('crumb_recalled')" href="../../../_variables/crumb_recalled.html">$crumb_recalled</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'crumb_latest_'.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>, '-0' );
<a name="l590"><span class="linenum"> 590</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>, <a class="var it6693" onMouseOver="hilite(6693)" onMouseOut="lolite()" onClick="logVariable('crumb_time')" href="../../../_variables/crumb_time.html">$crumb_time</a> ) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( '-', <a class="var it6691" onMouseOver="hilite(6691)" onMouseOut="lolite()" onClick="logVariable('crumb_recalled')" href="../../../_variables/crumb_recalled.html">$crumb_recalled</a> );
<a name="l591"><span class="linenum"> 591</span></a>  
<a name="l592"><span class="linenum"> 592</span></a>          if( <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> - <a class="var it6693" onMouseOver="hilite(6693)" onMouseOut="lolite()" onClick="logVariable('crumb_time')" href="../../../_variables/crumb_time.html">$crumb_time</a> &gt; (<a class="var it4329" onMouseOver="hilite(4329)" onMouseOut="lolite()" onClick="logVariable('crumb_expires')" href="../../../_variables/crumb_expires.html">$crumb_expires</a>/2) )
<a name="l593"><span class="linenum"> 593</span></a>          {    // The crumb we already had is older than 1 hour...
<a name="l594"><span class="linenum"> 594</span></a>  <span class="comment">            // We'll need to generate a new value:</span>
<a name="l595"><span class="linenum"> 595</span></a>              <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a> = '';
<a name="l596"><span class="linenum"> 596</span></a>              if( <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> - <a class="var it6693" onMouseOver="hilite(6693)" onMouseOut="lolite()" onClick="logVariable('crumb_time')" href="../../../_variables/crumb_time.html">$crumb_time</a> &lt; (<a class="var it4329" onMouseOver="hilite(4329)" onMouseOut="lolite()" onClick="logVariable('crumb_expires')" href="../../../_variables/crumb_expires.html">$crumb_expires</a> - 200) ) // Leave some margin here to make sure we do no overwrite a newer 1-2 hr crumb
<a name="l597"><span class="linenum"> 597</span></a>              {    // Not too old either, save as previous crumb:
<a name="l598"><span class="linenum"> 598</span></a>                  <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'crumb_prev_'.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>, <a class="var it6691" onMouseOver="hilite(6691)" onMouseOut="lolite()" onClick="logVariable('crumb_recalled')" href="../../../_variables/crumb_recalled.html">$crumb_recalled</a> );
<a name="l599"><span class="linenum"> 599</span></a>              }
<a name="l600"><span class="linenum"> 600</span></a>          }
<a name="l601"><span class="linenum"> 601</span></a>  
<a name="l602"><span class="linenum"> 602</span></a>          if( empty(<a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>) )
<a name="l603"><span class="linenum"> 603</span></a>          {    // We need to generate a new crumb:
<a name="l604"><span class="linenum"> 604</span></a>              <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a> = <a class="function" onClick="logFunction('generate_random_key')" href="../../../_functions/generate_random_key.html" onMouseOver="funcPopup(event,'generate_random_key')">generate_random_key</a>( 32 );
<a name="l605"><span class="linenum"> 605</span></a>  
<a name="l606"><span class="linenum"> 606</span></a>  <span class="comment">            // Save crumb into session so we can later compare it to what get got back from the user request:</span>
<a name="l607"><span class="linenum"> 607</span></a>              <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('set')" href="../../../_functions/set.html" onMouseOver="funcPopup(event,'set')">set</a>( 'crumb_latest_'.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>, <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>.'-'.<a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> );
<a name="l608"><span class="linenum"> 608</span></a>          }
<a name="l609"><span class="linenum"> 609</span></a>          return <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>;
<a name="l610"><span class="linenum"> 610</span></a>      }
<a name="l611"><span class="linenum"> 611</span></a>  
<a name="l612"><span class="linenum"> 612</span></a>  
<a name="l613"><span class="linenum"> 613</span></a>      <span class="comment">/**</span>
<a name="l614"><span class="linenum"> 614</span></a>  <span class="comment">     * Assert that we received a valid crumb for the object we want to act on.</span>
<a name="l615"><span class="linenum"> 615</span></a>  <span class="comment">     *</span>
<a name="l616"><span class="linenum"> 616</span></a>  <span class="comment">     * This will DIE if we have not received a valid crumb.</span>
<a name="l617"><span class="linenum"> 617</span></a>  <span class="comment">     *</span>
<a name="l618"><span class="linenum"> 618</span></a>  <span class="comment">     * The received crumb must match a crumb we previously saved less than 2 hours ago.</span>
<a name="l619"><span class="linenum"> 619</span></a>  <span class="comment">     *</span>
<a name="l620"><span class="linenum"> 620</span></a>  <span class="comment">     * @param string crumb name</span>
<a name="l621"><span class="linenum"> 621</span></a>  <span class="comment">     * @param boolean true if the script should die on error</span>
<a name="l622"><span class="linenum"> 622</span></a>  <span class="comment">     */</span>
<a name="l623"><span class="linenum"> 623</span></a>  	function <a class="function" onClick="logFunction('assert_received_crumb')" href="../../../_functions/assert_received_crumb.html" onMouseOver="funcPopup(event,'assert_received_crumb')">assert_received_crumb</a>( <a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>, <a class="var it6694" onMouseOver="hilite(6694)" onMouseOut="lolite()" onClick="logVariable('die')" href="../../../_variables/die.html">$die</a> = true )
<a name="l624"><span class="linenum"> 624</span></a>      {
<a name="l625"><span class="linenum"> 625</span></a>          global <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a>, <a class="var it4329" onMouseOver="hilite(4329)" onMouseOut="lolite()" onClick="logVariable('crumb_expires')" href="../../../_variables/crumb_expires.html">$crumb_expires</a>, <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('debug')" href="../../../_variables/debug.html">$debug</a>;
<a name="l626"><span class="linenum"> 626</span></a>  
<a name="l627"><span class="linenum"> 627</span></a>          if( ! <a class="var it6695" onMouseOver="hilite(6695)" onMouseOut="lolite()" onClick="logVariable('crumb_received')" href="../../../_variables/crumb_received.html">$crumb_received</a> = <a class="function" onClick="logFunction('param')" href="../../../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'crumb_'.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>, 'string', NULL ) )
<a name="l628"><span class="linenum"> 628</span></a>          { // We did not receive a crumb!
<a name="l629"><span class="linenum"> 629</span></a>              if( <a class="var it6694" onMouseOver="hilite(6694)" onMouseOut="lolite()" onClick="logVariable('die')" href="../../../_variables/die.html">$die</a> )
<a name="l630"><span class="linenum"> 630</span></a>              {
<a name="l631"><span class="linenum"> 631</span></a>                  <a class="function" onClick="logFunction('bad_request_die')" href="../../../_functions/bad_request_die.html" onMouseOver="funcPopup(event,'bad_request_die')">bad_request_die</a>( 'Missing crumb ['.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>.'] -- It looks like this request is not legit.' );
<a name="l632"><span class="linenum"> 632</span></a>              }
<a name="l633"><span class="linenum"> 633</span></a>              return false;
<a name="l634"><span class="linenum"> 634</span></a>          }
<a name="l635"><span class="linenum"> 635</span></a>  
<a name="l636"><span class="linenum"> 636</span></a>  <span class="comment">        // Retrieve latest saved crumb:</span>
<a name="l637"><span class="linenum"> 637</span></a>          <a class="var it6691" onMouseOver="hilite(6691)" onMouseOut="lolite()" onClick="logVariable('crumb_recalled')" href="../../../_variables/crumb_recalled.html">$crumb_recalled</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'crumb_latest_'.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>, '-0' );
<a name="l638"><span class="linenum"> 638</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>, <a class="var it6693" onMouseOver="hilite(6693)" onMouseOut="lolite()" onClick="logVariable('crumb_time')" href="../../../_variables/crumb_time.html">$crumb_time</a> ) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( '-', <a class="var it6691" onMouseOver="hilite(6691)" onMouseOut="lolite()" onClick="logVariable('crumb_recalled')" href="../../../_variables/crumb_recalled.html">$crumb_recalled</a> );
<a name="l639"><span class="linenum"> 639</span></a>          if( <a class="var it6695" onMouseOver="hilite(6695)" onMouseOut="lolite()" onClick="logVariable('crumb_received')" href="../../../_variables/crumb_received.html">$crumb_received</a> == <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a> &amp;&amp; <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> - <a class="var it6693" onMouseOver="hilite(6693)" onMouseOut="lolite()" onClick="logVariable('crumb_time')" href="../../../_variables/crumb_time.html">$crumb_time</a> &lt;= <a class="var it4329" onMouseOver="hilite(4329)" onMouseOut="lolite()" onClick="logVariable('crumb_expires')" href="../../../_variables/crumb_expires.html">$crumb_expires</a> )
<a name="l640"><span class="linenum"> 640</span></a>          {    // Crumb is valid
<a name="l641"><span class="linenum"> 641</span></a>  <span class="comment">            // echo '&lt;p&gt;-&lt;p&gt;-&lt;p&gt;A';</span>
<a name="l642"><span class="linenum"> 642</span></a>              return true;
<a name="l643"><span class="linenum"> 643</span></a>          }
<a name="l644"><span class="linenum"> 644</span></a>  
<a name="l645"><span class="linenum"> 645</span></a>          <a class="var it6696" onMouseOver="hilite(6696)" onMouseOut="lolite()" onClick="logVariable('crumb_valid_latest')" href="../../../_variables/crumb_valid_latest.html">$crumb_valid_latest</a> = <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>;
<a name="l646"><span class="linenum"> 646</span></a>  
<a name="l647"><span class="linenum"> 647</span></a>  <span class="comment">        // Retrieve previous saved crumb:</span>
<a name="l648"><span class="linenum"> 648</span></a>          <a class="var it6691" onMouseOver="hilite(6691)" onMouseOut="lolite()" onClick="logVariable('crumb_recalled')" href="../../../_variables/crumb_recalled.html">$crumb_recalled</a> = <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a class="function" onClick="logFunction('get')" href="../../../_functions/get.html" onMouseOver="funcPopup(event,'get')">get</a>( 'crumb_prev_'.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>, '-0' );
<a name="l649"><span class="linenum"> 649</span></a>          <a class="function" onClick="logFunction('list')" href="../../../_functions/list.html" onMouseOver="funcPopup(event,'list')">list</a>( <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>, <a class="var it6693" onMouseOver="hilite(6693)" onMouseOut="lolite()" onClick="logVariable('crumb_time')" href="../../../_variables/crumb_time.html">$crumb_time</a> ) = <a class="phpfunction" onClick="logFunction('explode')" href="../../../_functions/explode.html" onMouseOver="phpfuncPopup(event,'explode')">explode</a>( '-', <a class="var it6691" onMouseOver="hilite(6691)" onMouseOut="lolite()" onClick="logVariable('crumb_recalled')" href="../../../_variables/crumb_recalled.html">$crumb_recalled</a> );
<a name="l650"><span class="linenum"> 650</span></a>          if( <a class="var it6695" onMouseOver="hilite(6695)" onMouseOut="lolite()" onClick="logVariable('crumb_received')" href="../../../_variables/crumb_received.html">$crumb_received</a> == <a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a> &amp;&amp; <a class="var it1254" onMouseOver="hilite(1254)" onMouseOut="lolite()" onClick="logVariable('servertimenow')" href="../../../_variables/servertimenow.html">$servertimenow</a> - <a class="var it6693" onMouseOver="hilite(6693)" onMouseOut="lolite()" onClick="logVariable('crumb_time')" href="../../../_variables/crumb_time.html">$crumb_time</a> &lt;= <a class="var it4329" onMouseOver="hilite(4329)" onMouseOut="lolite()" onClick="logVariable('crumb_expires')" href="../../../_variables/crumb_expires.html">$crumb_expires</a> )
<a name="l651"><span class="linenum"> 651</span></a>          {    // Crumb is valid
<a name="l652"><span class="linenum"> 652</span></a>  <span class="comment">            // echo '&lt;p&gt;-&lt;p&gt;-&lt;p&gt;B';</span>
<a name="l653"><span class="linenum"> 653</span></a>              return true;
<a name="l654"><span class="linenum"> 654</span></a>          }
<a name="l655"><span class="linenum"> 655</span></a>  
<a name="l656"><span class="linenum"> 656</span></a>          if( ! <a class="var it6694" onMouseOver="hilite(6694)" onMouseOut="lolite()" onClick="logVariable('die')" href="../../../_variables/die.html">$die</a> )
<a name="l657"><span class="linenum"> 657</span></a>          {
<a name="l658"><span class="linenum"> 658</span></a>              return false;
<a name="l659"><span class="linenum"> 659</span></a>          }
<a name="l660"><span class="linenum"> 660</span></a>  
<a name="l661"><span class="linenum"> 661</span></a>  <span class="comment">        // ERROR MESSAGE, with form/button to bypass and enough warning hopefully.</span>
<a name="l662"><span class="linenum"> 662</span></a>  <span class="comment">        // TODO: dh&gt; please review carefully!</span>
<a name="l663"><span class="linenum"> 663</span></a>          echo '&lt;div style=&quot;background-color: #fdd; padding: 1ex; margin-bottom: 1ex;&quot;&gt;';
<a name="l664"><span class="linenum"> 664</span></a>          echo '&lt;h3 style=&quot;color:#f00;&quot;&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Incorrect crumb received!').' ['.<a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a>.']&lt;/h3&gt;';
<a name="l665"><span class="linenum"> 665</span></a>          echo '&lt;p&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Your request was stopped for security reasons.').'&lt;/p&gt;';
<a name="l666"><span class="linenum"> 666</span></a>          echo '&lt;p&gt;'.sprintf( <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Have you waited more than %d minutes before submitting your request?'), <a class="phpfunction" onClick="logFunction('floor')" href="../../../_functions/floor.html" onMouseOver="phpfuncPopup(event,'floor')">floor</a>(<a class="var it4329" onMouseOver="hilite(4329)" onMouseOut="lolite()" onClick="logVariable('crumb_expires')" href="../../../_variables/crumb_expires.html">$crumb_expires</a>/60) ).'&lt;/p&gt;';
<a name="l667"><span class="linenum"> 667</span></a>          echo '&lt;p&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Please go back to the previous page and refresh it before submitting the form again.').'&lt;/p&gt;';
<a name="l668"><span class="linenum"> 668</span></a>          echo '&lt;/div&gt;';
<a name="l669"><span class="linenum"> 669</span></a>  
<a name="l670"><span class="linenum"> 670</span></a>          if( <a class="var it463" onMouseOver="hilite(463)" onMouseOut="lolite()" onClick="logVariable('debug')" href="../../../_variables/debug.html">$debug</a> &gt; 0 )
<a name="l671"><span class="linenum"> 671</span></a>          {
<a name="l672"><span class="linenum"> 672</span></a>              echo '&lt;div&gt;';
<a name="l673"><span class="linenum"> 673</span></a>              echo '&lt;p&gt;Received crumb:'.<a class="var it6695" onMouseOver="hilite(6695)" onMouseOut="lolite()" onClick="logVariable('crumb_received')" href="../../../_variables/crumb_received.html">$crumb_received</a>.'&lt;/p&gt;';
<a name="l674"><span class="linenum"> 674</span></a>              echo '&lt;p&gt;Latest saved crumb:'.<a class="var it6696" onMouseOver="hilite(6696)" onMouseOut="lolite()" onClick="logVariable('crumb_valid_latest')" href="../../../_variables/crumb_valid_latest.html">$crumb_valid_latest</a>.'&lt;/p&gt;';
<a name="l675"><span class="linenum"> 675</span></a>              echo '&lt;p&gt;Previous saved crumb:'.<a class="var it6692" onMouseOver="hilite(6692)" onMouseOut="lolite()" onClick="logVariable('crumb_value')" href="../../../_variables/crumb_value.html">$crumb_value</a>.'&lt;/p&gt;';
<a name="l676"><span class="linenum"> 676</span></a>              echo '&lt;/div&gt;';
<a name="l677"><span class="linenum"> 677</span></a>          }
<a name="l678"><span class="linenum"> 678</span></a>  
<a name="l679"><span class="linenum"> 679</span></a>          echo '&lt;div&gt;';
<a name="l680"><span class="linenum"> 680</span></a>          echo '&lt;p class=&quot;warning&quot;&gt;'.<a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Alternatively, you can try to resubmit your request with a refreshed crumb:').'&lt;/p&gt;';
<a name="l681"><span class="linenum"> 681</span></a>          <a class="var it158" onMouseOver="hilite(158)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../../_variables/Form.html">$Form</a> = <span class="keyword">new </span><a class="class" onClick="logClass('Form')" href="../../../_classes/form.html" onMouseOver="classPopup(event,'form')">Form</a>( '', 'evo_session_crumb_resend', <a class="var it142" onMouseOver="hilite(142)" onMouseOut="lolite()" onClick="logVariable('_SERVER')" href="../../../_variables/_SERVER.html">$_SERVER</a>['REQUEST_METHOD'] );
<a name="l682"><span class="linenum"> 682</span></a>          <a class="var it158" onMouseOver="hilite(158)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('begin_form')" href="../../../_functions/begin_form.html" onMouseOver="funcPopup(event,'begin_form')">begin_form</a>( 'inline' );
<a name="l683"><span class="linenum"> 683</span></a>          <a class="var it158" onMouseOver="hilite(158)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('add_crumb')" href="../../../_functions/add_crumb.html" onMouseOver="funcPopup(event,'add_crumb')">add_crumb</a>( <a class="var it2479" onMouseOver="hilite(2479)" onMouseOut="lolite()" onClick="logVariable('crumb_name')" href="../../../_variables/crumb_name.html">$crumb_name</a> );
<a name="l684"><span class="linenum"> 684</span></a>          <a class="var it158" onMouseOver="hilite(158)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('hiddens_by_key')" href="../../../_functions/hiddens_by_key.html" onMouseOver="funcPopup(event,'hiddens_by_key')">hiddens_by_key</a>( <a class="function" onClick="logFunction('remove_magic_quotes')" href="../../../_functions/remove_magic_quotes.html" onMouseOver="funcPopup(event,'remove_magic_quotes')">remove_magic_quotes</a>(<a class="var it6076" onMouseOver="hilite(6076)" onMouseOut="lolite()" onClick="logVariable('_REQUEST')" href="../../../_variables/_REQUEST.html">$_REQUEST</a>) );
<a name="l685"><span class="linenum"> 685</span></a>          <a class="var it158" onMouseOver="hilite(158)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('button')" href="../../../_functions/button.html" onMouseOver="funcPopup(event,'button')">button</a>( array( 'submit', '', <a class="function" onClick="logFunction('T_')" href="../../../_functions/t_.html" onMouseOver="funcPopup(event,'t_')">T_</a>('Resubmit now!'), 'ActionButton' ) );
<a name="l686"><span class="linenum"> 686</span></a>          <a class="var it158" onMouseOver="hilite(158)" onMouseOut="lolite()" onClick="logVariable('Form')" href="../../../_variables/Form.html">$Form</a>-&gt;<a class="function" onClick="logFunction('end_form')" href="../../../_functions/end_form.html" onMouseOver="funcPopup(event,'end_form')">end_form</a>();
<a name="l687"><span class="linenum"> 687</span></a>          echo '&lt;/div&gt;';
<a name="l688"><span class="linenum"> 688</span></a>  
<a name="l689"><span class="linenum"> 689</span></a>          die();
<a name="l690"><span class="linenum"> 690</span></a>      }
<a name="l691"><span class="linenum"> 691</span></a>  
<a name="l692"><span class="linenum"> 692</span></a>  
<a name="l693"><span class="linenum"> 693</span></a>      <span class="comment">/**</span>
<a name="l694"><span class="linenum"> 694</span></a>  <span class="comment">     * Was this session created from a mobile device</span>
<a name="l695"><span class="linenum"> 695</span></a>  <span class="comment">     */</span>
<a name="l696"><span class="linenum"> 696</span></a>  	function <a class="function" onClick="logFunction('is_mobile_session')" href="../../../_functions/is_mobile_session.html" onMouseOver="funcPopup(event,'is_mobile_session')">is_mobile_session</a>()
<a name="l697"><span class="linenum"> 697</span></a>      {
<a name="l698"><span class="linenum"> 698</span></a>          global <a class="var it4761" onMouseOver="hilite(4761)" onMouseOut="lolite()" onClick="logVariable('mobile_user_devices')" href="../../../_variables/mobile_user_devices.html">$mobile_user_devices</a>;
<a name="l699"><span class="linenum"> 699</span></a>  
<a name="l700"><span class="linenum"> 700</span></a>          return <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a>, <a class="var it4761" onMouseOver="hilite(4761)" onMouseOut="lolite()" onClick="logVariable('mobile_user_devices')" href="../../../_variables/mobile_user_devices.html">$mobile_user_devices</a> );
<a name="l701"><span class="linenum"> 701</span></a>      }
<a name="l702"><span class="linenum"> 702</span></a>  
<a name="l703"><span class="linenum"> 703</span></a>  
<a name="l704"><span class="linenum"> 704</span></a>      <span class="comment">/**</span>
<a name="l705"><span class="linenum"> 705</span></a>  <span class="comment">     * Was this session created from a mobile device</span>
<a name="l706"><span class="linenum"> 706</span></a>  <span class="comment">     */</span>
<a name="l707"><span class="linenum"> 707</span></a>  	function <a class="function" onClick="logFunction('is_tablet_session')" href="../../../_functions/is_tablet_session.html" onMouseOver="funcPopup(event,'is_tablet_session')">is_tablet_session</a>()
<a name="l708"><span class="linenum"> 708</span></a>      {
<a name="l709"><span class="linenum"> 709</span></a>          global <a class="var it4762" onMouseOver="hilite(4762)" onMouseOut="lolite()" onClick="logVariable('tablet_user_devices')" href="../../../_variables/tablet_user_devices.html">$tablet_user_devices</a>;
<a name="l710"><span class="linenum"> 710</span></a>  
<a name="l711"><span class="linenum"> 711</span></a>          return <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a>, <a class="var it4762" onMouseOver="hilite(4762)" onMouseOut="lolite()" onClick="logVariable('tablet_user_devices')" href="../../../_variables/tablet_user_devices.html">$tablet_user_devices</a> );
<a name="l712"><span class="linenum"> 712</span></a>      }
<a name="l713"><span class="linenum"> 713</span></a>  
<a name="l714"><span class="linenum"> 714</span></a>  
<a name="l715"><span class="linenum"> 715</span></a>      <span class="comment">/**</span>
<a name="l716"><span class="linenum"> 716</span></a>  <span class="comment">     * Was this session created from a desktop device</span>
<a name="l717"><span class="linenum"> 717</span></a>  <span class="comment">     */</span>
<a name="l718"><span class="linenum"> 718</span></a>  	function <a class="function" onClick="logFunction('is_desktop_session')" href="../../../_functions/is_desktop_session.html" onMouseOver="funcPopup(event,'is_desktop_session')">is_desktop_session</a>()
<a name="l719"><span class="linenum"> 719</span></a>      {
<a name="l720"><span class="linenum"> 720</span></a>          global <a class="var it4763" onMouseOver="hilite(4763)" onMouseOut="lolite()" onClick="logVariable('pc_user_devices')" href="../../../_variables/pc_user_devices.html">$pc_user_devices</a>;
<a name="l721"><span class="linenum"> 721</span></a>  
<a name="l722"><span class="linenum"> 722</span></a>          return <a class="phpfunction" onClick="logFunction('array_key_exists')" href="../../../_functions/array_key_exists.html" onMouseOver="phpfuncPopup(event,'array_key_exists')">array_key_exists</a>( <a class="var it3" onMouseOver="hilite(3)" onMouseOut="lolite()" onClick="logVariable('this')" href="../../../_variables/this.html">$this</a>-&gt;<a onClick="logVariable('sess_device')" class="var it10673" onMouseOver="hilite(10673)" onMouseOut="lolite()" href="../../../_variables/sess_device.html">sess_device</a>, <a class="var it4763" onMouseOver="hilite(4763)" onMouseOut="lolite()" onClick="logVariable('pc_user_devices')" href="../../../_variables/pc_user_devices.html">$pc_user_devices</a> );
<a name="l723"><span class="linenum"> 723</span></a>      }
<a name="l724"><span class="linenum"> 724</span></a>  }
<a name="l725"><span class="linenum"> 725</span></a>  
<a name="l726"><span class="linenum"> 726</span></a>  
<a name="l727"><span class="linenum"> 727</span></a>  <span class="comment">/**</span>
<a name="l728"><span class="linenum"> 728</span></a>  <span class="comment"> * This gets used as a {@link unserialize()} callback function, which is</span>
<a name="l729"><span class="linenum"> 729</span></a>  <span class="comment"> * responsible for loading the requested class.</span>
<a name="l730"><span class="linenum"> 730</span></a>  <span class="comment"> *</span>
<a name="l731"><span class="linenum"> 731</span></a>  <span class="comment"> * IMPORTANT: when modifying this, modify the following also:</span>
<a name="l732"><span class="linenum"> 732</span></a>  <span class="comment"> * @see session_unserialize_load_all_classes()</span>
<a name="l733"><span class="linenum"> 733</span></a>  <span class="comment"> *</span>
<a name="l734"><span class="linenum"> 734</span></a>  <span class="comment"> * @todo Once we require PHP5, we should think about using this as __autoload function.</span>
<a name="l735"><span class="linenum"> 735</span></a>  <span class="comment"> *</span>
<a name="l736"><span class="linenum"> 736</span></a>  <span class="comment"> * @return boolean True, if the required class could be loaded; false, if not</span>
<a name="l737"><span class="linenum"> 737</span></a>  <span class="comment"> */</span>
<a name="l738"><span class="linenum"> 738</span></a>  function <a class="function" onClick="logFunction('session_unserialize_callback')" href="../../../_functions/session_unserialize_callback.html" onMouseOver="funcPopup(event,'session_unserialize_callback')">session_unserialize_callback</a>( <a class="var it2368" onMouseOver="hilite(2368)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../../_variables/classname.html">$classname</a> )
<a name="l739"><span class="linenum"> 739</span></a>  {
<a name="l740"><span class="linenum"> 740</span></a>      switch( <a class="phpfunction" onClick="logFunction('strtolower')" href="../../../_functions/strtolower.html" onMouseOver="phpfuncPopup(event,'strtolower')">strtolower</a>(<a class="var it2368" onMouseOver="hilite(2368)" onMouseOut="lolite()" onClick="logVariable('classname')" href="../../../_variables/classname.html">$classname</a>) )
<a name="l741"><span class="linenum"> 741</span></a>      {
<a name="l742"><span class="linenum"> 742</span></a>          case 'blog':
<a name="l743"><span class="linenum"> 743</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'collections/model/_blog.class.php', 'Blog' );
<a name="l744"><span class="linenum"> 744</span></a>              return true;
<a name="l745"><span class="linenum"> 745</span></a>  
<a name="l746"><span class="linenum"> 746</span></a>          case 'collectionsettings':
<a name="l747"><span class="linenum"> 747</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'collections/model/_collsettings.class.php', 'CollectionSettings' );
<a name="l748"><span class="linenum"> 748</span></a>              return true;
<a name="l749"><span class="linenum"> 749</span></a>  
<a name="l750"><span class="linenum"> 750</span></a>          case 'comment':
<a name="l751"><span class="linenum"> 751</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'comments/model/_comment.class.php', 'Comment' );
<a name="l752"><span class="linenum"> 752</span></a>              return true;
<a name="l753"><span class="linenum"> 753</span></a>  
<a name="l754"><span class="linenum"> 754</span></a>          case 'item':
<a name="l755"><span class="linenum"> 755</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'items/model/_item.class.php', 'Item' );
<a name="l756"><span class="linenum"> 756</span></a>              return true;
<a name="l757"><span class="linenum"> 757</span></a>  
<a name="l758"><span class="linenum"> 758</span></a>          case 'itemsettings':
<a name="l759"><span class="linenum"> 759</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'items/model/_itemsettings.class.php', 'ItemSettings' );
<a name="l760"><span class="linenum"> 760</span></a>              return true;
<a name="l761"><span class="linenum"> 761</span></a>  
<a name="l762"><span class="linenum"> 762</span></a>          case 'group':
<a name="l763"><span class="linenum"> 763</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'users/model/_group.class.php', 'Group' );
<a name="l764"><span class="linenum"> 764</span></a>              return true;
<a name="l765"><span class="linenum"> 765</span></a>  
<a name="l766"><span class="linenum"> 766</span></a>          case 'user':
<a name="l767"><span class="linenum"> 767</span></a>              <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'users/model/_user.class.php', 'User' );
<a name="l768"><span class="linenum"> 768</span></a>              return true;
<a name="l769"><span class="linenum"> 769</span></a>      }
<a name="l770"><span class="linenum"> 770</span></a>  
<a name="l771"><span class="linenum"> 771</span></a>      return false;
<a name="l772"><span class="linenum"> 772</span></a>  }
<a name="l773"><span class="linenum"> 773</span></a>  
<a name="l774"><span class="linenum"> 774</span></a>  
<a name="l775"><span class="linenum"> 775</span></a>  <span class="comment">/**</span>
<a name="l776"><span class="linenum"> 776</span></a>  <span class="comment"> * When session_unserialize_callback() cannot be registered to do some smart loading,</span>
<a name="l777"><span class="linenum"> 777</span></a>  <span class="comment"> * then we fall back to this function and load everything with brute force...</span>
<a name="l778"><span class="linenum"> 778</span></a>  <span class="comment"> *</span>
<a name="l779"><span class="linenum"> 779</span></a>  <span class="comment"> * IMPORTANT: when modifying this, modify the following also:</span>
<a name="l780"><span class="linenum"> 780</span></a>  <span class="comment"> * @see session_unserialize_callback()</span>
<a name="l781"><span class="linenum"> 781</span></a>  <span class="comment"> */</span>
<a name="l782"><span class="linenum"> 782</span></a>  function <a class="function" onClick="logFunction('session_unserialize_load_all_classes')" href="../../../_functions/session_unserialize_load_all_classes.html" onMouseOver="funcPopup(event,'session_unserialize_load_all_classes')">session_unserialize_load_all_classes</a>()
<a name="l783"><span class="linenum"> 783</span></a>  {
<a name="l784"><span class="linenum"> 784</span></a>      <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'collections/model/_blog.class.php', 'Blog' );
<a name="l785"><span class="linenum"> 785</span></a>      <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'collections/model/_collsettings.class.php', 'CollectionSettings' );
<a name="l786"><span class="linenum"> 786</span></a>      <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'comments/model/_comment.class.php', 'Comment' );
<a name="l787"><span class="linenum"> 787</span></a>      <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'items/model/_item.class.php', 'Item' );
<a name="l788"><span class="linenum"> 788</span></a>      <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'items/model/_itemsettings.class.php', 'ItemSettings' );
<a name="l789"><span class="linenum"> 789</span></a>      <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'users/model/_group.class.php', 'Group' );
<a name="l790"><span class="linenum"> 790</span></a>      <a class="function" onClick="logFunction('load_class')" href="../../../_functions/load_class.html" onMouseOver="funcPopup(event,'load_class')">load_class</a>( 'users/model/_user.class.php', 'User' );
<a name="l791"><span class="linenum"> 791</span></a>  }
<a name="l792"><span class="linenum"> 792</span></a>  
<a name="l793"><span class="linenum"> 793</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'id': ['id', 'Template function: Displays object ID. ', [['inc/_core/model/dataobjects','_dataobject.class.php',1043]], 19],
'end_form': ['end_form', 'Ends the form, optionally displays buttons and closes all open fieldsets. ', [['inc/_core/ui/forms','_form.class.php',1975]], 208],
'session_needs_save': ['session_needs_save', '', [['inc/sessions/model','_session.class.php',315]], 7],
'begin': ['begin', 'BEGIN A TRANSCATION ', [['inc/_core/model/db','_db.class.php',1537]], 114],
'is_desktop_session': ['is_desktop_session', 'Was this session created from a desktop device ', [['inc/sessions/model','_session.class.php',715]], 0],
'rollback': ['rollback', 'Rollback current transaction ', [['inc/_core/model/db','_db.class.php',1625]], 48],
'assert_received_crumb': ['assert_received_crumb', 'Assert that we received a valid crumb for the object we want to act on. ', [['inc/sessions/model','_session.class.php',613]], 286],
'set_user': ['set_user', 'Set user ', [['inc/tools/model','_syslog.class.php',118],['inc/sessions/model','_session.class.php',321]], 4],
'get': ['get', 'Get a member param by its name ', [['inc/items/model','_item.class.php',6187],['inc/_core/model/db','_sql.class.php',50],['inc/_core/model/dataobjects','_dataobject.class.php',834],['inc/plugins/model','_pluginusersettings.class.php',40],['inc/users/model','_user.class.php',1227],['rsc/js/tiny_mce/plugins/spellchecker/includes','Engine.php',145],['inc/settings/model','_abstractsettings.class.php',252],['inc/settings/model','_generalsettings.class.php',379],['inc/users/model','_usersettings.class.php',148],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',95],['inc/links/model','_linkcomment.class.php',150],['inc/links/model','_linkitem.class.php',205],['inc/sessions/model','_session.class.php',428],['inc/collections/model','_blog.class.php',1842],['inc/comments/model','_comment.class.php',386],['inc/cron/model','_cronjob.class.php',89],['inc/plugins/model','_pluginsettings.class.php',40],['inc/links/model','_linkowner.class.php',218],['plugins/twitter_plugin/twitteroauth','twitteroauth.php',146],['inc/slugs/model','_slug.class.php',68],['inc/users/model','_groupsettings.class.php',124],['inc/chapters/model','_chapter.class.php',600],['inc/antispam/model','_iprange.class.php',60],['inc/files/model','_file.class.php',555],['inc/links/model','_linkuser.class.php',154],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',165]], 2630],
'param': ['param', 'Sets a parameter with values from the request or to provided default, except if param is already set! ', [['inc/_core','_param.funcs.php',35]], 2141],
'add_crumb': ['add_crumb', 'Add a crumb to the current form ', [['inc/_core/ui/forms','_form.class.php',3094]], 164],
'add_messages': ['add_messages', 'Add a Messages object to this. ', [['inc/_core/model','_messages.class.php',132],['inc/_core/model','_log.class.php',149],['inc/_core/model','_log.class.php',582]], 1],
'bad_request_die': ['bad_request_die', 'Outputs Bad request Error message. When in debug mode it also prints a backtrace. ', [['inc/_core','_misc.funcs.php',2679]], 22],
'delete': ['delete', '', [['inc/_ext/pclzip','pclzip.lib.php',1007],['inc/plugins/model','_pluginusersettings.class.php',89],['inc/settings/model','_abstractsettings.class.php',504],['inc/users/model','_usersettings.class.php',209],['inc/sessions/model','_session.class.php',483],['inc/plugins/model','_pluginsettings.class.php',65],['plugins/twitter_plugin/twitteroauth','twitteroauth.php',168],['inc/users/model','_groupsettings.class.php',181]], 99],
'has_user': ['has_user', 'Check if session has a user attached. ', [['inc/sessions/model','_session.class.php',392]], 4],
't_': ['t_', 'Provide translation in the context of this module: ', [['inc/_core/model','_module.class.php',67],['rsc/js','blog_widgets.js',467],['inc/skins/model','_skin.class.php',1131],['inc/plugins','_plugin.class.php',2799],['inc/locales','_locale.funcs.php',29],['inc/locales','_locale.funcs.php',226]], 12118],
'dbsave': ['dbsave', 'Inserts or Updates depending on object state. ', [['inc/_core/model/dataobjects','_dataobject.class.php',569],['inc/sessions/model','_session.class.php',503]], 51],
'add': ['add', '', [['inc/_ext/pclzip','pclzip.lib.php',455],['rsc/js/tiny_mce/plugins/spellchecker/includes','Engine.php',141],['inc/skins/model','_skincache.class.php',50],['inc/_core/model','_messages.class.php',114],['inc/_ext/swift/classes/Swift/Plugins','LoggerPlugin.php',33],['inc/_ext/swift/classes/Swift/Plugins','Logger.php',20],['inc/files/model','_filetypecache.class.php',38],['inc/_core/model/dataobjects','_dataobjectcache.class.php',339],['inc/_ext/swift/classes/Swift/Plugins/Loggers','EchoLogger.php',33],['inc/_core/model','_log.class.php',109],['inc/_core/model','_log.class.php',577],['inc/users/model','_usercache.class.php',239],['inc/_ext/swift/classes/Swift/Plugins/Loggers','ArrayLogger.php',44],['inc/links/model','_linkcache.class.php',86],['inc/users/model','_groupsettings.class.php',103],['inc/chapters/model','_chaptercache.class.php',98],['inc/files/model','_filelist.class.php',373],['inc/collections/model','_blogcache.class.php',50]], 1695],
'get_col': ['get_col', 'Function to get 1 column from the cached result set based on X index see docs for usage and info ', [['inc/_core/model/db','_db.class.php',1032]], 117],
'get_var': ['get_var', 'Get one variable from the DB - see docs for more detail ', [['inc/_core/model/db','_db.class.php',952]], 166],
'evo_setcookie': ['evo_setcookie', 'Send a cookie (@see setcookie() for more details) ', [['inc/_core','_misc.funcs.php',6685]], 8],
'format': ['format', 'Format a diff. ', [['inc/_core/model','_diff.class.php',813],['inc/_core/model','_diff.class.php',976],['rsc/js/flowplayer','flowplayer.js',1446]], 78],
'commit': ['commit', 'For any bytes that are currently buffered inside the stream, force them off the buffer. ', [['inc/_ext/swift/classes/Swift/ByteStream','AbstractFilterableInputStream.php',97],['inc/_ext/swift/classes/Swift/Signers','DKIMSigner.php',223],['inc/_ext/swift/classes/Swift/ByteStream','ArrayByteStream.php',116],['inc/_ext/swift/classes/Swift/Plugins','BandwidthMonitorPlugin.php',90],['inc/_ext/swift/classes/Swift','InputByteStream.php',41],['inc/_ext/swift/classes/Swift/Signers','DomainKeySigner.php',178],['inc/_ext/swift/classes/Swift/KeyCache','SimpleKeyCacheInputStream.php',71],['inc/_core/model/db','_db.class.php',1589]], 135],
'is_tablet_session': ['is_tablet_session', 'Was this session created from a mobile device ', [['inc/sessions/model','_session.class.php',704]], 5],
'query': ['query', 'Run Query: GET DATA ROWS *** HEAVY *** ', [['inc/items/model','_itemlist.class.php',249],['inc/items/model','_itemlistlight.class.php',742],['inc/comments/model','_commentlist.class.php',507],['inc/users/model','_userlist.class.php',511],['inc/_core/ui/results','_results.class.php',468],['inc/_core/model/db','_db.class.php',749]], 1144],
'logout': ['logout', 'Log the user out ', [['inc/users/model','_user.funcs.php',21],['inc/sessions/model','_session.class.php',365],['inc/plugins','_plugin.class.php',2426]], 6],
'get_class_db_config': ['get_class_db_config', 'Get this class db table config params ', [['inc/_core/model/dataobjects','_dataobject.class.php',104],['inc/users/model','_user.class.php',231],['inc/messaging/model','_message.class.php',87],['inc/messaging/model','_thread.class.php',147],['inc/sessions/model','_session.class.php',259],['inc/comments/model','_comment.class.php',250],['inc/links/model','_link.class.php',84],['inc/chapters/model','_chapter.class.php',120],['inc/files/model','_file.class.php',250],['inc/items/model','_itemlight.class.php',199]], 7],
'list': ['list', '', [['rsc/js/bootstrap','typeahead.bundle.js',156]], 105],
'button': ['button', 'Builds a button. ', [['inc/_core/ui/forms','_form.class.php',2980]], 68],
'hiddens_by_key': ['hiddens_by_key', 'Builds a list of hidden inputs from an array where the keys are the field names. ', [['inc/_core/ui/forms','_form.class.php',3145]], 56],
'generate_random_key': ['generate_random_key', 'Generate a valid key of size $length. ', [['inc/_core','_misc.funcs.php',4759]], 24],
'reload_data': ['reload_data', 'Reload session data. ', [['inc/sessions/model','_session.class.php',542]], 0],
'is_mobile_session': ['is_mobile_session', 'Was this session created from a mobile device ', [['inc/sessions/model','_session.class.php',693]], 5],
'create_crumb': ['create_crumb', 'Create a crumb that will be saved into the Session and returned to the caller for inclusion in Form or action url. ', [['inc/sessions/model','_session.class.php',576]], 1],
'set': ['set', 'Set param value ', [['inc/items/model','_item.class.php',4909],['inc/tools/model','_emailaddress.class.php',76],['inc/_core/model/dataobjects','_dataobject.class.php',874],['inc/plugins/model','_pluginusersettings.class.php',64],['inc/regional/model','_country.class.php',94],['inc/users/model','_user.class.php',2059],['inc/settings/model','_abstractsettings.class.php',427],['inc/messaging/model','_thread.class.php',211],['inc/regional/model','_subregion.class.php',107],['inc/users/model','_usersettings.class.php',184],['plugins','_calendar.plugin.php',613],['inc/_ext/swift/classes/Swift/Mime','HeaderSet.php',81],['inc/files/model','_filetype.class.php',128],['inc/sessions/model','_session.class.php',451],['inc/collections/model','_blog.class.php',1104],['inc/comments/model','_comment.class.php',400],['inc/cron/model','_cronjob.class.php',64],['inc/plugins/model','_pluginsettings.class.php',52],['inc/users/model','_userfield.class.php',257],['inc/regional/model','_city.class.php',98],['inc/slugs/model','_slug.class.php',80],['inc/users/model','_group.class.php',212],['inc/regional/model','_currency.class.php',84],['inc/widgets/model','_widget.class.php',369],['inc/regional/model','_region.class.php',90],['inc/users/model','_groupsettings.class.php',140],['inc/chapters/model','_chapter.class.php',809],['inc/antispam/model','_iprange.class.php',72],['inc/items/model','_itemtag.class.php',61],['inc/sessions/model','_goal.class.php',201],['inc/items/model','_itemlight.class.php',1328],['inc/users/model','_userfieldgroup.class.php',83],['inc/_ext/swift/classes/Swift/Mime','SimpleHeaderSet.php',148]], 1238],
'begin_form': ['begin_form', 'Builds the form field ', [['inc/_core/ui/forms','_form.class.php',1816]], 194],
'quote': ['quote', 'Quote a msgid/msgstr, preferrable with single quotes. ', [['inc/locales','_pofile.class.php',261],['inc/_core/model/db','_db.class.php',491]], 1085],
'get_row': ['get_row', 'Get one row from the DB. ', [['inc/_core/model/db','_db.class.php',987]], 60],
'session_unserialize_load_all_classes': ['session_unserialize_load_all_classes', 'When session_unserialize_callback() cannot be registered to do some smart loading, then we fall back to this function and load everything with brute force... ', [['inc/sessions/model','_session.class.php',775]], 1],
'db_delete_where': ['db_delete_where', 'Delete the given class objects from the database which corresponds to the given condition or to the given ids array This function must be overriden on those classes where the db delete requires some updates on other table content or some files/folders delete. Note: the delete cascade arrays are handled! Delete cascades are handled recursively only if the cascade arrays from the reffering class contains the class and class_path params ( e.g. see User class )! ', [['inc/_core/model/dataobjects','_dataobject.class.php',175],['inc/users/model','_user.class.php',3308],['inc/messaging/model','_message.class.php',503],['inc/sessions/model','_session.class.php',281],['inc/comments/model','_comment.class.php',290]], 11],
'set_user_id': ['set_user_id', 'Attach a user ID to the session. ', [['inc/sessions/model','_session.class.php',332]], 3],
'session': ['session', 'Constructor ', [['inc/sessions/model','_session.class.php',92]], 38],
'load_class': ['load_class', 'In PHP4, this really loads the class. In PHP5, it\'s smarter than that: It only registers the class & file name so that __autoload() can later load the class IF and ONLY IF the class is actually needed during execution. ', [['inc/_core','_class5.funcs.php',64],['inc/_core','_class4.funcs.php',19]], 435],
'param_cookie': ['param_cookie', 'Get a param from cookie. ', [['inc/_core','_param.funcs.php',488]], 31],
'remove_magic_quotes': ['remove_magic_quotes', '', [['inc/_core','_param.funcs.php',1997],['inc/_core','_param.funcs.php',2016],['inc/_core','_param.funcs.php',2048]], 15],
'session_unserialize_callback': ['session_unserialize_callback', 'This gets used as a {@link unserialize()} callback function, which is responsible for loading the requested class. ', [['inc/sessions/model','_session.class.php',727]], 0],
'mysql2timestamp': ['mysql2timestamp', 'Convert a MYSQL date to a UNIX timestamp. ', [['inc/_core','_misc.funcs.php',1237]], 15],
'time': ['time', '', [], 76],
'array_key_exists': ['array_key_exists', '', [], 62],
'is_array': ['is_array', '', [], 311],
'explode': ['explode', '', [], 263],
'unserialize': ['unserialize', '', [], 18],
'serialize': ['serialize', '', [], 66],
'date': ['date', '', [], 446],
'is_null': ['is_null', '', [], 299],
'implode': ['implode', '', [], 571],
'var_export': ['var_export', '', [], 48],
'preg_match': ['preg_match', '', [], 423],
'ini_set': ['ini_set', '', [], 37],
'is_a': ['is_a', '', [], 39],
'defined': ['defined', '', [], 962],
'floor': ['floor', '', [], 116],
'strtolower': ['strtolower', '', [], 202]};
CLASS_DATA={
'form': ['form', 'Form class ', [['inc/_core/ui/forms','_form.class.php',28]], 208],
'session': ['session', 'A session tracks a given user (not necessarily logged in) while he\'s navigating the site. A session also stores data for the length of the session. ', [['inc/sessions/model','_session.class.php',23]], 4]};
CONST_DATA={
'EVO_MAIN_INIT': ['EVO_MAIN_INIT', '', [['install','index.php',26],['inc','_main.inc.php',36],['install','debug.php',22]], 912]};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Nov 21 22:13:19 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
