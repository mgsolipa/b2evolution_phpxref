<!doctype html public "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
    <title>PHPXRef 0.7.1 : Unnamed Project : /htsrv/track.php source</title>
    <link rel="stylesheet" href="../sample.css" type="text/css">
    <link rel="stylesheet" href="../sample-print.css" type="text/css" media="print">
    <style id="hilight" type="text/css"></style>
    <meta http-equiv="content-type" content="text/html;charset=iso-8859-1">
</head>
<body bgcolor="#ffffff" text="#000000" link="#801800" vlink="#300540" alink="#ffffff">
<table class="pagetitle" width="100%">
	<tr>
        <td valign="top" class="pagetitle">
            [ <a href="../index.html">Index</a> ]
        </td>
        <td align="right" class="pagetitle">
		    <h2 style="margin-bottom: 0px">PHP Cross Reference of Unnamed Project</h2>
	    </td>
    </tr>
</table>


<!-- Generated by PHPXref 0.7.1 at Sat Nov 21 22:13:19 2015 -->
<!-- PHPXref (c) 2000-2010 Gareth Watts - gareth@omnipotent.net -->
<!-- http://phpxref.sourceforge.net/ -->

<script src="../phpxref.js" type="text/javascript"></script>
<script language="JavaScript" type="text/javascript">
<!--
ext='.html';
relbase='../';
subdir='htsrv';
filename='track.php.source.html';
cookiekey='phpxref';
handleNavFrame(relbase, subdir, filename);

// -->
</script>
<script language="JavaScript" type="text/javascript">
if (gwGetCookie('xrefnav')=='off')
  document.write('<p class="navlinks">[ <a href="javascript:navOn()">Show Explorer<\/a> ]<\/p>');
else
  document.write('<p class="navlinks">[ <a href="javascript:navOff()">Hide Explorer<\/a> ]<\/p>');
</script>
<noscript>
<p class="navlinks">
[ <a href="../nav.html" target="_top">Show Explorer</a> ]
[ <a href="index.html" target="_top">Hide Navbar</a> ]
</p>
</noscript>
<script language="JavaScript" type="text/javascript">
<!--

document.writeln('<table align="right" class="searchbox-link"><tr><td><a class="searchbox-link" href="javascript:void(0)" onMouseOver="showSearchBox()">Search</a><br>');
document.writeln('<table border="0" cellspacing="0" cellpadding="0" class="searchbox" id="searchbox">');
document.writeln('<tr><td class="searchbox-title">');
document.writeln('<a class="searchbox-title" href="javascript:showSearchPopup()">Search History +</a>');
document.writeln('<\/td><\/tr>');

document.writeln('<tr><td class="searchbox-body" id="searchbox-body">');
document.writeln('<form name="search" style="margin:0px; padding:0px" onSubmit=\'return jump()\'>');
document.writeln('<a class="searchbox-body" href="../_classes/index.html">Class<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="classname"><br>');
document.writeln('<a id="funcsearchlink" class="searchbox-body" href="../_functions/index.html">Function<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="funcname"><br>');
document.writeln('<a class="searchbox-body" href="../_variables/index.html">Variable<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="varname"><br>');
document.writeln('<a class="searchbox-body" href="../_constants/index.html">Constant<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="constname"><br>');
document.writeln('<a class="searchbox-body" href="../_tables/index.html">Table<\/a>: ');
document.writeln('<input type="text" size=10 value="" name="tablename"><br>');
document.writeln('<input type="submit" class="searchbox-button" value="Search">');
document.writeln('<\/form>');
document.writeln('<\/td><\/tr><\/table>');
document.writeln('<\/td><\/tr><\/table>');
// -->
</script>
<div id="search-popup" class="searchpopup"><p id="searchpopup-title" class="searchpopup-title">title</p><div id="searchpopup-body" class="searchpopup-body">Body</div><p class="searchpopup-close"><a href="javascript:gwCloseActive()">[close]</a></p></div>
<h2 class="listing-heading"><a href="./index.html">/htsrv/</a> -> <a href="track.php.html">track.php</a> (source)</h2>
<div class="listing">
<p class="viewlinks">[<a href="track.php.html">Summary view</a>]
[<a href="javascript:window.print();">Print</a>]
[<a href="track.php.source.txt" target="_new">Text view</a>]
</p>
<pre>
<a name="l1"><span class="linenum">   1</span></a>  &lt;?php
<a name="l2"><span class="linenum">   2</span></a>  <span class="comment">/**</span>
<a name="l3"><span class="linenum">   3</span></a>  <span class="comment"> * This is the goal tracker + redirect handler.</span>
<a name="l4"><span class="linenum">   4</span></a>  <span class="comment"> *</span>
<a name="l5"><span class="linenum">   5</span></a>  <span class="comment"> * See also {@link https://github.com/b2evolution/b2evolution}.</span>
<a name="l6"><span class="linenum">   6</span></a>  <span class="comment"> *</span>
<a name="l7"><span class="linenum">   7</span></a>  <span class="comment"> * @license GNU GPL v2 - {@link http://b2evolution.net/about/gnu-gpl-license}</span>
<a name="l8"><span class="linenum">   8</span></a>  <span class="comment"> *</span>
<a name="l9"><span class="linenum">   9</span></a>  <span class="comment"> * @copyright (c)2003-2015 by Francois Planque - {@link http://fplanque.com/}.</span>
<a name="l10"><span class="linenum">  10</span></a>  <span class="comment"> *</span>
<a name="l11"><span class="linenum">  11</span></a>  <span class="comment"> * @package sessions</span>
<a name="l12"><span class="linenum">  12</span></a>  <span class="comment"> *</span>
<a name="l13"><span class="linenum">  13</span></a>  <span class="comment"> * @author fplanque: Francois PLANQUE.</span>
<a name="l14"><span class="linenum">  14</span></a>  <span class="comment"> */</span>
<a name="l15"><span class="linenum">  15</span></a>  
<a name="l16"><span class="linenum">  16</span></a>  <span class="comment">/**</span>
<a name="l17"><span class="linenum">  17</span></a>  <span class="comment"> * @global Hit</span>
<a name="l18"><span class="linenum">  18</span></a>  <span class="comment"> */</span>
<a name="l19"><span class="linenum">  19</span></a>  global <a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('Hit')" href="../_variables/Hit.html">$Hit</a>;
<a name="l20"><span class="linenum">  20</span></a>  
<a name="l21"><span class="linenum">  21</span></a>  <span class="comment">/**</span>
<a name="l22"><span class="linenum">  22</span></a>  <span class="comment"> * Do the MAIN initializations:</span>
<a name="l23"><span class="linenum">  23</span></a>  <span class="comment"> */</span>
<a name="l24"><span class="linenum">  24</span></a>  require_once <a class="phpfunction" onClick="logFunction('dirname')" href="../_functions/dirname.html" onMouseOver="phpfuncPopup(event,'dirname')">dirname</a>(__FILE__).'<a class="filename" href="../conf/_config.php.html">/../conf/_config.php</a>';
<a name="l25"><span class="linenum">  25</span></a>  
<a name="l26"><span class="linenum">  26</span></a>  <span class="comment">/**</span>
<a name="l27"><span class="linenum">  27</span></a>  <span class="comment"> * HEAVY :(</span>
<a name="l28"><span class="linenum">  28</span></a>  <span class="comment"> */</span>
<a name="l29"><span class="linenum">  29</span></a>  require_once <a class="var it43" onMouseOver="hilite(43)" onMouseOut="lolite()" onClick="logVariable('inc_path')" href="../_variables/inc_path.html">$inc_path</a>.'_main.inc.php';
<a name="l30"><span class="linenum">  30</span></a>  
<a name="l31"><span class="linenum">  31</span></a>  <a class="function" onClick="logFunction('param')" href="../_functions/param.html" onMouseOver="funcPopup(event,'param')">param</a>( 'key', 'string', '' );
<a name="l32"><span class="linenum">  32</span></a>  
<a name="l33"><span class="linenum">  33</span></a>  <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('GoalCache')" href="../_variables/GoalCache.html">$GoalCache</a> = &amp; get_GoalCache();
<a name="l34"><span class="linenum">  34</span></a>  <a class="var it1761" onMouseOver="hilite(1761)" onMouseOut="lolite()" onClick="logVariable('Goal')" href="../_variables/Goal.html">$Goal</a> = &amp; <a class="var it132" onMouseOver="hilite(132)" onMouseOut="lolite()" onClick="logVariable('GoalCache')" href="../_variables/GoalCache.html">$GoalCache</a>-&gt;get_by_name( <a class="var it1021" onMouseOver="hilite(1021)" onMouseOut="lolite()" onClick="logVariable('key')" href="../_variables/key.html">$key</a>, false, false );
<a name="l35"><span class="linenum">  35</span></a>  
<a name="l36"><span class="linenum">  36</span></a>  if( empty( <a class="var it1761" onMouseOver="hilite(1761)" onMouseOut="lolite()" onClick="logVariable('Goal')" href="../_variables/Goal.html">$Goal</a> ) )
<a name="l37"><span class="linenum">  37</span></a>  { // Goal key doesn't exist in DB
<a name="l38"><span class="linenum">  38</span></a>      <a class="function" onClick="logFunction('load_funcs')" href="../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( 'skins/_skin.funcs.php' );
<a name="l39"><span class="linenum">  39</span></a>      require <a class="var it2259" onMouseOver="hilite(2259)" onMouseOut="lolite()" onClick="logVariable('siteskins_path')" href="../_variables/siteskins_path.html">$siteskins_path</a>.'_404_basic_not_found.main.php'; <span class="comment">// error &amp; exit</span>
<a name="l40"><span class="linenum">  40</span></a>      exit(0);
<a name="l41"><span class="linenum">  41</span></a>  }
<a name="l42"><span class="linenum">  42</span></a>  
<a name="l43"><span class="linenum">  43</span></a>  if( ! empty( <a class="var it1761" onMouseOver="hilite(1761)" onMouseOut="lolite()" onClick="logVariable('Goal')" href="../_variables/Goal.html">$Goal</a>-&gt;<a onClick="logVariable('redir_url')" class="var it10710" onMouseOver="hilite(10710)" onMouseOut="lolite()" href="../_variables/redir_url.html">redir_url</a> ) || ! empty( <a class="var it1761" onMouseOver="hilite(1761)" onMouseOut="lolite()" onClick="logVariable('Goal')" href="../_variables/Goal.html">$Goal</a>-&gt;<a onClick="logVariable('temp_redir_url')" class="var it10710" onMouseOver="hilite(10710)" onMouseOut="lolite()" href="../_variables/temp_redir_url.html">temp_redir_url</a> ) )
<a name="l44"><span class="linenum">  44</span></a>  { // TODO adapt and use <a class="function" onClick="logFunction('header_redirect')" href="../_functions/header_redirect.html" onMouseOver="funcPopup(event,'header_redirect')">header_redirect</a>()
<a name="l45"><span class="linenum">  45</span></a>  
<a name="l46"><span class="linenum">  46</span></a>      <a class="var it1781" onMouseOver="hilite(1781)" onMouseOut="lolite()" onClick="logVariable('redir_url')" href="../_variables/redir_url.html">$redir_url</a> = <a class="var it1761" onMouseOver="hilite(1761)" onMouseOut="lolite()" onClick="logVariable('Goal')" href="../_variables/Goal.html">$Goal</a>-&gt;<a class="function" onClick="logFunction('get_active_url')" href="../_functions/get_active_url.html" onMouseOver="funcPopup(event,'get_active_url')">get_active_url</a>();
<a name="l47"><span class="linenum">  47</span></a>  
<a name="l48"><span class="linenum">  48</span></a>      if( <a class="phpfunction" onClick="logFunction('preg_match')" href="../_functions/preg_match.html" onMouseOver="phpfuncPopup(event,'preg_match')">preg_match</a>( '/\$([a-z_]+)\$/i', <a class="var it1781" onMouseOver="hilite(1781)" onMouseOut="lolite()" onClick="logVariable('redir_url')" href="../_variables/redir_url.html">$redir_url</a>, <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../_variables/matches.html">$matches</a> ) )
<a name="l49"><span class="linenum">  49</span></a>      { // We want to replace a special code like <a class="var it4681" onMouseOver="hilite(4681)" onMouseOut="lolite()" onClick="logVariable('hit_ID')" href="../_variables/hit_ID.html">$hit_ID</a>$ in the redir URL:
<a name="l50"><span class="linenum">  50</span></a>  <span class="comment">        // Tblue&gt; What about using preg_replace_callback() to do this?</span>
<a name="l51"><span class="linenum">  51</span></a>          switch( <a class="var it8" onMouseOver="hilite(8)" onMouseOut="lolite()" onClick="logVariable('matches')" href="../_variables/matches.html">$matches</a>[1] )
<a name="l52"><span class="linenum">  52</span></a>          {
<a name="l53"><span class="linenum">  53</span></a>              case 'hit_ID':
<a name="l54"><span class="linenum">  54</span></a>  <span class="comment">                // We need to log the HIT now! Because we need the hit ID!</span>
<a name="l55"><span class="linenum">  55</span></a>                  <a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('Hit')" href="../_variables/Hit.html">$Hit</a>-&gt;<a class="phpfunction" onClick="logFunction('log')" href="../_functions/log.html" onMouseOver="phpfuncPopup(event,'log')">log</a>();
<a name="l56"><span class="linenum">  56</span></a>                  <a class="var it1781" onMouseOver="hilite(1781)" onMouseOut="lolite()" onClick="logVariable('redir_url')" href="../_variables/redir_url.html">$redir_url</a> = <a class="phpfunction" onClick="logFunction('str_replace')" href="../_functions/str_replace.html" onMouseOver="phpfuncPopup(event,'str_replace')">str_replace</a>( '<a class="var it4681" onMouseOver="hilite(4681)" onMouseOut="lolite()" onClick="logVariable('hit_ID')" href="../_variables/hit_ID.html">$hit_ID</a>$', <a class="var it352" onMouseOver="hilite(352)" onMouseOut="lolite()" onClick="logVariable('Hit')" href="../_variables/Hit.html">$Hit</a>-&gt;<a onClick="logVariable('ID')" class="var it10691" onMouseOver="hilite(10691)" onMouseOut="lolite()" href="../_variables/ID.html">ID</a>, <a class="var it1781" onMouseOver="hilite(1781)" onMouseOut="lolite()" onClick="logVariable('redir_url')" href="../_variables/redir_url.html">$redir_url</a> );
<a name="l57"><span class="linenum">  57</span></a>                  break;
<a name="l58"><span class="linenum">  58</span></a>          }
<a name="l59"><span class="linenum">  59</span></a>      }
<a name="l60"><span class="linenum">  60</span></a>  
<a name="l61"><span class="linenum">  61</span></a>      <a class="function" onClick="logFunction('header_http_response')" href="../_functions/header_http_response.html" onMouseOver="funcPopup(event,'header_http_response')">header_http_response</a>( '302 Found' );
<a name="l62"><span class="linenum">  62</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>( 'Location: '.<a class="var it1781" onMouseOver="hilite(1781)" onMouseOut="lolite()" onClick="logVariable('redir_url')" href="../_variables/redir_url.html">$redir_url</a>, true, 302 ); <span class="comment">// explictly setting the status is required for (fast)cgi</span>
<a name="l63"><span class="linenum">  63</span></a>  <span class="comment">    // TODO: dh&gt; str_repeat won't be enough (when gzipped), see http://core.trac.wordpress.org/ticket/8942</span>
<a name="l64"><span class="linenum">  64</span></a>  <span class="comment">    //           should be probably a more general function and get used in e.g. bad_request_die(), too (if necessary)</span>
<a name="l65"><span class="linenum">  65</span></a>      echo <a class="phpfunction" onClick="logFunction('str_repeat')" href="../_functions/str_repeat.html" onMouseOver="phpfuncPopup(event,'str_repeat')">str_repeat</a>( ' ', 1024 );
<a name="l66"><span class="linenum">  66</span></a>      <a class="function" onClick="logFunction('evo_flush')" href="../_functions/evo_flush.html" onMouseOver="funcPopup(event,'evo_flush')">evo_flush</a>();
<a name="l67"><span class="linenum">  67</span></a>  <span class="comment">    // At this point Firefox 2 will redirect without waiting for the end of the page, but IE7 will not :/</span>
<a name="l68"><span class="linenum">  68</span></a>  }
<a name="l69"><span class="linenum">  69</span></a>  else
<a name="l70"><span class="linenum">  70</span></a>  {    // No redirection specified, we send a blank pixel instead:
<a name="l71"><span class="linenum">  71</span></a>      <a class="function" onClick="logFunction('load_funcs')" href="../_functions/load_funcs.html" onMouseOver="funcPopup(event,'load_funcs')">load_funcs</a>( '_core/_template.funcs.php' );
<a name="l72"><span class="linenum">  72</span></a>      <a class="var it7242" onMouseOver="hilite(7242)" onMouseOut="lolite()" onClick="logVariable('blank_gif')" href="../_variables/blank_gif.html">$blank_gif</a> = <a class="var it1865" onMouseOver="hilite(1865)" onMouseOut="lolite()" onClick="logVariable('rsc_path')" href="../_variables/rsc_path.html">$rsc_path</a>.'img/blank.gif';
<a name="l73"><span class="linenum">  73</span></a>  
<a name="l74"><span class="linenum">  74</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>( 'Content-type: image/gif' );
<a name="l75"><span class="linenum">  75</span></a>      <a class="phpfunction" onClick="logFunction('header')" href="../_functions/header.html" onMouseOver="phpfuncPopup(event,'header')">header</a>( 'Content-Length: '.<a class="phpfunction" onClick="logFunction('filesize')" href="../_functions/filesize.html" onMouseOver="phpfuncPopup(event,'filesize')">filesize</a>( <a class="var it7242" onMouseOver="hilite(7242)" onMouseOut="lolite()" onClick="logVariable('blank_gif')" href="../_variables/blank_gif.html">$blank_gif</a> ) );
<a name="l76"><span class="linenum">  76</span></a>      <a class="function" onClick="logFunction('header_nocache')" href="../_functions/header_nocache.html" onMouseOver="funcPopup(event,'header_nocache')">header_nocache</a>();
<a name="l77"><span class="linenum">  77</span></a>      <a class="phpfunction" onClick="logFunction('readfile')" href="../_functions/readfile.html" onMouseOver="phpfuncPopup(event,'readfile')">readfile</a>( <a class="var it7242" onMouseOver="hilite(7242)" onMouseOut="lolite()" onClick="logVariable('blank_gif')" href="../_variables/blank_gif.html">$blank_gif</a> );
<a name="l78"><span class="linenum">  78</span></a>      <a class="function" onClick="logFunction('evo_flush')" href="../_functions/evo_flush.html" onMouseOver="funcPopup(event,'evo_flush')">evo_flush</a>();
<a name="l79"><span class="linenum">  79</span></a>  }
<a name="l80"><span class="linenum">  80</span></a>  
<a name="l81"><span class="linenum">  81</span></a>  <span class="comment">// Record a goal hit:</span>
<a name="l82"><span class="linenum">  82</span></a>  <a class="var it1761" onMouseOver="hilite(1761)" onMouseOut="lolite()" onClick="logVariable('Goal')" href="../_variables/Goal.html">$Goal</a>-&gt;<a class="function" onClick="logFunction('record_hit')" href="../_functions/record_hit.html" onMouseOver="funcPopup(event,'record_hit')">record_hit</a>();
<a name="l83"><span class="linenum">  83</span></a>  ?&gt;
</pre>
</div>
<script language="JavaScript" type="text/javascript">
FUNC_DATA={
'record_hit': ['record_hit', 'Record goal hit ', [['inc/sessions/model','_goal.class.php',275]], 2],
'header_http_response': ['header_http_response', 'Update global $http_response_code and call function header() ', [['inc/_core','_misc.funcs.php',6115]], 18],
'header_redirect': ['header_redirect', 'Sends HTTP header to redirect to the previous location (which can be given as function parameter, GET parameter (redirect_to), is taken from {@link Hit::$referer} or {@link $baseurl}). ', [['inc/_core','_template.funcs.php',91]], 427],
'load_funcs': ['load_funcs', '', [['inc/_core','_misc.funcs.php',158]], 242],
'header_nocache': ['header_nocache', 'Sends HTTP headers to avoid caching of the page at the browser level (at least without revalidating with the server to make sure whether the content has changed or not). ', [['inc/_core','_template.funcs.php',285]], 9],
'param': ['param', 'Sets a parameter with values from the request or to provided default, except if param is already set! ', [['inc/_core','_param.funcs.php',35]], 2141],
'get_active_url': ['get_active_url', 'Get redirection URL that is active now ', [['inc/sessions/model','_goal.class.php',241]], 3],
'evo_flush': ['evo_flush', 'Flush the output buffer ', [['inc/_core','_misc.funcs.php',6613]], 166],
'str_repeat': ['str_repeat', '', [], 25],
'header': ['header', '', [], 83],
'filesize': ['filesize', '', [], 20],
'readfile': ['readfile', '', [], 10],
'log': ['log', '', [], 89],
'preg_match': ['preg_match', '', [], 423],
'str_replace': ['str_replace', '', [], 531],
'dirname': ['dirname', '', [], 182]};
CLASS_DATA={
};
CONST_DATA={
};
</script>
<div id="func-popup" class="funcpopup"><p id="func-title" class="popup-title">title</p><p id="func-desc" class="popup-desc">Description</p><p id="func-body" class="popup-body">Body</p></div>
<div id="class-popup" class="funcpopup"><p id="class-title" class="popup-title">title</p><p id="class-desc" class="popup-desc">Description</p><p id="class-body" class="popup-body">Body</p></div>
<div id="const-popup" class="funcpopup"><p id="const-title" class="popup-title">title</p><p id="const-desc" class="popup-desc">Description</p><p id="const-body" class="popup-body">Body</p></div>
<div id="req-popup" class="funcpopup"><p id="req-title" class="popup-title">title</p><p id="req-body" class="popup-body">Body</p></div>
<!-- A link to the phpxref site in your customized footer file is appreciated ;-) -->
<br><hr>
<table width="100%">
	<tr><td>Generated: Sat Nov 21 22:13:19 2015</td>
	<td align="right"><i>Cross-referenced by <a href="http://phpxref.sourceforge.net/">PHPXref 0.7.1</a></i></td>
	</tr>
</table>
</body></html>
